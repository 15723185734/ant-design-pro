(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[2515],{35099:function(Ue,W,L){"use strict";var X=L(67294),j=L(25282),v=L(23185),Q=L(4322),F=L(24770),J=L(89182),ne=function(K,Ne){var Ve={};for(var ke in K)Object.prototype.hasOwnProperty.call(K,ke)&&Ne.indexOf(ke)<0&&(Ve[ke]=K[ke]);if(K!=null&&typeof Object.getOwnPropertySymbols=="function")for(var ot=0,ke=Object.getOwnPropertySymbols(K);ot<ke.length;ot++)Ne.indexOf(ke[ot])<0&&Object.prototype.propertyIsEnumerable.call(K,ke[ot])&&(Ve[ke[ot]]=K[ke[ot]]);return Ve},ye=(0,X.forwardRef)(function(K,Ne){var Ve=K.chartRef,ke=K.style,ot=ke===void 0?{height:"inherit"}:ke,Jt=K.className,pt=K.loading,Zt=K.loadingTemplate,_t=K.errorTemplate,nt=ne(K,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),et=(0,v.Z)(j.aC,nt),kt=et.chart,Y=et.container;return(0,X.useEffect)(function(){(0,Q.J)(Ve,kt.current)},[kt.current]),(0,X.useImperativeHandle)(Ne,function(){return{getChart:function(){return kt.current}}}),X.createElement(F.Z,{errorTemplate:_t},pt&&X.createElement(J.Z,{loadingTemplate:Zt}),X.createElement("div",{className:Jt,style:ot,ref:Y}))});W.Z=ye},65337:function(Ue,W,L){"use strict";var X=L(67294),j=L(25282),v=L(23185),Q=L(4322),F=L(24770),J=L(89182),ne=function(K,Ne){var Ve={};for(var ke in K)Object.prototype.hasOwnProperty.call(K,ke)&&Ne.indexOf(ke)<0&&(Ve[ke]=K[ke]);if(K!=null&&typeof Object.getOwnPropertySymbols=="function")for(var ot=0,ke=Object.getOwnPropertySymbols(K);ot<ke.length;ot++)Ne.indexOf(ke[ot])<0&&Object.prototype.propertyIsEnumerable.call(K,ke[ot])&&(Ve[ke[ot]]=K[ke[ot]]);return Ve},ye=(0,X.forwardRef)(function(K,Ne){var Ve=K.chartRef,ke=K.style,ot=ke===void 0?{height:"inherit"}:ke,Jt=K.className,pt=K.loading,Zt=K.loadingTemplate,_t=K.errorTemplate,nt=ne(K,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),et=(0,v.Z)(j.Kj,nt),kt=et.chart,Y=et.container;return(0,X.useEffect)(function(){(0,Q.J)(Ve,kt.current)},[kt.current]),(0,X.useImperativeHandle)(Ne,function(){return{getChart:function(){return kt.current}}}),X.createElement(F.Z,{errorTemplate:_t},pt&&X.createElement(J.Z,{loadingTemplate:Zt}),X.createElement("div",{className:Jt,style:ot,ref:Y}))});W.Z=ye},90829:function(Ue,W,L){"use strict";var X=L(67294),j=L(25282),v=L(23185),Q=L(4322),F=L(24770),J=L(89182),ne=function(K,Ne){var Ve={};for(var ke in K)Object.prototype.hasOwnProperty.call(K,ke)&&Ne.indexOf(ke)<0&&(Ve[ke]=K[ke]);if(K!=null&&typeof Object.getOwnPropertySymbols=="function")for(var ot=0,ke=Object.getOwnPropertySymbols(K);ot<ke.length;ot++)Ne.indexOf(ke[ot])<0&&Object.prototype.propertyIsEnumerable.call(K,ke[ot])&&(Ve[ke[ot]]=K[ke[ot]]);return Ve},ye=(0,X.forwardRef)(function(K,Ne){var Ve=K.chartRef,ke=K.style,ot=ke===void 0?{height:"inherit"}:ke,Jt=K.className,pt=K.loading,Zt=K.loadingTemplate,_t=K.errorTemplate,nt=ne(K,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),et=(0,v.Z)(j.TZ,nt),kt=et.chart,Y=et.container;return(0,X.useEffect)(function(){(0,Q.J)(Ve,kt.current)},[kt.current]),(0,X.useImperativeHandle)(Ne,function(){return{getChart:function(){return kt.current}}}),X.createElement(F.Z,{errorTemplate:_t},pt&&X.createElement(J.Z,{loadingTemplate:Zt}),X.createElement("div",{className:Jt,style:ot,ref:Y}))});W.Z=ye},93343:function(Ue,W,L){"use strict";var X=L(67294),j=L(25282),v=L(23185),Q=L(4322),F=L(24770),J=L(89182),ne=function(K,Ne){var Ve={};for(var ke in K)Object.prototype.hasOwnProperty.call(K,ke)&&Ne.indexOf(ke)<0&&(Ve[ke]=K[ke]);if(K!=null&&typeof Object.getOwnPropertySymbols=="function")for(var ot=0,ke=Object.getOwnPropertySymbols(K);ot<ke.length;ot++)Ne.indexOf(ke[ot])<0&&Object.prototype.propertyIsEnumerable.call(K,ke[ot])&&(Ve[ke[ot]]=K[ke[ot]]);return Ve},ye=(0,X.forwardRef)(function(K,Ne){var Ve=K.chartRef,ke=K.style,ot=ke===void 0?{height:"inherit"}:ke,Jt=K.className,pt=K.loading,Zt=K.loadingTemplate,_t=K.errorTemplate,nt=ne(K,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),et=(0,v.Z)(j.m,nt),kt=et.chart,Y=et.container;return(0,X.useEffect)(function(){(0,Q.J)(Ve,kt.current)},[kt.current]),(0,X.useImperativeHandle)(Ne,function(){return{getChart:function(){return kt.current}}}),X.createElement(F.Z,{errorTemplate:_t},pt&&X.createElement(J.Z,{loadingTemplate:Zt}),X.createElement("div",{className:Jt,style:ot,ref:Y}))});W.Z=ye},92688:function(Ue,W,L){"use strict";var X=L(67294),j=L(25282),v=L(23185),Q=L(4322),F=L(24770),J=L(89182),ne=function(K,Ne){var Ve={};for(var ke in K)Object.prototype.hasOwnProperty.call(K,ke)&&Ne.indexOf(ke)<0&&(Ve[ke]=K[ke]);if(K!=null&&typeof Object.getOwnPropertySymbols=="function")for(var ot=0,ke=Object.getOwnPropertySymbols(K);ot<ke.length;ot++)Ne.indexOf(ke[ot])<0&&Object.prototype.propertyIsEnumerable.call(K,ke[ot])&&(Ve[ke[ot]]=K[ke[ot]]);return Ve},ye=(0,X.forwardRef)(function(K,Ne){var Ve=K.chartRef,ke=K.style,ot=ke===void 0?{height:"inherit"}:ke,Jt=K.className,pt=K.loading,Zt=K.loadingTemplate,_t=K.errorTemplate,nt=ne(K,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),et=(0,v.Z)(j.kB,nt),kt=et.chart,Y=et.container;return(0,X.useEffect)(function(){(0,Q.J)(Ve,kt.current)},[kt.current]),(0,X.useImperativeHandle)(Ne,function(){return{getChart:function(){return kt.current}}}),X.createElement(F.Z,{errorTemplate:_t},pt&&X.createElement(J.Z,{loadingTemplate:Zt}),X.createElement("div",{className:Jt,style:ot,ref:Y}))});W.Z=ye},64335:function(Ue,W,L){"use strict";var X=L(67294),j=(0,X.createContext)({});W.Z=j},21349:function(Ue,W,L){"use strict";var X=L(84305),j=L(69224),v=L(53645),Q=L.n(v),F=L(67294),J=L(94184),ne=L.n(J),ye=L(64335),K=function(Ve){var ke=(0,F.useContext)(ye.Z),ot=Ve.children,Jt=Ve.contentWidth,pt=Ve.className,Zt=Ve.style,_t=(0,F.useContext)(j.ZP.ConfigContext),nt=_t.getPrefixCls,et=Ve.prefixCls||nt("pro"),kt=Jt||ke.contentWidth,Y="".concat(et,"-grid-content");return F.createElement("div",{className:ne()(Y,pt,{wide:kt==="Fixed"}),style:Zt},F.createElement("div",{className:"".concat(et,"-grid-content-children")},ot))};W.Z=K},78087:function(Ue,W,L){"use strict";L.d(W,{zP:function(){return yM},JE:function(){return PA},ns:function(){return gM}});var X={};L.r(X),L.d(X,{add:function(){return Cr},adjoint:function(){return ap},clone:function(){return Hp},copy:function(){return wd},create:function(){return Ss},determinant:function(){return Oh},equals:function(){return ut},exactEquals:function(){return Sr},frob:function(){return yr},fromQuat:function(){return Tf},fromQuat2:function(){return Xp},fromRotation:function(){return Td},fromRotationTranslation:function(){return wf},fromRotationTranslationScale:function(){return sp},fromRotationTranslationScaleOrigin:function(){return jl},fromScaling:function(){return Cd},fromTranslation:function(){return Wp},fromValues:function(){return el},fromXRotation:function(){return op},fromYRotation:function(){return Ad},fromZRotation:function(){return Md},frustum:function(){return up},getRotation:function(){return Ia},getScaling:function(){return Cf},getTranslation:function(){return Yp},identity:function(){return xc},invert:function(){return rh},lookAt:function(){return Qt},mul:function(){return jt},multiply:function(){return zu},multiplyScalar:function(){return Ur},multiplyScalarAndAdd:function(){return gr},ortho:function(){return ar},orthoNO:function(){return It},orthoZO:function(){return Pt},perspective:function(){return B},perspectiveFromFieldOfView:function(){return Be},perspectiveNO:function(){return qp},perspectiveZO:function(){return ve},rotate:function(){return To},rotateX:function(){return ws},rotateY:function(){return Rh},rotateZ:function(){return Lh},scale:function(){return Uu},set:function(){return Sf},str:function(){return vr},sub:function(){return _r},subtract:function(){return Tr},targetTo:function(){return lr},translate:function(){return ra},transpose:function(){return bc}});var j=L(67294),v=(0,j.createContext)({});function Q(){return(0,j.useContext)(v)}var F={},J={},ne=function(n){return J[n]},ye=function(n,r){J[n]=r},K=function(n){return F[n]},Ne=function(n,r){F[n]=r},Ve={},ke={},ot=34,Jt=10,pt=13;function Zt(e){return new Function("d","return {"+e.map(function(n,r){return JSON.stringify(n)+": d["+r+'] || ""'}).join(",")+"}")}function _t(e,n){var r=Zt(e);return function(i,o){return n(r(i),o,e)}}function nt(e){var n=Object.create(null),r=[];return e.forEach(function(i){for(var o in i)o in n||r.push(n[o]=o)}),r}function et(e,n){var r=e+"",i=r.length;return i<n?new Array(n-i+1).join(0)+r:r}function kt(e){return e<0?"-"+et(-e,6):e>9999?"+"+et(e,6):et(e,4)}function Y(e){var n=e.getUTCHours(),r=e.getUTCMinutes(),i=e.getUTCSeconds(),o=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":kt(e.getUTCFullYear(),4)+"-"+et(e.getUTCMonth()+1,2)+"-"+et(e.getUTCDate(),2)+(o?"T"+et(n,2)+":"+et(r,2)+":"+et(i,2)+"."+et(o,3)+"Z":i?"T"+et(n,2)+":"+et(r,2)+":"+et(i,2)+"Z":r||n?"T"+et(n,2)+":"+et(r,2)+"Z":"")}function Wt(e){var n=new RegExp('["'+e+`
\r]`),r=e.charCodeAt(0);function i(I,D){var Z,re,oe=o(I,function(de,Fe){if(Z)return Z(de,Fe-1);re=de,Z=D?_t(de,D):Zt(de)});return oe.columns=re||[],oe}function o(I,D){var Z=[],re=I.length,oe=0,de=0,Fe,it=re<=0,vt=!1;I.charCodeAt(re-1)===Jt&&--re,I.charCodeAt(re-1)===pt&&--re;function xt(){if(it)return ke;if(vt)return vt=!1,Ve;var Xt,nr=oe,mr;if(I.charCodeAt(nr)===ot){for(;oe++<re&&I.charCodeAt(oe)!==ot||I.charCodeAt(++oe)===ot;);return(Xt=oe)>=re?it=!0:(mr=I.charCodeAt(oe++))===Jt?vt=!0:mr===pt&&(vt=!0,I.charCodeAt(oe)===Jt&&++oe),I.slice(nr+1,Xt-1).replace(/""/g,'"')}for(;oe<re;){if((mr=I.charCodeAt(Xt=oe++))===Jt)vt=!0;else if(mr===pt)vt=!0,I.charCodeAt(oe)===Jt&&++oe;else if(mr!==r)continue;return I.slice(nr,Xt)}return it=!0,I.slice(nr,re)}for(;(Fe=xt())!==ke;){for(var Gt=[];Fe!==Ve&&Fe!==ke;)Gt.push(Fe),Fe=xt();D&&(Gt=D(Gt,de++))==null||Z.push(Gt)}return Z}function u(I,D){return I.map(function(Z){return D.map(function(re){return P(Z[re])}).join(e)})}function d(I,D){return D==null&&(D=nt(I)),[D.map(P).join(e)].concat(u(I,D)).join(`
`)}function _(I,D){return D==null&&(D=nt(I)),u(I,D).join(`
`)}function x(I){return I.map(E).join(`
`)}function E(I){return I.map(P).join(e)}function P(I){return I==null?"":I instanceof Date?Y(I):n.test(I+="")?'"'+I.replace(/"/g,'""')+'"':I}return{parse:i,parseRows:o,format:d,formatBody:_,formatRows:x,formatRow:E,formatValue:P}}var st=Wt(","),Ye=st.parse,ct=st.parseRows,Je=st.format,Rt=st.formatBody,dr=st.formatRows,Mr=st.formatRow,jr=st.formatValue,C=L(96156),we=L(85061),Le=L(38163),Et=L.n(Le);function gt(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function Lt(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?gt(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):gt(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function Yt(e,n){var r=n.x,i=n.y,o=n.x1,u=n.y1,d=n.coordinates,_=[];return e.forEach(function(x,E){var P=[];if(r&&i&&(P=[parseFloat(x[r]),parseFloat(x[i])]),r&&i&&o&&u){var I=[parseFloat(x[r]),parseFloat(x[i])],D=[parseFloat(x[o]),parseFloat(x[u])];P=[I,D]}if(d){var Z="Polygon";Array.isArray(d[0])||(Z="Point"),Array.isArray(d[0])&&!Array.isArray(d[0][0])&&(Z="LineString");var re={type:Z,coordinates:(0,we.Z)(x[d])};Et()(re,!0),P=re.coordinates}var oe=Lt(Lt({},x),{},{_id:E,coordinates:P});_.push(oe)}),{dataArray:_}}var br=[{lng1:100,lat1:30,lng2:130,lat2:30}],Yn={parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}};function cn(e,n){var r=Ye(e);return Yt(r,n)}var ci=63710088e-1,Zn={centimeters:ci*100,centimetres:ci*100,degrees:ci/111325,feet:ci*3.28084,inches:ci*39.37,kilometers:ci/1e3,kilometres:ci/1e3,meters:ci,metres:ci,miles:ci/1609.344,millimeters:ci*1e3,millimetres:ci*1e3,nauticalmiles:ci/1852,radians:1,yards:ci*1.0936},ri={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/ci,yards:1.0936133},fi={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function Gn(e,n,r){r===void 0&&(r={});var i={type:"Feature"};return(r.id===0||r.id)&&(i.id=r.id),r.bbox&&(i.bbox=r.bbox),i.properties=n||{},i.geometry=e,i}function hi(e,n,r){switch(r===void 0&&(r={}),e){case"Point":return la(n).geometry;case"LineString":return ca(n).geometry;case"Polygon":return Oi(n).geometry;case"MultiPoint":return bi(n).geometry;case"MultiLineString":return Xn(n).geometry;case"MultiPolygon":return Ni(n).geometry;default:throw new Error(e+" is invalid")}}function la(e,n,r){if(r===void 0&&(r={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!xn(e[0])||!xn(e[1]))throw new Error("coordinates must contain numbers");var i={type:"Point",coordinates:e};return Gn(i,n,r)}function Vi(e,n,r){return r===void 0&&(r={}),ma(e.map(function(i){return la(i,n)}),r)}function Oi(e,n,r){r===void 0&&(r={});for(var i=0,o=e;i<o.length;i++){var u=o[i];if(u.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var d=0;d<u[u.length-1].length;d++)if(u[u.length-1][d]!==u[0][d])throw new Error("First and last Position are not equivalent.")}var _={type:"Polygon",coordinates:e};return Gn(_,n,r)}function qi(e,n,r){return r===void 0&&(r={}),ma(e.map(function(i){return Oi(i,n)}),r)}function ca(e,n,r){if(r===void 0&&(r={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");var i={type:"LineString",coordinates:e};return Gn(i,n,r)}function Ci(e,n,r){return r===void 0&&(r={}),ma(e.map(function(i){return ca(i,n)}),r)}function ma(e,n){n===void 0&&(n={});var r={type:"FeatureCollection"};return n.id&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.features=e,r}function Xn(e,n,r){r===void 0&&(r={});var i={type:"MultiLineString",coordinates:e};return Gn(i,n,r)}function bi(e,n,r){r===void 0&&(r={});var i={type:"MultiPoint",coordinates:e};return Gn(i,n,r)}function Ni(e,n,r){r===void 0&&(r={});var i={type:"MultiPolygon",coordinates:e};return Gn(i,n,r)}function Ki(e,n,r){r===void 0&&(r={});var i={type:"GeometryCollection",geometries:e};return Gn(i,n,r)}function Oo(e,n){if(n===void 0&&(n=0),n&&!(n>=0))throw new Error("precision must be a positive number");var r=Math.pow(10,n||0);return Math.round(e*r)/r}function he(e,n){n===void 0&&(n="kilometers");var r=Zn[n];if(!r)throw new Error(n+" units is invalid");return e*r}function On(e,n){n===void 0&&(n="kilometers");var r=Zn[n];if(!r)throw new Error(n+" units is invalid");return e/r}function Ua(e,n){return Dt(On(e,n))}function rs(e){var n=e%360;return n<0&&(n+=360),n}function Dt(e){var n=e%(2*Math.PI);return n*180/Math.PI}function tr(e){var n=e%360;return n*Math.PI/180}function Er(e,n,r){if(n===void 0&&(n="kilometers"),r===void 0&&(r="kilometers"),!(e>=0))throw new Error("length must be a positive number");return he(On(e,n),r)}function $r(e,n,r){if(n===void 0&&(n="meters"),r===void 0&&(r="kilometers"),!(e>=0))throw new Error("area must be a positive number");var i=fi[n];if(!i)throw new Error("invalid original units");var o=fi[r];if(!o)throw new Error("invalid final units");return e/i*o}function xn(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function Dn(e){return!!e&&e.constructor===Object}function pi(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(e.length!==4&&e.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach(function(n){if(!xn(n))throw new Error("bbox must only contain numbers")})}function qn(e){if(!e)throw new Error("id is required");if(["string","number"].indexOf(typeof e)===-1)throw new Error("id must be a number or a string")}function on(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return e.geometry.coordinates;if(e.type==="Point")return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Ri(e){if(Array.isArray(e))return e;if(e.type==="Feature"){if(e.geometry!==null)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Ii(e){if(e.length>1&&isNumber(e[0])&&isNumber(e[1]))return!0;if(Array.isArray(e[0])&&e[0].length)return Ii(e[0]);throw new Error("coordinates must only contain numbers")}function Qa(e,n,r){if(!n||!r)throw new Error("type and name required");if(!e||e.type!==n)throw new Error("Invalid input to "+r+": must be a "+n+", given "+e.type)}function hs(e,n,r){if(!e)throw new Error("No feature passed");if(!r)throw new Error(".featureOf() requires a name");if(!e||e.type!=="Feature"||!e.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!e.geometry||e.geometry.type!==n)throw new Error("Invalid input to "+r+": must be a "+n+", given "+e.geometry.type)}function Zo(e,n,r){if(!e)throw new Error("No featureCollection passed");if(!r)throw new Error(".collectionOf() requires a name");if(!e||e.type!=="FeatureCollection")throw new Error("Invalid input to "+r+", FeatureCollection required");for(var i=0,o=e.features;i<o.length;i++){var u=o[i];if(!u||u.type!=="Feature"||!u.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!u.geometry||u.geometry.type!==n)throw new Error("Invalid input to "+r+": must be a "+n+", given "+u.geometry.type)}}function Fa(e){return e.type==="Feature"?e.geometry:e}function ba(e,n){return e.type==="FeatureCollection"?"FeatureCollection":e.type==="GeometryCollection"?"GeometryCollection":e.type==="Feature"&&e.geometry!==null?e.geometry.type:e.type}function G(e,n,r){if(e!==null)for(var i,o,u,d,_,x,E,P=0,I=0,D,Z=e.type,re=Z==="FeatureCollection",oe=Z==="Feature",de=re?e.features.length:1,Fe=0;Fe<de;Fe++){E=re?e.features[Fe].geometry:oe?e.geometry:e,D=E?E.type==="GeometryCollection":!1,_=D?E.geometries.length:1;for(var it=0;it<_;it++){var vt=0,xt=0;if(d=D?E.geometries[it]:E,d!==null){x=d.coordinates;var Gt=d.type;switch(P=r&&(Gt==="Polygon"||Gt==="MultiPolygon")?1:0,Gt){case null:break;case"Point":if(n(x,I,Fe,vt,xt)===!1)return!1;I++,vt++;break;case"LineString":case"MultiPoint":for(i=0;i<x.length;i++){if(n(x[i],I,Fe,vt,xt)===!1)return!1;I++,Gt==="MultiPoint"&&vt++}Gt==="LineString"&&vt++;break;case"Polygon":case"MultiLineString":for(i=0;i<x.length;i++){for(o=0;o<x[i].length-P;o++){if(n(x[i][o],I,Fe,vt,xt)===!1)return!1;I++}Gt==="MultiLineString"&&vt++,Gt==="Polygon"&&xt++}Gt==="Polygon"&&vt++;break;case"MultiPolygon":for(i=0;i<x.length;i++){for(xt=0,o=0;o<x[i].length;o++){for(u=0;u<x[i][o].length-P;u++){if(n(x[i][o][u],I,Fe,vt,xt)===!1)return!1;I++}xt++}vt++}break;case"GeometryCollection":for(i=0;i<d.geometries.length;i++)if(G(d.geometries[i],n,r)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function ee(e,n,r,i){var o=r;return G(e,function(u,d,_,x,E){d===0&&r===void 0?o=u:o=n(o,u,d,_,x,E)},i),o}function ae(e,n){var r;switch(e.type){case"FeatureCollection":for(r=0;r<e.features.length&&n(e.features[r].properties,r)!==!1;r++);break;case"Feature":n(e.properties,0);break}}function me(e,n,r){var i=r;return ae(e,function(o,u){u===0&&r===void 0?i=o:i=n(i,o,u)}),i}function Pe(e,n){if(e.type==="Feature")n(e,0);else if(e.type==="FeatureCollection")for(var r=0;r<e.features.length&&n(e.features[r],r)!==!1;r++);}function Ge(e,n,r){var i=r;return Pe(e,function(o,u){u===0&&r===void 0?i=o:i=n(i,o,u)}),i}function tt(e){var n=[];return G(e,function(r){n.push(r)}),n}function ce(e,n){var r,i,o,u,d,_,x,E,P,I,D=0,Z=e.type==="FeatureCollection",re=e.type==="Feature",oe=Z?e.features.length:1;for(r=0;r<oe;r++){for(_=Z?e.features[r].geometry:re?e.geometry:e,E=Z?e.features[r].properties:re?e.properties:{},P=Z?e.features[r].bbox:re?e.bbox:void 0,I=Z?e.features[r].id:re?e.id:void 0,x=_?_.type==="GeometryCollection":!1,d=x?_.geometries.length:1,o=0;o<d;o++){if(u=x?_.geometries[o]:_,u===null){if(n(null,D,E,P,I)===!1)return!1;continue}switch(u.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(n(u,D,E,P,I)===!1)return!1;break}case"GeometryCollection":{for(i=0;i<u.geometries.length;i++)if(n(u.geometries[i],D,E,P,I)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}D++}}function Re(e,n,r){var i=r;return ce(e,function(o,u,d,_,x){u===0&&r===void 0?i=o:i=n(i,o,u,d,_,x)}),i}function mt(e,n){ce(e,function(r,i,o,u,d){var _=r===null?null:r.type;switch(_){case null:case"Point":case"LineString":case"Polygon":return n(Gn(r,o,{bbox:u,id:d}),i,0)===!1?!1:void 0}var x;switch(_){case"MultiPoint":x="Point";break;case"MultiLineString":x="LineString";break;case"MultiPolygon":x="Polygon";break}for(var E=0;E<r.coordinates.length;E++){var P=r.coordinates[E],I={type:x,coordinates:P};if(n(Gn(I,o),i,E)===!1)return!1}})}function hr(e,n,r){var i=r;return mt(e,function(o,u,d){u===0&&d===0&&r===void 0?i=o:i=n(i,o,u,d)}),i}function Ot(e,n){mt(e,function(r,i,o){var u=0;if(!!r.geometry){var d=r.geometry.type;if(!(d==="Point"||d==="MultiPoint")){var _,x=0,E=0,P=0;if(G(r,function(I,D,Z,re,oe){if(_===void 0||i>x||re>E||oe>P){_=I,x=i,E=re,P=oe,u=0;return}var de=lineString([_,I],r.properties);if(n(de,i,o,oe,u)===!1)return!1;u++,_=I})===!1)return!1}}})}function Ft(e,n,r){var i=r,o=!1;return Ot(e,function(u,d,_,x,E){o===!1&&r===void 0?i=u:i=n(i,u,d,_,x,E),o=!0}),i}function pr(e,n){if(!e)throw new Error("geojson is required");mt(e,function(r,i,o){if(r.geometry!==null){var u=r.geometry.type,d=r.geometry.coordinates;switch(u){case"LineString":if(n(r,i,o,0,0)===!1)return!1;break;case"Polygon":for(var _=0;_<d.length;_++)if(n(lineString(d[_],r.properties),i,o,_)===!1)return!1;break}}})}function gn(e,n,r){var i=r;return pr(e,function(o,u,d,_){u===0&&r===void 0?i=o:i=n(i,o,u,d,_)}),i}function un(e,n){if(n=n||{},!isObject(n))throw new Error("options is invalid");var r=n.featureIndex||0,i=n.multiFeatureIndex||0,o=n.geometryIndex||0,u=n.segmentIndex||0,d=n.properties,_;switch(e.type){case"FeatureCollection":r<0&&(r=e.features.length+r),d=d||e.features[r].properties,_=e.features[r].geometry;break;case"Feature":d=d||e.properties,_=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":_=e;break;default:throw new Error("geojson is invalid")}if(_===null)return null;var x=_.coordinates;switch(_.type){case"Point":case"MultiPoint":return null;case"LineString":return u<0&&(u=x.length+u-1),lineString([x[u],x[u+1]],d,n);case"Polygon":return o<0&&(o=x.length+o),u<0&&(u=x[o].length+u-1),lineString([x[o][u],x[o][u+1]],d,n);case"MultiLineString":return i<0&&(i=x.length+i),u<0&&(u=x[i].length+u-1),lineString([x[i][u],x[i][u+1]],d,n);case"MultiPolygon":return i<0&&(i=x.length+i),o<0&&(o=x[i].length+o),u<0&&(u=x[i][o].length-u-1),lineString([x[i][o][u],x[i][o][u+1]],d,n)}throw new Error("geojson is invalid")}function Tt(e,n){if(n=n||{},!isObject(n))throw new Error("options is invalid");var r=n.featureIndex||0,i=n.multiFeatureIndex||0,o=n.geometryIndex||0,u=n.coordIndex||0,d=n.properties,_;switch(e.type){case"FeatureCollection":r<0&&(r=e.features.length+r),d=d||e.features[r].properties,_=e.features[r].geometry;break;case"Feature":d=d||e.properties,_=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":_=e;break;default:throw new Error("geojson is invalid")}if(_===null)return null;var x=_.coordinates;switch(_.type){case"Point":return point(x,d,n);case"MultiPoint":return i<0&&(i=x.length+i),point(x[i],d,n);case"LineString":return u<0&&(u=x.length+u),point(x[u],d,n);case"Polygon":return o<0&&(o=x.length+o),u<0&&(u=x[o].length+u),point(x[o][u],d,n);case"MultiLineString":return i<0&&(i=x.length+i),u<0&&(u=x[i].length+u),point(x[i][u],d,n);case"MultiPolygon":return i<0&&(i=x.length+i),o<0&&(o=x[i].length+o),u<0&&(u=x[i][o].length-u),point(x[i][o][u],d,n)}throw new Error("geojson is invalid")}function Jr(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function Dr(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Jr(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Jr(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function Gr(e,n){var r=[],i={};if(e.features=e.features.filter(function(u){var d=u.geometry;return u!=null&&d&&d.type&&d.coordinates&&d.coordinates.length>0}),Et()(e,!0),e.features.length===0)return{dataArray:[],featureKeys:i};var o=0;return mt(e,function(u,d){var _=Ri(u),x=d,E=Dr(Dr({},u.properties),{},{coordinates:_,_id:x});r.push(E)}),{dataArray:r,featureKeys:i}}function vi(e){var n=131,r=137,i=0;e+="x";for(var o=Math.floor(9007199254740991/r),u=0;u<e.length;u++)i>o&&(i=Math.floor(i/r)),i=i*n+e.charCodeAt(u);return i}function Qr(e){e=e.toString();for(var n=5381,r=e.length;r;)n=n*33^e.charCodeAt(--r);return n>>>0}var An=L(28481),Wi="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function di(e){this.message=e}di.prototype=new Error,di.prototype.name="InvalidCharacterError";function Ti(e){var n=String(e).replace(/=+$/,"");if(n.length%4==1)throw new di("'atob' failed: The string to be decoded is not correctly encoded.");for(var r="",i=0,o,u,d=0;u=n.charAt(d++);~u&&(o=i%4?o*64+u:u,i++%4)?r+=String.fromCharCode(255&o>>(-2*i&6)):0)u=Wi.indexOf(u);return r}function _i(e){e=String(e);for(var n,r,i,o,u="",d=0,_=e.length%3;d<e.length;){if((r=e.charCodeAt(d++))>255||(i=e.charCodeAt(d++))>255||(o=e.charCodeAt(d++))>255)throw new TypeError("Failed to execute 'btoa' on 'Window': The string to be encoded contains characters outside of the Latin1 range.");n=r<<16|i<<8|o,u+=Wi.charAt(n>>18&63)+Wi.charAt(n>>12&63)+Wi.charAt(n>>6&63)+Wi.charAt(n&63)}return _?u.slice(0,_-3)+"===".substring(_):u}var Ct=L(6610),qt=L(5991),Aa=function(){function e(n,r){(0,Ct.Z)(this,e),this.buffers=n,this.type=r}return(0,qt.Z)(e,[{key:"arraybuffer",value:function(){return Promise.resolve(this.buffers[0])}},{key:"stream",value:function(){throw new Error("not implemented")}},{key:"text",value:function(){throw new Error("not implemented")}},{key:"slice",value:function(r,i,o){throw new Error("not implemented")}}]),e}(),Ei;typeof window=="undefined"?Ei={devicePixelRatio:1,navigator:{userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36",browserLanguage:"zh-CN",language:"zh-CN",platform:""},location:"",document:{documentElement:{style:{}},createEvent:function(){return!0},getElementById:function(n){return!0},createElement:function(){return{className:"",classList:{add:function(){return""}}}},createElementNS:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},querySelector:function(){return!1}},performance:{mark:function(n){return null},clearMeasures:function(n){return null},clearMarks:function(n){return null},measure:function(n,r,i){return{duration:0}},now:function(){return new Date().getTime()}},Blob:"",dispatchEvent:function(n){return!0},Event:function(n,r){return!0},createElement:function(){return!0},createElementNS:function(){return!0},XMLHttpRequest:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},requestAnimationFrame:function(){return!0},cancelAnimationFrame:function(){return!0},clearTimeout:function(){return!0}}:Ei=window;var Ai=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",Bi=Ai?my.getSystemInfoSync().pixelRatio:Ei.devicePixelRatio,Yr=L(10379),wn=L(46070),zt=L(77608),aa=function e(n,r){(0,Ct.Z)(this,e),(0,C.Z)(this,"cancelBubble",void 0),(0,C.Z)(this,"cancelable",void 0),(0,C.Z)(this,"target",void 0),(0,C.Z)(this,"currentTarget",void 0),(0,C.Z)(this,"preventDefault",void 0),(0,C.Z)(this,"stopPropagation",void 0),(0,C.Z)(this,"type",void 0),(0,C.Z)(this,"timeStamp",void 0),this.cancelBubble=!1,this.cancelable=!1,this.target=null,this.currentTarget=null,this.preventDefault=function(){},this.stopPropagation=function(){},this.type=n,this.timeStamp=Date.now()},be=L(63349);function Ko(e,n){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=ea(e))||n&&e&&typeof e.length=="number"){r&&(e=r);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(E){throw E},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var u=!0,d=!1,_;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return u=E.done,E},e:function(E){d=!0,_=E},f:function(){try{!u&&r.return!=null&&r.return()}finally{if(d)throw _}}}}function ea(e,n){if(!!e){if(typeof e=="string")return hu(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return hu(e,n)}}function hu(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}var Na=new WeakMap,Ma=function(){function e(){(0,Ct.Z)(this,e),Na.set(this,{})}return(0,qt.Z)(e,[{key:"addEventListener",value:function(r,i){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},u=Na.get(this);u||(u={}),u[r]||(u[r]=[]),u[r].push(i),Na.set(this,u),o.capture,o.once,o.passive}},{key:"removeEventListener",value:function(r,i){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},u=Na.get(this);if(u){var d=u[r];if(d&&d.length>0){for(var _=d.length;_--;_>0)if(d[_]===i){d.splice(_,1);break}}}}},{key:"dispatchEvent",value:function(r){var i=Na.get(this)[r.type];if(i){var o=Ko(i),u;try{for(o.s();!(u=o.n()).done;){var d=u.value;d(r)}}catch(_){o.e(_)}finally{o.f()}}}}]),e}();function Wa(e){var n=oa();return function(){var i=(0,zt.Z)(e),o;if(n){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,wn.Z)(this,o)}}function oa(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Eo=function(e){(0,Yr.Z)(r,e);var n=Wa(r);function r(){var i;return(0,Ct.Z)(this,r),i=n.call(this),(0,C.Z)((0,be.Z)(i),"childNodes",void 0),i.childNodes=[],i}return(0,qt.Z)(r,[{key:"appendChild",value:function(o){this.childNodes.push(o)}},{key:"cloneNode",value:function(){var o=Object.create(this);return Object.assign(o,this),o}},{key:"removeChild",value:function(o){var u=this.childNodes.findIndex(function(d){return d===o});return u>-1?this.childNodes.splice(u,1):null}}]),r}(Ma);function Vo(e){var n=bu();return function(){var i=(0,zt.Z)(e),o;if(n){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,wn.Z)(this,o)}}function bu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var co=function(e){(0,Yr.Z)(r,e);var n=Vo(r);function r(){var i;return(0,Ct.Z)(this,r),i=n.call(this),(0,C.Z)((0,be.Z)(i),"className",void 0),(0,C.Z)((0,be.Z)(i),"children",void 0),i.className="",i.children=[],i}return(0,qt.Z)(r,[{key:"setAttribute",value:function(o,u){this[o]=u}},{key:"getAttribute",value:function(o){return this[o]}},{key:"setAttributeNS",value:function(o,u){this[o]=u}},{key:"getAttributeNS",value:function(o){return this[o]}}]),r}(Eo),Ro=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",sa,Xa,Lo,Ya;if(Ro){var Ps=my.getSystemInfoSync();sa=Ps.screenWidth,Xa=Ps.screenHeight,Lo=Ps.windowWidth,Ya=Ps.windowHeight}else{var Cl=Ei.innerWidth,ps=Ei.innerHeight;sa=Cl,Xa=ps,Lo=Cl,Ya=ps}var ie={width:sa,height:Xa,availWidth:Lo,availHeight:Ya,availLeft:0,availTop:0},xe=ie.availWidth,Ke=ie.availHeight,Mt={style:[]};function Pr(e,n){if(!("parentNode"in e)){var r;n===0?r=function(){return null}:n===1?r=function(){return Mt}:r=function(){return null},Object.defineProperty(e,"parentNode",{enumerable:!0,get:r})}if(!("parentElement"in e)){var i;n===0?i=function(){return null}:n===1?i=function(){return Mt}:i=function(){return null},Object.defineProperty(e,"parentElement",{enumerable:!0,get:i})}}function Tn(e){e.style=e.style||{},Object.assign(e.style,{top:"0px",left:"0px",width:xe+"px",height:Ke+"px",margin:"0px",padding:"0px"})}function Mi(e){"clientLeft"in e||(e.clientLeft=0,e.clientTop=0),"clientWidth"in e||(e.clientWidth=xe,e.clientHeight=Ke),"getBoundingClientRect"in e||(e.getBoundingClientRect=function(){var n={x:0,y:0,top:0,left:0,width:this.clientWidth,height:this.clientHeight,right:this.clientWidth,bottom:this.clientHeight};return n})}function eo(e){"offsetLeft"in e||(e.offsetLeft=0,e.offsetTop=0),"offsetWidth"in e||(e.offsetWidth=xe,e.offsetHeight=Ke)}function La(e){"scrollLeft"in e||(e.scrollLeft=0,e.scrollTop=0),"scrollWidth"in e||(e.scrollWidth=xe,e.scrollHeight=Ke)}function Ba(e){var n=function(){return!0};e.classList=[],e.classList.add=n,e.classList.remove=n,e.classList.contains=n,e.classList.toggle=n}function jo(e){var n=ds();return function(){var i=(0,zt.Z)(e),o;if(n){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,wn.Z)(this,o)}}function ds(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function ao(){}var So=function(e){(0,Yr.Z)(r,e);var n=jo(r);function r(){var i,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",u=arguments.length>1?arguments[1]:void 0;return(0,Ct.Z)(this,r),i=n.call(this),(0,C.Z)((0,be.Z)(i),"className",void 0),(0,C.Z)((0,be.Z)(i),"children",void 0),(0,C.Z)((0,be.Z)(i),"focus",void 0),(0,C.Z)((0,be.Z)(i),"blur",void 0),(0,C.Z)((0,be.Z)(i),"insertBefore",void 0),(0,C.Z)((0,be.Z)(i),"appendChild",void 0),(0,C.Z)((0,be.Z)(i),"removeChild",void 0),(0,C.Z)((0,be.Z)(i),"remove",void 0),(0,C.Z)((0,be.Z)(i),"innerHTML",void 0),(0,C.Z)((0,be.Z)(i),"tagName",void 0),i.className="",i.children=[],i.focus=ao,i.blur=ao,i.insertBefore=ao,i.appendChild=ao,i.removeChild=ao,i.remove=ao,i.innerHTML="",i.tagName=o.toUpperCase(),Pr((0,be.Z)(i),u),Tn((0,be.Z)(i)),Ba((0,be.Z)(i)),Mi((0,be.Z)(i)),eo((0,be.Z)(i)),La((0,be.Z)(i)),i}return r}(co);function vs(e){var n=Is();return function(){var i=(0,zt.Z)(e),o;if(n){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,wn.Z)(this,o)}}function Is(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ks=function(e){(0,Yr.Z)(r,e);var n=vs(r);function r(i){return(0,Ct.Z)(this,r),n.call(this,i)}return(0,qt.Z)(r,[{key:"addTextTrack",value:function(){}},{key:"captureStream",value:function(){}},{key:"fastSeek",value:function(){}},{key:"load",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}]),r}(So);function $s(e){var n=ms();return function(){var i=(0,zt.Z)(e),o;if(n){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,wn.Z)(this,o)}}function ms(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ga=function(e){(0,Yr.Z)(r,e);var n=$s(r);function r(){return(0,Ct.Z)(this,r),n.call(this,"video")}return r}(ks),_a={},ns={};function Jc(e,n){_a=e,_a.id=n,"tagName"in _a||(_a.tagName="CANVAS"),_a.type="canvas",Mixin.parentNode(_a),Mixin.style(_a),Mixin.classList(_a),Mixin.clientRegion(_a),Mixin.offsetRegion(_a),_a.focus=function(){},_a.blur=function(){}}function Tl(e,n){var r=1024,i=1024;ns={width:r,height:i,clientWidth:r/devicePixelRatio,clientHeight:i/devicePixelRatio,id:n,type:"canvas"},"tagName"in ns||(ns.tagName="CANVAS"),Mixin.parentNode(ns),Mixin.style(ns),Mixin.classList(ns),Mixin.clientRegion(ns),Mixin.offsetRegion(ns),ns.getContext=function(o){if(o==="2d")return e},ns.focus=function(){},ns.blur=function(){}}function Zs(){return _a}function nc(){return ns}var Gu=function e(){(0,Ct.Z)(this,e);var n=Zs(),r=n.createImage&&n.createImage()||{};return"tagName"in r||(r.tagName="IMG",r.__proto__=e.prototype),Pr(r),Ba(r),Object.assign(r,{addEventListener:function(o,u){r["on".concat(o)]=u.bind(r)},removeEventListener:function(o){r["on".concat(o)]=null}}),r},Vs={href:"",protocol:"",host:""};function ul(e){var n=y();return function(){var i=(0,zt.Z)(e),o;if(n){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,wn.Z)(this,o)}}function y(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var T=function(e){(0,Yr.Z)(r,e);var n=ul(r);function r(){return(0,Ct.Z)(this,r),n.call(this,"body",0)}return(0,qt.Z)(r,[{key:"addEventListener",value:function(o,u){var d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}}},{key:"removeEventListener",value:function(o,u,d){}},{key:"dispatchEvent",value:function(o){}}]),r}(So),N=function(e){(0,Yr.Z)(r,e);var n=ul(r);function r(){return(0,Ct.Z)(this,r),n.call(this,"html",0)}return(0,qt.Z)(r,[{key:"addEventListener",value:function(o,u){var d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}}},{key:"removeEventListener",value:function(o,u){}},{key:"dispatchEvent",value:function(o){}}]),r}(So),O={},$={readyState:"complete",visibilityState:"visible",hidden:!1,fullscreen:!0,scripts:[],style:{},location:Vs,ontouchstart:null,ontouchmove:null,ontouchend:null,onvisibilitychange:null,parentNode:null,parentElement:null,head:null,body:null,documentElement:{style:[]},createElement:function(n){return n=n.toLowerCase(),n==="canvas"?my.createOffscreenCanvas(1024,128,"2d"):n==="img"?new Gu:n==="video"?new ga:new So(n)},createElementNS:function(n,r){return this.createElement(r)},createTextNode:function(n){return n},getElementById:function(n){return null},getElementsByTagName:function(n){return n=n.toLowerCase(),[]},getElementsByTagNameNS:function(n,r){return this.getElementsByTagName(r)},getElementsByName:function(n){return[]},querySelector:function(n){return null},querySelectorAll:function(n){return[]},addEventListener:function(n,r,i){O[n]||(O[n]=[]),O[n].push(r)},removeEventListener:function(n,r){var i=O[n];if(i&&i.length>0){for(var o=i.length;o--;o>0)if(i[o]===r){i.splice(o,1);break}}},dispatchEvent:function(n){var r=n.type,i=O[r];if(i)for(var o=0;o<i.length;o++)i[o](n);n.target&&typeof n.target["on"+r]=="function"&&n.target["on"+r](n)},createEvent:function(n){return new aa(n)}};$.documentElement=new N,$.head=new So("head"),$.body=new T;var _e=Object,Xe=L(90484),ht=function(){function e(){(0,Ct.Z)(this,e),(0,C.Z)(this,"_w",void 0),(0,C.Z)(this,"_h",void 0),(0,C.Z)(this,"_data",void 0);var n=arguments.length;if(n===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){this._w=arguments[0],this._h=arguments[1],this._data=new Uint8ClampedArray(this._w*this._h*4);return}}else n===3&&(0,Xe.Z)(arguments[0])==="object"&&typeof arguments[1]=="number"&&typeof arguments[2]=="number"&&(this._data=arguments[0],this._w=arguments[1],this._h=arguments[2]);throw new Error("ImageData: params error")}return(0,qt.Z)(e,[{key:"width",get:function(){return this._w}},{key:"height",get:function(){return this._h}},{key:"data",get:function(){return this._data}}]),e}(),dt=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",ir,sr,Cn;if(dt){var ni=my.getSystemInfoSync();ir=ni.system,sr=ni.platform,Cn=ni.language}else{var In={versions:function(){var e=Ei.navigator.userAgent;return{trident:e.indexOf("Trident")>-1,presto:e.indexOf("Presto")>-1,webKit:e.indexOf("AppleWebKit")>-1,gecko:e.indexOf("Gecko")>-1&&e.indexOf("KHTML")===-1,mobile:!!e.match(/AppleWebKit.*Mobile.*/),ios:!!e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:e.indexOf("Android")>-1||e.indexOf("Linux")>-1,iPhone:e.indexOf("iPhone")>-1,iPad:e.indexOf("iPad")>-1,webApp:e.indexOf("Safari")===-1,weixin:e.indexOf("MicroMessenger")>-1,qq:e.match(/\sQQ/i)===" qq"}}(),language:(Ei.navigator.browserLanguage||Ei.navigator.language).toLowerCase()};In.versions.android?sr="android":In.versions.trident?sr="IE":In.versions.presto?sr="Opera":In.versions.webKit?sr="webKit":In.versions.gecko?sr="Firefox":In.versions.mobile?sr="mobile":In.versions.ios?sr="ios":In.versions.iPhone?sr="iPhone":In.versions.iPad?sr="ipad":In.versions.webApp?sr="webApp":In.versions.weixin?sr="weixin":In.versions.qq&&(sr="qq"),ir=Ei.navigator.userAgent,Cn=In.language}var Xi=ir.toLowerCase().indexOf("android")!==-1,va=Xi?"Android; CPU Android 6.0":"iPhone; CPU iPhone OS 10_3_1 like Mac OS X",wa="Mozilla/5.0 (".concat(va,") AppleWebKit/603.1.30 (KHTML, like Gecko) Mobile/14E8301 MicroMessenger/6.6.0 MiniGame NetType/WIFI Language/").concat(Cn),ji={platform:sr,language:Cn,appVersion:"5.0 (".concat(va,") AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13B143 Safari/601.1"),userAgent:wa},gs={mark:function(n){return null},clearMeasures:function(n){return null},clearMarks:function(n){return null},measure:function(n,r,i){return{duration:0}},now:function(){}},Js=0,Hu=0;function Qc(e){var n=Date.now(),r=Math.max(Js+23,n);return Hu=setTimeout(function(){e(Js=r)},r-n),Hu}function ll(e){var n=Zs();return n.requestAnimationFrame?n.requestAnimationFrame(e):Qc(e)}function Oc(e){var n=Zs();return n.cancelAnimationFrame?n.cancelAnimationFrame(e):clearTimeout(e)}var Eu=function(){function e(n){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if((0,Ct.Z)(this,e),(0,C.Z)(this,"href",void 0),n.indexOf("http://")==0||n.indexOf("https://")==0){this.href=n;return}this.href=r+n}return(0,qt.Z)(e,null,[{key:"createObjectURL",value:function(r){var i=r.buffers[0],o=r.type,u=Su(i),d="data:".concat(o,";base64, ");return d+u}}]),e}();function Su(e){for(var n="",r=new Uint8Array(e),i=r.byteLength,o=0;o<i;o++)n+=String.fromCharCode(r[o]);return _i(n)}var wu={GCCSO_SHADER_BINARY_FJ:37472,_3DC_XY_AMD:34810,_3DC_X_AMD:34809,ACTIVE_ATTRIBUTES:35721,ACTIVE_ATTRIBUTE_MAX_LENGTH:35722,ACTIVE_PROGRAM_EXT:33369,ACTIVE_TEXTURE:34016,ACTIVE_UNIFORMS:35718,ACTIVE_UNIFORM_MAX_LENGTH:35719,ALIASED_LINE_WIDTH_RANGE:33902,ALIASED_POINT_SIZE_RANGE:33901,ALL_COMPLETED_NV:34034,ALL_SHADER_BITS_EXT:4294967295,ALPHA:6406,ALPHA16F_EXT:34844,ALPHA32F_EXT:34838,ALPHA8_EXT:32828,ALPHA8_OES:32828,ALPHA_BITS:3413,ALPHA_TEST_FUNC_QCOM:3009,ALPHA_TEST_QCOM:3008,ALPHA_TEST_REF_QCOM:3010,ALREADY_SIGNALED_APPLE:37146,ALWAYS:519,AMD_compressed_3DC_texture:1,AMD_compressed_ATC_texture:1,AMD_performance_monitor:1,AMD_program_binary_Z400:1,ANGLE_depth_texture:1,ANGLE_framebuffer_blit:1,ANGLE_framebuffer_multisample:1,ANGLE_instanced_arrays:1,ANGLE_pack_reverse_row_order:1,ANGLE_program_binary:1,ANGLE_texture_compression_dxt3:1,ANGLE_texture_compression_dxt5:1,ANGLE_texture_usage:1,ANGLE_translated_shader_source:1,ANY_SAMPLES_PASSED_CONSERVATIVE_EXT:36202,ANY_SAMPLES_PASSED_EXT:35887,APPLE_copy_texture_levels:1,APPLE_framebuffer_multisample:1,APPLE_rgb_422:1,APPLE_sync:1,APPLE_texture_format_BGRA8888:1,APPLE_texture_max_level:1,ARM_mali_program_binary:1,ARM_mali_shader_binary:1,ARM_rgba8:1,ARRAY_BUFFER:34962,ARRAY_BUFFER_BINDING:34964,ATC_RGBA_EXPLICIT_ALPHA_AMD:35987,ATC_RGBA_INTERPOLATED_ALPHA_AMD:34798,ATC_RGB_AMD:35986,ATTACHED_SHADERS:35717,BACK:1029,BGRA8_EXT:37793,BGRA_EXT:32993,BGRA_IMG:32993,BINNING_CONTROL_HINT_QCOM:36784,BLEND:3042,BLEND_COLOR:32773,BLEND_DST_ALPHA:32970,BLEND_DST_RGB:32968,BLEND_EQUATION:32777,BLEND_EQUATION_ALPHA:34877,BLEND_EQUATION_RGB:32777,BLEND_SRC_ALPHA:32971,BLEND_SRC_RGB:32969,BLUE_BITS:3412,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,BUFFER:33504,BUFFER_ACCESS_OES:35003,BUFFER_MAPPED_OES:35004,BUFFER_MAP_POINTER_OES:35005,BUFFER_OBJECT_EXT:37201,BUFFER_SIZE:34660,BUFFER_USAGE:34661,BYTE:5120,CCW:2305,CLAMP_TO_BORDER_NV:33069,CLAMP_TO_EDGE:33071,COLOR_ATTACHMENT0:36064,COLOR_ATTACHMENT0_NV:36064,COLOR_ATTACHMENT10_NV:36074,COLOR_ATTACHMENT11_NV:36075,COLOR_ATTACHMENT12_NV:36076,COLOR_ATTACHMENT13_NV:36077,COLOR_ATTACHMENT14_NV:36078,COLOR_ATTACHMENT15_NV:36079,COLOR_ATTACHMENT1_NV:36065,COLOR_ATTACHMENT2_NV:36066,COLOR_ATTACHMENT3_NV:36067,COLOR_ATTACHMENT4_NV:36068,COLOR_ATTACHMENT5_NV:36069,COLOR_ATTACHMENT6_NV:36070,COLOR_ATTACHMENT7_NV:36071,COLOR_ATTACHMENT8_NV:36072,COLOR_ATTACHMENT9_NV:36073,COLOR_ATTACHMENT_EXT:37104,COLOR_BUFFER_BIT:16384,COLOR_BUFFER_BIT0_QCOM:1,COLOR_BUFFER_BIT1_QCOM:2,COLOR_BUFFER_BIT2_QCOM:4,COLOR_BUFFER_BIT3_QCOM:8,COLOR_BUFFER_BIT4_QCOM:16,COLOR_BUFFER_BIT5_QCOM:32,COLOR_BUFFER_BIT6_QCOM:64,COLOR_BUFFER_BIT7_QCOM:128,COLOR_CLEAR_VALUE:3106,COLOR_EXT:6144,COLOR_WRITEMASK:3107,COMPARE_REF_TO_TEXTURE_EXT:34894,COMPILE_STATUS:35713,COMPRESSED_RGBA_ASTC_10x10_KHR:37819,COMPRESSED_RGBA_ASTC_10x5_KHR:37816,COMPRESSED_RGBA_ASTC_10x6_KHR:37817,COMPRESSED_RGBA_ASTC_10x8_KHR:37818,COMPRESSED_RGBA_ASTC_12x10_KHR:37820,COMPRESSED_RGBA_ASTC_12x12_KHR:37821,COMPRESSED_RGBA_ASTC_4x4_KHR:37808,COMPRESSED_RGBA_ASTC_5x4_KHR:37809,COMPRESSED_RGBA_ASTC_5x5_KHR:37810,COMPRESSED_RGBA_ASTC_6x5_KHR:37811,COMPRESSED_RGBA_ASTC_6x6_KHR:37812,COMPRESSED_RGBA_ASTC_8x5_KHR:37813,COMPRESSED_RGBA_ASTC_8x6_KHR:37814,COMPRESSED_RGBA_ASTC_8x8_KHR:37815,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGBA_PVRTC_2BPPV2_IMG:37175,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGBA_PVRTC_4BPPV2_IMG:37176,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_ANGLE:33778,COMPRESSED_RGBA_S3TC_DXT5_ANGLE:33779,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:37853,COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:37847,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_NV:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_NV:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_NV:35919,COMPRESSED_SRGB_S3TC_DXT1_NV:35916,COMPRESSED_TEXTURE_FORMATS:34467,CONDITION_SATISFIED_APPLE:37148,CONSTANT_ALPHA:32771,CONSTANT_COLOR:32769,CONTEXT_FLAG_DEBUG_BIT:2,CONTEXT_ROBUST_ACCESS_EXT:37107,COUNTER_RANGE_AMD:35777,COUNTER_TYPE_AMD:35776,COVERAGE_ALL_FRAGMENTS_NV:36565,COVERAGE_ATTACHMENT_NV:36562,COVERAGE_AUTOMATIC_NV:36567,COVERAGE_BUFFERS_NV:36563,COVERAGE_BUFFER_BIT_NV:32768,COVERAGE_COMPONENT4_NV:36561,COVERAGE_COMPONENT_NV:36560,COVERAGE_EDGE_FRAGMENTS_NV:36566,COVERAGE_SAMPLES_NV:36564,CPU_OPTIMIZED_QCOM:36785,CULL_FACE:2884,CULL_FACE_MODE:2885,CURRENT_PROGRAM:35725,CURRENT_QUERY_EXT:34917,CURRENT_VERTEX_ATTRIB:34342,CW:2304,DEBUG_CALLBACK_FUNCTION:33348,DEBUG_CALLBACK_USER_PARAM:33349,DEBUG_GROUP_STACK_DEPTH:33389,DEBUG_LOGGED_MESSAGES:37189,DEBUG_NEXT_LOGGED_MESSAGE_LENGTH:33347,DEBUG_OUTPUT:37600,DEBUG_OUTPUT_SYNCHRONOUS:33346,DEBUG_SEVERITY_HIGH:37190,DEBUG_SEVERITY_LOW:37192,DEBUG_SEVERITY_MEDIUM:37191,DEBUG_SEVERITY_NOTIFICATION:33387,DEBUG_SOURCE_API:33350,DEBUG_SOURCE_APPLICATION:33354,DEBUG_SOURCE_OTHER:33355,DEBUG_SOURCE_SHADER_COMPILER:33352,DEBUG_SOURCE_THIRD_PARTY:33353,DEBUG_SOURCE_WINDOW_SYSTEM:33351,DEBUG_TYPE_DEPRECATED_BEHAVIOR:33357,DEBUG_TYPE_ERROR:33356,DEBUG_TYPE_MARKER:33384,DEBUG_TYPE_OTHER:33361,DEBUG_TYPE_PERFORMANCE:33360,DEBUG_TYPE_POP_GROUP:33386,DEBUG_TYPE_PORTABILITY:33359,DEBUG_TYPE_PUSH_GROUP:33385,DEBUG_TYPE_UNDEFINED_BEHAVIOR:33358,DECR:7683,DECR_WRAP:34056,DELETE_STATUS:35712,DEPTH24_STENCIL8_OES:35056,DEPTH_ATTACHMENT:36096,DEPTH_STENCIL_ATTACHMENT:33306,DEPTH_BITS:3414,DEPTH_BUFFER_BIT:256,DEPTH_BUFFER_BIT0_QCOM:256,DEPTH_BUFFER_BIT1_QCOM:512,DEPTH_BUFFER_BIT2_QCOM:1024,DEPTH_BUFFER_BIT3_QCOM:2048,DEPTH_BUFFER_BIT4_QCOM:4096,DEPTH_BUFFER_BIT5_QCOM:8192,DEPTH_BUFFER_BIT6_QCOM:16384,DEPTH_BUFFER_BIT7_QCOM:32768,DEPTH_CLEAR_VALUE:2931,DEPTH_COMPONENT:6402,DEPTH_COMPONENT16:33189,DEPTH_COMPONENT16_NONLINEAR_NV:36396,DEPTH_COMPONENT16_OES:33189,DEPTH_COMPONENT24_OES:33190,DEPTH_COMPONENT32_OES:33191,DEPTH_EXT:6145,DEPTH_FUNC:2932,DEPTH_RANGE:2928,DEPTH_STENCIL:34041,DEPTH_STENCIL_OES:34041,DEPTH_TEST:2929,DEPTH_WRITEMASK:2930,DITHER:3024,DMP_shader_binary:1,DONT_CARE:4352,DRAW_BUFFER0_NV:34853,DRAW_BUFFER10_NV:34863,DRAW_BUFFER11_NV:34864,DRAW_BUFFER12_NV:34865,DRAW_BUFFER13_NV:34866,DRAW_BUFFER14_NV:34867,DRAW_BUFFER15_NV:34868,DRAW_BUFFER1_NV:34854,DRAW_BUFFER2_NV:34855,DRAW_BUFFER3_NV:34856,DRAW_BUFFER4_NV:34857,DRAW_BUFFER5_NV:34858,DRAW_BUFFER6_NV:34859,DRAW_BUFFER7_NV:34860,DRAW_BUFFER8_NV:34861,DRAW_BUFFER9_NV:34862,DRAW_BUFFER_EXT:3073,DRAW_FRAMEBUFFER_ANGLE:36009,DRAW_FRAMEBUFFER_APPLE:36009,DRAW_FRAMEBUFFER_BINDING_ANGLE:36006,DRAW_FRAMEBUFFER_BINDING_APPLE:36006,DRAW_FRAMEBUFFER_BINDING_NV:36006,DRAW_FRAMEBUFFER_NV:36009,DST_ALPHA:772,DST_COLOR:774,DYNAMIC_DRAW:35048,ELEMENT_ARRAY_BUFFER:34963,ELEMENT_ARRAY_BUFFER_BINDING:34965,EQUAL:514,ES_VERSION_2_0:1,ETC1_RGB8_OES:36196,ETC1_SRGB8_NV:35054,EXTENSIONS:7939,EXT_blend_minmax:1,EXT_color_buffer_half_float:1,EXT_debug_label:1,EXT_debug_marker:1,EXT_discard_framebuffer:1,EXT_map_buffer_range:1,EXT_multi_draw_arrays:1,EXT_multisampled_render_to_texture:1,EXT_multiview_draw_buffers:1,EXT_occlusion_query_boolean:1,EXT_read_format_bgra:1,EXT_robustness:1,EXT_sRGB:1,EXT_separate_shader_objects:1,EXT_shader_framebuffer_fetch:1,EXT_shader_texture_lod:1,EXT_shadow_samplers:1,EXT_texture_compression_dxt1:1,EXT_texture_filter_anisotropic:1,EXT_texture_format_BGRA8888:1,EXT_texture_rg:1,EXT_texture_storage:1,EXT_texture_type_2_10_10_10_REV:1,EXT_unpack_subimage:1,FALSE:0,FASTEST:4353,FENCE_CONDITION_NV:34036,FENCE_STATUS_NV:34035,FIXED:5132,FJ_shader_binary_GCCSO:1,FLOAT:5126,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,FRAGMENT_SHADER:35632,FRAGMENT_SHADER_BIT_EXT:2,FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723,FRAGMENT_SHADER_DISCARDS_SAMPLES_EXT:35410,FRAMEBUFFER:36160,FRAMEBUFFER_ATTACHMENT_ANGLE:37795,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT:33297,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_TEXTURE_3D_ZOFFSET_OES:36052,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_SAMPLES_EXT:36204,FRAMEBUFFER_BINDING:36006,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_ANGLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_APPLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_EXT:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_IMG:37172,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_NV:36182,FRAMEBUFFER_UNDEFINED_OES:33305,FRAMEBUFFER_UNSUPPORTED:36061,FRONT:1028,FRONT_AND_BACK:1032,FRONT_FACE:2886,FUNC_ADD:32774,FUNC_REVERSE_SUBTRACT:32779,FUNC_SUBTRACT:32778,GENERATE_MIPMAP_HINT:33170,GEQUAL:518,GPU_OPTIMIZED_QCOM:36786,GREATER:516,GREEN_BITS:3411,GUILTY_CONTEXT_RESET_EXT:33363,HALF_FLOAT_OES:36193,HIGH_FLOAT:36338,HIGH_INT:36341,IMG_multisampled_render_to_texture:1,IMG_program_binary:1,IMG_read_format:1,IMG_shader_binary:1,IMG_texture_compression_pvrtc:1,IMG_texture_compression_pvrtc2:1,IMPLEMENTATION_COLOR_READ_FORMAT:35739,IMPLEMENTATION_COLOR_READ_TYPE:35738,INCR:7682,INCR_WRAP:34055,INFO_LOG_LENGTH:35716,INNOCENT_CONTEXT_RESET_EXT:33364,INT:5124,INT_10_10_10_2_OES:36343,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,INVALID_ENUM:1280,INVALID_FRAMEBUFFER_OPERATION:1286,INVALID_OPERATION:1282,INVALID_VALUE:1281,INVERT:5386,KEEP:7680,KHR_debug:1,KHR_texture_compression_astc_ldr:1,LEFT:1030,LEQUAL:515,LESS:513,LINEAR:9729,LINEAR_MIPMAP_LINEAR:9987,LINEAR_MIPMAP_NEAREST:9985,LINES:1,LINE_LOOP:2,LINE_STRIP:3,LINE_WIDTH:2849,LINK_STATUS:35714,LOSE_CONTEXT_ON_RESET_EXT:33362,LOW_FLOAT:36336,LOW_INT:36339,LUMINANCE:6409,LUMINANCE16F_EXT:34846,LUMINANCE32F_EXT:34840,LUMINANCE4_ALPHA4_OES:32835,LUMINANCE8_ALPHA8_EXT:32837,LUMINANCE8_ALPHA8_OES:32837,LUMINANCE8_EXT:32832,LUMINANCE8_OES:32832,LUMINANCE_ALPHA:6410,LUMINANCE_ALPHA16F_EXT:34847,LUMINANCE_ALPHA32F_EXT:34841,MALI_PROGRAM_BINARY_ARM:36705,MALI_SHADER_BINARY_ARM:36704,MAP_FLUSH_EXPLICIT_BIT_EXT:16,MAP_INVALIDATE_BUFFER_BIT_EXT:8,MAP_INVALIDATE_RANGE_BIT_EXT:4,MAP_READ_BIT_EXT:1,MAP_UNSYNCHRONIZED_BIT_EXT:32,MAP_WRITE_BIT_EXT:2,MAX_3D_TEXTURE_SIZE_OES:32883,MAX_COLOR_ATTACHMENTS_NV:36063,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_CUBE_MAP_TEXTURE_SIZE:34076,MAX_DEBUG_GROUP_STACK_DEPTH:33388,MAX_DEBUG_LOGGED_MESSAGES:37188,MAX_DEBUG_MESSAGE_LENGTH:37187,MAX_DRAW_BUFFERS_NV:34852,MAX_EXT:32776,MAX_FRAGMENT_UNIFORM_VECTORS:36349,MAX_LABEL_LENGTH:33512,MAX_MULTIVIEW_BUFFERS_EXT:37106,MAX_RENDERBUFFER_SIZE:34024,MAX_SAMPLES_ANGLE:36183,MAX_SAMPLES_APPLE:36183,MAX_SAMPLES_EXT:36183,MAX_SAMPLES_IMG:37173,MAX_SAMPLES_NV:36183,MAX_SERVER_WAIT_TIMEOUT_APPLE:37137,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047,MAX_TEXTURE_SIZE:3379,MAX_VARYING_VECTORS:36348,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VIEWPORT_DIMS:3386,MEDIUM_FLOAT:36337,MEDIUM_INT:36340,MIN_EXT:32775,MIRRORED_REPEAT:33648,MULTISAMPLE_BUFFER_BIT0_QCOM:16777216,MULTISAMPLE_BUFFER_BIT1_QCOM:33554432,MULTISAMPLE_BUFFER_BIT2_QCOM:67108864,MULTISAMPLE_BUFFER_BIT3_QCOM:134217728,MULTISAMPLE_BUFFER_BIT4_QCOM:268435456,MULTISAMPLE_BUFFER_BIT5_QCOM:536870912,MULTISAMPLE_BUFFER_BIT6_QCOM:1073741824,MULTISAMPLE_BUFFER_BIT7_QCOM:2147483648,MULTIVIEW_EXT:37105,NEAREST:9728,NEAREST_MIPMAP_LINEAR:9986,NEAREST_MIPMAP_NEAREST:9984,NEVER:512,NICEST:4354,NONE:0,NOTEQUAL:517,NO_ERROR:0,NO_RESET_NOTIFICATION_EXT:33377,NUM_COMPRESSED_TEXTURE_FORMATS:34466,NUM_PROGRAM_BINARY_FORMATS_OES:34814,NUM_SHADER_BINARY_FORMATS:36345,NV_coverage_sample:1,NV_depth_nonlinear:1,NV_draw_buffers:1,NV_draw_instanced:1,NV_fbo_color_attachments:1,NV_fence:1,NV_framebuffer_blit:1,NV_framebuffer_multisample:1,NV_generate_mipmap_sRGB:1,NV_instanced_arrays:1,NV_read_buffer:1,NV_read_buffer_front:1,NV_read_depth:1,NV_read_depth_stencil:1,NV_read_stencil:1,NV_sRGB_formats:1,NV_shadow_samplers_array:1,NV_shadow_samplers_cube:1,NV_texture_border_clamp:1,NV_texture_compression_s3tc_update:1,NV_texture_npot_2D_mipmap:1,OBJECT_TYPE_APPLE:37138,OES_EGL_image:1,OES_EGL_image_external:1,OES_compressed_ETC1_RGB8_texture:1,OES_compressed_paletted_texture:1,OES_depth24:1,OES_depth32:1,OES_depth_texture:1,OES_element_index_uint:1,OES_fbo_render_mipmap:1,OES_fragment_precision_high:1,OES_get_program_binary:1,OES_mapbuffer:1,OES_packed_depth_stencil:1,OES_required_internalformat:1,OES_rgb8_rgba8:1,OES_standard_derivatives:1,OES_stencil1:1,OES_stencil4:1,OES_surfaceless_context:1,OES_texture_3D:1,OES_texture_float:1,OES_texture_float_linear:1,OES_texture_half_float:1,OES_texture_half_float_linear:1,OES_texture_npot:1,OES_vertex_array_object:1,OES_vertex_half_float:1,OES_vertex_type_10_10_10_2:1,ONE:1,ONE_MINUS_CONSTANT_ALPHA:32772,ONE_MINUS_CONSTANT_COLOR:32770,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,OUT_OF_MEMORY:1285,PACK_ALIGNMENT:3333,PACK_REVERSE_ROW_ORDER_ANGLE:37796,PALETTE4_R5_G6_B5_OES:35730,PALETTE4_RGB5_A1_OES:35732,PALETTE4_RGB8_OES:35728,PALETTE4_RGBA4_OES:35731,PALETTE4_RGBA8_OES:35729,PALETTE8_R5_G6_B5_OES:35735,PALETTE8_RGB5_A1_OES:35737,PALETTE8_RGB8_OES:35733,PALETTE8_RGBA4_OES:35736,PALETTE8_RGBA8_OES:35734,PERCENTAGE_AMD:35779,PERFMON_GLOBAL_MODE_QCOM:36768,PERFMON_RESULT_AMD:35782,PERFMON_RESULT_AVAILABLE_AMD:35780,PERFMON_RESULT_SIZE_AMD:35781,POINTS:0,POLYGON_OFFSET_FACTOR:32824,POLYGON_OFFSET_FILL:32823,POLYGON_OFFSET_UNITS:10752,PROGRAM:33506,PROGRAM_BINARY_ANGLE:37798,PROGRAM_BINARY_FORMATS_OES:34815,PROGRAM_BINARY_LENGTH_OES:34625,PROGRAM_OBJECT_EXT:35648,PROGRAM_PIPELINE_BINDING_EXT:33370,PROGRAM_PIPELINE_OBJECT_EXT:35407,PROGRAM_SEPARABLE_EXT:33368,QCOM_alpha_test:1,QCOM_binning_control:1,QCOM_driver_control:1,QCOM_extended_get:1,QCOM_extended_get2:1,QCOM_perfmon_global_mode:1,QCOM_tiled_rendering:1,QCOM_writeonly_rendering:1,QUERY:33507,QUERY_OBJECT_EXT:37203,QUERY_RESULT_AVAILABLE_EXT:34919,QUERY_RESULT_EXT:34918,R16F_EXT:33325,R32F_EXT:33326,R8_EXT:33321,READ_BUFFER_EXT:3074,READ_BUFFER_NV:3074,READ_FRAMEBUFFER_ANGLE:36008,READ_FRAMEBUFFER_APPLE:36008,READ_FRAMEBUFFER_BINDING_ANGLE:36010,READ_FRAMEBUFFER_BINDING_APPLE:36010,READ_FRAMEBUFFER_BINDING_NV:36010,READ_FRAMEBUFFER_NV:36008,RED_BITS:3410,RED_EXT:6403,RENDERBUFFER:36161,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_BINDING:36007,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_SAMPLES_ANGLE:36011,RENDERBUFFER_SAMPLES_APPLE:36011,RENDERBUFFER_SAMPLES_EXT:36011,RENDERBUFFER_SAMPLES_IMG:37171,RENDERBUFFER_SAMPLES_NV:36011,RENDERBUFFER_STENCIL_SIZE:36181,RENDERBUFFER_WIDTH:36162,RENDERER:7937,RENDER_DIRECT_TO_FRAMEBUFFER_QCOM:36787,REPEAT:10497,REPLACE:7681,REQUIRED_TEXTURE_IMAGE_UNITS_OES:36200,RESET_NOTIFICATION_STRATEGY_EXT:33366,RG16F_EXT:33327,RG32F_EXT:33328,RG8_EXT:33323,RGB:6407,RGB10_A2_EXT:32857,RGB10_EXT:32850,RGB16F_EXT:34843,RGB32F_EXT:34837,RGB565:36194,RGB565_OES:36194,RGB5_A1:32855,RGB5_A1_OES:32855,RGB8_OES:32849,RGBA:6408,RGBA16F_EXT:34842,RGBA32F_EXT:34836,RGBA4:32854,RGBA4_OES:32854,RGBA8_OES:32856,RGB_422_APPLE:35359,RG_EXT:33319,RIGHT:1031,SAMPLER:33510,SAMPLER_2D:35678,SAMPLER_2D_ARRAY_SHADOW_NV:36292,SAMPLER_2D_SHADOW_EXT:35682,SAMPLER_3D_OES:35679,SAMPLER_CUBE:35680,SAMPLER_CUBE_SHADOW_NV:36293,SAMPLER_EXTERNAL_OES:36198,SAMPLES:32937,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_BUFFERS:32936,SAMPLE_COVERAGE:32928,SAMPLE_COVERAGE_INVERT:32939,SAMPLE_COVERAGE_VALUE:32938,SCISSOR_BOX:3088,SCISSOR_TEST:3089,SGX_BINARY_IMG:35850,SGX_PROGRAM_BINARY_IMG:37168,SHADER:33505,SHADER_BINARY_DMP:37456,SHADER_BINARY_FORMATS:36344,SHADER_BINARY_VIV:36804,SHADER_COMPILER:36346,SHADER_OBJECT_EXT:35656,SHADER_SOURCE_LENGTH:35720,SHADER_TYPE:35663,SHADING_LANGUAGE_VERSION:35724,SHORT:5122,SIGNALED_APPLE:37145,SLUMINANCE8_ALPHA8_NV:35909,SLUMINANCE8_NV:35911,SLUMINANCE_ALPHA_NV:35908,SLUMINANCE_NV:35910,SRC_ALPHA:770,SRC_ALPHA_SATURATE:776,SRC_COLOR:768,SRGB8_ALPHA8_EXT:35907,SRGB8_NV:35905,SRGB_ALPHA_EXT:35906,SRGB_EXT:35904,STACK_OVERFLOW:1283,STACK_UNDERFLOW:1284,STATE_RESTORE:35804,STATIC_DRAW:35044,STENCIL_ATTACHMENT:36128,STENCIL_BACK_FAIL:34817,STENCIL_BACK_FUNC:34816,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,STENCIL_BITS:3415,STENCIL_BUFFER_BIT:1024,STENCIL_BUFFER_BIT0_QCOM:65536,STENCIL_BUFFER_BIT1_QCOM:131072,STENCIL_BUFFER_BIT2_QCOM:262144,STENCIL_BUFFER_BIT3_QCOM:524288,STENCIL_BUFFER_BIT4_QCOM:1048576,STENCIL_BUFFER_BIT5_QCOM:2097152,STENCIL_BUFFER_BIT6_QCOM:4194304,STENCIL_BUFFER_BIT7_QCOM:8388608,STENCIL_CLEAR_VALUE:2961,STENCIL_EXT:6146,STENCIL_FAIL:2964,STENCIL_FUNC:2962,STENCIL_INDEX1_OES:36166,STENCIL_INDEX4_OES:36167,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_TEST:2960,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STREAM_DRAW:35040,SUBPIXEL_BITS:3408,SYNC_CONDITION_APPLE:37139,SYNC_FENCE_APPLE:37142,SYNC_FLAGS_APPLE:37141,SYNC_FLUSH_COMMANDS_BIT_APPLE:1,SYNC_GPU_COMMANDS_COMPLETE_APPLE:37143,SYNC_OBJECT_APPLE:35411,SYNC_STATUS_APPLE:37140,TEXTURE:5890,TEXTURE0:33984,TEXTURE1:33985,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE2:33986,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE3:33987,TEXTURE30:34014,TEXTURE31:34015,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE_2D:3553,TEXTURE_3D_OES:32879,TEXTURE_BINDING_2D:32873,TEXTURE_BINDING_3D_OES:32874,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_BINDING_EXTERNAL_OES:36199,TEXTURE_BORDER_COLOR_NV:4100,TEXTURE_COMPARE_FUNC_EXT:34893,TEXTURE_COMPARE_MODE_EXT:34892,TEXTURE_CUBE_MAP:34067,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_DEPTH_QCOM:35796,TEXTURE_EXTERNAL_OES:36197,TEXTURE_FORMAT_QCOM:35798,TEXTURE_HEIGHT_QCOM:35795,TEXTURE_IMAGE_VALID_QCOM:35800,TEXTURE_IMMUTABLE_FORMAT_EXT:37167,TEXTURE_INTERNAL_FORMAT_QCOM:35797,TEXTURE_MAG_FILTER:10240,TEXTURE_MAX_ANISOTROPY_EXT:34046,TEXTURE_MAX_LEVEL_APPLE:33085,TEXTURE_MIN_FILTER:10241,TEXTURE_NUM_LEVELS_QCOM:35801,TEXTURE_OBJECT_VALID_QCOM:35803,TEXTURE_SAMPLES_IMG:37174,TEXTURE_TARGET_QCOM:35802,TEXTURE_TYPE_QCOM:35799,TEXTURE_USAGE_ANGLE:37794,TEXTURE_WIDTH_QCOM:35794,TEXTURE_WRAP_R_OES:32882,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TIMEOUT_EXPIRED_APPLE:37147,TIMEOUT_IGNORED_APPLE:18446744073709552e3,TRANSLATED_SHADER_SOURCE_LENGTH_ANGLE:37792,TRIANGLES:4,TRIANGLE_FAN:6,TRIANGLE_STRIP:5,TRUE:1,UNKNOWN_CONTEXT_RESET_EXT:33365,UNPACK_ALIGNMENT:3317,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_PIXELS:3316,UNPACK_SKIP_ROWS:3315,UNSIGNALED_APPLE:37144,UNSIGNED_BYTE:5121,UNSIGNED_INT:5125,UNSIGNED_INT64_AMD:35778,UNSIGNED_INT_10_10_10_2_OES:36342,UNSIGNED_INT_24_8_OES:34042,UNSIGNED_INT_2_10_10_10_REV_EXT:33640,UNSIGNED_NORMALIZED_EXT:35863,UNSIGNED_SHORT:5123,UNSIGNED_SHORT_1_5_5_5_REV_EXT:33638,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_4_4_4_4_REV_EXT:33637,UNSIGNED_SHORT_4_4_4_4_REV_IMG:33637,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,UNSIGNED_SHORT_8_8_APPLE:34234,UNSIGNED_SHORT_8_8_REV_APPLE:34235,VALIDATE_STATUS:35715,VENDOR:7936,VERSION:7938,VERTEX_ARRAY_BINDING_OES:34229,VERTEX_ARRAY_OBJECT_EXT:37204,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,VERTEX_ATTRIB_ARRAY_DIVISOR_NV:35070,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_SHADER:35633,VERTEX_SHADER_BIT_EXT:1,VIEWPORT:2978,VIV_shader_binary:1,WAIT_FAILED_APPLE:37149,WRITEONLY_RENDERING_QCOM:34851,WRITE_ONLY_OES:35001,Z400_BINARY_AMD:34624,ZERO:0,RASTERIZER_DISCARD:35977,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444},oo={};function Bf(e){var n=zf();return function(){var i=(0,zt.Z)(e),o;if(n){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,wn.Z)(this,o)}}function zf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var $o=new Map,Rc=new Map,Cu=new Map,Qs={json:"application/json",text:"application/text",arraybuffer:"application/octet-stream"};function ef(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{target:this};typeof this["on".concat(e)]=="function"&&this["on".concat(e)].call(this,n)}function Al(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{readyState:e};this.readyState=e,ef.call(this,"readystatechange",n)}var Di=function(e){(0,Yr.Z)(r,e);var n=Bf(r);function r(){var i;return(0,Ct.Z)(this,r),i=n.call(this),(0,C.Z)((0,be.Z)(i),"onabort",void 0),(0,C.Z)((0,be.Z)(i),"onerror",void 0),(0,C.Z)((0,be.Z)(i),"onload",void 0),(0,C.Z)((0,be.Z)(i),"onloadstart",void 0),(0,C.Z)((0,be.Z)(i),"onprogress",void 0),(0,C.Z)((0,be.Z)(i),"ontimeout",void 0),(0,C.Z)((0,be.Z)(i),"onloadend",void 0),(0,C.Z)((0,be.Z)(i),"onreadystatechange",void 0),(0,C.Z)((0,be.Z)(i),"readyState",void 0),(0,C.Z)((0,be.Z)(i),"response",void 0),(0,C.Z)((0,be.Z)(i),"responseText",void 0),(0,C.Z)((0,be.Z)(i),"_responseType",void 0),(0,C.Z)((0,be.Z)(i),"responseXML",void 0),(0,C.Z)((0,be.Z)(i),"status",void 0),(0,C.Z)((0,be.Z)(i),"statusText",void 0),(0,C.Z)((0,be.Z)(i),"upload",void 0),(0,C.Z)((0,be.Z)(i),"withCredentials",void 0),(0,C.Z)((0,be.Z)(i),"timeout",void 0),(0,C.Z)((0,be.Z)(i),"_url",void 0),(0,C.Z)((0,be.Z)(i),"_method",void 0),i.onabort=null,i.onerror=null,i.onload=null,i.onloadstart=null,i.onprogress=null,i.ontimeout=null,i.onloadend=null,i.onreadystatechange=null,i.readyState=0,i.response=null,i.responseText=null,i._responseType="text",i.responseXML=null,i.status=0,i.statusText="",i.upload={},i.withCredentials=!1,$o.set("requestHeader",{"content-type":"application/x-www-form-urlencoded"}),i}return(0,qt.Z)(r,[{key:"responseType",set:function(o){this._responseType=o}},{key:"abort",value:function(){var o=Cu.get("requestTask");o&&o.abort()}},{key:"getAllResponseHeaders",value:function(){var o=Rc.get("responseHeader");return Object.keys(o).map(function(u){return"".concat(u,": ").concat(o[u])}).join(`
`)}},{key:"getResponseHeader",value:function(o){return Rc.get("responseHeader")[o]}},{key:"open",value:function(o,u,d){this._method=o,this._url=u}},{key:"overrideMimeType",value:function(){}},{key:"send",value:function(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:""}},{key:"setRequestHeader",value:function(o,u){var d=$o.get("requestHeader");d[o]=u,$o.set("requestHeader",d)}},{key:"addEventListener",value:function(o,u){var d=this;typeof u=="function"&&(this["on"+o]=function(){var _=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};_.target=_.target||d,u.call(d,_)})}},{key:"removeEventListener",value:function(o,u){this["on"+o]===u&&(this["on"+o]=null)}}]),r}(Ma);(0,C.Z)(Di,"UNSEND",void 0),(0,C.Z)(Di,"OPENED",void 0),(0,C.Z)(Di,"HEADERS_RECEIVED",void 0),(0,C.Z)(Di,"LOADING",void 0),(0,C.Z)(Di,"DONE",void 0),Di.UNSEND=0,Di.OPENED=1,Di.HEADERS_RECEIVED=2,Di.LOADING=3,Di.DONE=4;function Ml(e){var n=gh();return function(){var i=(0,zt.Z)(e),o;if(n){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,wn.Z)(this,o)}}function gh(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var cl=function(e){(0,Yr.Z)(r,e);var n=Ml(r);function r(i){var o;return(0,Ct.Z)(this,r),o=n.call(this,i),(0,C.Z)((0,be.Z)(o),"touches",void 0),(0,C.Z)((0,be.Z)(o),"targetTouches",void 0),(0,C.Z)((0,be.Z)(o),"changedTouches",void 0),o.touches=[],o.targetTouches=[],o.changedTouches=[],o.target=Zs(),o.currentTarget=Zs(),o}return r}(aa);function Lc(e){var n=e||{},r=n.x,i=r===void 0?0:r,o=n.y,u=o===void 0?0:o,d=n.clientX,_=d===void 0?0:d,x=n.clientY,E=x===void 0?0:x;Object.keys(e).indexOf("x")!==-1?(e.pageX=e.clientX=i,e.pageY=e.clientY=u):(e.x=_,e.y=E)}function Uf(e){return function(n){var r=new cl(e);r.changedTouches=n.changedTouches,r.touches=n.touches,r.targetTouches=Array.prototype.slice.call(n.touches),r.timeStamp=n.timeStamp,r.changedTouches.forEach(function(i){return Lc(i)}),r.touches.forEach(function(i){return Lc(i)}),r.targetTouches.forEach(function(i){return Lc(i)}),$.dispatchEvent(r)}}function yh(e){return function(n){n.type=e,$.dispatchEvent(n)}}var Zf=Uf("touchstart"),kc=Uf("touchmove"),ic=Uf("touchend"),ac=yh("mapCameaParams");function Pl(e){var n=fl();return function(){var i=(0,zt.Z)(e),o;if(n){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,wn.Z)(this,o)}}function fl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Il=function(e){(0,Yr.Z)(r,e);var n=Pl(r);function r(i){var o;return(0,Ct.Z)(this,r),o=n.call(this,i),(0,C.Z)((0,be.Z)(o),"buttons",void 0),(0,C.Z)((0,be.Z)(o),"which",void 0),(0,C.Z)((0,be.Z)(o),"pointerId",void 0),(0,C.Z)((0,be.Z)(o),"bubbles",void 0),(0,C.Z)((0,be.Z)(o),"button",void 0),(0,C.Z)((0,be.Z)(o),"width",void 0),(0,C.Z)((0,be.Z)(o),"height",void 0),(0,C.Z)((0,be.Z)(o),"pressure",void 0),(0,C.Z)((0,be.Z)(o),"isPrimary",void 0),(0,C.Z)((0,be.Z)(o),"pointerType",void 0),(0,C.Z)((0,be.Z)(o),"altKey",void 0),(0,C.Z)((0,be.Z)(o),"ctrlKey",void 0),(0,C.Z)((0,be.Z)(o),"metaKey",void 0),(0,C.Z)((0,be.Z)(o),"shiftKey",void 0),o.target=Zs(),o.currentTarget=Zs(),o}return r}(aa),Wu=["bubbles","cancelable","view","detail","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget","pointerId","width","height","pressure","tiltX","tiltY","pointerType","hwTimestamp","isPrimary","pageX","pageY","timeStamp"],js=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0,0,0,0,0,0,"",0,!1,0,0,0],tf="touch";function rf(e,n,r){for(var i=new Il(e),o=0;o<Wu.length;o++){var u=Wu[o];i[u]=n[u]||js[o]}return i.type=e,i.target=Zs(),i.currentTarget=Zs(),i.buttons=Vf(e),i.which=i.buttons,i.pointerId=(n.identifier||0)+2,i.bubbles=!0,i.cancelable=!0,i.button=0,i.width=(n.radiusX||.5)*2,i.height=(n.radiusY||.5)*2,i.pressure=n.force||.5,i.isPrimary=oc(n),i.pointerType=tf,i.altKey=r.altKey,i.ctrlKey=r.ctrlKey,i.metaKey=r.metaKey,i.shiftKey=r.shiftKey,r.preventDefault&&(i.preventDefault=function(){r.preventDefault()}),i}function Vf(e){var n=0;return(e==="touchstart"||e==="touchmove"||e==="pointerdown"||e==="pointermove")&&(n=1),n}var eu=null;function oc(e){return eu===e.identifier}function Dc(e){eu===null&&(eu=e.identifier)}function nf(e){eu===e.identifier&&(eu=null)}function Ol(e){return function(n){for(var r=n.changedTouches,i=0;i<r.length;i++){var o=r[i];i===0&&e==="pointerdown"?Dc(o):(e==="pointerup"||e==="pointercancel")&&nf(o);var u=rf(e,o,n);$.dispatchEvent(u)}}}var Jh=Ol("pointerdown"),af=Ol("pointermove"),Rl=Ol("pointerup");function of(e){var n=sf();return function(){var i=(0,zt.Z)(e),o;if(n){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,wn.Z)(this,o)}}function sf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ll=function(e){(0,Yr.Z)(r,e);var n=of(r);function r(i){return(0,Ct.Z)(this,r),n.call(this,i)}return r}(aa);function Fc(e){return function(n){n.type=e,$.dispatchEvent(n)}}var _h=Fc("mousedown"),xh=Fc("mousemove"),sc=Fc("mouseup"),bh=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",kl=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined"),$i=bh||kl,uc={atob:Ti,btoa:_i,devicePixelRatio:Bi,Blob:Aa,document:$,Element:co,Event:aa,EventTarget:Ma,HTMLCanvasElement:_e,HTMLElement:So,HTMLMediaElement:ks,HTMLVideoElement:ga,Image:Gu,ImageData:ht,navigator:ji,Node:Eo,requestAnimationFrame:ll,cancelAnimationFrame:Oc,screen:ie,XMLHttpRequest:Di,performance:gs,URL:Eu,WebGLRenderingContext:wu,WebGL2RenderingContext:oo,addEventListener:function(n,r){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};$.addEventListener(n,r,i)},removeEventListener:function(n,r,i){$.removeEventListener(n,r)},dispatchEvent:function(n){$.dispatchEvent(n)},innerWidth:ie.availWidth,innerHeight:ie.availHeight,setTimeout,clearTimeout,setInterval,clearInterval},fa=$i?uc:Ei,Tu=$i?Di:Ei.XMLHttpRequest,Yi=$i?Vs:Ei.location;function Pa(e){var n=e;return typeof e=="string"&&(n=fa.document.getElementById(e)),n}function ys(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function Nc(e){return ys(e).split(/\s+/)}function Xu(e){var n,r,i=fa==null||(n=fa.document)===null||n===void 0||(r=n.documentElement)===null||r===void 0?void 0:r.style;if(!i)return e[0];for(var o in e)if(e[o]&&e[o]in i)return e[o];return e[0]}function za(e,n,r){var i=fa.document.createElement(e);return i.className=n||"",r&&r.appendChild(i),i}function lc(e){var n=e.parentNode;n&&n.removeChild(e)}function Dl(e,n){if(e.classList!==void 0)for(var r=Nc(n),i=0,o=r.length;i<o;i++)e.classList.add(r[i]);else if(!Bc(e,n)){var u=fo(e);Au(e,(u?u+" ":"")+n)}}function Yu(e,n){e.classList!==void 0?e.classList.remove(n):Au(e,ys((" "+fo(e)+" ").replace(" "+n+" "," ")))}function Bc(e,n){if(e.classList!==void 0)return e.classList.contains(n);var r=fo(e);return r.length>0&&new RegExp("(^|\\s)"+n+"(\\s|$)").test(r)}function Au(e,n){e instanceof HTMLElement?e.className=n:e.className.baseVal=n}function fo(e){return e instanceof SVGElement&&(e=e.correspondingElement),e.className.baseVal===void 0?e.className:e.className.baseVal}function Fl(e){for(;e&&e.firstChild;)e.removeChild(e.firstChild)}var cc=Xu(["transform","WebkitTransform"]);function ho(e,n){e.style[cc]=n}function pn(){if(typeof Event=="function")fa.dispatchEvent(new Event("resize"));else{var e=fa.document.createEvent("UIEvents");e.initUIEvent("resize",!0,!1,fa,0),fa.dispatchEvent(e)}}function so(e){var n=["padding: "+(e.height/2-8)+"px "+e.width/2+"px;","line-height: "+e.height+"px;","background-image: url("+e.toDataURL()+");"];console.log(`%c
`,n.join(""))}function qu(){var e,n=fa.document.querySelector('meta[name="viewport"]');if(!n)return 1;var r=(e=n.content)===null||e===void 0?void 0:e.split(","),i=r.find(function(o){var u=o.split("="),d=(0,An.Z)(u,2),_=d[0],x=d[1];return _==="initial-scale"});return i?i.split("=")[1]*1:1}var ka=qu()<1?1:fa.devicePixelRatio,Gs=L(14665);function Os(e){return Function.toString.call(e).indexOf("[native code]")!==-1}var uf=L(51814);function zr(e,n,r){return(0,uf.Z)()?zr=Reflect.construct:zr=function(o,u,d){var _=[null];_.push.apply(_,u);var x=Function.bind.apply(o,_),E=new x;return d&&(0,Gs.Z)(E,d.prototype),E},zr.apply(null,arguments)}function fc(e){var n=typeof Map=="function"?new Map:void 0;return fc=function(i){if(i===null||!Os(i))return i;if(typeof i!="function")throw new TypeError("Super expression must either be null or a function");if(typeof n!="undefined"){if(n.has(i))return n.get(i);n.set(i,o)}function o(){return zr(i,arguments,(0,zt.Z)(this).constructor)}return o.prototype=Object.create(i.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),(0,Gs.Z)(o,i)},fc(e)}function lf(e){var n=hl();return function(){var i=(0,zt.Z)(e),o;if(n){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,wn.Z)(this,o)}}function hl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ca=function(e){(0,Yr.Z)(r,e);var n=lf(r);function r(i,o,u){var d;return(0,Ct.Z)(this,r),d=n.call(this,i),(0,C.Z)((0,be.Z)(d),"status",void 0),(0,C.Z)((0,be.Z)(d),"url",void 0),d.status=o,d.url=u,d.name=d.constructor.name,d.message=i,d}return(0,qt.Z)(r,[{key:"toString",value:function(){return"".concat(this.name,": ").concat(this.message," (").concat(this.status,"): ").concat(this.url)}}]),r}(fc(Error));function _s(e){var n=new Tu;n.open("GET",e.url,!0);for(var r in e.headers)e.headers.hasOwnProperty(r)&&n.setRequestHeader(r,e.headers[r]);return n.withCredentials=e.credentials==="include",n}var cf=function(n,r){var i=_s(n);return i.setRequestHeader("Accept","application/json"),i.onerror=function(){r(new Error(i.statusText))},i.onload=function(){if(i.status>=200&&i.status<300&&i.response){var o;try{o=JSON.parse(i.response)}catch(u){return r(u)}r(null,o)}else i.status===401?r(new Ca("".concat(i.statusText),i.status,n.url)):r(new Ca(i.statusText,i.status,n.url))},i.send(),i},Mu=function(n,r){var i=_s(n);return i.responseType="arraybuffer",i.onerror=function(){r(new Error(i.statusText))},i.onload=function(){var o=i.response;if(o.byteLength===0&&i.status===200)return r(new Error("http status 200 returned without content."));i.status>=200&&i.status<300&&i.response?r(null,{data:o,cacheControl:i.getResponseHeader("Cache-Control"),expires:i.getResponseHeader("Expires")}):r(new Ca(i.statusText,i.status,n.url))},i.send(),i};function Ds(e){var n=$window.document.createElement("a");return n.href=e,n.protocol===$window.document.location.protocol&&n.host===$window.document.location.host}var Pu="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",jf=function(n,r){return Mu(n,function(i,o){if(i)r(i);else if(o){var u=new fa.Image;u.crossOrigin="anonymous";var d=fa.URL||fa.webkitURL;u.onload=function(){r(null,u),d.revokeObjectURL(u.src)};var _=new fa.Blob([new Uint8Array(o.data)],{type:"image/png"});u.src=o.data.byteLength?d.createObjectURL(_):Pu}})},pl=2*Math.PI*6378137/2;function Gf(e){var n=[Infinity,Infinity,-Infinity,-Infinity];return e.forEach(function(r){var i=r.coordinates;ff(n,i)}),n}function ff(e,n){return Array.isArray(n[0])?n.forEach(function(r){ff(e,r)}):(e[0]>n[0]&&(e[0]=n[0]),e[1]>n[1]&&(e[1]=n[1]),e[2]<n[0]&&(e[2]=n[0]),e[3]<n[1]&&(e[3]=n[1])),e}function tu(e,n){return Rs(e,n)}function Rs(e,n){return Array.isArray(e[0])?e.map(function(r){return Rs(r,n)}):n(e)}function Si(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{enable:!0,decimal:1};e=dl(e,n);var i=e[0],o=e[1],u=i*pl/180,d=Math.log(Math.tan((90+o)*Math.PI/360))/(Math.PI/180);return d=d*pl/180,r.enable&&(u=Number(u.toFixed(r.decimal)),d=Number(d.toFixed(r.decimal))),e.length===3?[u,d,e[2]]:[u,d]}function Iu(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,r=e[0],i=e[1],o=r/pl*180,u=i/pl*180;return u=180/Math.PI*(2*Math.atan(Math.exp(u*Math.PI/180))-Math.PI/2),n!=null&&(o=Number(o.toFixed(n)),u=Number(u.toFixed(n))),e.length===3?[o,u,e[2]]:[o,u]}function ru(e){if(e==null)throw new Error("lng is required");return(e>180||e<-180)&&(e=e%360,e>180&&(e=-360+e),e<-180&&(e=360+e),e===0&&(e=0)),e}function Go(e){if(e==null)throw new Error("lat is required");return(e>90||e<-90)&&(e=e%180,e>90&&(e=-180+e),e<-90&&(e=180+e),e===0&&(e=0)),e}function dl(e,n){if(n===!1)return e;var r=ru(e[0]),i=Go(e[1]);return i>85&&(i=85),i<-85&&(i=-85),e.length===3?[r,i,e[2]]:[r,i]}function Fs(e){var n=85.0511287798,r=Math.max(Math.min(n,e[1]),-n),i=256<<20,o=Math.PI/180,u=e[0]*o,d=r*o;d=Math.log(Math.tan(Math.PI/4+d/2));var _=.5/Math.PI,x=.5,E=-.5/Math.PI;return o=.5,u=i*(_*u+x),d=i*(E*d+o),[Math.floor(u),Math.floor(d)]}function Hs(e){var n=.5/Math.PI,r=.5,i=-.5/Math.PI,o=.5,u=256<<20,d=_slicedToArray(e,2),_=d[0],x=d[1];_=(_/u-r)/n,x=(x/u-o)/i,x=(Math.atan(Math.pow(Math.E,x))-Math.PI/4)*2,o=Math.PI/180;var E=x/o,P=_/o;return[P,E]}function xs(e,n,r){var i=tr(n[1]-e[1]),o=tr(n[0]-e[0]),u=tr(e[1]),d=tr(n[1]),_=Math.pow(Math.sin(i/2),2)+Math.pow(Math.sin(o/2),2)*Math.cos(u)*Math.cos(d);return he(2*Math.atan2(Math.sqrt(_),Math.sqrt(1-_)),r="meters")}function pu(e){var n=Math.PI/180,r=85.0511287798,i=6378137,o=Math.max(Math.min(r,e[1]),-r),u=Math.sin(o*n),d=i*e[0]*n,_=i*Math.log((1+u)/(1-u))/2;return[d,_]}function Mn(e,n){var r=Math.abs(e[1][1]-e[0][1])*n,i=Math.abs(e[1][0]-e[0][0])*n;return[[e[0][0]-i,e[0][1]-r],[e[1][0]+i,e[1][1]+r]]}function bn(e,n){return e[0][0]<=n[0][0]&&e[0][1]<=n[0][1]&&e[1][0]>=n[1][0]&&e[1][1]>=n[1][1]}function zc(e){return[[e[0],e[1]],[e[2],e[3]]]}var is=function(){function e(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50,r=arguments.length>1?arguments[1]:void 0;(0,Ct.Z)(this,e),(0,C.Z)(this,"limit",void 0),(0,C.Z)(this,"cache",void 0),(0,C.Z)(this,"destroy",void 0),(0,C.Z)(this,"order",void 0),this.limit=n,this.destroy=r||this.defaultDestroy,this.order=[],this.clear()}return(0,qt.Z)(e,[{key:"clear",value:function(){var r=this;this.order.forEach(function(i){r.delete(i)}),this.cache={},this.order=[]}},{key:"get",value:function(r){var i=this.cache[r];return i&&(this.deleteOrder(r),this.appendOrder(r)),i}},{key:"set",value:function(r,i){this.cache[r]?(this.delete(r),this.cache[r]=i,this.appendOrder(r)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[r]=i,this.appendOrder(r))}},{key:"delete",value:function(r){var i=this.cache[r];i&&(this.deleteCache(r),this.deleteOrder(r),this.destroy(i,r))}},{key:"deleteCache",value:function(r){delete this.cache[r]}},{key:"deleteOrder",value:function(r){var i=this.order.findIndex(function(o){return o===r});i>=0&&this.order.splice(i,1)}},{key:"appendOrder",value:function(r){this.order.push(r)}},{key:"defaultDestroy",value:function(r,i){return null}}]),e}();function as(e,n){e.forEach(function(r){!n[r]||(n[r]=n[r].bind(n))})}var Jo=function(){function e(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16;(0,Ct.Z)(this,e),(0,C.Z)(this,"duration",16),(0,C.Z)(this,"timestamp",new Date().getTime()),this.duration=n}return(0,qt.Z)(e,[{key:"run",value:function(r){var i=new Date().getTime(),o=i-this.timestamp;this.timestamp=i,o>=this.duration&&r()}}]),e}(),nu=L(2650);function to(e){var n=nu.ZP(e),r=[0,0,0,0];return n!=null&&(r[0]=n.r/255,r[1]=n.g/255,r[2]=n.b/255,r[3]=n.opacity),r}function Ou(e){var n=e&&e[0],r=e&&e[1],i=e&&e[2],o=n+r*256+i*65536-1;return o}function Ji(e){return[e+1&255,e+1>>8&255,e+1>>8>>8&255]}function Ta(e){var n=fa.document.createElement("canvas"),r=n.getContext("2d");n.width=256,n.height=1;for(var i=r.createLinearGradient(0,0,256,1),o=null,u=e.positions[0],d=e.positions[e.positions.length-1],_=0;_<e.colors.length;++_){var x=(e.positions[_]-u)/(d-u);i.addColorStop(x,e.colors[_])}return r.fillStyle=i,r.fillRect(0,0,256,1),o=new Uint8ClampedArray(r.getImageData(0,0,256,1).data),$i?{data:o,width:256,height:1}:new ImageData(o,256,1)}var hc;(function(e){e.CENTER="center",e.TOP="top",e["TOP-LEFT"]="top-left",e["TOP-RIGHT"]="top-right",e.BOTTOM="bottom",e["BOTTOM-LEFT"]="bottom-left",e.LEFT="left",e.RIGHT="right"})(hc||(hc={}));var Ru={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function iu(e,n,r){var i=e.classList;for(var o in Ru)Ru.hasOwnProperty(o)&&i.remove("l7-".concat(r,"-anchor-").concat(o));i.add("l7-".concat(r,"-anchor-").concat(n))}function du(e){if(e.length===0)throw new Error("max requires at least one data point");for(var n=e[0],r=1;r<e.length;r++)e[r]>n&&(n=e[r]);return n*1}function ko(e){if(e.length===0)throw new Error("min requires at least one data point");for(var n=e[0],r=1;r<e.length;r++)e[r]<n&&(n=e[r]);return n*1}function Lu(e){if(e.length===0)return 0;for(var n=e[0]*1,r=1;r<e.length;r++)n+=e[r]*1;return n}function vu(e){if(e.length===0)throw new Error("mean requires at least one data point");return Lu(e)/e.length}function Uc(e){if(e.length===0)throw new Error("mean requires at least one data point");if(e.length<3)return e[0];e.sort();for(var n=e[0],r=NaN,i=0,o=1,u=1;u<e.length+1;u++)e[u]!==n?(o>i&&(i=o,r=n),o=1,n=e[u]):o++;return r*1}var Ku={min:ko,max:du,mean:vu,sum:Lu,mode:Uc};function vl(e,n){return e.map(function(r){return r[n]})}function hf(e,n){return Ku[e](n)}function Nl(e,n){var r=n.extent,i=r===void 0?[121.168,30.2828,121.384,30.4219]:r,o=new Promise(function(d){Bl(e,function(_){d(_)})}),u={originData:e,images:o,_id:1,dataArray:[{_id:0,coordinates:[[i[0],i[1]],[i[2],i[3]]]}]};return u}function Bl(e,n){var r=e,i=[];if(typeof r=="string")jf({url:r},function(d,_){i.push(_),n(i)});else{var o=r.length,u=0;r.forEach(function(d){jf({url:d},function(_,x){u++,i.push(x),u===o&&n(i)})})}return Nl}function Hf(e,n){var r=n.extent,i=n.width,o=n.height,u=n.min,d=n.max,_={_id:1,dataArray:[{_id:1,data:Array.from(e),width:i,height:o,min:u,max:d,coordinates:[[r[0],r[1]],[r[2],r[3]]]}]};return _}var ml=L(30236),gl=L.n(ml),pf=L(47037),Qo=L.n(pf),Ws=L(23560),ku=L.n(Ws),Zc=L(50361),pc=L.n(Zc),yl=L(34155);/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function l(e,n,r,i){function o(u){return u instanceof r?u:new r(function(d){d(u)})}return new(r||(r=Promise))(function(u,d){function _(P){try{E(i.next(P))}catch(I){d(I)}}function x(P){try{E(i.throw(P))}catch(I){d(I)}}function E(P){P.done?u(P.value):o(P.value).then(_,x)}E((i=i.apply(e,n||[])).next())})}function f(e,n){var r={label:0,sent:function(){if(u[0]&1)throw u[1];return u[1]},trys:[],ops:[]},i,o,u,d;return d={next:_(0),throw:_(1),return:_(2)},typeof Symbol=="function"&&(d[Symbol.iterator]=function(){return this}),d;function _(E){return function(P){return x([E,P])}}function x(E){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,o&&(u=E[0]&2?o.return:E[0]?o.throw||((u=o.return)&&u.call(o),0):o.next)&&!(u=u.call(o,E[1])).done)return u;switch(o=0,u&&(E=[E[0]&2,u.value]),E[0]){case 0:case 1:u=E;break;case 4:return r.label++,{value:E[1],done:!1};case 5:r.label++,o=E[1],E=[0];continue;case 7:E=r.ops.pop(),r.trys.pop();continue;default:if(u=r.trys,!(u=u.length>0&&u[u.length-1])&&(E[0]===6||E[0]===2)){r=0;continue}if(E[0]===3&&(!u||E[1]>u[0]&&E[1]<u[3])){r.label=E[1];break}if(E[0]===6&&r.label<u[1]){r.label=u[1],u=E;break}if(u&&r.label<u[2]){r.label=u[2],r.ops.push(E);break}u[2]&&r.ops.pop(),r.trys.pop();continue}E=n.call(e,r)}catch(P){E=[6,P],o=0}finally{i=u=0}if(E[0]&5)throw E[1];return{value:E[0]?E[1]:void 0,done:!0}}}function c(e,n){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var i=r.call(e),o,u=[],d;try{for(;(n===void 0||n-- >0)&&!(o=i.next()).done;)u.push(o.value)}catch(_){d={error:_}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(d)throw d.error}}return u}function p(){for(var e=[],n=0;n<arguments.length;n++)e=e.concat(c(arguments[n]));return e}function b(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function w(e,n){return n={exports:{}},e(n,n.exports),n.exports}var A=w(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=r;function r(i){return i&&typeof i.length=="number"&&i.length>=0&&i.length%1==0}e.exports=n.default});b(A);var R=w(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(r){return function(){for(var i=[],o=arguments.length;o--;)i[o]=arguments[o];var u=i.pop();return r.call(this,i,u)}},e.exports=n.default});b(R);var U=w(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.fallback=o,n.wrap=u;var r=n.hasSetImmediate=typeof setImmediate=="function"&&setImmediate,i=n.hasNextTick=typeof yl=="object"&&typeof yl.nextTick=="function";function o(_){setTimeout(_,0)}function u(_){return function(x){for(var E=[],P=arguments.length-1;P-- >0;)E[P]=arguments[P+1];return _(function(){return x.apply(void 0,E)})}}var d;r?d=setImmediate:i?d=yl.nextTick:d=o,n.default=u(d)});b(U);var q=U.fallback,le=U.wrap,fe=U.hasSetImmediate,pe=U.hasNextTick,Oe=w(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=u;var r=o(R),i=o(U);function o(x){return x&&x.__esModule?x:{default:x}}function u(x){return(0,Ce.isAsync)(x)?function(){for(var E=[],P=arguments.length;P--;)E[P]=arguments[P];var I=E.pop(),D=x.apply(this,E);return d(D,I)}:(0,r.default)(function(E,P){var I;try{I=x.apply(this,E)}catch(D){return P(D)}if(I&&typeof I.then=="function")return d(I,P);P(null,I)})}function d(x,E){return x.then(function(P){_(E,null,P)},function(P){_(E,P&&P.message?P:new Error(P))})}function _(x,E,P){try{x(E,P)}catch(I){(0,i.default)(function(D){throw D},I)}}e.exports=n.default});b(Oe);var Ce=w(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.isAsyncIterable=n.isAsyncGenerator=n.isAsync=void 0;var r=i(Oe);function i(x){return x&&x.__esModule?x:{default:x}}function o(x){return x[Symbol.toStringTag]==="AsyncFunction"}function u(x){return x[Symbol.toStringTag]==="AsyncGenerator"}function d(x){return typeof x[Symbol.asyncIterator]=="function"}function _(x){if(typeof x!="function")throw new Error("expected a function");return o(x)?(0,r.default)(x):x}n.default=_,n.isAsync=o,n.isAsyncGenerator=u,n.isAsyncIterable=d});b(Ce);var We=Ce.isAsyncIterable,Te=Ce.isAsyncGenerator,He=Ce.isAsync,Qe=w(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=r;function r(i,o){if(o===void 0&&(o=i.length),!o)throw new Error("arity is undefined");function u(){for(var d=this,_=[],x=arguments.length;x--;)_[x]=arguments[x];return typeof _[o-1]=="function"?i.apply(this,_):new Promise(function(E,P){_[o-1]=function(I){for(var D=[],Z=arguments.length-1;Z-- >0;)D[Z]=arguments[Z+1];if(I)return P(I);E(D.length>1?D:D[0])},i.apply(d,_)})}return Object.defineProperty(u,"name",{configurable:!0,value:"awaitable("+i.name+")"}),u}e.exports=n.default});b(Qe);var yt=w(function(e,n){Object.defineProperty(n,"__esModule",{value:!0});var r=u(A),i=u(Ce),o=u(Qe);function u(d){return d&&d.__esModule?d:{default:d}}n.default=(0,o.default)(function(d,_,x){var E=(0,r.default)(_)?[]:{};d(_,function(P,I,D){(0,i.default)(P)(function(Z){for(var re,oe=[],de=arguments.length-1;de-- >0;)oe[de]=arguments[de+1];oe.length<2&&(re=oe,oe=re[0]),E[I]=oe,D(Z)})},function(P){return x(P,E)})},3),e.exports=n.default});b(yt);var Vt=w(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=r;function r(i){function o(){for(var u=[],d=arguments.length;d--;)u[d]=arguments[d];if(i!==null){var _=i;i=null,_.apply(this,u)}}return Object.assign(o,i),o}e.exports=n.default});b(Vt);var Nt=w(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(r){return r[Symbol.iterator]&&r[Symbol.iterator]()},e.exports=n.default});b(Nt);var Kt=w(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=x;var r=o(A),i=o(Nt);function o(E){return E&&E.__esModule?E:{default:E}}function u(E){var P=-1,I=E.length;return function(){return++P<I?{value:E[P],key:P}:null}}function d(E){var P=-1;return function(){var D=E.next();return D.done?null:(P++,{value:D.value,key:P})}}function _(E){var P=E?Object.keys(E):[],I=-1,D=P.length;return function(){var re=P[++I];return I<D?{value:E[re],key:re}:null}}function x(E){if((0,r.default)(E))return u(E);var P=(0,i.default)(E);return P?d(P):_(E)}e.exports=n.default});b(Kt);var cr=w(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=r;function r(i){return function(){for(var o=[],u=arguments.length;u--;)o[u]=arguments[u];if(i===null)throw new Error("Callback was already called.");var d=i;i=null,d.apply(this,o)}}e.exports=n.default});b(cr);var Ir=w(function(e,n){Object.defineProperty(n,"__esModule",{value:!0});var r={};n.default=r,e.exports=n.default});b(Ir);var Or=w(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=o;var r=i(Ir);function i(u){return u&&u.__esModule?u:{default:u}}function o(u,d,_,x){var E=!1,P=!1,I=!1,D=0,Z=0;function re(){D>=d||I||E||(I=!0,u.next().then(function(Fe){var it=Fe.value,vt=Fe.done;if(!(P||E)){if(I=!1,vt){E=!0,D<=0&&x(null);return}D++,_(it,Z,oe),Z++,re()}}).catch(de))}function oe(Fe,it){if(D-=1,!P){if(Fe)return de(Fe);if(Fe===!1){E=!0,P=!0;return}if(it===r.default||E&&D<=0)return E=!0,x(null);re()}}function de(Fe){P||(I=!1,E=!0,x(Fe))}re()}e.exports=n.default});b(Or);var tn=w(function(e,n){Object.defineProperty(n,"__esModule",{value:!0});var r=_(Vt),i=_(Kt),o=_(cr),u=_(Or),d=_(Ir);function _(x){return x&&x.__esModule?x:{default:x}}n.default=function(x){return function(E,P,I){if(I=(0,r.default)(I),x<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!E)return I(null);if((0,Ce.isAsyncGenerator)(E))return(0,u.default)(E,x,P,I);if((0,Ce.isAsyncIterable)(E))return(0,u.default)(E[Symbol.asyncIterator](),x,P,I);var D=(0,i.default)(E),Z=!1,re=!1,oe=0,de=!1;function Fe(vt,xt){if(!re)if(oe-=1,vt)Z=!0,I(vt);else if(vt===!1)Z=!0,re=!0;else{if(xt===d.default||Z&&oe<=0)return Z=!0,I(null);de||it()}}function it(){for(de=!0;oe<x&&!Z;){var vt=D();if(vt===null){Z=!0,oe<=0&&I(null);return}oe+=1,P(vt.value,vt.key,(0,o.default)(Fe))}de=!1}it()}},e.exports=n.default});b(tn);var Rn=w(function(e,n){Object.defineProperty(n,"__esModule",{value:!0});var r=u(tn),i=u(Ce),o=u(Qe);function u(_){return _&&_.__esModule?_:{default:_}}function d(_,x,E,P){return(0,r.default)(x)(_,(0,i.default)(E),P)}n.default=(0,o.default)(d,4),e.exports=n.default});b(Rn);var Fn=w(function(e,n){Object.defineProperty(n,"__esModule",{value:!0});var r=o(Rn),i=o(Qe);function o(d){return d&&d.__esModule?d:{default:d}}function u(d,_,x){return(0,r.default)(d,1,_,x)}n.default=(0,i.default)(u,3),e.exports=n.default});b(Fn);var Un=w(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=u;var r=o(yt),i=o(Fn);function o(d){return d&&d.__esModule?d:{default:d}}function u(d,_){return(0,r.default)(i.default,d,_)}e.exports=n.default}),Li=b(Un),Zr=function(){function e(){for(var n=arguments,r=[],i=0;i<arguments.length;i++)r[i]=n[i];this.args=[],this.tasks=[]}return e.prototype.call=function(){for(var n=arguments,r=[],i=0;i<arguments.length;i++)r[i]=n[i];return this.args=r,Li(this.tasks)},e.prototype.tap=function(n,r){var i=this;this.tasks.push(function(o){r.apply(void 0,p(i.args)),o(null,n)})},e}(),ii=w(function(e,n){Object.defineProperty(n,"__esModule",{value:!0});var r=E(A),i=E(Ir),o=E(Rn),u=E(Vt),d=E(cr),_=E(Ce),x=E(Qe);function E(Z){return Z&&Z.__esModule?Z:{default:Z}}function P(Z,re,oe){oe=(0,u.default)(oe);var de=0,Fe=0,it=Z.length,vt=!1;it===0&&oe(null);function xt(Gt,Xt){Gt===!1&&(vt=!0),vt!==!0&&(Gt?oe(Gt):(++Fe===it||Xt===i.default)&&oe(null))}for(;de<it;de++)re(Z[de],de,(0,d.default)(xt))}function I(Z,re,oe){return(0,o.default)(Z,Infinity,re,oe)}function D(Z,re,oe){var de=(0,r.default)(Z)?P:I;return de(Z,(0,_.default)(re),oe)}n.default=(0,x.default)(D,3),e.exports=n.default});b(ii);var si=w(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=u;var r=o(ii),i=o(yt);function o(d){return d&&d.__esModule?d:{default:d}}function u(d,_){return(0,i.default)(r.default,d,_)}e.exports=n.default}),Qn=b(si),Hn=function(){function e(){for(var n=arguments,r=[],i=0;i<arguments.length;i++)r[i]=n[i];this.tasks=[]}return e.prototype.promise=function(){for(var n=arguments,r=[],i=0;i<arguments.length;i++)r[i]=n[i];return Qn(this.tasks)},e.prototype.tapPromise=function(n,r){var i=this;this.tasks.push(function(o){return l(i,void 0,void 0,function(){return f(this,function(u){switch(u.label){case 0:return[4,r()];case 1:return u.sent(),o(null,n),[2]}})})})},e}(),mi=w(function(e,n){Object.defineProperty(n,"__esModule",{value:!0});var r=d(Vt),i=d(cr),o=d(Ce),u=d(Qe);function d(x){return x&&x.__esModule?x:{default:x}}function _(x,E){if(E=(0,r.default)(E),!Array.isArray(x))return E(new Error("First argument to waterfall must be an array of functions"));if(!x.length)return E();var P=0;function I(Z){var re=(0,o.default)(x[P++]);re.apply(void 0,Z.concat([(0,i.default)(D)]))}function D(Z){for(var re=[],oe=arguments.length-1;oe-- >0;)re[oe]=arguments[oe+1];if(Z!==!1){if(Z||P===x.length)return E.apply(void 0,[Z].concat(re));I(re)}}I([])}n.default=(0,u.default)(_),e.exports=n.default}),Kn=b(mi),Wn=function(){function e(){for(var n=arguments,r=[],i=0;i<arguments.length;i++)r[i]=n[i];this.tasks=[]}return e.prototype.call=function(){for(var n=arguments,r=[],i=0;i<arguments.length;i++)r[i]=n[i];return Kn(this.tasks)},e.prototype.tap=function(n,r){this.tasks.length===0?this.tasks.push(function(i){var o=r();i(o?null:!1,o)}):this.tasks.push(function(i,o){var u=r();o(u?null:!1,n)})},e}(),uo=function(){function e(){for(var n=arguments,r=[],i=0;i<arguments.length;i++)r[i]=n[i];this.tasks=[]}return e.prototype.call=function(){for(var n=arguments,r=[],i=0;i<arguments.length;i++)r[i]=n[i];return Li(this.tasks)},e.prototype.tap=function(n,r){this.tasks.push(function(i){var o=r();i(o,n)})},e}(),ha=L(26729),Do=L.n(ha),Fo=L(69848),Za=L.n(Fo);function ro(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function bs(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?ro(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ro(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function es(e,n){var r=n.radius,i=r===void 0?40:r,o=n.maxZoom,u=o===void 0?18:o,d=n.minZoom,_=d===void 0?0:d,x=n.zoom,E=x===void 0?2:x;if(e.pointIndex){var P=e.pointIndex.getClusters(e.extent,Math.floor(E));return e.dataArray=Du(P),e}var I=new(Za())({radius:i,minZoom:_,maxZoom:u}),D={type:"FeatureCollection",features:[]};return D.features=e.dataArray.map(function(Z){return{type:"Feature",geometry:{type:"Point",coordinates:Z.coordinates},properties:bs({},Z)}}),I.load(D.features),I}function Du(e){return e.map(function(n,r){return bs({coordinates:n.geometry.coordinates,_id:r+1},n.properties)})}function os(e){if(e.length===0)throw new Error("max requires at least one data point");for(var n=e[0],r=1;r<e.length;r++)e[r]>n&&(n=e[r]);return n}function au(e){if(e.length===0)throw new Error("min requires at least one data point");for(var n=e[0],r=1;r<e.length;r++)e[r]<n&&(n=e[r]);return n}function Ns(e){if(e.length===0)return 0;for(var n=e[0],r=0,i,o=1;o<e.length;o++)i=n+e[o]*1,Math.abs(n)>=Math.abs(e[o])?r+=n-i+e[o]:r+=e[o]-i+n,n=i;return n+r*1}function dc(e){if(e.length===0)throw new Error("mean requires at least one data point");return Ns(e)/e.length}var zl={min:au,max:os,mean:dc,sum:Ns};function Fu(e,n){return e.map(function(r){return r[n]*1})}function _l(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function Ul(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?_l(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_l(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function ou(e){var n=Zl();return function(){var i=(0,zt.Z)(e),o;if(n){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,wn.Z)(this,o)}}function Zl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function mu(e,n){if(Array.isArray(n))return n}var go=function(e){(0,Yr.Z)(r,e);var n=ou(r);function r(i,o){var u;return(0,Ct.Z)(this,r),u=n.call(this),(0,C.Z)((0,be.Z)(u),"data",void 0),(0,C.Z)((0,be.Z)(u),"extent",void 0),(0,C.Z)((0,be.Z)(u),"hooks",{init:new Zr}),(0,C.Z)((0,be.Z)(u),"parser",{type:"geojson"}),(0,C.Z)((0,be.Z)(u),"transforms",[]),(0,C.Z)((0,be.Z)(u),"cluster",!1),(0,C.Z)((0,be.Z)(u),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),(0,C.Z)((0,be.Z)(u),"mapService",void 0),(0,C.Z)((0,be.Z)(u),"invalidExtent",!1),(0,C.Z)((0,be.Z)(u),"originData",void 0),(0,C.Z)((0,be.Z)(u),"rawData",void 0),(0,C.Z)((0,be.Z)(u),"cfg",{}),(0,C.Z)((0,be.Z)(u),"clusterIndex",void 0),u.originData=i,u.initCfg(o),u.hooks.init.tap("parser",function(){u.excuteParser()}),u.hooks.init.tap("cluster",function(){u.initCluster()}),u.hooks.init.tap("transform",function(){u.executeTrans()}),u.init(),u}return(0,qt.Z)(r,[{key:"setData",value:function(o,u){this.rawData=o,this.originData=o,this.initCfg(u),this.init(),this.emit("update")}},{key:"getClusters",value:function(o){return this.clusterIndex.getClusters(this.caculClusterExtent(2),o)}},{key:"getClustersLeaves",value:function(o){return this.clusterIndex.getLeaves(o,Infinity)}},{key:"updateClusterData",value:function(o){var u=this,d=this.clusterOptions,_=d.method,x=_===void 0?"sum":_,E=d.field,P=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(o));this.clusterOptions.zoom=o,P.forEach(function(I){I.id||(I.properties.point_count=1)}),(E||ku()(x))&&(P=P.map(function(I){var D=I.id;if(D){var Z=u.clusterIndex.getLeaves(D,Infinity),re=Z.map(function(Fe){return Fe.properties}),oe;if(Qo()(x)&&E){var de=Fu(re,E);oe=zl[x](de)}ku()(x)&&(oe=x(re)),I.properties.stat=oe}else I.properties.point_count=1;return I})),this.data=ne("geojson")({type:"FeatureCollection",features:P}),this.executeTrans()}},{key:"getFeatureById",value:function(o){var u=this.parser.type,d=u===void 0?"geojson":u;if(d==="geojson"&&!this.cluster){var _=o<this.originData.features.length?this.originData.features[o]:"null",x=pc()(_);if(this.transforms.length!==0){var E=this.data.dataArray.find(function(P){return P._id===o});x.properties=E}return x}else return o<this.data.dataArray.length?this.data.dataArray[o]:"null"}},{key:"getFeatureId",value:function(o,u){var d=this.data.dataArray.find(function(_){return _[o]===name});return d==null?void 0:d._id}},{key:"destroy",value:function(){this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null}},{key:"caculClusterExtent",value:function(o){var u=[[-Infinity,-Infinity],[Infinity,Infinity]];return this.invalidExtent||(u=Mn(zc(this.extent),o)),u[0].concat(u[1])}},{key:"initCfg",value:function(o){this.cfg=gl()(this.cfg,o,mu);var u=this.cfg;u&&(u.parser&&(this.parser=u.parser),u.transforms&&(this.transforms=u.transforms),this.cluster=u.cluster||!1,u.clusterOptions&&(this.cluster=!0,this.clusterOptions=Ul(Ul({},this.clusterOptions),u.clusterOptions)))}},{key:"excuteParser",value:function(){var o=this.parser,u=o.type||"geojson";if(u==="imagetile"){this.data={tileurl:this.originData,dataArray:[]};return}var d=ne(u);this.data=d(this.originData,o),this.extent=Gf(this.data.dataArray),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3]}},{key:"executeTrans",value:function(){var o=this,u=this.transforms;u.forEach(function(d){var _=d.type,x=K(_)(o.data,d);Object.assign(o.data,x)})}},{key:"initCluster",value:function(){if(!!this.cluster){var o=this.clusterOptions||{};this.clusterIndex=es(this.data,o)}}},{key:"init",value:function(){this.hooks.init.call(this)}}]),r}(ha.EventEmitter);function Nu(e,n){var r=n.callback;return r&&(e.dataArray=e.dataArray.filter(r)),e}function Bu(e,n){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=$u(e))||n&&e&&typeof e.length=="number"){r&&(e=r);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(E){throw E},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var u=!0,d=!1,_;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return u=E.done,E},e:function(E){d=!0,_=E},f:function(){try{!u&&r.return!=null&&r.return()}finally{if(d)throw _}}}}function $u(e,n){if(!!e){if(typeof e=="string")return ta(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ta(e,n)}}function ta(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}var Es=6378e3;function ss(e,n){var r=e.dataArray,i=n.size,o=i===void 0?10:i,u=o/(2*Math.PI*Es)*(256<<20)/2,d=Ju(r,o),_=d.gridHash,x=d.gridOffset,E=Xs(_,x,n);return{yOffset:u,xOffset:u,radius:u,type:"grid",dataArray:E}}function Ju(e,n){var r=Infinity,i=-Infinity,o,u=Bu(e),d;try{for(u.s();!(d=u.n()).done;){var _=d.value;o=_.coordinates[1],Number.isFinite(o)&&(r=o<r?o:r,i=o>i?o:i)}}catch(vt){u.e(vt)}finally{u.f()}var x=(r+i)/2,E=Vc(n,x);if(E.xOffset<=0||E.yOffset<=0)return{gridHash:{},gridOffset:E};var P={},I=Bu(e),D;try{for(I.s();!(D=I.n()).done;){var Z=D.value,re=Z.coordinates[1],oe=Z.coordinates[0];if(Number.isFinite(re)&&Number.isFinite(oe)){var de=Math.floor((re+90)/E.yOffset),Fe=Math.floor((oe+180)/E.xOffset),it="".concat(de,"-").concat(Fe);P[it]=P[it]||{count:0,points:[]},P[it].count+=1,P[it].points.push(Z)}}}catch(vt){I.e(vt)}finally{I.f()}return{gridHash:P,gridOffset:E}}function Vc(e,n){var r=jc(e),i=df(n,e);return{yOffset:r,xOffset:i}}function jc(e){return e/Es*(180/Math.PI)}function df(e,n){return n/Es*(180/Math.PI)/Math.cos(e*Math.PI/180)}function Xs(e,n,r){return Object.keys(e).reduce(function(i,o,u){var d=o.split("-"),_=parseInt(d[0],10),x=parseInt(d[1],10),E={};if(r.field&&r.method){var P=vl(e[o].points,r.field);E[r.method]=Ku[r.method](P)}return Object.assign(E,{_id:u,coordinates:Fs([-180+n.xOffset*(x+.5),-90+n.yOffset*(_+.5)]),rawData:e[o].points,count:e[o].count}),i.push(E),i},[])}var gu=Math.PI/3,su=[0,gu,2*gu,3*gu,4*gu,5*gu];function xl(e){return e[0]}function Gc(e){return e[1]}function yu(){var e=0,n=0,r=1,i=1,o=xl,u=Gc,d,_,x;function E(I){var D={},Z=[],re,oe=I.length;for(re=0;re<oe;++re)if(!(isNaN(Fe=+o.call(null,de=I[re],re,I))||isNaN(it=+u.call(null,de,re,I)))){var de,Fe,it,vt=Math.round(it=it/x),xt=Math.round(Fe=Fe/_-(vt&1)/2),Gt=it-vt;if(Math.abs(Gt)*3>1){var Xt=Fe-xt,nr=xt+(Fe<xt?-1:1)/2,mr=vt+(it<vt?-1:1),en=Fe-nr,hn=it-mr;Xt*Xt+Gt*Gt>en*en+hn*hn&&(xt=nr+(vt&1?1:-1)/2,vt=mr)}var wr=xt+"-"+vt,Pn=D[wr];Pn?Pn.push(de):(Z.push(Pn=D[wr]=[de]),Pn.x=(xt+(vt&1)/2)*_,Pn.y=vt*x)}return Z}function P(I){var D=0,Z=0;return su.map(function(re){var oe=Math.sin(re)*I,de=-Math.cos(re)*I,Fe=oe-D,it=de-Z;return D=oe,Z=de,[Fe,it]})}return E.hexagon=function(I){return"m"+P(I==null?d:+I).join("l")+"z"},E.centers=function(){for(var I=[],D=Math.round(n/x),Z=Math.round(e/_),re=D*x;re<i+d;re+=x,++D)for(var oe=Z*_+(D&1)*_/2;oe<r+_/2;oe+=_)I.push([oe,re]);return I},E.mesh=function(){var I=P(d).slice(0,4).join("l");return E.centers().map(function(D){return"M"+D+"m"+I}).join("")},E.x=function(I){return arguments.length?(o=I,E):o},E.y=function(I){return arguments.length?(u=I,E):u},E.radius=function(I){return arguments.length?(d=+I,_=d*2*Math.sin(gu),x=d*1.5,E):d},E.size=function(I){return arguments.length?(e=n=0,r=+I[0],i=+I[1],E):[r-e,i-n]},E.extent=function(I){return arguments.length?(e=+I[0][0],n=+I[0][1],r=+I[1][0],i=+I[1][1],E):[[e,n],[r,i]]},E.radius(1)}function wo(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function vc(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?wo(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):wo(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var Wf=6378e3;function Eh(e,n){var r=e.dataArray,i=n.size,o=i===void 0?10:i,u=n.method,d=u===void 0?"sum":u,_=o/(2*Math.PI*Wf)*(256<<20)/2,x=r.map(function(D){var Z=Fs(D.coordinates),re=(0,An.Z)(Z,2),oe=re[0],de=re[1];return vc(vc({},D),{},{coordinates:[oe,de]})}),E=yu().radius(_).x(function(D){return D.coordinates[0]}).y(function(D){return D.coordinates[1]}),P=E(x),I={dataArray:P.map(function(D,Z){var re;if(n.field&&d){var oe=vl(D,n.field);D[d]=Ku[d](oe)}return re={},(0,C.Z)(re,n.method,D[d]),(0,C.Z)(re,"count",D.length),(0,C.Z)(re,"rawData",D),(0,C.Z)(re,"coordinates",[D.x,D.y]),(0,C.Z)(re,"_id",Z),re}),radius:_,xOffset:_,yOffset:_,type:"hexagon"};return I}function vf(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function Sh(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?vf(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):vf(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function Qh(e,n){var r=n.sourceField,i=n.targetField,o=n.data,u={};return o.forEach(function(d){u[d[r]]=d}),e.dataArray=e.dataArray.map(function(d){var _=d[i];return Sh(Sh({},d),u[_])}),e}function mc(e,n){var r=n.callback;return r&&(e.dataArray=e.dataArray.map(r)),e}var mf=go;ye("geojson",Gr),ye("image",Nl),ye("csv",cn),ye("json",Yt),ye("raster",Hf),Ne("cluster",es),Ne("filter",Nu),Ne("join",Qh),Ne("map",mc),Ne("grid",ss),Ne("hexagon",Eh);var wh=br,zp=Yn,gc=L(28660),Fr=L(86700),Up=L(84879),$t={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")},gf=L(31745),ep=L.n(gf);function Zp(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function Vp(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Zp(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Zp(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function tp(e,n){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=rp(e))||n&&e&&typeof e.length=="number"){r&&(e=r);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(E){throw E},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var u=!0,d=!1,_;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return u=E.done,E},e:function(E){d=!0,_=E},f:function(){try{!u&&r.return!=null&&r.return()}finally{if(d)throw _}}}}function rp(e,n){if(!!e){if(typeof e=="string")return jp(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return jp(e,n)}}function jp(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}var bl=30;function bd(e){var n=e.characterSet,r=e.getFontWidth,i=e.fontHeight,o=e.buffer,u=e.maxCanvasWidth,d=e.mapping,_=d===void 0?{}:d,x=e.xOffset,E=x===void 0?0:x,P=e.yOffset,I=P===void 0?0:P,D=0,Z=E;Array.from(n).forEach(function(oe,de){if(!_[oe]){var Fe=r(oe,de);Z+bl>u&&(Z=0,D++),_[oe]={x:Z,y:I+D*bl,width:bl,height:bl,advance:Fe},Z+=bl}});var re=i+o*2;return{mapping:_,xOffset:Z,yOffset:I+D*re,canvasHeight:np(I+(D+1)*re)}}function Co(e,n,r){var i=0,o=0,u=0,d=[],_={},x=tp(e),E;try{for(x.s();!(E=x.n()).done;){var P=E.value;if(!_[P.id]){var I=P.size;i+I+n>r&&(Xf(_,d,o),i=0,o=u+o+n,u=0,d=[]),d.push({icon:P,xOffset:i}),i=i+I+n,u=Math.max(u,I)}}}catch(Z){x.e(Z)}finally{x.f()}d.length>0&&Xf(_,d,o);var D=np(u+o+n);return{mapping:_,canvasHeight:D}}function Xf(e,n,r){var i=tp(n),o;try{for(i.s();!(o=i.n()).done;){var u=o.value,d=u.icon,_=u.xOffset;e[d.id]=Vp(Vp({},d),{},{x:_,y:r,image:d.image,width:d.width,height:d.height})}}catch(x){i.e(x)}finally{i.f()}}function np(e){return Math.pow(2,Math.ceil(Math.log2(e)))}var Yf,qf;function yf(e,n){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Ch(e))||n&&e&&typeof e.length=="number"){r&&(e=r);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(E){throw E},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var u=!0,d=!1,_;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return u=E.done,E},e:function(E){d=!0,_=E},f:function(){try{!u&&r.return!=null&&r.return()}finally{if(d)throw _}}}}function Ch(e,n){if(!!e){if(typeof e=="string")return _f(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return _f(e,n)}}function _f(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}function Vl(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function yc(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Vl(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Vl(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var Kf=Qf(),Th="sans-serif",_c="normal",Ah=24,$f=3,Mh=.25,xf=8,Hc=1024,Ys=1,bf=1,Jf=3,Ph=null;function Qf(){for(var e=[],n=32;n<128;n++)e.push(String.fromCharCode(n));return e}function eh(e,n,r,i){e.font="".concat(i," ").concat(r,"px ").concat(n),e.fillStyle="black",e.textBaseline="middle"}function Qu(e,n){for(var r=0;r<e.length;r++)n.data[4*r+3]=e[r]}var Wc=(Yf=(0,Fr.b2)(),Yf(qf=function(){function e(){(0,Ct.Z)(this,e),(0,C.Z)(this,"fontAtlas",void 0),(0,C.Z)(this,"iconFontMap",void 0),(0,C.Z)(this,"iconFontGlyphs",{}),(0,C.Z)(this,"fontOptions",void 0),(0,C.Z)(this,"key",void 0),(0,C.Z)(this,"cache",new is(Jf))}return(0,qt.Z)(e,[{key:"scale",get:function(){return bf}},{key:"canvas",get:function(){var r=this.cache.get(this.key);return r&&r.data}},{key:"mapping",get:function(){var r=this.cache.get(this.key);return r&&r.mapping}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:Th,fontWeight:_c,characterSet:Kf,fontSize:Ah,buffer:$f,sdf:!0,cutoff:Mh,radius:xf,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(r){var i=this;r.forEach(function(o){i.iconFontGlyphs[o.name]=o.unicode})}},{key:"addIconFont",value:function(r,i){this.iconFontMap.set(r,i)}},{key:"getIconFontKey",value:function(r){return this.iconFontMap.get(r)||r}},{key:"getGlyph",value:function(r){return this.iconFontGlyphs[r]?String.fromCharCode(parseInt(this.iconFontGlyphs[r],16)):""}},{key:"setFontOptions",value:function(r){this.fontOptions=yc(yc({},this.fontOptions),r),this.key=this.getKey();var i=this.getNewChars(this.key,this.fontOptions.characterSet),o=this.cache.get(this.key);if(!(o&&i.length===0)){var u=this.generateFontAtlas(this.key,i,o);this.fontAtlas=u,this.cache.set(this.key,u)}}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(r,i,o){var u=this.fontOptions,d=u.fontFamily,_=u.fontWeight,x=u.fontSize,E=u.buffer,P=u.sdf,I=u.radius,D=u.cutoff,Z=u.iconfont,re=o&&o.data;re||(re=fa.document.createElement("canvas"),re.width=Hc);var oe=re.getContext("2d");eh(oe,d,x,_);var de=bd(yc({getFontWidth:function(sl){return oe.measureText(sl).width},fontHeight:x*bf,buffer:E,characterSet:i,maxCanvasWidth:Hc},o&&{mapping:o.mapping,xOffset:o.xOffset,yOffset:o.yOffset})),Fe=de.mapping,it=de.canvasHeight,vt=de.xOffset,xt=de.yOffset,Gt=oe.getImageData(0,0,re.width,re.height);if(re.height=it,oe.putImageData(Gt,0,0),eh(oe,d,x,_),P){var Xt=new(ep())(x,E,I,D,d,_),nr=oe.getImageData(0,0,Xt.size,Xt.size),mr=yf(i),en;try{for(mr.s();!(en=mr.n()).done;){var hn=en.value;if(Z){var wr=String.fromCharCode(parseInt(hn.replace("&#x","").replace(";",""),16)),Pn=Xt.draw(wr);Qu(Pn,nr)}else Qu(Xt.draw(hn),nr);oe.putImageData(nr,Fe[hn].x,Fe[hn].y)}}catch(Ms){mr.e(Ms)}finally{mr.f()}}else{var jn=yf(i),yi;try{for(jn.s();!(yi=jn.n()).done;){var Io=yi.value;oe.fillText(Io,Fe[Io].x,Fe[Io].y+x*Ys)}}catch(Ms){jn.e(Ms)}finally{jn.f()}}return{xOffset:vt,yOffset:xt,mapping:Fe,data:re,width:re.width,height:re.height}}},{key:"getKey",value:function(){return"key";var r,i,o,u,d,_,x,E}},{key:"getNewChars",value:function(r,i){var o=this.cache.get(r);if(!o)return i;var u=[],d=o.mapping,_=new Set(Object.keys(d)),x=new Set(i);return x.forEach(function(E){_.has(E)||u.push(E)}),u}}]),e}())||qf),ip,th;function Gp(e){var n=Ed();return function(){var i=(0,zt.Z)(e),o;if(n){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,wn.Z)(this,o)}}function Ed(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Sd=3,uu=1024,Ef=64,Ih=(ip=(0,Fr.b2)(),ip(th=function(e){(0,Yr.Z)(r,e);var n=Gp(r);function r(){var i;(0,Ct.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return i=n.call.apply(n,[this].concat(u)),(0,C.Z)((0,be.Z)(i),"canvasHeight",128),(0,C.Z)((0,be.Z)(i),"texture",void 0),(0,C.Z)((0,be.Z)(i),"canvas",void 0),(0,C.Z)((0,be.Z)(i),"iconData",void 0),(0,C.Z)((0,be.Z)(i),"iconMap",void 0),(0,C.Z)((0,be.Z)(i),"ctx",void 0),(0,C.Z)((0,be.Z)(i),"loadingImageCount",0),i}return(0,qt.Z)(r,[{key:"isLoading",value:function(){return this.loadingImageCount===0}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=fa.document.createElement("canvas"),this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:function(o,u){var d=this,_=new Image;if(this.loadingImageCount++,this.hasImage(o))throw new Error("Image Id already exists");this.iconData.push({id:o,size:Ef}),this.updateIconMap(),this.loadImage(u).then(function(x){_=x;var E=d.iconData.find(function(P){return P.id===o});E&&(E.image=_,E.width=_.width,E.height=_.height),d.update()})}},{key:"addImageMini",value:function(o,u,d){var _=this,x=d.getSceneConfig().canvas,E=x.createImage();if(this.loadingImageCount++,this.hasImage(o))throw new Error("Image Id already exists");this.iconData.push({id:o,size:Ef}),this.updateIconMap(),this.loadImageMini(u,x).then(function(P){E=P;var I=_.iconData.find(function(D){return D.id===o});I&&(I.image=E,I.width=E.width,I.height=E.height),_.update()})}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(o){return this.iconMap.hasOwnProperty(o)}},{key:"removeImage",value:function(o){this.hasImage(o)&&(this.iconData=this.iconData.filter(function(u){return u.id!==o}),delete this.iconMap[o],this.update())}},{key:"destroy",value:function(){this.iconData=[],this.iconMap={}}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,this.loadingImageCount===0&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var o=this;this.canvas.width=uu,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach(function(u){var d=o.iconMap[u],_=d.x,x=d.y,E=d.image,P=d.width,I=P===void 0?64:P,D=d.height,Z=D===void 0?64:D,re=Math.max(I,Z),oe=re/Ef,de=Z/oe,Fe=I/oe;E&&o.ctx.drawImage(E,_+(Ef-Fe)/2,x+(Ef-de)/2,Fe,de)})}},{key:"updateIconMap",value:function(){var o=Co(this.iconData,Sd,uu),u=o.mapping,d=o.canvasHeight;this.iconMap=u,this.canvasHeight=d}},{key:"loadImage",value:function(o){return new Promise(function(u,d){if(o instanceof HTMLImageElement){u(o);return}var _=new Image;_.crossOrigin="anonymous",_.onload=function(){u(_)},_.onerror=function(){d(new Error("Could not load image at "+o))},_.src=o instanceof File?URL.createObjectURL(o):o})}},{key:"loadImageMini",value:function(o,u){return new Promise(function(d,_){var x=u.createImage();x.crossOrigin="anonymous",x.onload=function(){d(x)},x.onerror=function(){_(new Error("Could not load image at "+o))},x.src=o})}}]),r}(ha.EventEmitter))||th),xa=L(49685);function Ss(){var e=new xa.WT(16);return xa.WT!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function Hp(e){var n=new xa.WT(16);return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n}function wd(e,n){return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],e}function el(e,n,r,i,o,u,d,_,x,E,P,I,D,Z,re,oe){var de=new xa.WT(16);return de[0]=e,de[1]=n,de[2]=r,de[3]=i,de[4]=o,de[5]=u,de[6]=d,de[7]=_,de[8]=x,de[9]=E,de[10]=P,de[11]=I,de[12]=D,de[13]=Z,de[14]=re,de[15]=oe,de}function Sf(e,n,r,i,o,u,d,_,x,E,P,I,D,Z,re,oe,de){return e[0]=n,e[1]=r,e[2]=i,e[3]=o,e[4]=u,e[5]=d,e[6]=_,e[7]=x,e[8]=E,e[9]=P,e[10]=I,e[11]=D,e[12]=Z,e[13]=re,e[14]=oe,e[15]=de,e}function xc(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function bc(e,n){if(e===n){var r=n[1],i=n[2],o=n[3],u=n[6],d=n[7],_=n[11];e[1]=n[4],e[2]=n[8],e[3]=n[12],e[4]=r,e[6]=n[9],e[7]=n[13],e[8]=i,e[9]=u,e[11]=n[14],e[12]=o,e[13]=d,e[14]=_}else e[0]=n[0],e[1]=n[4],e[2]=n[8],e[3]=n[12],e[4]=n[1],e[5]=n[5],e[6]=n[9],e[7]=n[13],e[8]=n[2],e[9]=n[6],e[10]=n[10],e[11]=n[14],e[12]=n[3],e[13]=n[7],e[14]=n[11],e[15]=n[15];return e}function rh(e,n){var r=n[0],i=n[1],o=n[2],u=n[3],d=n[4],_=n[5],x=n[6],E=n[7],P=n[8],I=n[9],D=n[10],Z=n[11],re=n[12],oe=n[13],de=n[14],Fe=n[15],it=r*_-i*d,vt=r*x-o*d,xt=r*E-u*d,Gt=i*x-o*_,Xt=i*E-u*_,nr=o*E-u*x,mr=P*oe-I*re,en=P*de-D*re,hn=P*Fe-Z*re,wr=I*de-D*oe,Pn=I*Fe-Z*oe,jn=D*Fe-Z*de,yi=it*jn-vt*Pn+xt*wr+Gt*hn-Xt*en+nr*mr;return yi?(yi=1/yi,e[0]=(_*jn-x*Pn+E*wr)*yi,e[1]=(o*Pn-i*jn-u*wr)*yi,e[2]=(oe*nr-de*Xt+Fe*Gt)*yi,e[3]=(D*Xt-I*nr-Z*Gt)*yi,e[4]=(x*hn-d*jn-E*en)*yi,e[5]=(r*jn-o*hn+u*en)*yi,e[6]=(de*xt-re*nr-Fe*vt)*yi,e[7]=(P*nr-D*xt+Z*vt)*yi,e[8]=(d*Pn-_*hn+E*mr)*yi,e[9]=(i*hn-r*Pn-u*mr)*yi,e[10]=(re*Xt-oe*xt+Fe*it)*yi,e[11]=(I*xt-P*Xt-Z*it)*yi,e[12]=(_*en-d*wr-x*mr)*yi,e[13]=(r*wr-i*en+o*mr)*yi,e[14]=(oe*vt-re*Gt-de*it)*yi,e[15]=(P*Gt-I*vt+D*it)*yi,e):null}function ap(e,n){var r=n[0],i=n[1],o=n[2],u=n[3],d=n[4],_=n[5],x=n[6],E=n[7],P=n[8],I=n[9],D=n[10],Z=n[11],re=n[12],oe=n[13],de=n[14],Fe=n[15];return e[0]=_*(D*Fe-Z*de)-I*(x*Fe-E*de)+oe*(x*Z-E*D),e[1]=-(i*(D*Fe-Z*de)-I*(o*Fe-u*de)+oe*(o*Z-u*D)),e[2]=i*(x*Fe-E*de)-_*(o*Fe-u*de)+oe*(o*E-u*x),e[3]=-(i*(x*Z-E*D)-_*(o*Z-u*D)+I*(o*E-u*x)),e[4]=-(d*(D*Fe-Z*de)-P*(x*Fe-E*de)+re*(x*Z-E*D)),e[5]=r*(D*Fe-Z*de)-P*(o*Fe-u*de)+re*(o*Z-u*D),e[6]=-(r*(x*Fe-E*de)-d*(o*Fe-u*de)+re*(o*E-u*x)),e[7]=r*(x*Z-E*D)-d*(o*Z-u*D)+P*(o*E-u*x),e[8]=d*(I*Fe-Z*oe)-P*(_*Fe-E*oe)+re*(_*Z-E*I),e[9]=-(r*(I*Fe-Z*oe)-P*(i*Fe-u*oe)+re*(i*Z-u*I)),e[10]=r*(_*Fe-E*oe)-d*(i*Fe-u*oe)+re*(i*E-u*_),e[11]=-(r*(_*Z-E*I)-d*(i*Z-u*I)+P*(i*E-u*_)),e[12]=-(d*(I*de-D*oe)-P*(_*de-x*oe)+re*(_*D-x*I)),e[13]=r*(I*de-D*oe)-P*(i*de-o*oe)+re*(i*D-o*I),e[14]=-(r*(_*de-x*oe)-d*(i*de-o*oe)+re*(i*x-o*_)),e[15]=r*(_*D-x*I)-d*(i*D-o*I)+P*(i*x-o*_),e}function Oh(e){var n=e[0],r=e[1],i=e[2],o=e[3],u=e[4],d=e[5],_=e[6],x=e[7],E=e[8],P=e[9],I=e[10],D=e[11],Z=e[12],re=e[13],oe=e[14],de=e[15],Fe=n*d-r*u,it=n*_-i*u,vt=n*x-o*u,xt=r*_-i*d,Gt=r*x-o*d,Xt=i*x-o*_,nr=E*re-P*Z,mr=E*oe-I*Z,en=E*de-D*Z,hn=P*oe-I*re,wr=P*de-D*re,Pn=I*de-D*oe;return Fe*Pn-it*wr+vt*hn+xt*en-Gt*mr+Xt*nr}function zu(e,n,r){var i=n[0],o=n[1],u=n[2],d=n[3],_=n[4],x=n[5],E=n[6],P=n[7],I=n[8],D=n[9],Z=n[10],re=n[11],oe=n[12],de=n[13],Fe=n[14],it=n[15],vt=r[0],xt=r[1],Gt=r[2],Xt=r[3];return e[0]=vt*i+xt*_+Gt*I+Xt*oe,e[1]=vt*o+xt*x+Gt*D+Xt*de,e[2]=vt*u+xt*E+Gt*Z+Xt*Fe,e[3]=vt*d+xt*P+Gt*re+Xt*it,vt=r[4],xt=r[5],Gt=r[6],Xt=r[7],e[4]=vt*i+xt*_+Gt*I+Xt*oe,e[5]=vt*o+xt*x+Gt*D+Xt*de,e[6]=vt*u+xt*E+Gt*Z+Xt*Fe,e[7]=vt*d+xt*P+Gt*re+Xt*it,vt=r[8],xt=r[9],Gt=r[10],Xt=r[11],e[8]=vt*i+xt*_+Gt*I+Xt*oe,e[9]=vt*o+xt*x+Gt*D+Xt*de,e[10]=vt*u+xt*E+Gt*Z+Xt*Fe,e[11]=vt*d+xt*P+Gt*re+Xt*it,vt=r[12],xt=r[13],Gt=r[14],Xt=r[15],e[12]=vt*i+xt*_+Gt*I+Xt*oe,e[13]=vt*o+xt*x+Gt*D+Xt*de,e[14]=vt*u+xt*E+Gt*Z+Xt*Fe,e[15]=vt*d+xt*P+Gt*re+Xt*it,e}function ra(e,n,r){var i=r[0],o=r[1],u=r[2],d,_,x,E,P,I,D,Z,re,oe,de,Fe;return n===e?(e[12]=n[0]*i+n[4]*o+n[8]*u+n[12],e[13]=n[1]*i+n[5]*o+n[9]*u+n[13],e[14]=n[2]*i+n[6]*o+n[10]*u+n[14],e[15]=n[3]*i+n[7]*o+n[11]*u+n[15]):(d=n[0],_=n[1],x=n[2],E=n[3],P=n[4],I=n[5],D=n[6],Z=n[7],re=n[8],oe=n[9],de=n[10],Fe=n[11],e[0]=d,e[1]=_,e[2]=x,e[3]=E,e[4]=P,e[5]=I,e[6]=D,e[7]=Z,e[8]=re,e[9]=oe,e[10]=de,e[11]=Fe,e[12]=d*i+P*o+re*u+n[12],e[13]=_*i+I*o+oe*u+n[13],e[14]=x*i+D*o+de*u+n[14],e[15]=E*i+Z*o+Fe*u+n[15]),e}function Uu(e,n,r){var i=r[0],o=r[1],u=r[2];return e[0]=n[0]*i,e[1]=n[1]*i,e[2]=n[2]*i,e[3]=n[3]*i,e[4]=n[4]*o,e[5]=n[5]*o,e[6]=n[6]*o,e[7]=n[7]*o,e[8]=n[8]*u,e[9]=n[9]*u,e[10]=n[10]*u,e[11]=n[11]*u,e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],e}function To(e,n,r,i){var o=i[0],u=i[1],d=i[2],_=Math.hypot(o,u,d),x,E,P,I,D,Z,re,oe,de,Fe,it,vt,xt,Gt,Xt,nr,mr,en,hn,wr,Pn,jn,yi,Io;return _<xa.Ib?null:(_=1/_,o*=_,u*=_,d*=_,x=Math.sin(r),E=Math.cos(r),P=1-E,I=n[0],D=n[1],Z=n[2],re=n[3],oe=n[4],de=n[5],Fe=n[6],it=n[7],vt=n[8],xt=n[9],Gt=n[10],Xt=n[11],nr=o*o*P+E,mr=u*o*P+d*x,en=d*o*P-u*x,hn=o*u*P-d*x,wr=u*u*P+E,Pn=d*u*P+o*x,jn=o*d*P+u*x,yi=u*d*P-o*x,Io=d*d*P+E,e[0]=I*nr+oe*mr+vt*en,e[1]=D*nr+de*mr+xt*en,e[2]=Z*nr+Fe*mr+Gt*en,e[3]=re*nr+it*mr+Xt*en,e[4]=I*hn+oe*wr+vt*Pn,e[5]=D*hn+de*wr+xt*Pn,e[6]=Z*hn+Fe*wr+Gt*Pn,e[7]=re*hn+it*wr+Xt*Pn,e[8]=I*jn+oe*yi+vt*Io,e[9]=D*jn+de*yi+xt*Io,e[10]=Z*jn+Fe*yi+Gt*Io,e[11]=re*jn+it*yi+Xt*Io,n!==e&&(e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15]),e)}function ws(e,n,r){var i=Math.sin(r),o=Math.cos(r),u=n[4],d=n[5],_=n[6],x=n[7],E=n[8],P=n[9],I=n[10],D=n[11];return n!==e&&(e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15]),e[4]=u*o+E*i,e[5]=d*o+P*i,e[6]=_*o+I*i,e[7]=x*o+D*i,e[8]=E*o-u*i,e[9]=P*o-d*i,e[10]=I*o-_*i,e[11]=D*o-x*i,e}function Rh(e,n,r){var i=Math.sin(r),o=Math.cos(r),u=n[0],d=n[1],_=n[2],x=n[3],E=n[8],P=n[9],I=n[10],D=n[11];return n!==e&&(e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15]),e[0]=u*o-E*i,e[1]=d*o-P*i,e[2]=_*o-I*i,e[3]=x*o-D*i,e[8]=u*i+E*o,e[9]=d*i+P*o,e[10]=_*i+I*o,e[11]=x*i+D*o,e}function Lh(e,n,r){var i=Math.sin(r),o=Math.cos(r),u=n[0],d=n[1],_=n[2],x=n[3],E=n[4],P=n[5],I=n[6],D=n[7];return n!==e&&(e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15]),e[0]=u*o+E*i,e[1]=d*o+P*i,e[2]=_*o+I*i,e[3]=x*o+D*i,e[4]=E*o-u*i,e[5]=P*o-d*i,e[6]=I*o-_*i,e[7]=D*o-x*i,e}function Wp(e,n){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function Cd(e,n){return e[0]=n[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=n[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Td(e,n,r){var i=r[0],o=r[1],u=r[2],d=Math.hypot(i,o,u),_,x,E;return d<xa.Ib?null:(d=1/d,i*=d,o*=d,u*=d,_=Math.sin(n),x=Math.cos(n),E=1-x,e[0]=i*i*E+x,e[1]=o*i*E+u*_,e[2]=u*i*E-o*_,e[3]=0,e[4]=i*o*E-u*_,e[5]=o*o*E+x,e[6]=u*o*E+i*_,e[7]=0,e[8]=i*u*E+o*_,e[9]=o*u*E-i*_,e[10]=u*u*E+x,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function op(e,n){var r=Math.sin(n),i=Math.cos(n);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Ad(e,n){var r=Math.sin(n),i=Math.cos(n);return e[0]=i,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Md(e,n){var r=Math.sin(n),i=Math.cos(n);return e[0]=i,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function wf(e,n,r){var i=n[0],o=n[1],u=n[2],d=n[3],_=i+i,x=o+o,E=u+u,P=i*_,I=i*x,D=i*E,Z=o*x,re=o*E,oe=u*E,de=d*_,Fe=d*x,it=d*E;return e[0]=1-(Z+oe),e[1]=I+it,e[2]=D-Fe,e[3]=0,e[4]=I-it,e[5]=1-(P+oe),e[6]=re+de,e[7]=0,e[8]=D+Fe,e[9]=re-de,e[10]=1-(P+Z),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function Xp(e,n){var r=new xa.WT(3),i=-n[0],o=-n[1],u=-n[2],d=n[3],_=n[4],x=n[5],E=n[6],P=n[7],I=i*i+o*o+u*u+d*d;return I>0?(r[0]=(_*d+P*i+x*u-E*o)*2/I,r[1]=(x*d+P*o+E*i-_*u)*2/I,r[2]=(E*d+P*u+_*o-x*i)*2/I):(r[0]=(_*d+P*i+x*u-E*o)*2,r[1]=(x*d+P*o+E*i-_*u)*2,r[2]=(E*d+P*u+_*o-x*i)*2),wf(e,n,r),e}function Yp(e,n){return e[0]=n[12],e[1]=n[13],e[2]=n[14],e}function Cf(e,n){var r=n[0],i=n[1],o=n[2],u=n[4],d=n[5],_=n[6],x=n[8],E=n[9],P=n[10];return e[0]=Math.hypot(r,i,o),e[1]=Math.hypot(u,d,_),e[2]=Math.hypot(x,E,P),e}function Ia(e,n){var r=new xa.WT(3);Cf(r,n);var i=1/r[0],o=1/r[1],u=1/r[2],d=n[0]*i,_=n[1]*o,x=n[2]*u,E=n[4]*i,P=n[5]*o,I=n[6]*u,D=n[8]*i,Z=n[9]*o,re=n[10]*u,oe=d+P+re,de=0;return oe>0?(de=Math.sqrt(oe+1)*2,e[3]=.25*de,e[0]=(I-Z)/de,e[1]=(D-x)/de,e[2]=(_-E)/de):d>P&&d>re?(de=Math.sqrt(1+d-P-re)*2,e[3]=(I-Z)/de,e[0]=.25*de,e[1]=(_+E)/de,e[2]=(D+x)/de):P>re?(de=Math.sqrt(1+P-d-re)*2,e[3]=(D-x)/de,e[0]=(_+E)/de,e[1]=.25*de,e[2]=(I+Z)/de):(de=Math.sqrt(1+re-d-P)*2,e[3]=(_-E)/de,e[0]=(D+x)/de,e[1]=(I+Z)/de,e[2]=.25*de),e}function sp(e,n,r,i){var o=n[0],u=n[1],d=n[2],_=n[3],x=o+o,E=u+u,P=d+d,I=o*x,D=o*E,Z=o*P,re=u*E,oe=u*P,de=d*P,Fe=_*x,it=_*E,vt=_*P,xt=i[0],Gt=i[1],Xt=i[2];return e[0]=(1-(re+de))*xt,e[1]=(D+vt)*xt,e[2]=(Z-it)*xt,e[3]=0,e[4]=(D-vt)*Gt,e[5]=(1-(I+de))*Gt,e[6]=(oe+Fe)*Gt,e[7]=0,e[8]=(Z+it)*Xt,e[9]=(oe-Fe)*Xt,e[10]=(1-(I+re))*Xt,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function jl(e,n,r,i,o){var u=n[0],d=n[1],_=n[2],x=n[3],E=u+u,P=d+d,I=_+_,D=u*E,Z=u*P,re=u*I,oe=d*P,de=d*I,Fe=_*I,it=x*E,vt=x*P,xt=x*I,Gt=i[0],Xt=i[1],nr=i[2],mr=o[0],en=o[1],hn=o[2],wr=(1-(oe+Fe))*Gt,Pn=(Z+xt)*Gt,jn=(re-vt)*Gt,yi=(Z-xt)*Xt,Io=(1-(D+Fe))*Xt,Ms=(de+it)*Xt,sl=(re+vt)*nr,Ic=(de-it)*nr,Sl=(1-(D+oe))*nr;return e[0]=wr,e[1]=Pn,e[2]=jn,e[3]=0,e[4]=yi,e[5]=Io,e[6]=Ms,e[7]=0,e[8]=sl,e[9]=Ic,e[10]=Sl,e[11]=0,e[12]=r[0]+mr-(wr*mr+yi*en+sl*hn),e[13]=r[1]+en-(Pn*mr+Io*en+Ic*hn),e[14]=r[2]+hn-(jn*mr+Ms*en+Sl*hn),e[15]=1,e}function Tf(e,n){var r=n[0],i=n[1],o=n[2],u=n[3],d=r+r,_=i+i,x=o+o,E=r*d,P=i*d,I=i*_,D=o*d,Z=o*_,re=o*x,oe=u*d,de=u*_,Fe=u*x;return e[0]=1-I-re,e[1]=P+Fe,e[2]=D-de,e[3]=0,e[4]=P-Fe,e[5]=1-E-re,e[6]=Z+oe,e[7]=0,e[8]=D+de,e[9]=Z-oe,e[10]=1-E-I,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function up(e,n,r,i,o,u,d){var _=1/(r-n),x=1/(o-i),E=1/(u-d);return e[0]=u*2*_,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=u*2*x,e[6]=0,e[7]=0,e[8]=(r+n)*_,e[9]=(o+i)*x,e[10]=(d+u)*E,e[11]=-1,e[12]=0,e[13]=0,e[14]=d*u*2*E,e[15]=0,e}function qp(e,n,r,i,o){var u=1/Math.tan(n/2),d;return e[0]=u/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=u,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,o!=null&&o!==Infinity?(d=1/(i-o),e[10]=(o+i)*d,e[14]=2*o*i*d):(e[10]=-1,e[14]=-2*i),e}var B=qp;function ve(e,n,r,i,o){var u=1/Math.tan(n/2),d;return e[0]=u/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=u,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,o!=null&&o!==Infinity?(d=1/(i-o),e[10]=o*d,e[14]=o*i*d):(e[10]=-1,e[14]=-i),e}function Be(e,n,r,i){var o=Math.tan(n.upDegrees*Math.PI/180),u=Math.tan(n.downDegrees*Math.PI/180),d=Math.tan(n.leftDegrees*Math.PI/180),_=Math.tan(n.rightDegrees*Math.PI/180),x=2/(d+_),E=2/(o+u);return e[0]=x,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=E,e[6]=0,e[7]=0,e[8]=-((d-_)*x*.5),e[9]=(o-u)*E*.5,e[10]=i/(r-i),e[11]=-1,e[12]=0,e[13]=0,e[14]=i*r/(r-i),e[15]=0,e}function It(e,n,r,i,o,u,d){var _=1/(n-r),x=1/(i-o),E=1/(u-d);return e[0]=-2*_,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*x,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*E,e[11]=0,e[12]=(n+r)*_,e[13]=(o+i)*x,e[14]=(d+u)*E,e[15]=1,e}var ar=It;function Pt(e,n,r,i,o,u,d){var _=1/(n-r),x=1/(i-o),E=1/(u-d);return e[0]=-2*_,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*x,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=E,e[11]=0,e[12]=(n+r)*_,e[13]=(o+i)*x,e[14]=u*E,e[15]=1,e}function Qt(e,n,r,i){var o,u,d,_,x,E,P,I,D,Z,re=n[0],oe=n[1],de=n[2],Fe=i[0],it=i[1],vt=i[2],xt=r[0],Gt=r[1],Xt=r[2];return Math.abs(re-xt)<xa.Ib&&Math.abs(oe-Gt)<xa.Ib&&Math.abs(de-Xt)<xa.Ib?xc(e):(P=re-xt,I=oe-Gt,D=de-Xt,Z=1/Math.hypot(P,I,D),P*=Z,I*=Z,D*=Z,o=it*D-vt*I,u=vt*P-Fe*D,d=Fe*I-it*P,Z=Math.hypot(o,u,d),Z?(Z=1/Z,o*=Z,u*=Z,d*=Z):(o=0,u=0,d=0),_=I*d-D*u,x=D*o-P*d,E=P*u-I*o,Z=Math.hypot(_,x,E),Z?(Z=1/Z,_*=Z,x*=Z,E*=Z):(_=0,x=0,E=0),e[0]=o,e[1]=_,e[2]=P,e[3]=0,e[4]=u,e[5]=x,e[6]=I,e[7]=0,e[8]=d,e[9]=E,e[10]=D,e[11]=0,e[12]=-(o*re+u*oe+d*de),e[13]=-(_*re+x*oe+E*de),e[14]=-(P*re+I*oe+D*de),e[15]=1,e)}function lr(e,n,r,i){var o=n[0],u=n[1],d=n[2],_=i[0],x=i[1],E=i[2],P=o-r[0],I=u-r[1],D=d-r[2],Z=P*P+I*I+D*D;Z>0&&(Z=1/Math.sqrt(Z),P*=Z,I*=Z,D*=Z);var re=x*D-E*I,oe=E*P-_*D,de=_*I-x*P;return Z=re*re+oe*oe+de*de,Z>0&&(Z=1/Math.sqrt(Z),re*=Z,oe*=Z,de*=Z),e[0]=re,e[1]=oe,e[2]=de,e[3]=0,e[4]=I*de-D*oe,e[5]=D*re-P*de,e[6]=P*oe-I*re,e[7]=0,e[8]=P,e[9]=I,e[10]=D,e[11]=0,e[12]=o,e[13]=u,e[14]=d,e[15]=1,e}function vr(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function yr(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function Cr(e,n,r){return e[0]=n[0]+r[0],e[1]=n[1]+r[1],e[2]=n[2]+r[2],e[3]=n[3]+r[3],e[4]=n[4]+r[4],e[5]=n[5]+r[5],e[6]=n[6]+r[6],e[7]=n[7]+r[7],e[8]=n[8]+r[8],e[9]=n[9]+r[9],e[10]=n[10]+r[10],e[11]=n[11]+r[11],e[12]=n[12]+r[12],e[13]=n[13]+r[13],e[14]=n[14]+r[14],e[15]=n[15]+r[15],e}function Tr(e,n,r){return e[0]=n[0]-r[0],e[1]=n[1]-r[1],e[2]=n[2]-r[2],e[3]=n[3]-r[3],e[4]=n[4]-r[4],e[5]=n[5]-r[5],e[6]=n[6]-r[6],e[7]=n[7]-r[7],e[8]=n[8]-r[8],e[9]=n[9]-r[9],e[10]=n[10]-r[10],e[11]=n[11]-r[11],e[12]=n[12]-r[12],e[13]=n[13]-r[13],e[14]=n[14]-r[14],e[15]=n[15]-r[15],e}function Ur(e,n,r){return e[0]=n[0]*r,e[1]=n[1]*r,e[2]=n[2]*r,e[3]=n[3]*r,e[4]=n[4]*r,e[5]=n[5]*r,e[6]=n[6]*r,e[7]=n[7]*r,e[8]=n[8]*r,e[9]=n[9]*r,e[10]=n[10]*r,e[11]=n[11]*r,e[12]=n[12]*r,e[13]=n[13]*r,e[14]=n[14]*r,e[15]=n[15]*r,e}function gr(e,n,r,i){return e[0]=n[0]+r[0]*i,e[1]=n[1]+r[1]*i,e[2]=n[2]+r[2]*i,e[3]=n[3]+r[3]*i,e[4]=n[4]+r[4]*i,e[5]=n[5]+r[5]*i,e[6]=n[6]+r[6]*i,e[7]=n[7]+r[7]*i,e[8]=n[8]+r[8]*i,e[9]=n[9]+r[9]*i,e[10]=n[10]+r[10]*i,e[11]=n[11]+r[11]*i,e[12]=n[12]+r[12]*i,e[13]=n[13]+r[13]*i,e[14]=n[14]+r[14]*i,e[15]=n[15]+r[15]*i,e}function Sr(e,n){return e[0]===n[0]&&e[1]===n[1]&&e[2]===n[2]&&e[3]===n[3]&&e[4]===n[4]&&e[5]===n[5]&&e[6]===n[6]&&e[7]===n[7]&&e[8]===n[8]&&e[9]===n[9]&&e[10]===n[10]&&e[11]===n[11]&&e[12]===n[12]&&e[13]===n[13]&&e[14]===n[14]&&e[15]===n[15]}function ut(e,n){var r=e[0],i=e[1],o=e[2],u=e[3],d=e[4],_=e[5],x=e[6],E=e[7],P=e[8],I=e[9],D=e[10],Z=e[11],re=e[12],oe=e[13],de=e[14],Fe=e[15],it=n[0],vt=n[1],xt=n[2],Gt=n[3],Xt=n[4],nr=n[5],mr=n[6],en=n[7],hn=n[8],wr=n[9],Pn=n[10],jn=n[11],yi=n[12],Io=n[13],Ms=n[14],sl=n[15];return Math.abs(r-it)<=xa.Ib*Math.max(1,Math.abs(r),Math.abs(it))&&Math.abs(i-vt)<=xa.Ib*Math.max(1,Math.abs(i),Math.abs(vt))&&Math.abs(o-xt)<=xa.Ib*Math.max(1,Math.abs(o),Math.abs(xt))&&Math.abs(u-Gt)<=xa.Ib*Math.max(1,Math.abs(u),Math.abs(Gt))&&Math.abs(d-Xt)<=xa.Ib*Math.max(1,Math.abs(d),Math.abs(Xt))&&Math.abs(_-nr)<=xa.Ib*Math.max(1,Math.abs(_),Math.abs(nr))&&Math.abs(x-mr)<=xa.Ib*Math.max(1,Math.abs(x),Math.abs(mr))&&Math.abs(E-en)<=xa.Ib*Math.max(1,Math.abs(E),Math.abs(en))&&Math.abs(P-hn)<=xa.Ib*Math.max(1,Math.abs(P),Math.abs(hn))&&Math.abs(I-wr)<=xa.Ib*Math.max(1,Math.abs(I),Math.abs(wr))&&Math.abs(D-Pn)<=xa.Ib*Math.max(1,Math.abs(D),Math.abs(Pn))&&Math.abs(Z-jn)<=xa.Ib*Math.max(1,Math.abs(Z),Math.abs(jn))&&Math.abs(re-yi)<=xa.Ib*Math.max(1,Math.abs(re),Math.abs(yi))&&Math.abs(oe-Io)<=xa.Ib*Math.max(1,Math.abs(oe),Math.abs(Io))&&Math.abs(de-Ms)<=xa.Ib*Math.max(1,Math.abs(de),Math.abs(Ms))&&Math.abs(Fe-sl)<=xa.Ib*Math.max(1,Math.abs(Fe),Math.abs(sl))}var jt=zu,_r=Tr,kr,ur,Rr=(kr=(0,Fr.b2)(),kr(ur=function(){function e(){(0,Ct.Z)(this,e),(0,C.Z)(this,"viewport",void 0),(0,C.Z)(this,"overridedViewProjectionMatrix",void 0),(0,C.Z)(this,"jitteredViewProjectionMatrix",void 0),(0,C.Z)(this,"jitteredProjectionMatrix",void 0),(0,C.Z)(this,"viewMatrixInverse",void 0),(0,C.Z)(this,"cameraPosition",void 0)}return(0,qt.Z)(e,[{key:"init",value:function(){}},{key:"update",value:function(r){this.viewport=r,this.viewMatrixInverse=Ss(),rh(this.viewMatrixInverse,r.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getModelMatrix",value:function(){return this.viewport.getModelMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var r=this.viewport.getCenter(),i=(0,An.Z)(r,2),o=i[0],u=i[1];return[o,u]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(r,i){return this.viewport.projectFlat(r,i)}},{key:"setViewProjectionMatrix",value:function(r){this.overridedViewProjectionMatrix=r}},{key:"jitterProjectionMatrix",value:function(r,i){var o=Wp(Ss(),[r,i,0]);this.jitteredProjectionMatrix=zu(Ss(),o,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=zu(Ss(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),e}())||ur),qr,Nn;function er(e,n){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=rr(e))||n&&e&&typeof e.length=="number"){r&&(e=r);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(E){throw E},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var u=!0,d=!1,_;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return u=E.done,E},e:function(E){d=!0,_=E},f:function(){try{!u&&r.return!=null&&r.return()}finally{if(d)throw _}}}}function rr(e,n){if(!!e){if(typeof e=="string")return mn(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return mn(e,n)}}function mn(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}var Hr=(qr=(0,Fr.b2)(),qr(Nn=function(){function e(){(0,Ct.Z)(this,e),(0,C.Z)(this,"container",void 0),(0,C.Z)(this,"controlCorners",void 0),(0,C.Z)(this,"controlContainer",void 0),(0,C.Z)(this,"scene",void 0),(0,C.Z)(this,"mapsService",void 0),(0,C.Z)(this,"controls",[]),(0,C.Z)(this,"unAddControls",[])}return(0,qt.Z)(e,[{key:"init",value:function(r,i){this.container=r.container,this.scene=i,this.mapsService=i.get($t.IMapService),this.initControlPos()}},{key:"addControl",value:function(r,i){var o=i.get($t.IMapService);o.map?(r.addTo(this.scene),this.controls.push(r)):this.unAddControls.push(r)}},{key:"getControlByName",value:function(r){return this.controls.find(function(i){return i.controlOption.name===r})}},{key:"removeControl",value:function(r){var i=this.controls.indexOf(r);return i>-1&&this.controls.splice(i,1),r.remove(),this}},{key:"addControls",value:function(){var r=this;this.unAddControls.forEach(function(i){i.addTo(r.scene),r.controls.push(i)}),this.unAddControls=[]}},{key:"destroy",value:function(){var r=er(this.controls),i;try{for(r.s();!(i=r.n()).done;){var o=i.value;o.remove()}}catch(u){r.e(u)}finally{r.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var r=this.controlCorners={},i="l7-",o=this.controlContainer=za("div",i+"control-container",this.container);function u(){var d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],_=d.map(function(x){return i+x}).join(" ");r[d.join("")]=za("div",_,o)}u(["top","left"]),u(["top","right"]),u(["bottom","left"]),u(["bottom","right"]),u(["top","center"]),u(["right","center"]),u(["left","center"]),u(["bottom","center"])}},{key:"clearControlPos",value:function(){for(var r in this.controlCorners)this.controlCorners[r]&&lc(this.controlCorners[r]);this.controlContainer&&lc(this.controlContainer),delete this.controlCorners,delete this.controlContainer}}]),e}())||Nn),xr,Wr,Kr=(xr=(0,Fr.b2)(),xr(Wr=function(){function e(){(0,Ct.Z)(this,e),(0,C.Z)(this,"container",void 0),(0,C.Z)(this,"scene",void 0),(0,C.Z)(this,"mapsService",void 0),(0,C.Z)(this,"markers",[]),(0,C.Z)(this,"markerLayers",[]),(0,C.Z)(this,"unAddMarkers",[]),(0,C.Z)(this,"unAddMarkerLayers",[])}return(0,qt.Z)(e,[{key:"addMarkerLayer",value:function(r){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(r),r.addTo(this.scene)):this.unAddMarkerLayers.push(r)}},{key:"removeMarkerLayer",value:function(r){r.destroy(),this.markerLayers.indexOf(r);var i=this.markerLayers.indexOf(r);i>-1&&this.markerLayers.splice(i,1)}},{key:"addMarker",value:function(r){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(r),r.addTo(this.scene)):this.unAddMarkers.push(r)}},{key:"addMarkers",value:function(){var r=this;this.unAddMarkers.forEach(function(i){i.addTo(r.scene),r.markers.push(i)}),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var r=this;this.unAddMarkerLayers.forEach(function(i){r.markerLayers.push(i),i.addTo(r.scene)}),this.unAddMarkers=[]}},{key:"removeMarker",value:function(r){r.remove(),this.markers.indexOf(r);var i=this.markers.indexOf(r);i>-1&&this.markers.splice(i,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(r){this.scene=r,this.mapsService=r.get($t.IMapService)}},{key:"destroy",value:function(){this.markers.forEach(function(r){r.remove()}),this.markers=[],this.markerLayers.forEach(function(r){r.destroy()}),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(r){r.destroy()}}]),e}())||Wr),gi,ei,Xr=(gi=(0,Fr.b2)(),gi(ei=function(){function e(){(0,Ct.Z)(this,e),(0,C.Z)(this,"scene",void 0),(0,C.Z)(this,"popup",void 0),(0,C.Z)(this,"mapsService",void 0),(0,C.Z)(this,"unAddPopup",void 0)}return(0,qt.Z)(e,[{key:"removePopup",value:function(r){r.remove()}},{key:"destroy",value:function(){this.popup.remove()}},{key:"addPopup",value:function(r){this.popup&&this.popup.remove(),this.mapsService.map&&this.mapsService.getMarkerContainer()?(r.addTo(this.scene),this.popup=r):this.unAddPopup=r}},{key:"initPopup",value:function(){this.unAddPopup&&(this.addPopup(this.unAddPopup),this.unAddPopup=null)}},{key:"init",value:function(r){this.scene=r,this.mapsService=r.get($t.IMapService)}}]),e}())||ei),rn=L(82492),$n=L.n(rn),ui={MapToken:"\u60A8\u6B63\u5728\u4F7F\u7528 Demo\u6D4B\u8BD5\u5730\u56FEtoken\uFF0C\u5982\u679C\u751F\u4EA7\u73AF\u5883\u4E2D\u4F7F\u7528\u53BB\u5BF9\u5E94\u5730\u56FE\u8BF7\u6CE8\u518CToken",SDK:"\u8BF7\u786E\u8BA4\u5F15\u5165\u4E86mapbox-gl api\u4E14\u5728L7\u4E4B\u524D\u5F15\u5165"},zi=ui,qa,no;function ki(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function No(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?ki(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ki(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var Va={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},Ho={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",selectColor:"blue",enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},yo=(qa=(0,Fr.b2)(),qa(no=function(){function e(){(0,Ct.Z)(this,e),(0,C.Z)(this,"sceneConfigCache",{}),(0,C.Z)(this,"layerConfigCache",{})}return(0,qt.Z)(e,[{key:"getSceneConfig",value:function(r){return this.sceneConfigCache[r]}},{key:"getSceneWarninfo",value:function(r){return zi[r]}},{key:"setSceneConfig",value:function(r,i){this.sceneConfigCache[r]=No(No({},Va),i)}},{key:"getLayerConfig",value:function(r){return this.layerConfigCache[r]}},{key:"setLayerConfig",value:function(r,i,o){this.layerConfigCache[i]=No({},$n()({},this.sceneConfigCache[r],Ho,o))}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),e}())||no);function Bn(e,n,r,i){!r||Object.defineProperty(e,n,{enumerable:r.enumerable,configurable:r.configurable,writable:r.writable,value:r.initializer?r.initializer.call(i):void 0})}function Ln(e,n,r,i,o){var u={};return Object.keys(i).forEach(function(d){u[d]=i[d]}),u.enumerable=!!u.enumerable,u.configurable=!!u.configurable,("value"in u||u.initializer)&&(u.writable=!0),u=r.slice().reverse().reduce(function(d,_){return _(e,n,d)||d},u),o&&u.initializer!==void 0&&(u.value=u.initializer?u.initializer.call(o):void 0,u.initializer=void 0),u.initializer===void 0&&(Object.defineProperty(e,n,u),u=null),u}function ts(){var e=new xa.WT(4);return xa.WT!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function po(e){var n=new glMatrix.ARRAY_TYPE(4);return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n}function xi(e,n,r,i){var o=new xa.WT(4);return o[0]=e,o[1]=n,o[2]=r,o[3]=i,o}function Wo(e,n){return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e}function ua(e,n,r,i,o){return e[0]=n,e[1]=r,e[2]=i,e[3]=o,e}function us(e,n,r){return e[0]=n[0]+r[0],e[1]=n[1]+r[1],e[2]=n[2]+r[2],e[3]=n[3]+r[3],e}function ai(e,n,r){return e[0]=n[0]-r[0],e[1]=n[1]-r[1],e[2]=n[2]-r[2],e[3]=n[3]-r[3],e}function Ui(e,n,r){return e[0]=n[0]*r[0],e[1]=n[1]*r[1],e[2]=n[2]*r[2],e[3]=n[3]*r[3],e}function ya(e,n,r){return e[0]=n[0]/r[0],e[1]=n[1]/r[1],e[2]=n[2]/r[2],e[3]=n[3]/r[3],e}function Ao(e,n){return e[0]=Math.ceil(n[0]),e[1]=Math.ceil(n[1]),e[2]=Math.ceil(n[2]),e[3]=Math.ceil(n[3]),e}function Gl(e,n){return e[0]=Math.floor(n[0]),e[1]=Math.floor(n[1]),e[2]=Math.floor(n[2]),e[3]=Math.floor(n[3]),e}function Ae(e,n,r){return e[0]=Math.min(n[0],r[0]),e[1]=Math.min(n[1],r[1]),e[2]=Math.min(n[2],r[2]),e[3]=Math.min(n[3],r[3]),e}function Bt(e,n,r){return e[0]=Math.max(n[0],r[0]),e[1]=Math.max(n[1],r[1]),e[2]=Math.max(n[2],r[2]),e[3]=Math.max(n[3],r[3]),e}function St(e,n){return e[0]=Math.round(n[0]),e[1]=Math.round(n[1]),e[2]=Math.round(n[2]),e[3]=Math.round(n[3]),e}function fn(e,n,r){return e[0]=n[0]*r,e[1]=n[1]*r,e[2]=n[2]*r,e[3]=n[3]*r,e}function Gi(e,n,r,i){return e[0]=n[0]+r[0]*i,e[1]=n[1]+r[1]*i,e[2]=n[2]+r[2]*i,e[3]=n[3]+r[3]*i,e}function Ee(e,n){var r=n[0]-e[0],i=n[1]-e[1],o=n[2]-e[2],u=n[3]-e[3];return Math.hypot(r,i,o,u)}function ue(e,n){var r=n[0]-e[0],i=n[1]-e[1],o=n[2]-e[2],u=n[3]-e[3];return r*r+i*i+o*o+u*u}function je(e){var n=e[0],r=e[1],i=e[2],o=e[3];return Math.hypot(n,r,i,o)}function ft(e){var n=e[0],r=e[1],i=e[2],o=e[3];return n*n+r*r+i*i+o*o}function At(e,n){return e[0]=-n[0],e[1]=-n[1],e[2]=-n[2],e[3]=-n[3],e}function $e(e,n){return e[0]=1/n[0],e[1]=1/n[1],e[2]=1/n[2],e[3]=1/n[3],e}function De(e,n){var r=n[0],i=n[1],o=n[2],u=n[3],d=r*r+i*i+o*o+u*u;return d>0&&(d=1/Math.sqrt(d)),e[0]=r*d,e[1]=i*d,e[2]=o*d,e[3]=u*d,e}function rt(e,n){return e[0]*n[0]+e[1]*n[1]+e[2]*n[2]+e[3]*n[3]}function ge(e,n,r,i){var o=r[0]*i[1]-r[1]*i[0],u=r[0]*i[2]-r[2]*i[0],d=r[0]*i[3]-r[3]*i[0],_=r[1]*i[2]-r[2]*i[1],x=r[1]*i[3]-r[3]*i[1],E=r[2]*i[3]-r[3]*i[2],P=n[0],I=n[1],D=n[2],Z=n[3];return e[0]=I*E-D*x+Z*_,e[1]=-(P*E)+D*d-Z*u,e[2]=P*x-I*d+Z*o,e[3]=-(P*_)+I*u-D*o,e}function Ze(e,n,r,i){var o=n[0],u=n[1],d=n[2],_=n[3];return e[0]=o+i*(r[0]-o),e[1]=u+i*(r[1]-u),e[2]=d+i*(r[2]-d),e[3]=_+i*(r[3]-_),e}function Se(e,n){n=n||1;var r,i,o,u,d,_;do r=glMatrix.RANDOM()*2-1,i=glMatrix.RANDOM()*2-1,d=r*r+i*i;while(d>=1);do o=glMatrix.RANDOM()*2-1,u=glMatrix.RANDOM()*2-1,_=o*o+u*u;while(_>=1);var x=Math.sqrt((1-d)/_);return e[0]=n*r,e[1]=n*i,e[2]=n*o*x,e[3]=n*u*x,e}function lt(e,n,r){var i=n[0],o=n[1],u=n[2],d=n[3];return e[0]=r[0]*i+r[4]*o+r[8]*u+r[12]*d,e[1]=r[1]*i+r[5]*o+r[9]*u+r[13]*d,e[2]=r[2]*i+r[6]*o+r[10]*u+r[14]*d,e[3]=r[3]*i+r[7]*o+r[11]*u+r[15]*d,e}function wt(e,n,r){var i=n[0],o=n[1],u=n[2],d=r[0],_=r[1],x=r[2],E=r[3],P=E*i+_*u-x*o,I=E*o+x*i-d*u,D=E*u+d*o-_*i,Z=-d*i-_*o-x*u;return e[0]=P*E+Z*-d+I*-x-D*-_,e[1]=I*E+Z*-_+D*-d-P*-x,e[2]=D*E+Z*-x+P*-_-I*-d,e[3]=n[3],e}function fr(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function Nr(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function Br(e,n){return e[0]===n[0]&&e[1]===n[1]&&e[2]===n[2]&&e[3]===n[3]}function nn(e,n){var r=e[0],i=e[1],o=e[2],u=e[3],d=n[0],_=n[1],x=n[2],E=n[3];return Math.abs(r-d)<=glMatrix.EPSILON*Math.max(1,Math.abs(r),Math.abs(d))&&Math.abs(i-_)<=glMatrix.EPSILON*Math.max(1,Math.abs(i),Math.abs(_))&&Math.abs(o-x)<=glMatrix.EPSILON*Math.max(1,Math.abs(o),Math.abs(x))&&Math.abs(u-E)<=glMatrix.EPSILON*Math.max(1,Math.abs(u),Math.abs(E))}var Lr=null,En=null,sn=null,_n=null,yn=null,dn=null,Jn=null,Ea=function(){var e=ts();return function(n,r,i,o,u,d){var _,x;for(r||(r=4),i||(i=0),o?x=Math.min(o*r+i,n.length):x=n.length,_=i;_<x;_+=r)e[0]=n[_],e[1]=n[_+1],e[2]=n[_+2],e[3]=n[_+3],u(e,e,d),n[_]=e[0],n[_+1]=e[1],n[_+2]=e[2],n[_+3]=e[3];return n}}(),Bo=Math.PI/180,Da=512,pa=4003e4;function tl(e){var n=e.latitude,r=n===void 0?0:n,i=e.zoom,o=i===void 0?0:i,u=e.scale,d=e.highPrecision,_=d===void 0?!1:d,x=e.flipY,E=x===void 0?!1:x;u=u!==void 0?u:Math.pow(2,o);var P={},I=Da*u,D=Math.cos(r*Bo),Z=I/360,re=Z/D,oe=I/pa/D;if(P.pixelsPerMeter=[oe,-oe,oe],P.metersPerPixel=[1/oe,-1/oe,1/oe],P.pixelsPerDegree=[Z,-re,oe],P.degreesPerPixel=[1/Z,-1/re,1/oe],_){var de=Bo*Math.tan(r*Bo)/D,Fe=Z*de/2,it=I/pa*de,vt=it/re*oe;P.pixelsPerDegree2=[0,-Fe,it],P.pixelsPerMeter2=[vt,0,vt],E&&(P.pixelsPerDegree2[1]=-P.pixelsPerDegree2[1],P.pixelsPerMeter2[1]=-P.pixelsPerMeter2[1])}return E&&(P.pixelsPerMeter[1]=-P.pixelsPerMeter[1],P.metersPerPixel[1]=-P.metersPerPixel[1],P.pixelsPerDegree[1]=-P.pixelsPerDegree[1],P.degreesPerPixel[1]=-P.degreesPerPixel[1]),P}var _o;(function(e){e[e.LNGLAT=1]="LNGLAT",e[e.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",e[e.VECTOR_TILE=3]="VECTOR_TILE",e[e.IDENTITY=4]="IDENTITY",e[e.P20=5]="P20",e[e.P20_OFFSET=6]="P20_OFFSET",e[e.METER_OFFSET=7]="METER_OFFSET",e[e.P20_2=8]="P20_2"})(_o||(_o={}));var Ls={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"},lu,kh,cu,El,Af,mv=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],Xo=(lu=(0,Fr.b2)(),kh=(0,Fr.f3)($t.ICameraService),lu(cu=(El=function(){function e(){(0,Ct.Z)(this,e),(0,C.Z)(this,"needRefresh",!0),Bn(this,"cameraService",Af,this),(0,C.Z)(this,"coordinateSystem",void 0),(0,C.Z)(this,"viewportCenter",void 0),(0,C.Z)(this,"viewportCenterProjection",void 0),(0,C.Z)(this,"pixelsPerDegree",void 0),(0,C.Z)(this,"pixelsPerDegree2",void 0),(0,C.Z)(this,"pixelsPerMeter",void 0)}return(0,qt.Z)(e,[{key:"refresh",value:function(){var r=this.cameraService.getZoom(),i=this.cameraService.getZoomScale(),o=this.cameraService.getCenter(),u=tl({latitude:o[1],zoom:r}),d=u.pixelsPerMeter,_=u.pixelsPerDegree;this.viewportCenter=o,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=d,this.pixelsPerDegree=_,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===_o.LNGLAT||this.coordinateSystem===_o.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===_o.LNGLAT_OFFSET?this.calculateLnglatOffset(o,r):this.coordinateSystem===_o.P20_OFFSET&&this.calculateLnglatOffset(o,r,i,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(r){this.coordinateSystem=r}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(r,i,o,u){var d=tl({latitude:r[1],zoom:i,scale:o,flipY:u,highPrecision:!0}),_=d.pixelsPerMeter,x=d.pixelsPerDegree,E=d.pixelsPerDegree2,P=this.cameraService.getViewMatrix(),I=this.cameraService.getProjectionMatrix(),D=zu([],I,P),Z=this.cameraService.projectFlat([Math.fround(r[0]),Math.fround(r[1])],Math.pow(2,i));this.viewportCenterProjection=lt([],[Z[0],Z[1],0,1],D),P=this.cameraService.getViewMatrixUncentered()||P,D=zu([],I,P),D=zu([],D,mv),this.cameraService.setViewProjectionMatrix(D),this.pixelsPerMeter=_,this.pixelsPerDegree=x,this.pixelsPerDegree2=E}}]),e}(),Af=Ln(El.prototype,"cameraService",[kh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),El))||cu),lp=L(20396),rl=L.n(lp),Cs;(function(e){e.Hover="hover",e.Click="click",e.Select="select",e.Active="active",e.Drag="drag"})(Cs||(Cs={}));var cp,Kp,nh,Hl,Pd;function gv(e){var n=mm();return function(){var i=(0,zt.Z)(e),o;if(n){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,wn.Z)(this,o)}}function mm(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ls={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},Mf=(cp=(0,Fr.b2)(),Kp=(0,Fr.f3)($t.IMapService),cp(nh=(Hl=function(e){(0,Yr.Z)(r,e);var n=gv(r);function r(){var i;(0,Ct.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return i=n.call.apply(n,[this].concat(u)),Bn((0,be.Z)(i),"mapService",Pd,(0,be.Z)(i)),(0,C.Z)((0,be.Z)(i),"hammertime",void 0),(0,C.Z)((0,be.Z)(i),"lastClickTime",0),(0,C.Z)((0,be.Z)(i),"lastClickXY",[-1,-1]),(0,C.Z)((0,be.Z)(i),"clickTimer",void 0),(0,C.Z)((0,be.Z)(i),"$containter",void 0),(0,C.Z)((0,be.Z)(i),"onDrag",function(_){var x=i.interactionEvent(_);x.type=ls[x.type],i.emit(Cs.Drag,x)}),(0,C.Z)((0,be.Z)(i),"onHammer",function(_){_.srcEvent.stopPropagation();var x=i.interactionEvent(_);i.emit(Cs.Hover,x)}),(0,C.Z)((0,be.Z)(i),"onTouch",function(_){var x=_.touches[0];i.onHover({x:x.pageX,y:x.pageY,type:"touch"})}),(0,C.Z)((0,be.Z)(i),"onHover",function(_){var x=_.clientX,E=_.clientY,P=x,I=E,D=_.type,Z=i.mapService.getMapContainer();if(Z)if($i)P=P-Z.left-0,I=I-Z.top-0;else{var re=Z.getBoundingClientRect(),oe=re.top,de=re.left;P=P-de-Z.clientLeft,I=I-oe-Z.clientTop}var Fe=i.mapService.containerToLngLat([P,I]);if(D==="click"){if(!$i&&"ontouchstart"in document.documentElement)return;i.isDoubleTap(P,I,Fe);return}if(D==="touch"){i.isDoubleTap(P,I,Fe);return}D!=="click"&&D!=="dblclick"&&i.emit(Cs.Hover,{x:P,y:I,lngLat:Fe,type:D,target:_})}),i}return(0,qt.Z)(r,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(Cs.Hover)}},{key:"triggerHover",value:function(o){var u=o.x,d=o.y;this.emit(Cs.Hover,{x:u,y:d})}},{key:"triggerSelect",value:function(o){this.emit(Cs.Select,{featureId:o})}},{key:"triggerActive",value:function(o){this.emit(Cs.Active,{featureId:o})}},{key:"handleMiniEvent",value:function(o){this.onHover({clientX:o.touches[0].pageX,clientY:o.touches[0].pageY,type:"touch"})}},{key:"addEventListenerOnMap",value:function(){var o=this.mapService.getMapContainer();if(o)if($i)fa.document.addEventListener("touchstart",this.handleMiniEvent.bind(this));else{var u=new(rl()).Manager(o);u.add(new(rl()).Tap({event:"dblclick",taps:2})),u.add(new(rl()).Tap({event:"click"})),u.add(new(rl()).Pan({threshold:0,pointers:0})),u.add(new(rl()).Press({})),u.on("dblclick click",this.onHammer),u.on("panstart panmove panend pancancel",this.onDrag),o.addEventListener("mousemove",this.onHover),o.addEventListener("mousedown",this.onHover,!0),o.addEventListener("mouseup",this.onHover),o.addEventListener("contextmenu",this.onHover),this.hammertime=u}}},{key:"removeEventListenerOnMap",value:function(){if($i)fa.document.removeEventListener("touchstart",this.handleMiniEvent.bind(this));else{var o=this.mapService.getMapContainer();o&&(o.removeEventListener("mousemove",this.onHover),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),o.removeEventListener("mousedown",this.onHover),o.removeEventListener("mouseup",this.onHover),o.removeEventListener("contextmenu",this.onHover))}}},{key:"interactionEvent",value:function(o){var u=o.type,d=o.pointerType,_,x;d==="touch"?(x=Math.floor(o.pointers[0].clientY),_=Math.floor(o.pointers[0].clientX)):(x=Math.floor(o.srcEvent.y),_=Math.floor(o.srcEvent.x));var E=this.mapService.getMapContainer();if(E){var P=E.getBoundingClientRect(),I=P.top,D=P.left;_-=D,x-=I}var Z=this.mapService.containerToLngLat([_,x]);return{x:_,y:x,lngLat:Z,type:u,target:o.srcEvent}}},{key:"isDoubleTap",value:function(o,u,d){var _=this,x=new Date().getTime(),E="click";x-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-o)<10&&Math.abs(this.lastClickXY[1]-u)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),E="dblclick",this.emit(Cs.Hover,{x:o,y:u,lngLat:d,type:E})):(this.lastClickTime=x,this.lastClickXY=[o,u],this.clickTimer=setTimeout(function(){E="click",_.emit(Cs.Hover,{x:o,y:u,lngLat:d,type:E})},400))}}]),r}(Do()),Pd=Ln(Hl.prototype,"mapService",[Kp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hl))||nh),nl=L(92137),t=L(87757),a=L.n(t),s=0;function h(e){if($i)return null;var n=e;if(typeof e=="string"&&(n=document.getElementById(e)),n){var r=document.createElement("div");return r.style.cssText+=`
      position: absolute;
      z-index:2;
      height: 100%;
      width: 100%;
      pointer-events: none;
    `,r.id="l7-scene-".concat(s++),r.classList.add("l7-scene"),n.appendChild(r),r}return null}function g(e){var n,r,i=!0;return e==null||(n=e.target)===null||n===void 0||(r=n.path)===null||r===void 0||r.map(function(o){if(o!=null&&o.classList){var u;o==null||(u=o.classList)===null||u===void 0||u.forEach(function(d){(d==="l7-marker"||d==="l7-popup")&&(i=!1)})}}),i}var m;(function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.CULL_FACE=2884]="CULL_FACE",e[e.BLEND=3042]="BLEND",e[e.DITHER=3024]="DITHER",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.TEXTURE1=33985]="TEXTURE1",e[e.TEXTURE2=33986]="TEXTURE2",e[e.TEXTURE3=33987]="TEXTURE3",e[e.TEXTURE4=33988]="TEXTURE4",e[e.TEXTURE5=33989]="TEXTURE5",e[e.TEXTURE6=33990]="TEXTURE6",e[e.TEXTURE7=33991]="TEXTURE7",e[e.TEXTURE8=33992]="TEXTURE8",e[e.TEXTURE9=33993]="TEXTURE9",e[e.TEXTURE10=33994]="TEXTURE10",e[e.TEXTURE11=33995]="TEXTURE11",e[e.TEXTURE12=33996]="TEXTURE12",e[e.TEXTURE13=33997]="TEXTURE13",e[e.TEXTURE14=33998]="TEXTURE14",e[e.TEXTURE15=33999]="TEXTURE15",e[e.TEXTURE16=34e3]="TEXTURE16",e[e.TEXTURE17=34001]="TEXTURE17",e[e.TEXTURE18=34002]="TEXTURE18",e[e.TEXTURE19=34003]="TEXTURE19",e[e.TEXTURE20=34004]="TEXTURE20",e[e.TEXTURE21=34005]="TEXTURE21",e[e.TEXTURE22=34006]="TEXTURE22",e[e.TEXTURE23=34007]="TEXTURE23",e[e.TEXTURE24=34008]="TEXTURE24",e[e.TEXTURE25=34009]="TEXTURE25",e[e.TEXTURE26=34010]="TEXTURE26",e[e.TEXTURE27=34011]="TEXTURE27",e[e.TEXTURE28=34012]="TEXTURE28",e[e.TEXTURE29=34013]="TEXTURE29",e[e.TEXTURE30=34014]="TEXTURE30",e[e.TEXTURE31=34015]="TEXTURE31",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL"})(m||(m={}));var S,M,k,z,V,H,te,se,Me,Ie,qe;function ze(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function at(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?ze(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ze(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var bt=(S=(0,Fr.b2)(),M=(0,Fr.f3)($t.IRendererService),k=(0,Fr.f3)($t.IGlobalConfigService),z=(0,Fr.f3)($t.IInteractionService),V=(0,Fr.f3)($t.ILayerService),S(H=(te=function(){function e(){var n=this;(0,Ct.Z)(this,e),Bn(this,"rendererService",se,this),Bn(this,"configService",Me,this),Bn(this,"interactionService",Ie,this),Bn(this,"layerService",qe,this),(0,C.Z)(this,"pickingFBO",void 0),(0,C.Z)(this,"width",0),(0,C.Z)(this,"height",0),(0,C.Z)(this,"alreadyInPicking",!1),(0,C.Z)(this,"pickBufferScale",1),(0,C.Z)(this,"lastPickTime",new Date().getTime()),(0,C.Z)(this,"pickFromPickingFBO",function(r,i){var o,u=i.x,d=i.y,_=i.lngLat,x=i.type,E=i.target,P=!1,I=n.rendererService,D=I.getViewportSize,Z=I.readPixels,re=I.getContainer,oe=n.getContainerSize(re()),de=oe.width,Fe=oe.height;de*=ka,Fe*=ka;var it=r.getLayerConfig(),vt=it.enableHighlight,xt=it.enableSelect,Gt=u*ka,Xt=d*ka;if(Gt>de-1*ka||Gt<0||Xt>Fe-1*ka||Xt<0)return!1;var nr;if(nr=Z({x:Math.floor(Gt/n.pickBufferScale),y:Math.floor((Fe-(d+1)*ka)/n.pickBufferScale),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:n.pickingFBO}),nr[0]!==0||nr[1]!==0||nr[2]!==0){var mr=Ou(nr),en=r.getSource().getFeatureById(mr);mr!==r.getCurrentPickId()&&x==="mousemove"&&(x="mouseenter");var hn={x:u,y:d,type:x,lngLat:_,featureId:mr,feature:en,target:E};en&&(P=!0,r.setCurrentPickId(mr),n.triggerHoverOnLayer(r,hn))}else{var wr={x:u,y:d,lngLat:_,type:r.getCurrentPickId()!==null&&x==="mousemove"?"mouseout":"un"+x,featureId:null,target:E,feature:null};n.triggerHoverOnLayer(r,at(at({},wr),{},{type:"unpick"})),n.triggerHoverOnLayer(r,wr),r.setCurrentPickId(null)}if(vt&&n.highlightPickedFeature(r,nr),xt&&x==="click"&&((o=nr)===null||o===void 0?void 0:o.toString())!==[0,0,0,0].toString()){var Pn=Ou(nr);r.getCurrentSelectedId()===null||Pn!==r.getCurrentSelectedId()?(n.selectFeature(r,nr),r.setCurrentSelectedId(Pn)):(n.selectFeature(r,new Uint8Array([0,0,0,0])),r.setCurrentSelectedId(null))}return P})}return(0,qt.Z)(e,[{key:"init",value:function(r){var i=this.rendererService,o=i.createTexture2D,u=i.createFramebuffer,d=i.getViewportSize,_=i.getContainer,x=this.getContainerSize(_()),E=x.width,P=x.height;E*=ka,P*=ka,this.pickBufferScale=this.configService.getSceneConfig(r).pickBufferScale||1,this.pickingFBO=u({color:o({width:Math.round(E/this.pickBufferScale),height:Math.round(P/this.pickBufferScale),wrapS:m.CLAMP_TO_EDGE,wrapT:m.CLAMP_TO_EDGE})}),this.interactionService.on(Cs.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:function(){var n=(0,nl.Z)(a().mark(function i(o,u,d){var _=this,x,E,P,I;return a().wrap(function(Z){for(;;)switch(Z.prev=Z.next){case 0:x=this.rendererService,E=x.useFramebuffer,P=x.clear,I=x.getContainer,this.resizePickingFBO(),E(this.pickingFBO,function(){P({framebuffer:_.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),o.hooks.beforePickingEncode.call(),o.renderModels(),o.hooks.afterPickingEncode.call();var re=_.pickBox(o,u);d(re)});case 3:case"end":return Z.stop()}},i,this)}));function r(i,o,u){return n.apply(this,arguments)}return r}()},{key:"pickBox",value:function(r,i){var o=this,u=i.map(function(wr){var Pn=wr<0?0:wr;return Math.floor(Pn*ka/o.pickBufferScale)}),d=(0,An.Z)(u,4),_=d[0],x=d[1],E=d[2],P=d[3],I=this.rendererService,D=I.getViewportSize,Z=I.readPixels,re=I.getContainer,oe=this.getContainerSize(re()),de=oe.width,Fe=oe.height;if(de*=ka,Fe*=ka,_>(de-1)*ka/this.pickBufferScale||E<0||x>(Fe-1)*ka/this.pickBufferScale||P<0)return[];var it,vt=Math.min(de/this.pickBufferScale,E)-_,xt=Math.min(Fe/this.pickBufferScale,P)-x;it=Z({x:_,y:Math.floor(Fe/this.pickBufferScale-(P+1)),width:vt,height:xt,data:new Uint8Array(vt*xt*4),framebuffer:this.pickingFBO});for(var Gt=[],Xt={},nr=0;nr<it.length/4;nr=nr+1){var mr=it.slice(nr*4,nr*4+4),en=Ou(mr);if(en!==-1&&!Xt[en]){var hn=r.getSource().getFeatureById(en);Gt.push(hn),Xt[en]=!0}}return Gt}},{key:"getContainerSize",value:function(r){return r.getContext?{width:r.width/ka,height:r.height/ka}:r.getBoundingClientRect()}},{key:"pickingAllLayer",value:function(){var n=(0,nl.Z)(a().mark(function i(o){var u;return a().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(!(this.alreadyInPicking||this.layerService.alreadyInRendering||this.layerService.isMapDragging()||!this.layerService.getShaderPickStat())){_.next=2;break}return _.abrupt("return");case 2:if(this.alreadyInPicking=!0,u=new Date().getTime(),!(u-this.lastPickTime>10||o.type==="contextmenu")){_.next=7;break}return _.next=7,this.pickingLayers(o);case 7:this.lastPickTime=u,this.layerService.renderLayers(),this.alreadyInPicking=!1;case 10:case"end":return _.stop()}},i,this)}));function r(i){return n.apply(this,arguments)}return r}()},{key:"resizePickingFBO",value:function(){var r=this.rendererService.getContainer,i=this.getContainerSize(r()),o=i.width,u=i.height;o*=ka,u*=ka,(this.width!==o||this.height!==u)&&(this.pickingFBO.resize({width:Math.round(o/this.pickBufferScale),height:Math.round(u/this.pickBufferScale)}),this.width=o,this.height=u)}},{key:"pickingLayers",value:function(){var n=(0,nl.Z)(a().mark(function i(o){var u=this,d,_,x,E,P;return a().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:d=this.rendererService,_=d.getViewportSize,x=d.useFramebuffer,E=d.clear,P=d.getContainer,this.resizePickingFBO(),x(this.pickingFBO,function(){var Z=u.layerService.getRenderList();Z.filter(function(re){return re.needPick(o.type)}).reverse().some(function(re){E({framebuffer:u.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),re.hooks.beforePickingEncode.call(),re.renderModels(!0),re.hooks.afterPickingEncode.call();var oe=u.pickFromPickingFBO(re,o);return oe&&!re.getLayerConfig().enablePropagation})});case 3:case"end":return D.stop()}},i,this)}));function r(i){return n.apply(this,arguments)}return r}()},{key:"triggerHoverOnLayer",value:function(r,i){g(i)&&r.emit(i.type,i)}},{key:"highlightPickedFeature",value:function(r,i){var o=(0,An.Z)(i,3),u=o[0],d=o[1],_=o[2];r.hooks.beforeHighlight.call([u,d,_])}},{key:"selectFeature",value:function(r,i){var o=(0,An.Z)(i,3),u=o[0],d=o[1],_=o[2];r.hooks.beforeSelect.call([u,d,_])}}]),e}(),se=Ln(te.prototype,"rendererService",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Me=Ln(te.prototype,"configService",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ie=Ln(te.prototype,"interactionService",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qe=Ln(te.prototype,"layerService",[V],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),te))||H),Ut=function(){function e(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;(0,Ct.Z)(this,e),(0,C.Z)(this,"autoStart",void 0),(0,C.Z)(this,"startTime",0),(0,C.Z)(this,"oldTime",0),(0,C.Z)(this,"running",!1),(0,C.Z)(this,"elapsedTime",0),this.autoStart=n}return(0,qt.Z)(e,[{key:"start",value:function(){this.startTime=(typeof performance=="undefined"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var r=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var i=(typeof performance=="undefined"?Date:performance).now();r=(i-this.oldTime)/1e3,this.oldTime=i,this.elapsedTime+=r}return r}}]),e}(),Ht,or,Ar,Vr,kn,an,zn,ln,Pi,ti=(Ht=(0,Fr.b2)(),or=(0,Fr.f3)($t.IRendererService),Ar=(0,Fr.f3)($t.IMapService),Vr=(0,Fr.f3)($t.IGlobalConfigService),Ht(kn=(an=function(){function e(){(0,Ct.Z)(this,e),(0,C.Z)(this,"clock",new Ut),(0,C.Z)(this,"alreadyInRendering",!1),(0,C.Z)(this,"layers",[]),(0,C.Z)(this,"layerList",[]),(0,C.Z)(this,"layerRenderID",void 0),(0,C.Z)(this,"sceneInited",!1),(0,C.Z)(this,"animateInstanceCount",0),(0,C.Z)(this,"shaderPicking",!0),(0,C.Z)(this,"enableRender",!0),Bn(this,"renderService",zn,this),Bn(this,"mapService",ln,this),Bn(this,"configService",Pi,this)}return(0,qt.Z)(e,[{key:"add",value:function(r){this.sceneInited&&r.init(),this.layers.push(r),this.updateLayerRenderList()}},{key:"initLayers",value:function(){this.sceneInited=!0,this.layers.forEach(function(r){r.inited||r.init()}),this.updateLayerRenderList()}},{key:"getRenderList",value:function(){return this.layerList}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(r){return this.layers.find(function(i){return i.id===r})}},{key:"getLayerByName",value:function(r){return this.layers.find(function(i){return i.name===r})}},{key:"remove",value:function(r,i){if(i){var o=i.layerChildren.indexOf(r);o>-1&&i.layerChildren.splice(o,1)}else{var u=this.layers.indexOf(r);u>-1&&this.layers.splice(u,1)}this.updateLayerRenderList(),r.destroy(),this.renderLayers()}},{key:"removeAllLayers",value:function(){this.destroy()}},{key:"setEnableRender",value:function(r){this.enableRender=r}},{key:"renderLayers",value:function(){this.alreadyInRendering||!this.enableRender||(this.alreadyInRendering=!0,this.clear(),this.layerList.forEach(function(r){r.hooks.beforeRenderData.call(),r.hooks.beforeRender.call(),r.render(),r.hooks.afterRender.call()}),this.alreadyInRendering=!1)}},{key:"updateLayerRenderList",value:function(){var r=this;this.layerList=[],this.layers.filter(function(i){return i.inited}).filter(function(i){return i.isVisible()}).forEach(function(i){r.layerList.push(i),i.layerChildren.filter(function(o){return o.inited}).filter(function(o){return o.isVisible()}).forEach(function(o){r.layerList.push(o)})}),this.layerList.sort(function(i,o){return i.zIndex-o.zIndex})}},{key:"destroy",value:function(){this.layers.forEach(function(r){r.layerChildren&&(r.layerChildren.forEach(function(i){return i.destroy()}),r.layerChildren=[]),r.destroy()}),this.layers=[],this.layerList=[],this.renderLayers()}},{key:"startAnimate",value:function(){this.animateInstanceCount++==0&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){--this.animateInstanceCount==0&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"isMapDragging",value:function(){return this.mapService.dragging}},{key:"enableShaderPick",value:function(){this.shaderPicking=!0}},{key:"disableShaderPick",value:function(){this.shaderPicking=!1}},{key:"getShaderPickStat",value:function(){return this.shaderPicking}},{key:"runRender",value:function(){this.renderLayers(),this.layerRenderID=fa.requestAnimationFrame(this.runRender.bind(this))}},{key:"clear",value:function(){var r=to(this.mapService.bgColor);this.renderService.clear({color:r,depth:1,stencil:0,framebuffer:null})}},{key:"stopRender",value:function(){fa.cancelAnimationFrame(this.layerRenderID)}}]),e}(),zn=Ln(an.prototype,"renderService",[or],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ln=Ln(an.prototype,"mapService",[Ar],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pi=Ln(an.prototype,"configService",[Vr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),an))||kn),Sn=L(81253),Zi=L(14293),li=L.n(Zi),na=function(){function e(n){var r=this;(0,Ct.Z)(this,e),(0,C.Z)(this,"name",void 0),(0,C.Z)(this,"type",void 0),(0,C.Z)(this,"scale",void 0),(0,C.Z)(this,"descriptor",void 0),(0,C.Z)(this,"featureBufferLayout",[]),(0,C.Z)(this,"needRescale",!1),(0,C.Z)(this,"needRemapping",!1),(0,C.Z)(this,"needRegenerateVertices",!1),(0,C.Z)(this,"featureRange",{startIndex:0,endIndex:Infinity}),(0,C.Z)(this,"vertexAttribute",void 0),(0,C.Z)(this,"defaultCallback",function(i){if(i.length===0){var o;return((o=r.scale)===null||o===void 0?void 0:o.defaultValues)||[]}return i.map(function(u,d){var _,x=(_=r.scale)===null||_===void 0?void 0:_.scalers[d].func,E=x(u);return E})}),this.setProps(n)}return(0,qt.Z)(e,[{key:"setProps",value:function(r){Object.assign(this,r)}},{key:"mapping",value:function(r){var i;if((i=this.scale)!==null&&i!==void 0&&i.callback){var o,u=(o=this.scale)===null||o===void 0?void 0:o.callback.apply(o,(0,we.Z)(r));if(!li()(u))return[u]}return this.defaultCallback(r)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),e}(),Vn=["buffer","update","name"],Qi,Ka,vo,lo,ja,mo;function Yo(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function zo(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Yo(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Yo(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function qs(e){return new Promise(function(n){return setTimeout(n,e)})}var cs=(Qi={},(0,C.Z)(Qi,m.FLOAT,4),(0,C.Z)(Qi,m.UNSIGNED_BYTE,1),(0,C.Z)(Qi,m.UNSIGNED_SHORT,2),Qi),Bs=(Ka=(0,Fr.b2)(),vo=(0,Fr.f3)($t.IRendererService),Ka(lo=(ja=function(){function e(){(0,Ct.Z)(this,e),(0,C.Z)(this,"attributesAndIndices",void 0),Bn(this,"rendererService",mo,this),(0,C.Z)(this,"attributes",[]),(0,C.Z)(this,"triangulation",void 0),(0,C.Z)(this,"featureLayout",{sizePerElement:0,elements:[]})}return(0,qt.Z)(e,[{key:"registerStyleAttribute",value:function(r){var i=this.getLayerStyleAttribute(r.name||"");return i?i.setProps(r):(i=new na(r),this.attributes.push(i)),i}},{key:"updateStyleAttribute",value:function(r,i,o){var u=this.getLayerStyleAttribute(r);u||(u=this.registerStyleAttribute(zo(zo({},i),{},{name:r})));var d=i.scale;d&&u&&(u.scale=d,u.needRescale=!0,u.needRemapping=!0,u.needRegenerateVertices=!0,o&&o.featureRange&&(u.featureRange=o.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(r){return this.attributes.find(function(i){return i.name===r})}},{key:"getLayerAttributeScale",value:function(r){var i,o=this.getLayerStyleAttribute(r),u=o==null||(i=o.scale)===null||i===void 0?void 0:i.scalers;return u&&u[0]?u[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(r,i){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,u=arguments.length>3?arguments[3]:void 0,d=this.attributes.find(function(xt){return xt.name===r});if(d&&d.descriptor){var _=d.descriptor,x=_.update,E=_.buffer,P=_.size,I=P===void 0?0:P,D=cs[E.type||m.FLOAT];if(x){var Z=this.featureLayout,re=Z.elements,oe=Z.sizePerElement,de=re.slice(o,u);if(!de.length)return;var Fe=de[0].offset,it=Fe*I*D,vt=de.map(function(xt,Gt){for(var Xt=xt.featureIdx,nr=xt.vertices,mr=xt.normals,en=nr.length/oe,hn=[],wr=0;wr<en;wr++){var Pn=mr?mr.slice(wr*3,wr*3+3):[];hn.push.apply(hn,(0,we.Z)(x(i[Xt],Xt,nr.slice(wr*oe,wr*oe+oe),Gt,Pn)))}return hn}).reduce(function(xt,Gt){return xt.push.apply(xt,(0,we.Z)(Gt)),xt},[]);d.vertexAttribute.updateBuffer({data:vt,offset:it})}}}},{key:"createAttributesAndIndices",value:function(r,i,o){var u=this;this.featureLayout={sizePerElement:0,elements:[]},i&&(this.triangulation=i);var d=this.attributes.map(function(it){return it.resetDescriptor(),it.descriptor}),_=0,x=[],E=[],P=[],I=3;r.forEach(function(it,vt){var xt=u.triangulation(it,o),Gt=xt.indices,Xt=xt.vertices,nr=xt.normals,mr=xt.size;Gt.forEach(function(Pn){E.push(Pn+_)}),I=mr;var en=Xt.length/mr;u.featureLayout.sizePerElement=I,u.featureLayout.elements.push({featureIdx:vt,vertices:Xt,normals:nr,offset:_}),_+=en;for(var hn=function(jn){var yi=(nr==null?void 0:nr.slice(jn*3,jn*3+3))||[],Io=Xt.slice(jn*mr,jn*mr+mr);d.forEach(function(Ms,sl){if(Ms&&Ms.update){var Ic;(Ic=Ms.buffer.data).push.apply(Ic,(0,we.Z)(Ms.update(it,vt,Io,jn,yi)))}})},wr=0;wr<en;wr++)hn(wr)});var D=this.rendererService,Z=D.createAttribute,re=D.createBuffer,oe=D.createElements,de={};d.forEach(function(it,vt){if(it){var xt=it.buffer,Gt=it.update,Xt=it.name,nr=(0,Sn.Z)(it,Vn),mr=Z(zo({buffer:re(xt)},nr));de[it.name||""]=mr,u.attributes[vt].vertexAttribute=mr}});var Fe=oe({data:E,type:m.UNSIGNED_INT,count:E.length});return this.attributesAndIndices={attributes:de,elements:Fe},this.attributesAndIndices}},{key:"clearAllAttributes",value:function(){var r;this.attributes.forEach(function(i){i.vertexAttribute&&i.vertexAttribute.destroy()}),(r=this.attributesAndIndices)===null||r===void 0||r.elements.destroy(),this.attributes=[]}}]),e}(),mo=Ln(ja.prototype,"rendererService",[vo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ja))||lo),xo=L(67709),fs=L.n(xo),Hi,Oa,Sa,ia,zs,Ts,Ga,Mo,As,da,Wl,_u,Xl,bo,Yl,il,ih,qo,ah,Ec,oh,fp,sh,Dh,hp,pp,Sc,Fh,uh,Xc,lh,dp,vp;function mp(e){var n=gp();return function(){var i=(0,zt.Z)(e),o;if(n){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,wn.Z)(this,o)}}function gp(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var $p=(Hi=(0,Fr.b2)(),Oa=(0,Fr.f3)($t.SceneID),Sa=(0,Fr.f3)($t.IIconService),ia=(0,Fr.f3)($t.IFontService),zs=(0,Fr.f3)($t.IControlService),Ts=(0,Fr.f3)($t.IGlobalConfigService),Ga=(0,Fr.f3)($t.IMapService),Mo=(0,Fr.f3)($t.ICoordinateSystemService),As=(0,Fr.f3)($t.IRendererService),da=(0,Fr.f3)($t.ILayerService),Wl=(0,Fr.f3)($t.ICameraService),_u=(0,Fr.f3)($t.IInteractionService),Xl=(0,Fr.f3)($t.IPickingService),bo=(0,Fr.f3)($t.IShaderModuleService),Yl=(0,Fr.f3)($t.IMarkerService),il=(0,Fr.f3)($t.IPopupService),Hi(ih=(qo=function(e){(0,Yr.Z)(r,e);var n=mp(r);function r(){var i;return(0,Ct.Z)(this,r),i=n.call(this),(0,C.Z)((0,be.Z)(i),"destroyed",!1),(0,C.Z)((0,be.Z)(i),"loaded",!1),(0,C.Z)((0,be.Z)(i),"loadFont",!1),(0,C.Z)((0,be.Z)(i),"fontFamily",""),Bn((0,be.Z)(i),"id",ah,(0,be.Z)(i)),Bn((0,be.Z)(i),"iconService",Ec,(0,be.Z)(i)),Bn((0,be.Z)(i),"fontService",oh,(0,be.Z)(i)),Bn((0,be.Z)(i),"controlService",fp,(0,be.Z)(i)),Bn((0,be.Z)(i),"configService",sh,(0,be.Z)(i)),Bn((0,be.Z)(i),"map",Dh,(0,be.Z)(i)),Bn((0,be.Z)(i),"coordinateSystemService",hp,(0,be.Z)(i)),Bn((0,be.Z)(i),"rendererService",pp,(0,be.Z)(i)),Bn((0,be.Z)(i),"layerService",Sc,(0,be.Z)(i)),Bn((0,be.Z)(i),"cameraService",Fh,(0,be.Z)(i)),Bn((0,be.Z)(i),"interactionService",uh,(0,be.Z)(i)),Bn((0,be.Z)(i),"pickingService",Xc,(0,be.Z)(i)),Bn((0,be.Z)(i),"shaderModuleService",lh,(0,be.Z)(i)),Bn((0,be.Z)(i),"markerService",dp,(0,be.Z)(i)),Bn((0,be.Z)(i),"popupService",vp,(0,be.Z)(i)),(0,C.Z)((0,be.Z)(i),"inited",!1),(0,C.Z)((0,be.Z)(i),"initPromise",void 0),(0,C.Z)((0,be.Z)(i),"rendering",!1),(0,C.Z)((0,be.Z)(i),"$container",void 0),(0,C.Z)((0,be.Z)(i),"canvas",void 0),(0,C.Z)((0,be.Z)(i),"markerContainer",void 0),(0,C.Z)((0,be.Z)(i),"hooks",void 0),(0,C.Z)((0,be.Z)(i),"handleWindowResized",function(){i.emit("resize"),i.$container&&(i.initContainer(),pn(),i.coordinateSystemService.needRefresh=!0,i.render())}),(0,C.Z)((0,be.Z)(i),"handleMapCameraChanged",function(o){i.cameraService.update(o),i.render()}),i.hooks={init:new Hn},i}return(0,qt.Z)(r,[{key:"init",value:function(o){var u=this;this.configService.setSceneConfig(this.id,o),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,nl.Z)(a().mark(function d(){return a().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return x.next=2,new Promise(function(E){u.map.onCameraChanged(function(P){u.cameraService.init(),u.cameraService.update(P),u.map.version!=="GAODE2.x"&&E()}),u.map.version!=="GAODE2.x"?u.map.init():E()});case 2:if(!(u.map.version==="GAODE2.x"&&u.map.initViewPort)){x.next=6;break}return x.next=5,u.map.init();case 5:u.map.initViewPort();case 6:u.map.onCameraChanged(u.handleMapCameraChanged),u.map.addMarkerContainer(),u.markerService.addMarkers(),u.markerService.addMarkerLayers(),u.popupService.initPopup(),u.interactionService.init(),u.interactionService.on(Cs.Drag,u.addSceneEvent.bind(u));case 13:case"end":return x.stop()}},d)}))),this.hooks.init.tapPromise("initRenderer",(0,nl.Z)(a().mark(function d(){var _,x;return a().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:if(_=h(u.configService.getSceneConfig(u.id).id||""),u.$container=_,!_){P.next=11;break}return u.canvas=za("canvas","",_),u.setCanvas(),P.next=7,u.rendererService.init(u.canvas,u.configService.getSceneConfig(u.id));case 7:fs()(u.$container,u.handleWindowResized),fa.matchMedia&&((x=fa.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)"))===null||x===void 0||x.addListener(u.handleWindowResized)),P.next=12;break;case 11:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 12:u.pickingService.init(u.id);case 13:case"end":return P.stop()}},d)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"initMiniScene",value:function(o){var u=this;this.configService.setSceneConfig(this.id,o),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,nl.Z)(a().mark(function d(){return a().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return x.next=2,new Promise(function(E){u.map.onCameraChanged(function(P){u.cameraService.init(),u.cameraService.update(P),u.map.version!=="GAODE2.x"&&E()}),u.map.initMiniMap()});case 2:u.map.onCameraChanged(u.handleMapCameraChanged),u.interactionService.init(),u.interactionService.on(Cs.Drag,u.addSceneEvent.bind(u));case 5:case"end":return x.stop()}},d)}))),this.hooks.init.tapPromise("initRenderer",(0,nl.Z)(a().mark(function d(){var _;return a().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:if(_=o.canvas,u.$container=_||null,!u.$container){E.next=7;break}return E.next=5,u.rendererService.init(o.canvas,u.configService.getSceneConfig(u.id));case 5:E.next=8;break;case 7:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 8:u.pickingService.init(u.id);case 9:case"end":return E.stop()}},d)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(o){this.layerService.sceneService=this,this.layerService.add(o),this.render()}},{key:"render",value:function(){var i=(0,nl.Z)(a().mark(function u(){return a().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(!(this.rendering||this.destroyed)){_.next=2;break}return _.abrupt("return");case 2:if(this.rendering=!0,this.inited){_.next=15;break}return _.next=6,this.initPromise;case 6:if(this.destroyed&&this.destroy(),!(this.loadFont&&document.fonts)){_.next=10;break}return _.next=10,document.fonts.load("24px ".concat(this.fontFamily),"L7text");case 10:this.layerService.initLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0;case 15:this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this.rendering=!1;case 18:case"end":return _.stop()}},u,this)}));function o(){return i.apply(this,arguments)}return o}()},{key:"addFontFace",value:function(o,u){this.fontFamily=o;var d=document.createElement("style");d.type="text/css",d.innerText=`
        @font-face{
            font-family: '`.concat(o,`';
            src: url('`).concat(u,`') format('woff2'),
            url('`).concat(u,`') format('woff'),
            url('`).concat(u,`') format('truetype');
        }`),document.getElementsByTagName("head")[0].appendChild(d),this.loadFont=!0}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:function(o){var u,d=(u=this.$container)===null||u===void 0?void 0:u.getElementsByTagName("canvas")[0];this.render();var _=o==="jpg"?d==null?void 0:d.toDataURL("image/jpeg"):d==null?void 0:d.toDataURL("image/png");return _}},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"addMarkerContainer",value:function(){var o=this.$container.parentElement;o!==null&&(this.markerContainer=za("div","l7-marker-container",o))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){var o,u;if(!this.inited){this.destroyed=!0;return}if(this.emit("destroy"),this.layerService.destroy(),this.rendererService.destroy(),this.map.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),(o=this.$container)===null||o===void 0||(u=o.parentNode)===null||u===void 0||u.removeChild(this.$container),this.removeAllListeners(),this.inited=!1,(0,xo.unbind)(this.$container,this.handleWindowResized),fa.matchMedia){var d;(d=fa.matchMedia("screen and (min-resolution: 2dppx)"))===null||d===void 0||d.removeListener(this.handleWindowResized)}}},{key:"initContainer",value:function(){var o,u,d=ka,_=((o=this.$container)===null||o===void 0?void 0:o.clientWidth)||400,x=((u=this.$container)===null||u===void 0?void 0:u.clientHeight)||300,E=this.canvas;E&&(E.width=_*d,E.height=x*d),this.rendererService.viewport({x:0,y:0,width:d*_,height:d*x})}},{key:"setCanvas",value:function(){var o,u,d=ka,_=((o=this.$container)===null||o===void 0?void 0:o.clientWidth)||400,x=((u=this.$container)===null||u===void 0?void 0:u.clientHeight)||300,E=this.canvas;E.width=_*d,E.height=x*d,E.style.width="100%",E.style.height="100%"}},{key:"addSceneEvent",value:function(o){this.emit(o.type,o)}}]),r}(ha.EventEmitter),ah=Ln(qo.prototype,"id",[Oa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ec=Ln(qo.prototype,"iconService",[Sa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oh=Ln(qo.prototype,"fontService",[ia],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fp=Ln(qo.prototype,"controlService",[zs],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sh=Ln(qo.prototype,"configService",[Ts],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dh=Ln(qo.prototype,"map",[Ga],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hp=Ln(qo.prototype,"coordinateSystemService",[Mo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pp=Ln(qo.prototype,"rendererService",[As],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sc=Ln(qo.prototype,"layerService",[da],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fh=Ln(qo.prototype,"cameraService",[Wl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uh=Ln(qo.prototype,"interactionService",[_u],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xc=Ln(qo.prototype,"pickingService",[Xl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lh=Ln(qo.prototype,"shaderModuleService",[bo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dp=Ln(qo.prototype,"markerService",[Yl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vp=Ln(qo.prototype,"popupService",[il],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qo))||ih),yp=L(44908),Nh=L.n(yp);function _p(e){var n=0;switch(e){case"vec2":case"ivec2":n=2;break;case"vec3":case"ivec3":n=3;break;case"vec4":case"ivec4":case"mat2":n=4;break;case"mat3":n=9;break;case"mat4":n=16;break;default:}return n}var Jp=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function ch(e){var n={};return e=e.replace(Jp,function(r,i,o){var u=o.split(":"),d=u[0].trim(),_="";switch(u.length>1&&(_=u[1].trim()),i){case"bool":_=_==="true";break;case"float":case"int":_=Number(_);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":_?_=_.replace("[","").replace("]","").split(",").reduce(function(x,E){return x.push(Number(E.trim())),x},[]):_=new Array(_p(i)).fill(0);break;default:}return n[d]=_,"uniform ".concat(i," ").concat(d,`;
`)}),{content:e,uniforms:n}}var xp,fh;function Bh(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function ql(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Bh(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Bh(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var zh="#define PI 3.14159265359",Uh=`#define SHIFT_RIGHT17 1.0 / 131072.0
#define SHIFT_RIGHT18 1.0 / 262144.0
#define SHIFT_RIGHT19 1.0 / 524288.0
#define SHIFT_RIGHT20 1.0 / 1048576.0
#define SHIFT_RIGHT21 1.0 / 2097152.0
#define SHIFT_RIGHT22 1.0 / 4194304.0
#define SHIFT_RIGHT23 1.0 / 8388608.0
#define SHIFT_RIGHT24 1.0 / 16777216.0

#define SHIFT_LEFT17 131072.0
#define SHIFT_LEFT18 262144.0
#define SHIFT_LEFT19 524288.0
#define SHIFT_LEFT20 1048576.0
#define SHIFT_LEFT21 2097152.0
#define SHIFT_LEFT22 4194304.0
#define SHIFT_LEFT23 8388608.0
#define SHIFT_LEFT24 16777216.0

vec2 unpack_float(float packedValue) {
  int packedIntValue = int(packedValue);
  int v0 = packedIntValue / 256;
  return vec2(v0, packedIntValue - v0 * 256);
}

vec4 decode_color(vec2 encodedColor) {
  return vec4(
    unpack_float(encodedColor[0]) / 255.0,
    unpack_float(encodedColor[1]) / 255.0
  );
}
`,Id=`#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


float calc_lighting(vec4 pos) {

    vec3 worldPos = vec3(pos * u_ModelMatrix);

    vec3 worldNormal = a_Normal;
      // //cal light weight
    vec3 viewDir = normalize(u_CameraPosition - worldPos);

    vec3 lightDir = normalize(vec3(1, -10.5, 12));

    vec3 halfDir = normalize(viewDir+lightDir);
      // //lambert
    float lambert = dot(worldNormal, lightDir);
        //specular
    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);
        //sum to light weight
    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;

    return lightWeight;
}
`,yv=`// Blinn-Phong model
// apply lighting in vertex shader instead of fragment shader
// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting
uniform float u_Ambient : 1.0;
uniform float u_Diffuse : 1.0;
uniform float u_Specular : 1.0;
uniform int u_NumOfDirectionalLights : 1;
uniform int u_NumOfSpotLights : 0;

#define SHININESS 32.0
#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3
#define MAX_NUM_OF_SPOT_LIGHTS 3

struct DirectionalLight {
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
};

struct SpotLight {
  vec3 position;
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
  float constant;
  float linear;
  float quadratic;
  float angle;
  float blur;
  float exponent;
};

uniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];
uniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];

vec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {
  vec3 lightDir = normalize(light.direction);
  // diffuse shading
  float diff = max(dot(normal, lightDir), 0.0);
  // Blinn-Phong specular shading
  vec3 halfwayDir = normalize(lightDir + viewDir);
  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);

  vec3 ambient = light.ambient * u_Ambient;
  vec3 diffuse = light.diffuse * diff * u_Diffuse;
  vec3 specular = light.specular * spec * u_Specular;

  return ambient + diffuse + specular;
}

// vec3 calc_spot_light(SpotLight light, vec3 normal, vec3 fragPos, vec3 viewDir) {
//   vec3 lightDir = normalize(light.position - fragPos);
//   // diffuse shading
//   float diff = max(dot(normal, lightDir), 0.0);
//   // specular shading
//   vec3 reflectDir = reflect(-lightDir, normal);
//   float spec = pow(max(dot(viewDir, reflectDir), 0.0), SHININESS);
//   // attenuation
//   float distance = length(light.position - fragPos);
//   float attenuation = 1.0 / (light.constant + light.linear * distance +
//           light.quadratic * (distance * distance));

//   vec3 ambient = light.ambient * u_Ambient;
//   vec3 diffuse = light.diffuse * diff * u_Diffuse;
//   vec3 specular = light.specular * spec * u_Specular;

//   float spotEffect = dot(normalize(light.direction), -lightDir);
//   float spotCosCutoff = cos(light.angle / 180.0 * PI);
//   float spotCosOuterCutoff = cos((light.angle + light.blur) / 180.0 * PI);
//   float spotCosInnerCutoff = cos((light.angle - light.blur) / 180.0 * PI);
//   if (spotEffect > spotCosCutoff) {
//     spotEffect = pow(smoothstep(spotCosOuterCutoff, spotCosInnerCutoff, spotEffect), light.exponent);
//   } else {
//     spotEffect = 0.0;
//   }

//   return ambient + attenuation * (spotEffect * diffuse + specular);
// }

vec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {
  vec3 weight = vec3(0.0);
  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {
    if (i >= u_NumOfDirectionalLights) {
      break;
    }
    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);
  }
  // for (int i = 0; i < MAX_NUM_OF_SPOT_LIGHTS; i++) {
  //   if (i >= u_NumOfSpotLights) {
  //     break;
  //   }
  //   weight += calc_spot_light(u_SpotLights[i], normal, position, viewDir);
  // }
  return weight;
}
`,Od=`varying vec4 v_PickingResult;
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_shaderPick;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

/*
 * Returns highlight color if this item is selected.
 */
vec4 filterHighlightColor(vec4 color, float weight) {
  bool selected = bool(v_PickingResult.a);

  if (selected) {
    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;

    float highLightAlpha = highLightColor.a;
    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));

    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);
    return vec4(resultRGB * weight, color.a);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 filterPickingColor(vec4 color) {
  vec3 pickingColor = v_PickingResult.rgb;
  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {
    discard;
  }
  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 filterColor(vec4 color) {
  // TODO: \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, 1.0));
  }
  
}

// TODO: \u4F18\u5316\u6C34\u6CE2\u70B9 blend additive \u6A21\u5F0F\u4E0B\u6709\u7684\u62FE\u53D6\u6548\u679C 
vec4 filterColorAnimate(vec4 color) {
  // TODO: \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, color.a));
  }
}

vec4 filterColorWithLight(vec4 color, float lightWeight) {
  // TODO: \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, lightWeight));
  }
}

`,_v=`attribute vec3 a_PickingColor;
varying vec4 v_PickingResult;

uniform vec3 u_PickingColor : [0, 0, 0];
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_PickingThreshold : 1.0;
uniform float u_PickingBuffer: 0.0;
uniform float u_shaderPick;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

bool isVertexPicked(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_PickingColor.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_PickingColor.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_PickingColor.b) < u_PickingThreshold;
}

void setPickingColor(vec3 pickingColor) {
  if(u_shaderPick < 0.5) {
    return;
  }
  // compares only in highlight stage
  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));

  // Stores the picking color so that the fragment shader can render it during picking
  v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}

float setPickingSize(float x) {
   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;
}

float setPickingOrder(float z) {
   bool selected = bool(v_PickingResult.a);
   return selected ? z + 1. : 0.;
}
`,Rd=`
#define E 2.718281828459045
vec2 ProjectFlat(vec2 lnglat){
  float maxs=85.0511287798;
  float lat=max(min(maxs,lnglat.y),-maxs);
  float scale= 268435456.;
  float d=PI/180.;
  float x=lnglat.x*d;
  float y=lat*d;
  y=log(tan((PI/4.)+(y/2.)));

  float a=.5/PI,
  b=.5,
  c=-.5/PI;
  d=.5;
  x=scale*(a*x+b);
  y=scale*(c*y+d);
  return vec2(x,y);
}

vec2 unProjectFlat(vec2 px){
  float a=.5/PI;
  float b=.5;
  float c=-.5/PI;
  float d=.5;
  float scale = 268435456.;
  float x=(px.x/scale-b)/a;
  float y=(px.y/scale-d)/c;
  y=(atan(pow(E,y))-(PI/4.))*2.;
  d=PI/180.;
  float lat=y/d;
  float lng=x/d;
  return vec2(lng,lat);
}

float pixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}

// gaode2.0
vec2 customProject(vec2 lnglat) { // \u7ECF\u7EAC\u5EA6 => \u5E73\u9762\u5750\u6807
  float t = lnglat.x;
  float e = lnglat.y;
  float Sm = 180.0 / PI;
  float Tm = 6378137.0;
  float Rm = PI / 180.0;
  float r = 85.0511287798;
  e = max(min(r, e), -r);
  t *= Rm;
  e *= Rm;
  e = log(tan(PI / 4.0 + e / 2.0));
  return vec2(t * Tm, e * Tm);
}

vec2 unProjCustomCoord(vec2 point) { // \u5E73\u9762\u5750\u6807 => \u7ECF\u7EAC\u5EA6
  float Sm = 57.29577951308232; //180 / Math.PI
  float Tm = 6378137.0;
  float t = point.x;
  float e = point.y;
  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);
}


float customPixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}`,gm=`#define TILE_SIZE 512.0
#define PI 3.1415926536
#define WORLD_SCALE TILE_SIZE / (PI * 2.0)

#define COORDINATE_SYSTEM_LNGLAT 1.0
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0
#define COORDINATE_SYSTEM_P20_OFFSET 6.0
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0

uniform mat4 u_ViewMatrix;
uniform mat4 u_ProjectionMatrix;
uniform mat4 u_ViewProjectionMatrix;
uniform float u_Zoom : 1;
uniform float u_ZoomScale : 1;

uniform float u_CoordinateSystem;
uniform vec2 u_ViewportCenter;
uniform vec4 u_ViewportCenterProjection;
uniform vec3 u_PixelsPerDegree;
uniform vec3 u_PixelsPerDegree2;
uniform vec3 u_PixelsPerMeter;

uniform vec2 u_ViewportSize;
uniform float u_DevicePixelRatio;
uniform float u_FocalDistance;
uniform vec3 u_CameraPosition;

// uniform mat4 u_Mvp;

// web mercator coords -> world coords
vec2 project_mercator(vec2 lnglat) {
  float x = lnglat.x;
  return vec2(
    radians(x) + PI,
    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))
  );
}

float project_scale(float meters) {
  return meters * u_PixelsPerMeter.z;
}


// offset coords -> world coords
vec4 project_offset(vec4 offset) {
  float dy = offset.y;
  dy = clamp(dy, -1., 1.);
  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;
  return vec4(offset.xyz * pixels_per_unit, offset.w);
}

vec3 project_normal(vec3 normal) {
  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);
  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);
}

vec3 project_offset_normal(vec3 vector) {
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01
    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * u_PixelsPerDegree);
  }
  return project_normal(vector);
}
// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01
// reverse Y
vec3 reverse_offset_normal(vec3 vector) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {
    return vector * vec3(1.0, -1.0, 1.0);
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return vector;
  }
  return vector;
}

vec4 project_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    float X = position.x - u_ViewportCenter.x;
    float Y = position.y - u_ViewportCenter.y;
    return project_offset(vec4(X, Y, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return vec4(
      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),
      project_scale(position.z),
      position.w
    );
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // return vec4(
    //   (position.xy * WORLD_SCALE * u_ZoomScale) * vec2(1., -1.), 
    //   project_scale(position.z), 
    //   position.w);

     return vec4(
      position.xy, 
      project_scale(position.z), 
      position.w);
  }
  return position;

  // TODO: \u74E6\u7247\u5750\u6807\u7CFB & \u5E38\u89C4\u4E16\u754C\u5750\u6807\u7CFB
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;
  return offset * u_FocalDistance;
}

float project_pixel_allmap(float pixel) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    return pixel * pow(2.0, u_Zoom);
  }
  return pixel;
}

// \u9002\u914D\u7EB9\u7406\u8D34\u56FE\u7684\u7B49\u50CF\u7D20\u5927\u5C0F
float project_pixel_texture(float pixel) {
  // mapbox zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    return pixel * pow(0.5, u_Zoom);
  }

  // amap2 zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }

  // amap zoom > 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return pixel * pow(0.5, u_Zoom);
  }
  
  // amap zoom < 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return pixel * pow(2.0, (20.0 - u_Zoom));
  }
  return pixel * 2.0;
}

float project_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}
vec2 project_pixel(vec2 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    position.w *= u_PixelsPerMeter.z;
  }

  return viewProjectionMatrix * position + center;
}

// Projects from common space coordinates to clip space
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(
    position,
    u_ViewProjectionMatrix,
    u_ViewportCenterProjection
  );
}

vec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {
  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
     pos.w = pos.w / u_PixelsPerMeter.z;
  }
  return pos;
}


bool isEqual( float a,  float b) {
    return  a< b + 0.001 && a > b - 0.001;
}`,bp=`/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

float sdEquilateralTriangle(vec2 p) {
  float k = sqrt(3.0);
  p.x = abs(p.x) - 1.0;
  p.y = p.y + 1.0/k;
  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
  p.x -= clamp( p.x, -2.0, 0.0 );
  return -length(p)*sign(p.y);
}

float sdBox(vec2 p, vec2 b) {
  vec2 d = abs(p)-b;
  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);
}

float sdPentagon(vec2 p, float r) {
  vec3 k = vec3(0.809016994,0.587785252,0.726542528);
  p.x = abs(p.x);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);
  return length(p)*sign(p.y);
}

float sdHexagon(vec2 p, float r) {
  vec3 k = vec3(-0.866025404,0.5,0.577350269);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdOctogon(vec2 p, float r) {
  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );
  p = abs(p);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdHexagram(vec2 p, float r) {
  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;
  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);
  return length(p)*sign(p.y);
}

float sdRhombus(vec2 p, vec2 b) {
  vec2 q = abs(p);
  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);
  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );
  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );
}

float sdVesica(vec2 p, float r, float d) {
  p = abs(p);
  float b = sqrt(r*r-d*d); // can delay this sqrt
  return ((p.y-b)*d>p.x*b)
          ? length(p-vec2(0.0,b))
          : length(p-vec2(-d,0.0))-r;
}
`,Po=`attribute float a_vertexId;

uniform mat4 u_cellTypeLayout;      // \u63CF\u8FF0\u6570\u636E\u7EB9\u7406 cell \u7ED3\u6784\u7684\u77E9\u9635
uniform sampler2D u_dataTexture;    // \u6570\u636E\u7EB9\u7406

bool hasOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 opacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeOpacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeWidth() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeWidth \u7684\u6570\u636E
  return u_cellTypeLayout[1][2] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStroke() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 stroke \u7684\u6570\u636E
  return u_cellTypeLayout[1][3] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasOffsets() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 offsets \u7684\u6570\u636E
  return u_cellTypeLayout[2][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasThetaOffset() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 thetaOffset \u7684\u6570\u636E
  return u_cellTypeLayout[2][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

// \u6839\u636E\u5750\u6807\u4F4D\u7F6E\u5148\u662F\u8BA1\u7B97 uv \uFF0C\u7136\u540E\u6839\u636E uv \u4ECE\u6570\u636E\u7EB9\u7406\u4E2D\u53D6\u503C
float pos2value(vec2 pos, float columnWidth, float rowHeight) {
  float u = (pos.r - 1.0) * columnWidth + columnWidth/2.0;
  float v = 1.0 - ((pos.g - 1.0) * rowHeight + rowHeight/2.0);
  return texture2D(u_dataTexture, vec2(u, v)).r;
}

/*
  currentRow \u5F53\u524D\u884C
  currentColumn \u5F53\u524D\u5217
  columnCount \u6709\u591A\u5C11\u5217
  nextStep \u9700\u8981\u8BA1\u7B97\u5F53\u524D cell \u540E\u7684\u7B2C\u51E0\u4E2A cell \uFF08\u5F53\u524D cell \u5219 nextStep = 0\uFF09
*/
vec2 nextPos(float currentRow, float currentColumn, float columnCount, float nextStep) {
  float nextColumn = currentColumn;
  float nextRow = currentRow;
  if(currentColumn + nextStep <= columnCount){
    nextColumn = currentColumn + nextStep;
  } else {
    nextColumn = mod(currentColumn + nextStep, columnCount); // \u4E0D\u4F1A\u51FA\u73B0\u8DE8\u4E24\u884C
    nextRow = currentRow + 1.0;
  }
  return vec2(nextColumn, nextRow);
}

// \u8BA1\u7B97\u5F53\u524D\u5355\u4E2A cell \u7684\u5927\u5C0F
float calCellCount() { 
  //   u_cellTypeLayout
  //   cal_height, WIDTH, 0.0, 0.0, // rowCount columnCount - \u51E0\u884C\u51E0\u5217
  //   1.0, 1.0, 1.0, 0.0, // opacity strokeOpacity strokeWidth stroke - 1.0 \u8868\u793A\u6709\u6570\u636E\u6620\u5C04\u30010.0 \u8868\u793A\u6CA1\u6709
  //   1.0, 1.0, 0.0, 0.0, // offsets thetaOffset
  //   0.0, 0.0, 0.0, 0.0
  
  return  u_cellTypeLayout[1][0] +        // opacity
          u_cellTypeLayout[1][1] +        // strokeOpacity
          u_cellTypeLayout[1][2] +        // strokeWidth
          u_cellTypeLayout[1][3] * 4.0 +  // stroke
          u_cellTypeLayout[2][0] * 2.0 +  // offsets
          u_cellTypeLayout[2][1];         // thetaOffset
}`,Kl=`
// \u8BA1\u7B97 opacity \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasOpacity()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 opacity \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureOpacity, textureOffset + 1.0);
  }
}
`,ym=`
// \u8BA1\u7B97 strokeOpaicty \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeOpacity()) {
    return vec2(u_stroke_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeOpacity, textureOffset + 1.0);
  }
}
`,Pf=`
// \u8BA1\u7B97 strokeWidth \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeWidthAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeWidth()) {
    return vec2(u_stroke_width, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeWidth = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeWidth, textureOffset + 1.0);
  }
}
`,Ld=`
// \u8BA1\u7B97 thetaOffset \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calThetaOffsetAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasThetaOffset()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 thetaOffset \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_thetaOffset, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureThetaOffset = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureThetaOffset, textureOffset + 1.0);
  }
}
`,xv=/precision\s+(high|low|medium)p\s+float/,Qp=`#ifdef GL_FRAGMENT_PRECISION_HIGH
 precision highp float;
 #else
 precision mediump float;
#endif
`,wc=/#pragma include (["^+"]?["\ "[a-zA-Z_0-9](.*)"]*?)/g,ed=(xp=(0,Fr.b2)(),xp(fh=function(){function e(){(0,Ct.Z)(this,e),(0,C.Z)(this,"moduleCache",{}),(0,C.Z)(this,"rawContentCache",{})}return(0,qt.Z)(e,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:zh,fs:zh}),this.registerModule("decode",{vs:Uh,fs:""}),this.registerModule("projection",{vs:gm,fs:""}),this.registerModule("project",{vs:Rd,fs:""}),this.registerModule("sdf_2d",{vs:"",fs:bp}),this.registerModule("lighting",{vs:yv,fs:""}),this.registerModule("light",{vs:Id,fs:""}),this.registerModule("picking",{vs:_v,fs:Od}),this.registerModule("styleMapping",{vs:Po,fs:""}),this.registerModule("styleMappingCalThetaOffset",{vs:Ld,fs:""}),this.registerModule("styleMappingCalOpacity",{vs:Kl,fs:""}),this.registerModule("styleMappingCalStrokeOpacity",{vs:ym,fs:""}),this.registerModule("styleMappingCalStrokeWidth",{vs:Pf,fs:""})}},{key:"registerModule",value:function(r,i){if(!this.rawContentCache[r]){var o=i.vs,u=i.fs,d=i.uniforms,_=ch(o),x=_.content,E=_.uniforms,P=ch(u),I=P.content,D=P.uniforms;this.rawContentCache[r]={fs:I,uniforms:ql(ql(ql({},E),D),d),vs:x}}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(r){var i=this;if(this.moduleCache[r])return this.moduleCache[r];var o=this.rawContentCache[r].vs,u=this.rawContentCache[r].fs,d=this.processModule(o,[],"vs"),_=d.content,x=d.includeList,E=this.processModule(u,[],"fs"),P=E.content,I=E.includeList,D=P,Z=Nh()(x.concat(I).concat(r)).reduce(function(re,oe){return ql(ql({},re),i.rawContentCache[oe].uniforms)},{});return xv.test(P)||(D=Qp+P),this.moduleCache[r]={fs:D.trim(),uniforms:Z,vs:_.trim()},this.moduleCache[r]}},{key:"processModule",value:function(r,i,o){var u=this,d=r.replace(wc,function(_,x){var E=x.split(" "),P=E[0].replace(/"/g,"");if(i.indexOf(P)>-1)return"";var I=u.rawContentCache[P][o];i.push(P);var D=u.processModule(I,i,o),Z=D.content;return Z});return{content:d,includeList:i}}}]),e}())||fh),If=L(66213),$l;(function(e){e.Normal="normal",e.PostProcessing="post-processing"})($l||($l={}));var Ep,td,kd,hh,Dd,Sp=(Ep=(0,Fr.b2)(),td=(0,Fr.f3)($t.IShaderModuleService),Ep(kd=(hh=function(){function e(){(0,Ct.Z)(this,e),Bn(this,"shaderModuleService",Dd,this),(0,C.Z)(this,"rendererService",void 0),(0,C.Z)(this,"cameraService",void 0),(0,C.Z)(this,"mapService",void 0),(0,C.Z)(this,"interactionService",void 0),(0,C.Z)(this,"layerService",void 0),(0,C.Z)(this,"config",void 0)}return(0,qt.Z)(e,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return $l.Normal}},{key:"init",value:function(r,i){this.config=i,this.rendererService=r.getContainer().get($t.IRendererService),this.cameraService=r.getContainer().get($t.ICameraService),this.mapService=r.getContainer().get($t.IMapService),this.interactionService=r.getContainer().get($t.IInteractionService),this.layerService=r.getContainer().get($t.ILayerService)}},{key:"render",value:function(r){}}]),e}(),Dd=Ln(hh.prototype,"shaderModuleService",[td],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hh))||kd),Fd,Nd;function bv(e){var n=Zu();return function(){var i=(0,zt.Z)(e),o;if(n){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,wn.Z)(this,o)}}function Zu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var rd=(Fd=(0,Fr.b2)(),Fd(Nd=function(e){(0,Yr.Z)(r,e);var n=bv(r);function r(){return(0,Ct.Z)(this,r),n.apply(this,arguments)}return(0,qt.Z)(r,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(o,u){(0,If.Z)((0,zt.Z)(r.prototype),"init",this).call(this,o,u)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),r}(Sp))||Nd),Bd,Jl,Ev,nd,Of;function Zh(e,n){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Vh(e))||n&&e&&typeof e.length=="number"){r&&(e=r);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(E){throw E},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var u=!0,d=!1,_;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return u=E.done,E},e:function(E){d=!0,_=E},f:function(){try{!u&&r.return!=null&&r.return()}finally{if(d)throw _}}}}function Vh(e,n){if(!!e){if(typeof e=="string")return ph(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ph(e,n)}}function ph(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}var jh=(Bd=(0,Fr.b2)(),Jl=(0,Fr.f3)($t.IPostProcessor),Bd(Ev=(nd=function(){function e(){(0,Ct.Z)(this,e),(0,C.Z)(this,"passes",[]),Bn(this,"postProcessor",Of,this),(0,C.Z)(this,"layer",void 0),(0,C.Z)(this,"renderFlag",void 0),(0,C.Z)(this,"width",0),(0,C.Z)(this,"height",0)}return(0,qt.Z)(e,[{key:"setLayer",value:function(r){this.layer=r}},{key:"setRenderFlag",value:function(r){this.renderFlag=r}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:function(){var n=(0,nl.Z)(a().mark(function i(){var o,u,d;return a().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:o=Zh(this.passes),x.prev=1,o.s();case 3:if((u=o.n()).done){x.next=9;break}return d=u.value,x.next=7,d.render(this.layer);case 7:x.next=3;break;case 9:x.next=14;break;case 11:x.prev=11,x.t0=x.catch(1),o.e(x.t0);case 14:return x.prev=14,o.f(),x.finish(14);case 17:this.layer.renderModels();case 18:case"end":return x.stop()}},i,this,[[1,11,14,17]])}));function r(){return n.apply(this,arguments)}return r}()},{key:"resize",value:function(r,i){(this.width!==r||this.height!==i)&&(this.width=r,this.height=i)}},{key:"add",value:function(r,i){r.getType()===$l.PostProcessing?this.postProcessor.add(r,this.layer,i):(r.init(this.layer,i),this.passes.push(r))}},{key:"insert",value:function(r,i,o){r.init(this.layer,i),this.passes.splice(o,0,r)}},{key:"destroy",value:function(){this.passes.length=0}}]),e}(),Of=Ln(nd.prototype,"postProcessor",[Jl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nd))||Ev),zd,Ud;function Zd(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function Vd(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Zd(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Zd(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function jd(e){var n=Gd();return function(){var i=(0,zt.Z)(e),o;if(n){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,wn.Z)(this,o)}}function Gd(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Yc=(zd=(0,Fr.b2)(),zd(Ud=function(e){(0,Yr.Z)(r,e);var n=jd(r);function r(){var i;(0,Ct.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return i=n.call.apply(n,[this].concat(u)),(0,C.Z)((0,be.Z)(i),"pickingFBO",void 0),(0,C.Z)((0,be.Z)(i),"layer",void 0),(0,C.Z)((0,be.Z)(i),"width",0),(0,C.Z)((0,be.Z)(i),"height",0),(0,C.Z)((0,be.Z)(i),"alreadyInRendering",!1),(0,C.Z)((0,be.Z)(i),"pickFromPickingFBO",function(_){var x=_.x,E=_.y,P=_.lngLat,I=_.type;if(!(!i.layer.isVisible()||!i.layer.needPick(I))){var D=i.rendererService,Z=D.getViewportSize,re=D.readPixels,oe=D.useFramebuffer,de=Z(),Fe=de.width,it=de.height,vt=i.layer.getLayerConfig(),xt=vt.enableHighlight,Gt=vt.enableSelect,Xt=x*ka,nr=E*ka;if(!(Xt>Fe||Xt<0||nr>it||nr<0)){var mr;oe(i.pickingFBO,function(){var en;if(mr=re({x:Math.round(Xt),y:Math.round(it-(E+1)*ka),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:i.pickingFBO}),mr[0]!==0||mr[1]!==0||mr[2]!==0){var hn=Ou(mr),wr=i.layer.getSource().getFeatureById(hn),Pn={x,y:E,type:I,lngLat:P,featureId:hn,feature:wr};wr&&(i.layer.setCurrentPickId(hn),i.triggerHoverOnLayer(Pn))}else{var jn={x,y:E,lngLat:P,type:i.layer.getCurrentPickId()===null?"un"+I:"mouseout",featureId:null,feature:null};i.triggerHoverOnLayer(Vd(Vd({},jn),{},{type:"unpick"})),i.triggerHoverOnLayer(jn),i.layer.setCurrentPickId(null)}xt&&i.highlightPickedFeature(mr),Gt&&I==="click"&&((en=mr)===null||en===void 0?void 0:en.toString())!==[0,0,0,0].toString()&&i.selectFeature(mr)})}}}),i}return(0,qt.Z)(r,[{key:"getType",value:function(){return $l.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(o,u){(0,If.Z)((0,zt.Z)(r.prototype),"init",this).call(this,o,u),this.layer=o;var d=this.rendererService,_=d.createTexture2D,x=d.createFramebuffer,E=d.getViewportSize,P=E(),I=P.width,D=P.height;this.pickingFBO=x({color:_({width:I,height:D,wrapS:m.CLAMP_TO_EDGE,wrapT:m.CLAMP_TO_EDGE})}),this.interactionService.on(Cs.Hover,this.pickFromPickingFBO),this.interactionService.on(Cs.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(Cs.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(o){var u=this;if(!this.alreadyInRendering){var d=this.rendererService,_=d.getViewportSize,x=d.useFramebuffer,E=d.clear,P=_(),I=P.width,D=P.height;this.alreadyInRendering=!0,(this.width!==I||this.height!==D)&&(this.pickingFBO.resize({width:I,height:D}),this.width=I,this.height=D),x(this.pickingFBO,function(){E({framebuffer:u.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var Z=u.layer.multiPassRenderer.getRenderFlag();u.layer.multiPassRenderer.setRenderFlag(!1),o.hooks.beforePickingEncode.call(),o.render(),o.hooks.afterPickingEncode.call(),u.layer.multiPassRenderer.setRenderFlag(Z),u.alreadyInRendering=!1})}}},{key:"triggerHoverOnLayer",value:function(o){this.layer.emit(o.type,o)}},{key:"highlightPickedFeature",value:function(o){var u=(0,An.Z)(o,3),d=u[0],_=u[1],x=u[2];this.layer.hooks.beforeHighlight.call([d,_,x]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(o){var u=(0,An.Z)(o,3),d=u[0],_=u[1],x=u[2];this.layer.hooks.beforeSelect.call([d,_,x]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(o){var u=o.featureId,d=Ji(u);this.selectFeature(new Uint8Array(d))}},{key:"highlightFeatureHandle",value:function(o){var u=o.featureId,d=Ji(u);this.highlightPickedFeature(new Uint8Array(d))}}]),r}(Sp))||Ud),Sv=L(11700),Hd=L.n(Sv),Wd=L(68929),wv=L.n(Wd),id,Xd,Yd,wp,qd;function Gh(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function Hh(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Gh(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Gh(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var ad=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Rf=(id=(0,Fr.b2)(),Xd=(0,Fr.f3)($t.IShaderModuleService),id(Yd=(wp=function(){function e(){(0,Ct.Z)(this,e),Bn(this,"shaderModuleService",qd,this),(0,C.Z)(this,"rendererService",void 0),(0,C.Z)(this,"config",void 0),(0,C.Z)(this,"quad",ad),(0,C.Z)(this,"enabled",!0),(0,C.Z)(this,"renderToScreen",!1),(0,C.Z)(this,"model",void 0),(0,C.Z)(this,"name",void 0),(0,C.Z)(this,"optionsToUpdate",{})}return(0,qt.Z)(e,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(r){this.name=r}},{key:"getType",value:function(){return $l.PostProcessing}},{key:"init",value:function(r,i){this.config=i,this.rendererService=r.getContainer().get($t.IRendererService);var o=this.rendererService,u=o.createAttribute,d=o.createBuffer,_=o.createModel,x=this.setupShaders(),E=x.vs,P=x.fs,I=x.uniforms;this.model=_({vs:E,fs:P,attributes:{a_Position:u({buffer:d({data:[-4,-4,4,-4,0,4],type:m.FLOAT}),size:2})},uniforms:Hh(Hh({u_Texture:null},I),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:this.getName()==="copy"}})}},{key:"render",value:function(r){var i=this,o=r.multiPassRenderer.getPostProcessor(),u=this.rendererService,d=u.useFramebuffer,_=u.getViewportSize,x=u.clear,E=_(),P=E.width,I=E.height;d(this.renderToScreen?null:o.getWriteFBO(),function(){x({framebuffer:o.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0}),i.model.draw({uniforms:Hh({u_Texture:o.getReadFBO(),u_ViewportSize:[P,I]},i.convertOptionsToUniforms(i.optionsToUpdate))})})}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(r){this.enabled=r}},{key:"setRenderToScreen",value:function(r){this.renderToScreen=r}},{key:"updateOptions",value:function(r){this.optionsToUpdate=Hh(Hh({},this.optionsToUpdate),r)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(r){var i={};return Object.keys(r).forEach(function(o){li()(r[o])||(i["u_".concat(Hd()(wv()(o)))]=r[o])}),i}}]),e}(),qd=Ln(wp.prototype,"shaderModuleService",[Xd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wp))||Yd),Kd,Cv;function Tv(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function Av(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Tv(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Tv(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function _m(e){var n=xm();return function(){var i=(0,zt.Z)(e),o;if(n){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,wn.Z)(this,o)}}function xm(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var bm=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,Em=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Sm=(Kd=(0,Fr.b2)(),Kd(Cv=function(e){(0,Yr.Z)(r,e);var n=_m(r);function r(){return(0,Ct.Z)(this,r),n.apply(this,arguments)}return(0,qt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:Em,fs:bm});var o=this.shaderModuleService.getModule("blur-pass"),u=o.vs,d=o.fs,_=o.uniforms,x=this.rendererService.getViewportSize(),E=x.width,P=x.height;return{vs:u,fs:d,uniforms:Av(Av({},_),{},{u_ViewportSize:[E,P]})}}},{key:"convertOptionsToUniforms",value:function(o){var u={};return li()(o.blurRadius)||(u.u_BlurDir=[o.blurRadius,0]),u}}]),r}(Rf))||Cv),Ql,Cp;function $d(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function Wh(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?$d(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$d(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function Mv(e){var n=ox();return function(){var i=(0,zt.Z)(e),o;if(n){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,wn.Z)(this,o)}}function ox(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var sx=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,ux=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,lx=(Ql=(0,Fr.b2)(),Ql(Cp=function(e){(0,Yr.Z)(r,e);var n=Mv(r);function r(){return(0,Ct.Z)(this,r),n.apply(this,arguments)}return(0,qt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:ux,fs:sx});var o=this.shaderModuleService.getModule("blur-pass"),u=o.vs,d=o.fs,_=o.uniforms,x=this.rendererService.getViewportSize(),E=x.width,P=x.height;return{vs:u,fs:d,uniforms:Wh(Wh({},_),{},{u_ViewportSize:[E,P]})}}},{key:"convertOptionsToUniforms",value:function(o){var u={};return li()(o.blurRadius)||(u.u_BlurDir=[0,o.blurRadius]),u}}]),r}(Rf))||Cp),n0,i0;function a0(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function o0(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?a0(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a0(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function cx(e){var n=fx();return function(){var i=(0,zt.Z)(e),o;if(n){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,wn.Z)(this,o)}}function fx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var hx=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Angle : 0;
uniform float u_Size : 8;

#pragma include "common"

float scale = PI / u_Size;

float pattern(float u_Angle, vec2 texSize, vec2 texCoord) {
  float s = sin(u_Angle), c = cos(u_Angle);
  vec2 tex = texCoord * texSize - u_Center * texSize;
  vec2 point = vec2(
    c * tex.x - s * tex.y,
    s * tex.x + c * tex.y
  ) * scale;
  return (sin(point.x) * sin(point.y)) * 4.0;
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js
vec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {
  vec3 cmy = 1.0 - color.rgb;
  float k = min(cmy.x, min(cmy.y, cmy.z));
  cmy = (cmy - k) / (1.0 - k);
  cmy = clamp(
    cmy * 10.0 - 3.0 + vec3(
      pattern(u_Angle + 0.26179, texSize, texCoord),
      pattern(u_Angle + 1.30899, texSize, texCoord),
      pattern(u_Angle, texSize, texCoord)
    ),
    0.0,
    1.0
  );
  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);
  return vec4(1.0 - cmy - k, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);
}`,px=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,dx=(n0=(0,Fr.b2)(),n0(i0=function(e){(0,Yr.Z)(r,e);var n=cx(r);function r(){return(0,Ct.Z)(this,r),n.apply(this,arguments)}return(0,qt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:px,fs:hx});var o=this.shaderModuleService.getModule("colorhalftone-pass"),u=o.vs,d=o.fs,_=o.uniforms,x=this.rendererService.getViewportSize(),E=x.width,P=x.height;return{vs:u,fs:d,uniforms:o0(o0({},_),{},{u_ViewportSize:[E,P]})}}}]),r}(Rf))||i0),s0,u0;function vx(e){var n=mx();return function(){var i=(0,zt.Z)(e),o;if(n){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,wn.Z)(this,o)}}function mx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var gx=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,yx=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,_x=(s0=(0,Fr.b2)(),s0(u0=function(e){(0,Yr.Z)(r,e);var n=vx(r);function r(){return(0,Ct.Z)(this,r),n.apply(this,arguments)}return(0,qt.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:yx,fs:gx}),this.shaderModuleService.getModule("copy-pass")}}]),r}(Rf))||u0),l0,c0;function f0(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function h0(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?f0(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):f0(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function xx(e){var n=bx();return function(){var i=(0,zt.Z)(e),o;if(n){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,wn.Z)(this,o)}}function bx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ex=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Scale : 10;

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js
vec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;
  tex.y /= 0.866025404;
  tex.x -= tex.y * 0.5;
  vec2 a;
  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {
    a = vec2(floor(tex.x), floor(tex.y));
  }
  else a = vec2(ceil(tex.x), ceil(tex.y));
  vec2 b = vec2(ceil(tex.x), floor(tex.y));
  vec2 c = vec2(floor(tex.x), ceil(tex.y));
  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);
  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);
  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);
  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);
  float alen = length(TEX - A);
  float blen = length(TEX - B);
  float clen = length(TEX - C);
  vec2 choice;
  if (alen < blen) {
    if (alen < clen) choice = a;
    else choice = c;
  } else {
    if (blen < clen) choice = b;
    else choice = c;
  }
  choice.x += choice.y * 0.5;
  choice.y *= 0.866025404;
  choice *= u_Scale / texSize;
  return texture2D(texture, choice + u_Center);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,Sx=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Cx=(l0=(0,Fr.b2)(),l0(c0=function(e){(0,Yr.Z)(r,e);var n=xx(r);function r(){return(0,Ct.Z)(this,r),n.apply(this,arguments)}return(0,qt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:Sx,fs:Ex});var o=this.shaderModuleService.getModule("hexagonalpixelate-pass"),u=o.vs,d=o.fs,_=o.uniforms,x=this.rendererService.getViewportSize(),E=x.width,P=x.height;return{vs:u,fs:d,uniforms:h0(h0({},_),{},{u_ViewportSize:[E,P]})}}}]),r}(Rf))||c0),p0,d0;function v0(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function m0(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?v0(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):v0(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function Tx(e){var n=Ax();return function(){var i=(0,zt.Z)(e),o;if(n){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,wn.Z)(this,o)}}function Ax(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Mx=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_Strength : 0.6;

vec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 dx = vec2(1.0 / texSize.x, 0.0);
  vec2 dy = vec2(0.0, 1.0 / texSize.y);
  vec4 color = texture2D(texture, texCoord);
  float bigTotal = 0.0;
  float smallTotal = 0.0;
  vec3 bigAverage = vec3(0.0);
  vec3 smallAverage = vec3(0.0);
  for (float x = -2.0; x <= 2.0; x += 1.0) {
    for (float y = -2.0; y <= 2.0; y += 1.0) {
      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;
      bigAverage += sample;
      bigTotal += 1.0;
      if (abs(x) + abs(y) < 2.0) {
        smallAverage += sample;
        smallTotal += 1.0;
      }
    }
  }
  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);
  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;
  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,Px=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Ix=(p0=(0,Fr.b2)(),p0(d0=function(e){(0,Yr.Z)(r,e);var n=Tx(r);function r(){return(0,Ct.Z)(this,r),n.apply(this,arguments)}return(0,qt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:Px,fs:Mx});var o=this.shaderModuleService.getModule("ink-pass"),u=o.vs,d=o.fs,_=o.uniforms,x=this.rendererService.getViewportSize(),E=x.width,P=x.height;return{vs:u,fs:d,uniforms:m0(m0({},_),{},{u_ViewportSize:[E,P]})}}}]),r}(Rf))||d0),g0,y0;function Ox(e){var n=Rx();return function(){var i=(0,zt.Z)(e),o;if(n){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,wn.Z)(this,o)}}function Rx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Lx=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform float u_Amount : 0.5;

float rand(vec2 co) {
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js
vec4 noise_filterColor(vec4 color, vec2 texCoord) {
  float diff = (rand(texCoord) - 0.5) * u_Amount;
  color.r += diff;
  color.g += diff;
  color.b += diff;
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);
}`,kx=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Dx=(g0=(0,Fr.b2)(),g0(y0=function(e){(0,Yr.Z)(r,e);var n=Ox(r);function r(){return(0,Ct.Z)(this,r),n.apply(this,arguments)}return(0,qt.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:kx,fs:Lx}),this.shaderModuleService.getModule("noise-pass")}}]),r}(Rf))||y0),_0,x0;function Fx(e){var n=Nx();return function(){var i=(0,zt.Z)(e),o;if(n){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,wn.Z)(this,o)}}function Nx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Bx=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,zx=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform float u_Amount : 0.5;

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js
vec4 sepia_filterColor(vec4 color) {
  float r = color.r;
  float g = color.g;
  float b = color.b;
  color.r =
    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));
  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));
  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = sepia_filterColor(gl_FragColor);
}`,Ux=(_0=(0,Fr.b2)(),_0(x0=function(e){(0,Yr.Z)(r,e);var n=Fx(r);function r(){return(0,Ct.Z)(this,r),n.apply(this,arguments)}return(0,qt.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:Bx,fs:zx}),this.shaderModuleService.getModule("sepia-pass")}}]),r}(Rf))||x0),b0,E0,S0,w0,od,C0,Zx=(b0=(0,Fr.b2)(),E0=(0,Fr.f3)($t.IRendererService),S0=(0,Fr.zY)(),b0(w0=(od=function(){function e(){(0,Ct.Z)(this,e),Bn(this,"rendererService",C0,this),(0,C.Z)(this,"passes",[]),(0,C.Z)(this,"readFBO",void 0),(0,C.Z)(this,"writeFBO",void 0)}return(0,qt.Z)(e,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"render",value:function(){var n=(0,nl.Z)(a().mark(function i(o){var u,d;return a().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:u=0;case 1:if(!(u<this.passes.length)){x.next=10;break}return d=this.passes[u],d.setRenderToScreen(this.isLastEnabledPass(u)),x.next=6,d.render(o);case 6:u!==this.passes.length-1&&this.swap();case 7:u++,x.next=1;break;case 10:case"end":return x.stop()}},i,this)}));function r(i){return n.apply(this,arguments)}return r}()},{key:"resize",value:function(r,i){this.readFBO.resize({width:r,height:i}),this.writeFBO.resize({width:r,height:i})}},{key:"add",value:function(r,i,o){r.init(i,o),this.passes.push(r)}},{key:"insert",value:function(r,i,o,u){r.init(o,u),this.passes.splice(i,0,r)}},{key:"getPostProcessingPassByName",value:function(r){return this.passes.find(function(i){return i.getName()===r})}},{key:"init",value:function(){}},{key:"isLastEnabledPass",value:function(r){for(var i=r+1;i<this.passes.length;i++)if(this.passes[i].isEnabled())return!1;return!0}},{key:"swap",value:function(){var r=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=r}}]),e}(),C0=Ln(od.prototype,"rendererService",[E0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ln(od.prototype,"init",[S0],Object.getOwnPropertyDescriptor(od.prototype,"init"),od.prototype),od))||w0),T0,A0;function Vx(e){var n=jx();return function(){var i=(0,zt.Z)(e),o;if(n){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,wn.Z)(this,o)}}function jx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Gx=(T0=(0,Fr.b2)(),T0(A0=function(e){(0,Yr.Z)(r,e);var n=Vx(r);function r(){return(0,Ct.Z)(this,r),n.apply(this,arguments)}return(0,qt.Z)(r,[{key:"getType",value:function(){return $l.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(o,u){(0,If.Z)((0,zt.Z)(r.prototype),"init",this).call(this,o,u)}},{key:"render",value:function(o){var u=this.rendererService,d=u.useFramebuffer,_=u.clear;d(null,function(){_({color:[0,0,0,0],depth:1,stencil:0}),o.multiPassRenderer.setRenderFlag(!1),o.render(),o.multiPassRenderer.setRenderFlag(!0)})}}]),r}(Sp))||A0),M0,P0,I0,wm,O0;function R0(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function L0(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?R0(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):R0(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function Hx(e){var n=Wx();return function(){var i=(0,zt.Z)(e),o;if(n){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,wn.Z)(this,o)}}function Wx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Xx=`uniform float u_opacity : 1.0;
uniform float u_MixRatio : 0.5;

uniform sampler2D u_Diffuse1;
uniform sampler2D u_Diffuse2;

varying vec2 v_UV;

void main() {
  vec4 texel1 = texture2D(u_Diffuse1, v_UV);
  vec4 texel2 = texture2D(u_Diffuse2, v_UV);
  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);
}
`,k0=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,Yx=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;function D0(e,n){for(var r=0,i=1/n,o=e;o>0;)r=r+i*(o%n),o=Math.floor(o/n),i=i/n;return r}var qx=1,Kx=(M0=(0,Fr.b2)(),P0=(0,Fr.f3)($t.IShaderModuleService),M0(I0=(wm=function(e){(0,Yr.Z)(r,e);var n=Hx(r);function r(){var i;(0,Ct.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return i=n.call.apply(n,[this].concat(u)),Bn((0,be.Z)(i),"shaderModuleService",O0,(0,be.Z)(i)),(0,C.Z)((0,be.Z)(i),"haltonSequence",[]),(0,C.Z)((0,be.Z)(i),"accumulatingId",0),(0,C.Z)((0,be.Z)(i),"frame",0),(0,C.Z)((0,be.Z)(i),"timer",void 0),(0,C.Z)((0,be.Z)(i),"sampleRenderTarget",void 0),(0,C.Z)((0,be.Z)(i),"prevRenderTarget",void 0),(0,C.Z)((0,be.Z)(i),"outputRenderTarget",void 0),(0,C.Z)((0,be.Z)(i),"copyRenderTarget",void 0),(0,C.Z)((0,be.Z)(i),"blendModel",void 0),(0,C.Z)((0,be.Z)(i),"outputModel",void 0),(0,C.Z)((0,be.Z)(i),"copyModel",void 0),i}return(0,qt.Z)(r,[{key:"getType",value:function(){return $l.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(o,u){(0,If.Z)((0,zt.Z)(r.prototype),"init",this).call(this,o,u);var d=this.rendererService,_=d.createFramebuffer,x=d.createTexture2D;this.sampleRenderTarget=_({color:x({width:1,height:1,wrapS:m.CLAMP_TO_EDGE,wrapT:m.CLAMP_TO_EDGE})}),this.prevRenderTarget=_({color:x({width:1,height:1,wrapS:m.CLAMP_TO_EDGE,wrapT:m.CLAMP_TO_EDGE})}),this.outputRenderTarget=_({color:x({width:1,height:1,wrapS:m.CLAMP_TO_EDGE,wrapT:m.CLAMP_TO_EDGE})}),this.copyRenderTarget=_({color:x({width:1,height:1,wrapS:m.CLAMP_TO_EDGE,wrapT:m.CLAMP_TO_EDGE})});for(var E=0;E<30;E++)this.haltonSequence.push([D0(E,2),D0(E,3)]);this.blendModel=this.createTriangleModel("blend-pass",Xx),this.outputModel=this.createTriangleModel("copy-pass",k0,{blend:{enable:!0,func:{srcRGB:m.ONE,dstRGB:m.ONE_MINUS_SRC_ALPHA,srcAlpha:m.ONE,dstAlpha:m.ONE_MINUS_SRC_ALPHA},equation:{rgb:m.FUNC_ADD,alpha:m.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",k0)}},{key:"render",value:function(o){var u=this,d=this.rendererService,_=d.clear,x=d.getViewportSize,E=d.useFramebuffer,P=x(),I=P.width,D=P.height;this.sampleRenderTarget.resize({width:I,height:D}),this.prevRenderTarget.resize({width:I,height:D}),this.outputRenderTarget.resize({width:I,height:D}),this.copyRenderTarget.resize({width:I,height:D}),this.resetFrame(),this.stopAccumulating();var Z=o.multiPassRenderer.getPostProcessor().getReadFBO();E(Z,function(){_({color:[0,0,0,0],depth:1,stencil:0,framebuffer:Z}),o.multiPassRenderer.setRenderFlag(!1),o.render(),o.multiPassRenderer.setRenderFlag(!0)});var re=function oe(de){!u.accumulatingId||de!==u.accumulatingId||u.isFinished()||(u.doRender(o),fa.requestAnimationFrame(function(){oe(de)}))};this.accumulatingId=qx++,this.timer=fa.setTimeout(function(){re(u.accumulatingId)},50)}},{key:"doRender",value:function(o){var u=this,d=this.rendererService,_=d.clear,x=d.getViewportSize,E=d.useFramebuffer,P=x(),I=P.width,D=P.height,Z=o.getLayerConfig(),re=Z.jitterScale,oe=re===void 0?1:re,de=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((de[0]*2-1)/I*oe,(de[1]*2-1)/D*oe),o.multiPassRenderer.setRenderFlag(!1),o.hooks.beforeRender.call(),E(this.sampleRenderTarget,function(){_({color:[0,0,0,0],depth:1,stencil:0,framebuffer:u.sampleRenderTarget}),o.render()}),o.hooks.afterRender.call(),o.multiPassRenderer.setRenderFlag(!0);var Fe=o.getLayerConfig();E(this.outputRenderTarget,function(){u.blendModel.draw({uniforms:{u_opacity:Fe.opacity||1,u_MixRatio:u.frame===0?1:.9,u_Diffuse1:u.sampleRenderTarget,u_Diffuse2:u.frame===0?o.multiPassRenderer.getPostProcessor().getReadFBO():u.prevRenderTarget}})}),this.frame===0&&_({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(E(this.copyRenderTarget,function(){u.outputModel.draw({uniforms:{u_Texture:u.outputRenderTarget}})}),E(o.multiPassRenderer.getPostProcessor().getReadFBO(),function(){u.copyModel.draw({uniforms:{u_Texture:u.copyRenderTarget}})}),o.multiPassRenderer.getPostProcessor().render(o));var it=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=it,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,fa.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(o,u,d){this.shaderModuleService.registerModule(o,{vs:Yx,fs:u});var _=this.shaderModuleService.getModule(o),x=_.vs,E=_.fs,P=_.uniforms,I=this.rendererService,D=I.createAttribute,Z=I.createBuffer,re=I.createModel;return re(L0({vs:x,fs:E,attributes:{a_Position:D({buffer:Z({data:[-4,-4,4,-4,0,4],type:m.FLOAT}),size:2})},uniforms:L0({},P),depth:{enable:!1},count:3},d))}}]),r}(Sp),O0=Ln(wm.prototype,"shaderModuleService",[P0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wm))||I0),sd=new Fr.W2;sd.bind($t.IGlobalConfigService).to(yo).inSingletonScope(),sd.bind($t.IShaderModuleService).to(ed).inSingletonScope(),(0,Fr.GW)((0,Fr.b2)(),ha.EventEmitter),sd.bind($t.IEventEmitter).to(ha.EventEmitter);var F0=(0,Up.Z)(sd,!1),Jd=function(n){var r=F0.lazyInject(n);return function(i,o,u){r.call(this,i,o),u&&(u.initializer=function(){return i[o]})}},jM=function(n){var r=F0.lazyMultiInject(n);return function(i,o,u){r.call(this,i,o),u&&(u.initializer=function(){return i[o]})}},ec=sd,$x=0;function Jx(){var e=new Fr.W2;return e.parent=sd,e.bind($t.SceneID).toConstantValue("".concat($x++)),e.bind($t.ILayerService).to(ti).inSingletonScope(),e.bind($t.ISceneService).to($p).inSingletonScope(),e.bind($t.ICameraService).to(Rr).inSingletonScope(),e.bind($t.ICoordinateSystemService).to(Xo).inSingletonScope(),e.bind($t.IInteractionService).to(Mf).inSingletonScope(),e.bind($t.IPickingService).to(bt).inSingletonScope(),e.bind($t.IControlService).to(Hr).inSingletonScope(),e.bind($t.IMarkerService).to(Kr).inSingletonScope(),e.bind($t.IIconService).to(Ih).inSingletonScope(),e.bind($t.IFontService).to(Wc).inSingletonScope(),e.bind($t.IPopupService).to(Xr).inSingletonScope(),e.bind($t.INormalPass).to(rd).whenTargetNamed("clear"),e.bind($t.INormalPass).to(Yc).whenTargetNamed("pixelPicking"),e.bind($t.INormalPass).to(Gx).whenTargetNamed("render"),e.bind($t.INormalPass).to(Kx).whenTargetNamed("taa"),e.bind($t.IFactoryNormalPass).toFactory(function(n){return function(r){return n.container.getNamed($t.INormalPass,r)}}),e.bind($t.IPostProcessingPass).to(_x).whenTargetNamed("copy"),e.bind($t.IPostProcessingPass).to(Sm).whenTargetNamed("blurH"),e.bind($t.IPostProcessingPass).to(lx).whenTargetNamed("blurV"),e.bind($t.IPostProcessingPass).to(Dx).whenTargetNamed("noise"),e.bind($t.IPostProcessingPass).to(Ux).whenTargetNamed("sepia"),e.bind($t.IPostProcessingPass).to(dx).whenTargetNamed("colorHalftone"),e.bind($t.IPostProcessingPass).to(Cx).whenTargetNamed("hexagonalPixelate"),e.bind($t.IPostProcessingPass).to(Ix).whenTargetNamed("ink"),e.bind($t.IFactoryPostProcessingPass).toFactory(function(n){return function(r){var i=n.container.getNamed($t.IPostProcessingPass,r);return i.setName(r),i}}),e}function Qx(e){var n=new Fr.W2;return n.parent=e,n.bind($t.IStyleAttributeService).to(Bs).inSingletonScope(),n.bind($t.IMultiPassRenderer).to(jh).inSingletonScope(),n.bind($t.IPostProcessor).to(Zx).inSingletonScope(),n}var GM=L(74691),eb=null;function HM(e){return eb.indexOf(e)}var tb=2,WM=4,rb=64,XM=128,nb=256,ib=512,YM=8192,qM=16384,KM=32768,ab=null,N0=131072,$M=262144,ob=524288,JM=1048576,sb=2097152,QM=4194304,ub=8388608,lb=16777216,cb=null;function Pv(e,n){return e=_clamp(Math.floor(e),0,255),n=_clamp(Math.floor(n),0,255),256*e+n}function eP(e){var n=e.color,r=e.radius,i=e.tileX,o=e.tileY,u=e.shape,d=e.opacity,_=e.stroke,x=e.strokeWidth,E=e.strokeOpacity,P=[],I=[],D=[],Z=[Pv(n[0],n[1]),Pv(n[2],n[3])],re=[Pv(_[0],_[1]),Pv(_[2],_[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach(function(oe){var de=_slicedToArray(oe,2),Fe=de[0],it=de[1];P.push([].concat(Z,[(Fe+1)*ub+(it+1)*sb+getShapeIndex(u)*N0+r,(i+512)*ob+(o+512)*rb])),I.push([].concat(re,[x,E])),D.push([d,0,0,0])}),{packedBuffer:P,packedBuffer2:I,packedBuffer3:D}}function tP(e,n){if(e===0&&!n)return 0;if(e===1&&n)return 4294967295;var r=n?1:0,i=Math.floor(e*127);return i*cb+r*lb+i*N0+r*ab+i*ib+r*nb+i*tb+r}var qc;(function(e){e.normal="normal",e.additive="additive",e.subtractive="subtractive",e.min="min",e.max="max",e.none="none"})(qc||(qc={}));var Ks;(function(e){e.LINEAR="linear",e.POWER="power",e.LOG="log",e.IDENTITY="identity",e.TIME="time",e.QUANTILE="quantile",e.QUANTIZE="quantize",e.THRESHOLD="threshold",e.CAT="cat"})(Ks||(Ks={}));var Xh;(function(e){e.CONSTANT="constant",e.VARIABLE="variable"})(Xh||(Xh={}));var wi;(function(e){e[e.Attribute=0]="Attribute",e[e.InstancedAttribute=1]="InstancedAttribute",e[e.Uniform=2]="Uniform"})(wi||(wi={}));var fb=["mapload","mapchange"],Tp={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"},Cm=["loaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"],Yh;(function(e){e.TOPRIGHT="topright",e.TOPLEFT="topleft",e.BOTTOMRIGHT="bottomright",e.BOTTOMLEFT="bottomleft",e.TOPCENTER="topcenter",e.BOTTOMCENTER="bottomcenter",e.LEFTCENTER="leftcenter",e.RIGHTCENTER="rightcenter"})(Yh||(Yh={}));function B0(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function z0(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?B0(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):B0(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function hb(e){var n=pb();return function(){var i=(0,zt.Z)(e),o;if(n){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,wn.Z)(this,o)}}function pb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var db=0,Iv=function(e){(0,Yr.Z)(r,e);var n=hb(r);function r(i){var o;return(0,Ct.Z)(this,r),o=n.call(this),(0,C.Z)((0,be.Z)(o),"controlOption",void 0),(0,C.Z)((0,be.Z)(o),"container",void 0),(0,C.Z)((0,be.Z)(o),"sceneContainer",void 0),(0,C.Z)((0,be.Z)(o),"mapsService",void 0),(0,C.Z)((0,be.Z)(o),"renderService",void 0),(0,C.Z)((0,be.Z)(o),"layerService",void 0),(0,C.Z)((0,be.Z)(o),"controlService",void 0),(0,C.Z)((0,be.Z)(o),"isShow",void 0),o.controlOption=z0(z0({},o.getDefault()),i||{}),o}return(0,qt.Z)(r,[{key:"getDefault",value:function(){return{position:Yh.TOPRIGHT,name:"".concat(db++)}}},{key:"setPosition",value:function(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Yh.BOTTOMRIGHT,u=this.controlService;return u&&u.removeControl(this),this.controlOption.position=o,u&&u.addControl(this,this.sceneContainer),this}},{key:"addTo",value:function(o){this.mapsService=o.get($t.IMapService),this.renderService=o.get($t.IRendererService),this.layerService=o.get($t.ILayerService),this.controlService=o.get($t.IControlService),this.sceneContainer=o,this.isShow=!0,this.container=this.onAdd();var u=this.container,d=this.controlOption.position,_=this.controlService.controlCorners[d];return Dl(u,"l7-control"),d.indexOf("bottom")!==-1?_.insertBefore(u,_.firstChild):_.appendChild(u),this}},{key:"onAdd",value:function(){throw new Error("Method not implemented.")}},{key:"onRemove",value:function(){throw new Error("Method not implemented.")}},{key:"hide",value:function(){var o=this.container;Dl(o,"l7-control-hide"),this.isShow=!1}},{key:"show",value:function(){var o=this.container;Yu(o,"l7-control-hide"),this.isShow=!0}},{key:"remove",value:function(){if(!this.mapsService)return this;lc(this.container),this.onRemove()}},{key:"_refocusOnMap",value:function(o){if(this.mapsService&&o&&o.screenX>0&&o.screenY>0){var u=this.mapsService.getContainer();u!==null&&u.focus()}}}]),r}(ha.EventEmitter);function vb(e){var n=mb();return function(){var i=(0,zt.Z)(e),o;if(n){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,wn.Z)(this,o)}}function mb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var rP=function(e){(0,Yr.Z)(r,e);var n=vb(r);function r(i){var o;return(0,Ct.Z)(this,r),o=n.call(this,i),(0,C.Z)((0,be.Z)(o),"layerControlInputs",void 0),(0,C.Z)((0,be.Z)(o),"layers",void 0),(0,C.Z)((0,be.Z)(o),"lastZIndex",void 0),(0,C.Z)((0,be.Z)(o),"handlingClick",void 0),(0,C.Z)((0,be.Z)(o),"layersLink",void 0),(0,C.Z)((0,be.Z)(o),"baseLayersList",void 0),(0,C.Z)((0,be.Z)(o),"separator",void 0),(0,C.Z)((0,be.Z)(o),"overlaysList",void 0),(0,C.Z)((0,be.Z)(o),"form",void 0),o.layerControlInputs=[],o.layers=[],o.lastZIndex=0,o.handlingClick=!1,o.initLayers(),as(["checkDisabledLayers","onLayerChange","collapse","extend","expand","onInputClick"],(0,be.Z)(o)),o}return(0,qt.Z)(r,[{key:"getDefault",value:function(){return{collapsed:!0,position:Yh.TOPRIGHT,autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,name:"layers"}}},{key:"onAdd",value:function(){var o=this;return this.initLayout(),this.update(),this.mapsService.on("zoomend",this.checkDisabledLayers),this.layers.forEach(function(u){u.layer.on("remove",o.onLayerChange),u.layer.on("add",o.onLayerChange)}),this.container}},{key:"addVisualLayer",value:function(o,u){return this.addLayer(o,u,!0),this.mapsService?this.update():this}},{key:"expand",value:function(){var o=this.renderService.getViewportSize(),u=o.height;Dl(this.container,"l7-control-layers-expanded"),this.form.style.height="null";var d=u-(this.container.offsetTop+50);return d<this.form.clientHeight?(Dl(this.form,"l7-control-layers-scrollbar"),this.form.style.height=d+"px"):Yu(this.form,"l7-control-layers-scrollbar"),this.checkDisabledLayers(),this}},{key:"collapse",value:function(){return Yu(this.container,"l7-control-layers-expanded"),this}},{key:"onRemove",value:function(){var o=this;!this.mapsService||(this.mapsService.off("click",this.collapse),this.layers.forEach(function(u){u.layer.off("remove",o.onLayerChange),u.layer.off("add",o.onLayerChange)}))}},{key:"initLayout",value:function(){var o="l7-control-layers",u=this.container=za("div",o),d=this.controlOption.collapsed;u.setAttribute("aria-haspopup","true");var _=this.form=za("form",o+"-list");d&&(this.mapsService.on("click",this.collapse),u.addEventListener("mouseenter",this.expand),u.addEventListener("mouseleave",this.collapse)),this.layersLink=za("a",o+"-toggle",u);var x=this.layersLink;x.title="Layers",d||this.expand(),this.baseLayersList=za("div",o+"-base",_),this.separator=za("div",o+"-separator",_),this.overlaysList=za("div",o+"-overlays",_),u.appendChild(_)}},{key:"initLayers",value:function(){var o=this,u=this.controlOption,d=u.baseLayers,_=d===void 0?{}:d,x=u.overlayers,E=x===void 0?{}:x;Object.keys(_).forEach(function(P,I){o.addLayer(_[P],P,!1)}),Object.keys(E).forEach(function(P,I){o.addLayer(E[P],P,!0)})}},{key:"update",value:function(){if(!this.container)return this;Fl(this.baseLayersList),Fl(this.overlaysList),this.layerControlInputs=[];var o,u,d,_,x=0;for(d=0;d<this.layers.length;d++)_=this.layers[d],this.addItem(_),u=u||_.overlay,o=o||!_.overlay,x+=_.overlay?0:1;return this.controlOption.hideSingleBase&&(o=o&&x>1,this.baseLayersList.style.display=o?"":"none"),this.separator.style.display=u&&o?"":"none",this}},{key:"checkDisabledLayers",value:function(){for(var o=this.layerControlInputs,u,d,_=this.mapsService.getZoom(),x=o.length-1;x>=0;x--)if(u=o[x],d=this.layerService.getLayer(u.layerId),d&&d.inited){var E=d.getMinZoom(),P=d.getMaxZoom();u.disabled=_<E||_>P}}},{key:"addLayer",value:function(o,u,d){this.mapsService&&(o.on("add",this.onLayerChange),o.on("remove",this.onLayerChange)),this.layers.push({layer:o,name:u,overlay:d});var _=this.controlOption,x=_.sortLayers,E=_.sortFunction,P=_.autoZIndex;x&&this.layers.sort(function(I,D){return E(I.layer,D.layer,I.name,D.name)}),P&&o.setZIndex&&(this.lastZIndex++,o.setZIndex(this.lastZIndex)),this.expandIfNotCollapsed()}},{key:"expandIfNotCollapsed",value:function(){return this.mapsService&&!this.controlOption.collapsed&&this.expand(),this}},{key:"onLayerChange",value:function(o){this.handlingClick||this.update();var u=this.layerService.getLayer(o.target.layerId),d=u!=null&&u.overlay?o.type==="add"?"overlayadd":"overlayremove":o.type==="add"?"baselayerchange":null;d&&this.emit(d,u)}},{key:"createRadioElement",value:function(o,u){var d='<input type="radio" class="l7-control-layers-selector" name="'+o+'"'+(u?' checked="checked"':"")+"/>",_=document.createElement("div");return _.innerHTML=d,_.firstChild}},{key:"addItem",value:function(o){var u=document.createElement("label"),d=this.layerService.getLayer(o.layer.id),_=d&&d.inited&&o.layer.isVisible(),x;o.overlay?(x=document.createElement("input"),x.type="checkbox",x.className="l7-control-layers-selector",x.defaultChecked=_):x=this.createRadioElement("l7-base-layers",_),this.layerControlInputs.push(x),x.layerId=o.layer.id,x.addEventListener("click",this.onInputClick);var E=document.createElement("span");E.innerHTML=" "+o.name;var P=document.createElement("div");u.appendChild(P),P.appendChild(x),P.appendChild(E);var I=o.overlay?this.overlaysList:this.baseLayersList;return I.appendChild(u),this.checkDisabledLayers(),u}},{key:"onInputClick",value:function(){var o=this.layerControlInputs,u,d,_=[],x=[];this.handlingClick=!0;for(var E=o.length-1;E>=0;E--)u=o[E],d=this.layerService.getLayer(u.layerId),u.checked?_.push(d):u.checked||x.push(d);x.forEach(function(P){P.hide()}),_.forEach(function(P){P.show()}),this.handlingClick=!1}}]),r}(Iv);function gb(e){var n=yb();return function(){var i=(0,zt.Z)(e),o;if(n){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,wn.Z)(this,o)}}function yb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var _b=function(e){(0,Yr.Z)(r,e);var n=gb(r);function r(){return(0,Ct.Z)(this,r),n.apply(this,arguments)}return(0,qt.Z)(r,[{key:"getDefault",value:function(){return{position:Yh.BOTTOMLEFT,name:"logo"}}},{key:"onAdd",value:function(){var o="l7-control-logo",u=za("div",o),d=za("a","l7-ctrl-logo");return d.target="_blank",d.rel="noopener nofollow",d.href="https://antv.alipay.com/l7",d.setAttribute("aria-label","AntV logo"),d.setAttribute("rel","noopener nofollow"),u.appendChild(d),u}},{key:"onRemove",value:function(){return null}}]),r}(Iv);function xb(e){var n=bb();return function(){var i=(0,zt.Z)(e),o;if(n){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,wn.Z)(this,o)}}function bb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var nP=function(e){(0,Yr.Z)(r,e);var n=xb(r);function r(i){var o;return(0,Ct.Z)(this,r),o=n.call(this,i),(0,C.Z)((0,be.Z)(o),"mScale",void 0),(0,C.Z)((0,be.Z)(o),"iScale",void 0),as(["update"],(0,be.Z)(o)),o}return(0,qt.Z)(r,[{key:"getDefault",value:function(){return{position:Yh.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,name:"scale"}}},{key:"onAdd",value:function(){var o="l7-control-scale",u=za("div",o);this.addScales(o+"-line",u);var d=this.controlOption.updateWhenIdle;return this.mapsService.on(d?"moveend":"mapmove",this.update),this.mapsService.on(d?"zoomend":"zoomchange",this.update),this.update(),u}},{key:"onRemove",value:function(){var o=this.controlOption.updateWhenIdle;this.mapsService.off(o?"zoomend":"zoomchange",this.update),this.mapsService.off(o?"moveend":"mapmove",this.update)}},{key:"update",value:function(){var o=this.mapsService,u=this.controlOption.maxWidth,d=o.getSize()[1]/2,_=o.containerToLngLat([0,d]),x=o.containerToLngLat([u,d]),E=xs([_.lng,_.lat],[x.lng,x.lat]);this.updateScales(E)}},{key:"updateScales",value:function(o){var u=this.controlOption,d=u.metric,_=u.imperial;d&&o&&this.updateMetric(o),_&&o&&this.updateImperial(o)}},{key:"updateMetric",value:function(o){var u=this.getRoundNum(o),d=u<1e3?u+" m":u/1e3+" km";this.updateScale(this.mScale,d,u/o)}},{key:"updateImperial",value:function(o){var u=o*3.2808399,d,_,x;u>5280?(d=u/5280,_=this.getRoundNum(d),this.updateScale(this.iScale,_+" mi",_/d)):(x=this.getRoundNum(u),this.updateScale(this.iScale,x+" ft",x/u))}},{key:"updateScale",value:function(o,u,d){var _=this.controlOption.maxWidth;o.style.width=Math.round(_*d)+"px",o.innerHTML=u}},{key:"getRoundNum",value:function(o){var u=Math.pow(10,(Math.floor(o)+"").length-1),d=o/u;return d=d>=10?10:d>=5?5:d>=3?3:d>=2?2:1,u*d}},{key:"addScales",value:function(o,u){var d=this.controlOption,_=d.metric,x=d.imperial;_&&(this.mScale=za("div",o,u)),x&&(this.iScale=za("div",o,u))}}]),r}(Iv);function Eb(e){var n=Sb();return function(){var i=(0,zt.Z)(e),o;if(n){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,wn.Z)(this,o)}}function Sb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var iP=function(e){(0,Yr.Z)(r,e);var n=Eb(r);function r(i){var o;return(0,Ct.Z)(this,r),o=n.call(this,i),(0,C.Z)((0,be.Z)(o),"disabled",void 0),(0,C.Z)((0,be.Z)(o),"zoomInButton",void 0),(0,C.Z)((0,be.Z)(o),"zoomOutButton",void 0),as(["updateDisabled","zoomIn","zoomOut"],(0,be.Z)(o)),o}return(0,qt.Z)(r,[{key:"getDefault",value:function(){return{position:Yh.TOPLEFT,zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"&#x2212;",zoomOutTitle:"Zoom out",name:"zoom"}}},{key:"onAdd",value:function(){var o="l7-control-zoom",u=za("div",o+" l7-bar");return this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,o+"-in",u,this.zoomIn),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,o+"-out",u,this.zoomOut),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),this.updateDisabled(),u}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"zoomIn",value:function(){!this.disabled&&this.mapsService.getZoom()<this.mapsService.getMaxZoom()&&this.mapsService.zoomIn()}},{key:"zoomOut",value:function(){!this.disabled&&this.mapsService.getZoom()>this.mapsService.getMinZoom()&&this.mapsService.zoomOut()}},{key:"createButton",value:function(o,u,d,_,x){var E=za("a",d,_);return E.innerHTML=o,E.title=u,E.href="javascript:void(0)",E.addEventListener("click",x),E}},{key:"updateDisabled",value:function(){var o=this.mapsService,u="l7-disabled";Yu(this.zoomInButton,u),Yu(this.zoomOutButton,u),(this.disabled||o.getZoom()<=o.getMinZoom())&&Dl(this.zoomOutButton,u),(this.disabled||o.getZoom()>=o.getMaxZoom())&&Dl(this.zoomInButton,u)}}]),r}(Iv);function U0(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function Z0(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?U0(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):U0(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function wb(e){var n=Cb();return function(){var i=(0,zt.Z)(e),o;if(n){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,wn.Z)(this,o)}}function Cb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var V0=function(e){(0,Yr.Z)(r,e);var n=wb(r);function r(i){var o;return(0,Ct.Z)(this,r),o=n.call(this),(0,C.Z)((0,be.Z)(o),"markerOption",void 0),(0,C.Z)((0,be.Z)(o),"defaultMarker",void 0),(0,C.Z)((0,be.Z)(o),"popup",void 0),(0,C.Z)((0,be.Z)(o),"mapsService",void 0),(0,C.Z)((0,be.Z)(o),"sceneSerive",void 0),(0,C.Z)((0,be.Z)(o),"lngLat",void 0),(0,C.Z)((0,be.Z)(o),"scene",void 0),(0,C.Z)((0,be.Z)(o),"added",!1),(0,C.Z)((0,be.Z)(o),"eventHandle",function(u){o.emit(u.type,{target:u,data:o.markerOption.extData,lngLat:o.lngLat})}),o.markerOption=Z0(Z0({},o.getDefault()),i),as(["update","onMove","onUp","addDragHandler","onMapClick"],(0,be.Z)(o)),o.init(),o}return(0,qt.Z)(r,[{key:"getDefault",value:function(){return{element:void 0,anchor:hc.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(o){this.scene=o,this.mapsService=o.get($t.IMapService),this.sceneSerive=o.get($t.ISceneService);var u=this.markerOption,d=u.element,_=u.draggable;return this.mapsService.getMarkerContainer().appendChild(d),this.registerMarkerEvent(d),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("mousedown",this.addDragHandler),this.mapsService.off("touchstart",this.addDragHandler),this.mapsService.off("mouseup",this.onUp),this.mapsService.off("touchend",this.onUp)),this.unRegisterMarkerEvent(),this.removeAllListeners();var o=this.markerOption.element;return o&&lc(o),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(o){return this.lngLat=o,Array.isArray(o)&&(this.lngLat={lng:o[0],lat:o[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(o){var u=this;if(!this.added)return this.once("added",function(){u.setElement(o)}),this;var d=this.markerOption.element;return d&&lc(d),this.markerOption.element=o,this.init(),this.mapsService.getMarkerContainer().appendChild(o),this.registerMarkerEvent(o),this.update(),this}},{key:"openPopup",value:function(){var o=this;if(!this.added)return this.once("added",function(){o.openPopup()}),this;var u=this.popup;return u?(u.isOpen()||u.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var o=this;this.added||this.once("added",function(){o.closePopup()});var u=this.popup;return u&&u.remove(),this}},{key:"setPopup",value:function(o){return this.popup=o,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var o=this.popup;if(o)o.isOpen()?o.remove():o.addTo(this.scene);else return this;return this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(o){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(o){this.markerOption.extData=o}},{key:"update",value:function(){if(!!this.mapsService){var o=this.markerOption,u=o.element,d=o.anchor;this.updatePosition(),ho(u,"".concat(Ru[d]))}}},{key:"onMapClick",value:function(o){var u=this.markerOption.element;this.popup&&u&&this.togglePopup()}},{key:"updatePosition",value:function(){if(!!this.mapsService){var o=this.markerOption,u=o.element,d=o.offsets,_=this.lngLat,x=_.lng,E=_.lat,P=this.mapsService.getBounds(),I=this.mapsService.lngLatToContainer([x,E]);if(u){u.style.display="block",u.style.whiteSpace="nowrap";var D=this.mapsService.getContainer(),Z=0,re=0;if(D&&(Z=D.scrollWidth,re=D.scrollHeight),Math.abs(P[0][0])>180||Math.abs(P[1][0])>180){if(I.x>Z){var oe=this.mapsService.lngLatToContainer([x-360,E]);I.x=oe.x}if(I.x<0){var de=this.mapsService.lngLatToContainer([x+360,E]);I.x=de.x}}(I.x>Z||I.x<0||I.y>re||I.y<0)&&(u.style.display="none"),u.style.left=I.x+d[0]+"px",u.style.top=I.y-d[1]+"px"}}}},{key:"init",value:function(){var o=this,u=this.markerOption.element,d=this.markerOption,_=d.color,x=d.anchor;if(!u){this.defaultMarker=!0,u=za("div"),this.markerOption.element=u;var E=document.createElementNS("http://www.w3.org/2000/svg","svg");E.setAttributeNS(null,"display","block"),E.setAttributeNS(null,"height","48px"),E.setAttributeNS(null,"width","48px"),E.setAttributeNS(null,"viewBox","0 0 1024 1024");var P=document.createElementNS("http://www.w3.org/2000/svg","path");P.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),P.setAttributeNS(null,"fill",_),E.appendChild(P),u.appendChild(E)}Dl(u,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach(function(I){var D,Z,re=((D=o.markerOption)===null||D===void 0?void 0:D.style)&&((Z=o.markerOption)===null||Z===void 0?void 0:Z.style[I]);u&&(u.style[I]=re)}),u.addEventListener("click",function(I){o.onMapClick(I)}),u.addEventListener("click",this.eventHandle),iu(u,x,"marker")}},{key:"registerMarkerEvent",value:function(o){o.addEventListener("mousemove",this.eventHandle),o.addEventListener("click",this.eventHandle),o.addEventListener("mousedown",this.eventHandle),o.addEventListener("mouseup",this.eventHandle),o.addEventListener("dblclick",this.eventHandle),o.addEventListener("contextmenu",this.eventHandle),o.addEventListener("mouseover",this.eventHandle),o.addEventListener("mouseout",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var o=this.getElement();o.removeEventListener("mousemove",this.eventHandle),o.removeEventListener("click",this.eventHandle),o.removeEventListener("mousedown",this.eventHandle),o.removeEventListener("mouseup",this.eventHandle),o.removeEventListener("dblclick",this.eventHandle),o.removeEventListener("contextmenu",this.eventHandle),o.removeEventListener("mouseover",this.eventHandle),o.removeEventListener("mouseout",this.eventHandle)}},{key:"addDragHandler",value:function(o){throw new Error("Method not implemented.")}},{key:"onUp",value:function(o){throw new Error("Method not implemented.")}}]),r}(ha.EventEmitter);function j0(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function G0(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?j0(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):j0(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function Tb(e){var n=Ab();return function(){var i=(0,zt.Z)(e),o;if(n){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,wn.Z)(this,o)}}function Ab(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var aP=function(e){(0,Yr.Z)(r,e);var n=Tb(r);function r(i){var o,u;return(0,Ct.Z)(this,r),u=n.call(this),(0,C.Z)((0,be.Z)(u),"markers",[]),(0,C.Z)((0,be.Z)(u),"markerLayerOption",void 0),(0,C.Z)((0,be.Z)(u),"clusterIndex",void 0),(0,C.Z)((0,be.Z)(u),"points",[]),(0,C.Z)((0,be.Z)(u),"clusterMarkers",[]),(0,C.Z)((0,be.Z)(u),"mapsService",void 0),(0,C.Z)((0,be.Z)(u),"scene",void 0),(0,C.Z)((0,be.Z)(u),"zoom",void 0),(0,C.Z)((0,be.Z)(u),"bbox",void 0),u.markerLayerOption=$n()(u.getDefault(),i),as(["update"],(0,be.Z)(u)),u.zoom=((o=u.markerLayerOption.clusterOption)===null||o===void 0?void 0:o.zoom)||-99,u}return(0,qt.Z)(r,[{key:"getDefault",value:function(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}},{key:"addTo",value:function(o){return this.scene=o,this.mapsService=o.get($t.IMapService),this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.addMarkers(),this}},{key:"addMarker",value:function(o){var u=this.markerLayerOption.cluster;u&&this.addPoint(o,this.markers.length),this.markers.push(o)}},{key:"removeMarker",value:function(o){this.markers.indexOf(o);var u=this.markers.indexOf(o);u>-1&&this.markers.splice(u,1)}},{key:"hide",value:function(){this.markers.map(function(o){o.getElement().style.opacity="0"})}},{key:"show",value:function(){this.markers.map(function(o){o.getElement().style.opacity="1"})}},{key:"getMarkers",value:function(){var o=this.markerLayerOption.cluster;return o?this.clusterMarkers:this.markers}},{key:"addMarkers",value:function(){var o=this;this.getMarkers().forEach(function(u){u.addTo(o.scene)})}},{key:"clear",value:function(){this.markers.forEach(function(o){o.remove()}),this.clusterMarkers.forEach(function(o){o.remove()}),this.mapsService.off("camerachange",this.update),this.markers=[],this.clusterMarkers=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners()}},{key:"addPoint",value:function(o,u){var d=o.getLnglat(),_=d.lng,x=d.lat,E={geometry:{type:"Point",coordinates:[_,x]},properties:G0(G0({},o.getExtData()),{},{marker_id:u})};this.points.push(E)}},{key:"initCluster",value:function(){if(!!this.markerLayerOption.cluster){var o=this.markerLayerOption.clusterOption,u=o.radius,d=o.minZoom,_=d===void 0?0:d,x=o.maxZoom;this.clusterIndex=new(Za())({radius:u,minZoom:_,maxZoom:x}),this.clusterIndex.load(this.points)}}},{key:"getClusterMarker",value:function(o,u){var d=this,_=o[0].concat(o[1]),x=this.clusterIndex.getClusters(_,u);this.clusterMarkers.forEach(function(E){E.remove()}),this.clusterMarkers=[],x.forEach(function(E){var P,I=d.markerLayerOption.clusterOption,D=I.field,Z=I.method;if(E.properties&&(P=E.properties)!==null&&P!==void 0&&P.cluster_id){var re,oe=d.getLeaves((re=E.properties)===null||re===void 0?void 0:re.cluster_id);if(E.properties.clusterData=oe,D&&Z){var de=oe==null?void 0:oe.map(function(Gt){var Xt=(0,C.Z)({},D,Gt.properties[D]);return Xt}),Fe=vl(de,D),it=hf(Z,Fe),vt="point_"+Z;E.properties[vt]=it.toFixed(2)}}var xt=d.clusterMarker(E);d.clusterMarkers.push(xt),xt.addTo(d.scene)})}},{key:"getLeaves",value:function(o){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Infinity,d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return o?this.clusterIndex.getLeaves(o,u,d):null}},{key:"clusterMarker",value:function(o){var u=this.markerLayerOption.clusterOption,d=u,_=d.element,x=_===void 0?this.generateElement.bind(this):_,E=new V0({element:x(o)}).setLnglat({lng:o.geometry.coordinates[0],lat:o.geometry.coordinates[1]});return E}},{key:"normalMarker",value:function(o){var u=o.properties.marker_id;return this.markers[u]}},{key:"update",value:function(){var o=this.mapsService.getZoom(),u=this.mapsService.getBounds();(!this.bbox||Math.abs(o-this.zoom)>=1||!bn(this.bbox,u))&&(this.bbox=Mn(u,.5),this.zoom=Math.floor(o),this.getClusterMarker(this.bbox,this.zoom))}},{key:"generateElement",value:function(o){var u=za("div","l7-marker-cluster"),d=za("div","",u),_=za("span","",d),x=this.markerLayerOption.clusterOption,E=x.field,P=x.method;o.properties.point_count=o.properties.point_count||1;var I=E&&P?o.properties["point_"+P]||o.properties[E]:o.properties.point_count;return _.textContent=I,u}}]),r}(ha.EventEmitter);function H0(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function W0(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?H0(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):H0(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function Mb(e){var n=Pb();return function(){var i=(0,zt.Z)(e),o;if(n){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,wn.Z)(this,o)}}function Pb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var X0=function(e){(0,Yr.Z)(r,e);var n=Mb(r);function r(i){var o;return(0,Ct.Z)(this,r),o=n.call(this),(0,C.Z)((0,be.Z)(o),"popupOption",void 0),(0,C.Z)((0,be.Z)(o),"mapsService",void 0),(0,C.Z)((0,be.Z)(o),"sceneSerive",void 0),(0,C.Z)((0,be.Z)(o),"lngLat",void 0),(0,C.Z)((0,be.Z)(o),"content",void 0),(0,C.Z)((0,be.Z)(o),"closeButton",void 0),(0,C.Z)((0,be.Z)(o),"timeoutInstance",void 0),(0,C.Z)((0,be.Z)(o),"container",void 0),(0,C.Z)((0,be.Z)(o),"tip",void 0),(0,C.Z)((0,be.Z)(o),"scene",void 0),o.popupOption=W0(W0({},o.getdefault()),i),as(["update","onClickClose","remove"],(0,be.Z)(o)),o}return(0,qt.Z)(r,[{key:"addTo",value:function(o){var u=this;return this.mapsService=o.get($t.IMapService),this.sceneSerive=o.get($t.ISceneService),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.scene=o,this.update(),this.popupOption.closeOnClick&&(this.timeoutInstance=setTimeout(function(){u.mapsService.on("click",u.onClickClose)},30)),this.emit("open"),this}},{key:"close",value:function(){this.remove()}},{key:"open",value:function(){this.addTo(this.scene)}},{key:"setHTML",value:function(o){var u=window.document.createDocumentFragment(),d=window.document.createElement("body"),_;for(d.innerHTML=o;_=d.firstChild,!!_;)u.appendChild(_);return this.setDOMContent(u)}},{key:"setLnglat",value:function(o){return this.lngLat=o,Array.isArray(o)&&(this.lngLat={lng:o[0],lat:o[1]}),this.mapsService&&(this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setText",value:function(o){return this.setDOMContent(window.document.createTextNode(o))}},{key:"setMaxWidth",value:function(o){return this.popupOption.maxWidth=o,this.update(),this}},{key:"setDOMContent",value:function(o){return this.createContent(),this.content.appendChild(o),this.update(),this}},{key:"remove",value:function(){return this.content&&this.removeDom(this.content),this.container&&(this.removeDom(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.off("click",this.onClickClose),delete this.mapsService),clearTimeout(this.timeoutInstance),this.emit("close"),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"createContent",value:function(){this.content&&lc(this.content),this.content=za("div","l7-popup-content",this.container),this.popupOption.closeButton&&(this.closeButton=za("button","l7-popup-close-button",this.content),this.popupOption.closeButtonOffsets&&(this.closeButton.style.right=this.popupOption.closeButtonOffsets[0]+"px",this.closeButton.style.top=this.popupOption.closeButtonOffsets[1]+"px"),this.closeButton.setAttribute("aria-label","Close popup"),this.closeButton.innerHTML="&#215;",this.closeButton.addEventListener("click",this.onClickClose))}},{key:"creatDom",value:function(o,u,d){var _=window.document.createElement(o);return u!==void 0&&(_.className=u),d&&d.appendChild(_),_}},{key:"removeDom",value:function(o){o.parentNode&&o.parentNode.removeChild(o)}},{key:"getdefault",value:function(){return{closeButton:!0,closeOnClick:!0,maxWidth:"240px",offsets:[0,0],anchor:hc.BOTTOM,className:"",stopPropagation:!0}}},{key:"onClickClose",value:function(o){o.stopPropagation&&o.stopPropagation(),this.remove()}},{key:"update",value:function(){var o=this,u=this.lngLat,d=this.popupOption,_=d.className,x=d.maxWidth,E=d.anchor;if(!(!this.mapsService||!u||!this.content)){var P=this.mapsService.getMarkerContainer();if(!this.container&&P){this.container=this.creatDom("div","l7-popup",P),this.tip=this.creatDom("div","l7-popup-tip",this.container),this.container.appendChild(this.content),_&&_.split(" ").forEach(function(D){return o.container.classList.add(D)});var I=this.popupOption.stopPropagation;I&&["mousemove","mousedown","mouseup","click","dblclick"].forEach(function(D){o.container.addEventListener(D,function(Z){Z.stopPropagation()})}),this.container.style.whiteSpace="nowrap"}x&&this.container.style.maxWidth!==x&&(this.container.style.maxWidth=x),this.updatePosition(),ho(this.container,"".concat(Ru[E])),iu(this.container,E,"popup")}}},{key:"updatePosition",value:function(){if(!!this.mapsService){var o=this.lngLat,u=o.lng,d=o.lat,_=this.popupOption.offsets,x=this.mapsService.lngLatToContainer([u,d]);this.container.style.left=x.x+_[0]+"px",this.container.style.top=x.y-_[1]+"px"}}}]),r}(ha.EventEmitter);function Ib(e,n){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",i=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||i)&&(n||(n=document),!!n)){var o=n.head||n.getElementsByTagName("head")[0];if(!o){o=n.createElement("head");var u=n.body||n.getElementsByTagName("body")[0];u?u.parentNode.insertBefore(o,u):n.documentElement.appendChild(o)}var d=n.createElement("style");return d.type="text/css",d.styleSheet?d.styleSheet.cssText=e:d.appendChild(n.createTextNode(e)),o.appendChild(d),d}}Ib(`.l7-marker-container {
  width: 100%;
  height: 100%;
  overflow: hidden;
  position: absolute;
}

.l7-marker {
  position: absolute !important;
  top: 0;
  left: 0;
  z-index: 5;
  cursor: pointer;
}

.l7-marker-cluster {
  background-clip: padding-box;
  border-radius: 20px;
  background-color: rgba(181, 226, 140, 0.6);
  width: 40px;
  height: 40px;
}
.l7-marker-cluster div {
  width: 30px;
  height: 30px;
  margin-left: 5px;
  margin-top: 5px;
  text-align: center;
  border-radius: 15px;
  font: 12px 'Helvetica Neue', Arial, Helvetica, sans-serif;
  background-color: rgba(110, 204, 57, 0.6);
}
.l7-marker-cluster span {
  line-height: 30px;
}

.l7-popup-anchor-bottom,
.l7-popup-anchor-bottom-left,
.l7-popup-anchor-bottom-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: reverse;
      -ms-flex-direction: column-reverse;
          flex-direction: column-reverse;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* layers control */

.l7-control-layers {
  -webkit-box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);
          box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);
  background: #fff;
  border-radius: 5px;
}
.l7-popup-anchor-top,
.l7-popup-anchor-top-left,
.l7-popup-anchor-top-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}

.l7-popup-anchor-left {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}

.l7-popup-anchor-right {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: reverse;
      -ms-flex-direction: row-reverse;
          flex-direction: row-reverse;
}
.l7-popup {
  position: absolute;
  top: 0;
  left: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  will-change: transform;
  pointer-events: none;
  z-index: 5;
}
.l7-popup-tip {
  width: 0;
  height: 0;
  border: 10px solid transparent;
  z-index: 1;
}
.l7-popup-anchor-top .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-top: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-top-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-top: none;
  border-left: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-top-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-top: none;
  border-right: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-bottom .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-bottom: none;
  border-top-color: #fff;
}

.l7-popup-anchor-bottom-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-bottom: none;
  border-left: none;
  border-top-color: #fff;
}

.l7-popup-anchor-bottom-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-bottom: none;
  border-right: none;
  border-top-color: #fff;
}

.l7-popup-anchor-left .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-left: none;
  border-right-color: #fff;
}

.l7-popup-anchor-right .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-right: none;
  border-left-color: #fff;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  padding: 0;
  font-size: 25px;
  line-height: 20px;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

.l7-popup-anchor-top-left .l7-popup-content {
  border-top-left-radius: 0;
}

.l7-popup-anchor-top-right .l7-popup-content {
  border-top-right-radius: 0;
}

.l7-popup-anchor-bottom-left .l7-popup-content {
  border-bottom-left-radius: 0;
}

.l7-popup-anchor-bottom-right .l7-popup-content {
  border-bottom-right-radius: 0;
}

.l7-popup-track-pointer {
  display: none;
}

.l7-popup-track-pointer * {
  pointer-events: none;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}

.l7-map:hover .l7-popup-track-pointer {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
}

.l7-map:active .l7-popup-track-pointer {
  display: none;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* general toolbar styles */

.l7-bar {
  -webkit-box-shadow: 0 1px 5px rgba(0, 0, 0, 0.65);
          box-shadow: 0 1px 5px rgba(0, 0, 0, 0.65);
  border-radius: 4px;
}
.l7-bar a,
.l7-bar a:hover {
  background-color: #fff;
  width: 30px;
  height: 30px;
  font-size: 20px;
  display: block;
  text-align: center;
  text-decoration: none;
  color: #8e9dab;
}
.l7-bar a,
.l7-control-layers-toggle {
  background-position: 50% 50%;
  background-repeat: no-repeat;
  display: block;
}
.l7-bar a:hover {
  background-color: #f4f4f4;
}
.l7-bar a:first-child {
  border-top-left-radius: 2px;
  border-top-right-radius: 2px;
}
.l7-bar a:last-child {
  border-bottom-left-radius: 2px;
  border-bottom-right-radius: 2px;
  border-bottom: none;
}
.l7-bar a.l7-disabled {
  cursor: default;
  background-color: #f4f4f4;
  color: #bbb;
}

/* control positioning */

.l7-control-container {
  font: 12px/1.5 'Helvetica Neue', Arial, Helvetica, sans-serif;
}
.l7-control-hide {
  display: none;
}
.l7-control {
  position: relative;
  z-index: 800;
  pointer-events: visiblePainted; /* IE 9-10 doesn't have auto */
  pointer-events: auto;
}
.l7-control {
  float: left;
  clear: both;
}
.l7-top,
.l7-bottom {
  position: absolute;
  z-index: 1000;
  pointer-events: none;
}
.l7-top {
  top: 0;
}
.l7-right {
  right: 0;
}
.l7-bottom {
  bottom: 0;
}
.l7-left {
  left: 0;
}
.l7-center {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
}
.l7-bottom.l7-center,
.l7-top.l7-center {
  width: 100%;
}
.l7-right.l7-center,
.l7-left.l7-center {
  height: 100%;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}

.l7-top.l7-center,
.l7-left.l7-center {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}

.l7-bottom.l7-center,
.l7-right.l7-center {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}

.l7-center .l7-control {
  margin-right: 10px;
  margin-bottom: 10px;
}

.l7-control {
  float: left;
  clear: both;
}
.l7-right .l7-control {
  float: right;
}
.l7-top .l7-control {
  margin-top: 10px;
}
.l7-bottom .l7-control {
  margin-bottom: 10px;
}
.l7-left .l7-control {
  margin-left: 10px;
}
.l7-right .l7-control {
  margin-right: 10px;
}

/* attribution and scale controls */

.l7-control-container .l7-control-attribution {
  background: #fff;
  background: rgba(255, 255, 255, 0.7);
  margin: 0;
}
.l7-control-attribution,
.l7-control-scale-line {
  padding: 0 5px;
  color: #333;
}
.l7-control-attribution a {
  text-decoration: none;
}
.l7-control-attribution a:hover {
  text-decoration: underline;
}
.l7-container .l7-control-attribution,
.l7-container .l7-control-scale {
  font-size: 11px;
  padding: 5px 5px 2px 5px;
  background: rgba(255, 255, 255, 0.7);
}
.l7-left .l7-control-scale {
  margin-left: 5px;
}
.l7-bottom .l7-control-scale {
  margin-bottom: 5px;
}
.l7-control-scale-line {
  border: 2px solid #000;
  border-top: none;
  color: #000;
  line-height: 1.1;
  padding: 2px 5px 1px;
  font-size: 11px;
  white-space: nowrap;
  overflow: hidden;
  -webkit-box-sizing: border-box;
          box-sizing: border-box;

  background: #fff;
}
.l7-control-scale-line:not(:first-child) {
  border-top: 2px solid #777;
  border-bottom: none;
  margin-top: -2px;
}
.l7-control-scale-line:not(:first-child):not(:last-child) {
  border-bottom: 2px solid #777;
}

.l7-touch .l7-control-attribution,
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  -webkit-box-shadow: none;
          box-shadow: none;
}
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  border: 2px solid rgba(0, 0, 0, 0.2);
  background-clip: padding-box;
}
/*logo */

.l7-ctrl-logo {
  background-size: 100% 100%;
  width: 89px;
  height: 16px;
  margin: 0 0 -3px -3px;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  background-repeat: no-repeat;
  cursor: pointer;
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALIAAAAgCAYAAAHBIxK2AAAABGdBTUEAALGPC/xhBQAAIJZJREFUeAHtfAl8Tkf3/9z7PNmDRFbZSawhQcRSaqva1xCqpataqrT2UkuUUiqlaKtafe1VS1pUiypB0dIgIkpKRPZIELI/2/zO98akN48nltL3838//84nNzNzzpkzc+eee+bMOXMfxijNaMJ7LOrGO/HdYfZ8fb12gD2JJINJdR8WNHVQnRtSn7hilpz0u2DMKaEcFhZmhdzLNbiPyNVlwPxcm4Qh93Fr0gO4Ol5hfqiz6Q14G+QzGpYzQ9nXrUl7X/fgbrXdG3skX7m26+bNW2fQqJ5XmCs6RQKd6EQwB0zgtKgsvCidGF+N8wV/SBLqSKnXzx2WKIHw1xNxq2xtrKsBXqgrbePt1rivJFmloa5OoD129NcVQwa9Phxwaflw3ifvHCus1YIVjW7fwEF66dIhdYO/XV7Qk+9HY/5F7RA+w0G5TdRxq7gw10FBPWwA+3r9jpkYGcoJ5/7YiFxMiYCjLspsekOeCiJ1AhJJNER+8rfTX/j4BNcUMNCLMmhF+wC3cE9RZmMd/0IQjeTtGdwJjURD5EajsRQN1EwEHjAkUVce2LLhnKf8xGId3ZhkX4uxmj7MMKqJz0ZmMr3MJNZBmphV8WDBOCCgo+2QiE7DF3005wvU75e8vMLs4+P3HwwN7do5MzOu2NcjpPHRX/csCqjt2wvtxEAy8xJ3o+7j3jjkcurpn2xtrT0EPiS0oQPKSOfi/ygqL9H/qNbls8EXuer4+65xUa149QnBvGYFgapAN21EZ+pnuH3rrrnKdNA/zCRmjoqGzu36RoL21q38BLAAjRgo6iir63g1QAOcOoU27DAgwKtpPzVMKU+qBWIuve3Jx0zw4j/eQ0CASeNnjUi5mrYH72ZxUfFV0emJ479/BvrM9KxDAgZZEjziTp1d8+pL415sEdJloIAhF7QCZmnQoCkuLkkXNPfkozU8b4wVb30P4i4ADNQ41P08mtSBogHc27Vx70CPEHeUgRNwgUOuTqBR8wwODraGSIkrKipKxqVuI300mntri1jz9OOs0IHeHUdvms2t0iG+vn5nxmnan5QeUff6GGWttpidSjvGbCSZJdAAGTMwtjWSH2G5XrOp3oEv9wuWxqdeUPchZkW8OGqcedmcdujgUcMOH/zltmgL2YW2Fu22fbMz6q2xM+IEvmvHiCGyRq7AK3QLe959+T6v46co0uVBisLk0/9SqIIhcnQiVBPqULJ4dPVd2ypLg6Dx8wxuhAGDHrCOHTtqUfZ2b6KsYYIOuUiXL1/dKW4SMJRxkbbpG9nv5ecVutlt+PSoNvw7VPg8V4X5wqf4YQVp9g+NDQZDITr2cm/8lNIGlbvp+edGD/946eqJqOKmoBJRhjyjrclk0qlZAqeumw8YOEwE6ILdgh0raN9pcHeWx9n3mViPh9IKnlmBVBWI4bfoePDAEcOGPz9WWUDBzMe1cUdft5CnUfb2DvFR8rsz2avrkOdmT18wJisz5zDaqthVWjwAtzRgtBF9VbSdVofXIPWmB2CCouYqUBUFH59QbwwEqg0XykAi96/VuCEetRrm59msEfA+nqEtAUeqNEt324JGJEsDxpMi26gnaCpUxqJk6bahkGFp3akrZO8IBurcVGponpGW+VOdQP++uIAznzE1/cBBvRRZTc+OP0miUBJ78OiyxNxE6uX+KSP3vDIZuEE/z9BgWZZtHHj1oxZbkS6uJFNqIn+SWSy1AubjFtLd171xoHrQooyFQJRB7+0eHBrk2cxNtBW5mgYwoYNFXg5r7CvoFXWxajQ3mjiTc84wVkB2kTWt5NYk3lZ02SCvzphDDVrNZOY2p3mdA0wrhQoGSm5ig6SRyTsqwSxUaMKk+t4tXJIy4/IsoP82yNu7pYusKwk2WdslZmScvGHOyNs1tJ5GNrjVaeT2W2xsLCnuv5J6woQq/QtbXoLCMJqYtbWj208pKbGK4aamgWJR19XlCvpFEdxn6SDOl0byAjXB/cp8rlM/PteZ83k1T92PTuAw0Ly8GychmosWLB/v7xFSW+AeJQ/0auyLiYFEBgQ0dYKdDRsJfFOvpe0V76fgCVrgkNQTao63hAONr2vjFtAFltoTTFLzB415Al7RFdNipHRviWlLbzCHhZ05HxfEy9e7T/zX8FV+XLk+96e8Tl0xOJZfOpjdKp4kzboZXgGrouDj1rTunHnTQl1caoZ/unLNlKnTx32sNxobR0ZGakQTDCY8tEtEkG+LfihDg+NC2ccjpBXoyMTqVaLjTaFLduxe219XqH+67HYGKU5D0pbN30X5+vl0a9m6mZOPTxvFUIayPRAbM1RpS1uztp0a/SD6e9hcYlKVqgi7QEg/DAyRsAUsKSlNLyvT56Bs8e2Ias4LZzfnfEowJyOOVocZDs9jt8YnMDvUZzblZ+jis1rwtqg/KMHgwEThCUOCUS64U/An6iiL9oIGcFjwqMOQQB0JdTyEXd/tfR/1rMzsWCrPBxwPCxJMfJMELVYq0KO+fNkXk6CHRV/qXPSLXA0XZejpqiRZ0IgcY7hzu+AS2TB3quInaNnU2vzSlNqcT/fhHSqAVJgawAunEXxCPU4W9MMlcRN0ryZMAl2XcOHm6YlnYgMAToIOuxks+YBBErGrAa0YtKDDDkeYAaBFErjSUl2uKOfm5v1GE9y1nOLe/4IO+b3YchfKw0wy3lZ6m2arxyr4KV4RURH54qtS/fGufEMZZ7Hja/Ko0ptsgYML0+kKGM+4wbTbmGQUtPfLMfBrWWc3gIZenX4aJmUp9OQdqunk4nv2QmzMus0rO730wtj0qu2DqnuQjCYbrOjYrINq5JuRe/CKQp3QtRMweivm0yur+FBQf9xk6WFQX99Tvw2GDO0390jssWXW1vKf6n4q7Dc1EOXledJwQxF7RV/EomQbptMXssJlNyT5YSe4dq1m/s907eik1WprNKjdur9sW/1AWt7535Ur6/zvN2/lpcds/37eM892mEgTXGHuHD1y4qLRYK0YvrJsMly5knKu0tg0csmObbvfC2/ZbETK9bOnW4TU7xtGEw0a2geZbKysz/Xu9txQvV6fX6VOrMTw/hVsdF8b/tbGgX1feqF1m7Bq5hda+/o+pVgXm9Ztmzk0ctTBlMyEi/fnaoZ9g3HH1xmv5GgwI/m3+oAZUOzkj4fx7rQBt7qdxnhJDiuj/YlBe9dG1pLNbF9D8c2dem2xVMA3NQhjBk6WMyVaelmZVaL0+vmcB/Tz/zVa+8lIPlWW2SLMQh559ZSNCE2sbCq/FBuLyrrbLJVHsYZMr/sdfpiKJOv1pOxtyISp0tQRtHXqhNWQZffSy5d/LBOwJ5H71mrcAnzSSA2Z84ObJPlCbiujSZubkRefZI5X61hL5pavbzMvY4kuTCuzm6nXE4+Ztwf/lBRmcW1zcSkwxsXF6bWmEnbQSPJsoqWMZumwUqYC7QCVi3Y6tMmnCZdYDItiJezj0v3MaLJmRmXX58w0zKJ3w3ww2IwE+fk7JSUll9b2Crl4NfPcJXOav1OH7fyfdSs6cS7zl18Y65GRd36Pmk/S+dwex0/tHTN54pxNJ0/I2tTsM5WccqDFQgn9rW4nyphg4J95ut9gZis7p6Ym3BI4L9eQ+sS/ntrbLXDIE8/fLKaHVP7goyN5whKyKKMHcsWboSasqsznORfSRYEaz3v29uZt4JiDxMC8QVJLjzntg+ow+dBe7BhRJ1MwQ/AVkRbwQbBj7OtTXgVu49qt79LDrW/OX4yrqjEJ/OIPVrwlfM2CB/rW6XQ3wd9SgjsM41SsC9pLt+H0AptK2fdRjFdYHHwdhY0QOsL1VZDimkIHfLLD8xThcmCF+p3SjOxc0WlV+Zervm2x68dN/QQ+MLC2DVSHqOOVw6ZFXDRgCXjUBQ1y7Py+3bO+HyQLO0bArGV2auRrkxRv1orPPgjXF6XVARxJz0vCPvz4vbkoT50899yTenvAD0ljLx0L8Gr2Et4C9XXnTkEiecNKv/xiU/q1nHNXlQmN2iYVlpWwL0qLmSR3ZNFgQCpCogXuLDMa45WrTH8AcCVpTL8Q7ChbVDhAgO6XmwwGj7AWoa9lZ+UcBt3ufZvn6Ar0bUSbP/+42cJQ7NhbNjj3ybpW2p0G3LtP966DUIYk0TbZDr4Kk9Ho7lXLw1+0g6qo6Wtz8+f9sfmARQzqPZNWiCCBJ/NLtrOz9SkoKPxDlmT1SiJIHiuH6oAeF5e1o9XRGjWqa6pXrxbcqlm3YY7Wtifu6WDeU1xHF59an1cDki9wm8nnU7h3AV0fergDNrsln0+BtKUoP0yizYJr/57DhuJ1wnY5/mziepTVr6e3R0hrsbPLyck7BrxIZO/eAi2uuwE4I3Aok5rIAtzPPbjtxQuXtgCOOtQTwkqrPvlqMmBd2vcfDGeSpfGCXrS7H96SujCnBy+oj6LComSoEoGvUA0A6EvZ8DLaO9nYsUOoSzNy57Oi4mJyBu2SpuRcj2rGvZievUsRgleBf5gk6cpabd62egFoaYtr6NFl8DaUoz96LzTAq0kDlNWppLhE2UTg9Tuf8MdG2sw4DRjQU9H7e3b/FE2vomLoU3nJjm92rYSEwoXZuX3EJvDZsWtdz/+sjGlqMJqCXx/90jzALlz4syQl5awi7aj/EwnxPfC1srJy7ti232Sb6jZHRT+VJvm909I3pjKWayxjYdODeLkO1hnC2OLC/mhQWsJO6UvInCtjHQWDB+XKK2tvF3Dq5JkvVR4t/tzwiHk6namuefunwruvEq9ft86RW4Ef9sqQcK2WXRkzYtKBgtsFGYCNHjHpt3enzd+cnpvwo8pHbKQd2Wg9M3qDhjz9tqd+O7tao2XZqP+TKf8Ga3vyzP630EdGRpY+OTnutuiv0iQDqDOxVgaaSDLpjqMuResukoXHpwTw7jT5XnQlfHBBOgPcgxIiEqu+jG4NuoYN63a4mHzio0vJvy7Blhcwa2srWW0NAFZVgh0uaTSKj0LQYFERZVmy+WP1Z2uno25vZyd/tX5FO5T79x72faoF+xm4J5m4geLOPl7PHPvl1CeyLF1T875nkpdckq7qdOwIqY4aEz35i+XEXCYJ30MXs7dnSghSzaSqMunN2n36dZsBfG7uzYt3r0vpaVm/AHbkxJ4xJYWpD80PbapK6bmnL8+dvURRJXsPbXu5W49OU6n/ItA/zEapKr4PA8fC7OVVS1EXgwe8sq9Nh4aJ6nYWdyrFmayLvQsrIwleF8n4Jk9ntlCvo00gZ6ujE6UHBujQAZw2ZY52Cv8fvj/wwahXJu6VGFdu2sh4rdTs+M6+fl7dSAI+kTS0yfkbCWEndbhJIzPdjRu3TgcGBijqbcHc6Km21iz+b7C22KTEaGxFi1slHDyLsrGgKHr5kvYCsW3btkpeynskGYSrmaQnvTufLubhyL6WDGwK0zH9ypvSKMHoQXmuoaztz0diJoHu9VfePp6el3BYeOGstVYJ0Ys/VSR81OjhPmQqKAvbg3hqZNOd9PTsZNAt/3Rhi+5dW/cmy6SzaGfv7HS817NDlUUWsFWfrU9LzkxMFfjHyadMe3MZ7HPzCwJjMnK/8JbNI6rib1GSQfxpoTT7TRs+mYzLSJJoWkTYsKqYWIIbTNzWuaZTA0iWOT4l+2zKxx99fpXCUKxXv+5hn6/akP7n5eRztbw9O5rToi7cnx5+0rWIvi/uSU4/M2BgZJ/ZAwb2KiO9HynaXLp0rIAkTZeff/tc7MFju2Qm0T7r8RPcnJa43MjL1+PtocUif8SrE2ZkpWWX0Tmbex4q5q/KNFLLO8mcHSTXRc7nRsmzSkILCOzWsJkAypLjBXE4U+mdtmSCGclC+AEbC8US0Wh+u5Jz7jraIWREYfRGuJG064n7AAvxCHHIMxorpLcac4q9lHesYjLRb06qrgtZMoVpuecqzCi0tZRg2wq4pXEiKCDwlnIRMMD9WFvrjGqrwhK9RRj5kp+bwLgS37NI8C/wgTOgSPLyV7ibxoa9Rp7kV8nrVo1E3qSjJSr/CuNlBUxHTswSZmLFkhWTtLSGUqSEjO7yXEN1DZW1FBuQrQllxzK5FVuTc5HtnnOIwlRf1X6Waa1GM24KoNGQT69SkpiGFtIyYwwrMK1jb1+9/U9bApV6/7fyxGYAwewzZ1IdiosNBvF2PzHmD8FIWfcoKPIV7ZZ7Q8rImmJGPWPpR0jqdMxEAs5IgEkWCUm6mf6YRITIOXIFUC6heCvIyguhPIR5s1PE9TYrMixlWkM9ZqRwC2jLkywKSm4tPc005KKeOxe+qb+oKhE9fAUOvLLi0ubYH6AVNpoaLU++lnWezs8/OLbw8D09GUp8HkB7wHCEEwVHjBkOxqvX7x906kgOzMvn89qZWLm7SbSXmXwnqLHLMdVmWKAq5eolSY2wtDyp8aIcFNSqekl+Uftjhy5IbduGV0tKulrCdMEGrcRupeYm/iLoLOXkMpJqe4fUN+hZHRM3keQ9Wip3IGiSEIupmLjooXwByeoUA2daCrSw4nx2Kucye86qhJUq7MUKSznt+SqSHcq0KAqY1okZxqySrlcQUIEvJ7e+RDocW2JdmR3T8K0UT2lOwk1viKQnh2oUuaIqrFt120ct4ySGwaALHDPuVb8ZM9+OxjlFOh95oGXzrsvpxk2e/jb7ERB6VL6PQw9hS79427lUqzOOGBGZj5i64IcPYUp1paHDXxzs+UH07NUCvnrVumlzZ334h0ajuZqWc+68gKtz+Bq//CSmq4kbrRL/PDbPyalGKPDJySm7n27V+wtJywozshMPqduYl4Ugw/oHDm455A8ryDjEhp3CkV+/HxEYGKC0/XDRyreXLVmVbKeyE8HTPOE0DNmONhS3Gu0f4NPTHP+gOj7JGRwx4icYzRU7kUlfSzMW9+PJJMTLS03MztqahXs1YuuK8tmAqFgp70FM74eXxpeHTvhkR3eKY2wic6K5YmRoWBE51UdI825tuV/7h8Uh1qQzFAf26vusy8zZE1eKdt6+Xl1ooovbt+795fVUXRuC03rzzyecisZBYwoCsvETRgbcupFfunrl1mwSHtIW7EpqduKF5My4VBIG9w3rt7L+g3qtggsRI3t91IvzNq7d/sKVK1drk8bOtaSZ16zc3pw0sdV332/sLYSYzofd7tdj+H/Aw1O2/S0DhX8wlWvFv7eI0jpJqs1gs33brv09ej6TT7wqFKulIbt7utalw5RKxJwO4+yCEGMDFdjILbFCkNFw6k7py0XP8qu0Fm8nl4UTcW1nY81ORHXjPaL2SZcFcxq2xNbUXsSstB0oiCbA5TkWCCMvYQbda9KotCuVkCbTQGYyNCFb3ESh72wmayOlRbePV6L5m5UAOh+sK8wNh4tzxaeLF99lY6KjunGuri7h0BZf/GfZBfhQfDyaNEnPSUgw70o5bm8yuZrDUcdSTXftYL4EaiT5tobZJqXknsq+p52e+wB28vT+cfQyPYtyxOA+nw/oPXwPyiKl5ibE+Xs06UJb9x/OJB4OdXd3aUMmkPX2XWsnNAvu8EGZJDWhZfi62izyouPDRh2v9cabr/iGt2o6UvCa9c7CqfQFo0Gy0ZyJyyg/uiZw/0SuNocelX9qbvwv8F5+suxzv6VLPo211J6EvRZWnCXL5jUb+sKAoaDBh5SYKzyT1JxzRzAvlQQZRNN+kn6Oepq3JXn8gar+JKZBRPQbffnSJ+qEpAgdCTjnt/UbGCt7jkq+lbZwVmQqGPlcaVJWhRBHPcXd6ciG29xDbOecNtIGCm3VkKJLnqiy0JfcbIvxxx7fOc7Gxkpx6G3ZEDNn1rsLEy5cOb6GIkIuPXt3eef5FwaO3LxpByNteTM9Pb7yGO7az7+fPTBR+Km2bIyZPWPa/Pi1m1b0b0FONnt7Oz/0g0Su6oLLSVd+GP/G9G9154uLtZL2lsnGPo6XFjyDB0wx33JCC/8NBoavKQKBogB8noskH89jxs5dOw78MC7h5/VkUjiSQD+1fvPKDi8+/+ZhX0/lawzl5bv70jZ1dHTQTJ0xfr5gv+/HQ4vXr/smC/GC9Ixz6QL+T+aPo5ExrvT0E/BwX7I0RoR9TSajFebgmWc7TgINjk6OG/POKVnLctKzE06SECtNK2+67nKLOipdIEEOp7jI73QKg+lKWE3aDB56N5wPuUvCpInpCazEEM7yS86wQloh7tBVXFLEbpa8REL8fjkdl2Y158NItDOp/XnZimXM/ZW3lJY+WSH2dwttRt5o+6+3r+6C4A/6Tkq6EjNp4uz44pIS05wZi94V4164ZNYSN1cXKyz54hyowFnK+0X0GJGccXpneKuwQRcvJB3YvXPfAgSX6CPVeBK2avUb1huy79COLecuHp1Dx5fgU+wCId70zapnhNdZaGPwb9mq2SgBRx45uK87p1Xgjh3NjrV0FmHm92YtnirGggfYp09XV5PRFIBNIeDGohstke/9edtrCNmifC0l/YdXXxz3Cxy76dfPVz4DC4L/sYQvkhFh+HT1h62EEP+45+dFEGJ8xp6enXhSfUsWBRkEM45KubIDe5qE+DsE9XSlNM2lbMv0YP4OxaJIzsm+ePd6DivMb8vu6GKYviyJFRq7Se/d+hq4KMa104PZLBLgDXRiRkPhbU5h7s03PNgx4J9UCvBsGqDnBh/YoO07PDUefEtLyzK7tI9Yh80dQtTr1m7JPHL4+HLg6GxB9f2Hy0M1CNtg5wx4VUnWaO1bNn12YJBfizf69hr+5Zujpqx5PnLUp43rtZvVtFHHCBFAdHFxDlu28v1w8JEljf6FIaN/FseJ8DGe4I9wvYAj37Z113XZVnsaZxUyM8+nkYJJw5Gjn386/JFos3Tl+3NQ1nMpDB/aGbmpxkfL329Wu46fcqiD7je7U9u+n0M72jr5nhDt/ldzH7fgIJOJ+0+aNjaw34AeihI6ezph7YiX3zpGk3sjI/fsWfN7q1KQQUibvNIF51kECfMysmuNlFPUjy2sHchWvhzAyXNM9aWshDTsQOmD0vrShwWKkI704vZFddkXRDuXhJgsELKYS9n7CxKkF1b8KNFr8WQS3Gw6g74JztRNeefNDwXXyeNnzSIBI88gl40GpkRyhg4aeeD69RvKQ8aSHbNrfS+Exvy8yn9OQ7Q1z2kCd+D8BDZnGdcTTqTmJCTjRKgky3nQntezc0+JNl7etRT7WqM1XcOuX9ZoKnlvBB1yrdb6CmhwqU2cjNzEs/A2vPj82Nj0tMz9oLWzt/Pfd3DbYNjntJmr06x5Ywf6ZEIRbuBHvz5lWplOp7jrnvRxZPD/byZ8IE0u3IZ16wbaTpw8Zgn6pjBiQq9uQ2Po6/SyjJwEiy/qfQW5/AYkvviyNIEEcgIFqstweou07GgXA4sZ6cxrlNP89X9MDe7sILM9JK4v60CrYyUlejZy0Z/SrL+oHr8EB7w4q7hr78ZZcLMJritXL16jXr5FGZsoQdOqTfNRM2ZNrGvU81pVfXUGWnoZlN2seqOl8PgH/dFWtm4noF07te33KX0GmIv+GjdpOIzs4SCUN2xZ9Q5lyrPbuuW7uT/tPXjLykq6bMmzAfr/pVQs3WmG8W785rMRlCkr//w50eWrKWPx9zyHuzenvZs/MItOl1a85cGvajjbpJNYdYpd97C3YkfH2fGeK0qkdDCg3x4JoI3fXknH6hMNRnFLx9igZTnSwQd28IgExw9fpO9PTVbQVOR6CkFzslvP0pI/+36scLwRp+9A88a4Vxbt2bV3WHz8hUb0uzm3yn9i4H6tVbgHmCQqykcuptBX2/6uYXFk37d4+413pn62Jvo/YPLm+Nfmt+/QZouzs5PiL066dHnrhHEz4xB8QLDnkTv6hxuQtyWAPESKXV9VV5JReyM193QWBNTXlT4Y4boaeGF9fL26og3cbF9vjsmRtdqcq9nxVX6R9NCCDKYf50jfv+3EO5gYHYbjzItATZg1OzVG5t3IFrWmjeGPpL9cCQ8HXYpGw3rQB38XUX2SCd8ilOmMrouXzAmBpgJvsnUNg/u/shBlnMC2dD7Wzy24HTaAzVuFxtSrFxhBk6fd+u1X8+rXaT2Jlcmt6ZzVHQMYPKEk0SecYEVnd/WCpZNzjZoKjII28FrgvK9tDftjly//dkfQIL+WF5dF9nDyrl37WLeYZ+b3j+g5kzaX9s2aN3kV+OLC4iud2vXfiMMqdYJdfk2NBfT/jfTc0P49unXrVKXQiVEWFhUXvT12xgHaK+jpxf3doNH7IUjWf0DPZwXNvh8OHkFZMsiKshRw8/yRBBmNl+VLZ0fb8ZayzH4krdyEnpQnudbiKRxMAbry9Y5gJwnfOzpfUpZF804fp46dOwlxvY5dnnZ64aVIRbOC39ovN8/GAW9ZsrpoSYhBU82dnczPkbpiI5iUcrK1ra2Nl2M1x7oHf/lueOd2/TeYmEnxAID2iSSDdQbZVp6ff7J214IPZ3YnnnLdunUiyNSJuMvfSC/fi8eOnepAp6EOnss5Rydc/kp0EDORfuXOZeyoqSeDmzSIQVtg8Q3K4IGvzkSZW9vd87sdgP+3Ejw05n3hFxroMgffU6f7KBs4uM8fy5euTjFKRkf6ks4FRJ61PJojL7hTePH99z5Kwsuael3R2gBbTPcMwiKVBeBkxh0KtGw7mQ/dhbeUynihvrU2sKEr2JPb1Km7h238a+ylp4zc6IRNXsdObV3JTswqKCw0kUeCNmLxiWp68zLOBpTeLm5LGydt377dXJycnazhewUd/K/YLZPmk8aOf80/LSW96Ntvf8jFRGodXA5iyRf88Es5xQZda0GbkZZVtGP77ntocaKXlRW3wQOv5ugot+vUyqluUGB18CGT5hZ+jwuOfRx0FbzVOcLQaz7Z0Q6eCsDRHzayiodCI58URwXVbR6l/Lghavw6hYGZsDr/rYSNLSKQcfS7AwiOSGWF4eJewRAmRVAD59MPOjPytwUZncAN5yyzhVacDSFlbDJIbO1qkzQXuP9Gql+/bTXj7WLbUq1t4V3H+kN3q5zWOnq5Jn05Jdm6GvMTExPJnC9PCDgYC2/X1Mp6o38j1xv3m0Q1LT5wu985DghlzGcxdqUaKzvSRpLJXtaFhdUpND8mLsZhKQcPuhSTxRL+UWFCkM3bPexZC/N2/9b/nYF/Z+AxZuD/AA8zEhkTLyOGAAAAAElFTkSuQmCC');
}

/* layers control */

.l7-control-layers {
  -webkit-box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);
          box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);
  background: #fff;
  border-radius: 2px;
}
.l7-control-layers-toggle {
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAkCAYAAAGf7Ah0AAAABGdBTUEAALGPC/xhBQAABzdJREFUWAnVV3lslEUUn/l2F0tpwdAih1HEqCReDcphNCo1EkgFkXa5PNpuC0Fo2e7Wgko8KiaKWrvbK5672xYFpNtiRRuNiY0aURA14BGviBcVlaKltVa6+42/N9v5Mrtt05rwj/PHzjt+8743b+a9N8vYwKgMNlUQyemnMtAkaJajvb3dToQSGp8e6boopkr4VYgEMYwO0vhCTfMVzBcMf8bx086YyODcuM80zTqp9IWat+7evW8sMdIxIqqCLa6oiAaJpuEtcBqcc2HEWMZ0JclgZR/Nchf++ubrzKjJSguXS4tVjXvPjfb3/UAAacGTn/MOMb7QnjNpNqP/bKZ50Ai0tqYmCi0n4zbM+W+lBc7JBOa+QPhDwcTsxJXE2+32edKCL9h8hRDmRzpIOWydAylhrcMfDN+ugBRKSdP3KwPhsFJIPth02FISIYQwYsDYcVfWhy/Bon4JgumffMGmiGTwQ0B/sHml4q2ZFAD3WQIQVhx0IdFw8B189lolN+w8w5PnjPmlhJgtA8/vfn3iye7u3yGzDljDxZEG4097Cp3rSSjBtMHunp6vFR+HHoIxmbgTe1xHKssDHecLNFUjMzbqMs5ZlHF7ute17M84+TMHDzr+OvR9JwKdCms9yRkzJq6bPTsWXh05QOPUN+PUHyPWMPhm6UHd7vaUohWZPSRE8OqxpTyibQa/qcTlbEP0vwF7AWUAT3JM9dy69FfSNza+MU4awNE8iQtXSkJuGLleV852ov2h5jkwVof0mUs8aO4LhTuYYFOAjExId0wcFIPahpaLTkWiX9ECfHG/sLNi1i8+HODfgLFFRI96+INNi0cNTgTS1obKQh03aAuk9DeELzcj4pACYivvwvXrFK/PcQZiQWo+hmidpYMUjQC7EOB6xdNsGfAHwk/RDdOVw9Dm+NTUSWtWLDohDVQ37JkbiUT2DwMeVswZP+gtdM4x3HnLDhjcGM2XLWOISaenIGee9MCSgqgMht/H/q/SZYk0qviV3oKcj5XcioESyOoqIseFYDYloxnAGm/hcrcuk3JV2XBMl+pKqn6mENux11+w12m6jpqMMFn7rPPTHdwfCm8yTfG4tMaNu+GepPUFiqbM7T105ARSPQU+dY/LOC/N2gI65WEkyWUEtjmSppfkLvlRLaQ5VnZFDtGGzbheNRROKZmbu/AvUvh3tE4Wff2/0IUC+y2q+4VVoXBW1BSvkR7Rb8BW84lWJQBdlGozcs7GLy3Nd35OSqTxBqtfgkc1+sPjcqbDgEl6xK0dH5lv545LOCVL1/F+3CoY4eyY1+WcBiC2KYEHQBd5XDkyndE17xCm2Ug6BLcSwb3LigE1AlOYu6TS4HUwVEw0Df1osfBnLDwnpiFDCQPuvQ73Fkqxg8/hEVYLXt66MXbbzOK8bKre1hhkgDT0RDja3fEHytwZxCMLH0YWPkD0fxqjqUZDejDSV3z1LbexqPkEPJxKWLqtKOGbvPnZL460NlE/KgfkIZiRrfjShsQcG2QQDUwwXjcuZcID61Ys6ErUJ/LDOiCfLUzUjVQdEg0O4jn/ABEq0iuIjrEcwE0x/KGWNbjPj4BO00Gni0ZOoIPzLR5X9vMqqaQDqDzzENra4V5zp8sBZQcROYjsLvYUOPdbEVBKeiZ193QjCmwtZCM+ldS6EWYTH3wuNSV1i+pFCj/IAaWgGUfBq0N78qPM3DZcp9TxcTQeyzZm3ON2LatXpSlOP8BIB6qDLddHmHnFrBlpNZmZmdZbNXEB9XsRlZXFennqGHzoXW5DaId4iSoc/Q365EjnRjszPnYXZL9NDWUtGsqzCjAw7xprTypbn7fkaILcYqkInzzeX06C8emO8sKlS7stZQLxVMPes/+O9FVAvEpXob+utY6gZmfrtMjf/RUI+2odhF7wJbq+Gzf3zTj5CAwyaoEwozVoCzN1KKK00z7WUbZx9dIOklsO6CAZpu87i5gpHoJ8gtLh9vZixSO2KckV7qysf5Sc5uq2tjOix3rL0FW3IJuSNV0XM/iDs85LqxvqeKUD8n3LxUobt5WVuLJlS9IM4O9i09VRwWtxLWfpcix+hXjs8mZdjn19YuOiuKRgufzXqOuqQi2r8O+yAk/tl2Q/RMW7ETe8UdX1GJhHDM5qjDHJ5e7bs07qBp7ZsTe9t6/vUXykkLKEdLFbLgLJSUn3rrt1yXEdX/1C23jzVG+5Keg/B5r2wJD9g/NcaUAJq4MvXxxl/TWoATcoGc0Av4eUKnIXZlsvXpLHO0CS2KgOtGQgdeuwqWuUjGbUgrdszLHRXXDLF0oe54AS0kyPnc5Iz/2CmV7EeIzSwcjvsHQPXkUhld/kCP6Xu+DRNjg/SWHh+SnODF+aPeVh9XCydAPEsA4kAqsCzcuiTPiw7+maTj6SwGsVk/9gY9xbUpizR8MNS47aAd0C7s35CG8VdrxYyjl/FcdUgo73nY77X9D/Au9RDMh+aBoVAAAAAElFTkSuQmCC');
  width: 30px;
  height: 30px;
  background-size: 20px 20px;
}

.l7-touch .l7-control-layers-toggle {
  width: 44px;
  height: 44px;
}
.l7-control-layers .l7-control-layers-list,
.l7-control-layers-expanded .l7-control-layers-toggle {
  display: none;
}
.l7-control-layers-expanded .l7-control-layers-list {
  display: block;
  position: relative;
}
.l7-control-layers-expanded {
  padding: 6px 10px 6px 6px;
  color: #59626b;
  background: #fff;
}
.l7-control-layers-scrollbar {
  overflow-y: scroll;
  overflow-x: hidden;
  padding-right: 5px;
}
.l7-control-layers-selector {
  margin-top: 2px;
  position: relative;
  top: 1px;
}
.l7-control-layers label {
  display: block;
  padding: 8px;
}
.l7-control-layers label input[type='radio'],
.l7-control-layers label input[type='checkbox'] {
  width: 14px;
  height: 14px;
  margin: 0;
}
.l7-control-layers-separator {
  height: 0;
  border-top: 1px solid #d8d8d8;
  margin: 5px -10px 5px -6px;
}
.mapboxgl-ctrl-logo {
  display: none !important;
}
.amap-logo {
  display: none !important;
}
`);var Ob=L(88307),Rb=L.n(Ob),Lb=function(){function e(n,r){(0,Ct.Z)(this,e),(0,C.Z)(this,"attribute",void 0),(0,C.Z)(this,"buffer",void 0);var i=r.buffer,o=r.offset,u=r.stride,d=r.normalized,_=r.size,x=r.divisor;this.buffer=i,this.attribute={buffer:i.get(),offset:o||0,stride:u||0,normalized:d||!1,divisor:x||0},_&&(this.attribute.size=_)}return(0,qt.Z)(e,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(r){this.buffer.subData(r)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),dh,Qd,vh,Cc,ev,qh,tv,Ov,Lf,Ap,xu,kf,Df,Rv,kb=(dh={},(0,C.Z)(dh,m.POINTS,"points"),(0,C.Z)(dh,m.LINES,"lines"),(0,C.Z)(dh,m.LINE_LOOP,"line loop"),(0,C.Z)(dh,m.LINE_STRIP,"line strip"),(0,C.Z)(dh,m.TRIANGLES,"triangles"),(0,C.Z)(dh,m.TRIANGLE_FAN,"triangle fan"),(0,C.Z)(dh,m.TRIANGLE_STRIP,"triangle strip"),dh),Y0=(Qd={},(0,C.Z)(Qd,m.STATIC_DRAW,"static"),(0,C.Z)(Qd,m.DYNAMIC_DRAW,"dynamic"),(0,C.Z)(Qd,m.STREAM_DRAW,"stream"),Qd),Tm=(vh={},(0,C.Z)(vh,m.BYTE,"int8"),(0,C.Z)(vh,m.UNSIGNED_INT,"int16"),(0,C.Z)(vh,m.INT,"int32"),(0,C.Z)(vh,m.UNSIGNED_BYTE,"uint8"),(0,C.Z)(vh,m.UNSIGNED_SHORT,"uint16"),(0,C.Z)(vh,m.UNSIGNED_INT,"uint32"),(0,C.Z)(vh,m.FLOAT,"float"),vh),Db=(Cc={},(0,C.Z)(Cc,m.ALPHA,"alpha"),(0,C.Z)(Cc,m.LUMINANCE,"luminance"),(0,C.Z)(Cc,m.LUMINANCE_ALPHA,"luminance alpha"),(0,C.Z)(Cc,m.RGB,"rgb"),(0,C.Z)(Cc,m.RGBA,"rgba"),(0,C.Z)(Cc,m.RGBA4,"rgba4"),(0,C.Z)(Cc,m.RGB5_A1,"rgb5 a1"),(0,C.Z)(Cc,m.RGB565,"rgb565"),(0,C.Z)(Cc,m.DEPTH_COMPONENT,"depth"),(0,C.Z)(Cc,m.DEPTH_STENCIL,"depth stencil"),Cc),Fb=(ev={},(0,C.Z)(ev,m.DONT_CARE,"dont care"),(0,C.Z)(ev,m.NICEST,"nice"),(0,C.Z)(ev,m.FASTEST,"fast"),ev),q0=(qh={},(0,C.Z)(qh,m.NEAREST,"nearest"),(0,C.Z)(qh,m.LINEAR,"linear"),(0,C.Z)(qh,m.LINEAR_MIPMAP_LINEAR,"mipmap"),(0,C.Z)(qh,m.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),(0,C.Z)(qh,m.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),(0,C.Z)(qh,m.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),qh),K0=(tv={},(0,C.Z)(tv,m.REPEAT,"repeat"),(0,C.Z)(tv,m.CLAMP_TO_EDGE,"clamp"),(0,C.Z)(tv,m.MIRRORED_REPEAT,"mirror"),tv),Nb=(Ov={},(0,C.Z)(Ov,m.NONE,"none"),(0,C.Z)(Ov,m.BROWSER_DEFAULT_WEBGL,"browser"),Ov),Bb=(Lf={},(0,C.Z)(Lf,m.NEVER,"never"),(0,C.Z)(Lf,m.ALWAYS,"always"),(0,C.Z)(Lf,m.LESS,"less"),(0,C.Z)(Lf,m.LEQUAL,"lequal"),(0,C.Z)(Lf,m.GREATER,"greater"),(0,C.Z)(Lf,m.GEQUAL,"gequal"),(0,C.Z)(Lf,m.EQUAL,"equal"),(0,C.Z)(Lf,m.NOTEQUAL,"notequal"),Lf),$0=(Ap={},(0,C.Z)(Ap,m.FUNC_ADD,"add"),(0,C.Z)(Ap,m.MIN_EXT,"min"),(0,C.Z)(Ap,m.MAX_EXT,"max"),(0,C.Z)(Ap,m.FUNC_SUBTRACT,"subtract"),(0,C.Z)(Ap,m.FUNC_REVERSE_SUBTRACT,"reverse subtract"),Ap),Lv=(xu={},(0,C.Z)(xu,m.ZERO,"zero"),(0,C.Z)(xu,m.ONE,"one"),(0,C.Z)(xu,m.SRC_COLOR,"src color"),(0,C.Z)(xu,m.ONE_MINUS_SRC_COLOR,"one minus src color"),(0,C.Z)(xu,m.SRC_ALPHA,"src alpha"),(0,C.Z)(xu,m.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),(0,C.Z)(xu,m.DST_COLOR,"dst color"),(0,C.Z)(xu,m.ONE_MINUS_DST_COLOR,"one minus dst color"),(0,C.Z)(xu,m.DST_ALPHA,"dst alpha"),(0,C.Z)(xu,m.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),(0,C.Z)(xu,m.CONSTANT_COLOR,"constant color"),(0,C.Z)(xu,m.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),(0,C.Z)(xu,m.CONSTANT_ALPHA,"constant alpha"),(0,C.Z)(xu,m.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),(0,C.Z)(xu,m.SRC_ALPHA_SATURATE,"src alpha saturate"),xu),zb=(kf={},(0,C.Z)(kf,m.NEVER,"never"),(0,C.Z)(kf,m.ALWAYS,"always"),(0,C.Z)(kf,m.LESS,"less"),(0,C.Z)(kf,m.LEQUAL,"lequal"),(0,C.Z)(kf,m.GREATER,"greater"),(0,C.Z)(kf,m.GEQUAL,"gequal"),(0,C.Z)(kf,m.EQUAL,"equal"),(0,C.Z)(kf,m.NOTEQUAL,"notequal"),kf),ud=(Df={},(0,C.Z)(Df,m.ZERO,"zero"),(0,C.Z)(Df,m.KEEP,"keep"),(0,C.Z)(Df,m.REPLACE,"replace"),(0,C.Z)(Df,m.INVERT,"invert"),(0,C.Z)(Df,m.INCR,"increment"),(0,C.Z)(Df,m.DECR,"decrement"),(0,C.Z)(Df,m.INCR_WRAP,"increment wrap"),(0,C.Z)(Df,m.DECR_WRAP,"decrement wrap"),Df),Ub=(Rv={},(0,C.Z)(Rv,m.FRONT,"front"),(0,C.Z)(Rv,m.BACK,"back"),Rv),Zb=function(){function e(n,r){(0,Ct.Z)(this,e),(0,C.Z)(this,"buffer",void 0);var i=r.data,o=r.usage,u=r.type;this.buffer=n.buffer({data:i,usage:Y0[o||m.STATIC_DRAW],type:Tm[u||m.UNSIGNED_BYTE]})}return(0,qt.Z)(e,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.buffer.destroy()}},{key:"subData",value:function(r){var i=r.data,o=r.offset;this.buffer.subdata(i,o)}}]),e}(),Vb=function(){function e(n,r){(0,Ct.Z)(this,e),(0,C.Z)(this,"elements",void 0);var i=r.data,o=r.usage,u=r.type,d=r.count;this.elements=n.elements({data:i,usage:Y0[o||m.STATIC_DRAW],type:Tm[u||m.UNSIGNED_BYTE],count:d})}return(0,qt.Z)(e,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(r){var i=r.data;this.elements.subdata(i)}},{key:"destroy",value:function(){}}]),e}(),jb=function(){function e(n,r){(0,Ct.Z)(this,e),(0,C.Z)(this,"framebuffer",void 0);var i=r.width,o=r.height,u=r.color,d=r.colors,_=r.depth,x=r.stencil,E={width:i,height:o};Array.isArray(d)&&(E.colors=d.map(function(P){return P.get()})),u&&typeof u!="boolean"&&(E.color=u.get()),this.framebuffer=n.framebuffer(E)}return(0,qt.Z)(e,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(r){var i=r.width,o=r.height;this.framebuffer.resize(i,o)}}]),e}(),Gb=L(36719),Hb=L.n(Gb),Wb=L(68630),Xb=L.n(Wb);function J0(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function ld(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?J0(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):J0(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var Yb=function(){function e(n,r){(0,Ct.Z)(this,e),(0,C.Z)(this,"reGl",void 0),(0,C.Z)(this,"destroyed",!1),(0,C.Z)(this,"drawCommand",void 0),(0,C.Z)(this,"drawPickCommand",void 0),(0,C.Z)(this,"drawParams",void 0),(0,C.Z)(this,"options",void 0),(0,C.Z)(this,"uniforms",{}),this.reGl=n;var i=r.vs,o=r.fs,u=r.attributes,d=r.uniforms,_=r.primitive,x=r.count,E=r.elements,P=r.depth,I=r.blend,D=r.stencil,Z=r.cull,re=r.instances,oe={};this.options=r,d&&(this.uniforms=this.extractUniforms(d),Object.keys(d).forEach(function(vt){oe[vt]=n.prop(vt)}));var de={};Object.keys(u).forEach(function(vt){de[vt]=u[vt].get()});var Fe={attributes:de,frag:o,uniforms:oe,vert:i,primitive:kb[_===void 0?m.TRIANGLES:_]};re&&(Fe.instances=re),x&&(Fe.count=x),E&&(Fe.elements=E.get()),this.initDepthDrawParams({depth:P},Fe),this.initBlendDrawParams({blend:I},Fe),this.initStencilDrawParams({stencil:D},Fe),this.initCullDrawParams({cull:Z},Fe),this.drawCommand=n(Fe);var it=pc()(Fe);it.blend.enable=!0,it.blend.func={dstAlpha:"one",dstRGB:"one minus src alpha",srcAlpha:"one",srcRGB:"src alpha"},this.drawPickCommand=n(it),this.drawParams=Fe}return(0,qt.Z)(e,[{key:"addUniforms",value:function(r){this.uniforms=ld(ld({},this.uniforms),this.extractUniforms(r))}},{key:"draw",value:function(r,i){if(!(this.drawParams.attributes&&Object.keys(this.drawParams.attributes).length===0)){var o=ld(ld({},this.uniforms),this.extractUniforms(r.uniforms||{})),u={};Object.keys(o).forEach(function(d){var _=(0,Xe.Z)(o[d]);_==="boolean"||_==="number"||Array.isArray(o[d])||o[d].BYTES_PER_ELEMENT?u[d]=o[d]:u[d]=o[d].get()}),i?this.drawPickCommand(u):this.drawCommand(u)}}},{key:"destroy",value:function(){this.drawParams.elements.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach(function(r){r.destroy()}),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(r,i){var o=r.depth;o&&(i.depth={enable:o.enable===void 0?!0:!!o.enable,mask:o.mask===void 0?!0:!!o.mask,func:Bb[o.func||m.LESS],range:o.range||[0,1]})}},{key:"initBlendDrawParams",value:function(r,i){var o=r.blend;if(o){var u=o.enable,d=o.func,_=o.equation,x=o.color,E=x===void 0?[0,0,0,0]:x;i.blend={enable:!!u,func:{srcRGB:Lv[d&&d.srcRGB||m.SRC_ALPHA],srcAlpha:Lv[d&&d.srcAlpha||m.SRC_ALPHA],dstRGB:Lv[d&&d.dstRGB||m.ONE_MINUS_SRC_ALPHA],dstAlpha:Lv[d&&d.dstAlpha||m.ONE_MINUS_SRC_ALPHA]},equation:{rgb:$0[_&&_.rgb||m.FUNC_ADD],alpha:$0[_&&_.alpha||m.FUNC_ADD]},color:E}}}},{key:"initStencilDrawParams",value:function(r,i){var o=r.stencil;if(o){var u=o.enable,d=o.mask,_=d===void 0?-1:d,x=o.func,E=x===void 0?{cmp:m.ALWAYS,ref:0,mask:-1}:x,P=o.opFront,I=P===void 0?{fail:m.KEEP,zfail:m.KEEP,zpass:m.KEEP}:P,D=o.opBack,Z=D===void 0?{fail:m.KEEP,zfail:m.KEEP,zpass:m.KEEP}:D;i.stencil={enable:!!u,mask:_,func:ld(ld({},E),{},{cmp:zb[E.cmp]}),opFront:{fail:ud[I.fail],zfail:ud[I.zfail],zpass:ud[I.zpass]},opBack:{fail:ud[Z.fail],zfail:ud[Z.zfail],zpass:ud[Z.zpass]}}}}},{key:"initCullDrawParams",value:function(r,i){var o=r.cull;if(o){var u=o.enable,d=o.face,_=d===void 0?m.BACK:d;i.cull={enable:!!u,face:Ub[_]}}}},{key:"extractUniforms",value:function(r){var i=this,o={};return Object.keys(r).forEach(function(u){i.extractUniformsRecursively(u,r[u],o,"")}),o}},{key:"extractUniformsRecursively",value:function(r,i,o,u){var d=this;if(i===null||typeof i=="number"||typeof i=="boolean"||Array.isArray(i)&&typeof i[0]=="number"||Hb()(i)||i===""||"resize"in i){o["".concat(u&&u+".").concat(r)]=i;return}Xb()(i)&&Object.keys(i).forEach(function(_){d.extractUniformsRecursively(_,i[_],o,"".concat(u&&u+".").concat(r))}),Array.isArray(i)&&i.forEach(function(_,x){Object.keys(_).forEach(function(E){d.extractUniformsRecursively(E,_[E],o,"".concat(u&&u+".").concat(r,"[").concat(x,"]"))})})}}]),e}(),qb=function(){function e(n,r){(0,Ct.Z)(this,e),(0,C.Z)(this,"texture",void 0),(0,C.Z)(this,"width",void 0),(0,C.Z)(this,"height",void 0),(0,C.Z)(this,"isDistroy",!1);var i=r.data,o=r.type,u=o===void 0?m.UNSIGNED_BYTE:o,d=r.width,_=r.height,x=r.flipY,E=x===void 0?!1:x,P=r.format,I=P===void 0?m.RGBA:P,D=r.mipmap,Z=D===void 0?!1:D,re=r.wrapS,oe=re===void 0?m.CLAMP_TO_EDGE:re,de=r.wrapT,Fe=de===void 0?m.CLAMP_TO_EDGE:de,it=r.aniso,vt=it===void 0?0:it,xt=r.alignment,Gt=xt===void 0?1:xt,Xt=r.premultiplyAlpha,nr=Xt===void 0?!1:Xt,mr=r.mag,en=mr===void 0?m.NEAREST:mr,hn=r.min,wr=hn===void 0?m.NEAREST:hn,Pn=r.colorSpace,jn=Pn===void 0?m.BROWSER_DEFAULT_WEBGL:Pn;this.width=d,this.height=_;var yi={width:d,height:_,type:Tm[u],format:Db[I],wrapS:K0[oe],wrapT:K0[Fe],mag:q0[en],min:q0[wr],alignment:Gt,flipY:E,colorSpace:Nb[jn],premultiplyAlpha:nr,aniso:vt};i&&(yi.data=i),typeof Z=="number"?yi.mipmap=Fb[Z]:typeof Z=="boolean"&&(yi.mipmap=Z),this.texture=n.texture(yi)}return(0,qt.Z)(e,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.texture(r)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(r){var i=r.width,o=r.height;this.texture.resize(i,o),this.width=i,this.height=o}},{key:"destroy",value:function(){this.isDistroy||this.texture.destroy(),this.isDistroy=!0}}]),e}(),Q0,eg,Kb=(Q0=(0,Fr.b2)(),Q0(eg=function(){function e(){var n=this;(0,Ct.Z)(this,e),(0,C.Z)(this,"extensionObject",void 0),(0,C.Z)(this,"gl",void 0),(0,C.Z)(this,"$container",void 0),(0,C.Z)(this,"canvas",void 0),(0,C.Z)(this,"width",void 0),(0,C.Z)(this,"height",void 0),(0,C.Z)(this,"isDirty",void 0),(0,C.Z)(this,"createModel",function(r){return new Yb(n.gl,r)}),(0,C.Z)(this,"createAttribute",function(r){return new Lb(n.gl,r)}),(0,C.Z)(this,"createBuffer",function(r){return new Zb(n.gl,r)}),(0,C.Z)(this,"createElements",function(r){return new Vb(n.gl,r)}),(0,C.Z)(this,"createTexture2D",function(r){return new qb(n.gl,r)}),(0,C.Z)(this,"createFramebuffer",function(r){return new jb(n.gl,r)}),(0,C.Z)(this,"useFramebuffer",function(r,i){n.gl({framebuffer:r?r.get():null})(i)}),(0,C.Z)(this,"clear",function(r){var i=r.color,o=r.depth,u=r.stencil,d=r.framebuffer,_=d===void 0?null:d,x={color:i,depth:o,stencil:u};x.framebuffer=_===null?_:_.get(),n.gl.clear(x)}),(0,C.Z)(this,"viewport",function(r){var i=r.x,o=r.y,u=r.width,d=r.height;n.gl._gl.viewport(i,o,u,d),n.width=u,n.height=d,n.gl._refresh()}),(0,C.Z)(this,"readPixels",function(r){var i=r.framebuffer,o=r.x,u=r.y,d=r.width,_=r.height,x={x:o,y:u,width:d,height:_};return i&&(x.framebuffer=i.get()),n.gl.read(x)}),(0,C.Z)(this,"getViewportSize",function(){return{width:n.gl._gl.drawingBufferWidth,height:n.gl._gl.drawingBufferHeight}}),(0,C.Z)(this,"getContainer",function(){if($i)return n.canvas;var r;return(r=n.canvas)===null||r===void 0?void 0:r.parentElement}),(0,C.Z)(this,"getCanvas",function(){return n.canvas}),(0,C.Z)(this,"getGLContext",function(){return n.gl._gl}),(0,C.Z)(this,"destroy",function(){n.gl.destroy()})}return(0,qt.Z)(e,[{key:"init",value:function(){var n=(0,nl.Z)(a().mark(function i(o,u){var d=this;return a().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return this.canvas=o,x.next=3,new Promise(function(E,P){Rb()({canvas:d.canvas,attributes:{alpha:!0,antialias:u.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:u.preserveDrawingBuffer},extensions:["OES_element_index_uint","OES_standard_derivatives","ANGLE_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture"],profile:!0,onDone:function(D,Z){(D||!Z)&&P(D),E(Z)}})});case 3:this.gl=x.sent,this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 5:case"end":return x.stop()}},i,this)}));function r(i,o){return n.apply(this,arguments)}return r}()},{key:"testExtension",value:function(r){return!!this.getGLContext().getExtension(r)}},{key:"setState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!0,equation:"add"},framebuffer:null})}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var r=this.getGLContext();r.disable(r.CULL_FACE)}},{key:"setDirty",value:function(r){this.isDirty=r}},{key:"getDirty",value:function(){return this.isDirty}}]),e}())||eg);function tg(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function rg(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?tg(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):tg(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var $b=function(){function e(n){(0,Ct.Z)(this,e),(0,C.Z)(this,"sceneService",void 0),(0,C.Z)(this,"mapService",void 0),(0,C.Z)(this,"controlService",void 0),(0,C.Z)(this,"layerService",void 0),(0,C.Z)(this,"iconService",void 0),(0,C.Z)(this,"markerService",void 0),(0,C.Z)(this,"popupService",void 0),(0,C.Z)(this,"fontService",void 0),(0,C.Z)(this,"interactionService",void 0),(0,C.Z)(this,"container",void 0);var r=n.id,i=n.map,o=n.canvas,u=n.hasBaseMap,d=Jx();this.container=d,i.setContainer(d,r,o,u),d.bind($t.IRendererService).to(Kb).inSingletonScope(),this.sceneService=d.get($t.ISceneService),this.mapService=d.get($t.IMapService),this.iconService=d.get($t.IIconService),this.fontService=d.get($t.IFontService),this.controlService=d.get($t.IControlService),this.layerService=d.get($t.ILayerService),this.markerService=d.get($t.IMarkerService),this.interactionService=d.get($t.IInteractionService),this.popupService=d.get($t.IPopupService),$i?this.sceneService.initMiniScene(n):(this.initComponent(r),this.sceneService.init(n),this.initControl())}return(0,qt.Z)(e,[{key:"map",get:function(){return this.mapService.map}},{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"exportPng",value:function(r){return this.sceneService.exportPng(r)}},{key:"exportMap",value:function(r){return this.sceneService.exportPng(r)}},{key:"registerRenderService",value:function(r){var i=this;if(this.sceneService.loaded){var o=new r(this);o.init()}else this.on("loaded",function(){var u=new r(i);u.init()})}},{key:"setBgColor",value:function(r){this.mapService.setBgColor(r)}},{key:"addLayer",value:function(r){var i=Qx(this.container);r.setContainer(i,this.container),this.sceneService.addLayer(r)}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(r){return this.layerService.getLayer(r)}},{key:"getLayerByName",value:function(r){return this.layerService.getLayerByName(r)}},{key:"removeLayer",value:function(r,i){this.layerService.remove(r,i)}},{key:"removeAllLayer",value:function(){this.layerService.removeAllLayers()}},{key:"render",value:function(){this.sceneService.render()}},{key:"setEnableRender",value:function(r){this.layerService.setEnableRender(r)}},{key:"addIconFont",value:function(r,i){this.fontService.addIconFont(r,i)}},{key:"addIconFonts",value:function(r){var i=this;r.forEach(function(o){var u=(0,An.Z)(o,2),d=u[0],_=u[1];i.fontService.addIconFont(d,_)})}},{key:"addFontFace",value:function(r,i){this.sceneService.addFontFace(r,i)}},{key:"addImage",value:function(r,i){$i?this.iconService.addImageMini(r,i,this.sceneService):this.iconService.addImage(r,i)}},{key:"hasImage",value:function(r){return this.iconService.hasImage(r)}},{key:"removeImage",value:function(r){this.iconService.removeImage(r)}},{key:"addIconFontGlyphs",value:function(r,i){this.fontService.addIconGlyphs(i)}},{key:"addControl",value:function(r){this.controlService.addControl(r,this.container)}},{key:"removeControl",value:function(r){this.controlService.removeControl(r)}},{key:"getControlByName",value:function(r){return this.controlService.getControlByName(r)}},{key:"addMarker",value:function(r){this.markerService.addMarker(r)}},{key:"addMarkerLayer",value:function(r){this.markerService.addMarkerLayer(r)}},{key:"removeMarkerLayer",value:function(r){this.markerService.removeMarkerLayer(r)}},{key:"removeAllMakers",value:function(){this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(r){this.popupService.addPopup(r)}},{key:"on",value:function(r,i){Cm.indexOf(r)===-1?this.mapService.on(r,i):this.sceneService.on(r,i)}},{key:"once",value:function(r,i){Cm.indexOf(r)===-1?this.mapService.once(r,i):this.sceneService.once(r,i)}},{key:"off",value:function(r,i){Cm.indexOf(r)===-1?this.mapService.off(r,i):this.sceneService.off(r,i)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(r){return this.mapService.getCenter(r)}},{key:"setCenter",value:function(r,i){return this.mapService.setCenter(r,i)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(r){return this.mapService.setPitch(r)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(r){this.mapService.setRotation(r)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(r){this.mapService.panTo(r)}},{key:"panBy",value:function(r,i){this.mapService.panBy(r,i)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(r){this.mapService.setZoom(r)}},{key:"fitBounds",value:function(r,i){var o=this.sceneService.getSceneConfig(),u=o.fitBoundsOptions,d=o.animate;this.mapService.fitBounds(r,i||rg(rg({},u),{},{animate:d}))}},{key:"setZoomAndCenter",value:function(r,i){this.mapService.setZoomAndCenter(r,i)}},{key:"setMapStyle",value:function(r){this.mapService.setMapStyle(r)}},{key:"setMapStatus",value:function(r){this.mapService.setMapStatus(r)}},{key:"pixelToLngLat",value:function(r){return this.mapService.pixelToLngLat(r)}},{key:"lngLatToPixel",value:function(r){return this.mapService.lngLatToPixel(r)}},{key:"containerToLngLat",value:function(r){return this.mapService.containerToLngLat(r)}},{key:"lngLatToContainer",value:function(r){return this.mapService.lngLatToContainer(r)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(r,i){this.container.bind($t.IPostProcessingPass).to(r).whenTargetNamed(i)}},{key:"enableShaderPick",value:function(){this.layerService.enableShaderPick()}},{key:"diasbleShaderPick",value:function(){this.layerService.disableShaderPick()}},{key:"initComponent",value:function(r){this.controlService.init({container:Pa(r)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var r=this.sceneService.getSceneConfig(),i=r.logoVisible,o=r.logoPosition;i&&this.addControl(new _b({position:o}))}}]),e}(),Jb=L(13218),Tc=L.n(Jb),ng,ig,ag,Am,og;function Qb(e){return e.map(function(n){return typeof n=="string"&&(n=[n,{}]),n})}var eE=(ng=(0,Fr.b2)(),ig=(0,Fr.f3)($t.IGlobalConfigService),ng(ag=(Am=function(){function e(){(0,Ct.Z)(this,e),Bn(this,"configService",og,this),(0,C.Z)(this,"enabled",void 0)}return(0,qt.Z)(e,[{key:"apply",value:function(r,i){var o=this,u=i.rendererService,d=i.postProcessingPassFactory,_=i.normalPassFactory;r.hooks.init.tap("MultiPassRendererPlugin",function(){var x=r.getLayerConfig(),E=x.enableMultiPassRenderer,P=x.passes,I=P===void 0?[]:P;o.enabled=!!E&&r.getLayerConfig().enableMultiPassRenderer!==!1,o.enabled&&(r.multiPassRenderer=o.createMultiPassRenderer(r,I,d,_),r.multiPassRenderer.setRenderFlag(!0))}),r.hooks.beforeRender.tap("MultiPassRendererPlugin",function(){})}},{key:"createMultiPassRenderer",value:function(r,i,o,u){var d=r.multiPassRenderer,_=r.getLayerConfig(),x=_.enablePicking,E=_.enableTAA;return x&&d.add(u("pixelPicking")),d}}]),e}(),og=Ln(Am.prototype,"configService",[ig],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Am))||ag),Kh,sg=(Kh={},(0,C.Z)(Kh,qc.additive,{enable:!0,func:{srcRGB:m.ONE,dstRGB:m.ONE,srcAlpha:1,dstAlpha:1}}),(0,C.Z)(Kh,qc.none,{enable:!1}),(0,C.Z)(Kh,qc.normal,{enable:!0,func:{srcRGB:m.SRC_ALPHA,dstRGB:m.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),(0,C.Z)(Kh,qc.subtractive,{enable:!0,func:{srcRGB:m.ONE,dstRGB:m.ONE,srcAlpha:m.ZERO,dstAlpha:m.ONE_MINUS_SRC_COLOR},equation:{rgb:m.FUNC_SUBTRACT,alpha:m.FUNC_SUBTRACT}}),(0,C.Z)(Kh,qc.max,{enable:!0,func:{srcRGB:m.ONE,dstRGB:m.ONE},equation:{rgb:m.MAX_EXT}}),(0,C.Z)(Kh,qc.min,{enable:!0,func:{srcRGB:m.ONE,dstRGB:m.ONE},equation:{rgb:m.MIN_EXT}}),Kh),tE=L(81763),io=L.n(tE),rE=L(1469),Mp=L.n(rE),oP=1024;function al(e,n,r,i,o){n.updateStyleAttribute(e,r,i,o)}function nE(e,n){e.opacity&&kv("opacity",n,e.opacity),e.strokeWidth&&kv("strokeWidth",n,e.strokeWidth),e.strokeOpacity&&kv("strokeOpacity",n,e.strokeOpacity),e.stroke&&iE("stroke",n,e.stroke),e.offsets&&ug("offsets",n,e.offsets),e.textOffset&&ug("textOffset",n,e.textOffset),e.thetaOffset&&kv("thetaOffset",n,e.thetaOffset)}function kv(e,n,r){Qo()(r)?al(e,n,r,function(i){return i}):io()(r)?al(e,n,[r],void 0):Mp()(r)&&r.length===2?Qo()(r[0])&&ku()(r[1])||Qo()(r[0])&&Mp()(r[1])&&io()(r[1][0])&&io()(r[1][1])?al(e,n,r[0],r[1]):al(e,n,[1],void 0):al(e,n,[1],void 0)}function ug(e,n,r){Qo()(r)?al(e,n,r,function(i){return i}):Mp()(r)&&r.length===2&&Qo()(r[0])&&ku()(r[1])?al(e,n,r[0],r[1]):Mp()(r)&&r.length===2&&io()(r[0])&&io()(r[1])?al(e,n,r,void 0):al(e,n,[0,0],void 0)}function iE(e,n,r){Qo()(r)?al(e,n,r,void 0):Mp()(r)&&r.length===2&&(Qo()(r[0])&&ku()(r[1])||Qo()(r[0])&&Mp()(r[1])&&r[1].length>0)?al(e,n,r[0],r[1]):al(e,n,"#fff",void 0)}var aE=[["circle","cylinder"],["square","cylinder"],["triangle","cylinder"],["pentagon","cylinder"],["hexagon","cylinder"],["octogon","cylinder"],["hexagram","cylinder"],["rhombus","cylinder"],["vesica","cylinder"]];function oE(e,n,r){typeof n=="string"&&typeof r=="string"&&n!==r&&aE.map(function(i){i.includes(n)&&i.includes(r)&&(e.dataState.dataSourceNeedUpdate=!0)})}var sE=["passes"],uE=["moduleName","vertexShader","fragmentShader","triangulation","segmentNumber"],lg,cg,Dv,fg,hg;function lE(e,n){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=cE(e))||n&&e&&typeof e.length=="number"){r&&(e=r);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(E){throw E},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var u=!0,d=!1,_;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return u=E.done,E},e:function(E){d=!0,_=E},f:function(){try{!u&&r.return!=null&&r.return()}finally{if(d)throw _}}}}function cE(e,n){if(!!e){if(typeof e=="string")return pg(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return pg(e,n)}}function pg(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}function dg(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function Vu(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?dg(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):dg(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function fE(e){var n=hE();return function(){var i=(0,zt.Z)(e),o;if(n){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,wn.Z)(this,o)}}function hE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var vg=0,Pp=(lg=Jd($t.IGlobalConfigService),cg=Jd($t.IShaderModuleService),Dv=function(e){(0,Yr.Z)(r,e);var n=fE(r);function r(){var i,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,Ct.Z)(this,r),i=n.call(this),(0,C.Z)((0,be.Z)(i),"id","".concat(vg++)),(0,C.Z)((0,be.Z)(i),"name","".concat(vg)),(0,C.Z)((0,be.Z)(i),"type",void 0),(0,C.Z)((0,be.Z)(i),"visible",!0),(0,C.Z)((0,be.Z)(i),"zIndex",0),(0,C.Z)((0,be.Z)(i),"minZoom",void 0),(0,C.Z)((0,be.Z)(i),"maxZoom",void 0),(0,C.Z)((0,be.Z)(i),"inited",!1),(0,C.Z)((0,be.Z)(i),"layerModelNeedUpdate",!1),(0,C.Z)((0,be.Z)(i),"pickedFeatureID",null),(0,C.Z)((0,be.Z)(i),"selectedFeatureID",null),(0,C.Z)((0,be.Z)(i),"styleNeedUpdate",!1),(0,C.Z)((0,be.Z)(i),"rendering",void 0),(0,C.Z)((0,be.Z)(i),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),(0,C.Z)((0,be.Z)(i),"hooks",{init:new uo,afterInit:new uo,beforeRender:new uo,beforeRenderData:new Wn,afterRender:new Zr,beforePickingEncode:new Zr,afterPickingEncode:new Zr,beforeHighlight:new Zr(["pickedColor"]),afterHighlight:new Zr,beforeSelect:new Zr(["pickedColor"]),afterSelect:new Zr,beforeDestroy:new Zr,afterDestroy:new Zr}),(0,C.Z)((0,be.Z)(i),"models",[]),(0,C.Z)((0,be.Z)(i),"multiPassRenderer",void 0),(0,C.Z)((0,be.Z)(i),"plugins",void 0),(0,C.Z)((0,be.Z)(i),"sourceOption",void 0),(0,C.Z)((0,be.Z)(i),"layerModel",void 0),(0,C.Z)((0,be.Z)(i),"sceneContainer",void 0),(0,C.Z)((0,be.Z)(i),"layerChildren",[]),Bn((0,be.Z)(i),"configService",fg,(0,be.Z)(i)),Bn((0,be.Z)(i),"shaderModuleService",hg,(0,be.Z)(i)),(0,C.Z)((0,be.Z)(i),"cameraService",void 0),(0,C.Z)((0,be.Z)(i),"coordinateService",void 0),(0,C.Z)((0,be.Z)(i),"iconService",void 0),(0,C.Z)((0,be.Z)(i),"fontService",void 0),(0,C.Z)((0,be.Z)(i),"pickingService",void 0),(0,C.Z)((0,be.Z)(i),"rendererService",void 0),(0,C.Z)((0,be.Z)(i),"layerService",void 0),(0,C.Z)((0,be.Z)(i),"interactionService",void 0),(0,C.Z)((0,be.Z)(i),"mapService",void 0),(0,C.Z)((0,be.Z)(i),"styleAttributeService",void 0),(0,C.Z)((0,be.Z)(i),"layerSource",void 0),(0,C.Z)((0,be.Z)(i),"postProcessingPassFactory",void 0),(0,C.Z)((0,be.Z)(i),"normalPassFactory",void 0),(0,C.Z)((0,be.Z)(i),"animateOptions",{enable:!1}),(0,C.Z)((0,be.Z)(i),"container",void 0),(0,C.Z)((0,be.Z)(i),"encodedData",void 0),(0,C.Z)((0,be.Z)(i),"configSchema",void 0),(0,C.Z)((0,be.Z)(i),"currentPickId",null),(0,C.Z)((0,be.Z)(i),"rawConfig",void 0),(0,C.Z)((0,be.Z)(i),"needUpdateConfig",void 0),(0,C.Z)((0,be.Z)(i),"pendingStyleAttributes",[]),(0,C.Z)((0,be.Z)(i),"scaleOptions",{}),(0,C.Z)((0,be.Z)(i),"animateStartTime",void 0),(0,C.Z)((0,be.Z)(i),"aniamateStatus",!1),(0,C.Z)((0,be.Z)(i),"sourceEvent",function(){i.dataState.dataSourceNeedUpdate=!0;var u=i.getLayerConfig(),d=u.autoFit,_=u.fitBoundsOptions;d&&i.fitBounds(_),i.emit("dataUpdate"),i.reRender()}),i.name=o.name||i.id,i.zIndex=o.zIndex||0,i.rawConfig=o,i}return(0,qt.Z)(r,[{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(o){if(!this.inited)this.needUpdateConfig=Vu(Vu({},this.needUpdateConfig),o);else{var u=this.container.get($t.SceneID);nE(o,this),this.configService.setLayerConfig(u,this.id,Vu(Vu(Vu({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),o)),this.needUpdateConfig={}}}},{key:"setContainer",value:function(o,u){this.container=o,this.sceneContainer=u}},{key:"getContainer",value:function(){return this.container}},{key:"addPlugin",value:function(o){return this.plugins.push(o),this}},{key:"init",value:function(){var o=this,u=this.container.get($t.SceneID),d=this.rawConfig.enableMultiPassRenderer,_=d===void 0?!1:d;this.configService.setLayerConfig(u,this.id,{enableMultiPassRenderer:_}),this.iconService=this.container.get($t.IIconService),this.fontService=this.container.get($t.IFontService),this.rendererService=this.container.get($t.IRendererService),this.layerService=this.container.get($t.ILayerService),this.interactionService=this.container.get($t.IInteractionService),this.pickingService=this.container.get($t.IPickingService),this.mapService=this.container.get($t.IMapService),this.cameraService=this.container.get($t.ICameraService),this.coordinateService=this.container.get($t.ICoordinateSystemService),this.postProcessingPassFactory=this.container.get($t.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get($t.IFactoryNormalPass),this.styleAttributeService=this.container.get($t.IStyleAttributeService),this.multiPassRenderer=this.container.get($t.IMultiPassRenderer),this.multiPassRenderer.setLayer(this),this.pendingStyleAttributes.forEach(function(I){var D=I.attributeName,Z=I.attributeField,re=I.attributeValues,oe=I.updateOptions;o.styleAttributeService.updateStyleAttribute(D,{scale:Vu({field:Z},o.splitValuesAndCallbackInAttribute(re,o.getLayerConfig()[D]))},oe)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll($t.ILayerPlugin);var x=lE(this.plugins),E;try{for(x.s();!(E=x.n()).done;){var P=E.value;P.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}}catch(I){x.e(I)}finally{x.f()}return this.hooks.init.call(),this.hooks.afterInit.call(),this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this}},{key:"prepareBuildModel",value:function(){this.inited=!0,this.updateLayerConfig(Vu(Vu({},this.getDefaultConfig()),this.rawConfig));var o=this.getLayerConfig(),u=o.animateOption;u!=null&&u.enable&&(this.layerService.startAnimate(),this.aniamateStatus=!0)}},{key:"color",value:function(o,u,d){return this.updateStyleAttribute("color",o,u,d),this}},{key:"texture",value:function(o,u,d){return this.updateStyleAttribute("texture",o,u,d),this}},{key:"rotate",value:function(o,u,d){return this.updateStyleAttribute("rotate",o,u,d),this}},{key:"size",value:function(o,u,d){return this.updateStyleAttribute("size",o,u,d),this}},{key:"filter",value:function(o,u,d){return this.updateStyleAttribute("filter",o,u,d),this}},{key:"shape",value:function(o,u,d){var _,x,E,P=(_=this.styleAttributeService)===null||_===void 0||(x=_.getLayerStyleAttribute("shape"))===null||x===void 0||(E=x.scale)===null||E===void 0?void 0:E.field,I=o;return this.updateStyleAttribute("shape",o,u,d),oE(this,P,I),this}},{key:"label",value:function(o,u,d){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:o,attributeValues:u,updateOptions:d}),this}},{key:"animate",value:function(o){var u={};return Tc()(o)?(u.enable=!0,u=Vu(Vu({},u),o)):u.enable=o,this.updateLayerConfig({animateOption:u}),this}},{key:"source",value:function(o,u){return o!=null&&o.data?(this.setSource(o),this):(this.sourceOption={data:o,options:u},this)}},{key:"setData",value:function(o,u){var d=this;return this.inited?this.layerSource.setData(o,u):this.on("inited",function(){d.layerSource.setData(o,u)}),this}},{key:"style",value:function(o){var u=this,d=o.passes,_=(0,Sn.Z)(o,sE);return d&&Qb(d).forEach(function(x){var E=u.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(x[0]);E&&E.updateOptions(x[1])}),this.rawConfig=Vu(Vu({},this.rawConfig),_),this.container&&(this.updateLayerConfig(this.rawConfig),this.styleNeedUpdate=!0),this}},{key:"scale",value:function(o,u){return Tc()(o)?this.scaleOptions=Vu(Vu({},this.scaleOptions),o):this.scaleOptions[o]=u,this}},{key:"renderLayers",value:function(){this.rendering=!0,this.layerService.renderLayers(),this.rendering=!1}},{key:"render",value:function(){return this.getEncodedData().length!==0&&this.renderModels(),this}},{key:"active",value:function(o){var u={};return u.enableHighlight=Tc()(o)?!0:o,Tc()(o)?(u.enableHighlight=!0,o.color&&(u.highlightColor=o.color)):u.enableHighlight=!!o,this.updateLayerConfig(u),this}},{key:"setActive",value:function(o,u){var d=this;if(Tc()(o)){var _=o.x,x=_===void 0?0:_,E=o.y,P=E===void 0?0:E;this.updateLayerConfig({highlightColor:Tc()(u)?u.color:this.getLayerConfig().highlightColor}),this.pick({x,y:P})}else this.updateLayerConfig({pickedFeatureID:o,highlightColor:Tc()(u)?u.color:this.getLayerConfig().highlightColor}),this.hooks.beforeSelect.call(Ji(o)).then(function(){setTimeout(function(){d.reRender()},1)})}},{key:"select",value:function(o){var u={};return u.enableSelect=Tc()(o)?!0:o,Tc()(o)?(u.enableSelect=!0,o.color&&(u.selectColor=o.color)):u.enableSelect=!!o,this.updateLayerConfig(u),this}},{key:"setSelect",value:function(o,u){var d=this;if(Tc()(o)){var _=o.x,x=_===void 0?0:_,E=o.y,P=E===void 0?0:E;this.updateLayerConfig({selectColor:Tc()(u)?u.color:this.getLayerConfig().selectColor}),this.pick({x,y:P})}else this.updateLayerConfig({pickedFeatureID:o,selectColor:Tc()(u)?u.color:this.getLayerConfig().selectColor}),this.hooks.beforeSelect.call(Ji(o)).then(function(){setTimeout(function(){d.reRender()},1)})}},{key:"setBlend",value:function(o){this.updateLayerConfig({blend:o}),this.layerModelNeedUpdate=!0,this.reRender()}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this}},{key:"hide",value:function(){return this.updateLayerConfig({visible:!1}),this.reRender(),this}},{key:"setIndex",value:function(o){return this.zIndex=o,this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this}},{key:"setCurrentPickId",value:function(o){this.currentPickId=o}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(o){this.selectedFeatureID=o}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var o=this.mapService.getZoom(),u=this.getLayerConfig(),d=u.visible,_=u.minZoom,x=_===void 0?-Infinity:_,E=u.maxZoom,P=E===void 0?Infinity:E;return!!d&&o>=x&&o<=P}},{key:"setMinZoom",value:function(o){return this.updateLayerConfig({minZoom:o}),this}},{key:"getMinZoom",value:function(){var o=this.getLayerConfig(),u=o.minZoom;return u}},{key:"getMaxZoom",value:function(){var o=this.getLayerConfig(),u=o.maxZoom;return u}},{key:"get",value:function(o){var u=this.getLayerConfig();return u[o]}},{key:"setMaxZoom",value:function(o){return this.updateLayerConfig({maxZoom:o}),this}},{key:"fitBounds",value:function(o){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var u=this.getSource(),d=u.extent,_=d.some(function(x){return Math.abs(x)===Infinity});return _?this:(this.mapService.fitBounds([[d[0],d[1]],[d[2],d[3]]],o),this)}},{key:"destroy",value:function(){var o;this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),this.multiPassRenderer.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),(o=this.layerModel)===null||o===void 0||o.clearModels(),this.encodedData=null,this.emit("remove",{target:this,type:"remove"}),this.removeAllListeners()}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){this.models.forEach(function(o){return o.destroy()}),this.layerModel.clearModels()}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(function(o){return o.needRescale||o.needRemapping||o.needRegenerateVertices}).length}},{key:"setSource",value:function(o){if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=o,this.inited&&this.layerSource.cluster){var u=this.mapService.getZoom();this.layerSource.updateClusterData(u)}this.layerSource.on("update",this.sourceEvent)}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(o){this.encodedData=o}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getLegendItems",value:function(o){var u=this.styleAttributeService.getLayerAttributeScale(o);if(u){if(u.ticks){var d=u.ticks().map(function(x){return(0,C.Z)({value:x},o,u(x))});return d}else if(u.invertExtent){var _=u.range().map(function(x){return(0,C.Z)({value:u.invertExtent(x)},o,x)});return _}}else return[]}},{key:"pick",value:function(o){var u=o.x,d=o.y;this.interactionService.triggerHover({x:u,y:d})}},{key:"boxSelect",value:function(o,u){this.pickingService.boxPickLayer(this,o,u)}},{key:"buildLayerModel",value:function(o){var u=o.moduleName,d=o.vertexShader,_=o.fragmentShader,x=o.triangulation,E=o.segmentNumber,P=(0,Sn.Z)(o,uE);this.shaderModuleService.registerModule(u,{vs:d,fs:_});var I=this.shaderModuleService.getModule(u),D=I.vs,Z=I.fs,re=I.uniforms,oe=this.rendererService.createModel,de=this.styleAttributeService.createAttributesAndIndices(this.encodedData,x,E),Fe=de.attributes,it=de.elements;return oe(Vu({attributes:Fe,uniforms:re,fs:Z,vs:D,elements:it,blend:sg[qc.normal]},P))}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.aniamateStatus&&(this.layerService.stopAnimate(),this.aniamateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(o){var u=this.getLayerConfig(),d=u.enableHighlight,_=d===void 0?!0:d,x=u.enableSelect,E=x===void 0?!0:x,P=this.eventNames().indexOf(o)!==-1||this.eventNames().indexOf("un"+o)!==-1;return(o==="click"||o==="dblclick")&&E&&(P=!0),o==="mousemove"&&(_||this.eventNames().indexOf("mouseenter")!==-1||this.eventNames().indexOf("unmousemove")!==-1||this.eventNames().indexOf("mouseout")!==-1)&&(P=!0),this.isVisible()&&P}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"rebuildModels",value:function(){throw new Error("Method not implemented.")}},{key:"renderModels",value:function(o){var u=this;return this.getEncodedData().length>0&&(this.layerModelNeedUpdate&&this.layerModel&&(this.models=this.layerModel.buildModels(),this.hooks.beforeRender.call(),this.layerModelNeedUpdate=!1),this.models.forEach(function(d){d.draw({uniforms:u.layerModel.getUninforms()},o)})),this}},{key:"updateStyleAttribute",value:function(o,u,d,_){this.inited?this.styleAttributeService.updateStyleAttribute(o,{scale:Vu({field:u},this.splitValuesAndCallbackInAttribute(d,this.getLayerConfig()[u]))},_):this.pendingStyleAttributes.push({attributeName:o,attributeField:u,attributeValues:d,updateOptions:_})}},{key:"getShaderPickStat",value:function(){return this.layerService.getShaderPickStat()}},{key:"setEarthTime",value:function(o){console.warn("empty fn")}},{key:"getConfigSchema",value:function(){throw new Error("Method not implemented.")}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"reRender",value:function(){this.inited&&(this.layerService.updateLayerRenderList(),this.layerService.renderLayers())}},{key:"splitValuesAndCallbackInAttribute",value:function(o,u){return{values:ku()(o)?void 0:o||u,callback:ku()(o)?o:void 0}}}]),r}(ha.EventEmitter),fg=Ln(Dv.prototype,"configService",[lg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hg=Ln(Dv.prototype,"shaderModuleService",[cg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dv),pE=L(18446),cd=L.n(pE),mg,gg,Fv,yg,_g;function dE(e,n){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=vE(e))||n&&e&&typeof e.length=="number"){r&&(e=r);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(E){throw E},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var u=!0,d=!1,_;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return u=E.done,E},e:function(E){d=!0,_=E},f:function(){try{!u&&r.return!=null&&r.return()}finally{if(d)throw _}}}}function vE(e,n){if(!!e){if(typeof e=="string")return xg(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return xg(e,n)}}function xg(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}var Us=(mg=Jd($t.IGlobalConfigService),gg=Jd($t.IShaderModuleService),Fv=function(){function e(n){(0,Ct.Z)(this,e),(0,C.Z)(this,"triangulation",void 0),(0,C.Z)(this,"createTexture2D",void 0),(0,C.Z)(this,"layer",void 0),(0,C.Z)(this,"dataTexture",void 0),(0,C.Z)(this,"DATA_TEXTURE_WIDTH",void 0),(0,C.Z)(this,"rowCount",void 0),(0,C.Z)(this,"cacheStyleProperties",void 0),(0,C.Z)(this,"cellLength",void 0),(0,C.Z)(this,"cellProperties",void 0),(0,C.Z)(this,"cellTypeLayout",void 0),(0,C.Z)(this,"stylePropertyesExist",void 0),(0,C.Z)(this,"dataTextureTest",void 0),Bn(this,"configService",yg,this),Bn(this,"shaderModuleService",_g,this),(0,C.Z)(this,"rendererService",void 0),(0,C.Z)(this,"iconService",void 0),(0,C.Z)(this,"fontService",void 0),(0,C.Z)(this,"styleAttributeService",void 0),(0,C.Z)(this,"mapService",void 0),(0,C.Z)(this,"cameraService",void 0),(0,C.Z)(this,"layerService",void 0),this.layer=n,this.rendererService=n.getContainer().get($t.IRendererService),this.styleAttributeService=n.getContainer().get($t.IStyleAttributeService),this.mapService=n.getContainer().get($t.IMapService),this.iconService=n.getContainer().get($t.IIconService),this.fontService=n.getContainer().get($t.IFontService),this.cameraService=n.getContainer().get($t.ICameraService),this.layerService=n.getContainer().get($t.ILayerService),this.registerBuiltinAttributes(),this.startModelAnimate();var r=this.rendererService.createTexture2D;this.createTexture2D=r,this.DATA_TEXTURE_WIDTH=1024,this.rowCount=1,this.cellLength=0,this.cellProperties=[],this.cacheStyleProperties={thetaOffset:void 0,opacity:void 0,strokeOpacity:void 0,strokeWidth:void 0,stroke:void 0,offsets:void 0},this.stylePropertyesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0},this.dataTextureTest=this.layerService.getOESTextureFloat(),this.dataTextureTest||(this.dataTexture=this.createTexture2D({data:new Uint8ClampedArray(4),mag:m.NEAREST,min:m.NEAREST,width:1,height:1}))}return(0,qt.Z)(e,[{key:"clearLastCalRes",value:function(){this.cellProperties=[],this.cellLength=0,this.stylePropertyesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0}}},{key:"getCellTypeLayout",value:function(){return this.dataTextureTest?[this.rowCount,this.DATA_TEXTURE_WIDTH,0,0,this.stylePropertyesExist.hasOpacity,this.stylePropertyesExist.hasStrokeOpacity,this.stylePropertyesExist.hasStrokeWidth,this.stylePropertyesExist.hasStroke,this.stylePropertyesExist.hasOffsets,this.stylePropertyesExist.hasThetaOffset,0,0,0,0,0,1]:[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,-1]}},{key:"dataTextureNeedUpdate",value:function(r){var i=!1;return cd()(r.thetaOffset,this.cacheStyleProperties.thetaOffset)||(i=!0,this.cacheStyleProperties.thetaOffset=r.thetaOffset),cd()(r.opacity,this.cacheStyleProperties.opacity)||(i=!0,this.cacheStyleProperties.opacity=r.opacity),cd()(r.strokeOpacity,this.cacheStyleProperties.strokeOpacity)||(i=!0,this.cacheStyleProperties.strokeOpacity=r.strokeOpacity),cd()(r.strokeWidth,this.cacheStyleProperties.strokeWidth)||(i=!0,this.cacheStyleProperties.strokeWidth=r.strokeWidth),cd()(r.stroke,this.cacheStyleProperties.stroke)||(i=!0,this.cacheStyleProperties.stroke=r.stroke),cd()(r.offsets,this.cacheStyleProperties.offsets)||(i=!0,this.cacheStyleProperties.offsets=r.offsets),this.dataTexture===void 0&&(i=!0),i}},{key:"judgeStyleAttributes",value:function(r){this.clearLastCalRes(),r.opacity!==void 0&&!io()(r.opacity)&&(this.cellProperties.push({attr:"opacity",count:1}),this.stylePropertyesExist.hasOpacity=1,this.cellLength+=1),r.strokeOpacity!==void 0&&!io()(r.strokeOpacity)&&(this.cellProperties.push({attr:"strokeOpacity",count:1}),this.stylePropertyesExist.hasStrokeOpacity=1,this.cellLength+=1),r.strokeWidth!==void 0&&!io()(r.strokeWidth)&&(this.cellProperties.push({attr:"strokeWidth",count:1}),this.stylePropertyesExist.hasStrokeWidth=1,this.cellLength+=1),r.stroke!==void 0&&!this.isStaticColor(r.stroke)&&(this.cellProperties.push({attr:"stroke",count:4}),this.stylePropertyesExist.hasStroke=1,this.cellLength+=4),r.offsets!==void 0&&!this.isOffsetStatic(r.offsets)&&(this.cellProperties.push({attr:"offsets",count:2}),this.stylePropertyesExist.hasOffsets=1,this.cellLength+=2),r.thetaOffset!==void 0&&!io()(r.thetaOffset)&&(this.cellProperties.push({attr:"thetaOffset",count:1}),this.stylePropertyesExist.hasThetaOffset=1,this.cellLength+=1)}},{key:"isStaticColor",value:function(r){return Qo()(r)?!!(0,nu.ZP)(r):!1}},{key:"getStrokeColor",value:function(r){if(this.isStaticColor(r)){var i=to(r);return i[0]=i[0]?i[0]:0,i[1]=i[1]?i[1]:0,i[2]=i[2]?i[2]:0,i[3]=i[3]?i[3]:0,i}else return[0,0,0,0]}},{key:"isOffsetStatic",value:function(r){return!!(Mp()(r)&&r.length===2&&io()(r[0])&&io()(r[1]))}},{key:"patchMod",value:function(r,i){for(var o=0;o<i;o++)r.push(-1)}},{key:"patchData",value:function(r,i,o){var u=dE(o),d;try{for(u.s();!(d=u.n()).done;){var _=d.value,x=_.attr,E=_.count,P=i[x];P!==void 0?x==="stroke"?r.push.apply(r,(0,we.Z)(to(P))):x==="offsets"?this.isOffsetStatic(P)?r.push(-P[0],P[1]):r.push(0,0):r.push(io()(P)?P:1):this.patchMod(r,E)}}catch(I){u.e(I)}finally{u.f()}}},{key:"calDataFrame",value:function(r,i,o){for(var u=i.length,d=Math.ceil(u*r/this.DATA_TEXTURE_WIDTH),_=d*this.DATA_TEXTURE_WIDTH,x=[],E=0;E<u;E++){var P=i[E];this.patchData(x,P,o)}for(var I=x.length;I<_;I++)x.push(-1);return{data:x,width:this.DATA_TEXTURE_WIDTH,height:d}}},{key:"getBlend",value:function(){var r=this.layer.getLayerConfig(),i=r.blend,o=i===void 0?"normal":i;return sg[qc[o]]}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){return!1}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){throw new Error("Method not implemented.")}},{key:"clearModels",value:function(){}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(r){return[r.enable?0:1,r.duration||4,r.interval||.2,r.trailLength||.1]}},{key:"startModelAnimate",value:function(){var r=this.layer.getLayerConfig(),i=r.animateOption;i.enable&&this.layer.setAnimateStartTime()}}]),e}(),yg=Ln(Fv.prototype,"configService",[mg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_g=Ln(Fv.prototype,"shaderModuleService",[gg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fv),mE=L(9187),Ff=L.n(mE),bg=100,sP=36,uP=40;function Eg(e){return e/180*Math.acos(-1)}function Sg(e){var n=Eg(e[0])+Math.PI/2,r=Eg(e[1]),i=bg+Math.random()*.4,o=i*Math.cos(r)*Math.cos(n),u=i*Math.cos(r)*Math.sin(n),d=i*Math.sin(r);return[u,d,o]}function lP(e,n){var r=mat4.create(),i=mat4.create(),o=vec3.fromValues(0,1,0),u=vec3.fromValues(0,0,0);n=n||{},e=typeof e!="undefined"?e:1;for(var d=typeof n.segments!="undefined"?n.segments:32,_=2+d,x=2*_,E=[],P=[],I=[],D=[],Z=[],re=[],oe=0;oe<=_;oe++){for(var de=oe/_,Fe=de*Math.PI,it=0;it<=x;it++){var vt=it/x,xt=vt*Math.PI*2;mat4.identity(i),mat4.rotateZ(i,i,-Fe),mat4.identity(r),mat4.rotateY(r,r,xt),vec3.transformMat4(u,o,i),vec3.transformMat4(u,u,r),vec3.scale(u,u,-e),I.push(u.slice()),D.push.apply(D,_toConsumableArray(u.slice())),vec3.normalize(u,u),Z.push.apply(Z,_toConsumableArray(u.slice())),re.push([vt,1-de]),D.push(vt,1-de)}if(oe>0)for(var Gt=I.length,Xt=Gt-2*(x+1);Xt+x+2<Gt;Xt++)E.push([Xt,Xt+1,Xt+x+1]),P.push(Xt,Xt+1,Xt+x+1),E.push([Xt+x+1,Xt+1,Xt+x+2]),P.push(Xt+x+1,Xt+1,Xt+x+2)}return{cells:E,positions:I,uvs:re,positionsArr:D,indicesArr:P,normalArr:Z}}var Fi=L(31437),Nv=Fi.Ue(),cP=Fi.Ue(),ju=Fi.Ue(),fd=Fi.Ue(),Bv=Fi.Ue();function wg(e,n,r,i,o){Fi.IH(e,r,i),Fi.Fv(e,e),n=Fi.al(-e[1],e[0]);var u=Fi.al(-r[1],r[0]);return[o/Fi.AK(n,u),n]}function hd(e,n){return Fi.t8(e,-n[1],n[0])}function zv(e,n,r){return Fi.lu(e,n,r),Fi.Fv(e,e),e}function Cg(e,n){return e[0]===n[0]&&e[1]===n[1]}function fP(e){for(var n=new Map,r=0;r<e.length;r++){var i=e[0].toString()+"-"+e[1].toString();n.get(i)?(e.splice(r,1),r++):n.set(i,i)}return e}var gE=function(){function e(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,Ct.Z)(this,e),(0,C.Z)(this,"complex",void 0),(0,C.Z)(this,"join",void 0),(0,C.Z)(this,"cap",void 0),(0,C.Z)(this,"miterLimit",void 0),(0,C.Z)(this,"thickness",void 0),(0,C.Z)(this,"normal",void 0),(0,C.Z)(this,"lastFlip",-1),(0,C.Z)(this,"miter",Fi.al(0,0)),(0,C.Z)(this,"started",!1),(0,C.Z)(this,"dash",!1),(0,C.Z)(this,"totalDistance",0),this.join=n.join||"miter",this.cap=n.cap||"butt",this.miterLimit=n.miterLimit||10,this.thickness=n.thickness||1,this.dash=n.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0}}return(0,qt.Z)(e,[{key:"extrude_gaode2",value:function(r,i){var o=this.complex;if(r.length<=1)return o;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var u=r.length,d=o.startIndex,_=1;_<u;_++){var x=r[_-1],E=i[_-1],P=r[_],I=i[_],D=_<r.length-1?r[_+1]:null,Z=_<i.length-1?i[_+1]:null,re=this.segment_gaode2(o,d,x,P,D,E,I,Z);d+=re}if(this.dash)for(var oe=0;oe<o.positions.length/6;oe++)o.positions[oe*6+5]=this.totalDistance;return o.startIndex=o.positions.length/6,o}},{key:"extrude",value:function(r){var i=this.complex;if(r.length<=1)return i;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var o=r.length,u=i.startIndex,d=1;d<o;d++){var _=r[d-1],x=r[d],E=d<r.length-1?r[d+1]:null,P=this.segment(i,u,_,x,E);u+=P}if(this.dash)for(var I=0;I<i.positions.length/6;I++)i.positions[I*6+5]=this.totalDistance;return i.startIndex=i.positions.length/6,i}},{key:"segment_gaode2",value:function(r,i,o,u,d,_,x,E){var P=0,I=r.indices,D=r.positions,Z=r.normals,re=this.cap==="square",oe=this.join==="bevel",de=Fs([x[0],x[1]]),Fe=Fs([_[0],_[1]]);zv(ju,u,o);var it=0;if(this.dash&&(it=this.lineSegmentDistance(de,Fe),this.totalDistance+=it),this.normal||(this.normal=Fi.Ue(),hd(this.normal,ju)),!this.started)if(this.started=!0,re){var vt=Fi.Ue(),xt=Fi.Ue();Fi.IH(vt,this.normal,ju),Fi.IH(xt,this.normal,ju),Z.push(xt[0],xt[1],0),Z.push(vt[0],vt[1],0),D.push(o[0],o[1],o[2]|0,this.totalDistance-it,-this.thickness,o[2]|0),D.push(o[0],o[1],o[2]|0,this.totalDistance-it,this.thickness,o[2]|0)}else this.extrusions(D,Z,o,this.normal,this.thickness,this.totalDistance-it);if(I.push(i+0,i+1,i+2),d){Cg(u,d)&&Fi.IH(d,u,Fi.Fv(d,Fi.$X(d,u,o))),zv(fd,d,u);var nr=wg(Bv,Fi.Ue(),ju,fd,this.thickness),mr=(0,An.Z)(nr,2),en=mr[0],hn=mr[1],wr=Fi.AK(Bv,this.normal)<0?-1:1,Pn=oe;if(!Pn&&this.join==="miter"){var jn=en;jn>this.miterLimit&&(Pn=!0)}Pn?(Z.push(this.normal[0],this.normal[1],0),Z.push(hn[0],hn[1],0),D.push(u[0],u[1],u[2]|0,this.totalDistance,-this.thickness*wr,u[2]|0),D.push(u[0],u[1],u[2]|0,this.totalDistance,this.thickness*wr,u[2]|0),I.push.apply(I,(0,we.Z)(this.lastFlip!==-wr?[i,i+2,i+3]:[i+2,i+1,i+3])),I.push(i+2,i+3,i+4),hd(Nv,fd),Fi.JG(this.normal,Nv),Z.push(this.normal[0],this.normal[1],0),D.push(u[0],u[1],u[2]|0,this.totalDistance,-this.thickness*wr,u[2]|0),P+=3):(this.extrusions(D,Z,u,hn,en,this.totalDistance),I.push.apply(I,(0,we.Z)(this.lastFlip===1?[i,i+2,i+3]:[i+2,i+1,i+3])),wr=-1,Fi.JG(this.normal,hn),P+=2),this.lastFlip=wr}else{if(hd(this.normal,ju),re){var Gt=Fi.Ue(),Xt=Fi.Ue();Fi.lu(Xt,ju,this.normal),Fi.IH(Gt,ju,this.normal),Z.push(Xt[0],Xt[1],0),Z.push(Gt[0],Gt[1],0),D.push(u[0],u[1],u[2]|0,this.totalDistance,this.thickness,u[2]|0),D.push(u[0],u[1],u[2]|0,this.totalDistance,this.thickness,u[2]|0)}else this.extrusions(D,Z,u,this.normal,this.thickness,this.totalDistance);I.push.apply(I,(0,we.Z)(this.lastFlip===1?[i,i+2,i+3]:[i+2,i+1,i+3])),P+=2}return P}},{key:"segment",value:function(r,i,o,u,d){var _=0,x=r.indices,E=r.positions,P=r.normals,I=this.cap==="square",D=this.join==="bevel",Z=Fs([u[0],u[1]]),re=Fs([o[0],o[1]]);zv(ju,Z,re);var oe=0;if(this.dash&&(oe=this.lineSegmentDistance(Z,re),this.totalDistance+=oe),this.normal||(this.normal=Fi.Ue(),hd(this.normal,ju)),!this.started)if(this.started=!0,I){var de=Fi.Ue(),Fe=Fi.Ue();Fi.IH(de,this.normal,ju),Fi.IH(Fe,this.normal,ju),P.push(Fe[0],Fe[1],0),P.push(de[0],de[1],0),E.push(o[0],o[1],o[2]|0,this.totalDistance-oe,-this.thickness,o[2]|0),E.push(o[0],o[1],o[2]|0,this.totalDistance-oe,this.thickness,o[2]|0)}else this.extrusions(E,P,o,this.normal,this.thickness,this.totalDistance-oe);if(x.push(i+0,i+1,i+2),d){var xt=Fs([d[0],d[1]]);Cg(Z,xt)&&Fi.IH(xt,Z,Fi.Fv(xt,Fi.$X(xt,Z,re))),zv(fd,xt,Z);var Gt=wg(Bv,Fi.Ue(),ju,fd,this.thickness),Xt=(0,An.Z)(Gt,2),nr=Xt[0],mr=Xt[1],en=Fi.AK(Bv,this.normal)<0?-1:1,hn=D;if(!hn&&this.join==="miter"){var wr=nr;wr>this.miterLimit&&(hn=!0)}hn?(P.push(this.normal[0],this.normal[1],0),P.push(mr[0],mr[1],0),E.push(u[0],u[1],u[2]|0,this.totalDistance,-this.thickness*en,u[2]|0),E.push(u[0],u[1],u[2]|0,this.totalDistance,this.thickness*en,u[2]|0),x.push.apply(x,(0,we.Z)(this.lastFlip!==-en?[i,i+2,i+3]:[i+2,i+1,i+3])),x.push(i+2,i+3,i+4),hd(Nv,fd),Fi.JG(this.normal,Nv),P.push(this.normal[0],this.normal[1],0),E.push(u[0],u[1],u[2]|0,this.totalDistance,-this.thickness*en,u[2]|0),_+=3):(this.extrusions(E,P,u,mr,nr,this.totalDistance),x.push.apply(x,(0,we.Z)(this.lastFlip===1?[i,i+2,i+3]:[i+2,i+1,i+3])),en=-1,Fi.JG(this.normal,mr),_+=2),this.lastFlip=en}else{if(hd(this.normal,ju),I){var it=Fi.Ue(),vt=Fi.Ue();Fi.lu(vt,ju,this.normal),Fi.IH(it,ju,this.normal),P.push(vt[0],vt[1],0),P.push(it[0],it[1],0),E.push(u[0],u[1],u[2]|0,this.totalDistance,this.thickness,u[2]|0),E.push(u[0],u[1],u[2]|0,this.totalDistance,this.thickness,u[2]|0)}else this.extrusions(E,P,u,this.normal,this.thickness,this.totalDistance);x.push.apply(x,(0,we.Z)(this.lastFlip===1?[i,i+2,i+3]:[i+2,i+1,i+3])),_+=2}return _}},{key:"extrusions",value:function(r,i,o,u,d,_){i.push(u[0],u[1],0),i.push(u[0],u[1],0),r.push(o[0],o[1],o[2]|0,_,-d,o[2]|0),r.push(o[0],o[1],o[2]|0,_,d,o[2]|0)}},{key:"lineSegmentDistance",value:function(r,i){var o=i[0]-r[0],u=i[1]-r[1];return Math.sqrt(o*o+u*u)}}]),e}();function Ip(e){if(io()(e[0]))return e;if(io()(e[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(io()(e[0][0][0])){var n=e,r=0,i=0,o=0;return n.forEach(function(u){u.forEach(function(d){r+=d[0],i+=d[1],o++})}),[r/o,i/o,0]}else throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}function yE(e){for(var n=e[0],r=e[1],i=e[0],o=e[1],u=0,d=0,_=0,x=0;x<e.length;x+=2){var E=e[x],P=e[x+1];E&&P&&(n=Math.max(E,n),r=Math.max(P,r),i=Math.min(E,i),o=Math.min(P,o),u+=E,d+=P,_++)}return{center:[u/_,d/_],radius:Math.sqrt(Math.pow(n-i,2)+Math.pow(r-o,2))/2}}var Ha=L(77160);function _E(e){var n=e[0][0],r=e[0][e[0].length-1];n[0]===r[0]&&n[1]===r[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var i=e[0].length,o=Ff().flatten(e),u=o.vertices,d=o.dimensions,_=[],x=[],E=0;E<u.length/d;E++)d===2?_.push(u[E*2],u[E*2+1],1):_.push(u[E*3],u[E*3+1],1);var P=Ff()(o.vertices,o.holes,o.dimensions);x.push.apply(x,(0,we.Z)(P));for(var I=function(re){var oe=o.vertices.slice(re*d,(re+1)*d),de=o.vertices.slice((re+1)*d,(re+2)*d);de.length===0&&(de=o.vertices.slice(0,d));var Fe=_.length/3;_.push(oe[0],oe[1],1,de[0],de[1],1,oe[0],oe[1],0,de[0],de[1],0),x.push.apply(x,(0,we.Z)([0,2,1,2,3,1].map(function(it){return it+Fe})))},D=0;D<i;D++)I(D);return{positions:_,index:x}}function xE(e){var n=Ff().flatten(e),r=Ff()(n.vertices,n.holes,n.dimensions);return{positions:n.vertices,index:r}}function Tg(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=e[0][0],i=e[0][e[0].length-1];r[0]===i[0]&&r[1]===i[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var o=e[0].length,u=Ff().flatten(e),d=u.vertices,_=u.dimensions,x=[],E=[],P=[],I=0;I<d.length/_;I++)_===2?x.push(d[I*2],d[I*2+1],1,-1,-1):x.push(d[I*3],d[I*3+1],1,-1,-1),P.push(0,0,1);var D=Ff()(u.vertices,u.holes,u.dimensions);E.push.apply(E,(0,we.Z)(D));for(var Z=function(de){var Fe=u.vertices.slice(de*_,(de+1)*_),it=u.vertices.slice((de+1)*_,(de+2)*_);it.length===0&&(it=u.vertices.slice(0,_));var vt=x.length/5;x.push(Fe[0],Fe[1],1,0,0,it[0],it[1],1,.1,0,Fe[0],Fe[1],0,0,.8,it[0],it[1],0,.1,.8);var xt=bE([it[0],it[1],1],[Fe[0],Fe[1],0],[Fe[0],Fe[1],1],n);P.push.apply(P,(0,we.Z)(xt).concat((0,we.Z)(xt),(0,we.Z)(xt),(0,we.Z)(xt))),E.push.apply(E,(0,we.Z)([1,2,0,3,2,1].map(function(Gt){return Gt+vt})))},re=0;re<o;re++)Z(re);return{positions:x,index:E,normals:P}}function bE(e,n,r){var i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,o=Ha.create(),u=Ha.create(),d=Ha.create();i&&(e=Si(e),n=Si(n),r=Si(r));var _=Ha.fromValues.apply(Ha,(0,we.Z)(e)),x=Ha.fromValues.apply(Ha,(0,we.Z)(n)),E=Ha.fromValues.apply(Ha,(0,we.Z)(r));Ha.sub(o,E,x),Ha.sub(u,_,x),Ha.cross(d,o,u);var P=Ha.create();return Ha.normalize(P,d),P}var Ac,Op;(function(e){e.CYLINDER="cylinder",e.SQUARECOLUMN="squareColumn",e.TRIANGLECOLUMN="triangleColumn",e.HEXAGONCOLUMN="hexagonColumn",e.PENTAGONCOLUMN="pentagonColumn"})(Op||(Op={}));var Rp;(function(e){e.CIRCLE="circle",e.SQUARE="square",e.TRIANGLE="triangle",e.HEXAGON="hexagon",e.PENTAGON="pentagon"})(Rp||(Rp={}));function rv(e){for(var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=Math.PI*2/e,i=[],o=0;o<e;o++)i.push(r*o+n*Math.PI/12);var u=i.map(function(d){var _=Math.sin(d+Math.PI/4),x=Math.cos(d+Math.PI/4);return[_,x,0]});return u}function Ag(){return rv(30)}function Mg(){return rv(4)}function Pg(){return rv(3)}function Ig(){return rv(6,1)}function Og(){return rv(5)}var pd=(Ac={},(0,C.Z)(Ac,Rp.CIRCLE,Ag),(0,C.Z)(Ac,Rp.HEXAGON,Ig),(0,C.Z)(Ac,Rp.TRIANGLE,Pg),(0,C.Z)(Ac,Rp.SQUARE,Mg),(0,C.Z)(Ac,Rp.PENTAGON,Og),(0,C.Z)(Ac,Op.CYLINDER,Ag),(0,C.Z)(Ac,Op.HEXAGONCOLUMN,Ig),(0,C.Z)(Ac,Op.TRIANGLECOLUMN,Pg),(0,C.Z)(Ac,Op.SQUARECOLUMN,Mg),(0,C.Z)(Ac,Op.PENTAGONCOLUMN,Og),Ac),Uv={};function Rg(e){var n=Ip(e.coordinates);return{vertices:[].concat((0,we.Z)(n),(0,we.Z)(n),(0,we.Z)(n),(0,we.Z)(n)),indices:[0,1,2,2,3,0],size:n.length}}function EE(e){var n=Ip(e.coordinates),r=Sg(n);return{vertices:[].concat((0,we.Z)(r),(0,we.Z)(r),(0,we.Z)(r),(0,we.Z)(r)),indices:[0,1,2,2,3,0],size:r.length}}function Lg(e){var n=e.shape,r=ME(n,!1),i=r.positions,o=r.index,u=r.normals;return{vertices:i,indices:o,normals:u,size:5}}function kg(e){var n=Ip(e.coordinates);return{vertices:(0,we.Z)(n),indices:[0],size:n.length}}function SE(e){var n=e.coordinates,r=e.originCoordinates,i=e.version,o=new gE({dash:!0,join:"bevel"});if(i==="GAODE2.x"){var u=n;Array.isArray(u[0][0])||(u=[n]);var d=r;Array.isArray(d[0][0])||(d=[r]);for(var _=0;_<u.length;_++){var x=u[_],E=d[_];o.extrude_gaode2(x,E)}}else{var P=n;Array.isArray(P[0][0])||(P=[n]),P.forEach(function(D){o.extrude(D)})}var I=o.complex;return{vertices:I.positions,indices:I.indices,normals:I.normals,size:6}}function wE(e){var n=e.coordinates,r=Ff().flatten(n),i=r.vertices,o=r.dimensions,u=r.holes;return{indices:Ff()(i,u,o),vertices:i,size:o}}function CE(e){var n=e.coordinates,r=Ff().flatten(n),i=r.vertices,o=r.dimensions,u=r.holes;return{indices:Ff()(i,u,o),vertices:TE(i),size:o+4}}function TE(e){for(var n=[],r=yE(e),i=r.center,o=r.radius,u=0;u<e.length;u+=2){var d=e[u],_=e[u+1];n.push.apply(n,[d,_,0].concat((0,we.Z)(i),[o]))}return n}function Dg(e){var n=e.coordinates,r=Tg(n,!0),i=r.positions,o=r.index,u=r.normals;return{vertices:i,indices:o,normals:u,size:5}}function Fg(e){var n=e.shape,r=IE(n),i=r.positions,o=r.index;return{vertices:i,indices:o,size:3}}function Ng(e){var n=e.coordinates,r=[].concat((0,we.Z)(n[0]),[0,0,1,n[1][0],n[0][1],0,1,1],(0,we.Z)(n[1]),[0,1,0],(0,we.Z)(n[0]),[0,0,1],(0,we.Z)(n[1]),[0,1,0,n[0][0],n[1][1],0,0,0]),i=[0,1,2,3,4,5];return{vertices:r,indices:i,size:5}}function Zv(e,n){for(var r=n||30,i=e.coordinates,o=[],u=[],d=function(E){o.push(E,1,E,i[0][0],i[0][1],i[1][0],i[1][1],E,-1,E,i[0][0],i[0][1],i[1][0],i[1][1]),E!==r-1&&u.push.apply(u,(0,we.Z)([0,1,2,1,3,2].map(function(P){return E*2+P})))},_=0;_<r;_++)d(_);return{vertices:o,indices:u,size:7}}function AE(e){var n=e.coordinates;n.length===2&&n.push(0);var r=e.size,i=Vv(-1,1),o=Vv(1,1),u=Vv(-1,-1),d=Vv(1,-1),_=[].concat((0,we.Z)(n),(0,we.Z)(i),(0,we.Z)(n),(0,we.Z)(u),(0,we.Z)(n),(0,we.Z)(d),(0,we.Z)(n),(0,we.Z)(o)),x=[0,1,2,3,0,2];return{vertices:_,indices:x,size:5}}function ME(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(Uv&&Uv[e])return Uv[e];var r=pd[e]?pd[e]():pd.cylinder(),i=Tg([r],n);return Uv[e]=i,i}function hP(e,n){for(var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,o=new Float32Array(e.length/r*3),u,d,_,x=vec3.create(),E=vec3.create(),P=vec3.create(),I=0,D=n.length;I<D;I+=3){u=n[I+0]*3,d=n[I+1]*3,_=n[I+2]*3;var Z=[e[u],e[u+1]],re=[e[d],e[d+1]],oe=[e[_],e[_+1]];i&&(Z=lngLatToMeters(Z),re=lngLatToMeters(re),oe=lngLatToMeters(oe));var de=Z,Fe=_slicedToArray(de,2),it=Fe[0],vt=Fe[1],xt=vec3.fromValues(it,vt,e[u+2]),Gt=re,Xt=_slicedToArray(Gt,2),nr=Xt[0],mr=Xt[1],en=vec3.fromValues(nr,mr,e[d+2]),hn=oe,wr=_slicedToArray(hn,2),Pn=wr[0],jn=wr[1],yi=vec3.fromValues(Pn,jn,e[_+2]);vec3.sub(x,yi,en),vec3.sub(E,xt,en),vec3.cross(P,x,E),o[u]+=x[0],o[u+1]+=x[1],o[u+2]+=x[2],o[d]+=x[0],o[d+1]+=x[1],o[d+2]+=x[2],o[_]+=x[0],o[_+1]+=x[1],o[_+2]+=x[2]}return PE(o),o}function PE(e){for(var n=0,r=e.length;n<r;n+=3){var i=vec3.fromValues(e[n],e[n+1],e[n+2]),o=vec3.create();vec3.normalize(o,i),e.set(o,n)}}function pP(e){var n=e[0][0],r=e[0][e[0].length-1];return n[0]===r[0]&&n[1]===r[1]}function IE(e){var n=["cylinder","triangleColumn","hexagonColumn","squareColumn"],r=pd[e]?pd[e]():pd.circle(),i=n.indexOf(e)===-1?xE([r]):_E([r]);return i}function Vv(e,n){var r=(e+1)/2,i=(n+1)/2;return[r,i]}function dP(){var e=primitiveSphere(EARTH_RADIUS,{segments:EARTH_SEGMENTS}),n=e.positionsArr,r=e.indicesArr,i=e.normalArr;return{vertices:n,indices:r,size:5,normals:i}}function vP(){var e=primitiveSphere(EARTH_RADIUS+EARTH_RADIUS_OUTER,{segments:EARTH_SEGMENTS}),n=e.positionsArr,r=e.indicesArr,i=e.normalArr;return{vertices:n,indices:r,size:5,normals:i}}function OE(e){var n=RE();return function(){var i=(0,zt.Z)(e),o;if(n){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,wn.Z)(this,o)}}function RE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var LE=`uniform float u_opacity: 1.0;
uniform vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];
uniform float u_near : 0;
uniform float u_far : 1;
varying vec4 v_Color;
varying vec2 v_texCoord;
uniform float u_Zoom : 1;
uniform float u_time;

uniform float u_circleSweep;
uniform float u_cityMinSize;
uniform vec3 u_circleSweepColor;
uniform float u_circleSweepSpeed;

varying float v_worldDis;

#pragma include "picking"

vec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {
    float s = step(hot, n);
    vec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);

    return mix(darkColor, color, s);
}
float random (vec2 st) {
    return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);
}

float LinearizeDepth()
{
    float z = gl_FragCoord.z * 2.0 - 1.0;
    return (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));
}

vec3 fog(vec3 color, vec3 fogColor, float depth){
    float fogFactor=clamp(depth,0.0,1.0);
    vec3 output_color=mix(fogColor,color,fogFactor);
    return output_color;
}

float sdRect(vec2 p, vec2 sz) {
  vec2 d = abs(p) - sz;
  float outside = length(max(d, 0.));
  float inside = min(max(d.x, d.y), 0.);
  return outside + inside;
}

void main() {
  gl_FragColor = v_Color;
  vec3 baseColor = u_baseColor.xyz;
  vec3 brightColor = u_brightColor.xyz;
  vec3 windowColor = u_windowColor.xyz;
  float targetColId = 5.;
  float depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;
  vec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);
  if(v_texCoord.x < 0.) { //\u9876\u90E8\u989C\u8272
       vec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);
       gl_FragColor = vec4( foggedColor, v_Color.w);
  }else { // \u4FA7\u9762\u989C\u8272
        vec2 st = v_texCoord;
        vec2  UvScale = v_texCoord;
        float tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));
        float tStart = 0.25 * tStep;
        float tEnd = 0.75 * tStep;
        float u = mod(UvScale.x, tStep);
        float v = mod(UvScale.y, tStep);
        float ux = floor(UvScale.x/tStep);
        float uy = floor(UvScale.y/tStep);
        float n = random(vec2(ux,uy));
        float lightP = u_time;
        float head = 1.0- step(0.005,st.y);
        /*step3*/
        // \u5C06\u7A97\u6237\u989C\u8272\u548C\u5899\u9762\u989C\u8272\u533A\u522B\u5F00\u6765
        float sU = step(tStart, u) - step(tEnd, u);
        float sV = step(tStart, v) - step(tEnd, v);
        vec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));
        float dist = sdRect(vec2(u,v), windowSize);
        float s = sU * sV;

        float curColId = floor(UvScale.x / tStep);
        float sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);

        float mLightP = mod(lightP, 2.);
        float sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);
        if(ux == targetColId){
            n =0.;
        }
        float timeP = min(0.75, abs ( sin(u_time/3.0) ) );
        float hot = smoothstep(1.0,0.0,timeP);
        vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);
        //vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), 1.0);
        float sFinal = s * sCol * sRow;
        color += mix(baseColor, brightColor, sFinal*n);
        if (st.y<0.01){
        color = baseColor;
         }
        if(head ==1.0) { // \u9876\u90E8\u4EAE\u7EBF
            color = brightColor;
        }
        color = color * v_Color.rgb;

        vec3 foggedColor = fog(color,fogColor,depth);

        gl_FragColor = vec4(foggedColor,1.0);
  }


  if(u_circleSweep > 0.0 && v_worldDis < u_cityMinSize) {
    float r = fract(((v_worldDis/u_cityMinSize) - u_time * u_circleSweepSpeed) * 2.0);
    gl_FragColor.rgb += r * r * u_circleSweepColor;
  }
   
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,kE=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

attribute vec2 a_Uv;
varying vec2 v_texCoord;

varying vec4 v_Color;
uniform mat4 u_Mvp;

uniform float u_circleSweep;
uniform vec2 u_cityCenter;

varying float v_worldDis;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"


void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

   v_texCoord = a_Uv;

  if(u_circleSweep > 0.0) {
     vec2 lnglatscale = vec2(0.0);
    if(u_CoordinateSystem != COORDINATE_SYSTEM_P20_2) {
      lnglatscale = (a_Position.xy - u_cityCenter) * vec2(0.0, 0.135);
    }
    v_worldDis = length(a_Position.xy + lnglatscale - u_cityCenter);
  }
 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,DE=function(e){(0,Yr.Z)(r,e);var n=OE(r);function r(){var i;(0,Ct.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return i=n.call.apply(n,[this].concat(u)),(0,C.Z)((0,be.Z)(i),"cityCenter",void 0),(0,C.Z)((0,be.Z)(i),"cityMinSize",void 0),i}return(0,qt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,d=u===void 0?1:u,_=o.baseColor,x=_===void 0?"rgb(16,16,16)":_,E=o.brightColor,P=E===void 0?"rgb(255,176,38)":E,I=o.windowColor,D=I===void 0?"rgb(30,60,89)":I,Z=o.time,re=Z===void 0?0:Z,oe=o.sweep,de=oe===void 0?{enable:!1,sweepRadius:1,sweepColor:"rgb(255, 255, 255)",sweepSpeed:.4}:oe;return{u_cityCenter:this.cityCenter,u_cityMinSize:this.cityMinSize*de.sweepRadius,u_circleSweep:de.enable?1:0,u_circleSweepColor:to(de.sweepColor).slice(0,3),u_circleSweepSpeed:de.sweepSpeed,u_opacity:d,u_baseColor:to(x),u_brightColor:to(P),u_windowColor:to(D),u_time:this.layer.getLayerAnimateTime()||re}}},{key:"calCityGeo",value:function(){var o=(0,An.Z)(this.layer.getSource().extent,4),u=o[0],d=o[1],_=o[2],x=o[3];if(this.mapService.version==="GAODE2.x"){this.cityCenter=this.mapService.lngLatToCoord([(_+u)/2,(x+d)/2]);var E=this.mapService.lngLatToCoord([_,x]),P=this.mapService.lngLatToCoord([u,d]);this.cityMinSize=Math.sqrt(Math.pow(E[0]-P[0],2)+Math.pow(E[1]-P[1],2))/4}else{var I=_-u,D=x-d;this.cityCenter=[(_+u)/2,(x+d)/2],this.cityMinSize=Math.sqrt(Math.pow(I,2)+Math.pow(D,2))/4}}},{key:"initModels",value:function(){return this.calCityGeo(),this.startModelAnimate(),[this.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:kE,fragmentShader:LE,triangulation:Dg})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:wi.Attribute,descriptor:{name:"a_Normal",buffer:{usage:m.STATIC_DRAW,data:[],type:m.FLOAT},size:3,update:function(u,d,_,x,E){return E}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:wi.Attribute,descriptor:{name:"a_Size",buffer:{usage:m.DYNAMIC_DRAW,data:[],type:m.FLOAT},size:1,update:function(u,d,_,x){var E=u.size,P=E===void 0?10:E;return Array.isArray(P)?[P[0]]:[P]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:wi.Attribute,descriptor:{name:"a_Uv",buffer:{usage:m.DYNAMIC_DRAW,data:[],type:m.FLOAT},size:2,update:function(u,d,_,x){var E=u.size;return[_[3],_[4]]}}})}}]),r}(Us);function FE(e){var n=NE();return function(){var i=(0,zt.Z)(e),o;if(n){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,wn.Z)(this,o)}}function NE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var BE=function(e){(0,Yr.Z)(r,e);var n=FE(r);function r(){var i;(0,Ct.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return i=n.call.apply(n,[this].concat(u)),(0,C.Z)((0,be.Z)(i),"type","PolygonLayer"),i}return(0,qt.Z)(r,[{key:"buildModels",value:function(){this.layerModel=new DE(this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"setLight",value:function(o){this.updateLayerConfig({time:o})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){return"citybuilding"}}]),r}(Pp);function zE(e){var n=UE();return function(){var i=(0,zt.Z)(e),o;if(n){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,wn.Z)(this,o)}}function UE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ZE=`precision highp float;\r
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807\r
attribute vec3 a_Position;\r
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807\r
attribute vec3 a_Pos;\r
attribute float a_Size;\r
attribute vec4 a_Color;\r
uniform vec2 u_radius;\r
uniform float u_coverage: 0.9;\r
uniform float u_angle: 0;\r
uniform mat4 u_ModelMatrix;\r
uniform mat4 u_Mvp;\r
varying vec4 v_color;\r
\r
uniform vec2 u_SceneCenterMKT;\r
\r
#pragma include "projection"\r
#pragma include "project"\r
#pragma include "picking"\r
\r
void main() {\r
  v_color = a_Color;\r
\r
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r
  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\r
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
  // gl_Position = project_common_position_to_clipspace(project_pos);\r
\r
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\r
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807\r
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r
    gl_Position = u_Mvp * (project_pos);\r
  } else {\r
     vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
    gl_Position = project_common_position_to_clipspace(project_pos);\r
  }\r
\r
  setPickingColor(a_PickingColor);\r
}\r
`,VE=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,jE=function(e){(0,Yr.Z)(r,e);var n=zE(r);function r(){return(0,Ct.Z)(this,r),n.apply(this,arguments)}return(0,qt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,d=o.coverage,_=o.angle;return{u_opacity:u||1,u_coverage:d||.9,u_angle:_||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"gridheatmap",vertexShader:ZE,fragmentShader:VE,triangulation:Fg,depth:{enable:!1},primitive:m.TRIANGLES,blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:wi.Attribute,descriptor:{name:"a_Pos",buffer:{usage:m.DYNAMIC_DRAW,data:[],type:m.FLOAT},size:3,update:function(u,d){var _=u.version==="GAODE2.x"?u.originCoordinates:u.coordinates;return[_[0],_[1],0]}}})}}]),r}(Us);function GE(e){var n=HE();return function(){var i=(0,zt.Z)(e),o;if(n){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,wn.Z)(this,o)}}function HE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var WE=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;

attribute vec3 a_Normal;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "light"
#pragma include "picking"


void main() {
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
  // vec2 lnglat = (a_Pos.xy + offset); 
  // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
  // gl_Position = project_common_position_to_clipspace(project_pos);
  // float lightWeight = calc_lighting(project_pos);
  // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 lnglat = (a_Pos.xy + offset); 
    // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));

    // float lightWeight = calc_lighting(project_pos);
    // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    // gl_Position = u_Mvp * vec4(lnglat , a_Position.z * a_Size, 1.0);
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u7ECF\u7EAC\u5EA6
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807
    vec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));

    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    gl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);
  } else {
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
    vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
    
    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
    
    gl_Position = project_common_position_to_clipspace(project_pos);
  }



  setPickingColor(a_PickingColor);
}
`,XE=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,YE=function(e){(0,Yr.Z)(r,e);var n=GE(r);function r(){return(0,Ct.Z)(this,r),n.apply(this,arguments)}return(0,qt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,d=o.coverage,_=o.angle;return{u_opacity:u||1,u_coverage:d||1,u_angle:_||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"grid3dheatmap",vertexShader:WE,fragmentShader:XE,triangulation:Lg,depth:{enable:!0},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:wi.Attribute,descriptor:{name:"a_Size",buffer:{usage:m.DYNAMIC_DRAW,data:[],type:m.FLOAT},size:1,update:function(u,d,_,x){var E=u.size;return Array.isArray(E)?[E[0]]:[E]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:wi.Attribute,descriptor:{name:"a_Normal",buffer:{usage:m.STATIC_DRAW,data:[],type:m.FLOAT},size:3,update:function(u,d,_,x,E){return E}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:wi.Attribute,descriptor:{name:"a_Pos",buffer:{usage:m.DYNAMIC_DRAW,data:[],type:m.FLOAT},size:3,update:function(u,d){var _=u.version==="GAODE2.x"?u.originCoordinates:u.coordinates;return[_[0],_[1],0]}}})}}]),r}(Us);function qE(e,n){for(var r=[],i=[],o=[],u=e+1,d=n+1,_=e/2,x=n/2,E=0;E<d;E++)for(var P=E-x,I=0;I<u;I++){var D=I-_;i.push(D/_,-P/x,0),o.push(I/e),o.push(1-E/n)}for(var Z=0;Z<n;Z++)for(var re=0;re<e;re++){var oe=re+u*Z,de=re+u*(Z+1),Fe=re+1+u*(Z+1),it=re+1+u*Z;r.push(oe,de,it),r.push(de,Fe,it)}return{vertices:i,indices:r,uvs:o}}var Bg,zg;function Ug(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function Zg(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Ug(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ug(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function KE(e){var n=$E();return function(){var i=(0,zt.Z)(e),o;if(n){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,wn.Z)(this,o)}}function $E(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var JE=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
   
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor = color;
    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;
     gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,QE=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
uniform mat4 u_ModelMatrix;
uniform mat4 u_InverseViewProjectionMatrix;
uniform mat4 u_ViewProjectionMatrixUncentered;
varying float v_intensity;


vec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {
    float t2 = t * t;
    float one_minus_t = 1.0 - t;
    float one_minus_t2 = one_minus_t * one_minus_t;
    return (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);
}
vec2 toBezier(float t, vec4 p){
    return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));
}
#pragma include "projection"
void main() {
  v_texCoord = a_Uv;

  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // \u5C06\u539F\u672C 0 -> 1 \u7684 uv \u8F6C\u6362\u4E3A -1 -> 1 \u7684\u6807\u51C6\u5750\u6807\u7A7A\u95F4\uFF08NDC\uFF09

  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y \u5E73\u9762\u4E0A\u7684\u70B9\uFF08z == 0\uFF09\u53EF\u4EE5\u8BA4\u4E3A\u662F\u4E09\u7EF4\u4E0A\u7684\u70B9\u88AB\u6295\u5F71\u5230\u5E73\u9762\u540E\u7684\u70B9
	vec4 p2 = vec4(pos, 1.0, 1.0); // \u5E73\u884C\u4E8Ex/y\u5E73\u9762\u3001z==1 \u7684\u5E73\u9762\u4E0A\u7684\u70B9

	vec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // \u6839\u636E\u89C6\u56FE\u6295\u5F71\u77E9\u9635\u7684\u9006\u77E9\u9635\u5E73\u9762\u4E0A\u7684\u53CD\u7B97\u51FA\u4E09\u7EF4\u7A7A\u95F4\u4E2D\u7684\u70B9\uFF08p1\u5E73\u9762\u4E0A\u7684\u70B9\uFF09
	vec4 inverseP2 = u_InverseViewProjectionMatrix * p2;

  inverseP1 = inverseP1 / inverseP1.w; // \u5F52\u4E00\u5316\u64CD\u4F5C\uFF08\u5F52\u4E00\u5316\u540E\u4E3A\u4E16\u754C\u5750\u6807\uFF09
	inverseP2 = inverseP2 / inverseP2.w;

	float zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??
	vec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);

  vec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);
  float fh;

  v_intensity = texture2D(u_texture, v_texCoord).r;
  fh = toBezier(v_intensity, b).y;
  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);
 
}
`,e2=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor =color;
    gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;

}
`,t2=`precision highp float;
uniform float u_intensity;
varying float v_weight;
varying vec2 v_extrude;
#define GAUSS_COEF  0.3989422804014327
void main(){
    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);
    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);
    gl_FragColor = vec4(val, 1., 1., 1.);
}
`,r2=`precision highp float;
attribute vec3 a_Position;
attribute float a_Size;
attribute vec2 a_Dir;
uniform float u_intensity;
uniform float u_radius;
varying vec2 v_extrude;
varying float v_weight;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#define GAUSS_COEF  0.3989422804014327

#pragma include "projection"

void main(){
    v_weight = a_Size;
    float ZERO = 1.0 / 255.0 / 16.0;
    float extrude_x = a_Dir.x * 2.0 -1.0;
    float extrude_y = a_Dir.y * 2.0 -1.0;
    vec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));
    float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 2.5;
    v_extrude = extrude_dir * S;

    vec2 offset = project_pixel(v_extrude * u_radius);
    vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

    // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));
    } else {
        gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
    }
}
`,n2=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
varying float v_intensity;
void main() {
  v_texCoord = a_Uv;
  v_intensity = texture2D(u_texture, v_texCoord).r;
  gl_Position = vec4(a_Position.xy, 0, 1.);
}
`,Vg=(Bg=(0,Fr.b2)(),Bg(zg=function(e){(0,Yr.Z)(r,e);var n=KE(r);function r(){var i;(0,Ct.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return i=n.call.apply(n,[this].concat(u)),(0,C.Z)((0,be.Z)(i),"texture",void 0),(0,C.Z)((0,be.Z)(i),"colorTexture",void 0),(0,C.Z)((0,be.Z)(i),"heatmapFramerBuffer",void 0),(0,C.Z)((0,be.Z)(i),"intensityModel",void 0),(0,C.Z)((0,be.Z)(i),"colorModel",void 0),(0,C.Z)((0,be.Z)(i),"shapeType",void 0),i}return(0,qt.Z)(r,[{key:"render",value:function(){var o=this,u=this.rendererService,d=u.clear,_=u.useFramebuffer;_(this.heatmapFramerBuffer,function(){d({color:[0,0,0,0],depth:1,stencil:0,framebuffer:o.heatmapFramerBuffer}),o.drawIntensityMode()}),this.layer.styleNeedUpdate&&this.updateColorTexture(),this.shapeType==="heatmap"?this.drawColorMode():this.draw3DHeatMap()}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){var o,u=this.rendererService,d=u.createFramebuffer,_=u.clear,x=u.getViewportSize,E=u.createTexture2D,P=u.useFramebuffer,I=this.styleAttributeService.getLayerStyleAttribute("shape"),D=(I==null||(o=I.scale)===null||o===void 0?void 0:o.field)||"heatmap";this.shapeType=D,this.intensityModel=this.buildHeatMapIntensity(),this.colorModel=D==="heatmap"?this.buildHeatmapColor():this.build3dHeatMap();var Z=x(),re=Z.width,oe=Z.height;return this.heatmapFramerBuffer=d({color:E({width:Math.floor(re/4),height:Math.floor(oe/4),wrapS:m.CLAMP_TO_EDGE,wrapT:m.CLAMP_TO_EDGE,min:m.LINEAR,mag:m.LINEAR}),depth:!1}),this.updateColorTexture(),[this.intensityModel,this.colorModel]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:wi.Attribute,descriptor:{name:"a_Dir",buffer:{usage:m.DYNAMIC_DRAW,data:[],type:m.FLOAT},size:2,update:function(u,d,_,x){return[_[3],_[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:wi.Attribute,descriptor:{name:"a_Size",buffer:{usage:m.DYNAMIC_DRAW,data:[],type:m.FLOAT},size:1,update:function(u,d,_,x){var E=u.size,P=E===void 0?1:E;return[P]}}})}},{key:"buildHeatMapIntensity",value:function(){return this.layer.buildLayerModel({moduleName:"heatmapintensity",vertexShader:r2,fragmentShader:t2,triangulation:AE,depth:{enable:!1},blend:{enable:!0,func:{srcRGB:m.ONE,srcAlpha:1,dstRGB:m.ONE,dstAlpha:1}}})}},{key:"buildHeatmapColor",value:function(){this.shaderModuleService.registerModule("heatmapColor",{vs:n2,fs:e2});var o=this.shaderModuleService.getModule("heatmapColor"),u=o.vs,d=o.fs,_=o.uniforms,x=this.rendererService,E=x.createAttribute,P=x.createElements,I=x.createBuffer,D=x.createModel;return D({vs:u,fs:d,attributes:{a_Position:E({buffer:I({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:m.FLOAT}),size:3}),a_Uv:E({buffer:I({data:[0,1,1,1,0,0,1,0],type:m.FLOAT}),size:2})},uniforms:Zg({},_),depth:{enable:!1},blend:this.getBlend(),count:6,elements:P({data:[0,2,1,2,3,1],type:m.UNSIGNED_INT,count:6})})}},{key:"drawIntensityMode",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,d=o.intensity,_=d===void 0?10:d,x=o.radius,E=x===void 0?5:x;this.intensityModel.draw({uniforms:{u_opacity:u||1,u_radius:E,u_intensity:_}})}},{key:"drawColorMode",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity;this.colorModel.draw({uniforms:{u_opacity:u||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer}})}},{key:"draw3DHeatMap",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,d=Ss();rh(d,this.cameraService.getViewProjectionMatrixUncentered()),this.colorModel.draw({uniforms:{u_opacity:u||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:(0,we.Z)(d)}})}},{key:"build3dHeatMap",value:function(){var o=this.rendererService.getViewportSize,u=o(),d=u.width,_=u.height,x=qE(d/4,_/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:QE,fs:JE});var E=this.shaderModuleService.getModule("heatmap3dColor"),P=E.vs,I=E.fs,D=E.uniforms,Z=this.rendererService,re=Z.createAttribute,oe=Z.createElements,de=Z.createBuffer,Fe=Z.createModel;return Fe({vs:P,fs:I,attributes:{a_Position:re({buffer:de({data:x.vertices,type:m.FLOAT}),size:3}),a_Uv:re({buffer:de({data:x.uvs,type:m.FLOAT}),size:2})},primitive:m.TRIANGLES,uniforms:Zg({},D),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:m.SRC_ALPHA,srcAlpha:1,dstRGB:m.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:oe({data:x.indices,type:m.UNSIGNED_INT,count:x.indices.length})})}},{key:"updateStyle",value:function(){this.updateColorTexture()}},{key:"updateColorTexture",value:function(){var o=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var u=this.layer.getLayerConfig(),d=u.rampColors,_=Ta(d);this.colorTexture=o({data:new Uint8Array(_.data),width:_.width,height:_.height,wrapS:m.CLAMP_TO_EDGE,wrapT:m.CLAMP_TO_EDGE,min:m.NEAREST,mag:m.NEAREST,flipY:!1})}}]),r}(Us))||zg);function i2(e){var n=a2();return function(){var i=(0,zt.Z)(e),o;if(n){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,wn.Z)(this,o)}}function a2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var o2=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,s2=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

void main() {
  v_color = a_Color;
    
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);
 
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy, 0., 1.0));
    // gl_Position = u_Mvp * (vec4(a_Pos.xy + offset, 0., 1.0));
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT;
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));
    gl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,u2=function(e){(0,Yr.Z)(r,e);var n=i2(r);function r(){return(0,Ct.Z)(this,r),n.apply(this,arguments)}return(0,qt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,d=o.coverage,_=o.angle;return{u_opacity:u||1,u_coverage:d||.9,u_angle:_||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"hexagonheatmap",vertexShader:s2,fragmentShader:o2,triangulation:Fg,depth:{enable:!1},primitive:m.TRIANGLES,blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:wi.Attribute,descriptor:{name:"a_Pos",buffer:{usage:m.DYNAMIC_DRAW,data:[],type:m.FLOAT},size:3,update:function(u,d){var _=u.version==="GAODE2.x"?u.originCoordinates:u.coordinates;return[_[0],_[1],0]}}})}}]),r}(Us),l2={heatmap:Vg,heatmap3d:Vg,grid:jE,grid3d:YE,hexagon:u2},c2=l2;function f2(e){var n=h2();return function(){var i=(0,zt.Z)(e),o;if(n){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,wn.Z)(this,o)}}function h2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var p2=function(e){(0,Yr.Z)(r,e);var n=f2(r);function r(){var i;(0,Ct.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return i=n.call.apply(n,[this].concat(u)),(0,C.Z)((0,be.Z)(i),"type","HeatMapLayer"),i}return(0,qt.Z)(r,[{key:"buildModels",value:function(){var o=this.getModelType();this.layerModel=new c2[o](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"renderModels",value:function(){var o=this,u=this.getModelType();return u==="heatmap"?(this.layerModel&&this.layerModel.render(),this):(this.layerModelNeedUpdate&&(this.models=this.layerModel.buildModels(),this.layerModelNeedUpdate=!1),this.models.forEach(function(d){return d.draw({uniforms:o.layerModel.getUninforms()})}),this)}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var o,u=this.styleAttributeService.getLayerStyleAttribute("shape"),d=this.getLayerConfig(),_=d.shape3d,x=this.getSource(),E=x.data.type,P=(u==null||(o=u.scale)===null||o===void 0?void 0:o.field)||"heatmap";return P==="heatmap"||P==="heatmap3d"?"heatmap":E==="hexagon"?(_==null?void 0:_.indexOf(P))===-1?"hexagon":"grid3d":E==="grid"?(_==null?void 0:_.indexOf(P))===-1?"grid":"grid3d":"heatmap"}}]),r}(Pp);function d2(e){var n=v2();return function(){var i=(0,zt.Z)(e),o;if(n){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,wn.Z)(this,o)}}function v2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var m2=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
void main() {
  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));
  gl_FragColor = color;
  gl_FragColor.a *= u_opacity;
}
`,g2=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,y2=function(e){(0,Yr.Z)(r,e);var n=d2(r);function r(){var i;(0,Ct.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return i=n.call.apply(n,[this].concat(u)),(0,C.Z)((0,be.Z)(i),"texture",void 0),i}return(0,qt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity;return{u_opacity:u||1,u_texture:this.texture}}},{key:"initModels",value:function(){var o=this,u=this.layer.getSource(),d=this.rendererService.createTexture2D;if(this.texture=d({height:0,width:0}),$i){var _=this.layerService.sceneService.getSceneConfig().canvas,x=_.createImage();x.crossOrigin="anonymous",x.src=u.data.originData,x.onload=function(){o.texture=d({data:x,width:x.width,height:x.height}),o.layerService.updateLayerRenderList(),o.layerService.renderLayers()}}else u.data.images.then(function(E){o.texture=d({data:E[0],width:E[0].width,height:E[0].height}),o.layerService.updateLayerRenderList(),o.layerService.renderLayers()});return[this.layer.buildLayerModel({moduleName:"RasterImage",vertexShader:g2,fragmentShader:m2,triangulation:Ng,primitive:m.TRIANGLES,depth:{enable:!1},blend:this.getBlend()})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:wi.Attribute,descriptor:{name:"a_Uv",buffer:{usage:m.DYNAMIC_DRAW,data:[],type:m.FLOAT},size:2,update:function(u,d,_,x){return[_[3],_[4]]}}})}}]),r}(Us),_2={image:y2},x2=_2;function b2(e){var n=E2();return function(){var i=(0,zt.Z)(e),o;if(n){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,wn.Z)(this,o)}}function E2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var S2=function(e){(0,Yr.Z)(r,e);var n=b2(r);function r(){var i;(0,Ct.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return i=n.call.apply(n,[this].concat(u)),(0,C.Z)((0,be.Z)(i),"type","ImageLayer"),i}return(0,qt.Z)(r,[{key:"buildModels",value:function(){var o=this.getModelType();this.layerModel=new x2[o](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var o=this.getModelType(),u={image:{}};return u[o]}},{key:"getModelType",value:function(){return"image"}}]),r}(Pp);function w2(e){var n=C2();return function(){var i=(0,zt.Z)(e),o;if(n){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,wn.Z)(this,o)}}function C2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var T2=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_segmentIndex = styleMappingMat[3].r;   // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  float d_distance_ratio = styleMappingMat[3].b; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u6BD4\u4F8B

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }
  
  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  // \u5F53\u5B58\u5728\u8D34\u56FE\u65F6\u5728\u5E95\u8272\u4E0A\u8D34\u4E0A\u8D34\u56FE
  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / segmentNumber));
    // float arcRadio = smoothstep( 0.0, 1.0, d_distance_ratio);

    float count = styleMappingMat[3].g; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_aimate.x == Animate) {
      time = u_time / u_aimate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);
    float v = styleMappingMat[3].a; // \u6A2A\u5411 v
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;

    vec4 pattern = texture2D(u_texture, uv);

    if(u_aimate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_aimate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
    
  } else {
     gl_FragColor = filterColor(gl_FragColor);
  }
  // gl_FragColor = filterColor(gl_FragColor);
}`,A2=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_lineDir: 1.0;
varying vec4 v_dash_array;

uniform float u_thetaOffset: 0.314;
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;
  if(u_line_type == LineTypeDash) {
      d_distance_ratio = segmentIndex / segmentNumber;

      vec2 s = source;
      vec2 t = target;
      
      if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        s = unProjCustomCoord(source);
        t = unProjCustomCoord(target);
      }
      float total_Distance = pixelDistance(s, t) / 2.0 * PI;
      // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
      v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
  
  if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
      if(u_lineDir != 1.0) {
        d_distance_ratio = 1.0 - d_distance_ratio;
      }
  }

   styleMappingMat[3].b = d_distance_ratio;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  styleMappingMat[3].r = d_segmentIndex;

  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F

    float arcDistrance = length(source - target); // \u8D77\u59CB\u70B9\u548C\u7EC8\u70B9\u7684\u8DDD\u79BB
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      arcDistrance *= 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      // arcDistrance *= 8.0;
      arcDistrance = project_pixel_allmap(arcDistrance);
    }
    v_iconMapUV = a_iconMapUV;

    float pixelLen = project_pixel_texture(u_icon_step); // \u8D34\u56FE\u6CBF\u5F27\u7EBF\u65B9\u5411\u7684\u957F\u5EA6 - \u968F\u5730\u56FE\u7F29\u653E\u6539\u53D8
    float texCount = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
     styleMappingMat[3].g = texCount;

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size); // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB
     styleMappingMat[3].a = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,M2={solid:0,dash:1},P2=function(e){(0,Yr.Z)(r,e);var n=w2(r);function r(){var i;(0,Ct.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return i=n.call.apply(n,[this].concat(u)),(0,C.Z)((0,be.Z)(i),"texture",void 0),(0,C.Z)((0,be.Z)(i),"updateTexture",function(){var _=i.rendererService.createTexture2D;if(i.texture){i.texture.update({data:i.iconService.getCanvas()}),i.layer.render();return}i.texture=_({data:i.iconService.getCanvas(),mag:m.NEAREST,min:m.NEAREST,premultiplyAlpha:!1,width:1024,height:i.iconService.canvasHeight||128})}),i}return(0,qt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,d=o.sourceColor,_=o.targetColor,x=o.textureBlend,E=x===void 0?"normal":x,P=o.lineType,I=P===void 0?"solid":P,D=o.dashArray,Z=D===void 0?[10,5]:D,re=o.forward,oe=re===void 0?!0:re,de=o.lineTexture,Fe=de===void 0?!1:de,it=o.iconStep,vt=it===void 0?100:it,xt=o.segmentNumber,Gt=xt===void 0?30:xt,Xt=o.thetaOffset,nr=Xt===void 0?.314:Xt;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,thetaOffset:nr})){this.judgeStyleAttributes({opacity:u,thetaOffset:nr});var mr=this.layer.getEncodedData(),en=this.calDataFrame(this.cellLength,mr,this.cellProperties),hn=en.data,wr=en.width,Pn=en.height;this.rowCount=Pn,this.dataTexture=this.cellLength>0&&hn.length>0?this.createTexture2D({flipY:!0,data:hn,format:m.LUMINANCE,type:m.FLOAT,width:wr,height:Pn}):this.createTexture2D({flipY:!0,data:[1],format:m.LUMINANCE,type:m.FLOAT,width:1,height:1})}Z.length===2&&Z.push(0,0);var jn=0,yi=[0,0,0,0],Io=[0,0,0,0];return d&&_&&(yi=to(d),Io=to(_),jn=1),this.rendererService.getDirty()&&this.texture.bind(),{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_thetaOffset:io()(nr)?nr:0,u_opacity:io()(u)?u:1,u_textureBlend:E==="normal"?0:1,segmentNumber:Gt,u_line_type:M2[I||"solid"],u_dash_array:Z,u_blur:.9,u_lineDir:oe?1:-1,u_texture:this.texture,u_line_texture:Fe?1:0,u_icon_step:vt,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:jn,u_sourceColor:yi,u_targetColor:Io}}},{key:"getAnimateUniforms",value:function(){var o=this.layer.getLayerConfig(),u=o.animateOption;return{u_aimate:this.animateOption2Array(u),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var o,u;(o=this.texture)===null||o===void 0||o.destroy(),(u=this.dataTexture)===null||u===void 0||u.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var o=this.layer.getLayerConfig(),u=o.segmentNumber,d=u===void 0?30:u;return[this.layer.buildLayerModel({moduleName:"arc2dline",vertexShader:A2,fragmentShader:T2,triangulation:Zv,depth:{enable:!1},blend:this.getBlend(),segmentNumber:d})]}},{key:"registerBuiltinAttributes",value:function(){var o=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:wi.Attribute,descriptor:{name:"a_Size",buffer:{usage:m.DYNAMIC_DRAW,data:[],type:m.FLOAT},size:1,update:function(d,_,x,E){var P=d.size,I=P===void 0?1:P;return Array.isArray(I)?[I[0]]:[I]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:wi.Attribute,descriptor:{name:"a_Instance",buffer:{usage:m.STATIC_DRAW,data:[],type:m.FLOAT},size:4,update:function(d,_,x,E){return[x[3],x[4],x[5],x[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:wi.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:m.DYNAMIC_DRAW,data:[],type:m.FLOAT},size:2,update:function(d,_,x,E){var P=o.iconService.getIconMap(),I=d.texture,D=P[I]||{x:0,y:0},Z=D.x,re=D.y;return[Z,re]}}})}}]),r}(Us);function I2(e){var n=O2();return function(){var i=(0,zt.Z)(e),o;if(n){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,wn.Z)(this,o)}}function O2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var R2=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_aimate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_aimate.x == Animate) {
      time = u_time / u_aimate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_aimate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_aimate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,L2=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // TODO: + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // TODO: \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,k2={solid:0,dash:1},D2=function(e){(0,Yr.Z)(r,e);var n=I2(r);function r(){var i;(0,Ct.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return i=n.call.apply(n,[this].concat(u)),(0,C.Z)((0,be.Z)(i),"texture",void 0),(0,C.Z)((0,be.Z)(i),"updateTexture",function(){var _=i.rendererService.createTexture2D;if(i.texture){i.texture.update({data:i.iconService.getCanvas()}),i.layer.render();return}i.texture=_({data:i.iconService.getCanvas(),mag:m.NEAREST,min:m.NEAREST,premultiplyAlpha:!1,width:1024,height:i.iconService.canvasHeight||128})}),i}return(0,qt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,d=o.sourceColor,_=o.targetColor,x=o.textureBlend,E=x===void 0?"normal":x,P=o.lineType,I=P===void 0?"solid":P,D=o.dashArray,Z=D===void 0?[10,5]:D,re=o.lineTexture,oe=re===void 0?!1:re,de=o.iconStep,Fe=de===void 0?100:de,it=o.segmentNumber,vt=it===void 0?30:it,xt=o.globalArcHeight,Gt=xt===void 0?10:xt;Z.length===2&&Z.push(0,0);var Xt=0,nr=[0,0,0,0],mr=[0,0,0,0];if(d&&_&&(nr=to(d),mr=to(_),Xt=1),this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var en=this.layer.getEncodedData(),hn=this.calDataFrame(this.cellLength,en,this.cellProperties),wr=hn.data,Pn=hn.width,jn=hn.height;this.rowCount=jn,this.dataTexture=this.cellLength>0&&wr.length>0?this.createTexture2D({flipY:!0,data:wr,format:m.LUMINANCE,type:m.FLOAT,width:Pn,height:jn}):this.createTexture2D({flipY:!0,data:[1],format:m.LUMINANCE,type:m.FLOAT,width:1,height:1})}return{u_globel:this.mapService.version==="GLOBEL"?1:0,u_globel_radius:bg,u_global_height:Gt,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:io()(u)?u:1,u_textureBlend:E==="normal"?0:1,segmentNumber:vt,u_line_type:k2[I]||0,u_dash_array:Z,u_texture:this.texture,u_line_texture:oe?1:0,u_icon_step:Fe,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Xt,u_sourceColor:nr,u_targetColor:mr}}},{key:"getAnimateUniforms",value:function(){var o=this.layer.getLayerConfig(),u=o.animateOption;return{u_aimate:this.animateOption2Array(u),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var o,u;(o=this.texture)===null||o===void 0||o.destroy(),(u=this.dataTexture)===null||u===void 0||u.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var o=this.layer.getLayerConfig(),u=o.segmentNumber,d=u===void 0?30:u;return[this.layer.buildLayerModel({moduleName:"arc3Dline",vertexShader:L2,fragmentShader:R2,triangulation:Zv,blend:this.getBlend(),segmentNumber:d})]}},{key:"registerBuiltinAttributes",value:function(){var o=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:wi.Attribute,descriptor:{name:"a_Size",buffer:{usage:m.DYNAMIC_DRAW,data:[],type:m.FLOAT},size:1,update:function(d,_,x,E){var P=d.size,I=P===void 0?1:P;return Array.isArray(I)?[I[0]]:[I]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:wi.Attribute,descriptor:{name:"a_Instance",buffer:{usage:m.STATIC_DRAW,data:[],type:m.FLOAT},size:4,update:function(d,_,x,E){return[x[3],x[4],x[5],x[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:wi.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:m.DYNAMIC_DRAW,data:[],type:m.FLOAT},size:2,update:function(d,_,x,E){var P=o.iconService.getIconMap(),I=d.texture,D=P[I]||{x:0,y:0},Z=D.x,re=D.y;return[Z,re]}}})}}]),r}(Us);function F2(e){var n=N2();return function(){var i=(0,zt.Z)(e),o;if(n){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,wn.Z)(this,o)}}function N2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var B2=`#define LineTypeSolid 0.0
#define Animate 0.0

uniform float u_opacity;
uniform float u_blur : 0.9;
// varying vec2 v_normal;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float segmentNumber;
varying float v_distance_ratio;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }
  
 
  gl_FragColor.a *= u_opacity;

  if(u_aimate.x == Animate) {
      float animateSpeed = u_time / u_aimate.y; // \u8FD0\u52A8\u901F\u5EA6
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }
}`,z2=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;

uniform float u_lineDir: 1.0;

// \u504F\u79FB\u91CF
uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying float v_distance_ratio;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = u_thetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;
  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);

  v_distance_ratio = segmentIndex / segmentNumber;
  
  if(u_aimate.x == Animate && u_lineDir != 1.0) {
      v_distance_ratio = 1.0 - v_distance_ratio;
  }

  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
}
`,U2=function(e){(0,Yr.Z)(r,e);var n=F2(r);function r(){return(0,Ct.Z)(this,r),n.apply(this,arguments)}return(0,qt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,d=o.sourceColor,_=o.targetColor,x=o.forward,E=x===void 0?!0:x,P=o.segmentNumber,I=P===void 0?30:P,D=o.thetaOffset,Z=D===void 0?.314:D,re=0,oe=[0,0,0,0],de=[0,0,0,0];return d&&_&&(oe=to(d),de=to(_),re=1),{u_thetaOffset:Z,u_opacity:io()(u)?u:1,segmentNumber:I,u_blur:.9,u_lineDir:E?1:-1,u_linearColor:re,u_sourceColor:oe,u_targetColor:de}}},{key:"getAnimateUniforms",value:function(){var o=this.layer.getLayerConfig(),u=o.animateOption;return{u_aimate:this.animateOption2Array(u),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var o=this.layer.getLayerConfig(),u=o.segmentNumber,d=u===void 0?30:u;return[this.layer.buildLayerModel({moduleName:"arc2dminiline",vertexShader:z2,fragmentShader:B2,triangulation:Zv,depth:{enable:!1},blend:this.getBlend(),segmentNumber:d})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:wi.Attribute,descriptor:{name:"a_Size",buffer:{usage:m.DYNAMIC_DRAW,data:[],type:m.FLOAT},size:1,update:function(u,d,_,x){var E=u.size,P=E===void 0?1:E;return Array.isArray(P)?[P[0]]:[P]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:wi.Attribute,descriptor:{name:"a_Instance",buffer:{usage:m.STATIC_DRAW,data:[],type:m.FLOAT},size:4,update:function(u,d,_,x){return[_[3],_[4],_[5],_[6]]}}})}}]),r}(Us);function Z2(e){var n=V2();return function(){var i=(0,zt.Z)(e),o;if(n){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,wn.Z)(this,o)}}function V2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var j2=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"
#pragma include "project"
#pragma include "projection"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0;
  float d_segmentIndex = styleMappingMat[3].g;
  
  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u52A8\u753B\u6A21\u5F0F
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- smoothstep(0.0, 1.0, v_distance_ratio), u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u8D34\u56FE
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { 
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));
    // float arcRadio = d_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    float u = fract(arcRadio * count - animateSpeed * count);
    // float u = fract(arcRadio * count - animateSpeed);
    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }

    float v = styleMappingMat[3].a; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);
    
    // \u8BBE\u7F6E\u8D34\u56FE\u548C\u5E95\u8272\u7684\u53E0\u52A0\u6A21\u5F0F
    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}`,G2=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;

varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
    return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
    vec2 x = mix(source, target, ratio);
    vec2 center = mix(source, target, 0.5);
    float dSourceCenter = distance(source, center);
    float dXCenter = distance(x, center);
    return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
     float vertex_height = paraboloid(source, target, segmentRatio);

    return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
    );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 delta = source - target;
  vec2 sin_half_delta = sin(delta / 2.0);
  float a =
    sin_half_delta.y * sin_half_delta.y +
    cos(source.y) * cos(target.y) *
    sin_half_delta.x * sin_half_delta.x;
  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));
}

vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  return mid;
}
float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}

vec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    vec2 mid = midPoint(source, target);
    vec3 x = vec3(source.x, mid.x, target.x);
    vec3 y = vec3(source.y, mid.y, target.y);
    return vec2(bezier3(x ,t), bezier3(y,t));
  }else {
    if(abs(angularDist - PI) < 0.001) {
      return (1.0 - t) * source + t * target;
    }
    float a = sin((1.0 - t) * angularDist) / sin(angularDist);
    float b = sin(t * angularDist) / sin(angularDist);
    vec2 sin_source = sin(source);
    vec2 cos_source = cos(source);
    vec2 sin_target = sin(target);
    vec2 cos_target = cos(target);
    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;
    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;
    float z = a * sin_source.y + b * sin_target.y;
    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));
  }
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = radians(a_Instance.rg);
  vec2 target = radians(a_Instance.ba);
  float angularDist = getAngularDist(source, target);
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    total_Distance = total_Distance*8.0;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba);
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
  if(u_aimate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  v_distance_ratio = segmentIndex / segmentNumber;
  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));
  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));

  styleMappingMat[3].g = a_Position.x; // \u8BE5\u9876\u70B9\u5728\u5F27\u7EBF\u4E0A\u7684\u5206\u6BB5\u6392\u5E8F
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    // float mapZoomScale = u_CoordinateSystem !== COORDINATE_SYSTEM_P20_2?10000000.0:1.0;
    float d_arcDistrance = length(source - target);
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      d_arcDistrance = d_arcDistrance * 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      d_arcDistrance = project_pixel_allmap(d_arcDistrance);
    }
    float d_pixelLen = project_pixel(u_icon_step)/8.0;
    styleMappingMat[3].b = floor(d_arcDistrance/d_pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));
  }
  setPickingColor(a_PickingColor);
}

`,H2={solid:0,dash:1},W2=function(e){(0,Yr.Z)(r,e);var n=Z2(r);function r(){var i;(0,Ct.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return i=n.call.apply(n,[this].concat(u)),(0,C.Z)((0,be.Z)(i),"texture",void 0),(0,C.Z)((0,be.Z)(i),"updateTexture",function(){var _=i.rendererService.createTexture2D;if(i.texture){i.texture.update({data:i.iconService.getCanvas()}),i.layer.render();return}i.texture=_({data:i.iconService.getCanvas(),mag:m.NEAREST,min:m.NEAREST,premultiplyAlpha:!1,width:1024,height:i.iconService.canvasHeight||128})}),i}return(0,qt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,d=o.sourceColor,_=o.targetColor,x=o.textureBlend,E=x===void 0?"normal":x,P=o.lineType,I=P===void 0?"solid":P,D=o.dashArray,Z=D===void 0?[10,5]:D,re=o.lineTexture,oe=re===void 0?!1:re,de=o.iconStep,Fe=de===void 0?100:de,it=o.segmentNumber,vt=it===void 0?30:it;Z.length===2&&Z.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var xt=0,Gt=[0,0,0,0],Xt=[0,0,0,0];if(d&&_&&(Gt=to(d),Xt=to(_),xt=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var nr=this.layer.getEncodedData(),mr=this.calDataFrame(this.cellLength,nr,this.cellProperties),en=mr.data,hn=mr.width,wr=mr.height;this.rowCount=wr,this.dataTexture=this.cellLength>0&&en.length>0?this.createTexture2D({flipY:!0,data:en,format:m.LUMINANCE,type:m.FLOAT,width:hn,height:wr}):this.createTexture2D({flipY:!0,data:[1],format:m.LUMINANCE,type:m.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:io()(u)?u:1,u_textureBlend:E==="normal"?0:1,segmentNumber:vt,u_line_type:H2[I]||0,u_dash_array:Z,u_texture:this.texture,u_line_texture:oe?1:0,u_icon_step:Fe,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:xt,u_sourceColor:Gt,u_targetColor:Xt}}},{key:"getAnimateUniforms",value:function(){var o=this.layer.getLayerConfig(),u=o.animateOption;return{u_aimate:this.animateOption2Array(u),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var o,u;(o=this.texture)===null||o===void 0||o.destroy(),(u=this.dataTexture)===null||u===void 0||u.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"arc2dline",vertexShader:G2,fragmentShader:j2,triangulation:Zv,depth:{enable:!1},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var o=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:wi.Attribute,descriptor:{name:"a_Size",buffer:{usage:m.DYNAMIC_DRAW,data:[],type:m.FLOAT},size:1,update:function(d,_,x,E){var P=d.size,I=P===void 0?1:P;return Array.isArray(I)?[I[0]]:[I]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:wi.Attribute,descriptor:{name:"a_Instance",buffer:{usage:m.STATIC_DRAW,data:[],type:m.FLOAT},size:4,update:function(d,_,x,E){return[x[3],x[4],x[5],x[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:wi.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:m.DYNAMIC_DRAW,data:[],type:m.FLOAT},size:2,update:function(d,_,x,E){var P=o.iconService.getIconMap(),I=d.texture,D=P[I]||{x:0,y:0},Z=D.x,re=D.y;return[Z,re]}}})}}]),r}(Us);function X2(e){var n=Y2();return function(){var i=(0,zt.Z)(e),o;if(n){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,wn.Z)(this,o)}}function Y2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var q2=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
uniform float u_blur : 0.99;
uniform float u_line_type: 0.0;
uniform float u_opacity : 1.0;
uniform float u_textureBlend;
varying vec4 v_color;
// varying vec2 v_normal;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

// dash
uniform float u_dash_offset : 0.0;
uniform float u_dash_ratio : 0.1;
varying vec4 v_dash_array;

varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }
 // dash line
  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    float aDistance = styleMappingMat[3].g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = styleMappingMat[3].b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, vec2(u, v)));
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
     vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = (vec4(1.0, 0.0, 0.0, 1.0));
 
  // if(rV < r || rV > 1.0 - r) {
  //   gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);
  // } 
  // if(v > 0.9) {
    // gl_FragColor = vec4(0.17647, 0.43921568, 0.2, 1.0);
  // } else if(v < 0.1) {
  //   gl_FragColor = vec4(0.17647, 0.43921568, 0.2, 1.0);
  // }

  // gl_FragColor = filterColor(gl_FragColor);
}
`,K2=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;

uniform float u_vertexScale: 1.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;
varying vec4 v_dash_array;
varying vec2 v_normal;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;


uniform float u_linearColor: 0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  d_texPixelLen = project_pixel(u_icon_step);
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  if(u_line_type == LineTypeDash) {
    d_distance_ratio = a_Distance / a_Total_Distance;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;
  }
  if(u_aimate.x == Animate || u_linearColor == 1.0) {
      d_distance_ratio = a_Distance / a_Total_Distance;
  }
  v_normal = vec2(reverse_offset_normal(a_Normal) * sign(a_Miter));

  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);

  vec2 offset = project_pixel(size.xy);

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = a_Distance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  styleMappingMat[3][2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  styleMappingMat[3][3] = texV;             // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float((a_Position.z)) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy + offset, a_Size.y, 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, a_Size.y / 8.0 + h, 1.0)); // \u989D\u5916\u9664 8.0 \u662F\u4E3A\u4E86\u548Cgaode1.x\u7684\u9AD8\u5EA6\u517C\u5BB9
  } else {
    float lineHeight = a_Size.y;
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      lineHeight = lineHeight*2.0/pow(2.0, 20.0 - u_Zoom);
    }
    

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,$2={solid:0,dash:1},jg=function(e){(0,Yr.Z)(r,e);var n=X2(r);function r(){var i;(0,Ct.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return i=n.call.apply(n,[this].concat(u)),(0,C.Z)((0,be.Z)(i),"texture",void 0),(0,C.Z)((0,be.Z)(i),"updateTexture",function(){var _=i.rendererService.createTexture2D;if(i.texture){i.texture.update({data:i.iconService.getCanvas()}),i.layer.render();return}i.texture=_({data:i.iconService.getCanvas(),mag:m.NEAREST,min:m.NEAREST,premultiplyAlpha:!1,width:1024,height:i.iconService.canvasHeight||128})}),i}return(0,qt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,d=o.sourceColor,_=o.targetColor,x=o.textureBlend,E=x===void 0?"normal":x,P=o.lineType,I=P===void 0?"solid":P,D=o.dashArray,Z=D===void 0?[10,5,0,0]:D,re=o.lineTexture,oe=re===void 0?!1:re,de=o.iconStep,Fe=de===void 0?100:de,it=o.vertexHeightScale,vt=it===void 0?20:it;Z.length===2&&Z.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var xt=0,Gt=[0,0,0,0],Xt=[0,0,0,0];if(d&&_&&(Gt=to(d),Xt=to(_),xt=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var nr=this.layer.getEncodedData(),mr=this.calDataFrame(this.cellLength,nr,this.cellProperties),en=mr.data,hn=mr.width,wr=mr.height;this.rowCount=wr,this.dataTexture=this.cellLength>0&&en.length>0?this.createTexture2D({flipY:!0,data:en,format:m.LUMINANCE,type:m.FLOAT,width:hn,height:wr}):this.createTexture2D({flipY:!0,data:[1],format:m.LUMINANCE,type:m.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:io()(u)?u:1,u_textureBlend:E==="normal"?0:1,u_line_type:$2[I],u_dash_array:Z,u_texture:this.texture,u_line_texture:oe?1:0,u_icon_step:Fe,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:xt,u_sourceColor:Gt,u_targetColor:Xt,u_vertexScale:vt}}},{key:"getAnimateUniforms",value:function(){var o=this.layer.getLayerConfig(),u=o.animateOption;return{u_aimate:this.animateOption2Array(u),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var o,u;(o=this.texture)===null||o===void 0||o.destroy(),(u=this.dataTexture)===null||u===void 0||u.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"line",vertexShader:K2,fragmentShader:q2,triangulation:SE,primitive:m.TRIANGLES,blend:this.getBlend(),depth:{enable:!1}})]}},{key:"registerBuiltinAttributes",value:function(){var o=this,u=this.layer.getLayerConfig(),d=u.lineType,_=d===void 0?"solid":d;this.styleAttributeService.registerStyleAttribute({name:"distance",type:wi.Attribute,descriptor:{name:"a_Distance",buffer:{usage:m.STATIC_DRAW,data:[],type:m.FLOAT},size:1,update:function(E,P,I,D){return[I[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:wi.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:m.STATIC_DRAW,data:[],type:m.FLOAT},size:1,update:function(E,P,I,D){return[I[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:wi.Attribute,descriptor:{name:"a_Size",buffer:{usage:m.DYNAMIC_DRAW,data:[],type:m.FLOAT},size:2,update:function(E,P,I,D){var Z=E.size,re=Z===void 0?1:Z;return Array.isArray(re)?[re[0],re[1]]:[re,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:wi.Attribute,descriptor:{name:"a_Normal",buffer:{usage:m.STATIC_DRAW,data:[],type:m.FLOAT},size:3,update:function(E,P,I,D,Z){return Z}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:wi.Attribute,descriptor:{name:"a_Miter",buffer:{usage:m.STATIC_DRAW,data:[],type:m.FLOAT},size:1,update:function(E,P,I,D){return[I[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:wi.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:m.DYNAMIC_DRAW,data:[],type:m.FLOAT},size:2,update:function(E,P,I,D){var Z=o.iconService.getIconMap(),re=E.texture,oe=Z[re]||{x:0,y:0},de=oe.x,Fe=oe.y;return[de,Fe]}}})}},{key:"loadImage",value:function(o){return new Promise(function(u,d){if(o instanceof HTMLImageElement){u(o);return}var _=new Image;_.crossOrigin="anonymous",_.onload=function(){u(_)},_.onerror=function(){d(new Error("Could not load image at "+o))},_.src=o instanceof File?URL.createObjectURL(o):o})}}]),r}(Us),J2={arc:P2,arcmini:U2,arc3d:D2,greatcircle:W2,line:jg},Q2=J2;function eS(e){var n=tS();return function(){var i=(0,zt.Z)(e),o;if(n){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,wn.Z)(this,o)}}function tS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var rS=function(e){(0,Yr.Z)(r,e);var n=eS(r);function r(){var i;(0,Ct.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return i=n.call.apply(n,[this].concat(u)),(0,C.Z)((0,be.Z)(i),"type","LineLayer"),i}return(0,qt.Z)(r,[{key:"buildModels",value:function(){var o=this.getModelType();this.layerModel=new Q2[o](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var o=this.getModelType(),u={line:{},arc3d:{blend:"additive"},arc:{blend:"additive"},arcmini:{blend:"additive"},greatcircle:{blend:"additive"}};return u[o]}},{key:"getModelType",value:function(){var o,u=this.styleAttributeService.getLayerStyleAttribute("shape"),d=u==null||(o=u.scale)===null||o===void 0?void 0:o.field;return d||"line"}}]),r}(Pp);function nS(e){var n=iS();return function(){var i=(0,zt.Z)(e),o;if(n){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,wn.Z)(this,o)}}function iS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var aS=`varying vec4 v_color;
uniform float u_opacity: 1.0;

varying float v_z;
varying float v_lightWeight;

#pragma include "picking"

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_opacitylinear: 0.0;
uniform float u_opacitylinear_dir: 1.0;

void main() {
  float opacity = styleMappingMat[0][0];

  // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_z);
    gl_FragColor.rgb *= v_lightWeight;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // \u5E94\u7528\u900F\u660E\u5EA6
  gl_FragColor.a *= opacity;

  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - v_z): v_z;
  }

  // picking
  gl_FragColor = filterColor(gl_FragColor);
}
`,oS=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform float u_globel;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform float u_lightEnable: 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

varying float v_z;
varying float v_lightWeight;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  // a_Position.z \u662F\u5728\u6784\u5EFA\u7F51\u683C\u7684\u65F6\u5019\u4F20\u5165\u7684\u6807\u51C6\u503C 0 - 1\uFF0C\u5728\u63D2\u503C\u5668\u63D2\u503C\u53EF\u4EE5\u83B7\u53D6 0\uFF5E1 \u7EBF\u6027\u6E10\u53D8\u7684\u503C
  v_z = a_Position.z;

  vec2 offset = project_pixel(size.xy);

  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  vec4 pos = vec4(project_pos.xy + offset, project_pixel(size.z), 1.0);

  float lightWeight = u_lightEnable > 0.0 ? calc_lighting(pos): 1.0;
  v_lightWeight = lightWeight;
  v_color =vec4(a_Color.rgb * lightWeight, a_Color.w);

  // gl_Position = project_common_position_to_clipspace(pos);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * pos;
  } else {
    gl_Position = project_common_position_to_clipspace(pos);
  }
  
  if(u_globel > 0.0) {
    // \u5728\u5730\u7403\u6A21\u5F0F\u4E0B\uFF0C\u5C06\u539F\u672C\u5782\u76F4\u4E8E xy \u5E73\u9762\u7684\u5706\u67F1\u8C03\u6574\u59FF\u6001\u5230\u9002\u5E94\u5706\u7684\u89D2\u5EA6
    //\u65CB\u8F6C\u77E9\u9635mx\uFF0C\u521B\u5EFA\u7ED5x\u8F74\u65CB\u8F6C\u77E9\u9635
    float r = sqrt(a_Pos.z*a_Pos.z + a_Pos.x*a_Pos.x);
    float xRadian = getXRadian(a_Pos.y, r);
    float xcos = cos(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
    float xsin = sin(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
    mat4 mx = mat4(
      1,0,0,0,  
      0,xcos,-xsin,0,  
      0,xsin,xcos,0,  
      0,0,0,1);

    //\u65CB\u8F6C\u77E9\u9635my\uFF0C\u521B\u5EFA\u7ED5y\u8F74\u65CB\u8F6C\u77E9\u9635
    float yRadian = getYRadian(a_Pos.x, a_Pos.z);
    float ycos = cos(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
    float ysin = sin(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
    mat4 my = mat4(
      ycos,0,-ysin,0,  
      0,1,0,0,  
      ysin,0,ycos,0,  
      0,0,0,1);

    gl_Position = u_ViewProjectionMatrix * vec4(( my * mx *  vec4(a_Position * a_Size, 1.0)).xyz + a_Pos, 1.0);
  }

  setPickingColor(a_PickingColor);
}
`,Gg=function(e){(0,Yr.Z)(r,e);var n=nS(r);function r(){return(0,Ct.Z)(this,r),n.apply(this,arguments)}return(0,qt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,d=u===void 0?1:u,_=o.sourceColor,x=o.targetColor,E=o.opacityLinear,P=E===void 0?{enable:!1,dir:"up"}:E,I=o.lightEnable,D=I===void 0?!0:I;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:d})){this.judgeStyleAttributes({opacity:d});var Z=this.layer.getEncodedData(),re=this.calDataFrame(this.cellLength,Z,this.cellProperties),oe=re.data,de=re.width,Fe=re.height;this.rowCount=Fe,this.dataTexture=this.cellLength>0&&oe.length>0?this.createTexture2D({flipY:!0,data:oe,format:m.LUMINANCE,type:m.FLOAT,width:de,height:Fe}):this.createTexture2D({flipY:!0,data:[1],format:m.LUMINANCE,type:m.FLOAT,width:1,height:1})}var it=0,vt=[0,0,0,0],xt=[0,0,0,0];return _&&x&&(vt=to(_),xt=to(x),it=1),{u_globel:this.mapService.version==="GLOBEL"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:io()(d)?d:1,u_linearColor:it,u_sourceColor:vt,u_targetColor:xt,u_opacitylinear:Number(P.enable),u_opacitylinear_dir:P.dir==="up"?1:0,u_lightEnable:Number(D)}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var o=this.layer.getLayerConfig(),u=o.depth,d=u===void 0?!0:u;return[this.layer.buildLayerModel({moduleName:"pointExtrude2",vertexShader:oS,fragmentShader:aS,triangulation:Lg,blend:this.getBlend(),cull:{enable:!0,face:this.mapService.version==="MAPBOX"?m.FRONT:m.BACK},depth:{enable:d}})]}},{key:"clearModels",value:function(){var o;(o=this.dataTexture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){var o=this.mapService.version==="GLOBEL";this.styleAttributeService.registerStyleAttribute({name:"size",type:wi.Attribute,descriptor:{name:"a_Size",buffer:{usage:m.DYNAMIC_DRAW,data:[],type:m.FLOAT},size:3,update:function(d,_,x,E){var P=d.size;if(P){var I=[];return Array.isArray(P)&&(I=P.length===2?[P[0],P[0],P[1]]:P),Array.isArray(P)||(I=[P,P,P]),I}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:wi.Attribute,descriptor:{name:"a_Normal",buffer:{usage:m.STATIC_DRAW,data:[],type:m.FLOAT},size:3,update:function(d,_,x,E,P){return P}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:wi.Attribute,descriptor:{name:"a_Pos",buffer:{usage:m.DYNAMIC_DRAW,data:[],type:m.FLOAT},size:3,update:function(d,_){var x=Ip(d.coordinates);return o?Sg([x[0],x[1]]):[x[0],x[1],0]}}})}}]),r}(Us);function sS(e){var n=uS();return function(){var i=(0,zt.Z)(e),o;if(n){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,wn.Z)(this,o)}}function uS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var lS=`#define Animate 0.0

uniform float u_globel;
uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));

 
  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];
  float stroke_opacity = styleMappingMat[0][1];
  float strokeWidth = styleMappingMat[0][2];
  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  if(u_globel > 0.0) {
    // TODO: \u5730\u7403\u6A21\u5F0F\u4E0B\u907F\u514D\u591A\u4F59\u7247\u5143\u7ED8\u5236\uFF0C\u540C\u65F6\u4E5F\u80FD\u907F\u514D\u6709\u7528\u7247\u5143\u5728\u900F\u660E\u4E14\u91CD\u53E0\u7684\u60C5\u51B5\u4E0B\u65E0\u6CD5\u5199\u5165
    // \u4ED8\u51FA\u7684\u4EE3\u4EF7\u662F\u8FB9\u7F18\u4F1A\u6709\u4E00\u4E9B\u952F\u9F7F
    if(outer_df > antialiasblur + 0.018) discard;
  }
  float opacity_t = smoothstep(0.0, antialiasblur, outer_df); 

  float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );
  float PI = 3.14159;
  float N_RINGS = 3.0;
  float FREQ = 1.0;

  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);

  if(u_aimate.x == Animate) {
    float d = length(v_data.xy);
    float intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_aimate.z - u_aimate.y * u_time)), 0.0, 1.0);
    
    // TODO: \u6839\u636E\u53E0\u52A0\u6A21\u5F0F\u9009\u62E9\u6548\u679C
    if(u_additive > 0.0) {
      gl_FragColor *= intensity;
    } else {
      gl_FragColor = vec4(gl_FragColor.xyz, intensity);
    }
  
    // TODO: \u4F18\u5316\u5728\u6C34\u6CE2\u7EB9\u60C5\u51B5\u4E0B\u7684\u62FE\u53D6\uFF08a == 0 \u65F6\u65E0\u6CD5\u62FE\u53D6\uFF09
    if(d < 0.7) {
      gl_FragColor.a = max(gl_FragColor.a, 0.001);
    }

    if(u_additive > 0.0) {
      gl_FragColor = filterColorAnimate(gl_FragColor);
    } else {
      gl_FragColor = filterColor(gl_FragColor);
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  gl_FragColor *= opacity_t;
}
`,cS=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_globel;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

uniform float u_blur : 0.0;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  float newSize = setPickingSize(a_Size);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = strokeOpacityAndOffset.r;
  textureOffset = strokeOpacityAndOffset.g;

  vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // TODO: billboard
  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(1.0 / u_DevicePixelRatio / (newSize + u_stroke_width), u_blur);

  // construct point coords
  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);

  // vec2 offset = project_pixel(extrude * (newSize + u_stroke_width) + u_offsets);
  vec2 offset = project_pixel(extrude.xy * (newSize + u_stroke_width) + textrueOffsets);
  vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));
  }

  if(u_globel > 0.0) {
    gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1, 1.0);
  }
 
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,Hg=function(e){(0,Yr.Z)(r,e);var n=sS(r);function r(){return(0,Ct.Z)(this,r),n.apply(this,arguments)}return(0,qt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,d=u===void 0?1:u,_=o.strokeOpacity,x=_===void 0?1:_,E=o.strokeWidth,P=E===void 0?0:E,I=o.stroke,D=I===void 0?"rgba(0,0,0,0)":I,Z=o.offsets,re=Z===void 0?[0,0]:Z,oe=o.blend;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:d,strokeOpacity:x,strokeWidth:P,stroke:D,offsets:re})){this.judgeStyleAttributes({opacity:d,strokeOpacity:x,strokeWidth:P,stroke:D,offsets:re});var de=this.layer.getEncodedData(),Fe=this.calDataFrame(this.cellLength,de,this.cellProperties),it=Fe.data,vt=Fe.width,xt=Fe.height;this.rowCount=xt,this.dataTexture=this.cellLength>0&&it.length>0?this.createTexture2D({flipY:!0,data:it,format:m.LUMINANCE,type:m.FLOAT,width:vt,height:xt}):this.createTexture2D({flipY:!0,data:[1],format:m.LUMINANCE,type:m.FLOAT,width:1,height:1})}return{u_additive:oe==="additive"?1:0,u_globel:this.mapService.version==="GLOBEL"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:io()(d)?d:1,u_stroke_opacity:io()(x)?x:1,u_stroke_width:io()(P)?P:0,u_stroke_color:this.getStrokeColor(D),u_offsets:this.isOffsetStatic(re)?re:[0,0]}}},{key:"getAnimateUniforms",value:function(){var o=this.layer.getLayerConfig(),u=o.animateOption;return{u_aimate:this.animateOption2Array(u),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Rg)}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var o=this.mapService.version==="GLOBEL";return[this.layer.buildLayerModel({moduleName:"pointfill",vertexShader:cS,fragmentShader:lS,triangulation:o?EE:Rg,depth:{enable:o},blend:this.getBlend()})]}},{key:"clearModels",value:function(){var o;(o=this.dataTexture)===null||o===void 0||o.destroy()}},{key:"animateOption2Array",value:function(o){return[o.enable?0:1,o.speed||1,o.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var o=this,u=this.mapService.version==="GLOBEL";this.styleAttributeService.registerStyleAttribute({name:"extrude",type:wi.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:m.DYNAMIC_DRAW,data:[],type:m.FLOAT},size:3,update:function(_,x,E,P){var I;if(u){var D=(0,An.Z)(E,3),Z=D[0],re=D[1],oe=D[2],de=Ha.fromValues(0,0,1),Fe=Ha.fromValues(Z,0,oe),it=Z>=0?Ha.angle(de,Fe):Math.PI*2-Ha.angle(de,Fe),vt=Math.PI*2-Math.asin(re/100),xt=Ss();Rh(xt,xt,it),ws(xt,xt,vt);var Gt=Ha.fromValues(1,1,0);Ha.transformMat4(Gt,Gt,xt),Ha.normalize(Gt,Gt);var Xt=Ha.fromValues(-1,1,0);Ha.transformMat4(Xt,Xt,xt),Ha.normalize(Xt,Xt);var nr=Ha.fromValues(-1,-1,0);Ha.transformMat4(nr,nr,xt),Ha.normalize(nr,nr);var mr=Ha.fromValues(1,-1,0);Ha.transformMat4(mr,mr,xt),Ha.normalize(mr,mr),I=[].concat((0,we.Z)(Gt),(0,we.Z)(Xt),(0,we.Z)(nr),(0,we.Z)(mr))}else I=[1,1,0,-1,1,0,-1,-1,0,1,-1,0];var en=P%4*3;return[I[en],I[en+1],I[en+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:wi.Attribute,descriptor:{name:"a_Size",buffer:{usage:m.DYNAMIC_DRAW,data:[],type:m.FLOAT},size:1,update:function(_,x,E,P){var I=_.size,D=I===void 0?5:I;return Array.isArray(D)?[D[0]]:[D]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:wi.Attribute,descriptor:{name:"a_Shape",buffer:{usage:m.DYNAMIC_DRAW,data:[],type:m.FLOAT},size:1,update:function(_,x,E,P){var I=_.shape,D=I===void 0?2:I,Z=o.layer.getLayerConfig().shape2d,re=Z.indexOf(D);return[re]}}})}}]),r}(Us);function fS(e){var n=hS();return function(){var i=(0,zt.Z)(e),o;if(n){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,wn.Z)(this,o)}}function hS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var pS=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main(){
      float opacity = styleMappingMat[0][0];
      vec2 pos= v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor=texture2D(u_texture,pos);
      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }
      // gl_FragColor.a =gl_FragColor.a * u_opacity;
      gl_FragColor.a =gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,dS=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_stroke_width : 1;
uniform vec2 u_offsets;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
    }
   gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);

}
`,vS=function(e){(0,Yr.Z)(r,e);var n=fS(r);function r(){var i;(0,Ct.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return i=n.call.apply(n,[this].concat(u)),(0,C.Z)((0,be.Z)(i),"texture",void 0),i}return(0,qt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity;return{u_opacity:u||1,u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128]}}},{key:"initModels",value:function(){var o=this;return this.initIconFontGlyphs(),this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",function(){o.updateTexture(),o.layer.render()}),[this.layer.buildLayerModel({moduleName:"pointiconImage",vertexShader:dS,fragmentShader:pS,triangulation:kg,primitive:m.POINTS,depth:{enable:!1},blend:this.getBlend()})]}},{key:"clearModels",value:function(){var o;(o=this.dataTexture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){var o=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:wi.Attribute,descriptor:{name:"a_Size",buffer:{usage:m.DYNAMIC_DRAW,data:[],type:m.FLOAT},size:1,update:function(d,_,x,E){var P=d.size;return Array.isArray(P)?[P[0]]:[P]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:wi.Attribute,descriptor:{name:"a_Uv",buffer:{usage:m.DYNAMIC_DRAW,data:[],type:m.FLOAT},size:2,update:function(d,_,x,E){var P=o.fontService.mapping,I=d.shape,D=o.fontService.getGlyph(I),Z=P[D],re=Z.x,oe=Z.y;return[re,oe]}}})}},{key:"updateTexture",value:function(){var o=this.rendererService.createTexture2D,u=this.fontService.canvas;this.texture=o({data:u,mag:m.LINEAR,min:m.LINEAR,width:u.width,height:u.height})}},{key:"initIconFontGlyphs",value:function(){var o=this,u=this.layer.getLayerConfig(),d=u.fontWeight,_=d===void 0?"normal":d,x=u.fontFamily,E=x===void 0?"sans-serif":x,P=this.layer.getEncodedData(),I=[];P.forEach(function(D){var Z=D.shape,re=Z===void 0?"":Z;re=re.toString();var oe=o.fontService.getGlyph(re);I.indexOf(oe)===-1&&I.push(oe)}),this.fontService.setFontOptions({characterSet:I,fontWeight:_,fontFamily:E,fontSize:48})}}]),r}(Us);function mS(e){var n=gS();return function(){var i=(0,zt.Z)(e),o;if(n){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,wn.Z)(this,o)}}function gS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var yS=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main(){
      float opacity = styleMappingMat[0][0];
      vec2 pos= v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor=texture2D(u_texture,pos);
      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }
      // gl_FragColor.a =gl_FragColor.a * u_opacity;
      gl_FragColor.a =gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,_S=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_stroke_width : 1;
uniform vec2 u_offsets;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
    }
   gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);

}
`,Wg=function(e){(0,Yr.Z)(r,e);var n=mS(r);function r(){var i;(0,Ct.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return i=n.call.apply(n,[this].concat(u)),(0,C.Z)((0,be.Z)(i),"texture",void 0),(0,C.Z)((0,be.Z)(i),"updateTexture",function(){var _=i.rendererService.createTexture2D;if(i.texture){i.texture.update({data:i.iconService.getCanvas()}),i.layer.renderLayers();return}i.texture=_({data:i.iconService.getCanvas(),mag:m.LINEAR,min:m.LINEAR,premultiplyAlpha:!1,width:1024,height:i.iconService.canvasHeight||128})}),i}return(0,qt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,d=o.offsets,_=d===void 0?[0,0]:d;if(this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,offsets:_})){this.judgeStyleAttributes({opacity:u,offsets:_});var x=this.layer.getEncodedData(),E=this.calDataFrame(this.cellLength,x,this.cellProperties),P=E.data,I=E.width,D=E.height;this.rowCount=D,this.dataTexture=this.cellLength>0&&P.length>0?this.createTexture2D({flipY:!0,data:P,format:m.LUMINANCE,type:m.FLOAT,width:I,height:D}):this.createTexture2D({flipY:!0,data:[1],format:m.LUMINANCE,type:m.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:io()(u)?u:1,u_offsets:this.isOffsetStatic(_)?_:[0,0]}}},{key:"initModels",value:function(){return this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var o,u;(o=this.texture)===null||o===void 0||o.destroy(),(u=this.dataTexture)===null||u===void 0||u.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:_S,fragmentShader:yS,triangulation:kg,primitive:m.POINTS,depth:{enable:!1},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var o=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:wi.Attribute,descriptor:{name:"a_Size",buffer:{usage:m.DYNAMIC_DRAW,data:[],type:m.FLOAT},size:1,update:function(d,_,x,E){var P=d.size,I=P===void 0?5:P;return Array.isArray(I)?[I[0]]:[I]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:wi.Attribute,descriptor:{name:"a_Uv",buffer:{usage:m.DYNAMIC_DRAW,data:[],type:m.FLOAT},size:2,update:function(d,_,x,E){var P=o.iconService.getIconMap(),I=d.shape,D=P[I]||{x:0,y:0},Z=D.x,re=D.y;return[Z,re]}}})}}]),r}(Us);function xS(e){var n=bS();return function(){var i=(0,zt.Z)(e),o;if(n){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,wn.Z)(this,o)}}function bS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ES=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  float opacity = styleMappingMat[0][0];

  gl_FragColor = v_color;
  // gl_FragColor.a =gl_FragColor.a * u_opacity;
  gl_FragColor.a =gl_FragColor.a * opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,SS=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  // vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);
  // vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
  // gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\\
  // 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 offset = project_pixel((u_offsets));
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    // vec2 offset = project_pixel(u_offsets);
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function wS(e){var n=e.coordinates;return{vertices:(0,we.Z)(n),indices:[0],size:n.length}}var Xg=function(e){(0,Yr.Z)(r,e);var n=xS(r);function r(){return(0,Ct.Z)(this,r),n.apply(this,arguments)}return(0,qt.Z)(r,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,d=u===void 0?1:u,_=o.offsets,x=_===void 0?[0,0]:_;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:d,offsets:x})){this.judgeStyleAttributes({opacity:d,offsets:x});var E=this.layer.getEncodedData(),P=this.calDataFrame(this.cellLength,E,this.cellProperties),I=P.data,D=P.width,Z=P.height;this.rowCount=Z,this.dataTexture=this.cellLength>0&&I.length>0?this.createTexture2D({flipY:!0,data:I,format:m.LUMINANCE,type:m.FLOAT,width:D,height:Z}):this.createTexture2D({flipY:!0,data:[1],format:m.LUMINANCE,type:m.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:io()(d)?d:1,u_offsets:this.isOffsetStatic(x)?x:[0,0]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"normalpoint",vertexShader:SS,fragmentShader:ES,triangulation:wS,depth:{enable:!1},primitive:m.POINTS,blend:this.getBlend()})]}},{key:"clearModels",value:function(){var o;(o=this.dataTexture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:wi.Attribute,descriptor:{name:"a_Size",buffer:{usage:m.DYNAMIC_DRAW,data:[],type:m.FLOAT},size:1,update:function(u,d,_,x){var E=u.size,P=E===void 0?1:E;return Array.isArray(P)?[P[0]]:[P]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:qc.additive}}}]),r}(Us);function CS(e,n){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=TS(e))||n&&e&&typeof e.length=="number"){r&&(e=r);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(E){throw E},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var u=!0,d=!1,_;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return u=E.done,E},e:function(E){d=!0,_=E},f:function(){try{!u&&r.return!=null&&r.return()}finally{if(d)throw _}}}}function TS(e,n){if(!!e){if(typeof e=="string")return Yg(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Yg(e,n)}}function Yg(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}var AS=function(){function e(n,r,i){(0,Ct.Z)(this,e),(0,C.Z)(this,"boxCells",[]),(0,C.Z)(this,"xCellCount",void 0),(0,C.Z)(this,"yCellCount",void 0),(0,C.Z)(this,"boxKeys",void 0),(0,C.Z)(this,"bboxes",void 0),(0,C.Z)(this,"width",void 0),(0,C.Z)(this,"height",void 0),(0,C.Z)(this,"xScale",void 0),(0,C.Z)(this,"yScale",void 0),(0,C.Z)(this,"boxUid",void 0);var o=this.boxCells;this.xCellCount=Math.ceil(n/i),this.yCellCount=Math.ceil(r/i);for(var u=0;u<this.xCellCount*this.yCellCount;u++)o.push([]);this.boxKeys=[],this.bboxes=[],this.width=n,this.height=r,this.xScale=this.xCellCount/n,this.yScale=this.yCellCount/r,this.boxUid=0}return(0,qt.Z)(e,[{key:"insert",value:function(r,i,o,u,d){this.forEachCell(i,o,u,d,this.insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(i),this.bboxes.push(o),this.bboxes.push(u),this.bboxes.push(d)}},{key:"query",value:function(r,i,o,u,d){return this.queryHitTest(r,i,o,u,!1,d)}},{key:"hitTest",value:function(r,i,o,u,d){return this.queryHitTest(r,i,o,u,!0,d)}},{key:"insertBoxCell",value:function(r,i,o,u,d,_){this.boxCells[d].push(_)}},{key:"queryHitTest",value:function(r,i,o,u,d,_){if(o<0||r>this.width||u<0||i>this.height)return d?!1:[];var x=[];if(r<=0&&i<=0&&this.width<=o&&this.height<=u){if(d)return!0;for(var E=0;E<this.boxKeys.length;E++)x.push({key:this.boxKeys[E],x1:this.bboxes[E*4],y1:this.bboxes[E*4+1],x2:this.bboxes[E*4+2],y2:this.bboxes[E*4+3]});return _?x.filter(_):x}var P={hitTest:d,seenUids:{box:{},circle:{}}};return this.forEachCell(r,i,o,u,this.queryCell,x,P,_),d?x.length>0:x}},{key:"queryCell",value:function(r,i,o,u,d,_,x,E){var P=x.seenUids,I=this.boxCells[d];if(I!==null){var D=this.bboxes,Z=CS(I),re;try{for(Z.s();!(re=Z.n()).done;){var oe=re.value;if(!P.box[oe]){P.box[oe]=!0;var de=oe*4;if(r<=D[de+2]&&i<=D[de+3]&&o>=D[de+0]&&u>=D[de+1]&&(!E||E(this.boxKeys[oe]))){if(x.hitTest)return _.push(!0),!0;_.push({key:this.boxKeys[oe],x1:D[de],y1:D[de+1],x2:D[de+2],y2:D[de+3]})}}}}catch(Fe){Z.e(Fe)}finally{Z.f()}}return!1}},{key:"forEachCell",value:function(r,i,o,u,d,_,x,E){for(var P=this.convertToXCellCoord(r),I=this.convertToYCellCoord(i),D=this.convertToXCellCoord(o),Z=this.convertToYCellCoord(u),re=P;re<=D;re++)for(var oe=I;oe<=Z;oe++){var de=this.xCellCount*oe+re;if(d.call(this,r,i,o,u,de,_,x,E))return}}},{key:"convertToXCellCoord",value:function(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}},{key:"convertToYCellCoord",value:function(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}}]),e}(),MS=AS,PS=function(){function e(n,r){(0,Ct.Z)(this,e),(0,C.Z)(this,"width",void 0),(0,C.Z)(this,"height",void 0),(0,C.Z)(this,"grid",void 0),(0,C.Z)(this,"viewportPadding",100),(0,C.Z)(this,"screenRightBoundary",void 0),(0,C.Z)(this,"screenBottomBoundary",void 0),(0,C.Z)(this,"gridRightBoundary",void 0),(0,C.Z)(this,"gridBottomBoundary",void 0),this.width=n,this.height=r,this.viewportPadding=Math.max(n,r),this.grid=new MS(n+this.viewportPadding,r+this.viewportPadding,25),this.screenRightBoundary=n+this.viewportPadding,this.screenBottomBoundary=r+this.viewportPadding,this.gridRightBoundary=n+2*this.viewportPadding,this.gridBottomBoundary=r+2*this.viewportPadding}return(0,qt.Z)(e,[{key:"placeCollisionBox",value:function(r){var i=r.x1+r.anchorPointX+this.viewportPadding,o=r.y1+r.anchorPointY+this.viewportPadding,u=r.x2+r.anchorPointX+this.viewportPadding,d=r.y2+r.anchorPointY+this.viewportPadding;return!this.isInsideGrid(i,o,u,d)||this.grid.hitTest(i,o,u,d)?{box:[]}:{box:[i,o,u,d]}}},{key:"insertCollisionBox",value:function(r,i){var o={featureIndex:i};this.grid.insert(o,r[0],r[1],r[2],r[3])}},{key:"project",value:function(r,i,o){var u=xi(i,o,0,1),d=ts(),_=el.apply(X,(0,we.Z)(r));return lt(d,u,_),{x:(d[0]/d[3]+1)/2*this.width+this.viewportPadding,y:(-d[1]/d[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(r,i,o,u){return o>=0&&r<this.gridRightBoundary&&u>=0&&i<this.gridBottomBoundary}}]),e}();function qg(e,n){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=IS(e))||n&&e&&typeof e.length=="number"){r&&(e=r);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(E){throw E},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var u=!0,d=!1,_;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return u=E.done,E},e:function(E){d=!0,_=E},f:function(){try{!u&&r.return!=null&&r.return()}finally{if(d)throw _}}}}function IS(e,n){if(!!e){if(typeof e=="string")return Kg(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Kg(e,n)}}function Kg(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}function $g(e){var n=.5,r=.5;switch(e){case"right":case"top-right":case"bottom-right":n=1;break;case"left":case"top-left":case"bottom-left":n=0;break;default:n=.5}switch(e){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0;break;default:r=.5}return{horizontalAlign:n,verticalAlign:r}}function Jg(e,n,r,i,o){if(!!o){var u=e[i],d=u.glyph;if(d)for(var _=n[d].advance*u.scale,x=(e[i].x+_)*o,E=r;E<=i;E++)e[E].x-=x}}function Qg(e,n,r,i,o,u,d){var _=(n-r)*o,x=(-i*d+.5)*u,E=qg(e),P;try{for(E.s();!(P=E.n()).done;){var I=P.value;I.x+=_,I.y+=x}}catch(D){E.e(D)}finally{E.f()}}function OS(e,n,r,i,o,u,d){var _=-8,x=0,E=_,P=0,I=e.positionedGlyphs,D=u==="right"?1:u==="left"?0:.5,Z=I.length;r.forEach(function(it){if(it.split("").forEach(function(xt){var Gt=n[xt],Xt=0;Gt&&(I.push({glyph:xt,x,y:E+Xt,vertical:!1,scale:1,metrics:Gt}),x+=Gt.advance+d)}),I.length!==Z){var vt=x-d;P=Math.max(vt,P),Jg(I,n,Z,I.length-1,D)}x=0,E-=i+5});var re=$g(o),oe=re.horizontalAlign,de=re.verticalAlign;Qg(I,D,oe,de,P,i,r.length);var Fe=E-_;e.top+=-de*Fe,e.bottom=e.top-Fe,e.left+=-oe*P,e.right=e.left+P}function RS(e,n,r,i,o,u,d){var _=-8,x=0,E=_,P=0,I=e.positionedGlyphs,D=u==="right"?1:u==="left"?0:.5,Z=I.length;r.forEach(function(it){var vt=n[it],xt=0;if(vt&&(I.push({glyph:it,x,y:E+xt,vertical:!1,scale:1,metrics:vt}),x+=vt.advance+d),I.length!==Z){var Gt=x-d;P=Math.max(Gt,P),Jg(I,n,Z,I.length-1,D)}x=0,E-=i+5});var re=$g(o),oe=re.horizontalAlign,de=re.verticalAlign;Qg(I,D,oe,de,P,i,r.length);var Fe=E-_;e.top+=-de*Fe,e.bottom=e.top-Fe,e.left+=-oe*P,e.right=e.left+P}function LS(e,n,r,i,o,u){var d=arguments.length>6&&arguments[6]!==void 0?arguments[6]:[0,0],_=arguments.length>7?arguments[7]:void 0,x=e.split(`
`),E=[],P={positionedGlyphs:E,top:d[1],bottom:d[1],left:d[0],right:d[0],lineCount:x.length,text:e};return _?RS(P,n,x,r,i,o,u):OS(P,n,x,r,i,o,u),E.length?P:!1}function kS(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0],r=arguments.length>2?arguments[2]:void 0,i=e.positionedGlyphs,o=i===void 0?[]:i,u=[],d=qg(o),_;try{for(d.s();!(_=d.n()).done;){var x=_.value,E=x.metrics,P=4,I=E.advance*x.scale/2,D=r?[x.x+I,x.y]:[0,0],Z=r?[0,0]:[x.x+I+n[0],x.y+n[1]],re=(0-P)*x.scale-I+Z[0],oe=(0-P)*x.scale+Z[1],de=re+E.width*x.scale,Fe=oe+E.height*x.scale,it={x:re,y:oe},vt={x:de,y:oe},xt={x:re,y:Fe},Gt={x:de,y:Fe};u.push({tl:it,tr:vt,bl:xt,br:Gt,tex:E,glyphOffset:D})}}catch(Xt){d.e(Xt)}finally{d.f()}return u}function DS(e,n){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=FS(e))||n&&e&&typeof e.length=="number"){r&&(e=r);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(E){throw E},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var u=!0,d=!1,_;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return u=E.done,E},e:function(E){d=!0,_=E},f:function(){try{!u&&r.return!=null&&r.return()}finally{if(d)throw _}}}}function FS(e,n){if(!!e){if(typeof e=="string")return ey(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ey(e,n)}}function ey(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}function NS(e){var n=BS();return function(){var i=(0,zt.Z)(e),o;if(n){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,wn.Z)(this,o)}}function BS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ty=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;
// uniform float u_font_size : 24.0;
uniform float u_opacity : 1.0;
uniform vec4 u_stroke_color : [0, 0, 0, 1];
uniform float u_stroke_width : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec4 v_color;
varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  // get style data mapping
  float opacity = styleMappingMat[0][0];
  float strokeWidth = styleMappingMat[0][2];
  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  // float fontScale = u_font_size / FONT_SIZE;

  // lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  lowp float buff = (6.0 - strokeWidth / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);
  // gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), vec4(u_stroke_color.rgb, u_stroke_color.a * u_opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), vec4(textrueStroke.rgb, textrueStroke.a * opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor.a= gl_FragColor.a * alpha;
  gl_FragColor = filterColor(gl_FragColor);
}
`,ry=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;
attribute vec4 a_Color;
attribute float a_Size;
attribute float a_Rotate;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec2 v_uv;
varying float v_gamma_scale;
varying vec4 v_color;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

   vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  v_uv = a_tex / u_sdf_map_size;

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  
  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  vec4 projected_position;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
   projected_position  = u_Mvp * (vec4(a_Position.xyz, 1.0));
  } else { // else
   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`;function ny(e){var n=this,r=e.id,i=[],o=[];if(!n.glyphInfoMap||!n.glyphInfoMap[r])return{vertices:[],indices:[],size:7};var u=n.glyphInfoMap[r].centroid,d=u.length===2?[u[0],u[1],0]:u;return n.glyphInfoMap[r].glyphQuads.forEach(function(_,x){i.push.apply(i,(0,we.Z)(d).concat([_.tex.x,_.tex.y+_.tex.height,_.tl.x,_.tl.y],(0,we.Z)(d),[_.tex.x+_.tex.width,_.tex.y+_.tex.height,_.tr.x,_.tr.y],(0,we.Z)(d),[_.tex.x+_.tex.width,_.tex.y,_.br.x,_.br.y],(0,we.Z)(d),[_.tex.x,_.tex.y,_.bl.x,_.bl.y])),o.push(0+x*4,1+x*4,2+x*4,2+x*4,3+x*4,0+x*4)}),{vertices:i,indices:o,size:7}}var iy=function(e){(0,Yr.Z)(r,e);var n=NS(r);function r(){var i;(0,Ct.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return i=n.call.apply(n,[this].concat(u)),(0,C.Z)((0,be.Z)(i),"glyphInfo",void 0),(0,C.Z)((0,be.Z)(i),"glyphInfoMap",{}),(0,C.Z)((0,be.Z)(i),"texture",void 0),(0,C.Z)((0,be.Z)(i),"currentZoom",-1),(0,C.Z)((0,be.Z)(i),"extent",void 0),(0,C.Z)((0,be.Z)(i),"textureHeight",0),(0,C.Z)((0,be.Z)(i),"textCount",0),(0,C.Z)((0,be.Z)(i),"preTextStyle",{}),(0,C.Z)((0,be.Z)(i),"buildModels",function(){return i.initGlyph(),i.updateTexture(),i.filterGlyphs(),i.reBuildModel(),[i.layer.buildLayerModel({moduleName:"pointText",vertexShader:ry,fragmentShader:ty,triangulation:ny.bind((0,be.Z)(i)),depth:{enable:!1},blend:i.getBlend()})]}),i}return(0,qt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,d=u===void 0?1:u,_=o.stroke,x=_===void 0?"#fff":_,E=o.strokeWidth,P=E===void 0?0:E,I=o.textAnchor,D=I===void 0?"center":I,Z=o.textAllowOverlap,re=Z===void 0?!1:Z,oe=o.halo,de=oe===void 0?.5:oe,Fe=o.gamma,it=Fe===void 0?2:Fe,vt=this.fontService,xt=vt.canvas,Gt=vt.mapping;if(Object.keys(Gt).length!==this.textCount&&(this.updateTexture(),this.textCount=Object.keys(Gt).length),this.preTextStyle={textAnchor:D,textAllowOverlap:re},this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:d,strokeWidth:P,stroke:x})){this.judgeStyleAttributes({opacity:d,strokeWidth:P,stroke:x});var Xt=this.layer.getEncodedData(),nr=this.calDataFrame(this.cellLength,Xt,this.cellProperties),mr=nr.data,en=nr.width,hn=nr.height;this.rowCount=hn,this.dataTexture=this.cellLength>0&&mr.length>0?this.createTexture2D({flipY:!0,data:mr,format:m.LUMINANCE,type:m.FLOAT,width:en,height:hn}):this.createTexture2D({flipY:!0,data:[1],format:m.LUMINANCE,type:m.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:io()(d)?d:1,u_stroke_width:io()(P)?P:0,u_stroke_color:this.getStrokeColor(x),u_sdf_map:this.texture,u_halo_blur:de,u_gamma_scale:it,u_sdf_map_size:[xt.width,xt.height]}}},{key:"initModels",value:function(){this.layer.on("remapping",this.buildModels),this.extent=this.textExtent();var o=this.layer.getLayerConfig(),u=o.textAnchor,d=u===void 0?"center":u,_=o.textAllowOverlap,x=_===void 0?!0:_;return this.preTextStyle={textAnchor:d,textAllowOverlap:x},this.buildModels()}},{key:"needUpdate",value:function(){var o=this.layer.getLayerConfig(),u=o.textAllowOverlap,d=u===void 0?!1:u,_=this.mapService.getZoom(),x=this.mapService.getBounds(),E=bn(this.extent,x);return!d&&(Math.abs(this.currentZoom-_)>1||!E)||d!==this.preTextStyle.textAllowOverlap?(this.reBuildModel(),!0):!1}},{key:"clearModels",value:function(){var o;(o=this.dataTexture)===null||o===void 0||o.destroy(),this.layer.off("remapping",this.buildModels)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"rotate",type:wi.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:m.DYNAMIC_DRAW,data:[],type:m.FLOAT},size:1,update:function(u,d,_,x){var E=u.rotate,P=E===void 0?0:E;return Array.isArray(P)?[P[0]]:[P]}}}),this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:wi.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:m.STATIC_DRAW,data:[],type:m.FLOAT},size:2,update:function(u,d,_,x){return[_[5],_[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:wi.Attribute,descriptor:{name:"a_Size",buffer:{usage:m.DYNAMIC_DRAW,data:[],type:m.FLOAT},size:1,update:function(u,d,_,x){var E=u.size,P=E===void 0?12:E;return Array.isArray(P)?[P[0]]:[P]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:wi.Attribute,descriptor:{name:"a_tex",buffer:{usage:m.DYNAMIC_DRAW,data:[],type:m.FLOAT},size:2,update:function(u,d,_,x){return[_[3],_[4]]}}})}},{key:"textExtent",value:function(){var o=this.mapService.getBounds();return Mn(o,.5)}},{key:"initTextFont",value:function(){var o=this.layer.getLayerConfig(),u=o.fontWeight,d=u===void 0?"400":u,_=o.fontFamily,x=_===void 0?"sans-serif":_,E=this.layer.getEncodedData(),P=[];E.forEach(function(I){var D=I.shape,Z=D===void 0?"":D;Z=Z.toString();var re=DS(Z),oe;try{for(re.s();!(oe=re.n()).done;){var de=oe.value;P.indexOf(de)===-1&&P.push(de)}}catch(Fe){re.e(Fe)}finally{re.f()}}),this.fontService.setFontOptions({characterSet:P,fontWeight:d,fontFamily:x,iconfont:!1})}},{key:"initIconFontTex",value:function(){var o=this.layer.getLayerConfig(),u=o.fontWeight,d=u===void 0?"400":u,_=o.fontFamily,x=_===void 0?"sans-serif":_,E=this.layer.getEncodedData(),P=[];E.forEach(function(I){var D=I.shape,Z=D===void 0?"":D;Z="".concat(Z),P.indexOf(Z)===-1&&P.push(Z)}),this.fontService.setFontOptions({characterSet:P,fontWeight:d,fontFamily:x,iconfont:!0})}},{key:"generateGlyphLayout",value:function(o){var u=this,d=this.fontService.mapping,_=this.layer.getLayerConfig(),x=_.spacing,E=x===void 0?2:x,P=_.textAnchor,I=P===void 0?"center":P,D=this.layer.getEncodedData();this.glyphInfo=D.map(function(Z){var re=Z.shape,oe=re===void 0?"":re,de=Z.id,Fe=Z.size,it=Fe===void 0?1:Fe,vt=Z.textOffset,xt=vt===void 0?[0,0]:vt,Gt=LS(oe.toString(),d,it,I,"left",E,xt,o),Xt=kS(Gt,xt,!1);return Z.shaping=Gt,Z.glyphQuads=Xt,Z.centroid=Ip(Z.coordinates),Z.originCentroid=Z.version==="GAODE2.x"?Ip(Z.originCoordinates):Z.originCentroid=Z.centroid,u.glyphInfoMap[de]={shaping:Gt,glyphQuads:Xt,centroid:Ip(Z.coordinates)},Z})}},{key:"filterGlyphs",value:function(){var o=this,u=this.layer.getLayerConfig(),d=u.padding,_=d===void 0?[4,4]:d,x=u.textAllowOverlap,E=x===void 0?!1:x;if(!E){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var P=this.rendererService.getViewportSize(),I=P.width,D=P.height,Z=new PS(I,D),re=this.glyphInfo.filter(function(oe){var de=oe.shaping,Fe=oe.id,it=Fe===void 0?0:Fe,vt=oe.version==="GAODE2.x"?oe.originCentroid:oe.centroid,xt=oe.size,Gt=xt/24,Xt=o.mapService.lngLatToContainer(vt),nr=Z.placeCollisionBox({x1:de.left*Gt-_[0],x2:de.right*Gt+_[0],y1:de.top*Gt-_[1],y2:de.bottom*Gt+_[1],anchorPointX:Xt.x,anchorPointY:Xt.y}),mr=nr.box;return mr&&mr.length?(Z.insertCollisionBox(mr,it),!0):!1});re.forEach(function(oe){o.glyphInfoMap[oe.id]=oe})}}},{key:"initGlyph",value:function(){var o=this.layer.getLayerConfig(),u=o.iconfont,d=u===void 0?!1:u;d?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(d)}},{key:"updateTexture",value:function(){var o=this.rendererService.createTexture2D,u=this.fontService.canvas;this.textureHeight=u.height,this.texture&&this.texture.destroy(),this.texture=o({data:u,mag:m.LINEAR,min:m.LINEAR,width:u.width,height:u.height})}},{key:"reBuildModel",value:function(){this.filterGlyphs(),this.layer.models=[this.layer.buildLayerModel({moduleName:"pointText",vertexShader:ry,fragmentShader:ty,triangulation:ny.bind(this),depth:{enable:!1},blend:this.getBlend()})]}}]),r}(Us),zS={fill:Hg,image:Wg,normal:Xg,extrude:Gg,text:iy,icon:vS},US=zS;function ZS(e){var n=VS();return function(){var i=(0,zt.Z)(e),o;if(n){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,wn.Z)(this,o)}}function VS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var jS=function(e){(0,Yr.Z)(r,e);var n=ZS(r);function r(){var i;(0,Ct.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return i=n.call.apply(n,[this].concat(u)),(0,C.Z)((0,be.Z)(i),"type","PointLayer"),i}return(0,qt.Z)(r,[{key:"buildModels",value:function(){var o=this.getModelType();this.layerModel=new US[o](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var o=this.getModelType(),u={normal:{blend:"additive"},fill:{blend:"normal"},extrude:{},image:{},icon:{},text:{blend:"normal"}};return u[o]}},{key:"getModelType",value:function(){var o=this.getEncodedData(),u=this.getLayerConfig(),d=u.shape2d,_=u.shape3d,x=this.iconService.getIconMap(),E=o.find(function(I){return I.hasOwnProperty("shape")});if(E){var P=E.shape;return P==="dot"?"normal":(d==null?void 0:d.indexOf(P))!==-1?"fill":(_==null?void 0:_.indexOf(P))!==-1?"extrude":x.hasOwnProperty(P)?"image":this.fontService.getGlyph(P)!==""?"icon":"text"}else return"normal"}}]),r}(Pp);function GS(e){var n=HS();return function(){var i=(0,zt.Z)(e),o;if(n){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,wn.Z)(this,o)}}function HS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var WS=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  // gl_FragColor.a *= u_opacity;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,XS=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"
varying float v_lightWeight;

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  // gl_FragColor.a *= u_opacity;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColorWithLight(gl_FragColor, v_lightWeight);
}
`,YS=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

varying float v_lightWeight;

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  v_lightWeight = lightWeight;
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,qS=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,KS=function(e){(0,Yr.Z)(r,e);var n=GS(r);function r(){return(0,Ct.Z)(this,r),n.apply(this,arguments)}return(0,qt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,d=u===void 0?1:u;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:d})){this.judgeStyleAttributes({opacity:d});var _=this.layer.getEncodedData(),x=this.calDataFrame(this.cellLength,_,this.cellProperties),E=x.data,P=x.width,I=x.height;this.rowCount=I,this.dataTexture=this.cellLength>0&&E.length>0?this.createTexture2D({flipY:!0,data:E,format:m.LUMINANCE,type:m.FLOAT,width:P,height:I}):this.createTexture2D({flipY:!0,data:[1],format:m.LUMINANCE,type:m.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:io()(d)?d:1}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var o=this.layer.getLayerConfig(),u=o.pickLight,d=u===void 0?!1:u;return[this.layer.buildLayerModel({moduleName:"polygonExtrude",vertexShader:d?YS:qS,fragmentShader:d?XS:WS,triangulation:Dg})]}},{key:"clearModels",value:function(){var o;(o=this.dataTexture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:wi.Attribute,descriptor:{name:"a_Normal",buffer:{usage:m.STATIC_DRAW,data:[],type:m.FLOAT},size:3,update:function(u,d,_,x,E){return E}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:wi.Attribute,descriptor:{name:"a_Size",buffer:{usage:m.DYNAMIC_DRAW,data:[],type:m.FLOAT},size:1,update:function(u,d,_,x){var E=u.size,P=E===void 0?10:E;return Array.isArray(P)?[P[0]]:[P]}}})}}]),r}(Us);function $S(e){var n=JS();return function(){var i=(0,zt.Z)(e),o;if(n){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,wn.Z)(this,o)}}function JS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var QS=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,ew=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
uniform float u_opacitylinear: 0.0;
uniform float u_dir: 1.0;
varying vec3 v_linear;
varying vec2 v_pos;


void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_dir == 1.0 ? 1.0 - length(v_pos - v_linear.xy)/v_linear.z : length(v_pos - v_linear.xy)/v_linear.z;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,tw=`attribute vec4 a_Color;
attribute vec3 a_Position;



uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

uniform float u_opacitylinear: 0.0;

attribute vec3 a_linear;
varying vec3 v_linear;
varying vec2 v_pos;

void main() {
  if(u_opacitylinear > 0.0) {
    v_linear = a_linear;
    v_pos = a_Position.xy;
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}`,rw=`attribute vec4 a_Color;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}

`,nw=function(e){(0,Yr.Z)(r,e);var n=$S(r);function r(){return(0,Ct.Z)(this,r),n.apply(this,arguments)}return(0,qt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,d=u===void 0?1:u,_=o.opacityLinear,x=_===void 0?{enable:!1,dir:"in"}:_;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:d})){this.judgeStyleAttributes({opacity:d});var E=this.layer.getEncodedData(),P=this.calDataFrame(this.cellLength,E,this.cellProperties),I=P.data,D=P.width,Z=P.height;this.rowCount=Z,this.dataTexture=this.cellLength>0&&I.length>0?this.createTexture2D({flipY:!0,data:I,format:m.LUMINANCE,type:m.FLOAT,width:D,height:Z}):this.createTexture2D({flipY:!0,data:[1],format:m.LUMINANCE,type:m.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:io()(d)?d:1,u_opacitylinear:Number(x.enable),u_dir:x.dir==="in"?1:0}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var o=this.layer.getLayerConfig(),u=o.opacityLinear,d=u===void 0?{enable:!1,dir:"in"}:u;return[this.layer.buildLayerModel({moduleName:"polygon",vertexShader:d.enable?tw:rw,fragmentShader:d.enable?ew:QS,triangulation:d.enable?CE:wE,blend:this.getBlend(),depth:{enable:!1}})]}},{key:"clearModels",value:function(){var o;(o=this.dataTexture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){var o=this.layer.getLayerConfig(),u=o.opacityLinear,d=u===void 0?{enable:!1,dir:"in"}:u;d.enable&&this.styleAttributeService.registerStyleAttribute({name:"linear",type:wi.Attribute,descriptor:{name:"a_linear",buffer:{usage:m.STATIC_DRAW,data:[],type:m.FLOAT},size:3,update:function(x,E,P,I,D){return[P[3],P[4],P[5]]}}})}}]),r}(Us),iw={fill:nw,line:jg,extrude:KS,text:iy,point_fill:Hg,point_image:Wg,point_normal:Xg,point_extrude:Gg},aw=iw;function ow(e){var n=sw();return function(){var i=(0,zt.Z)(e),o;if(n){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,wn.Z)(this,o)}}function sw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ay=function(e){(0,Yr.Z)(r,e);var n=ow(r);function r(){var i;(0,Ct.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return i=n.call.apply(n,[this].concat(u)),(0,C.Z)((0,be.Z)(i),"type","PolygonLayer"),i}return(0,qt.Z)(r,[{key:"buildModels",value:function(){var o=this.getModelType();this.layerModel=new aw[o](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var o,u=this.styleAttributeService.getLayerStyleAttribute("shape"),d=u==null||(o=u.scale)===null||o===void 0?void 0:o.field;return d==="fill"?"fill":d==="extrude"?"extrude":d==="line"?"line":this.getPointModelType()}},{key:"getPointModelType",value:function(){var o=this.getEncodedData(),u=this.getLayerConfig(),d=u.shape2d,_=u.shape3d,x=this.iconService.getIconMap(),E=o.find(function(I){return I.hasOwnProperty("shape")});if(E){var P=E.shape;return P==="dot"?"point_normal":(d==null?void 0:d.indexOf(P))!==-1?"point_fill":(_==null?void 0:_.indexOf(P))!==-1?"point_extrude":x.hasOwnProperty(P)?"point_image":"text"}else return"fill"}}]),r}(Pp);function uw(e){var n=lw();return function(){var i=(0,zt.Z)(e),o;if(n){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,wn.Z)(this,o)}}function lw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var cw=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_min;
uniform float u_max;
uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
varying vec2 v_texCoord;

void main() {

  float value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;
  if (value == u_noDataValue)
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))
    gl_FragColor = vec4(0, 0, 0, 0);
  else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);
    vec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
  }


}
`,fw=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,oy=function(e){(0,Yr.Z)(r,e);var n=uw(r);function r(){var i;(0,Ct.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return i=n.call.apply(n,[this].concat(u)),(0,C.Z)((0,be.Z)(i),"texture",void 0),(0,C.Z)((0,be.Z)(i),"colorTexture",void 0),i}return(0,qt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),u=o.opacity,d=u===void 0?1:u,_=o.clampLow,x=_===void 0?!0:_,E=o.clampHigh,P=E===void 0?!0:E,I=o.noDataValue,D=I===void 0?-9999999:I,Z=o.domain,re=Z===void 0?[0,1]:Z;return this.updateColorTexure(),{u_opacity:d||1,u_texture:this.texture,u_domain:re,u_clampLow:x,u_clampHigh:typeof P!="undefined"?P:x,u_noDataValue:D,u_colorTexture:this.colorTexture}}},{key:"initModels",value:function(){var o=this.layer.getSource(),u=this.rendererService.createTexture2D,d=o.data.dataArray[0];this.texture=u({data:d.data,width:d.width,height:d.height,format:m.LUMINANCE,type:m.FLOAT});var _=this.layer.getLayerConfig(),x=_.rampColors,E=Ta(x);return this.colorTexture=u({data:E.data,width:E.width,height:E.height,flipY:!1}),[this.layer.buildLayerModel({moduleName:"RasterImageData",vertexShader:fw,fragmentShader:cw,triangulation:Ng,primitive:m.TRIANGLES,depth:{enable:!1},blend:this.getBlend()})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:wi.Attribute,descriptor:{name:"a_Uv",buffer:{usage:m.DYNAMIC_DRAW,data:[],type:m.FLOAT},size:2,update:function(u,d,_,x){return[_[3],_[4]]}}})}},{key:"updateColorTexure",value:function(){var o=this.rendererService.createTexture2D,u=this.layer.getLayerConfig(),d=u.rampColors,_=Ta(d);this.colorTexture=o({data:_.data,width:_.width,height:_.height,flipY:!1})}}]),r}(Us),hw={raster:oy,raster3d:oy},pw=hw;function dw(e){var n=vw();return function(){var i=(0,zt.Z)(e),o;if(n){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,wn.Z)(this,o)}}function vw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var mw=function(e){(0,Yr.Z)(r,e);var n=dw(r);function r(){var i;(0,Ct.Z)(this,r);for(var o=arguments.length,u=new Array(o),d=0;d<o;d++)u[d]=arguments[d];return i=n.call.apply(n,[this].concat(u)),(0,C.Z)((0,be.Z)(i),"type","RasterLayer"),i}return(0,qt.Z)(r,[{key:"buildModels",value:function(){var o=this.getModelType();this.layerModel=new pw[o](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var o=this.getModelType(),u={raster:{},raster3d:{}};return u[o]}},{key:"getModelType",value:function(){return"raster"}}]),r}(Pp),sy,uy,ly,cy,fy,nv,hy,py,dy;function vy(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function gw(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?vy(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):vy(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var yw=(sy=(0,Fr.b2)(),uy=(0,Fr.f3)($t.IGlobalConfigService),ly=(0,Fr.f3)($t.IMapService),cy=(0,Fr.f3)($t.IFontService),sy(fy=(nv=function(){function e(){(0,Ct.Z)(this,e),Bn(this,"configService",hy,this),Bn(this,"mapService",py,this),Bn(this,"fontService",dy,this)}return(0,qt.Z)(e,[{key:"apply",value:function(r,i){var o=this,u=i.styleAttributeService;r.hooks.init.tap("DataMappingPlugin",function(){o.generateMaping(r,{styleAttributeService:u})}),r.hooks.beforeRenderData.tap("DataMappingPlugin",function(){return r.dataState.dataMappingNeedUpdate=!1,o.generateMaping(r,{styleAttributeService:u}),!0}),r.hooks.beforeRender.tap("DataMappingPlugin",function(){if(!r.layerModelNeedUpdate){var d=u.getLayerStyleAttributes()||[],_=u.getLayerStyleAttribute("filter"),x=r.getSource().data.dataArray,E=d.filter(function(I){return I.needRemapping}),P=x;_!=null&&_.needRemapping&&_!==null&&_!==void 0&&_.scale&&(P=x.filter(function(I){return o.applyAttributeMapping(_,I)[0]})),E.length&&(_!=null&&_.needRemapping?(r.setEncodedData(o.mapping(d,P)),_.needRemapping=!1):r.setEncodedData(o.mapping(E,P,r.getEncodedData())),r.emit("remapping",null))}})}},{key:"generateMaping",value:function(r,i){var o=this,u=i.styleAttributeService,d=u.getLayerStyleAttributes()||[],_=u.getLayerStyleAttribute("filter"),x=r.getSource().data.dataArray,E=x;_!=null&&_.scale&&(E=x.filter(function(P){return o.applyAttributeMapping(_,P)[0]})),r.setEncodedData(this.mapping(d,E))}},{key:"mapping",value:function(r,i,o){var u=this,d=i.map(function(_,x){var E=o?o[x]:{},P=gw({id:_._id,coordinates:_.coordinates},E);return r.filter(function(I){return I.scale!==void 0}).forEach(function(I){var D=u.applyAttributeMapping(I,_);I.needRemapping=!1,I.name==="color"&&(D=D.map(function(Z){return to(Z)})),P[I.name]=Array.isArray(D)&&D.length===1?D[0]:D,I.name==="shape"&&(P.shape=u.fontService.getIconFontKey(P[I.name]))}),P});return d.length>0&&this.mapService.version==="GAODE2.x"&&(typeof d[0].coordinates[0]=="number"?d.filter(function(_){return!_.originCoordinates}).map(function(_){_.version="GAODE2.x",_.originCoordinates=pc()(_.coordinates),_.coordinates=u.mapService.lngLatToCoord(_.coordinates)}):d.filter(function(_){return!_.originCoordinates}).map(function(_){_.version="GAODE2.x",_.originCoordinates=pc()(_.coordinates),_.coordinates=u.mapService.lngLatToCoords(_.coordinates)})),d}},{key:"applyAttributeMapping",value:function(r,i){var o;if(!r.scale)return[];var u=(r==null||(o=r.scale)===null||o===void 0?void 0:o.scalers)||[],d=[];return u.forEach(function(_){var x,E=_.field;(i.hasOwnProperty(E)||((x=r.scale)===null||x===void 0?void 0:x.type)==="variable")&&d.push(i[E])}),r.mapping?r.mapping(d):[]}}]),e}(),hy=Ln(nv.prototype,"configService",[uy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),py=Ln(nv.prototype,"mapService",[ly],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dy=Ln(nv.prototype,"fontService",[cy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nv))||fy),gy,yy,_w=(gy=(0,Fr.b2)(),gy(yy=function(){function e(){(0,Ct.Z)(this,e),(0,C.Z)(this,"mapService",void 0)}return(0,qt.Z)(e,[{key:"apply",value:function(r){var i=this;this.mapService=r.getContainer().get($t.IMapService),r.hooks.init.tap("DataSourcePlugin",function(){var o=r.getSource();if(!o){var u=r.sourceOption||{data:wh,options:zp},d=u.data,_=u.options;r.setSource(new mf(d,_))}i.updateClusterData(r)}),r.hooks.beforeRenderData.tap("DataSourcePlugin",function(){var o=i.updateClusterData(r),u=r.dataState.dataSourceNeedUpdate;return r.dataState.dataSourceNeedUpdate=!1,o||u})}},{key:"updateClusterData",value:function(r){var i=r.getSource(),o=i.cluster,u=i.clusterOptions,d=u.zoom,_=d===void 0?0:d,x=u.maxZoom,E=x===void 0?16:x,P=this.mapService.getZoom()-1,I=r.dataState.dataSourceNeedUpdate;return o&&(I||Math.abs(_-P)>1)&&E>_?(i.updateClusterData(Math.floor(P)),!0):!1}}]),e}())||yy);function Mm(e,n){return e<n?-1:e>n?1:e>=n?0:NaN}function _y(e){return e.length===1&&(e=xw(e)),{left:function(n,r,i,o){for(i==null&&(i=0),o==null&&(o=n.length);i<o;){var u=i+o>>>1;e(n[u],r)<0?i=u+1:o=u}return i},right:function(n,r,i,o){for(i==null&&(i=0),o==null&&(o=n.length);i<o;){var u=i+o>>>1;e(n[u],r)>0?o=u:i=u+1}return i}}}function xw(e){return function(n,r){return Mm(e(n),r)}}var xy=_y(Mm),bw=xy.right,mP=xy.left,jv=bw;function Ew(e,n){var r=e.length,i=-1,o,u,d;if(n==null){for(;++i<r;)if((o=e[i])!=null&&o>=o)for(u=d=o;++i<r;)(o=e[i])!=null&&(u>o&&(u=o),d<o&&(d=o))}else for(;++i<r;)if((o=n(e[i],i,e))!=null&&o>=o)for(u=d=o;++i<r;)(o=n(e[i],i,e))!=null&&(u>o&&(u=o),d<o&&(d=o));return[u,d]}var by=Array.prototype,gP=by.slice,yP=by.map,Pm=Math.sqrt(50),Im=Math.sqrt(10),Om=Math.sqrt(2);function Ey(e,n,r){var i,o=-1,u,d,_;if(n=+n,e=+e,r=+r,e===n&&r>0)return[e];if((i=n<e)&&(u=e,e=n,n=u),(_=Gv(e,n,r))===0||!isFinite(_))return[];if(_>0)for(e=Math.ceil(e/_),n=Math.floor(n/_),d=new Array(u=Math.ceil(n-e+1));++o<u;)d[o]=(e+o)*_;else for(e=Math.floor(e*_),n=Math.ceil(n*_),d=new Array(u=Math.ceil(e-n+1));++o<u;)d[o]=(e-o)/_;return i&&d.reverse(),d}function Gv(e,n,r){var i=(n-e)/Math.max(0,r),o=Math.floor(Math.log(i)/Math.LN10),u=i/Math.pow(10,o);return o>=0?(u>=Pm?10:u>=Im?5:u>=Om?2:1)*Math.pow(10,o):-Math.pow(10,-o)/(u>=Pm?10:u>=Im?5:u>=Om?2:1)}function Rm(e,n,r){var i=Math.abs(n-e)/Math.max(0,r),o=Math.pow(10,Math.floor(Math.log(i)/Math.LN10)),u=i/o;return u>=Pm?o*=10:u>=Im?o*=5:u>=Om&&(o*=2),n<e?-o:o}function _P(){var e=identity,n=extent,r=sturges;function i(o){var u,d=o.length,_,x=new Array(d);for(u=0;u<d;++u)x[u]=e(o[u],u,o);var E=n(x),P=E[0],I=E[1],D=r(x,P,I);Array.isArray(D)||(D=tickStep(P,I,D),D=range(Math.ceil(P/D)*D,I,D));for(var Z=D.length;D[0]<=P;)D.shift(),--Z;for(;D[Z-1]>I;)D.pop(),--Z;var re=new Array(Z+1),oe;for(u=0;u<=Z;++u)oe=re[u]=[],oe.x0=u>0?D[u-1]:P,oe.x1=u<Z?D[u]:I;for(u=0;u<d;++u)_=x[u],P<=_&&_<=I&&re[bisect(D,_,0,Z)].push(o[u]);return re}return i.value=function(o){return arguments.length?(e=typeof o=="function"?o:constant(o),i):e},i.domain=function(o){return arguments.length?(n=typeof o=="function"?o:constant([o[0],o[1]]),i):n},i.thresholds=function(o){return arguments.length?(r=typeof o=="function"?o:Array.isArray(o)?constant(slice.call(o)):constant(o),i):r},i}function xP(e,n,r){return e=map.call(e,number).sort(ascending),Math.ceil((r-n)/(2*(quantile(e,.75)-quantile(e,.25))*Math.pow(e.length,-1/3)))}function Sw(e){return e===null?NaN:+e}function ww(e,n,r){if(r==null&&(r=Sw),!!(i=e.length)){if((n=+n)<=0||i<2)return+r(e[0],0,e);if(n>=1)return+r(e[i-1],i-1,e);var i,o=(i-1)*n,u=Math.floor(o),d=+r(e[u],u,e),_=+r(e[u+1],u+1,e);return d+(_-d)*(o-u)}}var Mc="$";function Hv(){}Hv.prototype=Sy.prototype={constructor:Hv,has:function(e){return Mc+e in this},get:function(e){return this[Mc+e]},set:function(e,n){return this[Mc+e]=n,this},remove:function(e){var n=Mc+e;return n in this&&delete this[n]},clear:function(){for(var e in this)e[0]===Mc&&delete this[e]},keys:function(){var e=[];for(var n in this)n[0]===Mc&&e.push(n.slice(1));return e},values:function(){var e=[];for(var n in this)n[0]===Mc&&e.push(this[n]);return e},entries:function(){var e=[];for(var n in this)n[0]===Mc&&e.push({key:n.slice(1),value:this[n]});return e},size:function(){var e=0;for(var n in this)n[0]===Mc&&++e;return e},empty:function(){for(var e in this)if(e[0]===Mc)return!1;return!0},each:function(e){for(var n in this)n[0]===Mc&&e(this[n],n.slice(1),this)}};function Sy(e,n){var r=new Hv;if(e instanceof Hv)e.each(function(_,x){r.set(x,_)});else if(Array.isArray(e)){var i=-1,o=e.length,u;if(n==null)for(;++i<o;)r.set(i,e[i]);else for(;++i<o;)r.set(n(u=e[i],i,e),u)}else if(e)for(var d in e)r.set(d,e[d]);return r}var Lm=Sy;function bP(){var e=[],n=[],r,i,o;function u(_,x,E,P){if(x>=e.length)return r!=null&&_.sort(r),i!=null?i(_):_;for(var I=-1,D=_.length,Z=e[x++],re,oe,de=map(),Fe,it=E();++I<D;)(Fe=de.get(re=Z(oe=_[I])+""))?Fe.push(oe):de.set(re,[oe]);return de.each(function(vt,xt){P(it,xt,u(vt,x,E,P))}),it}function d(_,x){if(++x>e.length)return _;var E,P=n[x-1];return i!=null&&x>=e.length?E=_.entries():(E=[],_.each(function(I,D){E.push({key:D,values:d(I,x)})})),P!=null?E.sort(function(I,D){return P(I.key,D.key)}):E}return o={object:function(_){return u(_,0,Cw,Tw)},map:function(_){return u(_,0,wy,Cy)},entries:function(_){return d(u(_,0,wy,Cy),0)},key:function(_){return e.push(_),o},sortKeys:function(_){return n[e.length-1]=_,o},sortValues:function(_){return r=_,o},rollup:function(_){return i=_,o}}}function Cw(){return{}}function Tw(e,n,r){e[n]=r}function wy(){return map()}function Cy(e,n,r){e.set(n,r)}function Wv(){}var Lp=Lm.prototype;Wv.prototype=Aw.prototype={constructor:Wv,has:Lp.has,add:function(e){return e+="",this[Mc+e]=e,this},remove:Lp.remove,clear:Lp.clear,values:Lp.keys,size:Lp.size,empty:Lp.empty,each:Lp.each};function Aw(e,n){var r=new Wv;if(e instanceof Wv)e.each(function(u){r.add(u)});else if(e){var i=-1,o=e.length;if(n==null)for(;++i<o;)r.add(e[i]);else for(;++i<o;)r.add(n(e[i],i,e))}return r}var EP=null,Ty=Array.prototype,Xv=Ty.map,kp=Ty.slice;function $h(e,n){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(n).domain(e);break}return this}function SP(e,n){switch(arguments.length){case 0:break;case 1:this.interpolator(e);break;default:this.interpolator(n).domain(e);break}return this}var Ay={name:"implicit"};function Yv(){var e=Lm(),n=[],r=[],i=Ay;function o(u){var d=u+"",_=e.get(d);if(!_){if(i!==Ay)return i;e.set(d,_=n.push(u))}return r[(_-1)%r.length]}return o.domain=function(u){if(!arguments.length)return n.slice();n=[],e=Lm();for(var d=-1,_=u.length,x,E;++d<_;)e.has(E=(x=u[d])+"")||e.set(E,n.push(x));return o},o.range=function(u){return arguments.length?(r=kp.call(u),o):r.slice()},o.unknown=function(u){return arguments.length?(i=u,o):i},o.copy=function(){return Yv(n,r).unknown(i)},$h.apply(o,arguments),o}function My(){var e=ordinal().unknown(void 0),n=e.domain,r=e.range,i=[0,1],o,u,d=!1,_=0,x=0,E=.5;delete e.unknown;function P(){var I=n().length,D=i[1]<i[0],Z=i[D-0],re=i[1-D];o=(re-Z)/Math.max(1,I-_+x*2),d&&(o=Math.floor(o)),Z+=(re-Z-o*(I-_))*E,u=o*(1-_),d&&(Z=Math.round(Z),u=Math.round(u));var oe=sequence(I).map(function(de){return Z+o*de});return r(D?oe.reverse():oe)}return e.domain=function(I){return arguments.length?(n(I),P()):n()},e.range=function(I){return arguments.length?(i=[+I[0],+I[1]],P()):i.slice()},e.rangeRound=function(I){return i=[+I[0],+I[1]],d=!0,P()},e.bandwidth=function(){return u},e.step=function(){return o},e.round=function(I){return arguments.length?(d=!!I,P()):d},e.padding=function(I){return arguments.length?(_=Math.min(1,x=+I),P()):_},e.paddingInner=function(I){return arguments.length?(_=Math.min(1,I),P()):_},e.paddingOuter=function(I){return arguments.length?(x=+I,P()):x},e.align=function(I){return arguments.length?(E=Math.max(0,Math.min(1,I)),P()):E},e.copy=function(){return My(n(),i).round(d).paddingInner(_).paddingOuter(x).align(E)},initRange.apply(P(),arguments)}function Py(e){var n=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return Py(n())},e}function wP(){return Py(My.apply(null,arguments).paddingInner(1))}var Mw=L(26257),Pw=L(73626);function Iw(e,n){return e=+e,n=+n,function(r){return Math.round(e*(1-r)+n*r)}}function Ow(e){return function(){return e}}function km(e){return+e}var Iy=[0,1];function Pc(e){return e}function Dm(e,n){return(n-=e=+e)?function(r){return(r-e)/n}:Ow(isNaN(n)?NaN:.5)}function Oy(e){var n=e[0],r=e[e.length-1],i;return n>r&&(i=n,n=r,r=i),function(o){return Math.max(n,Math.min(r,o))}}function Rw(e,n,r){var i=e[0],o=e[1],u=n[0],d=n[1];return o<i?(i=Dm(o,i),u=r(d,u)):(i=Dm(i,o),u=r(u,d)),function(_){return u(i(_))}}function Lw(e,n,r){var i=Math.min(e.length,n.length)-1,o=new Array(i),u=new Array(i),d=-1;for(e[i]<e[0]&&(e=e.slice().reverse(),n=n.slice().reverse());++d<i;)o[d]=Dm(e[d],e[d+1]),u[d]=r(n[d],n[d+1]);return function(_){var x=jv(e,_,1,i)-1;return u[x](o[x](_))}}function qv(e,n){return n.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function Fm(){var e=Iy,n=Iy,r=Mw.Z,i,o,u,d=Pc,_,x,E;function P(){return _=Math.min(e.length,n.length)>2?Lw:Rw,x=E=null,I}function I(D){return isNaN(D=+D)?u:(x||(x=_(e.map(i),n,r)))(i(d(D)))}return I.invert=function(D){return d(o((E||(E=_(n,e.map(i),Pw.Z)))(D)))},I.domain=function(D){return arguments.length?(e=Xv.call(D,km),d===Pc||(d=Oy(e)),P()):e.slice()},I.range=function(D){return arguments.length?(n=kp.call(D),P()):n.slice()},I.rangeRound=function(D){return n=kp.call(D),r=Iw,P()},I.clamp=function(D){return arguments.length?(d=D?Oy(e):Pc,I):d!==Pc},I.interpolate=function(D){return arguments.length?(r=D,P()):r},I.unknown=function(D){return arguments.length?(u=D,I):u},function(D,Z){return i=D,o=Z,P()}}function Ry(e,n){return Fm()(e,n)}var kw=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Kv(e){if(!(n=kw.exec(e)))throw new Error("invalid format: "+e);var n;return new Nm({fill:n[1],align:n[2],sign:n[3],symbol:n[4],zero:n[5],width:n[6],comma:n[7],precision:n[8]&&n[8].slice(1),trim:n[9],type:n[10]})}Kv.prototype=Nm.prototype;function Nm(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}Nm.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function Dw(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function $v(e,n){if((r=(e=n?e.toExponential(n-1):e.toExponential()).indexOf("e"))<0)return null;var r,i=e.slice(0,r);return[i.length>1?i[0]+i.slice(2):i,+e.slice(r+1)]}function dd(e){return e=$v(Math.abs(e)),e?e[1]:NaN}function Fw(e,n){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(dd(n)/3)))*3-dd(Math.abs(e)))}function Nw(e,n){return function(r,i){for(var o=r.length,u=[],d=0,_=e[0],x=0;o>0&&_>0&&(x+_+1>i&&(_=Math.max(1,i-x)),u.push(r.substring(o-=_,o+_)),!((x+=_+1)>i));)_=e[d=(d+1)%e.length];return u.reverse().join(n)}}function Bw(e){return function(n){return n.replace(/[0-9]/g,function(r){return e[+r]})}}function zw(e){e:for(var n=e.length,r=1,i=-1,o;r<n;++r)switch(e[r]){case".":i=o=r;break;case"0":i===0&&(i=r),o=r;break;default:if(!+e[r])break e;i>0&&(i=0);break}return i>0?e.slice(0,i)+e.slice(o+1):e}var Ly;function Uw(e,n){var r=$v(e,n);if(!r)return e+"";var i=r[0],o=r[1],u=o-(Ly=Math.max(-8,Math.min(8,Math.floor(o/3)))*3)+1,d=i.length;return u===d?i:u>d?i+new Array(u-d+1).join("0"):u>0?i.slice(0,u)+"."+i.slice(u):"0."+new Array(1-u).join("0")+$v(e,Math.max(0,n+u-1))[0]}function ky(e,n){var r=$v(e,n);if(!r)return e+"";var i=r[0],o=r[1];return o<0?"0."+new Array(-o).join("0")+i:i.length>o+1?i.slice(0,o+1)+"."+i.slice(o+1):i+new Array(o-i.length+2).join("0")}var Dy={"%":function(e,n){return(e*100).toFixed(n)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:Dw,e:function(e,n){return e.toExponential(n)},f:function(e,n){return e.toFixed(n)},g:function(e,n){return e.toPrecision(n)},o:function(e){return Math.round(e).toString(8)},p:function(e,n){return ky(e*100,n)},r:ky,s:Uw,X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function Fy(e){return e}var Ny=Array.prototype.map,By=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function Zw(e){var n=e.grouping===void 0||e.thousands===void 0?Fy:Nw(Ny.call(e.grouping,Number),e.thousands+""),r=e.currency===void 0?"":e.currency[0]+"",i=e.currency===void 0?"":e.currency[1]+"",o=e.decimal===void 0?".":e.decimal+"",u=e.numerals===void 0?Fy:Bw(Ny.call(e.numerals,String)),d=e.percent===void 0?"%":e.percent+"",_=e.minus===void 0?"-":e.minus+"",x=e.nan===void 0?"NaN":e.nan+"";function E(I){I=Kv(I);var D=I.fill,Z=I.align,re=I.sign,oe=I.symbol,de=I.zero,Fe=I.width,it=I.comma,vt=I.precision,xt=I.trim,Gt=I.type;Gt==="n"?(it=!0,Gt="g"):Dy[Gt]||(vt===void 0&&(vt=12),xt=!0,Gt="g"),(de||D==="0"&&Z==="=")&&(de=!0,D="0",Z="=");var Xt=oe==="$"?r:oe==="#"&&/[boxX]/.test(Gt)?"0"+Gt.toLowerCase():"",nr=oe==="$"?i:/[%p]/.test(Gt)?d:"",mr=Dy[Gt],en=/[defgprs%]/.test(Gt);vt=vt===void 0?6:/[gprs]/.test(Gt)?Math.max(1,Math.min(21,vt)):Math.max(0,Math.min(20,vt));function hn(wr){var Pn=Xt,jn=nr,yi,Io,Ms;if(Gt==="c")jn=mr(wr)+jn,wr="";else{wr=+wr;var sl=wr<0||1/wr<0;if(wr=isNaN(wr)?x:mr(Math.abs(wr),vt),xt&&(wr=zw(wr)),sl&&+wr==0&&re!=="+"&&(sl=!1),Pn=(sl?re==="("?re:_:re==="-"||re==="("?"":re)+Pn,jn=(Gt==="s"?By[8+Ly/3]:"")+jn+(sl&&re==="("?")":""),en){for(yi=-1,Io=wr.length;++yi<Io;)if(Ms=wr.charCodeAt(yi),48>Ms||Ms>57){jn=(Ms===46?o+wr.slice(yi+1):wr.slice(yi))+jn,wr=wr.slice(0,yi);break}}}it&&!de&&(wr=n(wr,Infinity));var Ic=Pn.length+wr.length+jn.length,Sl=Ic<Fe?new Array(Fe-Ic+1).join(D):"";switch(it&&de&&(wr=n(Sl+wr,Sl.length?Fe-jn.length:Infinity),Sl=""),Z){case"<":wr=Pn+wr+jn+Sl;break;case"=":wr=Pn+Sl+wr+jn;break;case"^":wr=Sl.slice(0,Ic=Sl.length>>1)+Pn+wr+jn+Sl.slice(Ic);break;default:wr=Sl+Pn+wr+jn;break}return u(wr)}return hn.toString=function(){return I+""},hn}function P(I,D){var Z=E((I=Kv(I),I.type="f",I)),re=Math.max(-8,Math.min(8,Math.floor(dd(D)/3)))*3,oe=Math.pow(10,-re),de=By[8+re/3];return function(Fe){return Z(oe*Fe)+de}}return{format:E,formatPrefix:P}}var Jv,Bm,zy;Vw({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function Vw(e){return Jv=Zw(e),Bm=Jv.format,zy=Jv.formatPrefix,Jv}function jw(e,n){return e=Math.abs(e),n=Math.abs(n)-e,Math.max(0,dd(n)-dd(e))+1}function Gw(e){return Math.max(0,-dd(Math.abs(e)))}function Hw(e,n,r,i){var o=Rm(e,n,r),u;switch(i=Kv(i==null?",f":i),i.type){case"s":{var d=Math.max(Math.abs(e),Math.abs(n));return i.precision==null&&!isNaN(u=Fw(o,d))&&(i.precision=u),zy(i,d)}case"":case"e":case"g":case"p":case"r":{i.precision==null&&!isNaN(u=jw(o,Math.max(Math.abs(e),Math.abs(n))))&&(i.precision=u-(i.type==="e"));break}case"f":case"%":{i.precision==null&&!isNaN(u=Gw(o))&&(i.precision=u-(i.type==="%")*2);break}}return Bm(i)}function Qv(e){var n=e.domain;return e.ticks=function(r){var i=n();return Ey(i[0],i[i.length-1],r==null?10:r)},e.tickFormat=function(r,i){var o=n();return Hw(o[0],o[o.length-1],r==null?10:r,i)},e.nice=function(r){r==null&&(r=10);var i=n(),o=0,u=i.length-1,d=i[o],_=i[u],x;return _<d&&(x=d,d=_,_=x,x=o,o=u,u=x),x=Gv(d,_,r),x>0?(d=Math.floor(d/x)*x,_=Math.ceil(_/x)*x,x=Gv(d,_,r)):x<0&&(d=Math.ceil(d*x)/x,_=Math.floor(_*x)/x,x=Gv(d,_,r)),x>0?(i[o]=Math.floor(d/x)*x,i[u]=Math.ceil(_/x)*x,n(i)):x<0&&(i[o]=Math.ceil(d*x)/x,i[u]=Math.floor(_*x)/x,n(i)),e},e}function Uy(){var e=Ry(Pc,Pc);return e.copy=function(){return qv(e,Uy())},$h.apply(e,arguments),Qv(e)}function Zy(e){var n;function r(i){return isNaN(i=+i)?n:i}return r.invert=r,r.domain=r.range=function(i){return arguments.length?(e=Xv.call(i,km),r):e.slice()},r.unknown=function(i){return arguments.length?(n=i,r):n},r.copy=function(){return Zy(e).unknown(n)},e=arguments.length?Xv.call(e,km):[0,1],Qv(r)}function Vy(e,n){e=e.slice();var r=0,i=e.length-1,o=e[r],u=e[i],d;return u<o&&(d=r,r=i,i=d,d=o,o=u,u=d),e[r]=n.floor(o),e[i]=n.ceil(u),e}function jy(e){return Math.log(e)}function Gy(e){return Math.exp(e)}function Ww(e){return-Math.log(-e)}function Xw(e){return-Math.exp(-e)}function Yw(e){return isFinite(e)?+("1e"+e):e<0?0:e}function qw(e){return e===10?Yw:e===Math.E?Math.exp:function(n){return Math.pow(e,n)}}function Kw(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),function(n){return Math.log(n)/e})}function Hy(e){return function(n){return-e(-n)}}function $w(e){var n=e(jy,Gy),r=n.domain,i=10,o,u;function d(){return o=Kw(i),u=qw(i),r()[0]<0?(o=Hy(o),u=Hy(u),e(Ww,Xw)):e(jy,Gy),n}return n.base=function(_){return arguments.length?(i=+_,d()):i},n.domain=function(_){return arguments.length?(r(_),d()):r()},n.ticks=function(_){var x=r(),E=x[0],P=x[x.length-1],I;(I=P<E)&&(D=E,E=P,P=D);var D=o(E),Z=o(P),re,oe,de,Fe=_==null?10:+_,it=[];if(!(i%1)&&Z-D<Fe){if(D=Math.round(D)-1,Z=Math.round(Z)+1,E>0){for(;D<Z;++D)for(oe=1,re=u(D);oe<i;++oe)if(de=re*oe,!(de<E)){if(de>P)break;it.push(de)}}else for(;D<Z;++D)for(oe=i-1,re=u(D);oe>=1;--oe)if(de=re*oe,!(de<E)){if(de>P)break;it.push(de)}}else it=Ey(D,Z,Math.min(Z-D,Fe)).map(u);return I?it.reverse():it},n.tickFormat=function(_,x){if(x==null&&(x=i===10?".0e":","),typeof x!="function"&&(x=Bm(x)),_===Infinity)return x;_==null&&(_=10);var E=Math.max(1,i*_/n.ticks().length);return function(P){var I=P/u(Math.round(o(P)));return I*i<i-.5&&(I*=i),I<=E?x(P):""}},n.nice=function(){return r(Vy(r(),{floor:function(_){return u(Math.floor(o(_)))},ceil:function(_){return u(Math.ceil(o(_)))}}))},n}function Wy(){var e=$w(Fm()).domain([1,10]);return e.copy=function(){return qv(e,Wy()).base(e.base())},$h.apply(e,arguments),e}function Xy(e){return function(n){return Math.sign(n)*Math.log1p(Math.abs(n/e))}}function Yy(e){return function(n){return Math.sign(n)*Math.expm1(Math.abs(n))*e}}function Jw(e){var n=1,r=e(Xy(n),Yy(n));return r.constant=function(i){return arguments.length?e(Xy(n=+i),Yy(n)):n},linearish(r)}function Qw(){var e=Jw(transformer());return e.copy=function(){return copy(e,Qw()).constant(e.constant())},initRange.apply(e,arguments)}function qy(e){return function(n){return n<0?-Math.pow(-n,e):Math.pow(n,e)}}function eC(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function tC(e){return e<0?-e*e:e*e}function rC(e){var n=e(Pc,Pc),r=1;function i(){return r===1?e(Pc,Pc):r===.5?e(eC,tC):e(qy(r),qy(1/r))}return n.exponent=function(o){return arguments.length?(r=+o,i()):r},Qv(n)}function zm(){var e=rC(Fm());return e.copy=function(){return qv(e,zm()).exponent(e.exponent())},$h.apply(e,arguments),e}function CP(){return zm.apply(null,arguments).exponent(.5)}function Ky(){var e=[],n=[],r=[],i;function o(){var d=0,_=Math.max(1,n.length);for(r=new Array(_-1);++d<_;)r[d-1]=ww(e,d/_);return u}function u(d){return isNaN(d=+d)?i:n[jv(r,d)]}return u.invertExtent=function(d){var _=n.indexOf(d);return _<0?[NaN,NaN]:[_>0?r[_-1]:e[0],_<r.length?r[_]:e[e.length-1]]},u.domain=function(d){if(!arguments.length)return e.slice();e=[];for(var _=0,x=d.length,E;_<x;++_)E=d[_],E!=null&&!isNaN(E=+E)&&e.push(E);return e.sort(Mm),o()},u.range=function(d){return arguments.length?(n=kp.call(d),o()):n.slice()},u.unknown=function(d){return arguments.length?(i=d,u):i},u.quantiles=function(){return r.slice()},u.copy=function(){return Ky().domain(e).range(n).unknown(i)},$h.apply(u,arguments)}function $y(){var e=0,n=1,r=1,i=[.5],o=[0,1],u;function d(x){return x<=x?o[jv(i,x,0,r)]:u}function _(){var x=-1;for(i=new Array(r);++x<r;)i[x]=((x+1)*n-(x-r)*e)/(r+1);return d}return d.domain=function(x){return arguments.length?(e=+x[0],n=+x[1],_()):[e,n]},d.range=function(x){return arguments.length?(r=(o=kp.call(x)).length-1,_()):o.slice()},d.invertExtent=function(x){var E=o.indexOf(x);return E<0?[NaN,NaN]:E<1?[e,i[0]]:E>=r?[i[r-1],n]:[i[E-1],i[E]]},d.unknown=function(x){return arguments.length&&(u=x),d},d.thresholds=function(){return i.slice()},d.copy=function(){return $y().domain([e,n]).range(o).unknown(u)},$h.apply(Qv(d),arguments)}function Jy(){var e=[.5],n=[0,1],r,i=1;function o(u){return u<=u?n[jv(e,u,0,i)]:r}return o.domain=function(u){return arguments.length?(e=kp.call(u),i=Math.min(e.length,n.length-1),o):e.slice()},o.range=function(u){return arguments.length?(n=kp.call(u),i=Math.min(e.length,n.length-1),o):n.slice()},o.invertExtent=function(u){var d=n.indexOf(u);return[e[d-1],e[d]]},o.unknown=function(u){return arguments.length?(r=u,o):r},o.copy=function(){return Jy().domain(e).range(n).unknown(r)},$h.apply(o,arguments)}var Um=new Date,Zm=new Date;function ol(e,n,r,i){function o(u){return e(u=arguments.length===0?new Date:new Date(+u)),u}return o.floor=function(u){return e(u=new Date(+u)),u},o.ceil=function(u){return e(u=new Date(u-1)),n(u,1),e(u),u},o.round=function(u){var d=o(u),_=o.ceil(u);return u-d<_-u?d:_},o.offset=function(u,d){return n(u=new Date(+u),d==null?1:Math.floor(d)),u},o.range=function(u,d,_){var x=[],E;if(u=o.ceil(u),_=_==null?1:Math.floor(_),!(u<d)||!(_>0))return x;do x.push(E=new Date(+u)),n(u,_),e(u);while(E<u&&u<d);return x},o.filter=function(u){return ol(function(d){if(d>=d)for(;e(d),!u(d);)d.setTime(d-1)},function(d,_){if(d>=d)if(_<0)for(;++_<=0;)for(;n(d,-1),!u(d););else for(;--_>=0;)for(;n(d,1),!u(d););})},r&&(o.count=function(u,d){return Um.setTime(+u),Zm.setTime(+d),e(Um),e(Zm),Math.floor(r(Um,Zm))},o.every=function(u){return u=Math.floor(u),!isFinite(u)||!(u>0)?null:u>1?o.filter(i?function(d){return i(d)%u==0}:function(d){return o.count(0,d)%u==0}):o}),o}var Vm=ol(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,n){e.setFullYear(e.getFullYear()+n)},function(e,n){return n.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()});Vm.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:ol(function(n){n.setFullYear(Math.floor(n.getFullYear()/e)*e),n.setMonth(0,1),n.setHours(0,0,0,0)},function(n,r){n.setFullYear(n.getFullYear()+r*e)})};var vd=Vm,TP=Vm.range,Qy=ol(function(e){e.setDate(1),e.setHours(0,0,0,0)},function(e,n){e.setMonth(e.getMonth()+n)},function(e,n){return n.getMonth()-e.getMonth()+(n.getFullYear()-e.getFullYear())*12},function(e){return e.getMonth()}),nC=Qy,AP=Qy.range,em=1e3,iv=6e4,e_=36e5,t_=864e5,r_=6048e5;function Dp(e){return ol(function(n){n.setDate(n.getDate()-(n.getDay()+7-e)%7),n.setHours(0,0,0,0)},function(n,r){n.setDate(n.getDate()+r*7)},function(n,r){return(r-n-(r.getTimezoneOffset()-n.getTimezoneOffset())*iv)/r_})}var jm=Dp(0),tm=Dp(1),iC=Dp(2),aC=Dp(3),md=Dp(4),oC=Dp(5),sC=Dp(6),MP=jm.range,PP=tm.range,IP=iC.range,OP=aC.range,RP=md.range,LP=oC.range,kP=sC.range,n_=ol(function(e){e.setHours(0,0,0,0)},function(e,n){e.setDate(e.getDate()+n)},function(e,n){return(n-e-(n.getTimezoneOffset()-e.getTimezoneOffset())*iv)/t_},function(e){return e.getDate()-1}),Gm=n_,DP=n_.range,i_=ol(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*em-e.getMinutes()*iv)},function(e,n){e.setTime(+e+n*e_)},function(e,n){return(n-e)/e_},function(e){return e.getHours()}),uC=i_,FP=i_.range,a_=ol(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*em)},function(e,n){e.setTime(+e+n*iv)},function(e,n){return(n-e)/iv},function(e){return e.getMinutes()}),lC=a_,NP=a_.range,o_=ol(function(e){e.setTime(e-e.getMilliseconds())},function(e,n){e.setTime(+e+n*em)},function(e,n){return(n-e)/em},function(e){return e.getUTCSeconds()}),cC=o_,BP=o_.range,rm=ol(function(){},function(e,n){e.setTime(+e+n)},function(e,n){return n-e});rm.every=function(e){return e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?ol(function(n){n.setTime(Math.floor(n/e)*e)},function(n,r){n.setTime(+n+r*e)},function(n,r){return(r-n)/e}):rm};var fC=rm,zP=rm.range;function Fp(e){return ol(function(n){n.setUTCDate(n.getUTCDate()-(n.getUTCDay()+7-e)%7),n.setUTCHours(0,0,0,0)},function(n,r){n.setUTCDate(n.getUTCDate()+r*7)},function(n,r){return(r-n)/r_})}var s_=Fp(0),nm=Fp(1),hC=Fp(2),pC=Fp(3),gd=Fp(4),dC=Fp(5),vC=Fp(6),UP=s_.range,ZP=nm.range,VP=hC.range,jP=pC.range,GP=gd.range,HP=dC.range,WP=vC.range,u_=ol(function(e){e.setUTCHours(0,0,0,0)},function(e,n){e.setUTCDate(e.getUTCDate()+n)},function(e,n){return(n-e)/t_},function(e){return e.getUTCDate()-1}),l_=u_,XP=u_.range,Hm=ol(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,n){e.setUTCFullYear(e.getUTCFullYear()+n)},function(e,n){return n.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()});Hm.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:ol(function(n){n.setUTCFullYear(Math.floor(n.getUTCFullYear()/e)*e),n.setUTCMonth(0,1),n.setUTCHours(0,0,0,0)},function(n,r){n.setUTCFullYear(n.getUTCFullYear()+r*e)})};var av=Hm,YP=Hm.range;function Wm(e){if(0<=e.y&&e.y<100){var n=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return n.setFullYear(e.y),n}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function Xm(e){if(0<=e.y&&e.y<100){var n=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return n.setUTCFullYear(e.y),n}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function ov(e,n,r){return{y:e,m:n,d:r,H:0,M:0,S:0,L:0}}function mC(e){var n=e.dateTime,r=e.date,i=e.time,o=e.periods,u=e.days,d=e.shortDays,_=e.months,x=e.shortMonths,E=sv(o),P=uv(o),I=sv(u),D=uv(u),Z=sv(d),re=uv(d),oe=sv(_),de=uv(_),Fe=sv(x),it=uv(x),vt={a:sl,A:Ic,b:Sl,B:kM,c:null,d:v_,e:v_,f:zC,g:qC,G:$C,H:FC,I:NC,j:BC,L:m_,m:UC,M:ZC,p:DM,q:FM,Q:E_,s:S_,S:VC,u:jC,U:GC,V:HC,w:WC,W:XC,x:null,X:null,y:YC,Y:KC,Z:JC,"%":b_},xt={a:NM,A:BM,b:zM,B:UM,c:null,d:y_,e:y_,f:rT,g:hT,G:dT,H:QC,I:eT,j:tT,L:__,m:nT,M:iT,p:ZM,q:VM,Q:E_,s:S_,S:aT,u:oT,U:sT,V:uT,w:lT,W:cT,x:null,X:null,y:fT,Y:pT,Z:vT,"%":b_},Gt={a:hn,A:wr,b:Pn,B:jn,c:yi,d:p_,e:p_,f:RC,g:h_,G:f_,H:d_,I:d_,j:MC,L:OC,m:AC,M:PC,p:en,q:TC,Q:kC,s:DC,S:IC,u:bC,U:EC,V:SC,w:xC,W:wC,x:Io,X:Ms,y:h_,Y:f_,Z:CC,"%":LC};vt.x=Xt(r,vt),vt.X=Xt(i,vt),vt.c=Xt(n,vt),xt.x=Xt(r,xt),xt.X=Xt(i,xt),xt.c=Xt(n,xt);function Xt(oi,Ra){return function(Ja){var vn=[],wl=-1,Uo=0,tc=oi.length,rc,Bp,ax;for(Ja instanceof Date||(Ja=new Date(+Ja));++wl<tc;)oi.charCodeAt(wl)===37&&(vn.push(oi.slice(Uo,wl)),(Bp=c_[rc=oi.charAt(++wl)])!=null?rc=oi.charAt(++wl):Bp=rc==="e"?" ":"0",(ax=Ra[rc])&&(rc=ax(Ja,Bp)),vn.push(rc),Uo=wl+1);return vn.push(oi.slice(Uo,wl)),vn.join("")}}function nr(oi,Ra){return function(Ja){var vn=ov(1900,void 0,1),wl=mr(vn,oi,Ja+="",0),Uo,tc;if(wl!=Ja.length)return null;if("Q"in vn)return new Date(vn.Q);if("s"in vn)return new Date(vn.s*1e3+("L"in vn?vn.L:0));if(Ra&&!("Z"in vn)&&(vn.Z=0),"p"in vn&&(vn.H=vn.H%12+vn.p*12),vn.m===void 0&&(vn.m="q"in vn?vn.q:0),"V"in vn){if(vn.V<1||vn.V>53)return null;"w"in vn||(vn.w=1),"Z"in vn?(Uo=Xm(ov(vn.y,0,1)),tc=Uo.getUTCDay(),Uo=tc>4||tc===0?nm.ceil(Uo):nm(Uo),Uo=l_.offset(Uo,(vn.V-1)*7),vn.y=Uo.getUTCFullYear(),vn.m=Uo.getUTCMonth(),vn.d=Uo.getUTCDate()+(vn.w+6)%7):(Uo=Wm(ov(vn.y,0,1)),tc=Uo.getDay(),Uo=tc>4||tc===0?tm.ceil(Uo):tm(Uo),Uo=Gm.offset(Uo,(vn.V-1)*7),vn.y=Uo.getFullYear(),vn.m=Uo.getMonth(),vn.d=Uo.getDate()+(vn.w+6)%7)}else("W"in vn||"U"in vn)&&("w"in vn||(vn.w="u"in vn?vn.u%7:"W"in vn?1:0),tc="Z"in vn?Xm(ov(vn.y,0,1)).getUTCDay():Wm(ov(vn.y,0,1)).getDay(),vn.m=0,vn.d="W"in vn?(vn.w+6)%7+vn.W*7-(tc+5)%7:vn.w+vn.U*7-(tc+6)%7);return"Z"in vn?(vn.H+=vn.Z/100|0,vn.M+=vn.Z%100,Xm(vn)):Wm(vn)}}function mr(oi,Ra,Ja,vn){for(var wl=0,Uo=Ra.length,tc=Ja.length,rc,Bp;wl<Uo;){if(vn>=tc)return-1;if(rc=Ra.charCodeAt(wl++),rc===37){if(rc=Ra.charAt(wl++),Bp=Gt[rc in c_?Ra.charAt(wl++):rc],!Bp||(vn=Bp(oi,Ja,vn))<0)return-1}else if(rc!=Ja.charCodeAt(vn++))return-1}return vn}function en(oi,Ra,Ja){var vn=E.exec(Ra.slice(Ja));return vn?(oi.p=P[vn[0].toLowerCase()],Ja+vn[0].length):-1}function hn(oi,Ra,Ja){var vn=Z.exec(Ra.slice(Ja));return vn?(oi.w=re[vn[0].toLowerCase()],Ja+vn[0].length):-1}function wr(oi,Ra,Ja){var vn=I.exec(Ra.slice(Ja));return vn?(oi.w=D[vn[0].toLowerCase()],Ja+vn[0].length):-1}function Pn(oi,Ra,Ja){var vn=Fe.exec(Ra.slice(Ja));return vn?(oi.m=it[vn[0].toLowerCase()],Ja+vn[0].length):-1}function jn(oi,Ra,Ja){var vn=oe.exec(Ra.slice(Ja));return vn?(oi.m=de[vn[0].toLowerCase()],Ja+vn[0].length):-1}function yi(oi,Ra,Ja){return mr(oi,n,Ra,Ja)}function Io(oi,Ra,Ja){return mr(oi,r,Ra,Ja)}function Ms(oi,Ra,Ja){return mr(oi,i,Ra,Ja)}function sl(oi){return d[oi.getDay()]}function Ic(oi){return u[oi.getDay()]}function Sl(oi){return x[oi.getMonth()]}function kM(oi){return _[oi.getMonth()]}function DM(oi){return o[+(oi.getHours()>=12)]}function FM(oi){return 1+~~(oi.getMonth()/3)}function NM(oi){return d[oi.getUTCDay()]}function BM(oi){return u[oi.getUTCDay()]}function zM(oi){return x[oi.getUTCMonth()]}function UM(oi){return _[oi.getUTCMonth()]}function ZM(oi){return o[+(oi.getUTCHours()>=12)]}function VM(oi){return 1+~~(oi.getUTCMonth()/3)}return{format:function(oi){var Ra=Xt(oi+="",vt);return Ra.toString=function(){return oi},Ra},parse:function(oi){var Ra=nr(oi+="",!1);return Ra.toString=function(){return oi},Ra},utcFormat:function(oi){var Ra=Xt(oi+="",xt);return Ra.toString=function(){return oi},Ra},utcParse:function(oi){var Ra=nr(oi+="",!0);return Ra.toString=function(){return oi},Ra}}}var c_={"-":"",_:" ","0":"0"},fu=/^\s*\d+/,gC=/^%/,yC=/[\\^$*+?|[\]().{}]/g;function $a(e,n,r){var i=e<0?"-":"",o=(i?-e:e)+"",u=o.length;return i+(u<r?new Array(r-u+1).join(n)+o:o)}function _C(e){return e.replace(yC,"\\$&")}function sv(e){return new RegExp("^(?:"+e.map(_C).join("|")+")","i")}function uv(e){for(var n={},r=-1,i=e.length;++r<i;)n[e[r].toLowerCase()]=r;return n}function xC(e,n,r){var i=fu.exec(n.slice(r,r+1));return i?(e.w=+i[0],r+i[0].length):-1}function bC(e,n,r){var i=fu.exec(n.slice(r,r+1));return i?(e.u=+i[0],r+i[0].length):-1}function EC(e,n,r){var i=fu.exec(n.slice(r,r+2));return i?(e.U=+i[0],r+i[0].length):-1}function SC(e,n,r){var i=fu.exec(n.slice(r,r+2));return i?(e.V=+i[0],r+i[0].length):-1}function wC(e,n,r){var i=fu.exec(n.slice(r,r+2));return i?(e.W=+i[0],r+i[0].length):-1}function f_(e,n,r){var i=fu.exec(n.slice(r,r+4));return i?(e.y=+i[0],r+i[0].length):-1}function h_(e,n,r){var i=fu.exec(n.slice(r,r+2));return i?(e.y=+i[0]+(+i[0]>68?1900:2e3),r+i[0].length):-1}function CC(e,n,r){var i=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(n.slice(r,r+6));return i?(e.Z=i[1]?0:-(i[2]+(i[3]||"00")),r+i[0].length):-1}function TC(e,n,r){var i=fu.exec(n.slice(r,r+1));return i?(e.q=i[0]*3-3,r+i[0].length):-1}function AC(e,n,r){var i=fu.exec(n.slice(r,r+2));return i?(e.m=i[0]-1,r+i[0].length):-1}function p_(e,n,r){var i=fu.exec(n.slice(r,r+2));return i?(e.d=+i[0],r+i[0].length):-1}function MC(e,n,r){var i=fu.exec(n.slice(r,r+3));return i?(e.m=0,e.d=+i[0],r+i[0].length):-1}function d_(e,n,r){var i=fu.exec(n.slice(r,r+2));return i?(e.H=+i[0],r+i[0].length):-1}function PC(e,n,r){var i=fu.exec(n.slice(r,r+2));return i?(e.M=+i[0],r+i[0].length):-1}function IC(e,n,r){var i=fu.exec(n.slice(r,r+2));return i?(e.S=+i[0],r+i[0].length):-1}function OC(e,n,r){var i=fu.exec(n.slice(r,r+3));return i?(e.L=+i[0],r+i[0].length):-1}function RC(e,n,r){var i=fu.exec(n.slice(r,r+6));return i?(e.L=Math.floor(i[0]/1e3),r+i[0].length):-1}function LC(e,n,r){var i=gC.exec(n.slice(r,r+1));return i?r+i[0].length:-1}function kC(e,n,r){var i=fu.exec(n.slice(r));return i?(e.Q=+i[0],r+i[0].length):-1}function DC(e,n,r){var i=fu.exec(n.slice(r));return i?(e.s=+i[0],r+i[0].length):-1}function v_(e,n){return $a(e.getDate(),n,2)}function FC(e,n){return $a(e.getHours(),n,2)}function NC(e,n){return $a(e.getHours()%12||12,n,2)}function BC(e,n){return $a(1+Gm.count(vd(e),e),n,3)}function m_(e,n){return $a(e.getMilliseconds(),n,3)}function zC(e,n){return m_(e,n)+"000"}function UC(e,n){return $a(e.getMonth()+1,n,2)}function ZC(e,n){return $a(e.getMinutes(),n,2)}function VC(e,n){return $a(e.getSeconds(),n,2)}function jC(e){var n=e.getDay();return n===0?7:n}function GC(e,n){return $a(jm.count(vd(e)-1,e),n,2)}function g_(e){var n=e.getDay();return n>=4||n===0?md(e):md.ceil(e)}function HC(e,n){return e=g_(e),$a(md.count(vd(e),e)+(vd(e).getDay()===4),n,2)}function WC(e){return e.getDay()}function XC(e,n){return $a(tm.count(vd(e)-1,e),n,2)}function YC(e,n){return $a(e.getFullYear()%100,n,2)}function qC(e,n){return e=g_(e),$a(e.getFullYear()%100,n,2)}function KC(e,n){return $a(e.getFullYear()%1e4,n,4)}function $C(e,n){var r=e.getDay();return e=r>=4||r===0?md(e):md.ceil(e),$a(e.getFullYear()%1e4,n,4)}function JC(e){var n=e.getTimezoneOffset();return(n>0?"-":(n*=-1,"+"))+$a(n/60|0,"0",2)+$a(n%60,"0",2)}function y_(e,n){return $a(e.getUTCDate(),n,2)}function QC(e,n){return $a(e.getUTCHours(),n,2)}function eT(e,n){return $a(e.getUTCHours()%12||12,n,2)}function tT(e,n){return $a(1+l_.count(av(e),e),n,3)}function __(e,n){return $a(e.getUTCMilliseconds(),n,3)}function rT(e,n){return __(e,n)+"000"}function nT(e,n){return $a(e.getUTCMonth()+1,n,2)}function iT(e,n){return $a(e.getUTCMinutes(),n,2)}function aT(e,n){return $a(e.getUTCSeconds(),n,2)}function oT(e){var n=e.getUTCDay();return n===0?7:n}function sT(e,n){return $a(s_.count(av(e)-1,e),n,2)}function x_(e){var n=e.getUTCDay();return n>=4||n===0?gd(e):gd.ceil(e)}function uT(e,n){return e=x_(e),$a(gd.count(av(e),e)+(av(e).getUTCDay()===4),n,2)}function lT(e){return e.getUTCDay()}function cT(e,n){return $a(nm.count(av(e)-1,e),n,2)}function fT(e,n){return $a(e.getUTCFullYear()%100,n,2)}function hT(e,n){return e=x_(e),$a(e.getUTCFullYear()%100,n,2)}function pT(e,n){return $a(e.getUTCFullYear()%1e4,n,4)}function dT(e,n){var r=e.getUTCDay();return e=r>=4||r===0?gd(e):gd.ceil(e),$a(e.getUTCFullYear()%1e4,n,4)}function vT(){return"+0000"}function b_(){return"%"}function E_(e){return+e}function S_(e){return Math.floor(+e/1e3)}var yd,w_,mT,gT,yT;_T({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function _T(e){return yd=mC(e),w_=yd.format,mT=yd.parse,gT=yd.utcFormat,yT=yd.utcParse,yd}var lv=1e3,cv=lv*60,fv=cv*60,hv=fv*24,xT=hv*7,C_=hv*30,Ym=hv*365;function bT(e){return new Date(e)}function ET(e){return e instanceof Date?+e:+new Date(+e)}function T_(e,n,r,i,o,u,d,_,x){var E=Ry(Pc,Pc),P=E.invert,I=E.domain,D=x(".%L"),Z=x(":%S"),re=x("%I:%M"),oe=x("%I %p"),de=x("%a %d"),Fe=x("%b %d"),it=x("%B"),vt=x("%Y"),xt=[[d,1,lv],[d,5,5*lv],[d,15,15*lv],[d,30,30*lv],[u,1,cv],[u,5,5*cv],[u,15,15*cv],[u,30,30*cv],[o,1,fv],[o,3,3*fv],[o,6,6*fv],[o,12,12*fv],[i,1,hv],[i,2,2*hv],[r,1,xT],[n,1,C_],[n,3,3*C_],[e,1,Ym]];function Gt(nr){return(d(nr)<nr?D:u(nr)<nr?Z:o(nr)<nr?re:i(nr)<nr?oe:n(nr)<nr?r(nr)<nr?de:Fe:e(nr)<nr?it:vt)(nr)}function Xt(nr,mr,en,hn){if(nr==null&&(nr=10),typeof nr=="number"){var wr=Math.abs(en-mr)/nr,Pn=_y(function(jn){return jn[2]}).right(xt,wr);Pn===xt.length?(hn=Rm(mr/Ym,en/Ym,nr),nr=e):Pn?(Pn=xt[wr/xt[Pn-1][2]<xt[Pn][2]/wr?Pn-1:Pn],hn=Pn[1],nr=Pn[0]):(hn=Math.max(Rm(mr,en,nr),1),nr=_)}return hn==null?nr:nr.every(hn)}return E.invert=function(nr){return new Date(P(nr))},E.domain=function(nr){return arguments.length?I(Xv.call(nr,ET)):I().map(bT)},E.ticks=function(nr,mr){var en=I(),hn=en[0],wr=en[en.length-1],Pn=wr<hn,jn;return Pn&&(jn=hn,hn=wr,wr=jn),jn=Xt(nr,hn,wr,mr),jn=jn?jn.range(hn,wr+1):[],Pn?jn.reverse():jn},E.tickFormat=function(nr,mr){return mr==null?Gt:x(mr)},E.nice=function(nr,mr){var en=I();return(nr=Xt(nr,en[0],en[en.length-1],mr))?I(Vy(en,nr)):E},E.copy=function(){return qv(E,T_(e,n,r,i,o,u,d,_,x))},E}function ST(){return $h.apply(T_(vd,nC,jm,Gm,uC,lC,cC,fC,w_).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function qP(){return initRange.apply(calendar(utcYear,utcMonth,utcWeek,utcDay,utcHour,utcMinute,utcSecond,utcMillisecond,utcFormat).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function im(){var e=0,n=1,r,i,o,u,d=identity,_=!1,x;function E(P){return isNaN(P=+P)?x:d(o===0?.5:(P=(u(P)-r)*o,_?Math.max(0,Math.min(1,P)):P))}return E.domain=function(P){return arguments.length?(r=u(e=+P[0]),i=u(n=+P[1]),o=r===i?0:1/(i-r),E):[e,n]},E.clamp=function(P){return arguments.length?(_=!!P,E):_},E.interpolator=function(P){return arguments.length?(d=P,E):d},E.unknown=function(P){return arguments.length?(x=P,E):x},function(P){return u=P,r=P(e),i=P(n),o=r===i?0:1/(i-r),E}}function am(e,n){return n.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function wT(){var e=linearish(im()(identity));return e.copy=function(){return am(e,wT())},initInterpolator.apply(e,arguments)}function CT(){var e=loggish(im()).domain([1,10]);return e.copy=function(){return am(e,CT()).base(e.base())},initInterpolator.apply(e,arguments)}function TT(){var e=symlogish(im());return e.copy=function(){return am(e,TT()).constant(e.constant())},initInterpolator.apply(e,arguments)}function A_(){var e=powish(im());return e.copy=function(){return am(e,A_()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function KP(){return A_.apply(null,arguments).exponent(.5)}function AT(){var e=[],n=identity;function r(i){if(!isNaN(i=+i))return n((bisect(e,i)-1)/(e.length-1))}return r.domain=function(i){if(!arguments.length)return e.slice();e=[];for(var o=0,u=i.length,d;o<u;++o)d=i[o],d!=null&&!isNaN(d=+d)&&e.push(d);return e.sort(ascending),r},r.interpolator=function(i){return arguments.length?(n=i,r):n},r.copy=function(){return AT(n).domain(e)},initInterpolator.apply(r,arguments)}function om(){var e=0,n=.5,r=1,i,o,u,d,_,x=identity,E,P=!1,I;function D(Z){return isNaN(Z=+Z)?I:(Z=.5+((Z=+E(Z))-o)*(Z<o?d:_),x(P?Math.max(0,Math.min(1,Z)):Z))}return D.domain=function(Z){return arguments.length?(i=E(e=+Z[0]),o=E(n=+Z[1]),u=E(r=+Z[2]),d=i===o?0:.5/(o-i),_=o===u?0:.5/(u-o),D):[e,n,r]},D.clamp=function(Z){return arguments.length?(P=!!Z,D):P},D.interpolator=function(Z){return arguments.length?(x=Z,D):x},D.unknown=function(Z){return arguments.length?(I=Z,D):I},function(Z){return E=Z,i=Z(e),o=Z(n),u=Z(r),d=i===o?0:.5/(o-i),_=o===u?0:.5/(u-o),D}}function MT(){var e=linearish(om()(identity));return e.copy=function(){return copy(e,MT())},initInterpolator.apply(e,arguments)}function PT(){var e=loggish(om()).domain([.1,1,10]);return e.copy=function(){return copy(e,PT()).base(e.base())},initInterpolator.apply(e,arguments)}function IT(){var e=symlogish(om());return e.copy=function(){return copy(e,IT()).constant(e.constant())},initInterpolator.apply(e,arguments)}function M_(){var e=powish(om());return e.copy=function(){return copy(e,M_()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function $P(){return M_.apply(null,arguments).exponent(.5)}var Kc,P_,I_,O_,qm,R_,OT=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,RT=(Kc={},(0,C.Z)(Kc,Ks.LINEAR,Uy),(0,C.Z)(Kc,Ks.POWER,zm),(0,C.Z)(Kc,Ks.LOG,Wy),(0,C.Z)(Kc,Ks.IDENTITY,Zy),(0,C.Z)(Kc,Ks.TIME,ST),(0,C.Z)(Kc,Ks.QUANTILE,Ky),(0,C.Z)(Kc,Ks.QUANTIZE,$y),(0,C.Z)(Kc,Ks.THRESHOLD,Jy),(0,C.Z)(Kc,Ks.CAT,Yv),Kc),LT=(P_=(0,Fr.b2)(),I_=(0,Fr.f3)($t.IGlobalConfigService),P_(O_=(qm=function(){function e(){(0,Ct.Z)(this,e),Bn(this,"configService",R_,this),(0,C.Z)(this,"scaleCache",{}),(0,C.Z)(this,"scaleOptions",{})}return(0,qt.Z)(e,[{key:"apply",value:function(r,i){var o=this,u=i.styleAttributeService;r.hooks.init.tap("FeatureScalePlugin",function(){o.scaleOptions=r.getScaleOptions();var d=u.getLayerStyleAttributes(),_=r.getSource().data.dataArray;_.length!==0&&o.caculateScalesForAttributes(d||[],_)}),r.hooks.beforeRenderData.tap("FeatureScalePlugin",function(){o.scaleOptions=r.getScaleOptions();var d=u.getLayerStyleAttributes(),_=r.getSource().data.dataArray;return o.caculateScalesForAttributes(d||[],_),r.layerModelNeedUpdate=!0,!0}),r.hooks.beforeRender.tap("FeatureScalePlugin",function(){if(!r.layerModelNeedUpdate){o.scaleOptions=r.getScaleOptions();var d=u.getLayerStyleAttributes();if(d){var _=r.getSource().data.dataArray;if(_.length===0)return;var x=d.filter(function(E){return E.needRescale});x.length&&o.caculateScalesForAttributes(x,_)}}})}},{key:"isNumber",value:function(r){return!isNaN(parseFloat(r))&&isFinite(r)}},{key:"caculateScalesForAttributes",value:function(r,i){var o=this;this.scaleCache={},r.forEach(function(u){if(u.scale){var d=u.scale,_=u.name;d.names=o.parseFields(u.scale.field||[]);var x=[];d.names.forEach(function(E){x.push(o.getOrCreateScale(E,u,i))}),x.some(function(E){return E.type===Xh.VARIABLE})?(d.type=Xh.VARIABLE,x.forEach(function(E){if(!d.callback){var P;if(d.values&&d.values!=="text"){var I;if(((I=E.option)===null||I===void 0?void 0:I.type)==="linear"&&d.values.length>2){var D=E.scale.ticks(d.values.length);_==="color"&&E.scale.domain(D)}E.scale.range(d.values)}else((P=E.option)===null||P===void 0?void 0:P.type)==="cat"&&E.scale.range(E.option.domain)}})):(d.type=Xh.CONSTANT,d.defaultValues=x.map(function(E,P){return E.scale(d.names[P])})),d.scalers=x.map(function(E){return{field:E.field,func:E.scale,option:E.option}}),u.needRescale=!1}})}},{key:"getOrCreateScale",value:function(r,i,o){var u,d=[r,i.name].join("_"),_=(u=i.scale)===null||u===void 0?void 0:u.values,x=this.createScale(r,i.name,_,o);return x}},{key:"parseFields",value:function(r){return Array.isArray(r)?r:Qo()(r)?r.split("*"):[r]}},{key:"createScale",value:function(r,i,o,u){var d,_,x=this.scaleOptions[i]&&((d=this.scaleOptions[i])===null||d===void 0?void 0:d.field)===r?this.scaleOptions[i]:this.scaleOptions[r],E={field:r,scale:void 0,type:Xh.VARIABLE,option:x};if(!u||!u.length)return x&&x.type?E.scale=this.createDefaultScale(x):(E.scale=Yv([r]),E.type=Xh.CONSTANT),E;var P=(_=u.find(function(Z){return!li()(Z[r])}))===null||_===void 0?void 0:_[r];if(this.isNumber(r)||li()(P)&&!x)E.scale=Yv([r]),E.type=Xh.CONSTANT;else{var I=x&&x.type||this.getDefaultType(P);o==="text"&&(I=Ks.CAT);var D=this.createDefaultScaleConfig(I,r,u);Object.assign(D,x),E.scale=this.createDefaultScale(D),E.option=D}return E}},{key:"getDefaultType",value:function(r){var i=Ks.LINEAR;return typeof r=="string"&&(i=OT.test(r)?Ks.TIME:Ks.CAT),i}},{key:"createDefaultScaleConfig",value:function(r,i,o){var u={type:r},d=(o==null?void 0:o.map(function(_){return _[i]}))||[];return r!==Ks.CAT&&r!==Ks.QUANTILE?u.domain=Ew(d):r===Ks.CAT?u.domain=Nh()(d):r===Ks.QUANTILE&&(u.domain=d),u}},{key:"createDefaultScale",value:function(r){var i=r.type,o=r.domain,u=RT[i]();return o&&u.domain(o),u}}]),e}(),R_=Ln(qm.prototype,"configService",[I_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qm))||O_),L_,k_,D_,F_,sm,N_,B_;function z_(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function kT(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?z_(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):z_(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var DT=(L_=(0,Fr.b2)(),k_=(0,Fr.f3)($t.ICameraService),D_=(0,Fr.f3)($t.IRendererService),L_(F_=(sm=function(){function e(){(0,Ct.Z)(this,e),Bn(this,"cameraService",N_,this),Bn(this,"rendererService",B_,this)}return(0,qt.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("LayerAnimateStylePlugin",function(){r.models.forEach(function(i){i.addUniforms(kT({},r.layerModel.getAnimateUniforms()))})})}}]),e}(),N_=Ln(sm.prototype,"cameraService",[k_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),B_=Ln(sm.prototype,"rendererService",[D_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sm))||F_),U_,Z_,FT=(U_=(0,Fr.b2)(),U_(Z_=function(){function e(){(0,Ct.Z)(this,e)}return(0,qt.Z)(e,[{key:"apply",value:function(r){r.hooks.init.tap("LayerModelPlugin",function(){r.prepareBuildModel(),r.buildModels(),r.styleNeedUpdate=!1}),r.hooks.beforeRenderData.tap("DataSourcePlugin",function(){return r.prepareBuildModel(),r.clearModels(),r.buildModels(),r.layerModelNeedUpdate=!1,!1})}}]),e}())||Z_),V_,j_,NT=(V_=(0,Fr.b2)(),V_(j_=function(){function e(){(0,Ct.Z)(this,e)}return(0,qt.Z)(e,[{key:"apply",value:function(r){r.hooks.afterInit.tap("LayerStylePlugin",function(){r.updateLayerConfig({});var i=r.getLayerConfig(),o=i.autoFit,u=i.fitBoundsOptions;o&&setTimeout(function(){r.fitBounds(u)},100)})}}]),e}())||j_),G_,H_,BT=["type"];function W_(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function pv(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?W_(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):W_(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var X_={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},zT={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},UT={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},ZT={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5},JP=null;function VT(e){var n={u_DirectionalLights:new Array(3).fill(pv({},UT)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill(pv({},ZT)),u_NumOfSpotLights:0};return(!e||!e.length)&&(e=[zT]),e.forEach(function(r,i){var o=r.type,u=o===void 0?"directional":o,d=(0,Sn.Z)(r,BT),_=X_[u].lights,x=X_[u].num,E=n[x];n[_][E]=pv(pv({},n[_][E]),d),n[x]++}),n}var jT=(G_=(0,Fr.b2)(),G_(H_=function(){function e(){(0,Ct.Z)(this,e)}return(0,qt.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("LightingPlugin",function(){var i=r.getLayerConfig(),o=i.enableLighting;o&&r.models.forEach(function(u){return u.addUniforms(pv({},VT()))})})}}]),e}())||H_),Y_,q_,um={NONE:0,ENCODE:1,HIGHLIGHT:2},GT=(Y_=(0,Fr.b2)(),Y_(q_=function(){function e(){(0,Ct.Z)(this,e)}return(0,qt.Z)(e,[{key:"apply",value:function(r,i){var o=i.rendererService,u=i.styleAttributeService;r.hooks.init.tap("PixelPickingPlugin",function(){var d=r.getLayerConfig(),_=d.enablePicking;u.registerStyleAttribute({name:"pickingColor",type:wi.Attribute,descriptor:{name:"a_PickingColor",buffer:{data:[],type:m.FLOAT},size:3,update:function(E,P){var I=E.id;return _?Ji(I):[0,0,0]}}})}),r.hooks.beforePickingEncode.tap("PixelPickingPlugin",function(){var d=r.getLayerConfig(),_=d.enablePicking;_&&r.isVisible()&&r.models.forEach(function(x){return x.addUniforms({u_PickingStage:um.ENCODE})})}),r.hooks.afterPickingEncode.tap("PixelPickingPlugin",function(){var d=r.getLayerConfig(),_=d.enablePicking;_&&r.isVisible()&&r.models.forEach(function(x){return x.addUniforms({u_PickingStage:um.HIGHLIGHT})})}),r.hooks.beforeHighlight.tap("PixelPickingPlugin",function(d){var _=r.getLayerConfig(),x=_.highlightColor,E=typeof x=="string"?to(x):x||[1,0,0,1];r.updateLayerConfig({pickedFeatureID:Ou(new Uint8Array(d))}),r.models.forEach(function(P){return P.addUniforms({u_PickingStage:um.HIGHLIGHT,u_PickingColor:d,u_HighlightColor:E.map(function(I){return I*255})})})}),r.hooks.beforeSelect.tap("PixelPickingPlugin",function(d){var _=r.getLayerConfig(),x=_.selectColor,E=typeof x=="string"?to(x):x||[1,0,0,1];r.updateLayerConfig({pickedFeatureID:Ou(new Uint8Array(d))}),r.models.forEach(function(P){return P.addUniforms({u_PickingStage:um.HIGHLIGHT,u_PickingColor:d,u_HighlightColor:E.map(function(I){return I*255})})})})}}]),e}())||q_),K_,$_,HT=(K_=(0,Fr.b2)(),K_($_=function(){function e(){(0,Ct.Z)(this,e)}return(0,qt.Z)(e,[{key:"apply",value:function(r,i){var o=this,u=i.styleAttributeService;r.hooks.init.tap("RegisterStyleAttributePlugin",function(){o.registerBuiltinAttributes(u)})}},{key:"registerBuiltinAttributes",value:function(r){r.registerStyleAttribute({name:"position",type:wi.Attribute,descriptor:{name:"a_Position",buffer:{data:[],type:m.FLOAT},size:3,update:function(o,u,d){return d.length===2?[d[0],d[1],0]:[d[0],d[1],d[2]]}}}),r.registerStyleAttribute({name:"filter",type:wi.Attribute,descriptor:{name:"filter",buffer:{usage:m.DYNAMIC_DRAW,data:[],type:m.FLOAT},size:1,update:function(o,u){var d=o.filter;return d?[1]:[0]}}}),r.registerStyleAttribute({name:"color",type:wi.Attribute,descriptor:{name:"a_Color",buffer:{usage:m.DYNAMIC_DRAW,data:[],type:m.FLOAT},size:4,update:function(o,u){var d=o.color;return!d||!d.length?[1,1,1,1]:d}}}),r.registerStyleAttribute({name:"vertexId",type:wi.Attribute,descriptor:{name:"a_vertexId",buffer:{usage:m.DYNAMIC_DRAW,data:[],type:m.FLOAT},size:1,update:function(o,u,d,_){return[u]}}})}}]),e}())||$_),J_,Q_,e1,t1,r1,n1,_d,i1,a1,o1,s1,WT=(J_=(0,Fr.b2)(),Q_=(0,Fr.f3)($t.ICameraService),e1=(0,Fr.f3)($t.ICoordinateSystemService),t1=(0,Fr.f3)($t.IRendererService),r1=(0,Fr.f3)($t.IMapService),J_(n1=(_d=function(){function e(){(0,Ct.Z)(this,e),Bn(this,"cameraService",i1,this),Bn(this,"coordinateSystemService",a1,this),Bn(this,"rendererService",o1,this),Bn(this,"mapService",s1,this)}return(0,qt.Z)(e,[{key:"apply",value:function(r){var i=this,o=this.mapService.version,u=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],d=[0,0];r.hooks.beforeRender.tap("ShaderUniformPlugin",function(){i.coordinateSystemService.refresh(),o==="GAODE2.x"&&(u=i.mapService.map.customCoords.getMVPMatrix(),d=i.mapService.getCustomCoordCenter());var _=i.rendererService.getViewportSize(),x=_.width,E=_.height;r.models.forEach(function(P){var I;P.addUniforms((I={},(0,C.Z)(I,Tp.ProjectionMatrix,i.cameraService.getProjectionMatrix()),(0,C.Z)(I,Tp.ViewMatrix,i.cameraService.getViewMatrix()),(0,C.Z)(I,Tp.ViewProjectionMatrix,i.cameraService.getViewProjectionMatrix()),(0,C.Z)(I,Tp.Zoom,i.cameraService.getZoom()),(0,C.Z)(I,Tp.ZoomScale,i.cameraService.getZoomScale()),(0,C.Z)(I,Tp.FocalDistance,i.cameraService.getFocalDistance()),(0,C.Z)(I,Tp.CameraPosition,i.cameraService.getCameraPosition()),(0,C.Z)(I,Ls.CoordinateSystem,i.coordinateSystemService.getCoordinateSystem()),(0,C.Z)(I,Ls.ViewportCenter,i.coordinateSystemService.getViewportCenter()),(0,C.Z)(I,Ls.ViewportCenterProjection,i.coordinateSystemService.getViewportCenterProjection()),(0,C.Z)(I,Ls.PixelsPerDegree,i.coordinateSystemService.getPixelsPerDegree()),(0,C.Z)(I,Ls.PixelsPerDegree2,i.coordinateSystemService.getPixelsPerDegree2()),(0,C.Z)(I,Ls.PixelsPerMeter,i.coordinateSystemService.getPixelsPerMeter()),(0,C.Z)(I,Ls.Mvp,u),(0,C.Z)(I,"u_SceneCenterMKT",d),(0,C.Z)(I,"u_ViewportSize",[x,E]),(0,C.Z)(I,"u_ModelMatrix",i.cameraService.getModelMatrix()),(0,C.Z)(I,"u_DevicePixelRatio",fa.devicePixelRatio),(0,C.Z)(I,"u_PickingBuffer",r.getLayerConfig().pickingBuffer||0),(0,C.Z)(I,"u_shaderPick",Number(r.getShaderPickStat())),I))})})}}]),e}(),i1=Ln(_d.prototype,"cameraService",[Q_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a1=Ln(_d.prototype,"coordinateSystemService",[e1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),o1=Ln(_d.prototype,"rendererService",[t1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),s1=Ln(_d.prototype,"mapService",[r1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_d))||n1),u1,l1,XT=(u1=(0,Fr.b2)(),u1(l1=function(){function e(){(0,Ct.Z)(this,e)}return(0,qt.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("UpdateModelPlugin",function(){r.layerModel&&r.layerModel.needUpdate()})}}]),e}())||l1),c1,f1,YT=(c1=(0,Fr.b2)(),c1(f1=function(){function e(){(0,Ct.Z)(this,e)}return(0,qt.Z)(e,[{key:"apply",value:function(r,i){var o=this,u=i.styleAttributeService;r.hooks.init.tap("UpdateStyleAttributePlugin",function(){o.initStyleAttribute(r,{styleAttributeService:u})}),r.hooks.beforeRender.tap("UpdateStyleAttributePlugin",function(){r.layerModelNeedUpdate||o.updateStyleAtrribute(r,{styleAttributeService:u})})}},{key:"updateStyleAtrribute",value:function(r,i){var o=i.styleAttributeService,u=o.getLayerStyleAttributes()||[],d=o.getLayerStyleAttribute("filter"),_=o.getLayerStyleAttribute("shape");if(d&&d.needRegenerateVertices||_&&_.needRegenerateVertices){r.layerModelNeedUpdate=!0,u.forEach(function(x){return x.needRegenerateVertices=!1});return}u.filter(function(x){return x.needRegenerateVertices}).forEach(function(x){o.updateAttributeByFeatureRange(x.name,r.getEncodedData(),x.featureRange.startIndex,x.featureRange.endIndex),x.needRegenerateVertices=!1})}},{key:"initStyleAttribute",value:function(r,i){var o=i.styleAttributeService,u=o.getLayerStyleAttributes()||[];u.filter(function(d){return d.needRegenerateVertices}).forEach(function(d){o.updateAttributeByFeatureRange(d.name,r.getEncodedData(),d.featureRange.startIndex,d.featureRange.endIndex),d.needRegenerateVertices=!1})}}]),e}())||f1);ec.bind($t.ILayerPlugin).to(_w).inRequestScope(),ec.bind($t.ILayerPlugin).to(HT).inRequestScope(),ec.bind($t.ILayerPlugin).to(LT).inRequestScope(),ec.bind($t.ILayerPlugin).to(yw).inRequestScope(),ec.bind($t.ILayerPlugin).to(NT).inRequestScope(),ec.bind($t.ILayerPlugin).to(YT).inRequestScope(),ec.bind($t.ILayerPlugin).to(XT).inRequestScope(),ec.bind($t.ILayerPlugin).to(eE).inRequestScope(),ec.bind($t.ILayerPlugin).to(WT).inRequestScope(),ec.bind($t.ILayerPlugin).to(DT).inRequestScope(),ec.bind($t.ILayerPlugin).to(jT).inRequestScope(),ec.bind($t.ILayerPlugin).to(GT).inRequestScope(),ec.bind($t.ILayerPlugin).to(FT).inRequestScope();var QP="2.6.19";function h1(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function eI(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?h1(Object(r),!0).forEach(function(i){qT(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):h1(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function qT(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function tI(e,n){return QT(e)||JT(e,n)||$T(e,n)||KT()}function KT(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function $T(e,n){if(!!e){if(typeof e=="string")return p1(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return p1(e,n)}}function p1(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}function JT(e,n){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var i=[],o=!0,u=!1,d,_;try{for(r=r.call(e);!(o=(d=r.next()).done)&&(i.push(d.value),!(n&&i.length===n));o=!0);}catch(x){u=!0,_=x}finally{try{!o&&r.return!=null&&r.return()}finally{if(u)throw _}}return i}}function QT(e){if(Array.isArray(e))return e}var rI=null,nI=null,d1,Km,v1;function m1(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function g1(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?m1(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):m1(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var eA=(d1=Jd($t.IGlobalConfigService),Km=function(){function e(n){(0,Ct.Z)(this,e),Bn(this,"configService",v1,this),(0,C.Z)(this,"config",void 0),this.config=n}return(0,qt.Z)(e,[{key:"setContainer",value:function(r,i,o,u){r.bind($t.MapConfig).toConstantValue(g1(g1({},this.config),{},{id:i,canvas:o,hasBaseMap:u})),r.bind($t.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),e}(),v1=Ln(Km.prototype,"configService",[d1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Km),tA=L(6158),rA=L.n(tA),$m;(function(e){e["GAODE1.x"]="GAODE1.x",e["GAODE2.x"]="GAODE2.x",e.MAPBOX="MAPBOX",e.L7MAP="L7MAP",e.GLOBEL="GLOBEL"})($m||($m={}));function dv(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function lm(e,n){var r=lt([],n,e);return fn(r,r,1/r[3]),r}function iI(e,n){var r=e%n;return r<0?n+r:r}function aI(e,n,r){return r*n+(1-r)*e}function Np(e,n){if(!e)throw new Error(n||"viewport-mercator-project: assertion failed.")}var $c=Math.PI,y1=$c/4,mh=$c/180,_1=180/$c,Jm=512,Qm=4003e4,nA=1.5;function x1(e){return Math.pow(2,e)}function iA(e){return Math.log2(e)}function cm(e,n){var r=(0,An.Z)(e,2),i=r[0],o=r[1];Np(Number.isFinite(i)&&Number.isFinite(n)),Np(Number.isFinite(o)&&o>=-90&&o<=90,"invalid latitude"),n*=Jm;var u=i*mh,d=o*mh,_=n*(u+$c)/(2*$c),x=n*($c-Math.log(Math.tan(y1+d*.5)))/(2*$c);return[_,x]}function e0(e,n){var r=(0,An.Z)(e,2),i=r[0],o=r[1];n*=Jm;var u=i/n*(2*$c)-$c,d=2*(Math.atan(Math.exp($c-o/n*(2*$c)))-y1);return[u*_1,d*_1]}function oI(e){var n=e.latitude;assert(Number.isFinite(n));var r=Math.cos(n*mh);return iA(Qm*r)-9}function b1(e){var n=e.latitude,r=e.longitude,i=e.zoom,o=e.scale,u=e.highPrecision,d=u===void 0?!1:u;o=o!==void 0?o:x1(i),Np(Number.isFinite(n)&&Number.isFinite(r)&&Number.isFinite(o));var _={},x=Jm*o,E=Math.cos(n*mh),P=x/360,I=P/E,D=x/Qm/E;if(_.pixelsPerMeter=[D,-D,D],_.metersPerPixel=[1/D,-1/D,1/D],_.pixelsPerDegree=[P,-I,D],_.degreesPerPixel=[1/P,-1/I,1/D],d){var Z=mh*Math.tan(n*mh)/E,re=P*Z/2,oe=x/Qm*Z,de=oe/I*D;_.pixelsPerDegree2=[0,-re,oe],_.pixelsPerMeter2=[de,0,de]}return _}function sI(e,n){var r=_slicedToArray(e,3),i=r[0],o=r[1],u=r[2],d=_slicedToArray(n,3),_=d[0],x=d[1],E=d[2],P=1,I=b1({longitude:i,latitude:o,scale:P,highPrecision:!0}),D=I.pixelsPerMeter,Z=I.pixelsPerMeter2,re=cm(e,P);re[0]+=_*(D[0]+Z[0]*x),re[1]+=x*(D[1]+Z[1]*x);var oe=e0(re,P),de=(u||0)+(E||0);return Number.isFinite(u)||Number.isFinite(E)?[oe[0],oe[1],de]:oe}function aA(e){var n=e.height,r=e.pitch,i=e.bearing,o=e.altitude,u=e.center,d=u===void 0?null:u,_=e.flipY,x=_===void 0?!1:_,E=dv();return ra(E,E,[0,0,-o]),Uu(E,E,[1,1,1/n]),ws(E,E,-r*mh),Lh(E,E,i*mh),x&&Uu(E,E,[1,-1,1]),d&&ra(E,E,Ha.negate([],d)),E}function oA(e){var n=e.width,r=e.height,i=e.altitude,o=i===void 0?nA:i,u=e.pitch,d=u===void 0?0:u,_=e.nearZMultiplier,x=_===void 0?1:_,E=e.farZMultiplier,P=E===void 0?1:E,I=d*mh,D=Math.atan(.5/o),Z=Math.sin(D)*o/Math.sin(Math.PI/2-I-D),re=Math.cos(Math.PI/2-I)*Z+o;return{fov:2*Math.atan(r/2/o),aspect:n/r,focalDistance:o,near:x,far:re*P}}function sA(e){var n=e.width,r=e.height,i=e.pitch,o=e.altitude,u=e.nearZMultiplier,d=e.farZMultiplier,_=oA({width:n,height:r,altitude:o,pitch:i,nearZMultiplier:u,farZMultiplier:d}),x=_.fov,E=_.aspect,P=_.near,I=_.far,D=B([],x,E,P,I);return D}function uA(e,n){var r=(0,An.Z)(e,3),i=r[0],o=r[1],u=r[2],d=u===void 0?0:u;return Np(Number.isFinite(i)&&Number.isFinite(o)&&Number.isFinite(d)),lm(n,[i,o,d,1])}function E1(e,n){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=(0,An.Z)(e,3),o=i[0],u=i[1],d=i[2];if(Np(Number.isFinite(o)&&Number.isFinite(u),"invalid pixel coordinate"),Number.isFinite(d)){var _=lm(n,[o,u,d,1]);return _}var x=lm(n,[o,u,0,1]),E=lm(n,[o,u,1,1]),P=x[2],I=E[2],D=P===I?0:((r||0)-P)/(I-P);return Fi.t7([],x,E,D)}var S1=dv(),lA=function(){function e(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=n.width,i=n.height,o=n.viewMatrix,u=o===void 0?S1:o,d=n.projectionMatrix,_=d===void 0?S1:d;(0,Ct.Z)(this,e),this.width=r||1,this.height=i||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=u,this.projectionMatrix=_;var x=dv();zu(x,x,this.projectionMatrix),zu(x,x,this.viewMatrix),this.viewProjectionMatrix=x;var E=dv();Uu(E,E,[this.width/2,-this.height/2,1]),ra(E,E,[1,-1,0]),zu(E,E,this.viewProjectionMatrix);var P=rh(dv(),E);if(!P)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=E,this.pixelUnprojectionMatrix=P,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return(0,qt.Z)(e,[{key:"equals",value:function(r){return r instanceof e?r.width===this.width&&r.height===this.height&&ut(r.projectionMatrix,this.projectionMatrix)&&ut(r.viewMatrix,this.viewMatrix):!1}},{key:"project",value:function(r){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=i.topLeft,u=o===void 0?!0:o,d=this.projectPosition(r),_=uA(d,this.pixelProjectionMatrix),x=(0,An.Z)(_,2),E=x[0],P=x[1],I=u?P:this.height-P;return r.length===2?[E,I]:[E,I,_[2]]}},{key:"unproject",value:function(r){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=i.topLeft,u=o===void 0?!0:o,d=i.targetZ,_=(0,An.Z)(r,3),x=_[0],E=_[1],P=_[2],I=u?E:this.height-E,D=d&&d*this.pixelsPerMeter,Z=E1([x,I,P],this.pixelUnprojectionMatrix,D),re=this.unprojectPosition(Z),oe=(0,An.Z)(re,3),de=oe[0],Fe=oe[1],it=oe[2];return Number.isFinite(P)?[de,Fe,it]:Number.isFinite(d)?[de,Fe,d]:[de,Fe]}},{key:"projectPosition",value:function(r){var i=this.projectFlat(r),o=(0,An.Z)(i,2),u=o[0],d=o[1],_=(r[2]||0)*this.pixelsPerMeter;return[u,d,_]}},{key:"unprojectPosition",value:function(r){var i=this.unprojectFlat(r),o=(0,An.Z)(i,2),u=o[0],d=o[1],_=(r[2]||0)/this.pixelsPerMeter;return[u,d,_]}},{key:"projectFlat",value:function(r){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return r}},{key:"unprojectFlat",value:function(r){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return r}}]),e}();function cA(e){var n=e.width,r=e.height,i=e.bounds,o=e.minExtent,u=o===void 0?0:o,d=e.maxZoom,_=d===void 0?24:d,x=e.padding,E=x===void 0?0:x,P=e.offset,I=P===void 0?[0,0]:P,D=(0,An.Z)(i,2),Z=(0,An.Z)(D[0],2),re=Z[0],oe=Z[1],de=(0,An.Z)(D[1],2),Fe=de[0],it=de[1];if(Number.isFinite(E)){var vt=E;E={top:vt,bottom:vt,left:vt,right:vt}}else Np(Number.isFinite(E.top)&&Number.isFinite(E.bottom)&&Number.isFinite(E.left)&&Number.isFinite(E.right));var xt=new w1({width:n,height:r,longitude:0,latitude:0,zoom:0}),Gt=xt.project([re,it]),Xt=xt.project([Fe,oe]),nr=[Math.max(Math.abs(Xt[0]-Gt[0]),u),Math.max(Math.abs(Xt[1]-Gt[1]),u)],mr=[n-E.left-E.right-Math.abs(I[0])*2,r-E.top-E.bottom-Math.abs(I[1])*2];Np(mr[0]>0&&mr[1]>0);var en=mr[0]/nr[0],hn=mr[1]/nr[1],wr=(E.right-E.left)/2/en,Pn=(E.bottom-E.top)/2/hn,jn=[(Xt[0]+Gt[0])/2+wr,(Xt[1]+Gt[1])/2+Pn],yi=xt.unproject(jn),Io=xt.zoom+Math.log2(Math.abs(Math.min(en,hn)));return{longitude:yi[0],latitude:yi[1],zoom:Math.min(Io,_)}}var w1=function(e){(0,Yr.Z)(n,e);function n(){var r,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=i.width,u=i.height,d=i.latitude,_=d===void 0?0:d,x=i.longitude,E=x===void 0?0:x,P=i.zoom,I=P===void 0?0:P,D=i.pitch,Z=D===void 0?0:D,re=i.bearing,oe=re===void 0?0:re,de=i.altitude,Fe=de===void 0?1.5:de,it=i.nearZMultiplier,vt=i.farZMultiplier;(0,Ct.Z)(this,n),o=o||1,u=u||1;var xt=x1(I);Fe=Math.max(.75,Fe);var Gt=cm([E,_],xt);Gt[2]=0;var Xt=sA({width:o,height:u,pitch:Z,bearing:oe,altitude:Fe,nearZMultiplier:it||1/u,farZMultiplier:vt||1.01}),nr=aA({height:u,center:Gt,pitch:Z,bearing:oe,altitude:Fe,flipY:!0});return r=(0,wn.Z)(this,(0,zt.Z)(n).call(this,{width:o,height:u,viewMatrix:nr,projectionMatrix:Xt})),r.latitude=_,r.longitude=E,r.zoom=I,r.pitch=Z,r.bearing=oe,r.altitude=Fe,r.scale=xt,r.center=Gt,r.pixelsPerMeter=b1((0,be.Z)((0,be.Z)(r))).pixelsPerMeter[2],Object.freeze((0,be.Z)((0,be.Z)(r))),r}return(0,qt.Z)(n,[{key:"projectFlat",value:function(i){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return cm(i,o)}},{key:"unprojectFlat",value:function(i){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return e0(i,o)}},{key:"getMapCenterByLngLatPosition",value:function(i){var o=i.lngLat,u=i.pos,d=E1(u,this.pixelUnprojectionMatrix),_=cm(o,this.scale),x=Fi.IH([],_,Fi.tk([],d)),E=Fi.IH([],this.center,x);return e0(E,this.scale)}},{key:"getLocationAtPoint",value:function(i){var o=i.lngLat,u=i.pos;return this.getMapCenterByLngLatPosition({lngLat:o,pos:u})}},{key:"fitBounds",value:function(i){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},u=this.width,d=this.height,_=cA(Object.assign({width:u,height:d,bounds:i},o)),x=_.longitude,E=_.latitude,P=_.zoom;return new n({width:u,height:d,longitude:x,latitude:E,zoom:P})}}]),n}(lA),fA=function(){function e(){(0,Ct.Z)(this,e),(0,C.Z)(this,"viewport",void 0)}return(0,qt.Z)(e,[{key:"syncWithMapCamera",value:function(r){var i=r.center,o=r.zoom,u=r.pitch,d=r.bearing,_=r.viewportHeight,x=r.viewportWidth;this.viewport=new w1({width:x,height:_,longitude:i&&i[0],latitude:i&&i[1],zoom:o,pitch:u,bearing:d})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(r,i){return this.viewport.projectFlat(r,i)}}]),e}(),C1={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},hA=["id","attributionControl","style","token","rotation","mapInstance"],T1,A1,M1,P1,I1,O1,xd,R1,L1,k1,D1;function F1(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function pA(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?F1(Object(r),!0).forEach(function(i){(0,C.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):F1(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function dA(e,n){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",i=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||i)&&(n||(n=document),!!n)){var o=n.head||n.getElementsByTagName("head")[0];if(!o){o=n.createElement("head");var u=n.body||n.getElementsByTagName("body")[0];u?u.parentNode.insertBefore(o,u):n.documentElement.appendChild(o)}var d=n.createElement("style");return d.type="text/css",d.styleSheet?d.styleSheet.cssText=e:d.appendChild(n.createTextNode(e)),o.appendChild(d),d}}dA(`.mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:pinch-zoom;touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:none;touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px ButtonText;box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){-webkit-box-shadow:none;box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;-webkit-box-sizing:border-box;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-box;display:-ms-flexbox;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:-webkit-box;display:-ms-flexbox;display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:"";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-shadow:0 0 3px rgba(0,0,0,.35);box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}`),window.mapboxgl=rA();var N1={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},vA=0,mA=12,B1="pk.eyJ1IjoibHp4dWUiLCJhIjoiY2tvaWZuM2s4MWZuYjJ1dHI5ZGduYTlrdiJ9.DQCfMRbZzx0VSwecQ69McA",gA=(T1=(0,Fr.b2)(),A1=(0,Fr.f3)($t.MapConfig),M1=(0,Fr.f3)($t.IGlobalConfigService),P1=(0,Fr.f3)($t.ICoordinateSystemService),I1=(0,Fr.f3)($t.IEventEmitter),T1(O1=(xd=function(){function e(){var n=this;(0,Ct.Z)(this,e),(0,C.Z)(this,"version",$m.MAPBOX),(0,C.Z)(this,"map",void 0),(0,C.Z)(this,"dragging",!1),(0,C.Z)(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),Bn(this,"config",R1,this),Bn(this,"configService",L1,this),Bn(this,"coordinateSystemService",k1,this),Bn(this,"eventEmitter",D1,this),(0,C.Z)(this,"viewport",void 0),(0,C.Z)(this,"markerContainer",void 0),(0,C.Z)(this,"cameraChangedCallback",void 0),(0,C.Z)(this,"$mapContainer",void 0),(0,C.Z)(this,"handleCameraChanged",function(){var r=n.map.getCenter().wrap(),i=r.lat,o=r.lng;n.emit("mapchange"),n.viewport.syncWithMapCamera({bearing:n.map.getBearing(),center:[o,i],viewportHeight:n.map.transform.height,pitch:n.map.getPitch(),viewportWidth:n.map.transform.width,zoom:n.map.getZoom(),cameraHeight:0});var u=n.config.offsetZoom,d=u===void 0?mA:u;n.viewport.getZoom()>d?n.coordinateSystemService.setCoordinateSystem(_o.LNGLAT_OFFSET):n.coordinateSystemService.setCoordinateSystem(_o.LNGLAT),n.cameraChangedCallback(n.viewport)})}return(0,qt.Z)(e,[{key:"setBgColor",value:function(r){this.bgColor=r}},{key:"addMarkerContainer",value:function(){var r=this.map.getCanvasContainer();this.markerContainer=za("div","l7-marker-container",r),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(r,i){fb.indexOf(r)!==-1?this.eventEmitter.on(r,i):this.map.on(N1[r]||r,i)}},{key:"off",value:function(r,i){this.map.off(N1[r]||r,i)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){var r=this.map.transform;return[r.width,r.height]}},{key:"getType",value:function(){return"mapbox"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(r){return this.map.setZoom(r)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(r){this.map.setCenter(r)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(r){this.map.setBearing(r)}},{key:"zoomIn",value:function(r,i){this.map.zoomIn(r,i)}},{key:"zoomOut",value:function(r,i){this.map.zoomOut(r,i)}},{key:"setPitch",value:function(r){return this.map.setPitch(r)}},{key:"panTo",value:function(r){this.map.panTo(r)}},{key:"panBy",value:function(r,i){this.panTo([r,i])}},{key:"fitBounds",value:function(r,i){this.map.fitBounds(r,i)}},{key:"setMaxZoom",value:function(r){this.map.setMaxZoom(r)}},{key:"setMinZoom",value:function(r){this.map.setMinZoom(r)}},{key:"setMapStatus",value:function(r){r.doubleClickZoom===!0&&this.map.doubleClickZoom.enable(),r.doubleClickZoom===!1&&this.map.doubleClickZoom.disable(),r.dragEnable===!1&&this.map.dragPan.disable(),r.dragEnable===!0&&this.map.dragPan.enable(),r.rotateEnable===!1&&this.map.dragRotate.disable(),r.rotateEnable===!0&&this.map.dragRotate.enable(),r.keyboardEnable===!1&&this.map.keyboard.disable(),r.keyboardEnable===!0&&this.map.keyboard.enable(),r.zoomEnable===!1&&this.map.scrollZoom.disable(),r.zoomEnable===!0&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(r,i){this.map.flyTo({zoom:r,center:i})}},{key:"setMapStyle",value:function(r){this.map.setStyle(this.getMapStyle(r))}},{key:"pixelToLngLat",value:function(r){return this.map.unproject(r)}},{key:"lngLatToPixel",value:function(r){return this.map.project(r)}},{key:"containerToLngLat",value:function(r){return this.map.unproject(r)}},{key:"lngLatToContainer",value:function(r){return this.map.project(r)}},{key:"lngLatToCoord",value:function(r){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{x:0,y:0,z:0},o=this.lngLatToMercator(r,0),u=o.x,d=o.y;return[u-i.x,d-i.y]}},{key:"lngLatToMercator",value:function(r,i){var o=window.mapboxgl.MercatorCoordinate.fromLngLat(r,i),u=o.x,d=u===void 0?0:u,_=o.y,x=_===void 0?0:_,E=o.z,P=E===void 0?0:E;return{x:d,y:x,z:P}}},{key:"getModelMatrix",value:function(r,i,o){var u=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],d=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0},_=window.mapboxgl.MercatorCoordinate.fromLngLat(r,i),x=_.meterInMercatorCoordinateUnits(),E=Ss();return ra(E,E,Ha.fromValues(_.x-d.x,_.y-d.y,_.z||0-d.z)),Uu(E,E,Ha.fromValues(x*u[0],-x*u[1],x*u[2])),ws(E,E,o[0]),Rh(E,E,o[1]),Lh(E,E,o[2]),E}},{key:"init",value:function(){var n=(0,nl.Z)(a().mark(function i(){var o=this,u,d,_,x,E,P,I,D,Z,re,oe,de,Fe;return a().wrap(function(vt){for(;;)switch(vt.prev=vt.next){case 0:u=this.config,d=u.id,_=d===void 0?"map":d,x=u.attributionControl,E=x===void 0?!1:x,P=u.style,I=P===void 0?"light":P,D=u.token,Z=D===void 0?B1:D,re=u.rotation,oe=re===void 0?0:re,de=u.mapInstance,Fe=(0,Sn.Z)(u,hA),this.viewport=new fA,!de&&!window.mapboxgl&&console.error(this.configService.getSceneWarninfo("SDK")),Z===B1&&I!=="blank"&&!window.mapboxgl.accessToken&&!de&&console.warn(this.configService.getSceneWarninfo("MapToken")),!de&&!window.mapboxgl.accessToken&&(window.mapboxgl.accessToken=Z),de?(this.map=de,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatAmapContainer(_),this.map=new window.mapboxgl.Map(pA({container:this.$mapContainer,style:this.getMapStyle(I),attributionControl:E,bearing:oe},Fe))),this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.map.on("dragstart",function(){return o.dragging=!0,""}),this.map.on("dragend",function(){return o.dragging=!1,""}),this.handleCameraChanged();case 11:case"end":return vt.stop()}},i,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"destroy",value:function(){var r,i;(r=this.$mapContainer)===null||r===void 0||(i=r.parentNode)===null||i===void 0||i.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(r){for(var i,o=arguments.length,u=new Array(o>1?o-1:0),d=1;d<o;d++)u[d-1]=arguments[d];(i=this.eventEmitter).emit.apply(i,[r].concat(u))}},{key:"once",value:function(r){for(var i,o=arguments.length,u=new Array(o>1?o-1:0),d=1;d<o;d++)u[d-1]=arguments[d];(i=this.eventEmitter).once.apply(i,[r].concat(u))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"exportMap",value:function(r){var i=this.map.getCanvas(),o=r==="jpg"?i==null?void 0:i.toDataURL("image/jpeg"):i==null?void 0:i.toDataURL("image/png");return o}},{key:"onCameraChanged",value:function(r){this.cameraChangedCallback=r}},{key:"creatAmapContainer",value:function(r){var i=r;typeof r=="string"&&(i=document.getElementById(r));var o=document.createElement("div");return o.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,o.id="l7_mapbox_div"+vA++,i.appendChild(o),o}},{key:"getMapStyle",value:function(r){return typeof r!="string"?r:C1[r]?C1[r]:r}}]),e}(),R1=Ln(xd.prototype,"config",[A1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),L1=Ln(xd.prototype,"configService",[M1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),k1=Ln(xd.prototype,"coordinateSystemService",[P1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D1=Ln(xd.prototype,"eventEmitter",[I1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xd))||O1);function yA(e){var n=_A();return function(){var i=(0,zt.Z)(e),o;if(n){var u=(0,zt.Z)(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return(0,wn.Z)(this,o)}}function _A(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function xA(e,n){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",i=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||i)&&(n||(n=document),!!n)){var o=n.head||n.getElementsByTagName("head")[0];if(!o){o=n.createElement("head");var u=n.body||n.getElementsByTagName("body")[0];u?u.parentNode.insertBefore(o,u):n.documentElement.appendChild(o)}var d=n.createElement("style");return d.type="text/css",d.styleSheet?d.styleSheet.cssText=e:d.appendChild(n.createTextNode(e)),o.appendChild(d),d}}xA(`.mapboxgl-ctrl-logo {
 display: none !important;
}
`);var bA=function(e){(0,Yr.Z)(r,e);var n=yA(r);function r(){return(0,Ct.Z)(this,r),n.apply(this,arguments)}return(0,qt.Z)(r,[{key:"getServiceConstructor",value:function(){return gA}}]),r}(eA);function z1(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function U1(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?z1(Object(r),!0).forEach(function(i){EA(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):z1(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function EA(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function SA(e,n){return AA(e)||TA(e,n)||CA(e,n)||wA()}function wA(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function CA(e,n){if(!!e){if(typeof e=="string")return Z1(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Z1(e,n)}}function Z1(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}function TA(e,n){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var i=[],o=!0,u=!1,d,_;try{for(r=r.call(e);!(o=(d=r.next()).done)&&(i.push(d.value),!(n&&i.length===n));o=!0);}catch(x){u=!0,_=x}finally{try{!o&&r.return!=null&&r.return()}finally{if(u)throw _}}return i}}function AA(e){if(Array.isArray(e))return e}var MA=j.memo(function(e){var n=e.style,r=e.className,i=e.map,o=e.option,u=e.onSceneLoaded,d=(0,j.createRef)(),_=(0,j.useState)(),x=SA(_,2),E=x[0],P=x[1];return(0,j.useEffect)(function(){var I=new $b(U1(U1({id:d.current},o),{},{map:new bA(i)}));return I.on("loaded",function(){P(I),u&&u(I)}),function(){I.destroy()}},[]),(0,j.useEffect)(function(){E&&i.style&&E.setMapStyle(i.style)},[JSON.stringify(i.style)]),(0,j.useEffect)(function(){E&&i.zoom&&E.setZoom(i.zoom)},[i.zoom]),(0,j.useEffect)(function(){E&&i.center&&E.setCenter(i.center)},[JSON.stringify(i.center)]),(0,j.useEffect)(function(){E&&i.pitch!==void 0&&E.setPitch(i.pitch||0)},[i.pitch]),(0,j.useEffect)(function(){E&&i.rotation&&E.setRotation(i.rotation)},[i.rotation]),j.createElement(v.Provider,{value:E},(0,j.createElement)("div",{ref:d,style:n,className:r},E&&e.children))}),PA=MA;function V1(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function uI(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?V1(Object(r),!0).forEach(function(i){IA(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):V1(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function IA(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function lI(e,n){return kA(e)||LA(e,n)||RA(e,n)||OA()}function OA(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function RA(e,n){if(!!e){if(typeof e=="string")return j1(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return j1(e,n)}}function j1(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}function LA(e,n){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var i=[],o=!0,u=!1,d,_;try{for(r=r.call(e);!(o=(d=r.next()).done)&&(i.push(d.value),!(n&&i.length===n));o=!0);}catch(x){u=!0,_=x}finally{try{!o&&r.return!=null&&r.return()}finally{if(u)throw _}}return i}}function kA(e){if(Array.isArray(e))return e}var cI=null,fI=null;function G1(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function hI(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?G1(Object(r),!0).forEach(function(i){DA(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):G1(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function DA(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function pI(e,n){return zA(e)||BA(e,n)||NA(e,n)||FA()}function FA(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function NA(e,n){if(!!e){if(typeof e=="string")return H1(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return H1(e,n)}}function H1(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}function BA(e,n){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var i=[],o=!0,u=!1,d,_;try{for(r=r.call(e);!(o=(d=r.next()).done)&&(i.push(d.value),!(n&&i.length===n));o=!0);}catch(x){u=!0,_=x}finally{try{!o&&r.return!=null&&r.return()}finally{if(u)throw _}}return i}}function zA(e){if(Array.isArray(e))return e}var dI=null,vI=null;function mI(e,n){return jA(e)||VA(e,n)||ZA(e,n)||UA()}function UA(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ZA(e,n){if(!!e){if(typeof e=="string")return W1(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return W1(e,n)}}function W1(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}function VA(e,n){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var i=[],o=!0,u=!1,d,_;try{for(r=r.call(e);!(o=(d=r.next()).done)&&(i.push(d.value),!(n&&i.length===n));o=!0);}catch(x){u=!0,_=x}finally{try{!o&&r.return!=null&&r.return()}finally{if(u)throw _}}return i}}function jA(e){if(Array.isArray(e))return e}var gI=null,yI=null;function X1(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function _I(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?X1(Object(r),!0).forEach(function(i){GA(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):X1(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function GA(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function xI(e,n){if(e==null)return{};var r=HA(e,n),i,o;if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);for(o=0;o<u.length;o++)i=u[o],!(n.indexOf(i)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,i)||(r[i]=e[i]))}return r}function HA(e,n){if(e==null)return{};var r={},i=Object.keys(e),o,u;for(u=0;u<i.length;u++)o=i[u],!(n.indexOf(o)>=0)&&(r[o]=e[o]);return r}var bI=null,Y1=L(73935);function q1(e,n){return qA(e)||YA(e,n)||XA(e,n)||WA()}function WA(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function XA(e,n){if(!!e){if(typeof e=="string")return K1(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return K1(e,n)}}function K1(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}function YA(e,n){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var i=[],o=!0,u=!1,d,_;try{for(r=r.call(e);!(o=(d=r.next()).done)&&(i.push(d.value),!(n&&i.length===n));o=!0);}catch(x){u=!0,_=x}finally{try{!o&&r.return!=null&&r.return()}finally{if(u)throw _}}return i}}function qA(e){if(Array.isArray(e))return e}var $1=j.useEffect,J1=j.useState,KA=/\B([A-Z])/g,$A=function(n){return n.replace(KA,"-$1").toLowerCase()};function EI(e){var n=e.className,r=e.style,i=e.children,o=e.position,u=J1(),d=q1(u,2),_=d[0],x=d[1],E=useSceneValue(),P=J1(function(){return document.createElement("div")}),I=q1(P,1),D=I[0];return $1(function(){var Z=new Control({position:o});return Z.onAdd=function(){if(n&&(D.className=n),r){var re=Object.keys(r).map(function(oe){return"".concat($A(oe),":").concat(r[oe])}).join(";");D.style.cssText=re}return D},Z.onRemove=function(){},x(Z),E.addControl(Z),function(){E.removeControl(Z)}},[]),$1(function(){_&&_.setPosition(o||"bottomleft")},[o]),createPortal(i,D)}var Q1=(0,j.createContext)({});function SI(){return useContext(Q1)}var Nf=L(96486),wI=j.useEffect,JA=j.memo(function(n){var r=n.layer,i=n.active;return r.active(i.option),null},Nf.isEqual),CI=j.useEffect,QA=j.memo(function(n){var r=n.layer,i=n.animate;return r.animate(i),null},Nf.isEqual),TI=j.useEffect,eM=j.memo(function(n){var r=n.layer,i=n.color;return i.field?r.color(i.field,i.values):r.color(i.values),null},Nf.isEqual),tM=j.memo(function(n){var r=n.layer,i=n.filter;return i.field&&r.filter(i.field,i.values),null},Nf.isEqual),rM=j.memo(function(n){var r=n.layer,i=n.scale;return r.scale(i.values),null},Nf.isEqual),AI=j.useEffect,nM=j.memo(function(n){var r=n.layer,i=n.select;return r.select(i.option),null},Nf.isEqual),iM=j.memo(function(n){var r=n.layer,i=n.shape;return i.field?r.shape(i.field,i.values):r.shape(i.values),null},Nf.isEqual),aM=j.memo(function(n){var r=n.layer,i=n.size;return i.field?r.size(i.field,i.values):r.size(i.values),null},Nf.isEqual),oM=["data"];function sM(e,n){if(e==null)return{};var r=uM(e,n),i,o;if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);for(o=0;o<u.length;o++)i=u[o],!(n.indexOf(i)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,i)||(r[i]=e[i]))}return r}function uM(e,n){if(e==null)return{};var r={},i=Object.keys(e),o,u;for(u=0;u<i.length;u++)o=i[u],!(n.indexOf(o)>=0)&&(r[o]=e[o]);return r}var lM=j.memo(function(n){var r=n.layer,i=n.source,o=i.data,u=sM(i,oM);return r.inited?r.setData(o,u):r.source(o,u),u.autoFit&&r.fitBounds(u&&u.fitBoundsOptions),null},Nf.isEqual),MI=j.useEffect,cM=j.memo(function(n){var r=n.layer,i=n.style;return r.style(i),null},Nf.isEqual);function fM(e,n){return vM(e)||dM(e,n)||pM(e,n)||hM()}function hM(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function pM(e,n){if(!!e){if(typeof e=="string")return ex(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ex(e,n)}}function ex(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}function dM(e,n){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var i=[],o=!0,u=!1,d,_;try{for(r=r.call(e);!(o=(d=r.next()).done)&&(i.push(d.value),!(n&&i.length===n));o=!0);}catch(x){u=!0,_=x}finally{try{!o&&r.return!=null&&r.return()}finally{if(u)throw _}}return i}}function vM(e){if(Array.isArray(e))return e}var vv=j.useEffect,mM=j.useState;function tx(e,n){var r=n.source,i=n.color,o=n.shape,u=n.style,d=n.size,_=n.scale,x=n.active,E=n.select,P=n.filter,I=n.animate,D=n.options,Z=n.onLayerLoaded,re=Q(),oe=mM(function(){var it;switch(e){case"polygonLayer":it=new ay(D);break;case"lineLayer":it=new rS(D);break;case"pointLayer":it=new jS(D);break;case"heatmapLayer":it=new p2(D);break;case"rasterLayer":it=new mw(D);break;case"imageLayer":it=new S2(D);break;case"citybuildingLayer":it=new BE(D);break;default:it=new ay(D)}return it.on("inited",function(){Z&&Z(it,re)}),it}),de=fM(oe,1),Fe=de[0];return vv(function(){return re.addLayer(Fe),function(){re.removeLayer(Fe)}},[]),vv(function(){Fe.inited&&D&&Fe.updateLayerConfig(D)},[D==null?void 0:D.minZoom,D==null?void 0:D.maxZoom,D==null?void 0:D.visible]),vv(function(){Fe.inited&&(D==null?void 0:D.zIndex)&&Fe.setIndex(D.zIndex)},[D==null?void 0:D.zIndex]),vv(function(){Fe.inited&&(D==null?void 0:D.blend)&&Fe.setBlend(D.blend)},[D==null?void 0:D.blend]),vv(function(){re.render()}),j.createElement(Q1.Provider,{value:Fe},j.createElement(lM,{layer:Fe,source:r}),_&&j.createElement(rM,{layer:Fe,scale:_}),i&&j.createElement(eM,{layer:Fe,color:i}),d&&j.createElement(aM,{layer:Fe,size:d}),o&&j.createElement(iM,{layer:Fe,shape:o}),u&&j.createElement(cM,{layer:Fe,style:u}),x&&j.createElement(JA,{layer:Fe,active:x}),E&&j.createElement(nM,{layer:Fe,select:E}),P&&j.createElement(tM,{layer:Fe,filter:P}),I&&j.createElement(QA,{layer:Fe,animate:I}),n.children)}var PI=null,II=null,gM=j.memo(function(n){return tx("pointLayer",n)}),yM=j.memo(function(n){return tx("heatmapLayer",n)}),OI=null,RI=null,LI=null,kI=j.useEffect,DI=null,FI=null;function fm(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?fm=function(r){return typeof r}:fm=function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},fm(e)}function rx(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function hm(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?rx(Object(r),!0).forEach(function(i){_M(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):rx(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function _M(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function xM(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function nx(e,n){for(var r=0;r<n.length;r++){var i=n[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function bM(e,n,r){return n&&nx(e.prototype,n),r&&nx(e,r),e}function EM(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),n&&t0(e,n)}function t0(e,n){return t0=Object.setPrototypeOf||function(i,o){return i.__proto__=o,i},t0(e,n)}function SM(e){var n=TM();return function(){var i=pm(e),o;if(n){var u=pm(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return wM(this,o)}}function wM(e,n){if(n&&(fm(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return CM(e)}function CM(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function TM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function pm(e){return pm=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)},pm(e)}var NI=function(e){EM(r,e);var n=SM(r);function r(i){var o;return xM(this,r),o=n.call(this,i),o.el=void 0,o.scene=void 0,o.popup=void 0,o.el=document.createElement("div"),o}return bM(r,[{key:"componentDidMount",value:function(){var o,u=this.props,d=u.lnglat,_=u.children,x=u.option,E=u.lngLat,P=new X0(hm(hm({},x),{},{stopPropagation:(o=this.props.option)===null||o===void 0?void 0:o.stopPropagation}));d&&P.setLnglat(d),E&&P.setLnglat(E),_&&P.setDOMContent(this.el),this.popup=P,this.scene.addPopup(P)}},{key:"componentDidUpdate",value:function(o){var u,d,_,x,E,P,I=Array.isArray(o.lnglat)?o.lnglat:[o==null||(u=o.lnglat)===null||u===void 0?void 0:u.lng,o==null||(d=o.lnglat)===null||d===void 0?void 0:d.lat],D=Array.isArray(this.props.lnglat)?this.props.lnglat:[(_=this.props)===null||_===void 0||(x=_.lnglat)===null||x===void 0?void 0:x.lng,(E=this.props)===null||E===void 0||(P=E.lnglat)===null||P===void 0?void 0:P.lat],Z=I.toString()!==D.toString();if(Z){var re;this.popup.remove(),this.popup=new X0(hm(hm({},this.props.option),{},{stopPropagation:(re=this.props.option)===null||re===void 0?void 0:re.stopPropagation})),this.popup.setLnglat(this.props.lnglat),this.popup.setDOMContent(this.el),this.scene.addPopup(this.popup)}}},{key:"componentWillUnmount",value:function(){this.popup.remove()}},{key:"render",value:function(){var o=this;return j.createElement(v.Consumer,{},function(u){return u&&(o.scene=u),(0,Y1.createPortal)(o.props.children,o.el)})}}]),r}(j.PureComponent);function dm(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?dm=function(r){return typeof r}:dm=function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},dm(e)}function AM(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function ix(e,n){for(var r=0;r<n.length;r++){var i=n[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function MM(e,n,r){return n&&ix(e.prototype,n),r&&ix(e,r),e}function PM(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),n&&r0(e,n)}function r0(e,n){return r0=Object.setPrototypeOf||function(i,o){return i.__proto__=o,i},r0(e,n)}function IM(e){var n=LM();return function(){var i=vm(e),o;if(n){var u=vm(this).constructor;o=Reflect.construct(i,arguments,u)}else o=i.apply(this,arguments);return OM(this,o)}}function OM(e,n){if(n&&(dm(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return RM(e)}function RM(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function LM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function vm(e){return vm=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)},vm(e)}var BI=function(e){PM(r,e);var n=IM(r);function r(i){var o;return AM(this,r),o=n.call(this,i),o.el=void 0,o.scene=void 0,o.marker=void 0,o.el=document.createElement("div"),o}return MM(r,[{key:"componentDidMount",value:function(){var o=this.props,u=o.lnglat,d=o.children,_=o.option,x=o.onMarkerLoaded,E=new V0(_);u&&E.setLnglat(u),d&&E.setElement(this.el),this.marker=E,x&&x(E),this.scene.addMarker(E)}},{key:"componentDidUpdate",value:function(o){var u,d=(o==null?void 0:o.lnglat.toString())!==((u=this.props)===null||u===void 0?void 0:u.lnglat.toString());d&&this.marker.setLnglat(this.props.lnglat)}},{key:"componentWillUnmount",value:function(){this.marker&&this.marker.remove()}},{key:"render",value:function(){var o=this;return j.createElement(v.Consumer,{},function(u){return u&&(o.scene=u),(0,Y1.createPortal)(o.props.children,o.el)})}}]),r}(j.PureComponent),zI=j.useEffect,UI=null,ZI=null,VI=j.useEffect,jI=null},66213:function(Ue,W,L){"use strict";L.d(W,{Z:function(){return v}});var X=L(77608);function j(Q,F){for(;!Object.prototype.hasOwnProperty.call(Q,F)&&(Q=(0,X.Z)(Q),Q!==null););return Q}function v(){return typeof Reflect!="undefined"&&Reflect.get?v=Reflect.get:v=function(F,J,ne){var ye=j(F,J);if(!!ye){var K=Object.getOwnPropertyDescriptor(ye,J);return K.get?K.get.call(arguments.length<3?F:ne):K.value}},v.apply(this,arguments)}},31795:function(Ue,W,L){var X=L(75752);Ue.exports.geometry=j,Ue.exports.ring=Q;function j(J){var ne=0,ye;switch(J.type){case"Polygon":return v(J.coordinates);case"MultiPolygon":for(ye=0;ye<J.coordinates.length;ye++)ne+=v(J.coordinates[ye]);return ne;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(ye=0;ye<J.geometries.length;ye++)ne+=j(J.geometries[ye]);return ne}}function v(J){var ne=0;if(J&&J.length>0){ne+=Math.abs(Q(J[0]));for(var ye=1;ye<J.length;ye++)ne-=Math.abs(Q(J[ye]))}return ne}function Q(J){var ne,ye,K,Ne,Ve,ke,ot,Jt=0,pt=J.length;if(pt>2){for(ot=0;ot<pt;ot++)ot===pt-2?(Ne=pt-2,Ve=pt-1,ke=0):ot===pt-1?(Ne=pt-1,Ve=0,ke=1):(Ne=ot,Ve=ot+1,ke=ot+2),ne=J[Ne],ye=J[Ve],K=J[ke],Jt+=(F(K[0])-F(ne[0]))*Math.sin(F(ye[1]));Jt=Jt*X.RADIUS*X.RADIUS/2}return Jt}function F(J){return J*Math.PI/180}},38163:function(Ue,W,L){var X=L(31795);Ue.exports=j;function j(ye,K){switch(ye&&ye.type||null){case"FeatureCollection":return ye.features=ye.features.map(v(j,K)),ye;case"GeometryCollection":return ye.geometries=ye.geometries.map(v(j,K)),ye;case"Feature":return ye.geometry=j(ye.geometry,K),ye;case"Polygon":case"MultiPolygon":return Q(ye,K);default:return ye}}function v(ye,K){return function(Ne){return ye(Ne,K)}}function Q(ye,K){return ye.type==="Polygon"?ye.coordinates=F(ye.coordinates,K):ye.type==="MultiPolygon"&&(ye.coordinates=ye.coordinates.map(v(F,K))),ye}function F(ye,K){K=!!K,ye[0]=J(ye[0],K);for(var Ne=1;Ne<ye.length;Ne++)ye[Ne]=J(ye[Ne],!K);return ye}function J(ye,K){return ne(ye)===K?ye:ye.reverse()}function ne(ye){return X.ring(ye)>=0}},53645:function(Ue){Ue.exports={"ant-pro-grid-content":"ant-pro-grid-content",wide:"wide"}},9187:function(Ue){"use strict";Ue.exports=W,Ue.exports.default=W;function W(C,we,Le){Le=Le||2;var Et=we&&we.length,gt=Et?we[0]*Le:C.length,Lt=L(C,0,gt,Le,!0),Yt=[];if(!Lt||Lt.next===Lt.prev)return Yt;var br,Yn,cn,ci,Zn,ri,fi;if(Et&&(Lt=ne(C,we,Lt,Le)),C.length>80*Le){br=cn=C[0],Yn=ci=C[1];for(var Gn=Le;Gn<gt;Gn+=Le)Zn=C[Gn],ri=C[Gn+1],Zn<br&&(br=Zn),ri<Yn&&(Yn=ri),Zn>cn&&(cn=Zn),ri>ci&&(ci=ri);fi=Math.max(cn-br,ci-Yn),fi=fi!==0?1/fi:0}return j(Lt,Yt,Le,br,Yn,fi),Yt}function L(C,we,Le,Et,gt){var Lt,Yt;if(gt===jr(C,we,Le,Et)>0)for(Lt=we;Lt<Le;Lt+=Et)Yt=Rt(Lt,C[Lt],C[Lt+1],Yt);else for(Lt=Le-Et;Lt>=we;Lt-=Et)Yt=Rt(Lt,C[Lt],C[Lt+1],Yt);return Yt&&et(Yt,Yt.next)&&(dr(Yt),Yt=Yt.next),Yt}function X(C,we){if(!C)return C;we||(we=C);var Le=C,Et;do if(Et=!1,!Le.steiner&&(et(Le,Le.next)||nt(Le.prev,Le,Le.next)===0)){if(dr(Le),Le=we=Le.prev,Le===Le.next)break;Et=!0}else Le=Le.next;while(Et||Le!==we);return we}function j(C,we,Le,Et,gt,Lt,Yt){if(!!C){!Yt&&Lt&&ke(C,Et,gt,Lt);for(var br=C,Yn,cn;C.prev!==C.next;){if(Yn=C.prev,cn=C.next,Lt?Q(C,Et,gt,Lt):v(C)){we.push(Yn.i/Le),we.push(C.i/Le),we.push(cn.i/Le),dr(C),C=cn.next,br=cn.next;continue}if(C=cn,C===br){Yt?Yt===1?(C=F(X(C),we,Le),j(C,we,Le,Et,gt,Lt,2)):Yt===2&&J(C,we,Le,Et,gt,Lt):j(X(C),we,Le,Et,gt,Lt,1);break}}}}function v(C){var we=C.prev,Le=C,Et=C.next;if(nt(we,Le,Et)>=0)return!1;for(var gt=C.next.next;gt!==C.prev;){if(Zt(we.x,we.y,Le.x,Le.y,Et.x,Et.y,gt.x,gt.y)&&nt(gt.prev,gt,gt.next)>=0)return!1;gt=gt.next}return!0}function Q(C,we,Le,Et){var gt=C.prev,Lt=C,Yt=C.next;if(nt(gt,Lt,Yt)>=0)return!1;for(var br=gt.x<Lt.x?gt.x<Yt.x?gt.x:Yt.x:Lt.x<Yt.x?Lt.x:Yt.x,Yn=gt.y<Lt.y?gt.y<Yt.y?gt.y:Yt.y:Lt.y<Yt.y?Lt.y:Yt.y,cn=gt.x>Lt.x?gt.x>Yt.x?gt.x:Yt.x:Lt.x>Yt.x?Lt.x:Yt.x,ci=gt.y>Lt.y?gt.y>Yt.y?gt.y:Yt.y:Lt.y>Yt.y?Lt.y:Yt.y,Zn=Jt(br,Yn,we,Le,Et),ri=Jt(cn,ci,we,Le,Et),fi=C.prevZ,Gn=C.nextZ;fi&&fi.z>=Zn&&Gn&&Gn.z<=ri;){if(fi!==C.prev&&fi!==C.next&&Zt(gt.x,gt.y,Lt.x,Lt.y,Yt.x,Yt.y,fi.x,fi.y)&&nt(fi.prev,fi,fi.next)>=0||(fi=fi.prevZ,Gn!==C.prev&&Gn!==C.next&&Zt(gt.x,gt.y,Lt.x,Lt.y,Yt.x,Yt.y,Gn.x,Gn.y)&&nt(Gn.prev,Gn,Gn.next)>=0))return!1;Gn=Gn.nextZ}for(;fi&&fi.z>=Zn;){if(fi!==C.prev&&fi!==C.next&&Zt(gt.x,gt.y,Lt.x,Lt.y,Yt.x,Yt.y,fi.x,fi.y)&&nt(fi.prev,fi,fi.next)>=0)return!1;fi=fi.prevZ}for(;Gn&&Gn.z<=ri;){if(Gn!==C.prev&&Gn!==C.next&&Zt(gt.x,gt.y,Lt.x,Lt.y,Yt.x,Yt.y,Gn.x,Gn.y)&&nt(Gn.prev,Gn,Gn.next)>=0)return!1;Gn=Gn.nextZ}return!0}function F(C,we,Le){var Et=C;do{var gt=Et.prev,Lt=Et.next.next;!et(gt,Lt)&&kt(gt,Et,Et.next,Lt)&&Ye(gt,Lt)&&Ye(Lt,gt)&&(we.push(gt.i/Le),we.push(Et.i/Le),we.push(Lt.i/Le),dr(Et),dr(Et.next),Et=C=Lt),Et=Et.next}while(Et!==C);return X(Et)}function J(C,we,Le,Et,gt,Lt){var Yt=C;do{for(var br=Yt.next.next;br!==Yt.prev;){if(Yt.i!==br.i&&_t(Yt,br)){var Yn=Je(Yt,br);Yt=X(Yt,Yt.next),Yn=X(Yn,Yn.next),j(Yt,we,Le,Et,gt,Lt),j(Yn,we,Le,Et,gt,Lt);return}br=br.next}Yt=Yt.next}while(Yt!==C)}function ne(C,we,Le,Et){var gt=[],Lt,Yt,br,Yn,cn;for(Lt=0,Yt=we.length;Lt<Yt;Lt++)br=we[Lt]*Et,Yn=Lt<Yt-1?we[Lt+1]*Et:C.length,cn=L(C,br,Yn,Et,!1),cn===cn.next&&(cn.steiner=!0),gt.push(pt(cn));for(gt.sort(ye),Lt=0;Lt<gt.length;Lt++)Le=K(gt[Lt],Le),Le=X(Le,Le.next);return Le}function ye(C,we){return C.x-we.x}function K(C,we){var Le=Ne(C,we);if(!Le)return we;var Et=Je(Le,C),gt=X(Le,Le.next);return X(Et,Et.next),we===Le?gt:we}function Ne(C,we){var Le=we,Et=C.x,gt=C.y,Lt=-Infinity,Yt;do{if(gt<=Le.y&&gt>=Le.next.y&&Le.next.y!==Le.y){var br=Le.x+(gt-Le.y)*(Le.next.x-Le.x)/(Le.next.y-Le.y);if(br<=Et&&br>Lt){if(Lt=br,br===Et){if(gt===Le.y)return Le;if(gt===Le.next.y)return Le.next}Yt=Le.x<Le.next.x?Le:Le.next}}Le=Le.next}while(Le!==we);if(!Yt)return null;if(Et===Lt)return Yt;var Yn=Yt,cn=Yt.x,ci=Yt.y,Zn=Infinity,ri;Le=Yt;do Et>=Le.x&&Le.x>=cn&&Et!==Le.x&&Zt(gt<ci?Et:Lt,gt,cn,ci,gt<ci?Lt:Et,gt,Le.x,Le.y)&&(ri=Math.abs(gt-Le.y)/(Et-Le.x),Ye(Le,C)&&(ri<Zn||ri===Zn&&(Le.x>Yt.x||Le.x===Yt.x&&Ve(Yt,Le)))&&(Yt=Le,Zn=ri)),Le=Le.next;while(Le!==Yn);return Yt}function Ve(C,we){return nt(C.prev,C,we.prev)<0&&nt(we.next,C,C.next)<0}function ke(C,we,Le,Et){var gt=C;do gt.z===null&&(gt.z=Jt(gt.x,gt.y,we,Le,Et)),gt.prevZ=gt.prev,gt.nextZ=gt.next,gt=gt.next;while(gt!==C);gt.prevZ.nextZ=null,gt.prevZ=null,ot(gt)}function ot(C){var we,Le,Et,gt,Lt,Yt,br,Yn,cn=1;do{for(Le=C,C=null,Lt=null,Yt=0;Le;){for(Yt++,Et=Le,br=0,we=0;we<cn&&(br++,Et=Et.nextZ,!!Et);we++);for(Yn=cn;br>0||Yn>0&&Et;)br!==0&&(Yn===0||!Et||Le.z<=Et.z)?(gt=Le,Le=Le.nextZ,br--):(gt=Et,Et=Et.nextZ,Yn--),Lt?Lt.nextZ=gt:C=gt,gt.prevZ=Lt,Lt=gt;Le=Et}Lt.nextZ=null,cn*=2}while(Yt>1);return C}function Jt(C,we,Le,Et,gt){return C=32767*(C-Le)*gt,we=32767*(we-Et)*gt,C=(C|C<<8)&16711935,C=(C|C<<4)&252645135,C=(C|C<<2)&858993459,C=(C|C<<1)&1431655765,we=(we|we<<8)&16711935,we=(we|we<<4)&252645135,we=(we|we<<2)&858993459,we=(we|we<<1)&1431655765,C|we<<1}function pt(C){var we=C,Le=C;do(we.x<Le.x||we.x===Le.x&&we.y<Le.y)&&(Le=we),we=we.next;while(we!==C);return Le}function Zt(C,we,Le,Et,gt,Lt,Yt,br){return(gt-Yt)*(we-br)-(C-Yt)*(Lt-br)>=0&&(C-Yt)*(Et-br)-(Le-Yt)*(we-br)>=0&&(Le-Yt)*(Lt-br)-(gt-Yt)*(Et-br)>=0}function _t(C,we){return C.next.i!==we.i&&C.prev.i!==we.i&&!st(C,we)&&(Ye(C,we)&&Ye(we,C)&&ct(C,we)&&(nt(C.prev,C,we.prev)||nt(C,we.prev,we))||et(C,we)&&nt(C.prev,C,C.next)>0&&nt(we.prev,we,we.next)>0)}function nt(C,we,Le){return(we.y-C.y)*(Le.x-we.x)-(we.x-C.x)*(Le.y-we.y)}function et(C,we){return C.x===we.x&&C.y===we.y}function kt(C,we,Le,Et){var gt=Wt(nt(C,we,Le)),Lt=Wt(nt(C,we,Et)),Yt=Wt(nt(Le,Et,C)),br=Wt(nt(Le,Et,we));return!!(gt!==Lt&&Yt!==br||gt===0&&Y(C,Le,we)||Lt===0&&Y(C,Et,we)||Yt===0&&Y(Le,C,Et)||br===0&&Y(Le,we,Et))}function Y(C,we,Le){return we.x<=Math.max(C.x,Le.x)&&we.x>=Math.min(C.x,Le.x)&&we.y<=Math.max(C.y,Le.y)&&we.y>=Math.min(C.y,Le.y)}function Wt(C){return C>0?1:C<0?-1:0}function st(C,we){var Le=C;do{if(Le.i!==C.i&&Le.next.i!==C.i&&Le.i!==we.i&&Le.next.i!==we.i&&kt(Le,Le.next,C,we))return!0;Le=Le.next}while(Le!==C);return!1}function Ye(C,we){return nt(C.prev,C,C.next)<0?nt(C,we,C.next)>=0&&nt(C,C.prev,we)>=0:nt(C,we,C.prev)<0||nt(C,C.next,we)<0}function ct(C,we){var Le=C,Et=!1,gt=(C.x+we.x)/2,Lt=(C.y+we.y)/2;do Le.y>Lt!=Le.next.y>Lt&&Le.next.y!==Le.y&&gt<(Le.next.x-Le.x)*(Lt-Le.y)/(Le.next.y-Le.y)+Le.x&&(Et=!Et),Le=Le.next;while(Le!==C);return Et}function Je(C,we){var Le=new Mr(C.i,C.x,C.y),Et=new Mr(we.i,we.x,we.y),gt=C.next,Lt=we.prev;return C.next=we,we.prev=C,Le.next=gt,gt.prev=Le,Et.next=Le,Le.prev=Et,Lt.next=Et,Et.prev=Lt,Et}function Rt(C,we,Le,Et){var gt=new Mr(C,we,Le);return Et?(gt.next=Et.next,gt.prev=Et,Et.next.prev=gt,Et.next=gt):(gt.prev=gt,gt.next=gt),gt}function dr(C){C.next.prev=C.prev,C.prev.next=C.next,C.prevZ&&(C.prevZ.nextZ=C.nextZ),C.nextZ&&(C.nextZ.prevZ=C.prevZ)}function Mr(C,we,Le){this.i=C,this.x=we,this.y=Le,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}W.deviation=function(C,we,Le,Et){var gt=we&&we.length,Lt=gt?we[0]*Le:C.length,Yt=Math.abs(jr(C,0,Lt,Le));if(gt)for(var br=0,Yn=we.length;br<Yn;br++){var cn=we[br]*Le,ci=br<Yn-1?we[br+1]*Le:C.length;Yt-=Math.abs(jr(C,cn,ci,Le))}var Zn=0;for(br=0;br<Et.length;br+=3){var ri=Et[br]*Le,fi=Et[br+1]*Le,Gn=Et[br+2]*Le;Zn+=Math.abs((C[ri]-C[Gn])*(C[fi+1]-C[ri+1])-(C[ri]-C[fi])*(C[Gn+1]-C[ri+1]))}return Yt===0&&Zn===0?0:Math.abs((Zn-Yt)/Yt)};function jr(C,we,Le,Et){for(var gt=0,Lt=we,Yt=Le-Et;Lt<Le;Lt+=Et)gt+=(C[Yt]-C[Lt])*(C[Lt+1]+C[Yt+1]),Yt=Lt;return gt}W.flatten=function(C){for(var we=C[0][0].length,Le={vertices:[],holes:[],dimensions:we},Et=0,gt=0;gt<C.length;gt++){for(var Lt=0;Lt<C[gt].length;Lt++)for(var Yt=0;Yt<we;Yt++)Le.vertices.push(C[gt][Lt][Yt]);gt>0&&(Et+=C[gt-1].length,Le.holes.push(Et))}return Le}},67709:function(Ue){function W(X){var j=X.target||X.srcElement;j.__resizeRAF__&&cancelAnimationFrame(j.__resizeRAF__),j.__resizeRAF__=requestAnimationFrame(function(){var v=j.__resizeTrigger__,Q=v&&v.__resizeListeners__;Q&&Q.forEach(function(F){F.call(v,X)})})}var L=function(j,v){var Q=this,F=Q.document,J,ne=F.attachEvent;typeof navigator!="undefined"&&(J=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/));function ye(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",W)}if(!j.__resizeListeners__)if(j.__resizeListeners__=[],ne)j.__resizeTrigger__=j,j.attachEvent("onresize",W);else{getComputedStyle(j).position==="static"&&(j.style.position="relative");var K=j.__resizeTrigger__=F.createElement("object");K.setAttribute("style","position: absolute; top: 0; left: 0; height: 100%; width: 100%; pointer-events: none; z-index: -1; opacity: 0;"),K.setAttribute("class","resize-sensor"),K.setAttribute("tabindex","-1"),K.setAttribute("title",""),K.__resizeElement__=j,K.onload=ye,K.type="text/html",J&&j.appendChild(K),K.data="about:blank",J||j.appendChild(K)}j.__resizeListeners__.push(v)};Ue.exports=typeof window=="undefined"?L:L.bind(window),Ue.exports.unbind=function(X,j){var v=document.attachEvent,Q=X.__resizeListeners__||[];if(j){var F=Q.indexOf(j);F!==-1&&Q.splice(F,1)}else Q=X.__resizeListeners__=[];if(!Q.length){if(v)X.detachEvent("onresize",W);else if(X.__resizeTrigger__){var J=X.__resizeTrigger__.contentDocument,ne=J&&J.defaultView;ne&&(ne.removeEventListener("resize",W),delete ne.__resizeTrigger__),X.__resizeTrigger__=!X.removeChild(X.__resizeTrigger__)}delete X.__resizeListeners__}}},26729:function(Ue){"use strict";var W=Object.prototype.hasOwnProperty,L="~";function X(){}Object.create&&(X.prototype=Object.create(null),new X().__proto__||(L=!1));function j(J,ne,ye){this.fn=J,this.context=ne,this.once=ye||!1}function v(J,ne,ye,K,Ne){if(typeof ye!="function")throw new TypeError("The listener must be a function");var Ve=new j(ye,K||J,Ne),ke=L?L+ne:ne;return J._events[ke]?J._events[ke].fn?J._events[ke]=[J._events[ke],Ve]:J._events[ke].push(Ve):(J._events[ke]=Ve,J._eventsCount++),J}function Q(J,ne){--J._eventsCount==0?J._events=new X:delete J._events[ne]}function F(){this._events=new X,this._eventsCount=0}F.prototype.eventNames=function(){var ne=[],ye,K;if(this._eventsCount===0)return ne;for(K in ye=this._events)W.call(ye,K)&&ne.push(L?K.slice(1):K);return Object.getOwnPropertySymbols?ne.concat(Object.getOwnPropertySymbols(ye)):ne},F.prototype.listeners=function(ne){var ye=L?L+ne:ne,K=this._events[ye];if(!K)return[];if(K.fn)return[K.fn];for(var Ne=0,Ve=K.length,ke=new Array(Ve);Ne<Ve;Ne++)ke[Ne]=K[Ne].fn;return ke},F.prototype.listenerCount=function(ne){var ye=L?L+ne:ne,K=this._events[ye];return K?K.fn?1:K.length:0},F.prototype.emit=function(ne,ye,K,Ne,Ve,ke){var ot=L?L+ne:ne;if(!this._events[ot])return!1;var Jt=this._events[ot],pt=arguments.length,Zt,_t;if(Jt.fn){switch(Jt.once&&this.removeListener(ne,Jt.fn,void 0,!0),pt){case 1:return Jt.fn.call(Jt.context),!0;case 2:return Jt.fn.call(Jt.context,ye),!0;case 3:return Jt.fn.call(Jt.context,ye,K),!0;case 4:return Jt.fn.call(Jt.context,ye,K,Ne),!0;case 5:return Jt.fn.call(Jt.context,ye,K,Ne,Ve),!0;case 6:return Jt.fn.call(Jt.context,ye,K,Ne,Ve,ke),!0}for(_t=1,Zt=new Array(pt-1);_t<pt;_t++)Zt[_t-1]=arguments[_t];Jt.fn.apply(Jt.context,Zt)}else{var nt=Jt.length,et;for(_t=0;_t<nt;_t++)switch(Jt[_t].once&&this.removeListener(ne,Jt[_t].fn,void 0,!0),pt){case 1:Jt[_t].fn.call(Jt[_t].context);break;case 2:Jt[_t].fn.call(Jt[_t].context,ye);break;case 3:Jt[_t].fn.call(Jt[_t].context,ye,K);break;case 4:Jt[_t].fn.call(Jt[_t].context,ye,K,Ne);break;default:if(!Zt)for(et=1,Zt=new Array(pt-1);et<pt;et++)Zt[et-1]=arguments[et];Jt[_t].fn.apply(Jt[_t].context,Zt)}}return!0},F.prototype.on=function(ne,ye,K){return v(this,ne,ye,K,!1)},F.prototype.once=function(ne,ye,K){return v(this,ne,ye,K,!0)},F.prototype.removeListener=function(ne,ye,K,Ne){var Ve=L?L+ne:ne;if(!this._events[Ve])return this;if(!ye)return Q(this,Ve),this;var ke=this._events[Ve];if(ke.fn)ke.fn===ye&&(!Ne||ke.once)&&(!K||ke.context===K)&&Q(this,Ve);else{for(var ot=0,Jt=[],pt=ke.length;ot<pt;ot++)(ke[ot].fn!==ye||Ne&&!ke[ot].once||K&&ke[ot].context!==K)&&Jt.push(ke[ot]);Jt.length?this._events[Ve]=Jt.length===1?Jt[0]:Jt:Q(this,Ve)}return this},F.prototype.removeAllListeners=function(ne){var ye;return ne?(ye=L?L+ne:ne,this._events[ye]&&Q(this,ye)):(this._events=new X,this._eventsCount=0),this},F.prototype.off=F.prototype.removeListener,F.prototype.addListener=F.prototype.on,F.prefixed=L,F.EventEmitter=F,Ue.exports=F},7375:function(Ue,W){"use strict";Object.defineProperty(W,"__esModule",{value:!0});var L=Symbol.for("INJECTION");function X(J,ne,ye,K){function Ne(){return K&&!Reflect.hasMetadata(L,this,ne)&&Reflect.defineMetadata(L,ye(),this,ne),Reflect.hasMetadata(L,this,ne)?Reflect.getMetadata(L,this,ne):ye()}function Ve(ke){Reflect.defineMetadata(L,ke,this,ne)}Object.defineProperty(J,ne,{configurable:!0,enumerable:!0,get:Ne,set:Ve})}function j(J,ne){return function(ye){return function(K,Ne){var Ve=function(){return J.get(ye)};X(K,Ne,Ve,ne)}}}W.makePropertyInjectDecorator=j;function v(J,ne){return function(ye,K){return function(Ne,Ve){var ke=function(){return J.getNamed(ye,K)};X(Ne,Ve,ke,ne)}}}W.makePropertyInjectNamedDecorator=v;function Q(J,ne){return function(ye,K,Ne){return function(Ve,ke){var ot=function(){return J.getTagged(ye,K,Ne)};X(Ve,ke,ot,ne)}}}W.makePropertyInjectTaggedDecorator=Q;function F(J,ne){return function(ye){return function(K,Ne){var Ve=function(){return J.getAll(ye)};X(K,Ne,Ve,ne)}}}W.makePropertyMultiInjectDecorator=F},84879:function(Ue,W,L){"use strict";var X;X={value:!0};var j=L(7375);function v(Q,F){F===void 0&&(F=!0);var J=j.makePropertyInjectDecorator(Q,F),ne=j.makePropertyInjectNamedDecorator(Q,F),ye=j.makePropertyInjectTaggedDecorator(Q,F),K=j.makePropertyMultiInjectDecorator(Q,F);return{lazyInject:J,lazyInjectNamed:ne,lazyInjectTagged:ye,lazyMultiInject:K}}W.Z=v},99934:function(Ue,W,L){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.tagProperty=W.tagParameter=W.decorate=void 0;var X=L(16674),j=L(6867);function v(K,Ne,Ve,ke){var ot=j.TAGGED;F(ot,K,Ne,ke,Ve)}W.tagParameter=v;function Q(K,Ne,Ve){var ke=j.TAGGED_PROP;F(ke,K.constructor,Ne,Ve)}W.tagProperty=Q;function F(K,Ne,Ve,ke,ot){var Jt={},pt=typeof ot=="number",Zt=ot!==void 0&&pt?ot.toString():Ve;if(pt&&Ve!==void 0)throw new Error(X.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(K,Ne)&&(Jt=Reflect.getMetadata(K,Ne));var _t=Jt[Zt];if(!Array.isArray(_t))_t=[];else for(var nt=0,et=_t;nt<et.length;nt++){var kt=et[nt];if(kt.key===ke.key)throw new Error(X.DUPLICATED_METADATA+" "+kt.key.toString())}_t.push(ke),Jt[Zt]=_t,Reflect.defineMetadata(K,Jt,Ne)}function J(K,Ne){Reflect.decorate(K,Ne)}function ne(K,Ne){return function(Ve,ke){Ne(Ve,ke,K)}}function ye(K,Ne,Ve){typeof Ve=="number"?J([ne(Ve,K)],Ne):typeof Ve=="string"?Reflect.decorate([K],Ne,Ve):J([K],Ne)}W.decorate=ye},5744:function(Ue,W,L){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.inject=W.LazyServiceIdentifer=void 0;var X=L(16674),j=L(6867),v=L(47738),Q=L(99934),F=function(){function ne(ye){this._cb=ye}return ne.prototype.unwrap=function(){return this._cb()},ne}();W.LazyServiceIdentifer=F;function J(ne){return function(ye,K,Ne){if(ne===void 0)throw new Error(X.UNDEFINED_INJECT_ANNOTATION(ye.name));var Ve=new v.Metadata(j.INJECT_TAG,ne);typeof Ne=="number"?Q.tagParameter(ye,K,Ne,Ve):Q.tagProperty(ye,K,Ve)}}W.inject=J},64315:function(Ue,W,L){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.injectable=void 0;var X=L(16674),j=L(6867);function v(){return function(Q){if(Reflect.hasOwnMetadata(j.PARAM_TYPES,Q))throw new Error(X.DUPLICATED_INJECTABLE_DECORATOR);var F=Reflect.getMetadata(j.DESIGN_PARAM_TYPES,Q)||[];return Reflect.defineMetadata(j.PARAM_TYPES,F,Q),Q}}W.injectable=v},71693:function(Ue,W,L){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.multiInject=void 0;var X=L(6867),j=L(47738),v=L(99934);function Q(F){return function(J,ne,ye){var K=new j.Metadata(X.MULTI_INJECT_TAG,F);typeof ye=="number"?v.tagParameter(J,ne,ye,K):v.tagProperty(J,ne,K)}}W.multiInject=Q},38085:function(Ue,W,L){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.named=void 0;var X=L(6867),j=L(47738),v=L(99934);function Q(F){return function(J,ne,ye){var K=new j.Metadata(X.NAMED_TAG,F);typeof ye=="number"?v.tagParameter(J,ne,ye,K):v.tagProperty(J,ne,K)}}W.named=Q},6515:function(Ue,W,L){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.optional=void 0;var X=L(6867),j=L(47738),v=L(99934);function Q(){return function(F,J,ne){var ye=new j.Metadata(X.OPTIONAL_TAG,!0);typeof ne=="number"?v.tagParameter(F,J,ne,ye):v.tagProperty(F,J,ye)}}W.optional=Q},7014:function(Ue,W,L){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.postConstruct=void 0;var X=L(16674),j=L(6867),v=L(47738);function Q(){return function(F,J,ne){var ye=new v.Metadata(j.POST_CONSTRUCT,J);if(Reflect.hasOwnMetadata(j.POST_CONSTRUCT,F.constructor))throw new Error(X.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(j.POST_CONSTRUCT,ye,F.constructor)}}W.postConstruct=Q},32052:function(Ue,W,L){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.tagged=void 0;var X=L(47738),j=L(99934);function v(Q,F){return function(J,ne,ye){var K=new X.Metadata(Q,F);typeof ye=="number"?j.tagParameter(J,ne,ye,K):j.tagProperty(J,ne,K)}}W.tagged=v},55638:function(Ue,W,L){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.targetName=void 0;var X=L(6867),j=L(47738),v=L(99934);function Q(F){return function(J,ne,ye){var K=new j.Metadata(X.NAME_TAG,F);v.tagParameter(J,ne,ye,K)}}W.targetName=Q},86757:function(Ue,W,L){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.unmanaged=void 0;var X=L(6867),j=L(47738),v=L(99934);function Q(){return function(F,J,ne){var ye=new j.Metadata(X.UNMANAGED_TAG,!0);v.tagParameter(F,J,ne,ye)}}W.unmanaged=Q},44290:function(Ue,W,L){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.Binding=void 0;var X=L(28421),j=L(37791),v=function(){function Q(F,J){this.id=j.id(),this.activated=!1,this.serviceIdentifier=F,this.scope=J,this.type=X.BindingTypeEnum.Invalid,this.constraint=function(ne){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return Q.prototype.clone=function(){var F=new Q(this.serviceIdentifier,this.scope);return F.activated=F.scope===X.BindingScopeEnum.Singleton?this.activated:!1,F.implementationType=this.implementationType,F.dynamicValue=this.dynamicValue,F.scope=this.scope,F.type=this.type,F.factory=this.factory,F.provider=this.provider,F.constraint=this.constraint,F.onActivation=this.onActivation,F.cache=this.cache,F},Q}();W.Binding=v},23184:function(Ue,W){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.BindingCount=void 0;var L={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};W.BindingCount=L},16674:function(Ue,W){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.STACK_OVERFLOW=W.CIRCULAR_DEPENDENCY_IN_FACTORY=W.POST_CONSTRUCT_ERROR=W.MULTIPLE_POST_CONSTRUCT_METHODS=W.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=W.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=W.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=W.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=W.ARGUMENTS_LENGTH_MISMATCH=W.INVALID_DECORATOR_OPERATION=W.INVALID_TO_SELF_VALUE=W.INVALID_FUNCTION_BINDING=W.INVALID_MIDDLEWARE_RETURN=W.NO_MORE_SNAPSHOTS_AVAILABLE=W.INVALID_BINDING_TYPE=W.NOT_IMPLEMENTED=W.CIRCULAR_DEPENDENCY=W.UNDEFINED_INJECT_ANNOTATION=W.MISSING_INJECT_ANNOTATION=W.MISSING_INJECTABLE_ANNOTATION=W.NOT_REGISTERED=W.CANNOT_UNBIND=W.AMBIGUOUS_MATCH=W.KEY_NOT_FOUND=W.NULL_ARGUMENT=W.DUPLICATED_METADATA=W.DUPLICATED_INJECTABLE_DECORATOR=void 0,W.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",W.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",W.NULL_ARGUMENT="NULL argument",W.KEY_NOT_FOUND="Key Not Found",W.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",W.CANNOT_UNBIND="Could not unbind serviceIdentifier:",W.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",W.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",W.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";var L=function(Q){return"@inject called with undefined this could mean that the class "+Q+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."};W.UNDEFINED_INJECT_ANNOTATION=L,W.CIRCULAR_DEPENDENCY="Circular dependency found:",W.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",W.INVALID_BINDING_TYPE="Invalid binding type:",W.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",W.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",W.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",W.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",W.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";var X=function(){for(var Q=[],F=0;F<arguments.length;F++)Q[F]=arguments[F];return"The number of constructor arguments in the derived class "+(Q[0]+" must be >= than the number of constructor arguments of its base class.")};W.ARGUMENTS_LENGTH_MISMATCH=X,W.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",W.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",W.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",W.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",W.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";var j=function(){for(var Q=[],F=0;F<arguments.length;F++)Q[F]=arguments[F];return"@postConstruct error in class "+Q[0]+": "+Q[1]};W.POST_CONSTRUCT_ERROR=j;var v=function(){for(var Q=[],F=0;F<arguments.length;F++)Q[F]=arguments[F];return"It looks like there is a circular dependency "+("in one of the '"+Q[0]+"' bindings. Please investigate bindings with")+("service identifier '"+Q[1]+"'.")};W.CIRCULAR_DEPENDENCY_IN_FACTORY=v,W.STACK_OVERFLOW="Maximum call stack size exceeded"},28421:function(Ue,W){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.TargetTypeEnum=W.BindingTypeEnum=W.BindingScopeEnum=void 0;var L={Request:"Request",Singleton:"Singleton",Transient:"Transient"};W.BindingScopeEnum=L;var X={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};W.BindingTypeEnum=X;var j={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};W.TargetTypeEnum=j},6867:function(Ue,W){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.NON_CUSTOM_TAG_KEYS=W.POST_CONSTRUCT=W.DESIGN_PARAM_TYPES=W.PARAM_TYPES=W.TAGGED_PROP=W.TAGGED=W.MULTI_INJECT_TAG=W.INJECT_TAG=W.OPTIONAL_TAG=W.UNMANAGED_TAG=W.NAME_TAG=W.NAMED_TAG=void 0,W.NAMED_TAG="named",W.NAME_TAG="name",W.UNMANAGED_TAG="unmanaged",W.OPTIONAL_TAG="optional",W.INJECT_TAG="inject",W.MULTI_INJECT_TAG="multi_inject",W.TAGGED="inversify:tagged",W.TAGGED_PROP="inversify:tagged_props",W.PARAM_TYPES="inversify:paramtypes",W.DESIGN_PARAM_TYPES="design:paramtypes",W.POST_CONSTRUCT="post_construct";function L(){return[W.INJECT_TAG,W.MULTI_INJECT_TAG,W.NAME_TAG,W.UNMANAGED_TAG,W.NAMED_TAG,W.OPTIONAL_TAG]}W.NON_CUSTOM_TAG_KEYS=L()},51389:function(Ue,W,L){"use strict";var X=this&&this.__awaiter||function(_t,nt,et,kt){function Y(Wt){return Wt instanceof et?Wt:new et(function(st){st(Wt)})}return new(et||(et=Promise))(function(Wt,st){function Ye(Rt){try{Je(kt.next(Rt))}catch(dr){st(dr)}}function ct(Rt){try{Je(kt.throw(Rt))}catch(dr){st(dr)}}function Je(Rt){Rt.done?Wt(Rt.value):Y(Rt.value).then(Ye,ct)}Je((kt=kt.apply(_t,nt||[])).next())})},j=this&&this.__generator||function(_t,nt){var et={label:0,sent:function(){if(Wt[0]&1)throw Wt[1];return Wt[1]},trys:[],ops:[]},kt,Y,Wt,st;return st={next:Ye(0),throw:Ye(1),return:Ye(2)},typeof Symbol=="function"&&(st[Symbol.iterator]=function(){return this}),st;function Ye(Je){return function(Rt){return ct([Je,Rt])}}function ct(Je){if(kt)throw new TypeError("Generator is already executing.");for(;et;)try{if(kt=1,Y&&(Wt=Je[0]&2?Y.return:Je[0]?Y.throw||((Wt=Y.return)&&Wt.call(Y),0):Y.next)&&!(Wt=Wt.call(Y,Je[1])).done)return Wt;switch(Y=0,Wt&&(Je=[Je[0]&2,Wt.value]),Je[0]){case 0:case 1:Wt=Je;break;case 4:return et.label++,{value:Je[1],done:!1};case 5:et.label++,Y=Je[1],Je=[0];continue;case 7:Je=et.ops.pop(),et.trys.pop();continue;default:if(Wt=et.trys,!(Wt=Wt.length>0&&Wt[Wt.length-1])&&(Je[0]===6||Je[0]===2)){et=0;continue}if(Je[0]===3&&(!Wt||Je[1]>Wt[0]&&Je[1]<Wt[3])){et.label=Je[1];break}if(Je[0]===6&&et.label<Wt[1]){et.label=Wt[1],Wt=Je;break}if(Wt&&et.label<Wt[2]){et.label=Wt[2],et.ops.push(Je);break}Wt[2]&&et.ops.pop(),et.trys.pop();continue}Je=nt.call(_t,et)}catch(Rt){Je=[6,Rt],Y=0}finally{kt=Wt=0}if(Je[0]&5)throw Je[1];return{value:Je[0]?Je[1]:void 0,done:!0}}},v=this&&this.__spreadArray||function(_t,nt){for(var et=0,kt=nt.length,Y=_t.length;et<kt;et++,Y++)_t[Y]=nt[et];return _t};Object.defineProperty(W,"__esModule",{value:!0}),W.Container=void 0;var Q=L(44290),F=L(16674),J=L(28421),ne=L(6867),ye=L(51377),K=L(86311),Ne=L(31927),Ve=L(15451),ke=L(37791),ot=L(55800),Jt=L(85700),pt=L(80175),Zt=function(){function _t(nt){this._appliedMiddleware=[];var et=nt||{};if(typeof et!="object")throw new Error(""+F.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(et.defaultScope===void 0)et.defaultScope=J.BindingScopeEnum.Transient;else if(et.defaultScope!==J.BindingScopeEnum.Singleton&&et.defaultScope!==J.BindingScopeEnum.Transient&&et.defaultScope!==J.BindingScopeEnum.Request)throw new Error(""+F.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(et.autoBindInjectable===void 0)et.autoBindInjectable=!1;else if(typeof et.autoBindInjectable!="boolean")throw new Error(""+F.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(et.skipBaseClassChecks===void 0)et.skipBaseClassChecks=!1;else if(typeof et.skipBaseClassChecks!="boolean")throw new Error(""+F.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:et.autoBindInjectable,defaultScope:et.defaultScope,skipBaseClassChecks:et.skipBaseClassChecks},this.id=ke.id(),this._bindingDictionary=new pt.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new ye.MetadataReader}return _t.merge=function(nt,et){for(var kt=[],Y=2;Y<arguments.length;Y++)kt[Y-2]=arguments[Y];var Wt=new _t,st=v([nt,et],kt).map(function(Je){return K.getBindingDictionary(Je)}),Ye=K.getBindingDictionary(Wt);function ct(Je,Rt){Je.traverse(function(dr,Mr){Mr.forEach(function(jr){Rt.add(jr.serviceIdentifier,jr.clone())})})}return st.forEach(function(Je){ct(Je,Ye)}),Wt},_t.prototype.load=function(){for(var nt=[],et=0;et<arguments.length;et++)nt[et]=arguments[et];for(var kt=this._getContainerModuleHelpersFactory(),Y=0,Wt=nt;Y<Wt.length;Y++){var st=Wt[Y],Ye=kt(st.id);st.registry(Ye.bindFunction,Ye.unbindFunction,Ye.isboundFunction,Ye.rebindFunction)}},_t.prototype.loadAsync=function(){for(var nt=[],et=0;et<arguments.length;et++)nt[et]=arguments[et];return X(this,void 0,void 0,function(){var kt,Y,Wt,st,Ye;return j(this,function(ct){switch(ct.label){case 0:kt=this._getContainerModuleHelpersFactory(),Y=0,Wt=nt,ct.label=1;case 1:return Y<Wt.length?(st=Wt[Y],Ye=kt(st.id),[4,st.registry(Ye.bindFunction,Ye.unbindFunction,Ye.isboundFunction,Ye.rebindFunction)]):[3,4];case 2:ct.sent(),ct.label=3;case 3:return Y++,[3,1];case 4:return[2]}})})},_t.prototype.unload=function(){for(var nt=this,et=[],kt=0;kt<arguments.length;kt++)et[kt]=arguments[kt];var Y=function(Wt){return function(st){return st.moduleId===Wt}};et.forEach(function(Wt){var st=Y(Wt.id);nt._bindingDictionary.removeByCondition(st)})},_t.prototype.bind=function(nt){var et=this.options.defaultScope||J.BindingScopeEnum.Transient,kt=new Q.Binding(nt,et);return this._bindingDictionary.add(nt,kt),new Ve.BindingToSyntax(kt)},_t.prototype.rebind=function(nt){return this.unbind(nt),this.bind(nt)},_t.prototype.unbind=function(nt){try{this._bindingDictionary.remove(nt)}catch(et){throw new Error(F.CANNOT_UNBIND+" "+ot.getServiceIdentifierAsString(nt))}},_t.prototype.unbindAll=function(){this._bindingDictionary=new pt.Lookup},_t.prototype.isBound=function(nt){var et=this._bindingDictionary.hasKey(nt);return!et&&this.parent&&(et=this.parent.isBound(nt)),et},_t.prototype.isBoundNamed=function(nt,et){return this.isBoundTagged(nt,ne.NAMED_TAG,et)},_t.prototype.isBoundTagged=function(nt,et,kt){var Y=!1;if(this._bindingDictionary.hasKey(nt)){var Wt=this._bindingDictionary.get(nt),st=K.createMockRequest(this,nt,et,kt);Y=Wt.some(function(Ye){return Ye.constraint(st)})}return!Y&&this.parent&&(Y=this.parent.isBoundTagged(nt,et,kt)),Y},_t.prototype.snapshot=function(){this._snapshots.push(Jt.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},_t.prototype.restore=function(){var nt=this._snapshots.pop();if(nt===void 0)throw new Error(F.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=nt.bindings,this._middleware=nt.middleware},_t.prototype.createChild=function(nt){var et=new _t(nt||this.options);return et.parent=this,et},_t.prototype.applyMiddleware=function(){for(var nt=[],et=0;et<arguments.length;et++)nt[et]=arguments[et];this._appliedMiddleware=this._appliedMiddleware.concat(nt);var kt=this._middleware?this._middleware:this._planAndResolve();this._middleware=nt.reduce(function(Y,Wt){return Wt(Y)},kt)},_t.prototype.applyCustomMetadataReader=function(nt){this._metadataReader=nt},_t.prototype.get=function(nt){return this._get(!1,!1,J.TargetTypeEnum.Variable,nt)},_t.prototype.getTagged=function(nt,et,kt){return this._get(!1,!1,J.TargetTypeEnum.Variable,nt,et,kt)},_t.prototype.getNamed=function(nt,et){return this.getTagged(nt,ne.NAMED_TAG,et)},_t.prototype.getAll=function(nt){return this._get(!0,!0,J.TargetTypeEnum.Variable,nt)},_t.prototype.getAllTagged=function(nt,et,kt){return this._get(!1,!0,J.TargetTypeEnum.Variable,nt,et,kt)},_t.prototype.getAllNamed=function(nt,et){return this.getAllTagged(nt,ne.NAMED_TAG,et)},_t.prototype.resolve=function(nt){var et=this.createChild();return et.bind(nt).toSelf(),this._appliedMiddleware.forEach(function(kt){et.applyMiddleware(kt)}),et.get(nt)},_t.prototype._getContainerModuleHelpersFactory=function(){var nt=this,et=function(Ye,ct){Ye._binding.moduleId=ct},kt=function(Ye){return function(ct){var Je=nt.bind.bind(nt),Rt=Je(ct);return et(Rt,Ye),Rt}},Y=function(Ye){return function(ct){var Je=nt.unbind.bind(nt);Je(ct)}},Wt=function(Ye){return function(ct){var Je=nt.isBound.bind(nt);return Je(ct)}},st=function(Ye){return function(ct){var Je=nt.rebind.bind(nt),Rt=Je(ct);return et(Rt,Ye),Rt}};return function(Ye){return{bindFunction:kt(Ye),isboundFunction:Wt(Ye),rebindFunction:st(Ye),unbindFunction:Y(Ye)}}},_t.prototype._get=function(nt,et,kt,Y,Wt,st){var Ye=null,ct={avoidConstraints:nt,contextInterceptor:function(Je){return Je},isMultiInject:et,key:Wt,serviceIdentifier:Y,targetType:kt,value:st};if(this._middleware){if(Ye=this._middleware(ct),Ye==null)throw new Error(F.INVALID_MIDDLEWARE_RETURN)}else Ye=this._planAndResolve()(ct);return Ye},_t.prototype._planAndResolve=function(){var nt=this;return function(et){var kt=K.plan(nt._metadataReader,nt,et.isMultiInject,et.targetType,et.serviceIdentifier,et.key,et.value,et.avoidConstraints);kt=et.contextInterceptor(kt);var Y=Ne.resolve(kt);return Y}},_t}();W.Container=Zt},33244:function(Ue,W,L){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.AsyncContainerModule=W.ContainerModule=void 0;var X=L(37791),j=function(){function Q(F){this.id=X.id(),this.registry=F}return Q}();W.ContainerModule=j;var v=function(){function Q(F){this.id=X.id(),this.registry=F}return Q}();W.AsyncContainerModule=v},85700:function(Ue,W){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.ContainerSnapshot=void 0;var L=function(){function X(){}return X.of=function(j,v){var Q=new X;return Q.bindings=j,Q.middleware=v,Q},X}();W.ContainerSnapshot=L},80175:function(Ue,W,L){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.Lookup=void 0;var X=L(16674),j=function(){function v(){this._map=new Map}return v.prototype.getMap=function(){return this._map},v.prototype.add=function(Q,F){if(Q==null)throw new Error(X.NULL_ARGUMENT);if(F==null)throw new Error(X.NULL_ARGUMENT);var J=this._map.get(Q);J!==void 0?(J.push(F),this._map.set(Q,J)):this._map.set(Q,[F])},v.prototype.get=function(Q){if(Q==null)throw new Error(X.NULL_ARGUMENT);var F=this._map.get(Q);if(F!==void 0)return F;throw new Error(X.KEY_NOT_FOUND)},v.prototype.remove=function(Q){if(Q==null)throw new Error(X.NULL_ARGUMENT);if(!this._map.delete(Q))throw new Error(X.KEY_NOT_FOUND)},v.prototype.removeByCondition=function(Q){var F=this;this._map.forEach(function(J,ne){var ye=J.filter(function(K){return!Q(K)});ye.length>0?F._map.set(ne,ye):F._map.delete(ne)})},v.prototype.hasKey=function(Q){if(Q==null)throw new Error(X.NULL_ARGUMENT);return this._map.has(Q)},v.prototype.clone=function(){var Q=new v;return this._map.forEach(function(F,J){F.forEach(function(ne){return Q.add(J,ne.clone())})}),Q},v.prototype.traverse=function(Q){this._map.forEach(function(F,J){Q(J,F)})},v}();W.Lookup=j},86700:function(Ue,W,L){"use strict";var X;X={value:!0},X=X=X=X=X=X=W.GW=X=X=W.zY=X=X=X=X=X=W.f3=X=X=W.b2=X=X=X=X=X=W.W2=X=void 0;var j=L(6867);X=j;var v=L(51389);Object.defineProperty(W,"W2",{enumerable:!0,get:function(){return v.Container}});var Q=L(28421);X={enumerable:!0,get:function(){return Q.BindingScopeEnum}},X={enumerable:!0,get:function(){return Q.BindingTypeEnum}},X={enumerable:!0,get:function(){return Q.TargetTypeEnum}};var F=L(33244);X={enumerable:!0,get:function(){return F.AsyncContainerModule}},X={enumerable:!0,get:function(){return F.ContainerModule}};var J=L(64315);Object.defineProperty(W,"b2",{enumerable:!0,get:function(){return J.injectable}});var ne=L(32052);X={enumerable:!0,get:function(){return ne.tagged}};var ye=L(38085);X={enumerable:!0,get:function(){return ye.named}};var K=L(5744);Object.defineProperty(W,"f3",{enumerable:!0,get:function(){return K.inject}}),X={enumerable:!0,get:function(){return K.LazyServiceIdentifer}};var Ne=L(6515);X={enumerable:!0,get:function(){return Ne.optional}};var Ve=L(86757);X={enumerable:!0,get:function(){return Ve.unmanaged}};var ke=L(71693);X={enumerable:!0,get:function(){return ke.multiInject}};var ot=L(55638);X={enumerable:!0,get:function(){return ot.targetName}};var Jt=L(7014);Object.defineProperty(W,"zY",{enumerable:!0,get:function(){return Jt.postConstruct}});var pt=L(51377);X={enumerable:!0,get:function(){return pt.MetadataReader}};var Zt=L(37791);X={enumerable:!0,get:function(){return Zt.id}};var _t=L(99934);Object.defineProperty(W,"GW",{enumerable:!0,get:function(){return _t.decorate}});var nt=L(80758);X={enumerable:!0,get:function(){return nt.traverseAncerstors}},X={enumerable:!0,get:function(){return nt.taggedConstraint}},X={enumerable:!0,get:function(){return nt.namedConstraint}},X={enumerable:!0,get:function(){return nt.typeConstraint}};var et=L(55800);X={enumerable:!0,get:function(){return et.getServiceIdentifierAsString}};var kt=L(70600);X={enumerable:!0,get:function(){return kt.multiBindToService}}},95228:function(Ue,W,L){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.Context=void 0;var X=L(37791),j=function(){function v(Q){this.id=X.id(),this.container=Q}return v.prototype.addPlan=function(Q){this.plan=Q},v.prototype.setCurrentRequest=function(Q){this.currentRequest=Q},v}();W.Context=j},47738:function(Ue,W,L){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.Metadata=void 0;var X=L(6867),j=function(){function v(Q,F){this.key=Q,this.value=F}return v.prototype.toString=function(){return this.key===X.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},v}();W.Metadata=j},51377:function(Ue,W,L){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.MetadataReader=void 0;var X=L(6867),j=function(){function v(){}return v.prototype.getConstructorMetadata=function(Q){var F=Reflect.getMetadata(X.PARAM_TYPES,Q),J=Reflect.getMetadata(X.TAGGED,Q);return{compilerGeneratedMetadata:F,userGeneratedMetadata:J||{}}},v.prototype.getPropertiesMetadata=function(Q){var F=Reflect.getMetadata(X.TAGGED_PROP,Q)||[];return F},v}();W.MetadataReader=j},55314:function(Ue,W){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.Plan=void 0;var L=function(){function X(j,v){this.parentContext=j,this.rootRequest=v}return X}();W.Plan=L},86311:function(Ue,W,L){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.getBindingDictionary=W.createMockRequest=W.plan=void 0;var X=L(23184),j=L(16674),v=L(28421),Q=L(6867),F=L(85265),J=L(55800),ne=L(95228),ye=L(47738),K=L(55314),Ne=L(6e3),Ve=L(6748),ke=L(18924);function ot(Y){return Y._bindingDictionary}W.getBindingDictionary=ot;function Jt(Y,Wt,st,Ye,ct,Je){var Rt=Y?Q.MULTI_INJECT_TAG:Q.INJECT_TAG,dr=new ye.Metadata(Rt,st),Mr=new ke.Target(Wt,Ye,st,dr);if(ct!==void 0){var jr=new ye.Metadata(ct,Je);Mr.metadata.push(jr)}return Mr}function pt(Y,Wt,st,Ye,ct){var Je=nt(st.container,ct.serviceIdentifier),Rt=[];return Je.length===X.BindingCount.NoBindingsAvailable&&st.container.options.autoBindInjectable&&typeof ct.serviceIdentifier=="function"&&Y.getConstructorMetadata(ct.serviceIdentifier).compilerGeneratedMetadata&&(st.container.bind(ct.serviceIdentifier).toSelf(),Je=nt(st.container,ct.serviceIdentifier)),Wt?Rt=Je:Rt=Je.filter(function(dr){var Mr=new Ve.Request(dr.serviceIdentifier,st,Ye,dr,ct);return dr.constraint(Mr)}),Zt(ct.serviceIdentifier,Rt,ct,st.container),Rt}function Zt(Y,Wt,st,Ye){switch(Wt.length){case X.BindingCount.NoBindingsAvailable:if(st.isOptional())return Wt;var ct=J.getServiceIdentifierAsString(Y),Je=j.NOT_REGISTERED;throw Je+=J.listMetadataForTarget(ct,st),Je+=J.listRegisteredBindingsForServiceIdentifier(Ye,ct,nt),new Error(Je);case X.BindingCount.OnlyOneBindingAvailable:if(!st.isArray())return Wt;case X.BindingCount.MultipleBindingsAvailable:default:if(st.isArray())return Wt;var ct=J.getServiceIdentifierAsString(Y),Je=j.AMBIGUOUS_MATCH+" "+ct;throw Je+=J.listRegisteredBindingsForServiceIdentifier(Ye,ct,nt),new Error(Je)}}function _t(Y,Wt,st,Ye,ct,Je){var Rt,dr;if(ct===null){Rt=pt(Y,Wt,Ye,null,Je),dr=new Ve.Request(st,Ye,null,Rt,Je);var Mr=new K.Plan(Ye,dr);Ye.addPlan(Mr)}else Rt=pt(Y,Wt,Ye,ct,Je),dr=ct.addChildRequest(Je.serviceIdentifier,Rt,Je);Rt.forEach(function(jr){var C=null;if(Je.isArray())C=dr.addChildRequest(jr.serviceIdentifier,jr,Je);else{if(jr.cache)return;C=dr}if(jr.type===v.BindingTypeEnum.Instance&&jr.implementationType!==null){var we=Ne.getDependencies(Y,jr.implementationType);if(!Ye.container.options.skipBaseClassChecks){var Le=Ne.getBaseClassDependencyCount(Y,jr.implementationType);if(we.length<Le){var Et=j.ARGUMENTS_LENGTH_MISMATCH(Ne.getFunctionName(jr.implementationType));throw new Error(Et)}}we.forEach(function(gt){_t(Y,!1,gt.serviceIdentifier,Ye,C,gt)})}})}function nt(Y,Wt){var st=[],Ye=ot(Y);return Ye.hasKey(Wt)?st=Ye.get(Wt):Y.parent!==null&&(st=nt(Y.parent,Wt)),st}function et(Y,Wt,st,Ye,ct,Je,Rt,dr){dr===void 0&&(dr=!1);var Mr=new ne.Context(Wt),jr=Jt(st,Ye,ct,"",Je,Rt);try{return _t(Y,dr,ct,Mr,null,jr),Mr}catch(C){throw F.isStackOverflowExeption(C)&&Mr.plan&&J.circularDependencyToException(Mr.plan.rootRequest),C}}W.plan=et;function kt(Y,Wt,st,Ye){var ct=new ke.Target(v.TargetTypeEnum.Variable,"",Wt,new ye.Metadata(st,Ye)),Je=new ne.Context(Y),Rt=new Ve.Request(Wt,Je,null,[],ct);return Rt}W.createMockRequest=kt},88460:function(Ue,W){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.QueryableString=void 0;var L=function(){function X(j){this.str=j}return X.prototype.startsWith=function(j){return this.str.indexOf(j)===0},X.prototype.endsWith=function(j){var v="",Q=j.split("").reverse().join("");return v=this.str.split("").reverse().join(""),this.startsWith.call({str:v},Q)},X.prototype.contains=function(j){return this.str.indexOf(j)!==-1},X.prototype.equals=function(j){return this.str===j},X.prototype.value=function(){return this.str},X}();W.QueryableString=L},6e3:function(Ue,W,L){"use strict";var X=this&&this.__spreadArray||function(pt,Zt){for(var _t=0,nt=Zt.length,et=pt.length;_t<nt;_t++,et++)pt[et]=Zt[_t];return pt};Object.defineProperty(W,"__esModule",{value:!0}),W.getFunctionName=W.getBaseClassDependencyCount=W.getDependencies=void 0;var j=L(5744),v=L(16674),Q=L(28421),F=L(6867),J=L(55800);Object.defineProperty(W,"getFunctionName",{enumerable:!0,get:function(){return J.getFunctionName}});var ne=L(18924);function ye(pt,Zt){var _t=J.getFunctionName(Zt),nt=K(pt,_t,Zt,!1);return nt}W.getDependencies=ye;function K(pt,Zt,_t,nt){var et=pt.getConstructorMetadata(_t),kt=et.compilerGeneratedMetadata;if(kt===void 0){var Y=v.MISSING_INJECTABLE_ANNOTATION+" "+Zt+".";throw new Error(Y)}var Wt=et.userGeneratedMetadata,st=Object.keys(Wt),Ye=_t.length===0&&st.length>0,ct=st.length>_t.length,Je=Ye||ct?st.length:_t.length,Rt=Ve(nt,Zt,kt,Wt,Je),dr=ke(pt,_t),Mr=X(X([],Rt),dr);return Mr}function Ne(pt,Zt,_t,nt,et){var kt=et[pt.toString()]||[],Y=Jt(kt),Wt=Y.unmanaged!==!0,st=nt[pt],Ye=Y.inject||Y.multiInject;if(st=Ye||st,st instanceof j.LazyServiceIdentifer&&(st=st.unwrap()),Wt){var ct=st===Object,Je=st===Function,Rt=st===void 0,dr=ct||Je||Rt;if(!Zt&&dr){var Mr=v.MISSING_INJECT_ANNOTATION+" argument "+pt+" in class "+_t+".";throw new Error(Mr)}var jr=new ne.Target(Q.TargetTypeEnum.ConstructorArgument,Y.targetName,st);return jr.metadata=kt,jr}return null}function Ve(pt,Zt,_t,nt,et){for(var kt=[],Y=0;Y<et;Y++){var Wt=Y,st=Ne(Wt,pt,Zt,_t,nt);st!==null&&kt.push(st)}return kt}function ke(pt,Zt){for(var _t=pt.getPropertiesMetadata(Zt),nt=[],et=Object.keys(_t),kt=0,Y=et;kt<Y.length;kt++){var Wt=Y[kt],st=_t[Wt],Ye=Jt(_t[Wt]),ct=Ye.targetName||Wt,Je=Ye.inject||Ye.multiInject,Rt=new ne.Target(Q.TargetTypeEnum.ClassProperty,ct,Je);Rt.metadata=st,nt.push(Rt)}var dr=Object.getPrototypeOf(Zt.prototype).constructor;if(dr!==Object){var Mr=ke(pt,dr);nt=X(X([],nt),Mr)}return nt}function ot(pt,Zt){var _t=Object.getPrototypeOf(Zt.prototype).constructor;if(_t!==Object){var nt=J.getFunctionName(_t),et=K(pt,nt,_t,!0),kt=et.map(function(st){return st.metadata.filter(function(Ye){return Ye.key===F.UNMANAGED_TAG})}),Y=[].concat.apply([],kt).length,Wt=et.length-Y;return Wt>0?Wt:ot(pt,_t)}else return 0}W.getBaseClassDependencyCount=ot;function Jt(pt){var Zt={};return pt.forEach(function(_t){Zt[_t.key.toString()]=_t.value}),{inject:Zt[F.INJECT_TAG],multiInject:Zt[F.MULTI_INJECT_TAG],targetName:Zt[F.NAME_TAG],unmanaged:Zt[F.UNMANAGED_TAG]}}},6748:function(Ue,W,L){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.Request=void 0;var X=L(37791),j=function(){function v(Q,F,J,ne,ye){this.id=X.id(),this.serviceIdentifier=Q,this.parentContext=F,this.parentRequest=J,this.target=ye,this.childRequests=[],this.bindings=Array.isArray(ne)?ne:[ne],this.requestScope=J===null?new Map:null}return v.prototype.addChildRequest=function(Q,F,J){var ne=new v(Q,this.parentContext,this,F,J);return this.childRequests.push(ne),ne},v}();W.Request=j},18924:function(Ue,W,L){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.Target=void 0;var X=L(6867),j=L(37791),v=L(47738),Q=L(88460),F=function(){function J(ne,ye,K,Ne){this.id=j.id(),this.type=ne,this.serviceIdentifier=K,this.name=new Q.QueryableString(ye||""),this.metadata=new Array;var Ve=null;typeof Ne=="string"?Ve=new v.Metadata(X.NAMED_TAG,Ne):Ne instanceof v.Metadata&&(Ve=Ne),Ve!==null&&this.metadata.push(Ve)}return J.prototype.hasTag=function(ne){for(var ye=0,K=this.metadata;ye<K.length;ye++){var Ne=K[ye];if(Ne.key===ne)return!0}return!1},J.prototype.isArray=function(){return this.hasTag(X.MULTI_INJECT_TAG)},J.prototype.matchesArray=function(ne){return this.matchesTag(X.MULTI_INJECT_TAG)(ne)},J.prototype.isNamed=function(){return this.hasTag(X.NAMED_TAG)},J.prototype.isTagged=function(){return this.metadata.some(function(ne){return X.NON_CUSTOM_TAG_KEYS.every(function(ye){return ne.key!==ye})})},J.prototype.isOptional=function(){return this.matchesTag(X.OPTIONAL_TAG)(!0)},J.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(ne){return ne.key===X.NAMED_TAG})[0]:null},J.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(ne){return X.NON_CUSTOM_TAG_KEYS.every(function(ye){return ne.key!==ye})}):null},J.prototype.matchesNamedTag=function(ne){return this.matchesTag(X.NAMED_TAG)(ne)},J.prototype.matchesTag=function(ne){var ye=this;return function(K){for(var Ne=0,Ve=ye.metadata;Ne<Ve.length;Ne++){var ke=Ve[Ne];if(ke.key===ne&&ke.value===K)return!0}return!1}},J}();W.Target=F},52279:function(Ue,W,L){"use strict";var X=this&&this.__spreadArray||function(K,Ne){for(var Ve=0,ke=Ne.length,ot=K.length;Ve<ke;Ve++,ot++)K[ot]=Ne[Ve];return K};Object.defineProperty(W,"__esModule",{value:!0}),W.resolveInstance=void 0;var j=L(16674),v=L(28421),Q=L(6867);function F(K,Ne,Ve){var ke=Ne.filter(function(Jt){return Jt.target!==null&&Jt.target.type===v.TargetTypeEnum.ClassProperty}),ot=ke.map(Ve);return ke.forEach(function(Jt,pt){var Zt="";Zt=Jt.target.name.value();var _t=ot[pt];K[Zt]=_t}),K}function J(K,Ne){return new(K.bind.apply(K,X([void 0],Ne)))}function ne(K,Ne){if(Reflect.hasMetadata(Q.POST_CONSTRUCT,K)){var Ve=Reflect.getMetadata(Q.POST_CONSTRUCT,K);try{Ne[Ve.value]()}catch(ke){throw new Error(j.POST_CONSTRUCT_ERROR(K.name,ke.message))}}}function ye(K,Ne,Ve){var ke=null;if(Ne.length>0){var ot=Ne.filter(function(pt){return pt.target!==null&&pt.target.type===v.TargetTypeEnum.ConstructorArgument}),Jt=ot.map(Ve);ke=J(K,Jt),ke=F(ke,Ne,Ve)}else ke=new K;return ne(K,ke),ke}W.resolveInstance=ye},31927:function(Ue,W,L){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.resolve=void 0;var X=L(16674),j=L(28421),v=L(85265),Q=L(55800),F=L(52279),J=function(K,Ne,Ve){try{return Ve()}catch(ke){throw v.isStackOverflowExeption(ke)?new Error(X.CIRCULAR_DEPENDENCY_IN_FACTORY(K,Ne.toString())):ke}},ne=function(K){return function(Ne){Ne.parentContext.setCurrentRequest(Ne);var Ve=Ne.bindings,ke=Ne.childRequests,ot=Ne.target&&Ne.target.isArray(),Jt=!Ne.parentRequest||!Ne.parentRequest.target||!Ne.target||!Ne.parentRequest.target.matchesArray(Ne.target.serviceIdentifier);if(ot&&Jt)return ke.map(function(kt){var Y=ne(K);return Y(kt)});var pt=null;if(Ne.target.isOptional()&&Ve.length===0)return;var Zt=Ve[0],_t=Zt.scope===j.BindingScopeEnum.Singleton,nt=Zt.scope===j.BindingScopeEnum.Request;if(_t&&Zt.activated)return Zt.cache;if(nt&&K!==null&&K.has(Zt.id))return K.get(Zt.id);if(Zt.type===j.BindingTypeEnum.ConstantValue)pt=Zt.cache,Zt.activated=!0;else if(Zt.type===j.BindingTypeEnum.Function)pt=Zt.cache,Zt.activated=!0;else if(Zt.type===j.BindingTypeEnum.Constructor)pt=Zt.implementationType;else if(Zt.type===j.BindingTypeEnum.DynamicValue&&Zt.dynamicValue!==null)pt=J("toDynamicValue",Zt.serviceIdentifier,function(){return Zt.dynamicValue(Ne.parentContext)});else if(Zt.type===j.BindingTypeEnum.Factory&&Zt.factory!==null)pt=J("toFactory",Zt.serviceIdentifier,function(){return Zt.factory(Ne.parentContext)});else if(Zt.type===j.BindingTypeEnum.Provider&&Zt.provider!==null)pt=J("toProvider",Zt.serviceIdentifier,function(){return Zt.provider(Ne.parentContext)});else if(Zt.type===j.BindingTypeEnum.Instance&&Zt.implementationType!==null)pt=F.resolveInstance(Zt.implementationType,ke,ne(K));else{var et=Q.getServiceIdentifierAsString(Ne.serviceIdentifier);throw new Error(X.INVALID_BINDING_TYPE+" "+et)}return typeof Zt.onActivation=="function"&&(pt=Zt.onActivation(Ne.parentContext,pt)),_t&&(Zt.cache=pt,Zt.activated=!0),nt&&K!==null&&!K.has(Zt.id)&&K.set(Zt.id,pt),pt}};function ye(K){var Ne=ne(K.plan.rootRequest.requestScope);return Ne(K.plan.rootRequest)}W.resolve=ye},83366:function(Ue,W,L){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.BindingInSyntax=void 0;var X=L(28421),j=L(71325),v=function(){function Q(F){this._binding=F}return Q.prototype.inRequestScope=function(){return this._binding.scope=X.BindingScopeEnum.Request,new j.BindingWhenOnSyntax(this._binding)},Q.prototype.inSingletonScope=function(){return this._binding.scope=X.BindingScopeEnum.Singleton,new j.BindingWhenOnSyntax(this._binding)},Q.prototype.inTransientScope=function(){return this._binding.scope=X.BindingScopeEnum.Transient,new j.BindingWhenOnSyntax(this._binding)},Q}();W.BindingInSyntax=v},74889:function(Ue,W,L){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.BindingInWhenOnSyntax=void 0;var X=L(83366),j=L(51811),v=L(98370),Q=function(){function F(J){this._binding=J,this._bindingWhenSyntax=new v.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new j.BindingOnSyntax(this._binding),this._bindingInSyntax=new X.BindingInSyntax(J)}return F.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},F.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},F.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},F.prototype.when=function(J){return this._bindingWhenSyntax.when(J)},F.prototype.whenTargetNamed=function(J){return this._bindingWhenSyntax.whenTargetNamed(J)},F.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},F.prototype.whenTargetTagged=function(J,ne){return this._bindingWhenSyntax.whenTargetTagged(J,ne)},F.prototype.whenInjectedInto=function(J){return this._bindingWhenSyntax.whenInjectedInto(J)},F.prototype.whenParentNamed=function(J){return this._bindingWhenSyntax.whenParentNamed(J)},F.prototype.whenParentTagged=function(J,ne){return this._bindingWhenSyntax.whenParentTagged(J,ne)},F.prototype.whenAnyAncestorIs=function(J){return this._bindingWhenSyntax.whenAnyAncestorIs(J)},F.prototype.whenNoAncestorIs=function(J){return this._bindingWhenSyntax.whenNoAncestorIs(J)},F.prototype.whenAnyAncestorNamed=function(J){return this._bindingWhenSyntax.whenAnyAncestorNamed(J)},F.prototype.whenAnyAncestorTagged=function(J,ne){return this._bindingWhenSyntax.whenAnyAncestorTagged(J,ne)},F.prototype.whenNoAncestorNamed=function(J){return this._bindingWhenSyntax.whenNoAncestorNamed(J)},F.prototype.whenNoAncestorTagged=function(J,ne){return this._bindingWhenSyntax.whenNoAncestorTagged(J,ne)},F.prototype.whenAnyAncestorMatches=function(J){return this._bindingWhenSyntax.whenAnyAncestorMatches(J)},F.prototype.whenNoAncestorMatches=function(J){return this._bindingWhenSyntax.whenNoAncestorMatches(J)},F.prototype.onActivation=function(J){return this._bindingOnSyntax.onActivation(J)},F}();W.BindingInWhenOnSyntax=Q},51811:function(Ue,W,L){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.BindingOnSyntax=void 0;var X=L(98370),j=function(){function v(Q){this._binding=Q}return v.prototype.onActivation=function(Q){return this._binding.onActivation=Q,new X.BindingWhenSyntax(this._binding)},v}();W.BindingOnSyntax=j},15451:function(Ue,W,L){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.BindingToSyntax=void 0;var X=L(16674),j=L(28421),v=L(74889),Q=L(71325),F=function(){function J(ne){this._binding=ne}return J.prototype.to=function(ne){return this._binding.type=j.BindingTypeEnum.Instance,this._binding.implementationType=ne,new v.BindingInWhenOnSyntax(this._binding)},J.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+X.INVALID_TO_SELF_VALUE);var ne=this._binding.serviceIdentifier;return this.to(ne)},J.prototype.toConstantValue=function(ne){return this._binding.type=j.BindingTypeEnum.ConstantValue,this._binding.cache=ne,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=j.BindingScopeEnum.Singleton,new Q.BindingWhenOnSyntax(this._binding)},J.prototype.toDynamicValue=function(ne){return this._binding.type=j.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=ne,this._binding.implementationType=null,new v.BindingInWhenOnSyntax(this._binding)},J.prototype.toConstructor=function(ne){return this._binding.type=j.BindingTypeEnum.Constructor,this._binding.implementationType=ne,this._binding.scope=j.BindingScopeEnum.Singleton,new Q.BindingWhenOnSyntax(this._binding)},J.prototype.toFactory=function(ne){return this._binding.type=j.BindingTypeEnum.Factory,this._binding.factory=ne,this._binding.scope=j.BindingScopeEnum.Singleton,new Q.BindingWhenOnSyntax(this._binding)},J.prototype.toFunction=function(ne){if(typeof ne!="function")throw new Error(X.INVALID_FUNCTION_BINDING);var ye=this.toConstantValue(ne);return this._binding.type=j.BindingTypeEnum.Function,this._binding.scope=j.BindingScopeEnum.Singleton,ye},J.prototype.toAutoFactory=function(ne){return this._binding.type=j.BindingTypeEnum.Factory,this._binding.factory=function(ye){var K=function(){return ye.container.get(ne)};return K},this._binding.scope=j.BindingScopeEnum.Singleton,new Q.BindingWhenOnSyntax(this._binding)},J.prototype.toProvider=function(ne){return this._binding.type=j.BindingTypeEnum.Provider,this._binding.provider=ne,this._binding.scope=j.BindingScopeEnum.Singleton,new Q.BindingWhenOnSyntax(this._binding)},J.prototype.toService=function(ne){this.toDynamicValue(function(ye){return ye.container.get(ne)})},J}();W.BindingToSyntax=F},71325:function(Ue,W,L){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.BindingWhenOnSyntax=void 0;var X=L(51811),j=L(98370),v=function(){function Q(F){this._binding=F,this._bindingWhenSyntax=new j.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new X.BindingOnSyntax(this._binding)}return Q.prototype.when=function(F){return this._bindingWhenSyntax.when(F)},Q.prototype.whenTargetNamed=function(F){return this._bindingWhenSyntax.whenTargetNamed(F)},Q.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},Q.prototype.whenTargetTagged=function(F,J){return this._bindingWhenSyntax.whenTargetTagged(F,J)},Q.prototype.whenInjectedInto=function(F){return this._bindingWhenSyntax.whenInjectedInto(F)},Q.prototype.whenParentNamed=function(F){return this._bindingWhenSyntax.whenParentNamed(F)},Q.prototype.whenParentTagged=function(F,J){return this._bindingWhenSyntax.whenParentTagged(F,J)},Q.prototype.whenAnyAncestorIs=function(F){return this._bindingWhenSyntax.whenAnyAncestorIs(F)},Q.prototype.whenNoAncestorIs=function(F){return this._bindingWhenSyntax.whenNoAncestorIs(F)},Q.prototype.whenAnyAncestorNamed=function(F){return this._bindingWhenSyntax.whenAnyAncestorNamed(F)},Q.prototype.whenAnyAncestorTagged=function(F,J){return this._bindingWhenSyntax.whenAnyAncestorTagged(F,J)},Q.prototype.whenNoAncestorNamed=function(F){return this._bindingWhenSyntax.whenNoAncestorNamed(F)},Q.prototype.whenNoAncestorTagged=function(F,J){return this._bindingWhenSyntax.whenNoAncestorTagged(F,J)},Q.prototype.whenAnyAncestorMatches=function(F){return this._bindingWhenSyntax.whenAnyAncestorMatches(F)},Q.prototype.whenNoAncestorMatches=function(F){return this._bindingWhenSyntax.whenNoAncestorMatches(F)},Q.prototype.onActivation=function(F){return this._bindingOnSyntax.onActivation(F)},Q}();W.BindingWhenOnSyntax=v},98370:function(Ue,W,L){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.BindingWhenSyntax=void 0;var X=L(51811),j=L(80758),v=function(){function Q(F){this._binding=F}return Q.prototype.when=function(F){return this._binding.constraint=F,new X.BindingOnSyntax(this._binding)},Q.prototype.whenTargetNamed=function(F){return this._binding.constraint=j.namedConstraint(F),new X.BindingOnSyntax(this._binding)},Q.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(F){var J=F.target!==null&&!F.target.isNamed()&&!F.target.isTagged();return J},new X.BindingOnSyntax(this._binding)},Q.prototype.whenTargetTagged=function(F,J){return this._binding.constraint=j.taggedConstraint(F)(J),new X.BindingOnSyntax(this._binding)},Q.prototype.whenInjectedInto=function(F){return this._binding.constraint=function(J){return j.typeConstraint(F)(J.parentRequest)},new X.BindingOnSyntax(this._binding)},Q.prototype.whenParentNamed=function(F){return this._binding.constraint=function(J){return j.namedConstraint(F)(J.parentRequest)},new X.BindingOnSyntax(this._binding)},Q.prototype.whenParentTagged=function(F,J){return this._binding.constraint=function(ne){return j.taggedConstraint(F)(J)(ne.parentRequest)},new X.BindingOnSyntax(this._binding)},Q.prototype.whenAnyAncestorIs=function(F){return this._binding.constraint=function(J){return j.traverseAncerstors(J,j.typeConstraint(F))},new X.BindingOnSyntax(this._binding)},Q.prototype.whenNoAncestorIs=function(F){return this._binding.constraint=function(J){return!j.traverseAncerstors(J,j.typeConstraint(F))},new X.BindingOnSyntax(this._binding)},Q.prototype.whenAnyAncestorNamed=function(F){return this._binding.constraint=function(J){return j.traverseAncerstors(J,j.namedConstraint(F))},new X.BindingOnSyntax(this._binding)},Q.prototype.whenNoAncestorNamed=function(F){return this._binding.constraint=function(J){return!j.traverseAncerstors(J,j.namedConstraint(F))},new X.BindingOnSyntax(this._binding)},Q.prototype.whenAnyAncestorTagged=function(F,J){return this._binding.constraint=function(ne){return j.traverseAncerstors(ne,j.taggedConstraint(F)(J))},new X.BindingOnSyntax(this._binding)},Q.prototype.whenNoAncestorTagged=function(F,J){return this._binding.constraint=function(ne){return!j.traverseAncerstors(ne,j.taggedConstraint(F)(J))},new X.BindingOnSyntax(this._binding)},Q.prototype.whenAnyAncestorMatches=function(F){return this._binding.constraint=function(J){return j.traverseAncerstors(J,F)},new X.BindingOnSyntax(this._binding)},Q.prototype.whenNoAncestorMatches=function(F){return this._binding.constraint=function(J){return!j.traverseAncerstors(J,F)},new X.BindingOnSyntax(this._binding)},Q}();W.BindingWhenSyntax=v},80758:function(Ue,W,L){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.typeConstraint=W.namedConstraint=W.taggedConstraint=W.traverseAncerstors=void 0;var X=L(6867),j=L(47738),v=function(ne,ye){var K=ne.parentRequest;return K!==null?ye(K)?!0:v(K,ye):!1};W.traverseAncerstors=v;var Q=function(ne){return function(ye){var K=function(Ne){return Ne!==null&&Ne.target!==null&&Ne.target.matchesTag(ne)(ye)};return K.metaData=new j.Metadata(ne,ye),K}};W.taggedConstraint=Q;var F=Q(X.NAMED_TAG);W.namedConstraint=F;var J=function(ne){return function(ye){var K=null;if(ye!==null)if(K=ye.bindings[0],typeof ne=="string"){var Ne=K.serviceIdentifier;return Ne===ne}else{var Ve=ye.bindings[0].implementationType;return ne===Ve}return!1}};W.typeConstraint=J},70600:function(Ue,W){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.multiBindToService=void 0;var L=function(X){return function(j){return function(){for(var v=[],Q=0;Q<arguments.length;Q++)v[Q]=arguments[Q];return v.forEach(function(F){return X.bind(F).toService(j)})}}};W.multiBindToService=L},85265:function(Ue,W,L){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.isStackOverflowExeption=void 0;var X=L(16674);function j(v){return v instanceof RangeError||v.message===X.STACK_OVERFLOW}W.isStackOverflowExeption=j},37791:function(Ue,W){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.id=void 0;var L=0;function X(){return L++}W.id=X},55800:function(Ue,W,L){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.circularDependencyToException=W.listMetadataForTarget=W.listRegisteredBindingsForServiceIdentifier=W.getServiceIdentifierAsString=W.getFunctionName=void 0;var X=L(16674);function j(K){if(typeof K=="function"){var Ne=K;return Ne.name}else{if(typeof K=="symbol")return K.toString();var Ne=K;return Ne}}W.getServiceIdentifierAsString=j;function v(K,Ne,Ve){var ke="",ot=Ve(K,Ne);return ot.length!==0&&(ke=`
Registered bindings:`,ot.forEach(function(Jt){var pt="Object";Jt.implementationType!==null&&(pt=ye(Jt.implementationType)),ke=ke+`
 `+pt,Jt.constraint.metaData&&(ke=ke+" - "+Jt.constraint.metaData)})),ke}W.listRegisteredBindingsForServiceIdentifier=v;function Q(K,Ne){return K.parentRequest===null?!1:K.parentRequest.serviceIdentifier===Ne?!0:Q(K.parentRequest,Ne)}function F(K){function Ne(ke,ot){ot===void 0&&(ot=[]);var Jt=j(ke.serviceIdentifier);return ot.push(Jt),ke.parentRequest!==null?Ne(ke.parentRequest,ot):ot}var Ve=Ne(K);return Ve.reverse().join(" --> ")}function J(K){K.childRequests.forEach(function(Ne){if(Q(Ne,Ne.serviceIdentifier)){var Ve=F(Ne);throw new Error(X.CIRCULAR_DEPENDENCY+" "+Ve)}else J(Ne)})}W.circularDependencyToException=J;function ne(K,Ne){if(Ne.isTagged()||Ne.isNamed()){var Ve="",ke=Ne.getNamedTag(),ot=Ne.getCustomTags();return ke!==null&&(Ve+=ke.toString()+`
`),ot!==null&&ot.forEach(function(Jt){Ve+=Jt.toString()+`
`})," "+K+`
 `+K+" - "+Ve}else return" "+K}W.listMetadataForTarget=ne;function ye(K){if(K.name)return K.name;var Ne=K.toString(),Ve=Ne.match(/^function\s*([^\s(]+)/);return Ve?Ve[1]:"Anonymous function: "+Ne}W.getFunctionName=ye},31745:function(Ue){"use strict";Ue.exports=L,Ue.exports.default=L;var W=1e20;function L(F,J,ne,ye,K,Ne){this.fontSize=F||24,this.buffer=J===void 0?3:J,this.cutoff=ye||.25,this.fontFamily=K||"sans-serif",this.fontWeight=Ne||"normal",this.radius=ne||8;var Ve=this.size=this.fontSize+this.buffer*2,ke=Ve+this.buffer*2,ot=typeof my!="undefined"&&!!my&&typeof my.showToast=="function";ot?this.canvas=my.createOffscreenCanvas(Ve,Ve,"2d"):(this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=Ve),this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(ke*ke),this.gridInner=new Float64Array(ke*ke),this.f=new Float64Array(ke),this.z=new Float64Array(ke+1),this.v=new Uint16Array(ke),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,ot?this.middle=Math.round(Ve/2*1):this.middle=Math.round(Ve/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function X(F,J,ne,ye,K,Ne,Ve){Ne.fill(W,0,J*ne),Ve.fill(0,0,J*ne);for(var ke=(J-ye)/2,ot=0;ot<K;ot++)for(var Jt=0;Jt<ye;Jt++){var pt=(ot+ke)*J+Jt+ke,Zt=F.data[4*(ot*ye+Jt)+3]/255;if(Zt===1)Ne[pt]=0,Ve[pt]=W;else if(Zt===0)Ne[pt]=W,Ve[pt]=0;else{var _t=Math.max(0,.5-Zt),nt=Math.max(0,Zt-.5);Ne[pt]=_t*_t,Ve[pt]=nt*nt}}}function j(F,J,ne,ye,K,Ne,Ve){for(var ke=0;ke<J*ne;ke++){var ot=Math.sqrt(ye[ke])-Math.sqrt(K[ke]);F[ke]=Math.round(255-255*(ot/Ne+Ve))}}L.prototype._draw=function(F,J){var ne=this.ctx.measureText(F),ye=ne.width,K=2*this.buffer,Ne,Ve,ke,ot,Jt,pt,Zt,_t;J&&this.useMetrics?(Jt=Math.floor(ne.actualBoundingBoxAscent),_t=this.buffer+Math.ceil(ne.actualBoundingBoxAscent),pt=this.buffer,Zt=this.buffer,Ve=Math.min(this.size,Math.ceil(ne.actualBoundingBoxRight-ne.actualBoundingBoxLeft)),ot=Math.min(this.size-pt,Math.ceil(ne.actualBoundingBoxAscent+ne.actualBoundingBoxDescent)),Ne=Ve+K,ke=ot+K,this.ctx.textBaseline="alphabetic"):(Ne=Ve=this.size,ke=ot=this.size,Jt=19*this.fontSize/24,pt=Zt=0,_t=this.middle,this.ctx.textBaseline="middle");var nt;Ve&&ot&&(this.ctx.clearRect(Zt,pt,Ve,ot),this.ctx.fillText(F,this.buffer,_t),nt=this.ctx.getImageData(Zt,pt,Ve,ot));var et=new Uint8ClampedArray(Ne*ke);return X(nt,Ne,ke,Ve,ot,this.gridOuter,this.gridInner),v(this.gridOuter,Ne,ke,this.f,this.v,this.z),v(this.gridInner,Ne,ke,this.f,this.v,this.z),j(et,Ne,ke,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:et,metrics:{width:Ve,height:ot,sdfWidth:Ne,sdfHeight:ke,top:Jt,left:0,advance:ye}}},L.prototype.draw=function(F){return this._draw(F,!1).data},L.prototype.drawWithMetrics=function(F){return this._draw(F,!0)};function v(F,J,ne,ye,K,Ne){for(var Ve=0;Ve<J;Ve++)Q(F,Ve,J,ne,ye,K,Ne);for(var ke=0;ke<ne;ke++)Q(F,ke*J,1,J,ye,K,Ne)}function Q(F,J,ne,ye,K,Ne,Ve){var ke,ot,Jt,pt;for(Ne[0]=0,Ve[0]=-W,Ve[1]=W,ke=0;ke<ye;ke++)K[ke]=F[J+ke*ne];for(ke=1,ot=0,Jt=0;ke<ye;ke++){do pt=Ne[ot],Jt=(K[ke]-K[pt]+ke*ke-pt*pt)/(ke-pt)/2;while(Jt<=Ve[ot]&&--ot>-1);ot++,Ne[ot]=ke,Ve[ot]=Jt,Ve[ot+1]=W}for(ke=0,ot=0;ke<ye;ke++){for(;Ve[ot+1]<ke;)ot++;pt=Ne[ot],F[J+ke*ne]=K[pt]+(ke-pt)*(ke-pt)}}},18857:function(Ue,W,L){"use strict";L.r(W),L.d(W,{Function:function(){return Vs},Interpreter:function(){return _a},default:function(){return ul},evaluate:function(){return Gu},vm:function(){return X}});var X={};L.r(X),L.d(X,{Script:function(){return nc},compileFunction:function(){return Jc},createContext:function(){return ns},runInContext:function(){return Tl},runInNewContext:function(){return Zs}});var j={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},v="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",Q={5:v,"5module":v+" export import",6:v+" const class extends export import super"},F=/^in(stanceof)?$/,J="\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC",ne="\u200C\u200D\xB7\u0300-\u036F\u0387\u0483-\u0487\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u0669\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u06F0-\u06F9\u0711\u0730-\u074A\u07A6-\u07B0\u07C0-\u07C9\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0966-\u096F\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09E6-\u09EF\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A66-\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AE6-\u0AEF\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B55-\u0B57\u0B62\u0B63\u0B66-\u0B6F\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0BE6-\u0BEF\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0CE6-\u0CEF\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D66-\u0D6F\u0D81-\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0E50-\u0E59\u0EB1\u0EB4-\u0EBC\u0EC8-\u0ECD\u0ED0-\u0ED9\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1040-\u1049\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F-\u109D\u135D-\u135F\u1369-\u1371\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u18A9\u1920-\u192B\u1930-\u193B\u1946-\u194F\u19D0-\u19DA\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AB0-\u1ABD\u1ABF\u1AC0\u1B00-\u1B04\u1B34-\u1B44\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BB0-\u1BB9\u1BE6-\u1BF3\u1C24-\u1C37\u1C40-\u1C49\u1C50-\u1C59\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u203F\u2040\u2054\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA620-\uA629\uA66F\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA82C\uA880\uA881\uA8B4-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F1\uA8FF-\uA909\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9D0-\uA9D9\uA9E5\uA9F0-\uA9F9\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA50-\uAA59\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uABF0-\uABF9\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFF10-\uFF19\uFF3F",ye=new RegExp("["+J+"]"),K=new RegExp("["+J+ne+"]");J=ne=null;var Ne=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,157,310,10,21,11,7,153,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,349,41,7,1,79,28,11,0,9,21,107,20,28,22,13,52,76,44,33,24,27,35,30,0,3,0,9,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,85,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,21,2,31,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,230,43,117,63,32,7,3,0,3,7,2,1,2,23,16,0,2,0,95,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,35,56,264,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,190,0,80,921,103,110,18,195,2749,1070,4050,582,8634,568,8,30,114,29,19,47,17,3,32,20,6,18,689,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,1237,43,8,8952,286,50,2,18,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,2357,44,11,6,17,0,370,43,1301,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42717,35,4148,12,221,3,5761,15,7472,3104,541,1507,4938],Ve=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,370,1,154,10,176,2,54,14,32,9,16,3,46,10,54,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,2,11,83,11,7,0,161,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,243,14,166,9,71,5,2,1,3,3,2,0,2,1,13,9,120,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,406,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,19306,9,135,4,60,6,26,9,1014,0,2,54,8,3,82,0,12,1,19628,1,5319,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,262,6,10,9,419,13,1495,6,110,6,6,9,4759,9,787719,239];function ke(y,T){for(var N=65536,O=0;O<T.length;O+=2){if(N+=T[O],N>y)return!1;if(N+=T[O+1],N>=y)return!0}}function ot(y,T){return y<65?y===36:y<91?!0:y<97?y===95:y<123?!0:y<=65535?y>=170&&ye.test(String.fromCharCode(y)):T===!1?!1:ke(y,Ne)}function Jt(y,T){return y<48?y===36:y<58?!0:y<65?!1:y<91?!0:y<97?y===95:y<123?!0:y<=65535?y>=170&&K.test(String.fromCharCode(y)):T===!1?!1:ke(y,Ne)||ke(y,Ve)}var pt=function(T,N){N===void 0&&(N={}),this.label=T,this.keyword=N.keyword,this.beforeExpr=!!N.beforeExpr,this.startsExpr=!!N.startsExpr,this.isLoop=!!N.isLoop,this.isAssign=!!N.isAssign,this.prefix=!!N.prefix,this.postfix=!!N.postfix,this.binop=N.binop||null,this.updateContext=null};function Zt(y,T){return new pt(y,{beforeExpr:!0,binop:T})}var _t={beforeExpr:!0},nt={startsExpr:!0},et={};function kt(y,T){return T===void 0&&(T={}),T.keyword=y,et[y]=new pt(y,T)}var Y={num:new pt("num",nt),regexp:new pt("regexp",nt),string:new pt("string",nt),name:new pt("name",nt),eof:new pt("eof"),bracketL:new pt("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new pt("]"),braceL:new pt("{",{beforeExpr:!0,startsExpr:!0}),braceR:new pt("}"),parenL:new pt("(",{beforeExpr:!0,startsExpr:!0}),parenR:new pt(")"),comma:new pt(",",_t),semi:new pt(";",_t),colon:new pt(":",_t),dot:new pt("."),question:new pt("?",_t),questionDot:new pt("?."),arrow:new pt("=>",_t),template:new pt("template"),invalidTemplate:new pt("invalidTemplate"),ellipsis:new pt("...",_t),backQuote:new pt("`",nt),dollarBraceL:new pt("${",{beforeExpr:!0,startsExpr:!0}),eq:new pt("=",{beforeExpr:!0,isAssign:!0}),assign:new pt("_=",{beforeExpr:!0,isAssign:!0}),incDec:new pt("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new pt("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:Zt("||",1),logicalAND:Zt("&&",2),bitwiseOR:Zt("|",3),bitwiseXOR:Zt("^",4),bitwiseAND:Zt("&",5),equality:Zt("==/!=/===/!==",6),relational:Zt("</>/<=/>=",7),bitShift:Zt("<</>>/>>>",8),plusMin:new pt("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:Zt("%",10),star:Zt("*",10),slash:Zt("/",10),starstar:new pt("**",{beforeExpr:!0}),coalesce:Zt("??",1),_break:kt("break"),_case:kt("case",_t),_catch:kt("catch"),_continue:kt("continue"),_debugger:kt("debugger"),_default:kt("default",_t),_do:kt("do",{isLoop:!0,beforeExpr:!0}),_else:kt("else",_t),_finally:kt("finally"),_for:kt("for",{isLoop:!0}),_function:kt("function",nt),_if:kt("if"),_return:kt("return",_t),_switch:kt("switch"),_throw:kt("throw",_t),_try:kt("try"),_var:kt("var"),_const:kt("const"),_while:kt("while",{isLoop:!0}),_with:kt("with"),_new:kt("new",{beforeExpr:!0,startsExpr:!0}),_this:kt("this",nt),_super:kt("super",nt),_class:kt("class",nt),_extends:kt("extends",_t),_export:kt("export"),_import:kt("import",nt),_null:kt("null",nt),_true:kt("true",nt),_false:kt("false",nt),_in:kt("in",{beforeExpr:!0,binop:7}),_instanceof:kt("instanceof",{beforeExpr:!0,binop:7}),_typeof:kt("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:kt("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:kt("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},Wt=/\r\n?|\n|\u2028|\u2029/,st=new RegExp(Wt.source,"g");function Ye(y,T){return y===10||y===13||!T&&(y===8232||y===8233)}var ct=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,Je=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,Rt=Object.prototype,dr=Rt.hasOwnProperty,Mr=Rt.toString;function jr(y,T){return dr.call(y,T)}var C=Array.isArray||function(y){return Mr.call(y)==="[object Array]"};function we(y){return new RegExp("^(?:"+y.replace(/ /g,"|")+")$")}var Le=function(T,N){this.line=T,this.column=N};Le.prototype.offset=function(T){return new Le(this.line,this.column+T)};var Et=function(T,N,O){this.start=N,this.end=O,T.sourceFile!==null&&(this.source=T.sourceFile)};function gt(y,T){for(var N=1,O=0;;){st.lastIndex=O;var $=st.exec(y);if($&&$.index<T)++N,O=$.index+$[0].length;else return new Le(N,T-O)}}var Lt={ecmaVersion:10,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:!1,allowHashBang:!1,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1};function Yt(y){var T={};for(var N in Lt)T[N]=y&&jr(y,N)?y[N]:Lt[N];if(T.ecmaVersion>=2015&&(T.ecmaVersion-=2009),T.allowReserved==null&&(T.allowReserved=T.ecmaVersion<5),C(T.onToken)){var O=T.onToken;T.onToken=function($){return O.push($)}}return C(T.onComment)&&(T.onComment=br(T,T.onComment)),T}function br(y,T){return function(N,O,$,_e,Xe,ht){var dt={type:N?"Block":"Line",value:O,start:$,end:_e};y.locations&&(dt.loc=new Et(this,Xe,ht)),y.ranges&&(dt.range=[$,_e]),T.push(dt)}}var Yn=1,cn=2,ci=Yn|cn,Zn=4,ri=8,fi=16,Gn=32,hi=64,la=128;function Vi(y,T){return cn|(y?Zn:0)|(T?ri:0)}var Oi=0,qi=1,ca=2,Ci=3,ma=4,Xn=5,bi=function(T,N,O){this.options=T=Yt(T),this.sourceFile=T.sourceFile,this.keywords=we(Q[T.ecmaVersion>=6?6:T.sourceType==="module"?"5module":5]);var $="";if(T.allowReserved!==!0){for(var _e=T.ecmaVersion;!($=j[_e]);_e--);T.sourceType==="module"&&($+=" await")}this.reservedWords=we($);var Xe=($?$+" ":"")+j.strict;this.reservedWordsStrict=we(Xe),this.reservedWordsStrictBind=we(Xe+" "+j.strictBind),this.input=String(N),this.containsEsc=!1,O?(this.pos=O,this.lineStart=this.input.lastIndexOf(`
`,O-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(Wt).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=Y.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule=T.sourceType==="module",this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.yieldPos=this.awaitPos=this.awaitIdentPos=0,this.labels=[],this.undefinedExports={},this.pos===0&&T.allowHashBang&&this.input.slice(0,2)==="#!"&&this.skipLineComment(2),this.scopeStack=[],this.enterScope(Yn),this.regexpState=null},Ni={inFunction:{configurable:!0},inGenerator:{configurable:!0},inAsync:{configurable:!0},allowSuper:{configurable:!0},allowDirectSuper:{configurable:!0},treatFunctionsAsVar:{configurable:!0}};bi.prototype.parse=function(){var T=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(T)},Ni.inFunction.get=function(){return(this.currentVarScope().flags&cn)>0},Ni.inGenerator.get=function(){return(this.currentVarScope().flags&ri)>0},Ni.inAsync.get=function(){return(this.currentVarScope().flags&Zn)>0},Ni.allowSuper.get=function(){return(this.currentThisScope().flags&hi)>0},Ni.allowDirectSuper.get=function(){return(this.currentThisScope().flags&la)>0},Ni.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope())},bi.prototype.inNonArrowFunction=function(){return(this.currentThisScope().flags&cn)>0},bi.extend=function(){for(var T=[],N=arguments.length;N--;)T[N]=arguments[N];for(var O=this,$=0;$<T.length;$++)O=T[$](O);return O},bi.parse=function(T,N){return new this(N,T).parse()},bi.parseExpressionAt=function(T,N,O){var $=new this(O,T,N);return $.nextToken(),$.parseExpression()},bi.tokenizer=function(T,N){return new this(N,T)},Object.defineProperties(bi.prototype,Ni);var Ki=bi.prototype,Oo=/^(?:'((?:\\.|[^'\\])*?)'|"((?:\\.|[^"\\])*?)")/;Ki.strictDirective=function(y){for(;;){Je.lastIndex=y,y+=Je.exec(this.input)[0].length;var T=Oo.exec(this.input.slice(y));if(!T)return!1;if((T[1]||T[2])==="use strict"){Je.lastIndex=y+T[0].length;var N=Je.exec(this.input),O=N.index+N[0].length,$=this.input.charAt(O);return $===";"||$==="}"||Wt.test(N[0])&&!(/[(`.[+\-/*%<>=,?^&]/.test($)||$==="!"&&this.input.charAt(O+1)==="=")}y+=T[0].length,Je.lastIndex=y,y+=Je.exec(this.input)[0].length,this.input[y]===";"&&y++}},Ki.eat=function(y){return this.type===y?(this.next(),!0):!1},Ki.isContextual=function(y){return this.type===Y.name&&this.value===y&&!this.containsEsc},Ki.eatContextual=function(y){return this.isContextual(y)?(this.next(),!0):!1},Ki.expectContextual=function(y){this.eatContextual(y)||this.unexpected()},Ki.canInsertSemicolon=function(){return this.type===Y.eof||this.type===Y.braceR||Wt.test(this.input.slice(this.lastTokEnd,this.start))},Ki.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0},Ki.semicolon=function(){!this.eat(Y.semi)&&!this.insertSemicolon()&&this.unexpected()},Ki.afterTrailingComma=function(y,T){if(this.type===y)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),T||this.next(),!0},Ki.expect=function(y){this.eat(y)||this.unexpected()},Ki.unexpected=function(y){this.raise(y!=null?y:this.start,"Unexpected token")};function he(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1}Ki.checkPatternErrors=function(y,T){if(!!y){y.trailingComma>-1&&this.raiseRecoverable(y.trailingComma,"Comma is not permitted after the rest element");var N=T?y.parenthesizedAssign:y.parenthesizedBind;N>-1&&this.raiseRecoverable(N,"Parenthesized pattern")}},Ki.checkExpressionErrors=function(y,T){if(!y)return!1;var N=y.shorthandAssign,O=y.doubleProto;if(!T)return N>=0||O>=0;N>=0&&this.raise(N,"Shorthand property assignments are valid only in destructuring patterns"),O>=0&&this.raiseRecoverable(O,"Redefinition of __proto__ property")},Ki.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")},Ki.isSimpleAssignTarget=function(y){return y.type==="ParenthesizedExpression"?this.isSimpleAssignTarget(y.expression):y.type==="Identifier"||y.type==="MemberExpression"};var On=bi.prototype;On.parseTopLevel=function(y){var T={};for(y.body||(y.body=[]);this.type!==Y.eof;){var N=this.parseStatement(null,!0,T);y.body.push(N)}if(this.inModule)for(var O=0,$=Object.keys(this.undefinedExports);O<$.length;O+=1){var _e=$[O];this.raiseRecoverable(this.undefinedExports[_e].start,"Export '"+_e+"' is not defined")}return this.adaptDirectivePrologue(y.body),this.next(),y.sourceType=this.options.sourceType,this.finishNode(y,"Program")};var Ua={kind:"loop"},rs={kind:"switch"};On.isLet=function(y){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;Je.lastIndex=this.pos;var T=Je.exec(this.input),N=this.pos+T[0].length,O=this.input.charCodeAt(N);if(O===91)return!0;if(y)return!1;if(O===123)return!0;if(ot(O,!0)){for(var $=N+1;Jt(this.input.charCodeAt($),!0);)++$;var _e=this.input.slice(N,$);if(!F.test(_e))return!0}return!1},On.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;Je.lastIndex=this.pos;var y=Je.exec(this.input),T=this.pos+y[0].length;return!Wt.test(this.input.slice(this.pos,T))&&this.input.slice(T,T+8)==="function"&&(T+8===this.input.length||!Jt(this.input.charAt(T+8)))},On.parseStatement=function(y,T,N){var O=this.type,$=this.startNode(),_e;switch(this.isLet(y)&&(O=Y._var,_e="let"),O){case Y._break:case Y._continue:return this.parseBreakContinueStatement($,O.keyword);case Y._debugger:return this.parseDebuggerStatement($);case Y._do:return this.parseDoStatement($);case Y._for:return this.parseForStatement($);case Y._function:return y&&(this.strict||y!=="if"&&y!=="label")&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement($,!1,!y);case Y._class:return y&&this.unexpected(),this.parseClass($,!0);case Y._if:return this.parseIfStatement($);case Y._return:return this.parseReturnStatement($);case Y._switch:return this.parseSwitchStatement($);case Y._throw:return this.parseThrowStatement($);case Y._try:return this.parseTryStatement($);case Y._const:case Y._var:return _e=_e||this.value,y&&_e!=="var"&&this.unexpected(),this.parseVarStatement($,_e);case Y._while:return this.parseWhileStatement($);case Y._with:return this.parseWithStatement($);case Y.braceL:return this.parseBlock(!0,$);case Y.semi:return this.parseEmptyStatement($);case Y._export:case Y._import:if(this.options.ecmaVersion>10&&O===Y._import){Je.lastIndex=this.pos;var Xe=Je.exec(this.input),ht=this.pos+Xe[0].length,dt=this.input.charCodeAt(ht);if(dt===40||dt===46)return this.parseExpressionStatement($,this.parseExpression())}return this.options.allowImportExportEverywhere||(T||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),O===Y._import?this.parseImport($):this.parseExport($,N);default:if(this.isAsyncFunction())return y&&this.unexpected(),this.next(),this.parseFunctionStatement($,!0,!y);var ir=this.value,sr=this.parseExpression();return O===Y.name&&sr.type==="Identifier"&&this.eat(Y.colon)?this.parseLabeledStatement($,ir,sr,y):this.parseExpressionStatement($,sr)}},On.parseBreakContinueStatement=function(y,T){var N=T==="break";this.next(),this.eat(Y.semi)||this.insertSemicolon()?y.label=null:this.type!==Y.name?this.unexpected():(y.label=this.parseIdent(),this.semicolon());for(var O=0;O<this.labels.length;++O){var $=this.labels[O];if((y.label==null||$.name===y.label.name)&&($.kind!=null&&(N||$.kind==="loop")||y.label&&N))break}return O===this.labels.length&&this.raise(y.start,"Unsyntactic "+T),this.finishNode(y,N?"BreakStatement":"ContinueStatement")},On.parseDebuggerStatement=function(y){return this.next(),this.semicolon(),this.finishNode(y,"DebuggerStatement")},On.parseDoStatement=function(y){return this.next(),this.labels.push(Ua),y.body=this.parseStatement("do"),this.labels.pop(),this.expect(Y._while),y.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(Y.semi):this.semicolon(),this.finishNode(y,"DoWhileStatement")},On.parseForStatement=function(y){this.next();var T=this.options.ecmaVersion>=9&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction)&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(Ua),this.enterScope(0),this.expect(Y.parenL),this.type===Y.semi)return T>-1&&this.unexpected(T),this.parseFor(y,null);var N=this.isLet();if(this.type===Y._var||this.type===Y._const||N){var O=this.startNode(),$=N?"let":this.value;return this.next(),this.parseVar(O,!0,$),this.finishNode(O,"VariableDeclaration"),(this.type===Y._in||this.options.ecmaVersion>=6&&this.isContextual("of"))&&O.declarations.length===1?(this.options.ecmaVersion>=9&&(this.type===Y._in?T>-1&&this.unexpected(T):y.await=T>-1),this.parseForIn(y,O)):(T>-1&&this.unexpected(T),this.parseFor(y,O))}var _e=new he,Xe=this.parseExpression(!0,_e);return this.type===Y._in||this.options.ecmaVersion>=6&&this.isContextual("of")?(this.options.ecmaVersion>=9&&(this.type===Y._in?T>-1&&this.unexpected(T):y.await=T>-1),this.toAssignable(Xe,!1,_e),this.checkLVal(Xe),this.parseForIn(y,Xe)):(this.checkExpressionErrors(_e,!0),T>-1&&this.unexpected(T),this.parseFor(y,Xe))},On.parseFunctionStatement=function(y,T,N){return this.next(),this.parseFunction(y,tr|(N?0:Er),!1,T)},On.parseIfStatement=function(y){return this.next(),y.test=this.parseParenExpression(),y.consequent=this.parseStatement("if"),y.alternate=this.eat(Y._else)?this.parseStatement("if"):null,this.finishNode(y,"IfStatement")},On.parseReturnStatement=function(y){return!this.inFunction&&!this.options.allowReturnOutsideFunction&&this.raise(this.start,"'return' outside of function"),this.next(),this.eat(Y.semi)||this.insertSemicolon()?y.argument=null:(y.argument=this.parseExpression(),this.semicolon()),this.finishNode(y,"ReturnStatement")},On.parseSwitchStatement=function(y){this.next(),y.discriminant=this.parseParenExpression(),y.cases=[],this.expect(Y.braceL),this.labels.push(rs),this.enterScope(0);for(var T,N=!1;this.type!==Y.braceR;)if(this.type===Y._case||this.type===Y._default){var O=this.type===Y._case;T&&this.finishNode(T,"SwitchCase"),y.cases.push(T=this.startNode()),T.consequent=[],this.next(),O?T.test=this.parseExpression():(N&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),N=!0,T.test=null),this.expect(Y.colon)}else T||this.unexpected(),T.consequent.push(this.parseStatement(null));return this.exitScope(),T&&this.finishNode(T,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(y,"SwitchStatement")},On.parseThrowStatement=function(y){return this.next(),Wt.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),y.argument=this.parseExpression(),this.semicolon(),this.finishNode(y,"ThrowStatement")};var Dt=[];On.parseTryStatement=function(y){if(this.next(),y.block=this.parseBlock(),y.handler=null,this.type===Y._catch){var T=this.startNode();if(this.next(),this.eat(Y.parenL)){T.param=this.parseBindingAtom();var N=T.param.type==="Identifier";this.enterScope(N?Gn:0),this.checkLVal(T.param,N?ma:ca),this.expect(Y.parenR)}else this.options.ecmaVersion<10&&this.unexpected(),T.param=null,this.enterScope(0);T.body=this.parseBlock(!1),this.exitScope(),y.handler=this.finishNode(T,"CatchClause")}return y.finalizer=this.eat(Y._finally)?this.parseBlock():null,!y.handler&&!y.finalizer&&this.raise(y.start,"Missing catch or finally clause"),this.finishNode(y,"TryStatement")},On.parseVarStatement=function(y,T){return this.next(),this.parseVar(y,!1,T),this.semicolon(),this.finishNode(y,"VariableDeclaration")},On.parseWhileStatement=function(y){return this.next(),y.test=this.parseParenExpression(),this.labels.push(Ua),y.body=this.parseStatement("while"),this.labels.pop(),this.finishNode(y,"WhileStatement")},On.parseWithStatement=function(y){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),y.object=this.parseParenExpression(),y.body=this.parseStatement("with"),this.finishNode(y,"WithStatement")},On.parseEmptyStatement=function(y){return this.next(),this.finishNode(y,"EmptyStatement")},On.parseLabeledStatement=function(y,T,N,O){for(var $=0,_e=this.labels;$<_e.length;$+=1){var Xe=_e[$];Xe.name===T&&this.raise(N.start,"Label '"+T+"' is already declared")}for(var ht=this.type.isLoop?"loop":this.type===Y._switch?"switch":null,dt=this.labels.length-1;dt>=0;dt--){var ir=this.labels[dt];if(ir.statementStart===y.start)ir.statementStart=this.start,ir.kind=ht;else break}return this.labels.push({name:T,kind:ht,statementStart:this.start}),y.body=this.parseStatement(O?O.indexOf("label")===-1?O+"label":O:"label"),this.labels.pop(),y.label=N,this.finishNode(y,"LabeledStatement")},On.parseExpressionStatement=function(y,T){return y.expression=T,this.semicolon(),this.finishNode(y,"ExpressionStatement")},On.parseBlock=function(y,T,N){for(y===void 0&&(y=!0),T===void 0&&(T=this.startNode()),T.body=[],this.expect(Y.braceL),y&&this.enterScope(0);this.type!==Y.braceR;){var O=this.parseStatement(null);T.body.push(O)}return N&&(this.strict=!1),this.next(),y&&this.exitScope(),this.finishNode(T,"BlockStatement")},On.parseFor=function(y,T){return y.init=T,this.expect(Y.semi),y.test=this.type===Y.semi?null:this.parseExpression(),this.expect(Y.semi),y.update=this.type===Y.parenR?null:this.parseExpression(),this.expect(Y.parenR),y.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(y,"ForStatement")},On.parseForIn=function(y,T){var N=this.type===Y._in;return this.next(),T.type==="VariableDeclaration"&&T.declarations[0].init!=null&&(!N||this.options.ecmaVersion<8||this.strict||T.kind!=="var"||T.declarations[0].id.type!=="Identifier")?this.raise(T.start,(N?"for-in":"for-of")+" loop variable declaration may not have an initializer"):T.type==="AssignmentPattern"&&this.raise(T.start,"Invalid left-hand side in for-loop"),y.left=T,y.right=N?this.parseExpression():this.parseMaybeAssign(),this.expect(Y.parenR),y.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(y,N?"ForInStatement":"ForOfStatement")},On.parseVar=function(y,T,N){for(y.declarations=[],y.kind=N;;){var O=this.startNode();if(this.parseVarId(O,N),this.eat(Y.eq)?O.init=this.parseMaybeAssign(T):N==="const"&&!(this.type===Y._in||this.options.ecmaVersion>=6&&this.isContextual("of"))?this.unexpected():O.id.type!=="Identifier"&&!(T&&(this.type===Y._in||this.isContextual("of")))?this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):O.init=null,y.declarations.push(this.finishNode(O,"VariableDeclarator")),!this.eat(Y.comma))break}return y},On.parseVarId=function(y,T){y.id=this.parseBindingAtom(),this.checkLVal(y.id,T==="var"?qi:ca,!1)};var tr=1,Er=2,$r=4;On.parseFunction=function(y,T,N,O){this.initFunction(y),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!O)&&(this.type===Y.star&&T&Er&&this.unexpected(),y.generator=this.eat(Y.star)),this.options.ecmaVersion>=8&&(y.async=!!O),T&tr&&(y.id=T&$r&&this.type!==Y.name?null:this.parseIdent(),y.id&&!(T&Er)&&this.checkLVal(y.id,this.strict||y.generator||y.async?this.treatFunctionsAsVar?qi:ca:Ci));var $=this.yieldPos,_e=this.awaitPos,Xe=this.awaitIdentPos;return this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(Vi(y.async,y.generator)),T&tr||(y.id=this.type===Y.name?this.parseIdent():null),this.parseFunctionParams(y),this.parseFunctionBody(y,N,!1),this.yieldPos=$,this.awaitPos=_e,this.awaitIdentPos=Xe,this.finishNode(y,T&tr?"FunctionDeclaration":"FunctionExpression")},On.parseFunctionParams=function(y){this.expect(Y.parenL),y.params=this.parseBindingList(Y.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()},On.parseClass=function(y,T){this.next();var N=this.strict;this.strict=!0,this.parseClassId(y,T),this.parseClassSuper(y);var O=this.startNode(),$=!1;for(O.body=[],this.expect(Y.braceL);this.type!==Y.braceR;){var _e=this.parseClassElement(y.superClass!==null);_e&&(O.body.push(_e),_e.type==="MethodDefinition"&&_e.kind==="constructor"&&($&&this.raise(_e.start,"Duplicate constructor in the same class"),$=!0))}return this.strict=N,this.next(),y.body=this.finishNode(O,"ClassBody"),this.finishNode(y,T?"ClassDeclaration":"ClassExpression")},On.parseClassElement=function(y){var T=this;if(this.eat(Y.semi))return null;var N=this.startNode(),O=function(dt,ir){ir===void 0&&(ir=!1);var sr=T.start,Cn=T.startLoc;return T.eatContextual(dt)?T.type!==Y.parenL&&(!ir||!T.canInsertSemicolon())?!0:(N.key&&T.unexpected(),N.computed=!1,N.key=T.startNodeAt(sr,Cn),N.key.name=dt,T.finishNode(N.key,"Identifier"),!1):!1};N.kind="method",N.static=O("static");var $=this.eat(Y.star),_e=!1;$||(this.options.ecmaVersion>=8&&O("async",!0)?(_e=!0,$=this.options.ecmaVersion>=9&&this.eat(Y.star)):O("get")?N.kind="get":O("set")&&(N.kind="set")),N.key||this.parsePropertyName(N);var Xe=N.key,ht=!1;return!N.computed&&!N.static&&(Xe.type==="Identifier"&&Xe.name==="constructor"||Xe.type==="Literal"&&Xe.value==="constructor")?(N.kind!=="method"&&this.raise(Xe.start,"Constructor can't have get/set modifier"),$&&this.raise(Xe.start,"Constructor can't be a generator"),_e&&this.raise(Xe.start,"Constructor can't be an async method"),N.kind="constructor",ht=y):N.static&&Xe.type==="Identifier"&&Xe.name==="prototype"&&this.raise(Xe.start,"Classes may not have a static property named prototype"),this.parseClassMethod(N,$,_e,ht),N.kind==="get"&&N.value.params.length!==0&&this.raiseRecoverable(N.value.start,"getter should have no params"),N.kind==="set"&&N.value.params.length!==1&&this.raiseRecoverable(N.value.start,"setter should have exactly one param"),N.kind==="set"&&N.value.params[0].type==="RestElement"&&this.raiseRecoverable(N.value.params[0].start,"Setter cannot use rest params"),N},On.parseClassMethod=function(y,T,N,O){return y.value=this.parseMethod(T,N,O),this.finishNode(y,"MethodDefinition")},On.parseClassId=function(y,T){this.type===Y.name?(y.id=this.parseIdent(),T&&this.checkLVal(y.id,ca,!1)):(T===!0&&this.unexpected(),y.id=null)},On.parseClassSuper=function(y){y.superClass=this.eat(Y._extends)?this.parseExprSubscripts():null},On.parseExport=function(y,T){if(this.next(),this.eat(Y.star))return this.options.ecmaVersion>=11&&(this.eatContextual("as")?(y.exported=this.parseIdent(!0),this.checkExport(T,y.exported.name,this.lastTokStart)):y.exported=null),this.expectContextual("from"),this.type!==Y.string&&this.unexpected(),y.source=this.parseExprAtom(),this.semicolon(),this.finishNode(y,"ExportAllDeclaration");if(this.eat(Y._default)){this.checkExport(T,"default",this.lastTokStart);var N;if(this.type===Y._function||(N=this.isAsyncFunction())){var O=this.startNode();this.next(),N&&this.next(),y.declaration=this.parseFunction(O,tr|$r,!1,N)}else if(this.type===Y._class){var $=this.startNode();y.declaration=this.parseClass($,"nullableID")}else y.declaration=this.parseMaybeAssign(),this.semicolon();return this.finishNode(y,"ExportDefaultDeclaration")}if(this.shouldParseExportStatement())y.declaration=this.parseStatement(null),y.declaration.type==="VariableDeclaration"?this.checkVariableExport(T,y.declaration.declarations):this.checkExport(T,y.declaration.id.name,y.declaration.id.start),y.specifiers=[],y.source=null;else{if(y.declaration=null,y.specifiers=this.parseExportSpecifiers(T),this.eatContextual("from"))this.type!==Y.string&&this.unexpected(),y.source=this.parseExprAtom();else{for(var _e=0,Xe=y.specifiers;_e<Xe.length;_e+=1){var ht=Xe[_e];this.checkUnreserved(ht.local),this.checkLocalExport(ht.local)}y.source=null}this.semicolon()}return this.finishNode(y,"ExportNamedDeclaration")},On.checkExport=function(y,T,N){!y||(jr(y,T)&&this.raiseRecoverable(N,"Duplicate export '"+T+"'"),y[T]=!0)},On.checkPatternExport=function(y,T){var N=T.type;if(N==="Identifier")this.checkExport(y,T.name,T.start);else if(N==="ObjectPattern")for(var O=0,$=T.properties;O<$.length;O+=1){var _e=$[O];this.checkPatternExport(y,_e)}else if(N==="ArrayPattern")for(var Xe=0,ht=T.elements;Xe<ht.length;Xe+=1){var dt=ht[Xe];dt&&this.checkPatternExport(y,dt)}else N==="Property"?this.checkPatternExport(y,T.value):N==="AssignmentPattern"?this.checkPatternExport(y,T.left):N==="RestElement"?this.checkPatternExport(y,T.argument):N==="ParenthesizedExpression"&&this.checkPatternExport(y,T.expression)},On.checkVariableExport=function(y,T){if(!!y)for(var N=0,O=T;N<O.length;N+=1){var $=O[N];this.checkPatternExport(y,$.id)}},On.shouldParseExportStatement=function(){return this.type.keyword==="var"||this.type.keyword==="const"||this.type.keyword==="class"||this.type.keyword==="function"||this.isLet()||this.isAsyncFunction()},On.parseExportSpecifiers=function(y){var T=[],N=!0;for(this.expect(Y.braceL);!this.eat(Y.braceR);){if(N)N=!1;else if(this.expect(Y.comma),this.afterTrailingComma(Y.braceR))break;var O=this.startNode();O.local=this.parseIdent(!0),O.exported=this.eatContextual("as")?this.parseIdent(!0):O.local,this.checkExport(y,O.exported.name,O.exported.start),T.push(this.finishNode(O,"ExportSpecifier"))}return T},On.parseImport=function(y){return this.next(),this.type===Y.string?(y.specifiers=Dt,y.source=this.parseExprAtom()):(y.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),y.source=this.type===Y.string?this.parseExprAtom():this.unexpected()),this.semicolon(),this.finishNode(y,"ImportDeclaration")},On.parseImportSpecifiers=function(){var y=[],T=!0;if(this.type===Y.name){var N=this.startNode();if(N.local=this.parseIdent(),this.checkLVal(N.local,ca),y.push(this.finishNode(N,"ImportDefaultSpecifier")),!this.eat(Y.comma))return y}if(this.type===Y.star){var O=this.startNode();return this.next(),this.expectContextual("as"),O.local=this.parseIdent(),this.checkLVal(O.local,ca),y.push(this.finishNode(O,"ImportNamespaceSpecifier")),y}for(this.expect(Y.braceL);!this.eat(Y.braceR);){if(T)T=!1;else if(this.expect(Y.comma),this.afterTrailingComma(Y.braceR))break;var $=this.startNode();$.imported=this.parseIdent(!0),this.eatContextual("as")?$.local=this.parseIdent():(this.checkUnreserved($.imported),$.local=$.imported),this.checkLVal($.local,ca),y.push(this.finishNode($,"ImportSpecifier"))}return y},On.adaptDirectivePrologue=function(y){for(var T=0;T<y.length&&this.isDirectiveCandidate(y[T]);++T)y[T].directive=y[T].expression.raw.slice(1,-1)},On.isDirectiveCandidate=function(y){return y.type==="ExpressionStatement"&&y.expression.type==="Literal"&&typeof y.expression.value=="string"&&(this.input[y.start]==='"'||this.input[y.start]==="'")};var xn=bi.prototype;xn.toAssignable=function(y,T,N){if(this.options.ecmaVersion>=6&&y)switch(y.type){case"Identifier":this.inAsync&&y.name==="await"&&this.raise(y.start,"Cannot use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"RestElement":break;case"ObjectExpression":y.type="ObjectPattern",N&&this.checkPatternErrors(N,!0);for(var O=0,$=y.properties;O<$.length;O+=1){var _e=$[O];this.toAssignable(_e,T),_e.type==="RestElement"&&(_e.argument.type==="ArrayPattern"||_e.argument.type==="ObjectPattern")&&this.raise(_e.argument.start,"Unexpected token")}break;case"Property":y.kind!=="init"&&this.raise(y.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(y.value,T);break;case"ArrayExpression":y.type="ArrayPattern",N&&this.checkPatternErrors(N,!0),this.toAssignableList(y.elements,T);break;case"SpreadElement":y.type="RestElement",this.toAssignable(y.argument,T),y.argument.type==="AssignmentPattern"&&this.raise(y.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":y.operator!=="="&&this.raise(y.left.end,"Only '=' operator can be used for specifying default value."),y.type="AssignmentPattern",delete y.operator,this.toAssignable(y.left,T);case"AssignmentPattern":break;case"ParenthesizedExpression":this.toAssignable(y.expression,T,N);break;case"ChainExpression":this.raiseRecoverable(y.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":if(!T)break;default:this.raise(y.start,"Assigning to rvalue")}else N&&this.checkPatternErrors(N,!0);return y},xn.toAssignableList=function(y,T){for(var N=y.length,O=0;O<N;O++){var $=y[O];$&&this.toAssignable($,T)}if(N){var _e=y[N-1];this.options.ecmaVersion===6&&T&&_e&&_e.type==="RestElement"&&_e.argument.type!=="Identifier"&&this.unexpected(_e.argument.start)}return y},xn.parseSpread=function(y){var T=this.startNode();return this.next(),T.argument=this.parseMaybeAssign(!1,y),this.finishNode(T,"SpreadElement")},xn.parseRestBinding=function(){var y=this.startNode();return this.next(),this.options.ecmaVersion===6&&this.type!==Y.name&&this.unexpected(),y.argument=this.parseBindingAtom(),this.finishNode(y,"RestElement")},xn.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case Y.bracketL:var y=this.startNode();return this.next(),y.elements=this.parseBindingList(Y.bracketR,!0,!0),this.finishNode(y,"ArrayPattern");case Y.braceL:return this.parseObj(!0)}return this.parseIdent()},xn.parseBindingList=function(y,T,N){for(var O=[],$=!0;!this.eat(y);)if($?$=!1:this.expect(Y.comma),T&&this.type===Y.comma)O.push(null);else{if(N&&this.afterTrailingComma(y))break;if(this.type===Y.ellipsis){var _e=this.parseRestBinding();this.parseBindingListItem(_e),O.push(_e),this.type===Y.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.expect(y);break}else{var Xe=this.parseMaybeDefault(this.start,this.startLoc);this.parseBindingListItem(Xe),O.push(Xe)}}return O},xn.parseBindingListItem=function(y){return y},xn.parseMaybeDefault=function(y,T,N){if(N=N||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(Y.eq))return N;var O=this.startNodeAt(y,T);return O.left=N,O.right=this.parseMaybeAssign(),this.finishNode(O,"AssignmentPattern")},xn.checkLVal=function(y,T,N){switch(T===void 0&&(T=Oi),y.type){case"Identifier":T===ca&&y.name==="let"&&this.raiseRecoverable(y.start,"let is disallowed as a lexically bound name"),this.strict&&this.reservedWordsStrictBind.test(y.name)&&this.raiseRecoverable(y.start,(T?"Binding ":"Assigning to ")+y.name+" in strict mode"),N&&(jr(N,y.name)&&this.raiseRecoverable(y.start,"Argument name clash"),N[y.name]=!0),T!==Oi&&T!==Xn&&this.declareName(y.name,T,y.start);break;case"ChainExpression":this.raiseRecoverable(y.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":T&&this.raiseRecoverable(y.start,"Binding member expression");break;case"ObjectPattern":for(var O=0,$=y.properties;O<$.length;O+=1){var _e=$[O];this.checkLVal(_e,T,N)}break;case"Property":this.checkLVal(y.value,T,N);break;case"ArrayPattern":for(var Xe=0,ht=y.elements;Xe<ht.length;Xe+=1){var dt=ht[Xe];dt&&this.checkLVal(dt,T,N)}break;case"AssignmentPattern":this.checkLVal(y.left,T,N);break;case"RestElement":this.checkLVal(y.argument,T,N);break;case"ParenthesizedExpression":this.checkLVal(y.expression,T,N);break;default:this.raise(y.start,(T?"Binding":"Assigning to")+" rvalue")}};var Dn=bi.prototype;Dn.checkPropClash=function(y,T,N){if(!(this.options.ecmaVersion>=9&&y.type==="SpreadElement")&&!(this.options.ecmaVersion>=6&&(y.computed||y.method||y.shorthand))){var O=y.key,$;switch(O.type){case"Identifier":$=O.name;break;case"Literal":$=String(O.value);break;default:return}var _e=y.kind;if(this.options.ecmaVersion>=6){$==="__proto__"&&_e==="init"&&(T.proto&&(N?N.doubleProto<0&&(N.doubleProto=O.start):this.raiseRecoverable(O.start,"Redefinition of __proto__ property")),T.proto=!0);return}$="$"+$;var Xe=T[$];if(Xe){var ht;_e==="init"?ht=this.strict&&Xe.init||Xe.get||Xe.set:ht=Xe.init||Xe[_e],ht&&this.raiseRecoverable(O.start,"Redefinition of property")}else Xe=T[$]={init:!1,get:!1,set:!1};Xe[_e]=!0}},Dn.parseExpression=function(y,T){var N=this.start,O=this.startLoc,$=this.parseMaybeAssign(y,T);if(this.type===Y.comma){var _e=this.startNodeAt(N,O);for(_e.expressions=[$];this.eat(Y.comma);)_e.expressions.push(this.parseMaybeAssign(y,T));return this.finishNode(_e,"SequenceExpression")}return $},Dn.parseMaybeAssign=function(y,T,N){if(this.isContextual("yield")){if(this.inGenerator)return this.parseYield(y);this.exprAllowed=!1}var O=!1,$=-1,_e=-1;T?($=T.parenthesizedAssign,_e=T.trailingComma,T.parenthesizedAssign=T.trailingComma=-1):(T=new he,O=!0);var Xe=this.start,ht=this.startLoc;(this.type===Y.parenL||this.type===Y.name)&&(this.potentialArrowAt=this.start);var dt=this.parseMaybeConditional(y,T);if(N&&(dt=N.call(this,dt,Xe,ht)),this.type.isAssign){var ir=this.startNodeAt(Xe,ht);return ir.operator=this.value,ir.left=this.type===Y.eq?this.toAssignable(dt,!1,T):dt,O||(T.parenthesizedAssign=T.trailingComma=T.doubleProto=-1),T.shorthandAssign>=ir.left.start&&(T.shorthandAssign=-1),this.checkLVal(dt),this.next(),ir.right=this.parseMaybeAssign(y),this.finishNode(ir,"AssignmentExpression")}else O&&this.checkExpressionErrors(T,!0);return $>-1&&(T.parenthesizedAssign=$),_e>-1&&(T.trailingComma=_e),dt},Dn.parseMaybeConditional=function(y,T){var N=this.start,O=this.startLoc,$=this.parseExprOps(y,T);if(this.checkExpressionErrors(T))return $;if(this.eat(Y.question)){var _e=this.startNodeAt(N,O);return _e.test=$,_e.consequent=this.parseMaybeAssign(),this.expect(Y.colon),_e.alternate=this.parseMaybeAssign(y),this.finishNode(_e,"ConditionalExpression")}return $},Dn.parseExprOps=function(y,T){var N=this.start,O=this.startLoc,$=this.parseMaybeUnary(T,!1);return this.checkExpressionErrors(T)||$.start===N&&$.type==="ArrowFunctionExpression"?$:this.parseExprOp($,N,O,-1,y)},Dn.parseExprOp=function(y,T,N,O,$){var _e=this.type.binop;if(_e!=null&&(!$||this.type!==Y._in)&&_e>O){var Xe=this.type===Y.logicalOR||this.type===Y.logicalAND,ht=this.type===Y.coalesce;ht&&(_e=Y.logicalAND.binop);var dt=this.value;this.next();var ir=this.start,sr=this.startLoc,Cn=this.parseExprOp(this.parseMaybeUnary(null,!1),ir,sr,_e,$),ni=this.buildBinary(T,N,y,Cn,dt,Xe||ht);return(Xe&&this.type===Y.coalesce||ht&&(this.type===Y.logicalOR||this.type===Y.logicalAND))&&this.raiseRecoverable(this.start,"Logical expressions and coalesce expressions cannot be mixed. Wrap either by parentheses"),this.parseExprOp(ni,T,N,O,$)}return y},Dn.buildBinary=function(y,T,N,O,$,_e){var Xe=this.startNodeAt(y,T);return Xe.left=N,Xe.operator=$,Xe.right=O,this.finishNode(Xe,_e?"LogicalExpression":"BinaryExpression")},Dn.parseMaybeUnary=function(y,T){var N=this.start,O=this.startLoc,$;if(this.isContextual("await")&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction))$=this.parseAwait(),T=!0;else if(this.type.prefix){var _e=this.startNode(),Xe=this.type===Y.incDec;_e.operator=this.value,_e.prefix=!0,this.next(),_e.argument=this.parseMaybeUnary(null,!0),this.checkExpressionErrors(y,!0),Xe?this.checkLVal(_e.argument):this.strict&&_e.operator==="delete"&&_e.argument.type==="Identifier"?this.raiseRecoverable(_e.start,"Deleting local variable in strict mode"):T=!0,$=this.finishNode(_e,Xe?"UpdateExpression":"UnaryExpression")}else{if($=this.parseExprSubscripts(y),this.checkExpressionErrors(y))return $;for(;this.type.postfix&&!this.canInsertSemicolon();){var ht=this.startNodeAt(N,O);ht.operator=this.value,ht.prefix=!1,ht.argument=$,this.checkLVal($),this.next(),$=this.finishNode(ht,"UpdateExpression")}}return!T&&this.eat(Y.starstar)?this.buildBinary(N,O,$,this.parseMaybeUnary(null,!1),"**",!1):$},Dn.parseExprSubscripts=function(y){var T=this.start,N=this.startLoc,O=this.parseExprAtom(y);if(O.type==="ArrowFunctionExpression"&&this.input.slice(this.lastTokStart,this.lastTokEnd)!==")")return O;var $=this.parseSubscripts(O,T,N);return y&&$.type==="MemberExpression"&&(y.parenthesizedAssign>=$.start&&(y.parenthesizedAssign=-1),y.parenthesizedBind>=$.start&&(y.parenthesizedBind=-1)),$},Dn.parseSubscripts=function(y,T,N,O){for(var $=this.options.ecmaVersion>=8&&y.type==="Identifier"&&y.name==="async"&&this.lastTokEnd===y.end&&!this.canInsertSemicolon()&&y.end-y.start==5&&this.potentialArrowAt===y.start,_e=!1;;){var Xe=this.parseSubscript(y,T,N,O,$,_e);if(Xe.optional&&(_e=!0),Xe===y||Xe.type==="ArrowFunctionExpression"){if(_e){var ht=this.startNodeAt(T,N);ht.expression=Xe,Xe=this.finishNode(ht,"ChainExpression")}return Xe}y=Xe}},Dn.parseSubscript=function(y,T,N,O,$,_e){var Xe=this.options.ecmaVersion>=11,ht=Xe&&this.eat(Y.questionDot);O&&ht&&this.raise(this.lastTokStart,"Optional chaining cannot appear in the callee of new expressions");var dt=this.eat(Y.bracketL);if(dt||ht&&this.type!==Y.parenL&&this.type!==Y.backQuote||this.eat(Y.dot)){var ir=this.startNodeAt(T,N);ir.object=y,ir.property=dt?this.parseExpression():this.parseIdent(this.options.allowReserved!=="never"),ir.computed=!!dt,dt&&this.expect(Y.bracketR),Xe&&(ir.optional=ht),y=this.finishNode(ir,"MemberExpression")}else if(!O&&this.eat(Y.parenL)){var sr=new he,Cn=this.yieldPos,ni=this.awaitPos,In=this.awaitIdentPos;this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0;var Xi=this.parseExprList(Y.parenR,this.options.ecmaVersion>=8,!1,sr);if($&&!ht&&!this.canInsertSemicolon()&&this.eat(Y.arrow))return this.checkPatternErrors(sr,!1),this.checkYieldAwaitInDefaultParams(),this.awaitIdentPos>0&&this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function"),this.yieldPos=Cn,this.awaitPos=ni,this.awaitIdentPos=In,this.parseArrowExpression(this.startNodeAt(T,N),Xi,!0);this.checkExpressionErrors(sr,!0),this.yieldPos=Cn||this.yieldPos,this.awaitPos=ni||this.awaitPos,this.awaitIdentPos=In||this.awaitIdentPos;var va=this.startNodeAt(T,N);va.callee=y,va.arguments=Xi,Xe&&(va.optional=ht),y=this.finishNode(va,"CallExpression")}else if(this.type===Y.backQuote){(ht||_e)&&this.raise(this.start,"Optional chaining cannot appear in the tag of tagged template expressions");var wa=this.startNodeAt(T,N);wa.tag=y,wa.quasi=this.parseTemplate({isTagged:!0}),y=this.finishNode(wa,"TaggedTemplateExpression")}return y},Dn.parseExprAtom=function(y){this.type===Y.slash&&this.readRegexp();var T,N=this.potentialArrowAt===this.start;switch(this.type){case Y._super:return this.allowSuper||this.raise(this.start,"'super' keyword outside a method"),T=this.startNode(),this.next(),this.type===Y.parenL&&!this.allowDirectSuper&&this.raise(T.start,"super() call outside constructor of a subclass"),this.type!==Y.dot&&this.type!==Y.bracketL&&this.type!==Y.parenL&&this.unexpected(),this.finishNode(T,"Super");case Y._this:return T=this.startNode(),this.next(),this.finishNode(T,"ThisExpression");case Y.name:var O=this.start,$=this.startLoc,_e=this.containsEsc,Xe=this.parseIdent(!1);if(this.options.ecmaVersion>=8&&!_e&&Xe.name==="async"&&!this.canInsertSemicolon()&&this.eat(Y._function))return this.parseFunction(this.startNodeAt(O,$),0,!1,!0);if(N&&!this.canInsertSemicolon()){if(this.eat(Y.arrow))return this.parseArrowExpression(this.startNodeAt(O,$),[Xe],!1);if(this.options.ecmaVersion>=8&&Xe.name==="async"&&this.type===Y.name&&!_e)return Xe=this.parseIdent(!1),(this.canInsertSemicolon()||!this.eat(Y.arrow))&&this.unexpected(),this.parseArrowExpression(this.startNodeAt(O,$),[Xe],!0)}return Xe;case Y.regexp:var ht=this.value;return T=this.parseLiteral(ht.value),T.regex={pattern:ht.pattern,flags:ht.flags},T;case Y.num:case Y.string:return this.parseLiteral(this.value);case Y._null:case Y._true:case Y._false:return T=this.startNode(),T.value=this.type===Y._null?null:this.type===Y._true,T.raw=this.type.keyword,this.next(),this.finishNode(T,"Literal");case Y.parenL:var dt=this.start,ir=this.parseParenAndDistinguishExpression(N);return y&&(y.parenthesizedAssign<0&&!this.isSimpleAssignTarget(ir)&&(y.parenthesizedAssign=dt),y.parenthesizedBind<0&&(y.parenthesizedBind=dt)),ir;case Y.bracketL:return T=this.startNode(),this.next(),T.elements=this.parseExprList(Y.bracketR,!0,!0,y),this.finishNode(T,"ArrayExpression");case Y.braceL:return this.parseObj(!1,y);case Y._function:return T=this.startNode(),this.next(),this.parseFunction(T,0);case Y._class:return this.parseClass(this.startNode(),!1);case Y._new:return this.parseNew();case Y.backQuote:return this.parseTemplate();case Y._import:return this.options.ecmaVersion>=11?this.parseExprImport():this.unexpected();default:this.unexpected()}},Dn.parseExprImport=function(){var y=this.startNode();this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword import");var T=this.parseIdent(!0);switch(this.type){case Y.parenL:return this.parseDynamicImport(y);case Y.dot:return y.meta=T,this.parseImportMeta(y);default:this.unexpected()}},Dn.parseDynamicImport=function(y){if(this.next(),y.source=this.parseMaybeAssign(),!this.eat(Y.parenR)){var T=this.start;this.eat(Y.comma)&&this.eat(Y.parenR)?this.raiseRecoverable(T,"Trailing comma is not allowed in import()"):this.unexpected(T)}return this.finishNode(y,"ImportExpression")},Dn.parseImportMeta=function(y){this.next();var T=this.containsEsc;return y.property=this.parseIdent(!0),y.property.name!=="meta"&&this.raiseRecoverable(y.property.start,"The only valid meta property for import is 'import.meta'"),T&&this.raiseRecoverable(y.start,"'import.meta' must not contain escaped characters"),this.options.sourceType!=="module"&&this.raiseRecoverable(y.start,"Cannot use 'import.meta' outside a module"),this.finishNode(y,"MetaProperty")},Dn.parseLiteral=function(y){var T=this.startNode();return T.value=y,T.raw=this.input.slice(this.start,this.end),T.raw.charCodeAt(T.raw.length-1)===110&&(T.bigint=T.raw.slice(0,-1).replace(/_/g,"")),this.next(),this.finishNode(T,"Literal")},Dn.parseParenExpression=function(){this.expect(Y.parenL);var y=this.parseExpression();return this.expect(Y.parenR),y},Dn.parseParenAndDistinguishExpression=function(y){var T=this.start,N=this.startLoc,O,$=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var _e=this.start,Xe=this.startLoc,ht=[],dt=!0,ir=!1,sr=new he,Cn=this.yieldPos,ni=this.awaitPos,In;for(this.yieldPos=0,this.awaitPos=0;this.type!==Y.parenR;)if(dt?dt=!1:this.expect(Y.comma),$&&this.afterTrailingComma(Y.parenR,!0)){ir=!0;break}else if(this.type===Y.ellipsis){In=this.start,ht.push(this.parseParenItem(this.parseRestBinding())),this.type===Y.comma&&this.raise(this.start,"Comma is not permitted after the rest element");break}else ht.push(this.parseMaybeAssign(!1,sr,this.parseParenItem));var Xi=this.start,va=this.startLoc;if(this.expect(Y.parenR),y&&!this.canInsertSemicolon()&&this.eat(Y.arrow))return this.checkPatternErrors(sr,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=Cn,this.awaitPos=ni,this.parseParenArrowList(T,N,ht);(!ht.length||ir)&&this.unexpected(this.lastTokStart),In&&this.unexpected(In),this.checkExpressionErrors(sr,!0),this.yieldPos=Cn||this.yieldPos,this.awaitPos=ni||this.awaitPos,ht.length>1?(O=this.startNodeAt(_e,Xe),O.expressions=ht,this.finishNodeAt(O,"SequenceExpression",Xi,va)):O=ht[0]}else O=this.parseParenExpression();if(this.options.preserveParens){var wa=this.startNodeAt(T,N);return wa.expression=O,this.finishNode(wa,"ParenthesizedExpression")}else return O},Dn.parseParenItem=function(y){return y},Dn.parseParenArrowList=function(y,T,N){return this.parseArrowExpression(this.startNodeAt(y,T),N)};var pi=[];Dn.parseNew=function(){this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword new");var y=this.startNode(),T=this.parseIdent(!0);if(this.options.ecmaVersion>=6&&this.eat(Y.dot)){y.meta=T;var N=this.containsEsc;return y.property=this.parseIdent(!0),y.property.name!=="target"&&this.raiseRecoverable(y.property.start,"The only valid meta property for new is 'new.target'"),N&&this.raiseRecoverable(y.start,"'new.target' must not contain escaped characters"),this.inNonArrowFunction()||this.raiseRecoverable(y.start,"'new.target' can only be used in functions"),this.finishNode(y,"MetaProperty")}var O=this.start,$=this.startLoc,_e=this.type===Y._import;return y.callee=this.parseSubscripts(this.parseExprAtom(),O,$,!0),_e&&y.callee.type==="ImportExpression"&&this.raise(O,"Cannot use new with import()"),this.eat(Y.parenL)?y.arguments=this.parseExprList(Y.parenR,this.options.ecmaVersion>=8,!1):y.arguments=pi,this.finishNode(y,"NewExpression")},Dn.parseTemplateElement=function(y){var T=y.isTagged,N=this.startNode();return this.type===Y.invalidTemplate?(T||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),N.value={raw:this.value,cooked:null}):N.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,`
`),cooked:this.value},this.next(),N.tail=this.type===Y.backQuote,this.finishNode(N,"TemplateElement")},Dn.parseTemplate=function(y){y===void 0&&(y={});var T=y.isTagged;T===void 0&&(T=!1);var N=this.startNode();this.next(),N.expressions=[];var O=this.parseTemplateElement({isTagged:T});for(N.quasis=[O];!O.tail;)this.type===Y.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(Y.dollarBraceL),N.expressions.push(this.parseExpression()),this.expect(Y.braceR),N.quasis.push(O=this.parseTemplateElement({isTagged:T}));return this.next(),this.finishNode(N,"TemplateLiteral")},Dn.isAsyncProp=function(y){return!y.computed&&y.key.type==="Identifier"&&y.key.name==="async"&&(this.type===Y.name||this.type===Y.num||this.type===Y.string||this.type===Y.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===Y.star)&&!Wt.test(this.input.slice(this.lastTokEnd,this.start))},Dn.parseObj=function(y,T){var N=this.startNode(),O=!0,$={};for(N.properties=[],this.next();!this.eat(Y.braceR);){if(O)O=!1;else if(this.expect(Y.comma),this.options.ecmaVersion>=5&&this.afterTrailingComma(Y.braceR))break;var _e=this.parseProperty(y,T);y||this.checkPropClash(_e,$,T),N.properties.push(_e)}return this.finishNode(N,y?"ObjectPattern":"ObjectExpression")},Dn.parseProperty=function(y,T){var N=this.startNode(),O,$,_e,Xe;if(this.options.ecmaVersion>=9&&this.eat(Y.ellipsis))return y?(N.argument=this.parseIdent(!1),this.type===Y.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.finishNode(N,"RestElement")):(this.type===Y.parenL&&T&&(T.parenthesizedAssign<0&&(T.parenthesizedAssign=this.start),T.parenthesizedBind<0&&(T.parenthesizedBind=this.start)),N.argument=this.parseMaybeAssign(!1,T),this.type===Y.comma&&T&&T.trailingComma<0&&(T.trailingComma=this.start),this.finishNode(N,"SpreadElement"));this.options.ecmaVersion>=6&&(N.method=!1,N.shorthand=!1,(y||T)&&(_e=this.start,Xe=this.startLoc),y||(O=this.eat(Y.star)));var ht=this.containsEsc;return this.parsePropertyName(N),!y&&!ht&&this.options.ecmaVersion>=8&&!O&&this.isAsyncProp(N)?($=!0,O=this.options.ecmaVersion>=9&&this.eat(Y.star),this.parsePropertyName(N,T)):$=!1,this.parsePropertyValue(N,y,O,$,_e,Xe,T,ht),this.finishNode(N,"Property")},Dn.parsePropertyValue=function(y,T,N,O,$,_e,Xe,ht){if((N||O)&&this.type===Y.colon&&this.unexpected(),this.eat(Y.colon))y.value=T?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,Xe),y.kind="init";else if(this.options.ecmaVersion>=6&&this.type===Y.parenL)T&&this.unexpected(),y.kind="init",y.method=!0,y.value=this.parseMethod(N,O);else if(!T&&!ht&&this.options.ecmaVersion>=5&&!y.computed&&y.key.type==="Identifier"&&(y.key.name==="get"||y.key.name==="set")&&this.type!==Y.comma&&this.type!==Y.braceR&&this.type!==Y.eq){(N||O)&&this.unexpected(),y.kind=y.key.name,this.parsePropertyName(y),y.value=this.parseMethod(!1);var dt=y.kind==="get"?0:1;if(y.value.params.length!==dt){var ir=y.value.start;y.kind==="get"?this.raiseRecoverable(ir,"getter should have no params"):this.raiseRecoverable(ir,"setter should have exactly one param")}else y.kind==="set"&&y.value.params[0].type==="RestElement"&&this.raiseRecoverable(y.value.params[0].start,"Setter cannot use rest params")}else this.options.ecmaVersion>=6&&!y.computed&&y.key.type==="Identifier"?((N||O)&&this.unexpected(),this.checkUnreserved(y.key),y.key.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=$),y.kind="init",T?y.value=this.parseMaybeDefault($,_e,y.key):this.type===Y.eq&&Xe?(Xe.shorthandAssign<0&&(Xe.shorthandAssign=this.start),y.value=this.parseMaybeDefault($,_e,y.key)):y.value=y.key,y.shorthand=!0):this.unexpected()},Dn.parsePropertyName=function(y){if(this.options.ecmaVersion>=6){if(this.eat(Y.bracketL))return y.computed=!0,y.key=this.parseMaybeAssign(),this.expect(Y.bracketR),y.key;y.computed=!1}return y.key=this.type===Y.num||this.type===Y.string?this.parseExprAtom():this.parseIdent(this.options.allowReserved!=="never")},Dn.initFunction=function(y){y.id=null,this.options.ecmaVersion>=6&&(y.generator=y.expression=!1),this.options.ecmaVersion>=8&&(y.async=!1)},Dn.parseMethod=function(y,T,N){var O=this.startNode(),$=this.yieldPos,_e=this.awaitPos,Xe=this.awaitIdentPos;return this.initFunction(O),this.options.ecmaVersion>=6&&(O.generator=y),this.options.ecmaVersion>=8&&(O.async=!!T),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(Vi(T,O.generator)|hi|(N?la:0)),this.expect(Y.parenL),O.params=this.parseBindingList(Y.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(O,!1,!0),this.yieldPos=$,this.awaitPos=_e,this.awaitIdentPos=Xe,this.finishNode(O,"FunctionExpression")},Dn.parseArrowExpression=function(y,T,N){var O=this.yieldPos,$=this.awaitPos,_e=this.awaitIdentPos;return this.enterScope(Vi(N,!1)|fi),this.initFunction(y),this.options.ecmaVersion>=8&&(y.async=!!N),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,y.params=this.toAssignableList(T,!0),this.parseFunctionBody(y,!0,!1),this.yieldPos=O,this.awaitPos=$,this.awaitIdentPos=_e,this.finishNode(y,"ArrowFunctionExpression")},Dn.parseFunctionBody=function(y,T,N){var O=T&&this.type!==Y.braceL,$=this.strict,_e=!1;if(O)y.body=this.parseMaybeAssign(),y.expression=!0,this.checkParams(y,!1);else{var Xe=this.options.ecmaVersion>=7&&!this.isSimpleParamList(y.params);(!$||Xe)&&(_e=this.strictDirective(this.end),_e&&Xe&&this.raiseRecoverable(y.start,"Illegal 'use strict' directive in function with non-simple parameter list"));var ht=this.labels;this.labels=[],_e&&(this.strict=!0),this.checkParams(y,!$&&!_e&&!T&&!N&&this.isSimpleParamList(y.params)),this.strict&&y.id&&this.checkLVal(y.id,Xn),y.body=this.parseBlock(!1,void 0,_e&&!$),y.expression=!1,this.adaptDirectivePrologue(y.body.body),this.labels=ht}this.exitScope()},Dn.isSimpleParamList=function(y){for(var T=0,N=y;T<N.length;T+=1){var O=N[T];if(O.type!=="Identifier")return!1}return!0},Dn.checkParams=function(y,T){for(var N={},O=0,$=y.params;O<$.length;O+=1){var _e=$[O];this.checkLVal(_e,qi,T?null:N)}},Dn.parseExprList=function(y,T,N,O){for(var $=[],_e=!0;!this.eat(y);){if(_e)_e=!1;else if(this.expect(Y.comma),T&&this.afterTrailingComma(y))break;var Xe=void 0;N&&this.type===Y.comma?Xe=null:this.type===Y.ellipsis?(Xe=this.parseSpread(O),O&&this.type===Y.comma&&O.trailingComma<0&&(O.trailingComma=this.start)):Xe=this.parseMaybeAssign(!1,O),$.push(Xe)}return $},Dn.checkUnreserved=function(y){var T=y.start,N=y.end,O=y.name;if(this.inGenerator&&O==="yield"&&this.raiseRecoverable(T,"Cannot use 'yield' as identifier inside a generator"),this.inAsync&&O==="await"&&this.raiseRecoverable(T,"Cannot use 'await' as identifier inside an async function"),this.keywords.test(O)&&this.raise(T,"Unexpected keyword '"+O+"'"),!(this.options.ecmaVersion<6&&this.input.slice(T,N).indexOf("\\")!==-1)){var $=this.strict?this.reservedWordsStrict:this.reservedWords;$.test(O)&&(!this.inAsync&&O==="await"&&this.raiseRecoverable(T,"Cannot use keyword 'await' outside an async function"),this.raiseRecoverable(T,"The keyword '"+O+"' is reserved"))}},Dn.parseIdent=function(y,T){var N=this.startNode();return this.type===Y.name?N.name=this.value:this.type.keyword?(N.name=this.type.keyword,(N.name==="class"||N.name==="function")&&(this.lastTokEnd!==this.lastTokStart+1||this.input.charCodeAt(this.lastTokStart)!==46)&&this.context.pop()):this.unexpected(),this.next(!!y),this.finishNode(N,"Identifier"),y||(this.checkUnreserved(N),N.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=N.start)),N},Dn.parseYield=function(y){this.yieldPos||(this.yieldPos=this.start);var T=this.startNode();return this.next(),this.type===Y.semi||this.canInsertSemicolon()||this.type!==Y.star&&!this.type.startsExpr?(T.delegate=!1,T.argument=null):(T.delegate=this.eat(Y.star),T.argument=this.parseMaybeAssign(y)),this.finishNode(T,"YieldExpression")},Dn.parseAwait=function(){this.awaitPos||(this.awaitPos=this.start);var y=this.startNode();return this.next(),y.argument=this.parseMaybeUnary(null,!1),this.finishNode(y,"AwaitExpression")};var qn=bi.prototype;qn.raise=function(y,T){var N=gt(this.input,y);T+=" ("+N.line+":"+N.column+")";var O=new SyntaxError(T);throw O.pos=y,O.loc=N,O.raisedAt=this.pos,O},qn.raiseRecoverable=qn.raise,qn.curPosition=function(){if(this.options.locations)return new Le(this.curLine,this.pos-this.lineStart)};var on=bi.prototype,Ri=function(T){this.flags=T,this.var=[],this.lexical=[],this.functions=[]};on.enterScope=function(y){this.scopeStack.push(new Ri(y))},on.exitScope=function(){this.scopeStack.pop()},on.treatFunctionsAsVarInScope=function(y){return y.flags&cn||!this.inModule&&y.flags&Yn},on.declareName=function(y,T,N){var O=!1;if(T===ca){var $=this.currentScope();O=$.lexical.indexOf(y)>-1||$.functions.indexOf(y)>-1||$.var.indexOf(y)>-1,$.lexical.push(y),this.inModule&&$.flags&Yn&&delete this.undefinedExports[y]}else if(T===ma){var _e=this.currentScope();_e.lexical.push(y)}else if(T===Ci){var Xe=this.currentScope();this.treatFunctionsAsVar?O=Xe.lexical.indexOf(y)>-1:O=Xe.lexical.indexOf(y)>-1||Xe.var.indexOf(y)>-1,Xe.functions.push(y)}else for(var ht=this.scopeStack.length-1;ht>=0;--ht){var dt=this.scopeStack[ht];if(dt.lexical.indexOf(y)>-1&&!(dt.flags&Gn&&dt.lexical[0]===y)||!this.treatFunctionsAsVarInScope(dt)&&dt.functions.indexOf(y)>-1){O=!0;break}if(dt.var.push(y),this.inModule&&dt.flags&Yn&&delete this.undefinedExports[y],dt.flags&ci)break}O&&this.raiseRecoverable(N,"Identifier '"+y+"' has already been declared")},on.checkLocalExport=function(y){this.scopeStack[0].lexical.indexOf(y.name)===-1&&this.scopeStack[0].var.indexOf(y.name)===-1&&(this.undefinedExports[y.name]=y)},on.currentScope=function(){return this.scopeStack[this.scopeStack.length-1]},on.currentVarScope=function(){for(var y=this.scopeStack.length-1;;y--){var T=this.scopeStack[y];if(T.flags&ci)return T}},on.currentThisScope=function(){for(var y=this.scopeStack.length-1;;y--){var T=this.scopeStack[y];if(T.flags&ci&&!(T.flags&fi))return T}};var Ii=function(T,N,O){this.type="",this.start=N,this.end=0,T.options.locations&&(this.loc=new Et(T,O)),T.options.directSourceFile&&(this.sourceFile=T.options.directSourceFile),T.options.ranges&&(this.range=[N,0])},Qa=bi.prototype;Qa.startNode=function(){return new Ii(this,this.start,this.startLoc)},Qa.startNodeAt=function(y,T){return new Ii(this,y,T)};function hs(y,T,N,O){return y.type=T,y.end=N,this.options.locations&&(y.loc.end=O),this.options.ranges&&(y.range[1]=N),y}Qa.finishNode=function(y,T){return hs.call(this,y,T,this.lastTokEnd,this.lastTokEndLoc)},Qa.finishNodeAt=function(y,T,N,O){return hs.call(this,y,T,N,O)};var Zo=function(T,N,O,$,_e){this.token=T,this.isExpr=!!N,this.preserveSpace=!!O,this.override=$,this.generator=!!_e},Fa={b_stat:new Zo("{",!1),b_expr:new Zo("{",!0),b_tmpl:new Zo("${",!1),p_stat:new Zo("(",!1),p_expr:new Zo("(",!0),q_tmpl:new Zo("`",!0,!0,function(y){return y.tryReadTemplateToken()}),f_stat:new Zo("function",!1),f_expr:new Zo("function",!0),f_expr_gen:new Zo("function",!0,!1,null,!0),f_gen:new Zo("function",!1,!1,null,!0)},ba=bi.prototype;ba.initialContext=function(){return[Fa.b_stat]},ba.braceIsBlock=function(y){var T=this.curContext();return T===Fa.f_expr||T===Fa.f_stat?!0:y===Y.colon&&(T===Fa.b_stat||T===Fa.b_expr)?!T.isExpr:y===Y._return||y===Y.name&&this.exprAllowed?Wt.test(this.input.slice(this.lastTokEnd,this.start)):y===Y._else||y===Y.semi||y===Y.eof||y===Y.parenR||y===Y.arrow?!0:y===Y.braceL?T===Fa.b_stat:y===Y._var||y===Y._const||y===Y.name?!1:!this.exprAllowed},ba.inGeneratorContext=function(){for(var y=this.context.length-1;y>=1;y--){var T=this.context[y];if(T.token==="function")return T.generator}return!1},ba.updateContext=function(y){var T,N=this.type;N.keyword&&y===Y.dot?this.exprAllowed=!1:(T=N.updateContext)?T.call(this,y):this.exprAllowed=N.beforeExpr},Y.parenR.updateContext=Y.braceR.updateContext=function(){if(this.context.length===1){this.exprAllowed=!0;return}var y=this.context.pop();y===Fa.b_stat&&this.curContext().token==="function"&&(y=this.context.pop()),this.exprAllowed=!y.isExpr},Y.braceL.updateContext=function(y){this.context.push(this.braceIsBlock(y)?Fa.b_stat:Fa.b_expr),this.exprAllowed=!0},Y.dollarBraceL.updateContext=function(){this.context.push(Fa.b_tmpl),this.exprAllowed=!0},Y.parenL.updateContext=function(y){var T=y===Y._if||y===Y._for||y===Y._with||y===Y._while;this.context.push(T?Fa.p_stat:Fa.p_expr),this.exprAllowed=!0},Y.incDec.updateContext=function(){},Y._function.updateContext=Y._class.updateContext=function(y){y.beforeExpr&&y!==Y.semi&&y!==Y._else&&!(y===Y._return&&Wt.test(this.input.slice(this.lastTokEnd,this.start)))&&!((y===Y.colon||y===Y.braceL)&&this.curContext()===Fa.b_stat)?this.context.push(Fa.f_expr):this.context.push(Fa.f_stat),this.exprAllowed=!1},Y.backQuote.updateContext=function(){this.curContext()===Fa.q_tmpl?this.context.pop():this.context.push(Fa.q_tmpl),this.exprAllowed=!1},Y.star.updateContext=function(y){if(y===Y._function){var T=this.context.length-1;this.context[T]===Fa.f_expr?this.context[T]=Fa.f_expr_gen:this.context[T]=Fa.f_gen}this.exprAllowed=!0},Y.name.updateContext=function(y){var T=!1;this.options.ecmaVersion>=6&&y!==Y.dot&&(this.value==="of"&&!this.exprAllowed||this.value==="yield"&&this.inGeneratorContext())&&(T=!0),this.exprAllowed=T};var G="ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS",ee=G+" Extended_Pictographic",ae=ee,me={9:G,10:ee,11:ae},Pe="Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu",Ge="Adlam Adlm Ahom Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb",tt=Ge+" Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd",ce=tt+" Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho",Re={9:Ge,10:tt,11:ce},mt={};function hr(y){var T=mt[y]={binary:we(me[y]+" "+Pe),nonBinary:{General_Category:we(Pe),Script:we(Re[y])}};T.nonBinary.Script_Extensions=T.nonBinary.Script,T.nonBinary.gc=T.nonBinary.General_Category,T.nonBinary.sc=T.nonBinary.Script,T.nonBinary.scx=T.nonBinary.Script_Extensions}hr(9),hr(10),hr(11);var Ot=bi.prototype,Ft=function(T){this.parser=T,this.validFlags="gim"+(T.options.ecmaVersion>=6?"uy":"")+(T.options.ecmaVersion>=9?"s":""),this.unicodeProperties=mt[T.options.ecmaVersion>=11?11:T.options.ecmaVersion],this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=[],this.backReferenceNames=[]};Ft.prototype.reset=function(T,N,O){var $=O.indexOf("u")!==-1;this.start=T|0,this.source=N+"",this.flags=O,this.switchU=$&&this.parser.options.ecmaVersion>=6,this.switchN=$&&this.parser.options.ecmaVersion>=9},Ft.prototype.raise=function(T){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+T)},Ft.prototype.at=function(T,N){N===void 0&&(N=!1);var O=this.source,$=O.length;if(T>=$)return-1;var _e=O.charCodeAt(T);if(!(N||this.switchU)||_e<=55295||_e>=57344||T+1>=$)return _e;var Xe=O.charCodeAt(T+1);return Xe>=56320&&Xe<=57343?(_e<<10)+Xe-56613888:_e},Ft.prototype.nextIndex=function(T,N){N===void 0&&(N=!1);var O=this.source,$=O.length;if(T>=$)return $;var _e=O.charCodeAt(T),Xe;return!(N||this.switchU)||_e<=55295||_e>=57344||T+1>=$||(Xe=O.charCodeAt(T+1))<56320||Xe>57343?T+1:T+2},Ft.prototype.current=function(T){return T===void 0&&(T=!1),this.at(this.pos,T)},Ft.prototype.lookahead=function(T){return T===void 0&&(T=!1),this.at(this.nextIndex(this.pos,T),T)},Ft.prototype.advance=function(T){T===void 0&&(T=!1),this.pos=this.nextIndex(this.pos,T)},Ft.prototype.eat=function(T,N){return N===void 0&&(N=!1),this.current(N)===T?(this.advance(N),!0):!1};function pr(y){return y<=65535?String.fromCharCode(y):(y-=65536,String.fromCharCode((y>>10)+55296,(y&1023)+56320))}Ot.validateRegExpFlags=function(y){for(var T=y.validFlags,N=y.flags,O=0;O<N.length;O++){var $=N.charAt(O);T.indexOf($)===-1&&this.raise(y.start,"Invalid regular expression flag"),N.indexOf($,O+1)>-1&&this.raise(y.start,"Duplicate regular expression flag")}},Ot.validateRegExpPattern=function(y){this.regexp_pattern(y),!y.switchN&&this.options.ecmaVersion>=9&&y.groupNames.length>0&&(y.switchN=!0,this.regexp_pattern(y))},Ot.regexp_pattern=function(y){y.pos=0,y.lastIntValue=0,y.lastStringValue="",y.lastAssertionIsQuantifiable=!1,y.numCapturingParens=0,y.maxBackReference=0,y.groupNames.length=0,y.backReferenceNames.length=0,this.regexp_disjunction(y),y.pos!==y.source.length&&(y.eat(41)&&y.raise("Unmatched ')'"),(y.eat(93)||y.eat(125))&&y.raise("Lone quantifier brackets")),y.maxBackReference>y.numCapturingParens&&y.raise("Invalid escape");for(var T=0,N=y.backReferenceNames;T<N.length;T+=1){var O=N[T];y.groupNames.indexOf(O)===-1&&y.raise("Invalid named capture referenced")}},Ot.regexp_disjunction=function(y){for(this.regexp_alternative(y);y.eat(124);)this.regexp_alternative(y);this.regexp_eatQuantifier(y,!0)&&y.raise("Nothing to repeat"),y.eat(123)&&y.raise("Lone quantifier brackets")},Ot.regexp_alternative=function(y){for(;y.pos<y.source.length&&this.regexp_eatTerm(y););},Ot.regexp_eatTerm=function(y){return this.regexp_eatAssertion(y)?(y.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(y)&&y.switchU&&y.raise("Invalid quantifier"),!0):(y.switchU?this.regexp_eatAtom(y):this.regexp_eatExtendedAtom(y))?(this.regexp_eatQuantifier(y),!0):!1},Ot.regexp_eatAssertion=function(y){var T=y.pos;if(y.lastAssertionIsQuantifiable=!1,y.eat(94)||y.eat(36))return!0;if(y.eat(92)){if(y.eat(66)||y.eat(98))return!0;y.pos=T}if(y.eat(40)&&y.eat(63)){var N=!1;if(this.options.ecmaVersion>=9&&(N=y.eat(60)),y.eat(61)||y.eat(33))return this.regexp_disjunction(y),y.eat(41)||y.raise("Unterminated group"),y.lastAssertionIsQuantifiable=!N,!0}return y.pos=T,!1},Ot.regexp_eatQuantifier=function(y,T){return T===void 0&&(T=!1),this.regexp_eatQuantifierPrefix(y,T)?(y.eat(63),!0):!1},Ot.regexp_eatQuantifierPrefix=function(y,T){return y.eat(42)||y.eat(43)||y.eat(63)||this.regexp_eatBracedQuantifier(y,T)},Ot.regexp_eatBracedQuantifier=function(y,T){var N=y.pos;if(y.eat(123)){var O=0,$=-1;if(this.regexp_eatDecimalDigits(y)&&(O=y.lastIntValue,y.eat(44)&&this.regexp_eatDecimalDigits(y)&&($=y.lastIntValue),y.eat(125)))return $!==-1&&$<O&&!T&&y.raise("numbers out of order in {} quantifier"),!0;y.switchU&&!T&&y.raise("Incomplete quantifier"),y.pos=N}return!1},Ot.regexp_eatAtom=function(y){return this.regexp_eatPatternCharacters(y)||y.eat(46)||this.regexp_eatReverseSolidusAtomEscape(y)||this.regexp_eatCharacterClass(y)||this.regexp_eatUncapturingGroup(y)||this.regexp_eatCapturingGroup(y)},Ot.regexp_eatReverseSolidusAtomEscape=function(y){var T=y.pos;if(y.eat(92)){if(this.regexp_eatAtomEscape(y))return!0;y.pos=T}return!1},Ot.regexp_eatUncapturingGroup=function(y){var T=y.pos;if(y.eat(40)){if(y.eat(63)&&y.eat(58)){if(this.regexp_disjunction(y),y.eat(41))return!0;y.raise("Unterminated group")}y.pos=T}return!1},Ot.regexp_eatCapturingGroup=function(y){if(y.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(y):y.current()===63&&y.raise("Invalid group"),this.regexp_disjunction(y),y.eat(41))return y.numCapturingParens+=1,!0;y.raise("Unterminated group")}return!1},Ot.regexp_eatExtendedAtom=function(y){return y.eat(46)||this.regexp_eatReverseSolidusAtomEscape(y)||this.regexp_eatCharacterClass(y)||this.regexp_eatUncapturingGroup(y)||this.regexp_eatCapturingGroup(y)||this.regexp_eatInvalidBracedQuantifier(y)||this.regexp_eatExtendedPatternCharacter(y)},Ot.regexp_eatInvalidBracedQuantifier=function(y){return this.regexp_eatBracedQuantifier(y,!0)&&y.raise("Nothing to repeat"),!1},Ot.regexp_eatSyntaxCharacter=function(y){var T=y.current();return gn(T)?(y.lastIntValue=T,y.advance(),!0):!1};function gn(y){return y===36||y>=40&&y<=43||y===46||y===63||y>=91&&y<=94||y>=123&&y<=125}Ot.regexp_eatPatternCharacters=function(y){for(var T=y.pos,N=0;(N=y.current())!==-1&&!gn(N);)y.advance();return y.pos!==T},Ot.regexp_eatExtendedPatternCharacter=function(y){var T=y.current();return T!==-1&&T!==36&&!(T>=40&&T<=43)&&T!==46&&T!==63&&T!==91&&T!==94&&T!==124?(y.advance(),!0):!1},Ot.regexp_groupSpecifier=function(y){if(y.eat(63)){if(this.regexp_eatGroupName(y)){y.groupNames.indexOf(y.lastStringValue)!==-1&&y.raise("Duplicate capture group name"),y.groupNames.push(y.lastStringValue);return}y.raise("Invalid group")}},Ot.regexp_eatGroupName=function(y){if(y.lastStringValue="",y.eat(60)){if(this.regexp_eatRegExpIdentifierName(y)&&y.eat(62))return!0;y.raise("Invalid capture group name")}return!1},Ot.regexp_eatRegExpIdentifierName=function(y){if(y.lastStringValue="",this.regexp_eatRegExpIdentifierStart(y)){for(y.lastStringValue+=pr(y.lastIntValue);this.regexp_eatRegExpIdentifierPart(y);)y.lastStringValue+=pr(y.lastIntValue);return!0}return!1},Ot.regexp_eatRegExpIdentifierStart=function(y){var T=y.pos,N=this.options.ecmaVersion>=11,O=y.current(N);return y.advance(N),O===92&&this.regexp_eatRegExpUnicodeEscapeSequence(y,N)&&(O=y.lastIntValue),un(O)?(y.lastIntValue=O,!0):(y.pos=T,!1)};function un(y){return ot(y,!0)||y===36||y===95}Ot.regexp_eatRegExpIdentifierPart=function(y){var T=y.pos,N=this.options.ecmaVersion>=11,O=y.current(N);return y.advance(N),O===92&&this.regexp_eatRegExpUnicodeEscapeSequence(y,N)&&(O=y.lastIntValue),Tt(O)?(y.lastIntValue=O,!0):(y.pos=T,!1)};function Tt(y){return Jt(y,!0)||y===36||y===95||y===8204||y===8205}Ot.regexp_eatAtomEscape=function(y){return this.regexp_eatBackReference(y)||this.regexp_eatCharacterClassEscape(y)||this.regexp_eatCharacterEscape(y)||y.switchN&&this.regexp_eatKGroupName(y)?!0:(y.switchU&&(y.current()===99&&y.raise("Invalid unicode escape"),y.raise("Invalid escape")),!1)},Ot.regexp_eatBackReference=function(y){var T=y.pos;if(this.regexp_eatDecimalEscape(y)){var N=y.lastIntValue;if(y.switchU)return N>y.maxBackReference&&(y.maxBackReference=N),!0;if(N<=y.numCapturingParens)return!0;y.pos=T}return!1},Ot.regexp_eatKGroupName=function(y){if(y.eat(107)){if(this.regexp_eatGroupName(y))return y.backReferenceNames.push(y.lastStringValue),!0;y.raise("Invalid named reference")}return!1},Ot.regexp_eatCharacterEscape=function(y){return this.regexp_eatControlEscape(y)||this.regexp_eatCControlLetter(y)||this.regexp_eatZero(y)||this.regexp_eatHexEscapeSequence(y)||this.regexp_eatRegExpUnicodeEscapeSequence(y,!1)||!y.switchU&&this.regexp_eatLegacyOctalEscapeSequence(y)||this.regexp_eatIdentityEscape(y)},Ot.regexp_eatCControlLetter=function(y){var T=y.pos;if(y.eat(99)){if(this.regexp_eatControlLetter(y))return!0;y.pos=T}return!1},Ot.regexp_eatZero=function(y){return y.current()===48&&!An(y.lookahead())?(y.lastIntValue=0,y.advance(),!0):!1},Ot.regexp_eatControlEscape=function(y){var T=y.current();return T===116?(y.lastIntValue=9,y.advance(),!0):T===110?(y.lastIntValue=10,y.advance(),!0):T===118?(y.lastIntValue=11,y.advance(),!0):T===102?(y.lastIntValue=12,y.advance(),!0):T===114?(y.lastIntValue=13,y.advance(),!0):!1},Ot.regexp_eatControlLetter=function(y){var T=y.current();return Jr(T)?(y.lastIntValue=T%32,y.advance(),!0):!1};function Jr(y){return y>=65&&y<=90||y>=97&&y<=122}Ot.regexp_eatRegExpUnicodeEscapeSequence=function(y,T){T===void 0&&(T=!1);var N=y.pos,O=T||y.switchU;if(y.eat(117)){if(this.regexp_eatFixedHexDigits(y,4)){var $=y.lastIntValue;if(O&&$>=55296&&$<=56319){var _e=y.pos;if(y.eat(92)&&y.eat(117)&&this.regexp_eatFixedHexDigits(y,4)){var Xe=y.lastIntValue;if(Xe>=56320&&Xe<=57343)return y.lastIntValue=($-55296)*1024+(Xe-56320)+65536,!0}y.pos=_e,y.lastIntValue=$}return!0}if(O&&y.eat(123)&&this.regexp_eatHexDigits(y)&&y.eat(125)&&Dr(y.lastIntValue))return!0;O&&y.raise("Invalid unicode escape"),y.pos=N}return!1};function Dr(y){return y>=0&&y<=1114111}Ot.regexp_eatIdentityEscape=function(y){if(y.switchU)return this.regexp_eatSyntaxCharacter(y)?!0:y.eat(47)?(y.lastIntValue=47,!0):!1;var T=y.current();return T!==99&&(!y.switchN||T!==107)?(y.lastIntValue=T,y.advance(),!0):!1},Ot.regexp_eatDecimalEscape=function(y){y.lastIntValue=0;var T=y.current();if(T>=49&&T<=57){do y.lastIntValue=10*y.lastIntValue+(T-48),y.advance();while((T=y.current())>=48&&T<=57);return!0}return!1},Ot.regexp_eatCharacterClassEscape=function(y){var T=y.current();if(Gr(T))return y.lastIntValue=-1,y.advance(),!0;if(y.switchU&&this.options.ecmaVersion>=9&&(T===80||T===112)){if(y.lastIntValue=-1,y.advance(),y.eat(123)&&this.regexp_eatUnicodePropertyValueExpression(y)&&y.eat(125))return!0;y.raise("Invalid property name")}return!1};function Gr(y){return y===100||y===68||y===115||y===83||y===119||y===87}Ot.regexp_eatUnicodePropertyValueExpression=function(y){var T=y.pos;if(this.regexp_eatUnicodePropertyName(y)&&y.eat(61)){var N=y.lastStringValue;if(this.regexp_eatUnicodePropertyValue(y)){var O=y.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(y,N,O),!0}}if(y.pos=T,this.regexp_eatLoneUnicodePropertyNameOrValue(y)){var $=y.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(y,$),!0}return!1},Ot.regexp_validateUnicodePropertyNameAndValue=function(y,T,N){jr(y.unicodeProperties.nonBinary,T)||y.raise("Invalid property name"),y.unicodeProperties.nonBinary[T].test(N)||y.raise("Invalid property value")},Ot.regexp_validateUnicodePropertyNameOrValue=function(y,T){y.unicodeProperties.binary.test(T)||y.raise("Invalid property name")},Ot.regexp_eatUnicodePropertyName=function(y){var T=0;for(y.lastStringValue="";vi(T=y.current());)y.lastStringValue+=pr(T),y.advance();return y.lastStringValue!==""};function vi(y){return Jr(y)||y===95}Ot.regexp_eatUnicodePropertyValue=function(y){var T=0;for(y.lastStringValue="";Qr(T=y.current());)y.lastStringValue+=pr(T),y.advance();return y.lastStringValue!==""};function Qr(y){return vi(y)||An(y)}Ot.regexp_eatLoneUnicodePropertyNameOrValue=function(y){return this.regexp_eatUnicodePropertyValue(y)},Ot.regexp_eatCharacterClass=function(y){if(y.eat(91)){if(y.eat(94),this.regexp_classRanges(y),y.eat(93))return!0;y.raise("Unterminated character class")}return!1},Ot.regexp_classRanges=function(y){for(;this.regexp_eatClassAtom(y);){var T=y.lastIntValue;if(y.eat(45)&&this.regexp_eatClassAtom(y)){var N=y.lastIntValue;y.switchU&&(T===-1||N===-1)&&y.raise("Invalid character class"),T!==-1&&N!==-1&&T>N&&y.raise("Range out of order in character class")}}},Ot.regexp_eatClassAtom=function(y){var T=y.pos;if(y.eat(92)){if(this.regexp_eatClassEscape(y))return!0;if(y.switchU){var N=y.current();(N===99||Ti(N))&&y.raise("Invalid class escape"),y.raise("Invalid escape")}y.pos=T}var O=y.current();return O!==93?(y.lastIntValue=O,y.advance(),!0):!1},Ot.regexp_eatClassEscape=function(y){var T=y.pos;if(y.eat(98))return y.lastIntValue=8,!0;if(y.switchU&&y.eat(45))return y.lastIntValue=45,!0;if(!y.switchU&&y.eat(99)){if(this.regexp_eatClassControlLetter(y))return!0;y.pos=T}return this.regexp_eatCharacterClassEscape(y)||this.regexp_eatCharacterEscape(y)},Ot.regexp_eatClassControlLetter=function(y){var T=y.current();return An(T)||T===95?(y.lastIntValue=T%32,y.advance(),!0):!1},Ot.regexp_eatHexEscapeSequence=function(y){var T=y.pos;if(y.eat(120)){if(this.regexp_eatFixedHexDigits(y,2))return!0;y.switchU&&y.raise("Invalid escape"),y.pos=T}return!1},Ot.regexp_eatDecimalDigits=function(y){var T=y.pos,N=0;for(y.lastIntValue=0;An(N=y.current());)y.lastIntValue=10*y.lastIntValue+(N-48),y.advance();return y.pos!==T};function An(y){return y>=48&&y<=57}Ot.regexp_eatHexDigits=function(y){var T=y.pos,N=0;for(y.lastIntValue=0;Wi(N=y.current());)y.lastIntValue=16*y.lastIntValue+di(N),y.advance();return y.pos!==T};function Wi(y){return y>=48&&y<=57||y>=65&&y<=70||y>=97&&y<=102}function di(y){return y>=65&&y<=70?10+(y-65):y>=97&&y<=102?10+(y-97):y-48}Ot.regexp_eatLegacyOctalEscapeSequence=function(y){if(this.regexp_eatOctalDigit(y)){var T=y.lastIntValue;if(this.regexp_eatOctalDigit(y)){var N=y.lastIntValue;T<=3&&this.regexp_eatOctalDigit(y)?y.lastIntValue=T*64+N*8+y.lastIntValue:y.lastIntValue=T*8+N}else y.lastIntValue=T;return!0}return!1},Ot.regexp_eatOctalDigit=function(y){var T=y.current();return Ti(T)?(y.lastIntValue=T-48,y.advance(),!0):(y.lastIntValue=0,!1)};function Ti(y){return y>=48&&y<=55}Ot.regexp_eatFixedHexDigits=function(y,T){var N=y.pos;y.lastIntValue=0;for(var O=0;O<T;++O){var $=y.current();if(!Wi($))return y.pos=N,!1;y.lastIntValue=16*y.lastIntValue+di($),y.advance()}return!0};var _i=function(T){this.type=T.type,this.value=T.value,this.start=T.start,this.end=T.end,T.options.locations&&(this.loc=new Et(T,T.startLoc,T.endLoc)),T.options.ranges&&(this.range=[T.start,T.end])},Ct=bi.prototype;Ct.next=function(y){!y&&this.type.keyword&&this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+this.type.keyword),this.options.onToken&&this.options.onToken(new _i(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()},Ct.getToken=function(){return this.next(),new _i(this)},typeof Symbol!="undefined"&&(Ct[Symbol.iterator]=function(){var y=this;return{next:function(){var T=y.getToken();return{done:T.type===Y.eof,value:T}}}}),Ct.curContext=function(){return this.context[this.context.length-1]},Ct.nextToken=function(){var y=this.curContext();if((!y||!y.preserveSpace)&&this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length)return this.finishToken(Y.eof);if(y.override)return y.override(this);this.readToken(this.fullCharCodeAtPos())},Ct.readToken=function(y){return ot(y,this.options.ecmaVersion>=6)||y===92?this.readWord():this.getTokenFromCode(y)},Ct.fullCharCodeAtPos=function(){var y=this.input.charCodeAt(this.pos);if(y<=55295||y>=57344)return y;var T=this.input.charCodeAt(this.pos+1);return(y<<10)+T-56613888},Ct.skipBlockComment=function(){var y=this.options.onComment&&this.curPosition(),T=this.pos,N=this.input.indexOf("*/",this.pos+=2);if(N===-1&&this.raise(this.pos-2,"Unterminated comment"),this.pos=N+2,this.options.locations){st.lastIndex=T;for(var O;(O=st.exec(this.input))&&O.index<this.pos;)++this.curLine,this.lineStart=O.index+O[0].length}this.options.onComment&&this.options.onComment(!0,this.input.slice(T+2,N),T,this.pos,y,this.curPosition())},Ct.skipLineComment=function(y){for(var T=this.pos,N=this.options.onComment&&this.curPosition(),O=this.input.charCodeAt(this.pos+=y);this.pos<this.input.length&&!Ye(O);)O=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(T+y,this.pos),T,this.pos,N,this.curPosition())},Ct.skipSpace=function(){e:for(;this.pos<this.input.length;){var y=this.input.charCodeAt(this.pos);switch(y){case 32:case 160:++this.pos;break;case 13:this.input.charCodeAt(this.pos+1)===10&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break e}break;default:if(y>8&&y<14||y>=5760&&ct.test(String.fromCharCode(y)))++this.pos;else break e}}},Ct.finishToken=function(y,T){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var N=this.type;this.type=y,this.value=T,this.updateContext(N)},Ct.readToken_dot=function(){var y=this.input.charCodeAt(this.pos+1);if(y>=48&&y<=57)return this.readNumber(!0);var T=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&y===46&&T===46?(this.pos+=3,this.finishToken(Y.ellipsis)):(++this.pos,this.finishToken(Y.dot))},Ct.readToken_slash=function(){var y=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):y===61?this.finishOp(Y.assign,2):this.finishOp(Y.slash,1)},Ct.readToken_mult_modulo_exp=function(y){var T=this.input.charCodeAt(this.pos+1),N=1,O=y===42?Y.star:Y.modulo;return this.options.ecmaVersion>=7&&y===42&&T===42&&(++N,O=Y.starstar,T=this.input.charCodeAt(this.pos+2)),T===61?this.finishOp(Y.assign,N+1):this.finishOp(O,N)},Ct.readToken_pipe_amp=function(y){var T=this.input.charCodeAt(this.pos+1);if(T===y){if(this.options.ecmaVersion>=12){var N=this.input.charCodeAt(this.pos+2);if(N===61)return this.finishOp(Y.assign,3)}return this.finishOp(y===124?Y.logicalOR:Y.logicalAND,2)}return T===61?this.finishOp(Y.assign,2):this.finishOp(y===124?Y.bitwiseOR:Y.bitwiseAND,1)},Ct.readToken_caret=function(){var y=this.input.charCodeAt(this.pos+1);return y===61?this.finishOp(Y.assign,2):this.finishOp(Y.bitwiseXOR,1)},Ct.readToken_plus_min=function(y){var T=this.input.charCodeAt(this.pos+1);return T===y?T===45&&!this.inModule&&this.input.charCodeAt(this.pos+2)===62&&(this.lastTokEnd===0||Wt.test(this.input.slice(this.lastTokEnd,this.pos)))?(this.skipLineComment(3),this.skipSpace(),this.nextToken()):this.finishOp(Y.incDec,2):T===61?this.finishOp(Y.assign,2):this.finishOp(Y.plusMin,1)},Ct.readToken_lt_gt=function(y){var T=this.input.charCodeAt(this.pos+1),N=1;return T===y?(N=y===62&&this.input.charCodeAt(this.pos+2)===62?3:2,this.input.charCodeAt(this.pos+N)===61?this.finishOp(Y.assign,N+1):this.finishOp(Y.bitShift,N)):T===33&&y===60&&!this.inModule&&this.input.charCodeAt(this.pos+2)===45&&this.input.charCodeAt(this.pos+3)===45?(this.skipLineComment(4),this.skipSpace(),this.nextToken()):(T===61&&(N=2),this.finishOp(Y.relational,N))},Ct.readToken_eq_excl=function(y){var T=this.input.charCodeAt(this.pos+1);return T===61?this.finishOp(Y.equality,this.input.charCodeAt(this.pos+2)===61?3:2):y===61&&T===62&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(Y.arrow)):this.finishOp(y===61?Y.eq:Y.prefix,1)},Ct.readToken_question=function(){var y=this.options.ecmaVersion;if(y>=11){var T=this.input.charCodeAt(this.pos+1);if(T===46){var N=this.input.charCodeAt(this.pos+2);if(N<48||N>57)return this.finishOp(Y.questionDot,2)}if(T===63){if(y>=12){var O=this.input.charCodeAt(this.pos+2);if(O===61)return this.finishOp(Y.assign,3)}return this.finishOp(Y.coalesce,2)}}return this.finishOp(Y.question,1)},Ct.getTokenFromCode=function(y){switch(y){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(Y.parenL);case 41:return++this.pos,this.finishToken(Y.parenR);case 59:return++this.pos,this.finishToken(Y.semi);case 44:return++this.pos,this.finishToken(Y.comma);case 91:return++this.pos,this.finishToken(Y.bracketL);case 93:return++this.pos,this.finishToken(Y.bracketR);case 123:return++this.pos,this.finishToken(Y.braceL);case 125:return++this.pos,this.finishToken(Y.braceR);case 58:return++this.pos,this.finishToken(Y.colon);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(Y.backQuote);case 48:var T=this.input.charCodeAt(this.pos+1);if(T===120||T===88)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(T===111||T===79)return this.readRadixNumber(8);if(T===98||T===66)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(y);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(y);case 124:case 38:return this.readToken_pipe_amp(y);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(y);case 60:case 62:return this.readToken_lt_gt(y);case 61:case 33:return this.readToken_eq_excl(y);case 63:return this.readToken_question();case 126:return this.finishOp(Y.prefix,1)}this.raise(this.pos,"Unexpected character '"+Ei(y)+"'")},Ct.finishOp=function(y,T){var N=this.input.slice(this.pos,this.pos+T);return this.pos+=T,this.finishToken(y,N)},Ct.readRegexp=function(){for(var y,T,N=this.pos;;){this.pos>=this.input.length&&this.raise(N,"Unterminated regular expression");var O=this.input.charAt(this.pos);if(Wt.test(O)&&this.raise(N,"Unterminated regular expression"),y)y=!1;else{if(O==="[")T=!0;else if(O==="]"&&T)T=!1;else if(O==="/"&&!T)break;y=O==="\\"}++this.pos}var $=this.input.slice(N,this.pos);++this.pos;var _e=this.pos,Xe=this.readWord1();this.containsEsc&&this.unexpected(_e);var ht=this.regexpState||(this.regexpState=new Ft(this));ht.reset(N,$,Xe),this.validateRegExpFlags(ht),this.validateRegExpPattern(ht);var dt=null;try{dt=new RegExp($,Xe)}catch(ir){}return this.finishToken(Y.regexp,{pattern:$,flags:Xe,value:dt})},Ct.readInt=function(y,T,N){for(var O=this.options.ecmaVersion>=12&&T===void 0,$=N&&this.input.charCodeAt(this.pos)===48,_e=this.pos,Xe=0,ht=0,dt=0,ir=T==null?Infinity:T;dt<ir;++dt,++this.pos){var sr=this.input.charCodeAt(this.pos),Cn=void 0;if(O&&sr===95){$&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed in legacy octal numeric literals"),ht===95&&this.raiseRecoverable(this.pos,"Numeric separator must be exactly one underscore"),dt===0&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed at the first of digits"),ht=sr;continue}if(sr>=97?Cn=sr-97+10:sr>=65?Cn=sr-65+10:sr>=48&&sr<=57?Cn=sr-48:Cn=Infinity,Cn>=y)break;ht=sr,Xe=Xe*y+Cn}return O&&ht===95&&this.raiseRecoverable(this.pos-1,"Numeric separator is not allowed at the last of digits"),this.pos===_e||T!=null&&this.pos-_e!==T?null:Xe};function qt(y,T){return T?parseInt(y,8):parseFloat(y.replace(/_/g,""))}function Aa(y){return typeof BigInt!="function"?null:BigInt(y.replace(/_/g,""))}Ct.readRadixNumber=function(y){var T=this.pos;this.pos+=2;var N=this.readInt(y);return N==null&&this.raise(this.start+2,"Expected number in radix "+y),this.options.ecmaVersion>=11&&this.input.charCodeAt(this.pos)===110?(N=Aa(this.input.slice(T,this.pos)),++this.pos):ot(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(Y.num,N)},Ct.readNumber=function(y){var T=this.pos;!y&&this.readInt(10,void 0,!0)===null&&this.raise(T,"Invalid number");var N=this.pos-T>=2&&this.input.charCodeAt(T)===48;N&&this.strict&&this.raise(T,"Invalid number");var O=this.input.charCodeAt(this.pos);if(!N&&!y&&this.options.ecmaVersion>=11&&O===110){var $=Aa(this.input.slice(T,this.pos));return++this.pos,ot(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(Y.num,$)}N&&/[89]/.test(this.input.slice(T,this.pos))&&(N=!1),O===46&&!N&&(++this.pos,this.readInt(10),O=this.input.charCodeAt(this.pos)),(O===69||O===101)&&!N&&(O=this.input.charCodeAt(++this.pos),(O===43||O===45)&&++this.pos,this.readInt(10)===null&&this.raise(T,"Invalid number")),ot(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var _e=qt(this.input.slice(T,this.pos),N);return this.finishToken(Y.num,_e)},Ct.readCodePoint=function(){var y=this.input.charCodeAt(this.pos),T;if(y===123){this.options.ecmaVersion<6&&this.unexpected();var N=++this.pos;T=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,T>1114111&&this.invalidStringToken(N,"Code point out of bounds")}else T=this.readHexChar(4);return T};function Ei(y){return y<=65535?String.fromCharCode(y):(y-=65536,String.fromCharCode((y>>10)+55296,(y&1023)+56320))}Ct.readString=function(y){for(var T="",N=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var O=this.input.charCodeAt(this.pos);if(O===y)break;O===92?(T+=this.input.slice(N,this.pos),T+=this.readEscapedChar(!1),N=this.pos):(Ye(O,this.options.ecmaVersion>=10)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return T+=this.input.slice(N,this.pos++),this.finishToken(Y.string,T)};var Ai={};Ct.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(y){if(y===Ai)this.readInvalidTemplateToken();else throw y}this.inTemplateElement=!1},Ct.invalidStringToken=function(y,T){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw Ai;this.raise(y,T)},Ct.readTmplToken=function(){for(var y="",T=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var N=this.input.charCodeAt(this.pos);if(N===96||N===36&&this.input.charCodeAt(this.pos+1)===123)return this.pos===this.start&&(this.type===Y.template||this.type===Y.invalidTemplate)?N===36?(this.pos+=2,this.finishToken(Y.dollarBraceL)):(++this.pos,this.finishToken(Y.backQuote)):(y+=this.input.slice(T,this.pos),this.finishToken(Y.template,y));if(N===92)y+=this.input.slice(T,this.pos),y+=this.readEscapedChar(!0),T=this.pos;else if(Ye(N)){switch(y+=this.input.slice(T,this.pos),++this.pos,N){case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:y+=`
`;break;default:y+=String.fromCharCode(N);break}this.options.locations&&(++this.curLine,this.lineStart=this.pos),T=this.pos}else++this.pos}},Ct.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if(this.input[this.pos+1]!=="{")break;case"`":return this.finishToken(Y.invalidTemplate,this.input.slice(this.start,this.pos))}this.raise(this.start,"Unterminated template")},Ct.readEscapedChar=function(y){var T=this.input.charCodeAt(++this.pos);switch(++this.pos,T){case 110:return`
`;case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return Ei(this.readCodePoint());case 116:return"	";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";case 56:case 57:if(y){var N=this.pos-1;return this.invalidStringToken(N,"Invalid escape sequence in template string"),null}default:if(T>=48&&T<=55){var O=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],$=parseInt(O,8);return $>255&&(O=O.slice(0,-1),$=parseInt(O,8)),this.pos+=O.length-1,T=this.input.charCodeAt(this.pos),(O!=="0"||T===56||T===57)&&(this.strict||y)&&this.invalidStringToken(this.pos-1-O.length,y?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode($)}return Ye(T)?"":String.fromCharCode(T)}},Ct.readHexChar=function(y){var T=this.pos,N=this.readInt(16,y);return N===null&&this.invalidStringToken(T,"Bad character escape sequence"),N},Ct.readWord1=function(){this.containsEsc=!1;for(var y="",T=!0,N=this.pos,O=this.options.ecmaVersion>=6;this.pos<this.input.length;){var $=this.fullCharCodeAtPos();if(Jt($,O))this.pos+=$<=65535?1:2;else if($===92){this.containsEsc=!0,y+=this.input.slice(N,this.pos);var _e=this.pos;this.input.charCodeAt(++this.pos)!==117&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var Xe=this.readCodePoint();(T?ot:Jt)(Xe,O)||this.invalidStringToken(_e,"Invalid Unicode escape"),y+=Ei(Xe),N=this.pos}else break;T=!1}return y+this.input.slice(N,this.pos)},Ct.readWord=function(){var y=this.readWord1(),T=Y.name;return this.keywords.test(y)&&(T=et[y]),this.finishToken(T,y)};var Bi="7.4.1";bi.acorn={Parser:bi,version:Bi,defaultOptions:Lt,Position:Le,SourceLocation:Et,getLineInfo:gt,Node:Ii,TokenType:pt,tokTypes:Y,keywordTypes:et,TokContext:Zo,tokContexts:Fa,isIdentifierChar:Jt,isIdentifierStart:ot,Token:_i,isNewLine:Ye,lineBreak:Wt,lineBreakG:st,nonASCIIwhitespace:ct};function Yr(y,T){return bi.parse(y,T)}function wn(y,T,N){return bi.parseExpressionAt(y,T,N)}function zt(y,T){return bi.tokenizer(y,T)}function aa(y,T){y.prototype=Object.create(T.prototype),y.prototype.constructor=y,y.__proto__=T}function be(y){var T=typeof Map=="function"?new Map:void 0;return be=function(O){if(O===null||!hu(O))return O;if(typeof O!="function")throw new TypeError("Super expression must either be null or a function");if(typeof T!="undefined"){if(T.has(O))return T.get(O);T.set(O,$)}function $(){return ea(O,arguments,Ma(this).constructor)}return $.prototype=Object.create(O.prototype,{constructor:{value:$,enumerable:!1,writable:!0,configurable:!0}}),Na($,O)},be(y)}function Ko(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(y){return!1}}function ea(y,T,N){return Ko()?ea=Reflect.construct:ea=function($,_e,Xe){var ht=[null];ht.push.apply(ht,_e);var dt=Function.bind.apply($,ht),ir=new dt;return Xe&&Na(ir,Xe.prototype),ir},ea.apply(null,arguments)}function hu(y){return Function.toString.call(y).indexOf("[native code]")!==-1}function Na(y,T){return Na=Object.setPrototypeOf||function(O,$){return O.__proto__=$,O},Na(y,T)}function Ma(y){return Ma=Object.setPrototypeOf?Object.getPrototypeOf:function(N){return N.__proto__||Object.getPrototypeOf(N)},Ma(y)}var Wa=function(y){aa(T,y);function T(){return y.apply(this,arguments)||this}return T}(be(Error)),oa=function(y){aa(T,y);function T(){return y.apply(this,arguments)||this}return T}(be(SyntaxError)),Eo=function(y){aa(T,y);function T(){return y.apply(this,arguments)||this}return T}(be(ReferenceError)),Vo=function(y){aa(T,y);function T(){return y.apply(this,arguments)||this}return T}(be(TypeError)),bu=function(y){aa(T,y);function T(){return y.apply(this,arguments)||this}return T}(Wa),co=function(y){aa(T,y);function T(){return y.apply(this,arguments)||this}return T}(oa),Ro=function(y){aa(T,y);function T(){return y.apply(this,arguments)||this}return T}(Eo),sa={UnknownError:[3001,"%0",bu],ExecutionTimeOutError:[3002,"Script execution timed out after %0ms",bu],NodeTypeSyntaxError:[1001,"Unknown node type: %0",Ro],BinaryOperatorSyntaxError:[1002,"Unknown binary operator: %0",Ro],LogicalOperatorSyntaxError:[1003,"Unknown logical operator: %0",Ro],UnaryOperatorSyntaxError:[1004,"Unknown unary operator: %0",Ro],UpdateOperatorSyntaxError:[1005,"Unknown update operator: %0",Ro],ObjectStructureSyntaxError:[1006,"Unknown object structure: %0",Ro],AssignmentExpressionSyntaxError:[1007,"Unknown assignment expression: %0",Ro],VariableTypeSyntaxError:[1008,"Unknown variable type: %0",Ro],ParamTypeSyntaxError:[1009,"Unknown param type: %0",Ro],AssignmentTypeSyntaxError:[1010,"Unknown assignment type: %0",Ro],FunctionUndefinedReferenceError:[2001,"%0 is not a function",Eo],VariableUndefinedReferenceError:[2002,"%0 is not defined",Eo],IsNotConstructor:[2003,"%0 is not a constructor",Vo]};function Xa(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(y){return!1}}function Lo(y,T,N){return Xa()?Lo=Reflect.construct:Lo=function($,_e,Xe){var ht=[null];ht.push.apply(ht,_e);var dt=Function.bind.apply($,ht),ir=new dt;return Xe&&Ya(ir,Xe.prototype),ir},Lo.apply(null,arguments)}function Ya(y,T){return Ya=Object.setPrototypeOf||function(O,$){return O.__proto__=$,O},Ya(y,T)}var Ps="0.0.3";function Cl(y,T){Object.defineProperty(y,"name",{value:T,writable:!1,enumerable:!1,configurable:!0})}var ps=Object.prototype.hasOwnProperty,ie=Symbol("Break"),xe=Symbol("Continue"),Ke=Symbol("DefaultCase"),Mt=Symbol("EmptyStatementReturn"),Pr=Symbol("WithScopeName"),Tn=Symbol("SuperScopeName"),Mi=Symbol("RootScopeName"),eo=Symbol("GlobalScopeName");function La(y){return typeof y=="function"}var Ba=function(){function y(N){this.interpreter=N}var T=y.prototype;return T.generator=function(){var O=this.interpreter;function $(){return this.getCurrentScope()}function _e(){return this.getGlobalScope()}function Xe(){return this.getCurrentContext()}return{getOptions:O.getOptions.bind(O),getCurrentScope:$.bind(O),getGlobalScope:_e.bind(O),getCurrentContext:Xe.bind(O),getExecStartTime:O.getExecStartTime.bind(O)}},y}();function jo(y,T,N){if(N===void 0&&(N=!0),!(y instanceof Ba))throw new Error("Illegal call");if(typeof T!="string")return T;if(!!T){var O=y.generator(),$=O.getOptions(),_e={timeout:$.timeout,_initEnv:function(){N||this.setCurrentContext(O.getCurrentContext()),this.execStartTime=O.getExecStartTime(),this.execEndTime=this.execStartTime}},Xe=N?O.getGlobalScope():O.getCurrentScope(),ht=new _a(Xe,_e);return ht.evaluate(T)}}Object.defineProperty(jo,"__IS_EVAL_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});function ds(y){if(!(y instanceof Ba))throw new Error("Illegal call");for(var T=y.generator(),N=arguments.length,O=new Array(N>1?N-1:0),$=1;$<N;$++)O[$-1]=arguments[$];var _e=O.pop(),Xe=new _a(T.getGlobalScope(),T.getOptions()),ht=`
		    (function anonymous(`+O.join(",")+`){
		        `+_e+`
		    });
		    `;return Xe.evaluate(ht)}Object.defineProperty(ds,"__IS_FUNCTION_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});var ao=function(T){this.value=T},So=function(T){this.value=T},vs=function(T){this.value=T},Is=function(T,N,O){N===void 0&&(N=null),this.name=O,this.parent=N,this.data=T,this.labelStack=[]};function ks(){}function $s(y,T){return y===void 0&&(y=null),new Is(Object.create(null),y,T)}function ms(y){return Object.create(y)}var ga={NaN:NaN,Infinity:Infinity,undefined:void 0,Object,Array,String,Boolean,Number,Date,RegExp,Error,URIError,TypeError,RangeError,SyntaxError,ReferenceError,Float32Array,Float64Array,Uint32Array,Math,parseInt,parseFloat,isNaN,isFinite,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,escape,unescape,eval:jo,Function:ds};typeof JSON!="undefined"&&(ga.JSON=JSON),typeof Promise!="undefined"&&(ga.Promise=Promise),typeof Set!="undefined"&&(ga.Set=Set),typeof Map!="undefined"&&(ga.Map=Map),typeof Symbol!="undefined"&&(ga.Symbol=Symbol),typeof Proxy!="undefined"&&(ga.Proxy=Proxy),typeof WeakMap!="undefined"&&(ga.WeakMap=WeakMap),typeof WeakSet!="undefined"&&(ga.WeakSet=WeakSet),typeof Reflect!="undefined"&&(ga.Reflect=Reflect);var _a=function(){function y(N,O){N===void 0&&(N=y.global),O===void 0&&(O={}),this.sourceList=[],this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.isVarDeclMode=!1,this.lastExecNode=null,this.isRunning=!1,this.options={ecmaVersion:O.ecmaVersion||y.ecmaVersion,timeout:O.timeout||0,rootContext:O.rootContext,globalContextInFunction:O.globalContextInFunction===void 0?y.globalContextInFunction:O.globalContextInFunction,_initEnv:O._initEnv},this.context=N||Object.create(null),this.callStack=[],this.initEnvironment(this.context)}var T=y.prototype;return T.initEnvironment=function(O){var $;if(O instanceof Is)$=O;else{var _e=null,Xe=this.createSuperScope(O);this.options.rootContext&&(_e=new Is(ms(this.options.rootContext),Xe,Mi)),$=new Is(O,_e||Xe,eo)}this.globalScope=$,this.currentScope=this.globalScope,this.globalContext=$.data,this.currentContext=$.data,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.execStartTime=Date.now(),this.execEndTime=this.execStartTime;var ht=this.options._initEnv;ht&&ht.call(this)},T.getExecStartTime=function(){return this.execStartTime},T.getExecutionTime=function(){return this.execEndTime-this.execStartTime},T.setExecTimeout=function(O){O===void 0&&(O=0),this.options.timeout=O},T.getOptions=function(){return this.options},T.getGlobalScope=function(){return this.globalScope},T.getCurrentScope=function(){return this.currentScope},T.getCurrentContext=function(){return this.currentContext},T.isInterruptThrow=function(O){return O instanceof bu||O instanceof Ro||O instanceof co},T.createSuperScope=function(O){var $=Object.assign({},ga),_e=Object.keys($);return _e.forEach(function(Xe){Xe in O&&delete $[Xe]}),new Is($,null,Tn)},T.setCurrentContext=function(O){this.currentContext=O},T.setCurrentScope=function(O){this.currentScope=O},T.evaluate=function(O){O===void 0&&(O="");var $;if(!!O)return $=Yr(O,{ranges:!0,locations:!0,ecmaVersion:this.options.ecmaVersion||y.ecmaVersion}),this.evaluateNode($,O)},T.appendCode=function(O){return this.evaluate(O)},T.evaluateNode=function(O,$){var _e=this;$===void 0&&($=""),this.value=void 0,this.source=$,this.sourceList.push($),this.isRunning=!0,this.execStartTime=Date.now(),this.execEndTime=this.execStartTime,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var Xe=this.getCurrentScope(),ht=this.getCurrentContext(),dt=Xe.labelStack.concat([]),ir=this.callStack.concat([]),sr=function(){_e.setCurrentScope(Xe),_e.setCurrentContext(ht),Xe.labelStack=dt,_e.callStack=ir};try{var Cn=this.createClosure(O);this.addDeclarationsToScope(this.collectDeclVars,this.collectDeclFuncs,this.getCurrentScope()),Cn()}catch(ni){throw ni}finally{sr(),this.execEndTime=Date.now()}return this.isRunning=!1,this.getValue()},T.createErrorMessage=function(O,$,_e){var Xe=O[1].replace("%0",String($));return _e!==null&&(Xe+=this.getNodePosition(_e||this.lastExecNode)),Xe},T.createError=function(O,$){return new $(O)},T.createThrowError=function(O,$){return this.createError(O,$)},T.createInternalThrowError=function(O,$,_e){return this.createError(this.createErrorMessage(O,$,_e),O[2])},T.checkTimeout=function(){if(!this.isRunning)return!1;var O=this.options.timeout||0,$=Date.now();return $-this.execStartTime>O},T.getNodePosition=function(O){if(O){var $="";return O.loc?" ["+O.loc.start.line+":"+O.loc.start.column+"]"+$:""}return""},T.createClosure=function(O){var $=this,_e;switch(O.type){case"BinaryExpression":_e=this.binaryExpressionHandler(O);break;case"LogicalExpression":_e=this.logicalExpressionHandler(O);break;case"UnaryExpression":_e=this.unaryExpressionHandler(O);break;case"UpdateExpression":_e=this.updateExpressionHandler(O);break;case"ObjectExpression":_e=this.objectExpressionHandler(O);break;case"ArrayExpression":_e=this.arrayExpressionHandler(O);break;case"CallExpression":_e=this.callExpressionHandler(O);break;case"NewExpression":_e=this.newExpressionHandler(O);break;case"MemberExpression":_e=this.memberExpressionHandler(O);break;case"ThisExpression":_e=this.thisExpressionHandler(O);break;case"SequenceExpression":_e=this.sequenceExpressionHandler(O);break;case"Literal":_e=this.literalHandler(O);break;case"Identifier":_e=this.identifierHandler(O);break;case"AssignmentExpression":_e=this.assignmentExpressionHandler(O);break;case"FunctionDeclaration":_e=this.functionDeclarationHandler(O);break;case"VariableDeclaration":_e=this.variableDeclarationHandler(O);break;case"BlockStatement":case"Program":_e=this.programHandler(O);break;case"ExpressionStatement":_e=this.expressionStatementHandler(O);break;case"EmptyStatement":_e=this.emptyStatementHandler(O);break;case"ReturnStatement":_e=this.returnStatementHandler(O);break;case"FunctionExpression":_e=this.functionExpressionHandler(O);break;case"IfStatement":_e=this.ifStatementHandler(O);break;case"ConditionalExpression":_e=this.conditionalExpressionHandler(O);break;case"ForStatement":_e=this.forStatementHandler(O);break;case"WhileStatement":_e=this.whileStatementHandler(O);break;case"DoWhileStatement":_e=this.doWhileStatementHandler(O);break;case"ForInStatement":_e=this.forInStatementHandler(O);break;case"WithStatement":_e=this.withStatementHandler(O);break;case"ThrowStatement":_e=this.throwStatementHandler(O);break;case"TryStatement":_e=this.tryStatementHandler(O);break;case"ContinueStatement":_e=this.continueStatementHandler(O);break;case"BreakStatement":_e=this.breakStatementHandler(O);break;case"SwitchStatement":_e=this.switchStatementHandler(O);break;case"LabeledStatement":_e=this.labeledStatementHandler(O);break;case"DebuggerStatement":_e=this.debuggerStatementHandler(O);break;default:throw this.createInternalThrowError(sa.NodeTypeSyntaxError,O.type,O)}return function(){var Xe=$.options.timeout;if(Xe&&Xe>0&&$.checkTimeout())throw $.createInternalThrowError(sa.ExecutionTimeOutError,Xe,null);return $.lastExecNode=O,_e.apply(void 0,arguments)}},T.binaryExpressionHandler=function(O){var $=this,_e=this.createClosure(O.left),Xe=this.createClosure(O.right);return function(){var ht=_e(),dt=Xe();switch(O.operator){case"==":return ht==dt;case"!=":return ht!=dt;case"===":return ht===dt;case"!==":return ht!==dt;case"<":return ht<dt;case"<=":return ht<=dt;case">":return ht>dt;case">=":return ht>=dt;case"<<":return ht<<dt;case">>":return ht>>dt;case">>>":return ht>>>dt;case"+":return ht+dt;case"-":return ht-dt;case"*":return ht*dt;case"**":return Math.pow(ht,dt);case"/":return ht/dt;case"%":return ht%dt;case"|":return ht|dt;case"^":return ht^dt;case"&":return ht&dt;case"in":return ht in dt;case"instanceof":return ht instanceof dt;default:throw $.createInternalThrowError(sa.BinaryOperatorSyntaxError,O.operator,O)}}},T.logicalExpressionHandler=function(O){var $=this,_e=this.createClosure(O.left),Xe=this.createClosure(O.right);return function(){switch(O.operator){case"||":return _e()||Xe();case"&&":return _e()&&Xe();default:throw $.createInternalThrowError(sa.LogicalOperatorSyntaxError,O.operator,O)}}},T.unaryExpressionHandler=function(O){var $=this;switch(O.operator){case"delete":var _e=this.createObjectGetter(O.argument),Xe=this.createNameGetter(O.argument);return function(){var sr=_e(),Cn=Xe();return delete sr[Cn]};default:var ht;if(O.operator==="typeof"&&O.argument.type==="Identifier"){var dt=this.createObjectGetter(O.argument),ir=this.createNameGetter(O.argument);ht=function(){return dt()[ir()]}}else ht=this.createClosure(O.argument);return function(){var sr=ht();switch(O.operator){case"-":return-sr;case"+":return+sr;case"!":return!sr;case"~":return~sr;case"void":return;case"typeof":return typeof sr;default:throw $.createInternalThrowError(sa.UnaryOperatorSyntaxError,O.operator,O)}}}},T.updateExpressionHandler=function(O){var $=this,_e=this.createObjectGetter(O.argument),Xe=this.createNameGetter(O.argument);return function(){var ht=_e(),dt=Xe();switch($.assertVariable(ht,dt,O),O.operator){case"++":return O.prefix?++ht[dt]:ht[dt]++;case"--":return O.prefix?--ht[dt]:ht[dt]--;default:throw $.createInternalThrowError(sa.UpdateOperatorSyntaxError,O.operator,O)}}},T.objectExpressionHandler=function(O){var $=this,_e=[];function Xe(dt){return dt.type==="Identifier"?dt.name:dt.type==="Literal"?dt.value:this.throwError(sa.ObjectStructureSyntaxError,dt.type,dt)}var ht=Object.create(null);return O.properties.forEach(function(dt){var ir=dt.kind,sr=Xe(dt.key);(!ht[sr]||ir==="init")&&(ht[sr]={}),ht[sr][ir]=$.createClosure(dt.value),_e.push({key:sr,property:dt})}),function(){for(var dt={},ir=_e.length,sr=0;sr<ir;sr++){var Cn=_e[sr],ni=Cn.key,In=ht[ni],Xi=In.init?In.init():void 0,va=In.get?In.get():function(){},wa=In.set?In.set():function(Hu){};if("set"in In||"get"in In){var ji={configurable:!0,enumerable:!0,get:va,set:wa};Object.defineProperty(dt,ni,ji)}else{var gs=Cn.property,Js=gs.kind;gs.key.type==="Identifier"&&gs.value.type==="FunctionExpression"&&Js==="init"&&!gs.value.id&&Cl(Xi,gs.key.name),dt[ni]=Xi}}return dt}},T.arrayExpressionHandler=function(O){var $=this,_e=O.elements.map(function(Xe){return Xe&&$.createClosure(Xe)});return function(){for(var Xe=_e.length,ht=Array(Xe),dt=0;dt<Xe;dt++){var ir=_e[dt];ir&&(ht[dt]=ir())}return ht}},T.safeObjectGet=function(O,$,_e){return O[$]},T.createCallFunctionGetter=function(O){var $=this;switch(O.type){case"MemberExpression":var _e=this.createClosure(O.object),Xe=this.createMemberKeyGetter(O),ht=this.source;return function(){var ir=_e(),sr=Xe(),Cn=$.safeObjectGet(ir,sr,O);if(!Cn||!La(Cn)){var ni=ht.slice(O.start,O.end);throw $.createInternalThrowError(sa.FunctionUndefinedReferenceError,ni,O)}return Cn.__IS_EVAL_FUNC?function(In){return Cn(new Ba($),In,!0)}:Cn.__IS_FUNCTION_FUNC?function(){for(var In=arguments.length,Xi=new Array(In),va=0;va<In;va++)Xi[va]=arguments[va];return Cn.apply(void 0,[new Ba($)].concat(Xi))}:Cn.bind(ir)};default:var dt=this.createClosure(O);return function(){var ir="";O.type==="Identifier"&&(ir=O.name);var sr=dt();if(!sr||!La(sr))throw $.createInternalThrowError(sa.FunctionUndefinedReferenceError,ir,O);if(O.type==="Identifier"&&sr.__IS_EVAL_FUNC&&ir==="eval")return function(In){var Xi=$.getScopeFromName(ir,$.getCurrentScope()),va=Xi.name===Tn||Xi.name===eo||Xi.name===Mi;return sr(new Ba($),In,!va)};if(sr.__IS_EVAL_FUNC)return function(In){return sr(new Ba($),In,!0)};if(sr.__IS_FUNCTION_FUNC)return function(){for(var In=arguments.length,Xi=new Array(In),va=0;va<In;va++)Xi[va]=arguments[va];return sr.apply(void 0,[new Ba($)].concat(Xi))};var Cn=$.options.globalContextInFunction;if(O.type==="Identifier"){var ni=$.getIdentifierScope(O);ni.name===Pr&&(Cn=ni.data)}return sr.bind(Cn)}}},T.callExpressionHandler=function(O){var $=this,_e=this.createCallFunctionGetter(O.callee),Xe=O.arguments.map(function(ht){return $.createClosure(ht)});return function(){return _e().apply(void 0,Xe.map(function(ht){return ht()}))}},T.functionExpressionHandler=function(O){var $=this,_e=this,Xe=this.source,ht=this.collectDeclVars,dt=this.collectDeclFuncs;this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var ir=O.id?O.id.name:"",sr=O.params.length,Cn=O.params.map(function(va){return $.createParamNameGetter(va)}),ni=this.createClosure(O.body),In=this.collectDeclVars,Xi=this.collectDeclFuncs;return this.collectDeclVars=ht,this.collectDeclFuncs=dt,function(){var va=_e.getCurrentScope(),wa=function ji(){for(var gs=arguments.length,Js=new Array(gs),Hu=0;Hu<gs;Hu++)Js[Hu]=arguments[Hu];_e.callStack.push(""+ir);var Qc=_e.getCurrentScope(),ll=$s(va,"FunctionScope("+ir+")");_e.setCurrentScope(ll),_e.addDeclarationsToScope(In,Xi,ll),ir&&(ll.data[ir]=ji),ll.data.arguments=arguments,Cn.forEach(function(Su,wu){ll.data[Su()]=Js[wu]});var Oc=_e.getCurrentContext();_e.setCurrentContext(this);var Eu=ni();if(_e.setCurrentContext(Oc),_e.setCurrentScope(Qc),_e.callStack.pop(),Eu instanceof ao)return Eu.value};return Cl(wa,ir),Object.defineProperty(wa,"length",{value:sr,writable:!1,enumerable:!1,configurable:!0}),Object.defineProperty(wa,"toString",{value:function(){return Xe.slice(O.start,O.end)},writable:!0,configurable:!0,enumerable:!1}),Object.defineProperty(wa,"valueOf",{value:function(){return Xe.slice(O.start,O.end)},writable:!0,configurable:!0,enumerable:!1}),wa}},T.newExpressionHandler=function(O){var $=this,_e=this.source,Xe=this.createClosure(O.callee),ht=O.arguments.map(function(dt){return $.createClosure(dt)});return function(){var dt=Xe();if(!La(dt)||dt.__IS_EVAL_FUNC){var ir=O.callee,sr=_e.slice(ir.start,ir.end);throw $.createInternalThrowError(sa.IsNotConstructor,sr,O)}return dt.__IS_FUNCTION_FUNC?dt.apply(void 0,[new Ba($)].concat(ht.map(function(Cn){return Cn()}))):Lo(dt,ht.map(function(Cn){return Cn()}))}},T.memberExpressionHandler=function(O){var $=this.createClosure(O.object),_e=this.createMemberKeyGetter(O);return function(){var Xe=$(),ht=_e();return Xe[ht]}},T.thisExpressionHandler=function(O){var $=this;return function(){return $.getCurrentContext()}},T.sequenceExpressionHandler=function(O){var $=this,_e=O.expressions.map(function(Xe){return $.createClosure(Xe)});return function(){for(var Xe,ht=_e.length,dt=0;dt<ht;dt++){var ir=_e[dt];Xe=ir()}return Xe}},T.literalHandler=function(O){return function(){return O.regex?new RegExp(O.regex.pattern,O.regex.flags):O.value}},T.identifierHandler=function(O){var $=this;return function(){var _e=$.getCurrentScope(),Xe=$.getScopeDataFromName(O.name,_e);return $.assertVariable(Xe,O.name,O),Xe[O.name]}},T.getIdentifierScope=function(O){var $=this.getCurrentScope(),_e=this.getScopeFromName(O.name,$);return _e},T.assignmentExpressionHandler=function(O){var $=this;O.left.type==="Identifier"&&O.right.type==="FunctionExpression"&&!O.right.id&&(O.right.id={type:"Identifier",name:O.left.name});var _e=this.createObjectGetter(O.left),Xe=this.createNameGetter(O.left),ht=this.createClosure(O.right);return function(){var dt=_e(),ir=Xe(),sr=ht();switch(O.operator!=="="&&$.assertVariable(dt,ir,O),O.operator){case"=":return dt[ir]=sr;case"+=":return dt[ir]+=sr;case"-=":return dt[ir]-=sr;case"*=":return dt[ir]*=sr;case"**=":return dt[ir]=Math.pow(dt[ir],sr);case"/=":return dt[ir]/=sr;case"%=":return dt[ir]%=sr;case"<<=":return dt[ir]<<=sr;case">>=":return dt[ir]>>=sr;case">>>=":return dt[ir]>>>=sr;case"&=":return dt[ir]&=sr;case"^=":return dt[ir]^=sr;case"|=":return dt[ir]|=sr;default:throw $.createInternalThrowError(sa.AssignmentExpressionSyntaxError,O.type,O)}}},T.functionDeclarationHandler=function(O){if(O.id){var $=this.functionExpressionHandler(O);Object.defineProperty($,"isFunctionDeclareClosure",{value:!0,writable:!1,configurable:!1,enumerable:!1}),this.funcDeclaration(O.id.name,$)}return function(){return Mt}},T.getVariableName=function(O){if(O.type==="Identifier")return O.name;throw this.createInternalThrowError(sa.VariableTypeSyntaxError,O.type,O)},T.variableDeclarationHandler=function(O){for(var $=this,_e,Xe=[],ht=0;ht<O.declarations.length;ht++){var dt=O.declarations[ht];this.varDeclaration(this.getVariableName(dt.id)),dt.init&&Xe.push({type:"AssignmentExpression",operator:"=",left:dt.id,right:dt.init})}return Xe.length&&(_e=this.createClosure({type:"BlockStatement",body:Xe})),function(){if(_e){var ir=$.isVarDeclMode;$.isVarDeclMode=!0,_e(),$.isVarDeclMode=ir}return Mt}},T.assertVariable=function(O,$,_e){if(O===this.globalScope.data&&!($ in O))throw this.createInternalThrowError(sa.VariableUndefinedReferenceError,$,_e)},T.programHandler=function(O){var $=this,_e=O.body.map(function(Xe){return $.createClosure(Xe)});return function(){for(var Xe=Mt,ht=0;ht<_e.length;ht++){var dt=_e[ht],ir=$.setValue(dt());if(ir!==Mt&&(Xe=ir,Xe instanceof ao||Xe instanceof So||Xe instanceof vs||Xe===ie||Xe===xe))break}return Xe}},T.expressionStatementHandler=function(O){return this.createClosure(O.expression)},T.emptyStatementHandler=function(O){return function(){return Mt}},T.returnStatementHandler=function(O){var $=O.argument?this.createClosure(O.argument):ks;return function(){return new ao($())}},T.ifStatementHandler=function(O){var $=this.createClosure(O.test),_e=this.createClosure(O.consequent),Xe=O.alternate?this.createClosure(O.alternate):function(){return Mt};return function(){return $()?_e():Xe()}},T.conditionalExpressionHandler=function(O){return this.ifStatementHandler(O)},T.forStatementHandler=function(O){var $=this,_e=ks,Xe=O.test?this.createClosure(O.test):function(){return!0},ht=ks,dt=this.createClosure(O.body);return O.type==="ForStatement"&&(_e=O.init?this.createClosure(O.init):_e,ht=O.update?this.createClosure(O.update):ks),function(ir){var sr,Cn=Mt,ni=O.type==="DoWhileStatement";for(ir&&ir.type==="LabeledStatement"&&(sr=ir.label.name),_e();ni||Xe();ht()){ni=!1;var In=$.setValue(dt());if(!(In===Mt||In===xe)){if(In===ie)break;if(Cn=In,Cn instanceof vs&&Cn.value===sr){Cn=Mt;continue}if(Cn instanceof ao||Cn instanceof So||Cn instanceof vs)break}}return Cn}},T.whileStatementHandler=function(O){return this.forStatementHandler(O)},T.doWhileStatementHandler=function(O){return this.forStatementHandler(O)},T.forInStatementHandler=function(O){var $=this,_e=O.left,Xe=this.createClosure(O.right),ht=this.createClosure(O.body);return O.left.type==="VariableDeclaration"&&(this.createClosure(O.left)(),_e=O.left.declarations[0].id),function(dt){var ir,sr=Mt,Cn;dt&&dt.type==="LabeledStatement"&&(ir=dt.label.name);var ni=Xe();for(Cn in ni){$.assignmentExpressionHandler({type:"AssignmentExpression",operator:"=",left:_e,right:{type:"Literal",value:Cn}})();var In=$.setValue(ht());if(!(In===Mt||In===xe)){if(In===ie)break;if(sr=In,sr instanceof vs&&sr.value===ir){sr=Mt;continue}if(sr instanceof ao||sr instanceof So||sr instanceof vs)break}}return sr}},T.withStatementHandler=function(O){var $=this,_e=this.createClosure(O.object),Xe=this.createClosure(O.body);return function(){var ht=_e(),dt=$.getCurrentScope(),ir=new Is(ht,dt,Pr);$.setCurrentScope(ir);var sr=$.setValue(Xe());return $.setCurrentScope(dt),sr}},T.throwStatementHandler=function(O){var $=this,_e=this.createClosure(O.argument);return function(){throw $.setValue(void 0),_e()}},T.tryStatementHandler=function(O){var $=this,_e=this.createClosure(O.block),Xe=O.handler?this.catchClauseHandler(O.handler):null,ht=O.finalizer?this.createClosure(O.finalizer):null;return function(){var dt=$.getCurrentScope(),ir=$.getCurrentContext(),sr=dt.labelStack.concat([]),Cn=$.callStack.concat([]),ni=Mt,In,Xi,va=function(){$.setCurrentScope(dt),$.setCurrentContext(ir),dt.labelStack=sr,$.callStack=Cn};try{ni=$.setValue(_e()),ni instanceof ao&&(In=ni)}catch(wa){if(va(),$.isInterruptThrow(wa))throw wa;if(Xe)try{ni=$.setValue(Xe(wa)),ni instanceof ao&&(In=ni)}catch(ji){if(va(),$.isInterruptThrow(ji))throw ji;Xi=ji}}if(ht)try{ni=ht(),ni instanceof ao&&(In=ni)}catch(wa){if(va(),$.isInterruptThrow(wa))throw wa;Xi=wa}if(Xi)throw Xi;return In||ni}},T.catchClauseHandler=function(O){var $=this,_e=this.createParamNameGetter(O.param),Xe=this.createClosure(O.body);return function(ht){var dt,ir=$.getCurrentScope(),sr=ir.data,Cn=_e(),ni=ps.call(sr,Cn),In=sr[Cn];return sr[Cn]=ht,dt=Xe(),ni?sr[Cn]=In:delete sr[Cn],dt}},T.continueStatementHandler=function(O){return function(){return O.label?new vs(O.label.name):xe}},T.breakStatementHandler=function(O){return function(){return O.label?new So(O.label.name):ie}},T.switchStatementHandler=function(O){var $=this,_e=this.createClosure(O.discriminant),Xe=O.cases.map(function(ht){return $.switchCaseHandler(ht)});return function(){for(var ht=_e(),dt=!1,ir,sr,Cn,ni=0;ni<Xe.length;ni++){var In=Xe[ni](),Xi=In.testClosure();if(Xi===Ke){Cn=In;continue}if(dt||Xi===ht){if(dt=!0,sr=$.setValue(In.bodyClosure()),sr===Mt)continue;if(sr===ie||(ir=sr,ir instanceof ao||ir instanceof So||ir instanceof vs||ir===xe))break}}if(!dt&&Cn){sr=$.setValue(Cn.bodyClosure());var va=sr===Mt||sr===ie||sr===xe;va||(ir=sr)}return ir}},T.switchCaseHandler=function(O){var $=O.test?this.createClosure(O.test):function(){return Ke},_e=this.createClosure({type:"BlockStatement",body:O.consequent});return function(){return{testClosure:$,bodyClosure:_e}}},T.labeledStatementHandler=function(O){var $=this,_e=O.label.name,Xe=this.createClosure(O.body);return function(){var ht,dt=$.getCurrentScope();return dt.labelStack.push(_e),ht=Xe(O),ht instanceof So&&ht.value===_e&&(ht=Mt),dt.labelStack.pop(),ht}},T.debuggerStatementHandler=function(O){return function(){debugger;return Mt}},T.createParamNameGetter=function(O){if(O.type==="Identifier")return function(){return O.name};throw this.createInternalThrowError(sa.ParamTypeSyntaxError,O.type,O)},T.createObjectKeyGetter=function(O){var $;return O.type==="Identifier"?$=function(){return O.name}:$=this.createClosure(O),function(){return $()}},T.createMemberKeyGetter=function(O){return O.computed?this.createClosure(O.property):this.createObjectKeyGetter(O.property)},T.createObjectGetter=function(O){var $=this;switch(O.type){case"Identifier":return function(){return $.getScopeDataFromName(O.name,$.getCurrentScope())};case"MemberExpression":return this.createClosure(O.object);default:throw this.createInternalThrowError(sa.AssignmentTypeSyntaxError,O.type,O)}},T.createNameGetter=function(O){switch(O.type){case"Identifier":return function(){return O.name};case"MemberExpression":return this.createMemberKeyGetter(O);default:throw this.createInternalThrowError(sa.AssignmentTypeSyntaxError,O.type,O)}},T.varDeclaration=function(O){var $=this.collectDeclVars;$[O]=void 0},T.funcDeclaration=function(O,$){var _e=this.collectDeclFuncs;_e[O]=$},T.addDeclarationsToScope=function(O,$,_e){var Xe=_e.data;for(var ht in $){var dt=$[ht];Xe[ht]=dt&&dt()}for(var ir in O)ir in Xe||(Xe[ir]=void 0)},T.getScopeValue=function(O,$){var _e=this.getScopeFromName(O,$);return _e.data[O]},T.getScopeDataFromName=function(O,$){return this.getScopeFromName(O,$).data},T.getScopeFromName=function(O,$){var _e=$;do if(O in _e.data)return _e;while(_e=_e.parent);return this.globalScope},T.setValue=function(O){var $=this.callStack.length;return this.isVarDeclMode||$||O===Mt||O===ie||O===xe||O instanceof So||O instanceof vs||(this.value=O instanceof ao?O.value:O),O},T.getValue=function(){return this.value},y}();_a.version=Ps,_a.eval=jo,_a.Function=ds,_a.ecmaVersion=5,_a.globalContextInFunction=void 0,_a.global=Object.create(null);function ns(y){return y===void 0&&(y=Object.create(null)),y}function Jc(y,T,N){T===void 0&&(T=[]),N===void 0&&(N={});var O=N.parsingContext,$=N.timeout===void 0?0:N.timeout,_e=`
    (function anonymous(`+T.join(",")+`){
         `+y+`
    });
    `,Xe=new _a(O,{ecmaVersion:N.ecmaVersion,timeout:$,rootContext:N.rootContext,globalContextInFunction:N.globalContextInFunction});return Xe.evaluate(_e)}function Tl(y,T,N){var O=new _a(T,N);return O.evaluate(y)}var Zs=Tl,nc=function(){function y(N){this._code=N}var T=y.prototype;return T.runInContext=function(O){return Tl(this._code,O)},T.runInNewContext=function(O){return Tl(this._code,O)},y}(),Gu=function(y,T,N){return Tl(y,T,N)};function Vs(){for(var y=arguments.length,T=new Array(y),N=0;N<y;N++)T[N]=arguments[N];var O=T.pop();return Jc(O||"",T)}var ul=Gu},20396:function(Ue,W,L){var X;/*! Hammer.JS - v2.0.7 - 2016-04-22
* http://hammerjs.github.io/
*
* Copyright (c) 2016 Jorik Tangelder;
* Licensed under the MIT license */(function(j,v,Q,F){"use strict";var J=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",ne=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined"),ye=J||ne,K=["","webkit","Moz","MS","ms","o"],Ne=ye?"":v.createElement("div"),Ve="function",ke=Math.round,ot=Math.abs,Jt=Date.now;function pt(ie,xe,Ke){return setTimeout(st(ie,Ke),xe)}function Zt(ie,xe,Ke){return Array.isArray(ie)?(_t(ie,Ke[xe],Ke),!0):!1}function _t(ie,xe,Ke){var Mt;if(!!ie)if(ie.forEach)ie.forEach(xe,Ke);else if(ie.length!==F)for(Mt=0;Mt<ie.length;)xe.call(Ke,ie[Mt],Mt,ie),Mt++;else for(Mt in ie)ie.hasOwnProperty(Mt)&&xe.call(Ke,ie[Mt],Mt,ie)}function nt(ie,xe,Ke){var Mt="DEPRECATED METHOD: "+xe+`
`+Ke+` AT 
`;return function(){var Pr=new Error("get-stack-trace"),Tn=Pr&&Pr.stack?Pr.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Mi=j.console&&(j.console.warn||j.console.log);return Mi&&Mi.call(j.console,Mt,Tn),ie.apply(this,arguments)}}var et;typeof Object.assign!="function"?et=function(xe){if(xe===F||xe===null)throw new TypeError("Cannot convert undefined or null to object");for(var Ke=Object(xe),Mt=1;Mt<arguments.length;Mt++){var Pr=arguments[Mt];if(Pr!==F&&Pr!==null)for(var Tn in Pr)Pr.hasOwnProperty(Tn)&&(Ke[Tn]=Pr[Tn])}return Ke}:et=Object.assign;var kt=nt(function(xe,Ke,Mt){for(var Pr=Object.keys(Ke),Tn=0;Tn<Pr.length;)(!Mt||Mt&&xe[Pr[Tn]]===F)&&(xe[Pr[Tn]]=Ke[Pr[Tn]]),Tn++;return xe},"extend","Use `assign`."),Y=nt(function(xe,Ke){return kt(xe,Ke,!0)},"merge","Use `assign`.");function Wt(ie,xe,Ke){var Mt=xe.prototype,Pr;Pr=ie.prototype=Object.create(Mt),Pr.constructor=ie,Pr._super=Mt,Ke&&et(Pr,Ke)}function st(ie,xe){return function(){return ie.apply(xe,arguments)}}function Ye(ie,xe){return typeof ie==Ve?ie.apply(xe&&xe[0]||F,xe):ie}function ct(ie,xe){return ie===F?xe:ie}function Je(ie,xe,Ke){_t(jr(xe),function(Mt){ie.addEventListener(Mt,Ke,!1)})}function Rt(ie,xe,Ke){_t(jr(xe),function(Mt){ie.removeEventListener(Mt,Ke,!1)})}function dr(ie,xe){for(;ie;){if(ie==xe)return!0;ie=ie.parentNode}return!1}function Mr(ie,xe){return ie.indexOf(xe)>-1}function jr(ie){return ie.trim().split(/\s+/g)}function C(ie,xe,Ke){if(ie.indexOf&&!Ke)return ie.indexOf(xe);for(var Mt=0;Mt<ie.length;){if(Ke&&ie[Mt][Ke]==xe||!Ke&&ie[Mt]===xe)return Mt;Mt++}return-1}function we(ie){return Array.prototype.slice.call(ie,0)}function Le(ie,xe,Ke){for(var Mt=[],Pr=[],Tn=0;Tn<ie.length;){var Mi=xe?ie[Tn][xe]:ie[Tn];C(Pr,Mi)<0&&Mt.push(ie[Tn]),Pr[Tn]=Mi,Tn++}return Ke&&(xe?Mt=Mt.sort(function(La,Ba){return La[xe]>Ba[xe]}):Mt=Mt.sort()),Mt}function Et(ie,xe){for(var Ke,Mt,Pr=xe[0].toUpperCase()+xe.slice(1),Tn=0;Tn<K.length;){if(Ke=K[Tn],Mt=Ke?Ke+Pr:xe,Mt in ie)return Mt;Tn++}return F}var gt=1;function Lt(){return gt++}function Yt(ie){var xe=ie.ownerDocument||ie;return xe.defaultView||xe.parentWindow||j}var br=/mobile|tablet|ip(ad|hone|od)|android/i,Yn="ontouchstart"in j,cn=Et(j,"PointerEvent")!==F,ci=Yn&&br.test(navigator.userAgent),Zn="touch",ri="pen",fi="mouse",Gn="kinect",hi=25,la=1,Vi=2,Oi=4,qi=8,ca=1,Ci=2,ma=4,Xn=8,bi=16,Ni=Ci|ma,Ki=Xn|bi,Oo=Ni|Ki,he=["x","y"],On=["clientX","clientY"];function Ua(ie,xe){var Ke=this;this.manager=ie,this.callback=xe,this.element=ie.element,this.target=ie.options.inputTarget,this.domHandler=function(Mt){Ye(ie.options.enable,[ie])&&Ke.handler(Mt)},this.init()}Ua.prototype={handler:function(){},init:function(){this.evEl&&Je(this.element,this.evEl,this.domHandler),this.evTarget&&Je(this.target,this.evTarget,this.domHandler),this.evWin&&Je(Yt(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&Rt(this.element,this.evEl,this.domHandler),this.evTarget&&Rt(this.target,this.evTarget,this.domHandler),this.evWin&&Rt(Yt(this.element),this.evWin,this.domHandler)}};function rs(ie){var xe,Ke=ie.options.inputClass;return Ke?xe=Ke:cn?xe=Pe:ci?xe=Ft:Yn?xe=Tt:xe=ba,new xe(ie,Dt)}function Dt(ie,xe,Ke){var Mt=Ke.pointers.length,Pr=Ke.changedPointers.length,Tn=xe&la&&Mt-Pr==0,Mi=xe&(Oi|qi)&&Mt-Pr==0;Ke.isFirst=!!Tn,Ke.isFinal=!!Mi,Tn&&(ie.session={}),Ke.eventType=xe,tr(ie,Ke),ie.emit("hammer.input",Ke),ie.recognize(Ke),ie.session.prevInput=Ke}function tr(ie,xe){var Ke=ie.session,Mt=xe.pointers,Pr=Mt.length;Ke.firstInput||(Ke.firstInput=xn(xe)),Pr>1&&!Ke.firstMultiple?Ke.firstMultiple=xn(xe):Pr===1&&(Ke.firstMultiple=!1);var Tn=Ke.firstInput,Mi=Ke.firstMultiple,eo=Mi?Mi.center:Tn.center,La=xe.center=Dn(Mt);xe.timeStamp=Jt(),xe.deltaTime=xe.timeStamp-Tn.timeStamp,xe.angle=Ri(eo,La),xe.distance=on(eo,La),Er(Ke,xe),xe.offsetDirection=qn(xe.deltaX,xe.deltaY);var Ba=pi(xe.deltaTime,xe.deltaX,xe.deltaY);xe.overallVelocityX=Ba.x,xe.overallVelocityY=Ba.y,xe.overallVelocity=ot(Ba.x)>ot(Ba.y)?Ba.x:Ba.y,xe.scale=Mi?Qa(Mi.pointers,Mt):1,xe.rotation=Mi?Ii(Mi.pointers,Mt):0,xe.maxPointers=Ke.prevInput?xe.pointers.length>Ke.prevInput.maxPointers?xe.pointers.length:Ke.prevInput.maxPointers:xe.pointers.length,$r(Ke,xe);var jo=ie.element;dr(xe.srcEvent.target,jo)&&(jo=xe.srcEvent.target),xe.target=jo}function Er(ie,xe){var Ke=xe.center,Mt=ie.offsetDelta||{},Pr=ie.prevDelta||{},Tn=ie.prevInput||{};(xe.eventType===la||Tn.eventType===Oi)&&(Pr=ie.prevDelta={x:Tn.deltaX||0,y:Tn.deltaY||0},Mt=ie.offsetDelta={x:Ke.x,y:Ke.y}),xe.deltaX=Pr.x+(Ke.x-Mt.x),xe.deltaY=Pr.y+(Ke.y-Mt.y)}function $r(ie,xe){var Ke=ie.lastInterval||xe,Mt=xe.timeStamp-Ke.timeStamp,Pr,Tn,Mi,eo;if(xe.eventType!=qi&&(Mt>hi||Ke.velocity===F)){var La=xe.deltaX-Ke.deltaX,Ba=xe.deltaY-Ke.deltaY,jo=pi(Mt,La,Ba);Tn=jo.x,Mi=jo.y,Pr=ot(jo.x)>ot(jo.y)?jo.x:jo.y,eo=qn(La,Ba),ie.lastInterval=xe}else Pr=Ke.velocity,Tn=Ke.velocityX,Mi=Ke.velocityY,eo=Ke.direction;xe.velocity=Pr,xe.velocityX=Tn,xe.velocityY=Mi,xe.direction=eo}function xn(ie){for(var xe=[],Ke=0;Ke<ie.pointers.length;)xe[Ke]={clientX:ke(ie.pointers[Ke].clientX),clientY:ke(ie.pointers[Ke].clientY)},Ke++;return{timeStamp:Jt(),pointers:xe,center:Dn(xe),deltaX:ie.deltaX,deltaY:ie.deltaY}}function Dn(ie){var xe=ie.length;if(xe===1)return{x:ke(ie[0].clientX),y:ke(ie[0].clientY)};for(var Ke=0,Mt=0,Pr=0;Pr<xe;)Ke+=ie[Pr].clientX,Mt+=ie[Pr].clientY,Pr++;return{x:ke(Ke/xe),y:ke(Mt/xe)}}function pi(ie,xe,Ke){return{x:xe/ie||0,y:Ke/ie||0}}function qn(ie,xe){return ie===xe?ca:ot(ie)>=ot(xe)?ie<0?Ci:ma:xe<0?Xn:bi}function on(ie,xe,Ke){Ke||(Ke=he);var Mt=xe[Ke[0]]-ie[Ke[0]],Pr=xe[Ke[1]]-ie[Ke[1]];return Math.sqrt(Mt*Mt+Pr*Pr)}function Ri(ie,xe,Ke){Ke||(Ke=he);var Mt=xe[Ke[0]]-ie[Ke[0]],Pr=xe[Ke[1]]-ie[Ke[1]];return Math.atan2(Pr,Mt)*180/Math.PI}function Ii(ie,xe){return Ri(xe[1],xe[0],On)+Ri(ie[1],ie[0],On)}function Qa(ie,xe){return on(xe[0],xe[1],On)/on(ie[0],ie[1],On)}var hs={mousedown:la,mousemove:Vi,mouseup:Oi},Zo="mousedown",Fa="mousemove mouseup";function ba(){this.evEl=Zo,this.evWin=Fa,this.pressed=!1,Ua.apply(this,arguments)}Wt(ba,Ua,{handler:function(xe){var Ke=hs[xe.type];Ke&la&&xe.button===0&&(this.pressed=!0),Ke&Vi&&xe.which!==1&&(Ke=Oi),!!this.pressed&&(Ke&Oi&&(this.pressed=!1),this.callback(this.manager,Ke,{pointers:[xe],changedPointers:[xe],pointerType:fi,srcEvent:xe}))}});var G={pointerdown:la,pointermove:Vi,pointerup:Oi,pointercancel:qi,pointerout:qi},ee={2:Zn,3:ri,4:fi,5:Gn},ae="pointerdown",me="pointermove pointerup pointercancel";!ye&&j.MSPointerEvent&&!j.PointerEvent&&(ae="MSPointerDown",me="MSPointerMove MSPointerUp MSPointerCancel");function Pe(){this.evEl=ae,this.evWin=me,Ua.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}Wt(Pe,Ua,{handler:function(xe){var Ke=this.store,Mt=!1,Pr=xe.type.toLowerCase().replace("ms",""),Tn=G[Pr],Mi=ee[xe.pointerType]||xe.pointerType,eo=Mi==Zn,La=C(Ke,xe.pointerId,"pointerId");Tn&la&&(xe.button===0||eo)?La<0&&(Ke.push(xe),La=Ke.length-1):Tn&(Oi|qi)&&(Mt=!0),!(La<0)&&(Ke[La]=xe,this.callback(this.manager,Tn,{pointers:Ke,changedPointers:[xe],pointerType:Mi,srcEvent:xe}),Mt&&Ke.splice(La,1))}});var Ge={touchstart:la,touchmove:Vi,touchend:Oi,touchcancel:qi},tt="touchstart",ce="touchstart touchmove touchend touchcancel";function Re(){this.evTarget=tt,this.evWin=ce,this.started=!1,Ua.apply(this,arguments)}Wt(Re,Ua,{handler:function(xe){var Ke=Ge[xe.type];if(Ke===la&&(this.started=!0),!!this.started){var Mt=mt.call(this,xe,Ke);Ke&(Oi|qi)&&Mt[0].length-Mt[1].length==0&&(this.started=!1),this.callback(this.manager,Ke,{pointers:Mt[0],changedPointers:Mt[1],pointerType:Zn,srcEvent:xe})}}});function mt(ie,xe){var Ke=we(ie.touches),Mt=we(ie.changedTouches);return xe&(Oi|qi)&&(Ke=Le(Ke.concat(Mt),"identifier",!0)),[Ke,Mt]}var hr={touchstart:la,touchmove:Vi,touchend:Oi,touchcancel:qi},Ot="touchstart touchmove touchend touchcancel";function Ft(){this.evTarget=Ot,this.targetIds={},Ua.apply(this,arguments)}Wt(Ft,Ua,{handler:function(xe){var Ke=hr[xe.type],Mt=pr.call(this,xe,Ke);!Mt||this.callback(this.manager,Ke,{pointers:Mt[0],changedPointers:Mt[1],pointerType:Zn,srcEvent:xe})}});function pr(ie,xe){var Ke=we(ie.touches),Mt=this.targetIds;if(xe&(la|Vi)&&Ke.length===1)return Mt[Ke[0].identifier]=!0,[Ke,Ke];var Pr,Tn,Mi=we(ie.changedTouches),eo=[],La=this.target;if(Tn=Ke.filter(function(Ba){return dr(Ba.target,La)}),xe===la)for(Pr=0;Pr<Tn.length;)Mt[Tn[Pr].identifier]=!0,Pr++;for(Pr=0;Pr<Mi.length;)Mt[Mi[Pr].identifier]&&eo.push(Mi[Pr]),xe&(Oi|qi)&&delete Mt[Mi[Pr].identifier],Pr++;if(!!eo.length)return[Le(Tn.concat(eo),"identifier",!0),eo]}var gn=2500,un=25;function Tt(){Ua.apply(this,arguments);var ie=st(this.handler,this);this.touch=new Ft(this.manager,ie),this.mouse=new ba(this.manager,ie),this.primaryTouch=null,this.lastTouches=[]}Wt(Tt,Ua,{handler:function(xe,Ke,Mt){var Pr=Mt.pointerType==Zn,Tn=Mt.pointerType==fi;if(!(Tn&&Mt.sourceCapabilities&&Mt.sourceCapabilities.firesTouchEvents)){if(Pr)Jr.call(this,Ke,Mt);else if(Tn&&Gr.call(this,Mt))return;this.callback(xe,Ke,Mt)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function Jr(ie,xe){ie&la?(this.primaryTouch=xe.changedPointers[0].identifier,Dr.call(this,xe)):ie&(Oi|qi)&&Dr.call(this,xe)}function Dr(ie){var xe=ie.changedPointers[0];if(xe.identifier===this.primaryTouch){var Ke={x:xe.clientX,y:xe.clientY};this.lastTouches.push(Ke);var Mt=this.lastTouches,Pr=function(){var Tn=Mt.indexOf(Ke);Tn>-1&&Mt.splice(Tn,1)};setTimeout(Pr,gn)}}function Gr(ie){for(var xe=ie.srcEvent.clientX,Ke=ie.srcEvent.clientY,Mt=0;Mt<this.lastTouches.length;Mt++){var Pr=this.lastTouches[Mt],Tn=Math.abs(xe-Pr.x),Mi=Math.abs(Ke-Pr.y);if(Tn<=un&&Mi<=un)return!0}return!1}var vi=ye?F:Et(Ne.style,"touchAction"),Qr=vi!==F,An="compute",Wi="auto",di="manipulation",Ti="none",_i="pan-x",Ct="pan-y",qt=Ai();function Aa(ie,xe){this.manager=ie,this.set(xe)}Aa.prototype={set:function(ie){ie==An&&(ie=this.compute()),Qr&&this.manager.element.style&&qt[ie]&&(this.manager.element.style[vi]=ie),this.actions=ie.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var ie=[];return _t(this.manager.recognizers,function(xe){Ye(xe.options.enable,[xe])&&(ie=ie.concat(xe.getTouchAction()))}),Ei(ie.join(" "))},preventDefaults:function(ie){var xe=ie.srcEvent,Ke=ie.offsetDirection;if(this.manager.session.prevented){xe.preventDefault();return}var Mt=this.actions,Pr=Mr(Mt,Ti)&&!qt[Ti],Tn=Mr(Mt,Ct)&&!qt[Ct],Mi=Mr(Mt,_i)&&!qt[_i];if(Pr){var eo=ie.pointers.length===1,La=ie.distance<2,Ba=ie.deltaTime<250;if(eo&&La&&Ba)return}if(!(Mi&&Tn)&&(Pr||Tn&&Ke&Ni||Mi&&Ke&Ki))return this.preventSrc(xe)},preventSrc:function(ie){this.manager.session.prevented=!0,ie.preventDefault()}};function Ei(ie){if(Mr(ie,Ti))return Ti;var xe=Mr(ie,_i),Ke=Mr(ie,Ct);return xe&&Ke?Ti:xe||Ke?xe?_i:Ct:Mr(ie,di)?di:Wi}function Ai(){if(!Qr)return!1;var ie={};if(ye)return ie;var xe=j.CSS&&j.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(Ke){ie[Ke]=xe?j.CSS.supports("touch-action",Ke):!0}),ie}var Bi=1,Yr=2,wn=4,zt=8,aa=zt,be=16,Ko=32;function ea(ie){this.options=et({},this.defaults,ie||{}),this.id=Lt(),this.manager=null,this.options.enable=ct(this.options.enable,!0),this.state=Bi,this.simultaneous={},this.requireFail=[]}ea.prototype={defaults:{},set:function(ie){return et(this.options,ie),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(ie){if(Zt(ie,"recognizeWith",this))return this;var xe=this.simultaneous;return ie=Ma(ie,this),xe[ie.id]||(xe[ie.id]=ie,ie.recognizeWith(this)),this},dropRecognizeWith:function(ie){return Zt(ie,"dropRecognizeWith",this)?this:(ie=Ma(ie,this),delete this.simultaneous[ie.id],this)},requireFailure:function(ie){if(Zt(ie,"requireFailure",this))return this;var xe=this.requireFail;return ie=Ma(ie,this),C(xe,ie)===-1&&(xe.push(ie),ie.requireFailure(this)),this},dropRequireFailure:function(ie){if(Zt(ie,"dropRequireFailure",this))return this;ie=Ma(ie,this);var xe=C(this.requireFail,ie);return xe>-1&&this.requireFail.splice(xe,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(ie){return!!this.simultaneous[ie.id]},emit:function(ie){var xe=this,Ke=this.state;function Mt(Pr){xe.manager.emit(Pr,ie)}Ke<zt&&Mt(xe.options.event+hu(Ke)),Mt(xe.options.event),ie.additionalEvent&&Mt(ie.additionalEvent),Ke>=zt&&Mt(xe.options.event+hu(Ke))},tryEmit:function(ie){if(this.canEmit())return this.emit(ie);this.state=Ko},canEmit:function(){for(var ie=0;ie<this.requireFail.length;){if(!(this.requireFail[ie].state&(Ko|Bi)))return!1;ie++}return!0},recognize:function(ie){var xe=et({},ie);if(!Ye(this.options.enable,[this,xe])){this.reset(),this.state=Ko;return}this.state&(aa|be|Ko)&&(this.state=Bi),this.state=this.process(xe),this.state&(Yr|wn|zt|be)&&this.tryEmit(xe)},process:function(ie){},getTouchAction:function(){},reset:function(){}};function hu(ie){return ie&be?"cancel":ie&zt?"end":ie&wn?"move":ie&Yr?"start":""}function Na(ie){return ie==bi?"down":ie==Xn?"up":ie==Ci?"left":ie==ma?"right":""}function Ma(ie,xe){var Ke=xe.manager;return Ke?Ke.get(ie):ie}function Wa(){ea.apply(this,arguments)}Wt(Wa,ea,{defaults:{pointers:1},attrTest:function(ie){var xe=this.options.pointers;return xe===0||ie.pointers.length===xe},process:function(ie){var xe=this.state,Ke=ie.eventType,Mt=xe&(Yr|wn),Pr=this.attrTest(ie);return Mt&&(Ke&qi||!Pr)?xe|be:Mt||Pr?Ke&Oi?xe|zt:xe&Yr?xe|wn:Yr:Ko}});function oa(){Wa.apply(this,arguments),this.pX=null,this.pY=null}Wt(oa,Wa,{defaults:{event:"pan",threshold:10,pointers:1,direction:Oo},getTouchAction:function(){var ie=this.options.direction,xe=[];return ie&Ni&&xe.push(Ct),ie&Ki&&xe.push(_i),xe},directionTest:function(ie){var xe=this.options,Ke=!0,Mt=ie.distance,Pr=ie.direction,Tn=ie.deltaX,Mi=ie.deltaY;return Pr&xe.direction||(xe.direction&Ni?(Pr=Tn===0?ca:Tn<0?Ci:ma,Ke=Tn!=this.pX,Mt=Math.abs(ie.deltaX)):(Pr=Mi===0?ca:Mi<0?Xn:bi,Ke=Mi!=this.pY,Mt=Math.abs(ie.deltaY))),ie.direction=Pr,Ke&&Mt>xe.threshold&&Pr&xe.direction},attrTest:function(ie){return Wa.prototype.attrTest.call(this,ie)&&(this.state&Yr||!(this.state&Yr)&&this.directionTest(ie))},emit:function(ie){this.pX=ie.deltaX,this.pY=ie.deltaY;var xe=Na(ie.direction);xe&&(ie.additionalEvent=this.options.event+xe),this._super.emit.call(this,ie)}});function Eo(){Wa.apply(this,arguments)}Wt(Eo,Wa,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Ti]},attrTest:function(ie){return this._super.attrTest.call(this,ie)&&(Math.abs(ie.scale-1)>this.options.threshold||this.state&Yr)},emit:function(ie){if(ie.scale!==1){var xe=ie.scale<1?"in":"out";ie.additionalEvent=this.options.event+xe}this._super.emit.call(this,ie)}});function Vo(){ea.apply(this,arguments),this._timer=null,this._input=null}Wt(Vo,ea,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Wi]},process:function(ie){var xe=this.options,Ke=ie.pointers.length===xe.pointers,Mt=ie.distance<xe.threshold,Pr=ie.deltaTime>xe.time;if(this._input=ie,!Mt||!Ke||ie.eventType&(Oi|qi)&&!Pr)this.reset();else if(ie.eventType&la)this.reset(),this._timer=pt(function(){this.state=aa,this.tryEmit()},xe.time,this);else if(ie.eventType&Oi)return aa;return Ko},reset:function(){clearTimeout(this._timer)},emit:function(ie){this.state===aa&&(ie&&ie.eventType&Oi?this.manager.emit(this.options.event+"up",ie):(this._input.timeStamp=Jt(),this.manager.emit(this.options.event,this._input)))}});function bu(){Wa.apply(this,arguments)}Wt(bu,Wa,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Ti]},attrTest:function(ie){return this._super.attrTest.call(this,ie)&&(Math.abs(ie.rotation)>this.options.threshold||this.state&Yr)}});function co(){Wa.apply(this,arguments)}Wt(co,Wa,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Ni|Ki,pointers:1},getTouchAction:function(){return oa.prototype.getTouchAction.call(this)},attrTest:function(ie){var xe=this.options.direction,Ke;return xe&(Ni|Ki)?Ke=ie.overallVelocity:xe&Ni?Ke=ie.overallVelocityX:xe&Ki&&(Ke=ie.overallVelocityY),this._super.attrTest.call(this,ie)&&xe&ie.offsetDirection&&ie.distance>this.options.threshold&&ie.maxPointers==this.options.pointers&&ot(Ke)>this.options.velocity&&ie.eventType&Oi},emit:function(ie){var xe=Na(ie.offsetDirection);xe&&this.manager.emit(this.options.event+xe,ie),this.manager.emit(this.options.event,ie)}});function Ro(){ea.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}Wt(Ro,ea,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[di]},process:function(ie){var xe=this.options,Ke=ie.pointers.length===xe.pointers,Mt=ie.distance<xe.threshold,Pr=ie.deltaTime<xe.time;if(this.reset(),ie.eventType&la&&this.count===0)return this.failTimeout();if(Mt&&Pr&&Ke){if(ie.eventType!=Oi)return this.failTimeout();var Tn=this.pTime?ie.timeStamp-this.pTime<xe.interval:!0,Mi=!this.pCenter||on(this.pCenter,ie.center)<xe.posThreshold;this.pTime=ie.timeStamp,this.pCenter=ie.center,!Mi||!Tn?this.count=1:this.count+=1,this._input=ie;var eo=this.count%xe.taps;if(eo===0)return this.hasRequireFailures()?(this._timer=pt(function(){this.state=aa,this.tryEmit()},xe.interval,this),Yr):aa}return Ko},failTimeout:function(){return this._timer=pt(function(){this.state=Ko},this.options.interval,this),Ko},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==aa&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function sa(ie,xe){return xe=xe||{},xe.recognizers=ct(xe.recognizers,sa.defaults.preset),new Ya(ie,xe)}sa.VERSION="2.0.7",sa.defaults={domEvents:!1,touchAction:An,enable:!0,inputTarget:null,inputClass:null,preset:[[bu,{enable:!1}],[Eo,{enable:!1},["rotate"]],[co,{direction:Ni}],[oa,{direction:Ni},["swipe"]],[Ro],[Ro,{event:"doubletap",taps:2},["tap"]],[Vo]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var Xa=1,Lo=2;function Ya(ie,xe){this.options=et({},sa.defaults,xe||{}),this.options.inputTarget=this.options.inputTarget||ie,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=ie,this.input=rs(this),this.touchAction=new Aa(this,this.options.touchAction),Ps(this,!0),_t(this.options.recognizers,function(Ke){var Mt=this.add(new Ke[0](Ke[1]));Ke[2]&&Mt.recognizeWith(Ke[2]),Ke[3]&&Mt.requireFailure(Ke[3])},this)}Ya.prototype={set:function(ie){return et(this.options,ie),ie.touchAction&&this.touchAction.update(),ie.inputTarget&&(this.input.destroy(),this.input.target=ie.inputTarget,this.input.init()),this},stop:function(ie){this.session.stopped=ie?Lo:Xa},recognize:function(ie){var xe=this.session;if(!xe.stopped){this.touchAction.preventDefaults(ie);var Ke,Mt=this.recognizers,Pr=xe.curRecognizer;(!Pr||Pr&&Pr.state&aa)&&(Pr=xe.curRecognizer=null);for(var Tn=0;Tn<Mt.length;)Ke=Mt[Tn],xe.stopped!==Lo&&(!Pr||Ke==Pr||Ke.canRecognizeWith(Pr))?Ke.recognize(ie):Ke.reset(),!Pr&&Ke.state&(Yr|wn|zt)&&(Pr=xe.curRecognizer=Ke),Tn++}},get:function(ie){if(ie instanceof ea)return ie;for(var xe=this.recognizers,Ke=0;Ke<xe.length;Ke++)if(xe[Ke].options.event==ie)return xe[Ke];return null},add:function(ie){if(Zt(ie,"add",this))return this;var xe=this.get(ie.options.event);return xe&&this.remove(xe),this.recognizers.push(ie),ie.manager=this,this.touchAction.update(),ie},remove:function(ie){if(Zt(ie,"remove",this))return this;if(ie=this.get(ie),ie){var xe=this.recognizers,Ke=C(xe,ie);Ke!==-1&&(xe.splice(Ke,1),this.touchAction.update())}return this},on:function(ie,xe){if(ie!==F&&xe!==F){var Ke=this.handlers;return _t(jr(ie),function(Mt){Ke[Mt]=Ke[Mt]||[],Ke[Mt].push(xe)}),this}},off:function(ie,xe){if(ie!==F){var Ke=this.handlers;return _t(jr(ie),function(Mt){xe?Ke[Mt]&&Ke[Mt].splice(C(Ke[Mt],xe),1):delete Ke[Mt]}),this}},emit:function(ie,xe){this.options.domEvents&&Cl(ie,xe);var Ke=this.handlers[ie]&&this.handlers[ie].slice();if(!(!Ke||!Ke.length)){xe.type=ie,xe.preventDefault=function(){xe.srcEvent.preventDefault()};for(var Mt=0;Mt<Ke.length;)Ke[Mt](xe),Mt++}},destroy:function(){this.element&&Ps(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Ps(ie,xe){var Ke=ie.element;if(!!Ke.style){var Mt;_t(ie.options.cssProps,function(Pr,Tn){Mt=Et(Ke.style,Tn),xe?(ie.oldCssProps[Mt]=Ke.style[Mt],Ke.style[Mt]=Pr):Ke.style[Mt]=ie.oldCssProps[Mt]||""}),xe||(ie.oldCssProps={})}}function Cl(ie,xe){if(!ye){var Ke=v.createEvent("Event");Ke.initEvent(ie,!0,!0),Ke.gesture=xe,xe.target.dispatchEvent(Ke)}}if(!ye){et(sa,{INPUT_START:la,INPUT_MOVE:Vi,INPUT_END:Oi,INPUT_CANCEL:qi,STATE_POSSIBLE:Bi,STATE_BEGAN:Yr,STATE_CHANGED:wn,STATE_ENDED:zt,STATE_RECOGNIZED:aa,STATE_CANCELLED:be,STATE_FAILED:Ko,DIRECTION_NONE:ca,DIRECTION_LEFT:Ci,DIRECTION_RIGHT:ma,DIRECTION_UP:Xn,DIRECTION_DOWN:bi,DIRECTION_HORIZONTAL:Ni,DIRECTION_VERTICAL:Ki,DIRECTION_ALL:Oo,Manager:Ya,Input:Ua,TouchAction:Aa,TouchInput:Ft,MouseInput:ba,PointerEventInput:Pe,TouchMouseInput:Tt,SingleTouchInput:Re,Recognizer:ea,AttrRecognizer:Wa,Tap:Ro,Pan:oa,Swipe:co,Pinch:Eo,Rotate:bu,Press:Vo,on:Je,off:Rt,each:_t,merge:Y,extend:kt,assign:et,inherit:Wt,bindFn:st,prefixed:Et});var ps=typeof window!="undefined"?window:typeof self!="undefined"?self:{};ps.Hammer=sa,X=function(){return sa}.call(W,L,W,Ue),X!==F&&(Ue.exports=X)}})(typeof window!="undefined"?window:{console:null,MSPointerEvent:null,PointerEvent:null,CSS:null},document,"Hammer")},88307:function(Ue,W,L){(function(X,j){Ue.exports=j(L(18857))})(this,function(X){"use strict";var j=function(B){return B instanceof Uint8Array||B instanceof Uint16Array||B instanceof Uint32Array||B instanceof Int8Array||B instanceof Int16Array||B instanceof Int32Array||B instanceof Float32Array||B instanceof Float64Array||B instanceof Uint8ClampedArray},v=function(B,ve){for(var Be=Object.keys(ve),It=0;It<Be.length;++It)B[Be[It]]=ve[Be[It]];return B},Q=`
`;function F(B){return typeof atob!="undefined"?atob(B):"base64:"+B}function J(B){var ve=new Error("(regl) "+B);throw console.error(ve),ve}function ne(B,ve){B||J(ve)}function ye(B){return B?": "+B:""}function K(B,ve,Be){B in ve||J("unknown parameter ("+B+")"+ye(Be)+". possible values: "+Object.keys(ve).join())}function Ne(B,ve){j(B)||J("invalid parameter type"+ye(ve)+". must be a typed array")}function Ve(B,ve){switch(ve){case"number":return typeof B=="number";case"object":return typeof B=="object";case"string":return typeof B=="string";case"boolean":return typeof B=="boolean";case"function":return typeof B=="function";case"undefined":return typeof B=="undefined";case"symbol":return typeof B=="symbol"}}function ke(B,ve,Be){Ve(B,ve)||J("invalid parameter type"+ye(Be)+". expected "+ve+", got "+typeof B)}function ot(B,ve){B>=0&&(B|0)===B||J("invalid parameter type, ("+B+")"+ye(ve)+". must be a nonnegative integer")}function Jt(B,ve,Be){ve.indexOf(B)<0&&J("invalid value"+ye(Be)+". must be one of: "+ve)}var pt=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function Zt(B){Object.keys(B).forEach(function(ve){pt.indexOf(ve)<0&&J('invalid regl constructor argument "'+ve+'". must be one of '+pt)})}function _t(B,ve){for(B=B+"";B.length<ve;)B=" "+B;return B}function nt(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function et(B,ve){this.number=B,this.line=ve,this.errors=[]}function kt(B,ve,Be){this.file=B,this.line=ve,this.message=Be}function Y(){var B=new Error,ve=(B.stack||B).toString(),Be=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(ve);if(Be)return Be[1];var It=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(ve);return It?It[1]:"unknown"}function Wt(){var B=new Error,ve=(B.stack||B).toString(),Be=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(ve);if(Be)return Be[1];var It=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(ve);return It?It[1]:"unknown"}function st(B,ve){var Be=B.split(`
`),It=1,ar=0,Pt={unknown:new nt,0:new nt};Pt.unknown.name=Pt[0].name=ve||Y(),Pt.unknown.lines.push(new et(0,""));for(var Qt=0;Qt<Be.length;++Qt){var lr=Be[Qt],vr=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(lr);if(vr)switch(vr[1]){case"line":var yr=/(\d+)(\s+\d+)?/.exec(vr[2]);yr&&(It=yr[1]|0,yr[2]&&(ar=yr[2]|0,ar in Pt||(Pt[ar]=new nt)));break;case"define":var Cr=/SHADER_NAME(_B64)?\s+(.*)$/.exec(vr[2]);Cr&&(Pt[ar].name=Cr[1]?F(Cr[2]):Cr[2]);break}Pt[ar].lines.push(new et(It++,lr))}return Object.keys(Pt).forEach(function(Tr){var Ur=Pt[Tr];Ur.lines.forEach(function(gr){Ur.index[gr.number]=gr})}),Pt}function Ye(B){var ve=[];return B.split(`
`).forEach(function(Be){if(!(Be.length<5)){var It=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(Be);It?ve.push(new kt(It[1]|0,It[2]|0,It[3].trim())):Be.length>0&&ve.push(new kt("unknown",0,Be))}}),ve}function ct(B,ve){ve.forEach(function(Be){var It=B[Be.file];if(It){var ar=It.index[Be.line];if(ar){ar.errors.push(Be),It.hasErrors=!0;return}}B.unknown.hasErrors=!0,B.unknown.lines[0].errors.push(Be)})}function Je(B,ve,Be,It,ar){if(!B.getShaderParameter(ve,B.COMPILE_STATUS)){var Pt=B.getShaderInfoLog(ve),Qt=It===B.FRAGMENT_SHADER?"fragment":"vertex";Le(Be,"string",Qt+" shader source must be a string",ar);var lr=st(Be,ar),vr=Ye(Pt);ct(lr,vr),Object.keys(lr).forEach(function(yr){var Cr=lr[yr];if(!Cr.hasErrors)return;var Tr=[""],Ur=[""];function gr(Sr,ut){Tr.push(Sr),Ur.push(ut||"")}gr("file number "+yr+": "+Cr.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),Cr.lines.forEach(function(Sr){if(Sr.errors.length>0){gr(_t(Sr.number,4)+"|  ","background-color:yellow; font-weight:bold"),gr(Sr.line+Q,"color:red; background-color:yellow; font-weight:bold");var ut=0;Sr.errors.forEach(function(jt){var _r=jt.message,kr=/^\s*'(.*)'\s*:\s*(.*)$/.exec(_r);if(kr){var ur=kr[1];switch(_r=kr[2],ur){case"assign":ur="=";break}ut=Math.max(Sr.line.indexOf(ur,ut),0)}else ut=0;gr(_t("| ",6)),gr(_t("^^^",ut+3)+Q,"font-weight:bold"),gr(_t("| ",6)),gr(_r+Q,"font-weight:bold")}),gr(_t("| ",6)+Q)}else gr(_t(Sr.number,4)+"|  "),gr(Sr.line+Q,"color:red")}),typeof document!="undefined"&&!window.chrome?(Ur[0]=Tr.join("%c"),console.log.apply(console,Ur)):console.log(Tr.join(""))}),ne.raise("Error compiling "+Qt+" shader, "+lr[0].name)}}function Rt(B,ve,Be,It,ar){if(!B.getProgramParameter(ve,B.LINK_STATUS)){var Pt=B.getProgramInfoLog(ve),Qt=st(Be,ar),lr=st(It,ar),vr='Error linking program with vertex shader, "'+lr[0].name+'", and fragment shader "'+Qt[0].name+'"';typeof document!="undefined"?console.log("%c"+vr+Q+"%c"+Pt,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(vr+Q+Pt),ne.raise(vr)}}function dr(B){B._commandRef=Y()}function Mr(B,ve,Be,It){dr(B);function ar(vr){return vr?It.id(vr):0}B._fragId=ar(B.static.frag),B._vertId=ar(B.static.vert);function Pt(vr,yr){Object.keys(yr).forEach(function(Cr){vr[It.id(Cr)]=!0})}var Qt=B._uniformSet={};Pt(Qt,ve.static),Pt(Qt,ve.dynamic);var lr=B._attributeSet={};Pt(lr,Be.static),Pt(lr,Be.dynamic),B._hasCount="count"in B.static||"count"in B.dynamic||"elements"in B.static||"elements"in B.dynamic}function jr(B,ve){var Be=Wt();J(B+" in command "+(ve||Y())+(Be==="unknown"?"":" called from "+Be))}function C(B,ve,Be){B||jr(ve,Be||Y())}function we(B,ve,Be,It){B in ve||jr("unknown parameter ("+B+")"+ye(Be)+". possible values: "+Object.keys(ve).join(),It||Y())}function Le(B,ve,Be,It){Ve(B,ve)||jr("invalid parameter type"+ye(Be)+". expected "+ve+", got "+typeof B,It||Y())}function Et(B){B()}function gt(B,ve,Be){B.texture?Jt(B.texture._texture.internalformat,ve,"unsupported texture format for attachment"):Jt(B.renderbuffer._renderbuffer.format,Be,"unsupported renderbuffer format for attachment")}var Lt=33071,Yt=9728,br=9984,Yn=9985,cn=9986,ci=9987,Zn=5120,ri=5121,fi=5122,Gn=5123,hi=5124,la=5125,Vi=5126,Oi=32819,qi=32820,ca=33635,Ci=34042,ma=36193,Xn={};Xn[Zn]=Xn[ri]=1,Xn[fi]=Xn[Gn]=Xn[ma]=Xn[ca]=Xn[Oi]=Xn[qi]=2,Xn[hi]=Xn[la]=Xn[Vi]=Xn[Ci]=4;function bi(B,ve){return B===qi||B===Oi||B===ca?2:B===Ci?4:Xn[B]*ve}function Ni(B){return!(B&B-1)&&!!B}function Ki(B,ve,Be){var It,ar=ve.width,Pt=ve.height,Qt=ve.channels;ne(ar>0&&ar<=Be.maxTextureSize&&Pt>0&&Pt<=Be.maxTextureSize,"invalid texture shape"),(B.wrapS!==Lt||B.wrapT!==Lt)&&ne(Ni(ar)&&Ni(Pt),"incompatible wrap mode for texture, both width and height must be power of 2"),ve.mipmask===1?ar!==1&&Pt!==1&&ne(B.minFilter!==br&&B.minFilter!==cn&&B.minFilter!==Yn&&B.minFilter!==ci,"min filter requires mipmap"):(ne(Ni(ar)&&Ni(Pt),"texture must be a square power of 2 to support mipmapping"),ne(ve.mipmask===(ar<<1)-1,"missing or incomplete mipmap data")),ve.type===Vi&&(Be.extensions.indexOf("oes_texture_float_linear")<0&&ne(B.minFilter===Yt&&B.magFilter===Yt,"filter not supported, must enable oes_texture_float_linear"),ne(!B.genMipmaps,"mipmap generation not supported with float textures"));var lr=ve.images;for(It=0;It<16;++It)if(lr[It]){var vr=ar>>It,yr=Pt>>It;ne(ve.mipmask&1<<It,"missing mipmap data");var Cr=lr[It];if(ne(Cr.width===vr&&Cr.height===yr,"invalid shape for mip images"),ne(Cr.format===ve.format&&Cr.internalformat===ve.internalformat&&Cr.type===ve.type,"incompatible type for mip image"),!Cr.compressed)if(Cr.data){var Tr=Math.ceil(bi(Cr.type,Qt)*vr/Cr.unpackAlignment)*Cr.unpackAlignment;ne(Cr.data.byteLength===Tr*yr,"invalid data for image, buffer size is inconsistent with image format")}else Cr.element||Cr.copy}else B.genMipmaps||ne((ve.mipmask&1<<It)==0,"extra mipmap data");ve.compressed&&ne(!B.genMipmaps,"mipmap generation for compressed images not supported")}function Oo(B,ve,Be,It){var ar=B.width,Pt=B.height,Qt=B.channels;ne(ar>0&&ar<=It.maxTextureSize&&Pt>0&&Pt<=It.maxTextureSize,"invalid texture shape"),ne(ar===Pt,"cube map must be square"),ne(ve.wrapS===Lt&&ve.wrapT===Lt,"wrap mode not supported by cube map");for(var lr=0;lr<Be.length;++lr){var vr=Be[lr];ne(vr.width===ar&&vr.height===Pt,"inconsistent cube map face shape"),ve.genMipmaps&&(ne(!vr.compressed,"can not generate mipmap for compressed textures"),ne(vr.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var yr=vr.images,Cr=0;Cr<16;++Cr){var Tr=yr[Cr];if(Tr){var Ur=ar>>Cr,gr=Pt>>Cr;ne(vr.mipmask&1<<Cr,"missing mipmap data"),ne(Tr.width===Ur&&Tr.height===gr,"invalid shape for mip images"),ne(Tr.format===B.format&&Tr.internalformat===B.internalformat&&Tr.type===B.type,"incompatible type for mip image"),Tr.compressed||(Tr.data?ne(Tr.data.byteLength===Ur*gr*Math.max(bi(Tr.type,Qt),Tr.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):Tr.element||Tr.copy)}}}}var he=v(ne,{optional:Et,raise:J,commandRaise:jr,command:C,parameter:K,commandParameter:we,constructor:Zt,type:ke,commandType:Le,isTypedArray:Ne,nni:ot,oneOf:Jt,shaderError:Je,linkError:Rt,callSite:Wt,saveCommandRef:dr,saveDrawInfo:Mr,framebufferFormat:gt,guessCommand:Y,texture2D:Ki,textureCube:Oo}),On=0,Ua=0,rs=5,Dt=6;function tr(B,ve){this.id=On++,this.type=B,this.data=ve}function Er(B){return B.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function $r(B){if(B.length===0)return[];var ve=B.charAt(0),Be=B.charAt(B.length-1);if(B.length>1&&ve===Be&&(ve==='"'||ve==="'"))return['"'+Er(B.substr(1,B.length-2))+'"'];var It=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(B);if(It)return $r(B.substr(0,It.index)).concat($r(It[1])).concat($r(B.substr(It.index+It[0].length)));var ar=B.split(".");if(ar.length===1)return['"'+Er(B)+'"'];for(var Pt=[],Qt=0;Qt<ar.length;++Qt)Pt=Pt.concat($r(ar[Qt]));return Pt}function xn(B){return"["+$r(B).join("][")+"]"}function Dn(B,ve){return new tr(B,xn(ve+""))}function pi(B){return typeof B=="function"&&!B._reglType||B instanceof tr}function qn(B,ve){if(typeof B=="function")return new tr(Ua,B);if(typeof B=="number"||typeof B=="boolean")return new tr(rs,B);if(Array.isArray(B))return new tr(Dt,B.map(function(Be,It){return qn(Be,ve+"["+It+"]")}));if(B instanceof tr)return B;he(!1,"invalid option type in uniform "+ve)}var on={DynamicVariable:tr,define:Dn,isDynamic:pi,unbox:qn,accessor:xn},Ri={next:typeof requestAnimationFrame=="function"?function(B){return requestAnimationFrame(B)}:function(B){return setTimeout(B,16)},cancel:typeof cancelAnimationFrame=="function"?function(B){return cancelAnimationFrame(B)}:clearTimeout},Ii=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",Qa=Ii?function(){return+new Date}:typeof performance!="undefined"&&performance.now?function(){return performance.now()}:function(){return+new Date};function hs(){var B={"":0},ve=[""];return{id:function(Be){var It=B[Be];return It||(It=B[Be]=ve.length,ve.push(Be),It)},str:function(Be){return ve[Be]}}}function Zo(B,ve,Be){var It=document.createElement("canvas");v(It.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),B.appendChild(It),B===document.body&&(It.style.position="absolute",v(B.style,{margin:0,padding:0}));function ar(){var lr=window.innerWidth,vr=window.innerHeight;if(B!==document.body){var yr=It.getBoundingClientRect();lr=yr.right-yr.left,vr=yr.bottom-yr.top}It.width=Be*lr,It.height=Be*vr}var Pt;B!==document.body&&typeof ResizeObserver=="function"?(Pt=new ResizeObserver(function(){setTimeout(ar)}),Pt.observe(B)):window.addEventListener("resize",ar,!1);function Qt(){Pt?Pt.disconnect():window.removeEventListener("resize",ar),B.removeChild(It)}return ar(),{canvas:It,onDestroy:Qt}}function Fa(B,ve){function Be(It){try{return B.getContext(It,ve)}catch(ar){return null}}return Be("webgl")||Be("experimental-webgl")||Be("webgl-experimental")}function ba(B){return typeof B.nodeName=="string"&&typeof B.appendChild=="function"&&typeof B.getBoundingClientRect=="function"}function G(B){return typeof B.drawArrays=="function"||typeof B.drawElements=="function"}function ee(B){return typeof B=="string"?B.split():(he(Array.isArray(B),"invalid extension array"),B)}function ae(B){return typeof B=="string"?(he(typeof document!="undefined","not supported outside of DOM"),document.querySelector(B)):B}function me(B){var ve=B||{},Be,It,ar,Pt,Qt={},lr=[],vr=[],yr=typeof window=="undefined"?1:window.devicePixelRatio,Cr=!1,Tr=function(Sr){Sr&&he.raise(Sr)},Ur=function(){};if(typeof ve=="string"?(he(typeof document!="undefined","selector queries only supported in DOM environments"),Be=document.querySelector(ve),he(Be,"invalid query string for element")):typeof ve=="object"?ba(ve)?Be=ve:G(ve)?(Pt=ve,ar=Pt.canvas):(he.constructor(ve),"gl"in ve?Pt=ve.gl:"canvas"in ve?ar=ae(ve.canvas):"container"in ve&&(It=ae(ve.container)),"attributes"in ve&&(Qt=ve.attributes,he.type(Qt,"object","invalid context attributes")),"extensions"in ve&&(lr=ee(ve.extensions)),"optionalExtensions"in ve&&(vr=ee(ve.optionalExtensions)),"onDone"in ve&&(he.type(ve.onDone,"function","invalid or missing onDone callback"),Tr=ve.onDone),"profile"in ve&&(Cr=!!ve.profile),"pixelRatio"in ve&&(yr=+ve.pixelRatio,he(yr>0,"invalid pixel ratio"))):he.raise("invalid arguments to regl"),Be&&(Be.nodeName.toLowerCase()==="canvas"?ar=Be:It=Be),!Pt){if(!ar){he(typeof document!="undefined","must manually specify webgl context outside of DOM environments");var gr=Zo(It||document.body,Tr,yr);if(!gr)return null;ar=gr.canvas,Ur=gr.onDestroy}Qt.premultipliedAlpha===void 0&&(Qt.premultipliedAlpha=!0),Pt=Fa(ar,Qt)}return Pt?{gl:Pt,canvas:ar,container:It,extensions:lr,optionalExtensions:vr,pixelRatio:yr,profile:Cr,onDone:Tr,onDestroy:Ur}:(Ur(),Tr("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function Pe(B,ve){var Be={};function It(lr){he.type(lr,"string","extension name must be string");var vr=lr.toLowerCase(),yr;try{yr=Be[vr]=ar(lr)}catch(Cr){}return!!yr}function ar(lr){return B.getExtension(lr)?B.getExtension(lr):B.getExtension(lr.toLowerCase())?B.getExtension(lr.toLowerCase()):null}for(var Pt=0;Pt<ve.extensions.length;++Pt){var Qt=ve.extensions[Pt];if(!It(Qt))return ve.onDestroy(),ve.onDone('"'+Qt+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return ve.optionalExtensions.forEach(It),{extensions:Be,restore:function(){Object.keys(Be).forEach(function(lr){if(Be[lr]&&!It(lr))throw new Error("(regl): error restoring extension "+lr)})}}}function Ge(B,ve){for(var Be=Array(B),It=0;It<B;++It)Be[It]=ve(It);return Be}var tt=5120,ce=5121,Re=5122,mt=5123,hr=5124,Ot=5125,Ft=5126;function pr(B){for(var ve=16;ve<=1<<28;ve*=16)if(B<=ve)return ve;return 0}function gn(B){var ve,Be;return ve=(B>65535)<<4,B>>>=ve,Be=(B>255)<<3,B>>>=Be,ve|=Be,Be=(B>15)<<2,B>>>=Be,ve|=Be,Be=(B>3)<<1,B>>>=Be,ve|=Be,ve|B>>1}function un(){var B=Ge(8,function(){return[]});function ve(Pt){var Qt=pr(Pt),lr=B[gn(Qt)>>2];return lr.length>0?lr.pop():new ArrayBuffer(Qt)}function Be(Pt){B[gn(Pt.byteLength)>>2].push(Pt)}function It(Pt,Qt){var lr=null;switch(Pt){case tt:lr=new Int8Array(ve(Qt),0,Qt);break;case ce:lr=new Uint8Array(ve(Qt),0,Qt);break;case Re:lr=new Int16Array(ve(2*Qt),0,Qt);break;case mt:lr=new Uint16Array(ve(2*Qt),0,Qt);break;case hr:lr=new Int32Array(ve(4*Qt),0,Qt);break;case Ot:lr=new Uint32Array(ve(4*Qt),0,Qt);break;case Ft:lr=new Float32Array(ve(4*Qt),0,Qt);break;default:return null}return lr.length!==Qt?lr.subarray(0,Qt):lr}function ar(Pt){Be(Pt.buffer)}return{alloc:ve,free:Be,allocType:It,freeType:ar}}var Tt=un();Tt.zero=un();var Jr=3408,Dr=3410,Gr=3411,vi=3412,Qr=3413,An=3414,Wi=3415,di=33901,Ti=33902,_i=3379,Ct=3386,qt=34921,Aa=36347,Ei=36348,Ai=35661,Bi=35660,Yr=34930,wn=36349,zt=34076,aa=34024,be=7936,Ko=7937,ea=7938,hu=35724,Na=34047,Ma=36063,Wa=34852,oa=3553,Eo=34067,Vo=34069,bu=33984,co=6408,Ro=5126,sa=5121,Xa=36160,Lo=36053,Ya=36064,Ps=16384,Cl=function(B,ve){var Be=1;ve.ext_texture_filter_anisotropic&&(Be=B.getParameter(Na));var It=1,ar=1;ve.webgl_draw_buffers&&(It=B.getParameter(Wa),ar=B.getParameter(Ma));var Pt=!!ve.oes_texture_float;if(Pt){var Qt=B.createTexture();B.bindTexture(oa,Qt),B.texImage2D(oa,0,co,1,1,0,co,Ro,null);var lr=B.createFramebuffer();if(B.bindFramebuffer(Xa,lr),B.framebufferTexture2D(Xa,Ya,oa,Qt,0),B.bindTexture(oa,null),B.checkFramebufferStatus(Xa)!==Lo)Pt=!1;else{B.viewport(0,0,1,1),B.clearColor(1,0,0,1),B.clear(Ps);var vr=Tt.allocType(Ro,4);B.readPixels(0,0,1,1,co,Ro,vr),B.getError()?Pt=!1:(B.deleteFramebuffer(lr),B.deleteTexture(Qt),Pt=vr[0]===1),Tt.freeType(vr)}}var yr=typeof navigator!="undefined"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),Cr=!0;if(!yr){var Tr=B.createTexture(),Ur=Tt.allocType(sa,36);B.activeTexture(bu),B.bindTexture(Eo,Tr),B.texImage2D(Vo,0,co,3,3,0,co,sa,Ur),Tt.freeType(Ur),B.bindTexture(Eo,null),B.deleteTexture(Tr),Cr=!B.getError()}return{colorBits:[B.getParameter(Dr),B.getParameter(Gr),B.getParameter(vi),B.getParameter(Qr)],depthBits:B.getParameter(An),stencilBits:B.getParameter(Wi),subpixelBits:B.getParameter(Jr),extensions:Object.keys(ve).filter(function(gr){return!!ve[gr]}),maxAnisotropic:Be,maxDrawbuffers:It,maxColorAttachments:ar,pointSizeDims:B.getParameter(di),lineWidthDims:B.getParameter(Ti),maxViewportDims:B.getParameter(Ct),maxCombinedTextureUnits:B.getParameter(Ai),maxCubeMapSize:B.getParameter(zt),maxRenderbufferSize:B.getParameter(aa),maxTextureUnits:B.getParameter(Yr),maxTextureSize:B.getParameter(_i),maxAttributes:B.getParameter(qt),maxVertexUniforms:B.getParameter(Aa),maxVertexTextureUnits:B.getParameter(Bi),maxVaryingVectors:B.getParameter(Ei),maxFragmentUniforms:B.getParameter(wn),glsl:B.getParameter(hu),renderer:B.getParameter(Ko),vendor:B.getParameter(be),version:B.getParameter(ea),readFloat:Pt,npotTextureCube:Cr}};function ps(B){return!!B&&typeof B=="object"&&Array.isArray(B.shape)&&Array.isArray(B.stride)&&typeof B.offset=="number"&&B.shape.length===B.stride.length&&(Array.isArray(B.data)||j(B.data))}var ie=function(B){return Object.keys(B).map(function(ve){return B[ve]})},xe={shape:eo,flatten:Mi};function Ke(B,ve,Be){for(var It=0;It<ve;++It)Be[It]=B[It]}function Mt(B,ve,Be,It){for(var ar=0,Pt=0;Pt<ve;++Pt)for(var Qt=B[Pt],lr=0;lr<Be;++lr)It[ar++]=Qt[lr]}function Pr(B,ve,Be,It,ar,Pt){for(var Qt=Pt,lr=0;lr<ve;++lr)for(var vr=B[lr],yr=0;yr<Be;++yr)for(var Cr=vr[yr],Tr=0;Tr<It;++Tr)ar[Qt++]=Cr[Tr]}function Tn(B,ve,Be,It,ar){for(var Pt=1,Qt=Be+1;Qt<ve.length;++Qt)Pt*=ve[Qt];var lr=ve[Be];if(ve.length-Be==4){var vr=ve[Be+1],yr=ve[Be+2],Cr=ve[Be+3];for(Qt=0;Qt<lr;++Qt)Pr(B[Qt],vr,yr,Cr,It,ar),ar+=Pt}else for(Qt=0;Qt<lr;++Qt)Tn(B[Qt],ve,Be+1,It,ar),ar+=Pt}function Mi(B,ve,Be,It){var ar=1;if(ve.length)for(var Pt=0;Pt<ve.length;++Pt)ar*=ve[Pt];else ar=0;var Qt=It||Tt.allocType(Be,ar);switch(ve.length){case 0:break;case 1:Ke(B,ve[0],Qt);break;case 2:Mt(B,ve[0],ve[1],Qt);break;case 3:Pr(B,ve[0],ve[1],ve[2],Qt,0);break;default:Tn(B,ve,0,Qt,0)}return Qt}function eo(B){for(var ve=[],Be=B;Be.length;Be=Be[0])ve.push(Be.length);return ve}var La={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Ba=5120,jo=5122,ds=5124,ao=5121,So=5123,vs=5125,Is=5126,ks=5126,$s={int8:Ba,int16:jo,int32:ds,uint8:ao,uint16:So,uint32:vs,float:Is,float32:ks},ms=35048,ga=35040,_a={dynamic:ms,stream:ga,static:35044},ns=xe.flatten,Jc=xe.shape,Tl=35044,Zs=35040,nc=5121,Gu=5126,Vs=[];Vs[5120]=1,Vs[5122]=2,Vs[5124]=4,Vs[5121]=1,Vs[5123]=2,Vs[5125]=4,Vs[5126]=4;function ul(B){return La[Object.prototype.toString.call(B)]|0}function y(B,ve){for(var Be=0;Be<ve.length;++Be)B[Be]=ve[Be]}function T(B,ve,Be,It,ar,Pt,Qt){for(var lr=0,vr=0;vr<Be;++vr)for(var yr=0;yr<It;++yr)B[lr++]=ve[ar*vr+Pt*yr+Qt]}function N(B,ve,Be,It){var ar=0,Pt={};function Qt(ut){this.id=ar++,this.buffer=B.createBuffer(),this.type=ut,this.usage=Tl,this.byteLength=0,this.dimension=1,this.dtype=nc,this.persistentData=null,Be.profile&&(this.stats={size:0})}Qt.prototype.bind=function(){B.bindBuffer(this.type,this.buffer)},Qt.prototype.destroy=function(){Ur(this)};var lr=[];function vr(ut,jt){var _r=lr.pop();return _r||(_r=new Qt(ut)),_r.bind(),Tr(_r,jt,Zs,0,1,!1),_r}function yr(ut){lr.push(ut)}function Cr(ut,jt,_r){ut.byteLength=jt.byteLength,B.bufferData(ut.type,jt,_r)}function Tr(ut,jt,_r,kr,ur,Rr){var qr;if(ut.usage=_r,Array.isArray(jt)){if(ut.dtype=kr||Gu,jt.length>0){var Nn;if(Array.isArray(jt[0])){qr=Jc(jt);for(var er=1,rr=1;rr<qr.length;++rr)er*=qr[rr];ut.dimension=er,Nn=ns(jt,qr,ut.dtype),Cr(ut,Nn,_r),Rr?ut.persistentData=Nn:Tt.freeType(Nn)}else if(typeof jt[0]=="number"){ut.dimension=ur;var mn=Tt.allocType(ut.dtype,jt.length);y(mn,jt),Cr(ut,mn,_r),Rr?ut.persistentData=mn:Tt.freeType(mn)}else j(jt[0])?(ut.dimension=jt[0].length,ut.dtype=kr||ul(jt[0])||Gu,Nn=ns(jt,[jt.length,jt[0].length],ut.dtype),Cr(ut,Nn,_r),Rr?ut.persistentData=Nn:Tt.freeType(Nn)):he.raise("invalid buffer data")}}else if(j(jt))ut.dtype=kr||ul(jt),ut.dimension=ur,Cr(ut,jt,_r),Rr&&(ut.persistentData=new Uint8Array(new Uint8Array(jt.buffer)));else if(ps(jt)){qr=jt.shape;var Hr=jt.stride,xr=jt.offset,Wr=0,Kr=0,gi=0,ei=0;qr.length===1?(Wr=qr[0],Kr=1,gi=Hr[0],ei=0):qr.length===2?(Wr=qr[0],Kr=qr[1],gi=Hr[0],ei=Hr[1]):he.raise("invalid shape"),ut.dtype=kr||ul(jt.data)||Gu,ut.dimension=Kr;var Xr=Tt.allocType(ut.dtype,Wr*Kr);T(Xr,jt.data,Wr,Kr,gi,ei,xr),Cr(ut,Xr,_r),Rr?ut.persistentData=Xr:Tt.freeType(Xr)}else jt instanceof ArrayBuffer?(ut.dtype=nc,ut.dimension=ur,Cr(ut,jt,_r),Rr&&(ut.persistentData=new Uint8Array(new Uint8Array(jt)))):he.raise("invalid buffer data")}function Ur(ut){ve.bufferCount--,It(ut);var jt=ut.buffer;he(jt,"buffer must not be deleted already"),B.deleteBuffer(jt),ut.buffer=null,delete Pt[ut.id]}function gr(ut,jt,_r,kr){ve.bufferCount++;var ur=new Qt(jt);Pt[ur.id]=ur;function Rr(er){var rr=Tl,mn=null,Hr=0,xr=0,Wr=1;return Array.isArray(er)||j(er)||ps(er)||er instanceof ArrayBuffer?mn=er:typeof er=="number"?Hr=er|0:er&&(he.type(er,"object","buffer arguments must be an object, a number or an array"),"data"in er&&(he(mn===null||Array.isArray(mn)||j(mn)||ps(mn),"invalid data for buffer"),mn=er.data),"usage"in er&&(he.parameter(er.usage,_a,"invalid buffer usage"),rr=_a[er.usage]),"type"in er&&(he.parameter(er.type,$s,"invalid buffer type"),xr=$s[er.type]),"dimension"in er&&(he.type(er.dimension,"number","invalid dimension"),Wr=er.dimension|0),"length"in er&&(he.nni(Hr,"buffer length must be a nonnegative integer"),Hr=er.length|0)),ur.bind(),mn?Tr(ur,mn,rr,xr,Wr,kr):(Hr&&B.bufferData(ur.type,Hr,rr),ur.dtype=xr||nc,ur.usage=rr,ur.dimension=Wr,ur.byteLength=Hr),Be.profile&&(ur.stats.size=ur.byteLength*Vs[ur.dtype]),Rr}function qr(er,rr){he(rr+er.byteLength<=ur.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+er.byteLength+" starting from offset "+rr+" to a buffer of size "+ur.byteLength),B.bufferSubData(ur.type,rr,er)}function Nn(er,rr){var mn=(rr||0)|0,Hr;if(ur.bind(),j(er)||er instanceof ArrayBuffer)qr(er,mn);else if(Array.isArray(er)){if(er.length>0)if(typeof er[0]=="number"){var xr=Tt.allocType(ur.dtype,er.length);y(xr,er),qr(xr,mn),Tt.freeType(xr)}else if(Array.isArray(er[0])||j(er[0])){Hr=Jc(er);var Wr=ns(er,Hr,ur.dtype);qr(Wr,mn),Tt.freeType(Wr)}else he.raise("invalid buffer data")}else if(ps(er)){Hr=er.shape;var Kr=er.stride,gi=0,ei=0,Xr=0,rn=0;Hr.length===1?(gi=Hr[0],ei=1,Xr=Kr[0],rn=0):Hr.length===2?(gi=Hr[0],ei=Hr[1],Xr=Kr[0],rn=Kr[1]):he.raise("invalid shape");var $n=Array.isArray(er.data)?ur.dtype:ul(er.data),ui=Tt.allocType($n,gi*ei);T(ui,er.data,gi,ei,Xr,rn,er.offset),qr(ui,mn),Tt.freeType(ui)}else he.raise("invalid data for buffer subdata");return Rr}return _r||Rr(ut),Rr._reglType="buffer",Rr._buffer=ur,Rr.subdata=Nn,Be.profile&&(Rr.stats=ur.stats),Rr.destroy=function(){Ur(ur)},Rr}function Sr(){ie(Pt).forEach(function(ut){ut.buffer=B.createBuffer(),B.bindBuffer(ut.type,ut.buffer),B.bufferData(ut.type,ut.persistentData||ut.byteLength,ut.usage)})}return Be.profile&&(ve.getTotalBufferSize=function(){var ut=0;return Object.keys(Pt).forEach(function(jt){ut+=Pt[jt].stats.size}),ut}),{create:gr,createStream:vr,destroyStream:yr,clear:function(){ie(Pt).forEach(Ur),lr.forEach(Ur)},getBuffer:function(ut){return ut&&ut._buffer instanceof Qt?ut._buffer:null},restore:Sr,_initBuffer:Tr}}var O=0,$=0,_e=1,Xe=1,ht=4,dt=4,ir={points:O,point:$,lines:_e,line:Xe,triangles:ht,triangle:dt,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},sr=0,Cn=1,ni=4,In=5120,Xi=5121,va=5122,wa=5123,ji=5124,gs=5125,Js=34963,Hu=35040,Qc=35044;function ll(B,ve,Be,It){var ar={},Pt=0,Qt={uint8:Xi,uint16:wa};ve.oes_element_index_uint&&(Qt.uint32=gs);function lr(Sr){this.id=Pt++,ar[this.id]=this,this.buffer=Sr,this.primType=ni,this.vertCount=0,this.type=0}lr.prototype.bind=function(){this.buffer.bind()};var vr=[];function yr(Sr){var ut=vr.pop();return ut||(ut=new lr(Be.create(null,Js,!0,!1)._buffer)),Tr(ut,Sr,Hu,-1,-1,0,0),ut}function Cr(Sr){vr.push(Sr)}function Tr(Sr,ut,jt,_r,kr,ur,Rr){Sr.buffer.bind();var qr;if(ut){var Nn=Rr;!Rr&&(!j(ut)||ps(ut)&&!j(ut.data))&&(Nn=ve.oes_element_index_uint?gs:wa),Be._initBuffer(Sr.buffer,ut,jt,Nn,3)}else B.bufferData(Js,ur,jt),Sr.buffer.dtype=qr||Xi,Sr.buffer.usage=jt,Sr.buffer.dimension=3,Sr.buffer.byteLength=ur;if(qr=Rr,!Rr){switch(Sr.buffer.dtype){case Xi:case In:qr=Xi;break;case wa:case va:qr=wa;break;case gs:case ji:qr=gs;break;default:he.raise("unsupported type for element array")}Sr.buffer.dtype=qr}Sr.type=qr,he(qr!==gs||!!ve.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var er=kr;er<0&&(er=Sr.buffer.byteLength,qr===wa?er>>=1:qr===gs&&(er>>=2)),Sr.vertCount=er;var rr=_r;if(_r<0){rr=ni;var mn=Sr.buffer.dimension;mn===1&&(rr=sr),mn===2&&(rr=Cn),mn===3&&(rr=ni)}Sr.primType=rr}function Ur(Sr){It.elementsCount--,he(Sr.buffer!==null,"must not double destroy elements"),delete ar[Sr.id],Sr.buffer.destroy(),Sr.buffer=null}function gr(Sr,ut){var jt=Be.create(null,Js,!0),_r=new lr(jt._buffer);It.elementsCount++;function kr(ur){if(!ur)jt(),_r.primType=ni,_r.vertCount=0,_r.type=Xi;else if(typeof ur=="number")jt(ur),_r.primType=ni,_r.vertCount=ur|0,_r.type=Xi;else{var Rr=null,qr=Qc,Nn=-1,er=-1,rr=0,mn=0;Array.isArray(ur)||j(ur)||ps(ur)?Rr=ur:(he.type(ur,"object","invalid arguments for elements"),"data"in ur&&(Rr=ur.data,he(Array.isArray(Rr)||j(Rr)||ps(Rr),"invalid data for element buffer")),"usage"in ur&&(he.parameter(ur.usage,_a,"invalid element buffer usage"),qr=_a[ur.usage]),"primitive"in ur&&(he.parameter(ur.primitive,ir,"invalid element buffer primitive"),Nn=ir[ur.primitive]),"count"in ur&&(he(typeof ur.count=="number"&&ur.count>=0,"invalid vertex count for elements"),er=ur.count|0),"type"in ur&&(he.parameter(ur.type,Qt,"invalid buffer type"),mn=Qt[ur.type]),"length"in ur?rr=ur.length|0:(rr=er,mn===wa||mn===va?rr*=2:(mn===gs||mn===ji)&&(rr*=4))),Tr(_r,Rr,qr,Nn,er,rr,mn)}return kr}return kr(Sr),kr._reglType="elements",kr._elements=_r,kr.subdata=function(ur,Rr){return jt.subdata(ur,Rr),kr},kr.destroy=function(){Ur(_r)},kr}return{create:gr,createStream:yr,destroyStream:Cr,getElements:function(Sr){return typeof Sr=="function"&&Sr._elements instanceof lr?Sr._elements:null},clear:function(){ie(ar).forEach(Ur)}}}var Oc=new Float32Array(1),Eu=new Uint32Array(Oc.buffer),Su=5123;function wu(B){for(var ve=Tt.allocType(Su,B.length),Be=0;Be<B.length;++Be)if(isNaN(B[Be]))ve[Be]=65535;else if(B[Be]===Infinity)ve[Be]=31744;else if(B[Be]===-Infinity)ve[Be]=64512;else{Oc[0]=B[Be];var It=Eu[0],ar=It>>>31<<15,Pt=(It<<1>>>24)-127,Qt=It>>13&(1<<10)-1;if(Pt<-24)ve[Be]=ar;else if(Pt<-14){var lr=-14-Pt;ve[Be]=ar+(Qt+(1<<10)>>lr)}else Pt>15?ve[Be]=ar+31744:ve[Be]=ar+(Pt+15<<10)+Qt}return ve}function oo(B){return Array.isArray(B)||j(B)}var Bf=function(B){return!(B&B-1)&&!!B},zf=34467,$o=3553,Rc=34067,Cu=34069,Qs=6408,ef=6406,Al=6407,Di=6409,Ml=6410,gh=32854,cl=32855,Lc=36194,Uf=32819,yh=32820,Zf=33635,kc=34042,ic=6402,ac=34041,Pl=35904,fl=35906,Il=36193,Wu=33776,js=33777,tf=33778,rf=33779,Vf=35986,eu=35987,oc=34798,Dc=35840,nf=35841,Ol=35842,Jh=35843,af=36196,Rl=5121,of=5123,sf=5125,Ll=5126,Fc=10242,_h=10243,xh=10497,sc=33071,bh=33648,kl=10240,$i=10241,uc=9728,fa=9729,Tu=9984,Yi=9985,Pa=9986,ys=9987,Nc=33170,Xu=4352,za=4353,lc=4354,Dl=34046,Yu=3317,Bc=37440,Au=37441,fo=37443,Fl=37444,cc=33984,ho=[Tu,Pa,Yi,ys],pn=[0,Di,Ml,Al,Qs],so={};so[Di]=so[ef]=so[ic]=1,so[ac]=so[Ml]=2,so[Al]=so[Pl]=3,so[Qs]=so[fl]=4;function qu(B){return"[object "+B+"]"}var ka=qu("HTMLCanvasElement"),Gs=qu("OffscreenCanvas"),Os=qu("CanvasRenderingContext2D"),uf=qu("ImageBitmap"),zr=qu("HTMLImageElement"),fc=qu("HTMLVideoElement"),lf=Object.keys(La).concat([ka,Gs,Os,uf,zr,fc]),hl=[];hl[Rl]=1,hl[Ll]=4,hl[Il]=2,hl[of]=2,hl[sf]=4;var Ca=[];Ca[gh]=2,Ca[cl]=2,Ca[Lc]=2,Ca[ac]=4,Ca[Wu]=.5,Ca[js]=.5,Ca[tf]=1,Ca[rf]=1,Ca[Vf]=.5,Ca[eu]=1,Ca[oc]=1,Ca[Dc]=.5,Ca[nf]=.25,Ca[Ol]=.5,Ca[Jh]=.25,Ca[af]=.5;function _s(B){return Array.isArray(B)&&(B.length===0||typeof B[0]=="number")}function cf(B){if(!Array.isArray(B))return!1;var ve=B.length;return!(ve===0||!oo(B[0]))}function Mu(B){return Object.prototype.toString.call(B)}function Ds(B){return Mu(B)===ka}function Pu(B){return Mu(B)===Gs}function jf(B){return Mu(B)===Os}function pl(B){return Mu(B)===uf}function Gf(B){return Mu(B)===zr}function ff(B){return Mu(B)===fc}function tu(B){var ve=typeof my!="undefined"&&!!my&&typeof my.showToast=="function";return!!(ve&&B&&B.getContext)}function Rs(B){var ve=typeof my!="undefined"&&!!my&&typeof my.showToast=="function";return!!(ve&&B&&"src"in B&&"crossOrigin"in B)}function Si(B){if(!B)return!1;if(tu(B)||Rs(B))return!0;var ve=Mu(B);return lf.indexOf(ve)>=0?!0:_s(B)||cf(B)||ps(B)}function Iu(B){return La[Object.prototype.toString.call(B)]|0}function ru(B,ve){var Be=ve.length;switch(B.type){case Rl:case of:case sf:case Ll:var It=Tt.allocType(B.type,Be);It.set(ve),B.data=It;break;case Il:B.data=wu(ve);break;default:he.raise("unsupported texture type, must specify a typed array")}}function Go(B,ve){return Tt.allocType(B.type===Il?Ll:B.type,ve)}function dl(B,ve){B.type===Il?(B.data=wu(ve),Tt.freeType(ve)):B.data=ve}function Fs(B,ve,Be,It,ar,Pt){for(var Qt=B.width,lr=B.height,vr=B.channels,yr=Qt*lr*vr,Cr=Go(B,yr),Tr=0,Ur=0;Ur<lr;++Ur)for(var gr=0;gr<Qt;++gr)for(var Sr=0;Sr<vr;++Sr)Cr[Tr++]=ve[Be*gr+It*Ur+ar*Sr+Pt];dl(B,Cr)}function Hs(B,ve,Be,It,ar,Pt){var Qt;if(typeof Ca[B]!="undefined"?Qt=Ca[B]:Qt=so[B]*hl[ve],Pt&&(Qt*=6),ar){for(var lr=0,vr=Be;vr>=1;)lr+=Qt*vr*vr,vr/=2;return lr}else return Qt*Be*It}function xs(B,ve,Be,It,ar,Pt,Qt){var lr={"don't care":Xu,"dont care":Xu,nice:lc,fast:za},vr={repeat:xh,clamp:sc,mirror:bh},yr={nearest:uc,linear:fa},Cr=v({mipmap:ys,"nearest mipmap nearest":Tu,"linear mipmap nearest":Yi,"nearest mipmap linear":Pa,"linear mipmap linear":ys},yr),Tr={none:0,browser:Fl},Ur={uint8:Rl,rgba4:Uf,rgb565:Zf,"rgb5 a1":yh},gr={alpha:ef,luminance:Di,"luminance alpha":Ml,rgb:Al,rgba:Qs,rgba4:gh,"rgb5 a1":cl,rgb565:Lc},Sr={};ve.ext_srgb&&(gr.srgb=Pl,gr.srgba=fl),ve.oes_texture_float&&(Ur.float32=Ur.float=Ll),ve.oes_texture_half_float&&(Ur.float16=Ur["half float"]=Il),ve.webgl_depth_texture&&(v(gr,{depth:ic,"depth stencil":ac}),v(Ur,{uint16:of,uint32:sf,"depth stencil":kc})),ve.webgl_compressed_texture_s3tc&&v(Sr,{"rgb s3tc dxt1":Wu,"rgba s3tc dxt1":js,"rgba s3tc dxt3":tf,"rgba s3tc dxt5":rf}),ve.webgl_compressed_texture_atc&&v(Sr,{"rgb atc":Vf,"rgba atc explicit alpha":eu,"rgba atc interpolated alpha":oc}),ve.webgl_compressed_texture_pvrtc&&v(Sr,{"rgb pvrtc 4bppv1":Dc,"rgb pvrtc 2bppv1":nf,"rgba pvrtc 4bppv1":Ol,"rgba pvrtc 2bppv1":Jh}),ve.webgl_compressed_texture_etc1&&(Sr["rgb etc1"]=af);var ut=Array.prototype.slice.call(B.getParameter(zf)||new Uint32Array(0));Object.keys(Sr).forEach(function(Ae){var Bt=Sr[Ae];ut.indexOf(Bt)>=0&&(gr[Ae]=Bt)});var jt=Object.keys(gr);Be.textureFormats=jt;var _r=[];Object.keys(gr).forEach(function(Ae){var Bt=gr[Ae];_r[Bt]=Ae});var kr=[];Object.keys(Ur).forEach(function(Ae){var Bt=Ur[Ae];kr[Bt]=Ae});var ur=[];Object.keys(yr).forEach(function(Ae){var Bt=yr[Ae];ur[Bt]=Ae});var Rr=[];Object.keys(Cr).forEach(function(Ae){var Bt=Cr[Ae];Rr[Bt]=Ae});var qr=[];Object.keys(vr).forEach(function(Ae){var Bt=vr[Ae];qr[Bt]=Ae});var Nn=jt.reduce(function(Ae,Bt){var St=gr[Bt];return St===Di||St===ef||St===Di||St===Ml||St===ic||St===ac||ve.ext_srgb&&(St===Pl||St===fl)?Ae[St]=St:St===cl||Bt.indexOf("rgba")>=0?Ae[St]=Qs:Ae[St]=Al,Ae},{});function er(){this.internalformat=Qs,this.format=Qs,this.type=Rl,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=Fl,this.width=0,this.height=0,this.channels=0}function rr(Ae,Bt){Ae.internalformat=Bt.internalformat,Ae.format=Bt.format,Ae.type=Bt.type,Ae.compressed=Bt.compressed,Ae.premultiplyAlpha=Bt.premultiplyAlpha,Ae.flipY=Bt.flipY,Ae.unpackAlignment=Bt.unpackAlignment,Ae.colorSpace=Bt.colorSpace,Ae.width=Bt.width,Ae.height=Bt.height,Ae.channels=Bt.channels}function mn(Ae,Bt){if(!(typeof Bt!="object"||!Bt)){if("premultiplyAlpha"in Bt&&(he.type(Bt.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),Ae.premultiplyAlpha=Bt.premultiplyAlpha),"flipY"in Bt&&(he.type(Bt.flipY,"boolean","invalid texture flip"),Ae.flipY=Bt.flipY),"alignment"in Bt&&(he.oneOf(Bt.alignment,[1,2,4,8],"invalid texture unpack alignment"),Ae.unpackAlignment=Bt.alignment),"colorSpace"in Bt&&(he.parameter(Bt.colorSpace,Tr,"invalid colorSpace"),Ae.colorSpace=Tr[Bt.colorSpace]),"type"in Bt){var St=Bt.type;he(ve.oes_texture_float||!(St==="float"||St==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),he(ve.oes_texture_half_float||!(St==="half float"||St==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),he(ve.webgl_depth_texture||!(St==="uint16"||St==="uint32"||St==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),he.parameter(St,Ur,"invalid texture type"),Ae.type=Ur[St]}var fn=Ae.width,Gi=Ae.height,Ee=Ae.channels,ue=!1;"shape"in Bt?(he(Array.isArray(Bt.shape)&&Bt.shape.length>=2,"shape must be an array"),fn=Bt.shape[0],Gi=Bt.shape[1],Bt.shape.length===3&&(Ee=Bt.shape[2],he(Ee>0&&Ee<=4,"invalid number of channels"),ue=!0),he(fn>=0&&fn<=Be.maxTextureSize,"invalid width"),he(Gi>=0&&Gi<=Be.maxTextureSize,"invalid height")):("radius"in Bt&&(fn=Gi=Bt.radius,he(fn>=0&&fn<=Be.maxTextureSize,"invalid radius")),"width"in Bt&&(fn=Bt.width,he(fn>=0&&fn<=Be.maxTextureSize,"invalid width")),"height"in Bt&&(Gi=Bt.height,he(Gi>=0&&Gi<=Be.maxTextureSize,"invalid height")),"channels"in Bt&&(Ee=Bt.channels,he(Ee>0&&Ee<=4,"invalid number of channels"),ue=!0)),Ae.width=fn|0,Ae.height=Gi|0,Ae.channels=Ee|0;var je=!1;if("format"in Bt){var ft=Bt.format;he(ve.webgl_depth_texture||!(ft==="depth"||ft==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),he.parameter(ft,gr,"invalid texture format");var At=Ae.internalformat=gr[ft];Ae.format=Nn[At],ft in Ur&&("type"in Bt||(Ae.type=Ur[ft])),ft in Sr&&(Ae.compressed=!0),je=!0}!ue&&je?Ae.channels=so[Ae.format]:ue&&!je?Ae.channels!==pn[Ae.format]&&(Ae.format=Ae.internalformat=pn[Ae.channels]):je&&ue&&he(Ae.channels===so[Ae.format],"number of channels inconsistent with specified format")}}function Hr(Ae){B.pixelStorei(Bc,Ae.flipY),B.pixelStorei(Au,Ae.premultiplyAlpha),B.pixelStorei(fo,Ae.colorSpace),B.pixelStorei(Yu,Ae.unpackAlignment)}function xr(){er.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function Wr(Ae,Bt){var St=null;if(Si(Bt)?St=Bt:Bt&&(he.type(Bt,"object","invalid pixel data type"),mn(Ae,Bt),"x"in Bt&&(Ae.xOffset=Bt.x|0),"y"in Bt&&(Ae.yOffset=Bt.y|0),Si(Bt.data)&&(St=Bt.data)),he(!Ae.compressed||St instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),Bt.copy){he(!St,"can not specify copy and data field for the same texture");var fn=ar.viewportWidth,Gi=ar.viewportHeight;Ae.width=Ae.width||fn-Ae.xOffset,Ae.height=Ae.height||Gi-Ae.yOffset,Ae.needsCopy=!0,he(Ae.xOffset>=0&&Ae.xOffset<fn&&Ae.yOffset>=0&&Ae.yOffset<Gi&&Ae.width>0&&Ae.width<=fn&&Ae.height>0&&Ae.height<=Gi,"copy texture read out of bounds")}else if(!St)Ae.width=Ae.width||1,Ae.height=Ae.height||1,Ae.channels=Ae.channels||4;else if(j(St))Ae.channels=Ae.channels||4,Ae.data=St,!("type"in Bt)&&Ae.type===Rl&&(Ae.type=Iu(St));else if(_s(St))Ae.channels=Ae.channels||4,ru(Ae,St),Ae.alignment=1,Ae.needsFree=!0;else if(ps(St)){var Ee=St.data;!Array.isArray(Ee)&&Ae.type===Rl&&(Ae.type=Iu(Ee));var ue=St.shape,je=St.stride,ft,At,$e,De,rt,ge;ue.length===3?($e=ue[2],ge=je[2]):(he(ue.length===2,"invalid ndarray pixel data, must be 2 or 3D"),$e=1,ge=1),ft=ue[0],At=ue[1],De=je[0],rt=je[1],Ae.alignment=1,Ae.width=ft,Ae.height=At,Ae.channels=$e,Ae.format=Ae.internalformat=pn[$e],Ae.needsFree=!0,Fs(Ae,Ee,De,rt,ge,St.offset)}else if(tu(St)||Ds(St)||Pu(St)||jf(St))tu(St)||Ds(St)||Pu(St)?Ae.element=St:Ae.element=St.canvas,Ae.width=Ae.element.width,Ae.height=Ae.element.height,Ae.channels=4;else if(pl(St))Ae.element=St,Ae.width=St.width,Ae.height=St.height,Ae.channels=4;else if(Gf(St))Ae.element=St,Ae.width=St.naturalWidth,Ae.height=St.naturalHeight,Ae.channels=4;else if(Rs(St))Ae.element=St,Ae.width=St.width,Ae.height=St.height,Ae.channels=4;else if(ff(St))Ae.element=St,Ae.width=St.videoWidth,Ae.height=St.videoHeight,Ae.channels=4;else if(cf(St)){var Ze=Ae.width||St[0].length,Se=Ae.height||St.length,lt=Ae.channels;oo(St[0][0])?lt=lt||St[0][0].length:lt=lt||1;for(var wt=xe.shape(St),fr=1,Nr=0;Nr<wt.length;++Nr)fr*=wt[Nr];var Br=Go(Ae,fr);xe.flatten(St,wt,"",Br),dl(Ae,Br),Ae.alignment=1,Ae.width=Ze,Ae.height=Se,Ae.channels=lt,Ae.format=Ae.internalformat=pn[lt],Ae.needsFree=!0}Ae.type===Ll?he(Be.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):Ae.type===Il&&he(Be.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function Kr(Ae,Bt,St){var fn=Ae.element,Gi=Ae.data,Ee=Ae.internalformat,ue=Ae.format,je=Ae.type,ft=Ae.width,At=Ae.height;Hr(Ae),fn?B.texImage2D(Bt,St,ue,ue,je,fn):Ae.compressed?B.compressedTexImage2D(Bt,St,Ee,ft,At,0,Gi):Ae.needsCopy?(It(),B.copyTexImage2D(Bt,St,ue,Ae.xOffset,Ae.yOffset,ft,At,0)):B.texImage2D(Bt,St,ue,ft,At,0,ue,je,Gi||null)}function gi(Ae,Bt,St,fn,Gi){var Ee=Ae.element,ue=Ae.data,je=Ae.internalformat,ft=Ae.format,At=Ae.type,$e=Ae.width,De=Ae.height;Hr(Ae),Ee?B.texSubImage2D(Bt,Gi,St,fn,ft,At,Ee):Ae.compressed?B.compressedTexSubImage2D(Bt,Gi,St,fn,je,$e,De,ue):Ae.needsCopy?(It(),B.copyTexSubImage2D(Bt,Gi,St,fn,Ae.xOffset,Ae.yOffset,$e,De)):B.texSubImage2D(Bt,Gi,St,fn,$e,De,ft,At,ue)}var ei=[];function Xr(){return ei.pop()||new xr}function rn(Ae){Ae.needsFree&&Tt.freeType(Ae.data),xr.call(Ae),ei.push(Ae)}function $n(){er.call(this),this.genMipmaps=!1,this.mipmapHint=Xu,this.mipmask=0,this.images=Array(16)}function ui(Ae,Bt,St){var fn=Ae.images[0]=Xr();Ae.mipmask=1,fn.width=Ae.width=Bt,fn.height=Ae.height=St,fn.channels=Ae.channels=4}function zi(Ae,Bt){var St=null;if(Si(Bt))St=Ae.images[0]=Xr(),rr(St,Ae),Wr(St,Bt),Ae.mipmask=1;else if(mn(Ae,Bt),Array.isArray(Bt.mipmap))for(var fn=Bt.mipmap,Gi=0;Gi<fn.length;++Gi)St=Ae.images[Gi]=Xr(),rr(St,Ae),St.width>>=Gi,St.height>>=Gi,Wr(St,fn[Gi]),Ae.mipmask|=1<<Gi;else St=Ae.images[0]=Xr(),rr(St,Ae),Wr(St,Bt),Ae.mipmask=1;rr(Ae,Ae.images[0]),Ae.compressed&&(Ae.internalformat===Wu||Ae.internalformat===js||Ae.internalformat===tf||Ae.internalformat===rf)&&he(Ae.width%4==0&&Ae.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function qa(Ae,Bt){for(var St=Ae.images,fn=0;fn<St.length;++fn){if(!St[fn])return;Kr(St[fn],Bt,fn)}}var no=[];function ki(){var Ae=no.pop()||new $n;er.call(Ae),Ae.mipmask=0;for(var Bt=0;Bt<16;++Bt)Ae.images[Bt]=null;return Ae}function No(Ae){for(var Bt=Ae.images,St=0;St<Bt.length;++St)Bt[St]&&rn(Bt[St]),Bt[St]=null;no.push(Ae)}function Va(){this.minFilter=uc,this.magFilter=uc,this.wrapS=sc,this.wrapT=sc,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=Xu}function Ho(Ae,Bt){if("min"in Bt){var St=Bt.min;he.parameter(St,Cr),Ae.minFilter=Cr[St],ho.indexOf(Ae.minFilter)>=0&&!("faces"in Bt)&&(Ae.genMipmaps=!0)}if("mag"in Bt){var fn=Bt.mag;he.parameter(fn,yr),Ae.magFilter=yr[fn]}var Gi=Ae.wrapS,Ee=Ae.wrapT;if("wrap"in Bt){var ue=Bt.wrap;typeof ue=="string"?(he.parameter(ue,vr),Gi=Ee=vr[ue]):Array.isArray(ue)&&(he.parameter(ue[0],vr),he.parameter(ue[1],vr),Gi=vr[ue[0]],Ee=vr[ue[1]])}else{if("wrapS"in Bt){var je=Bt.wrapS;he.parameter(je,vr),Gi=vr[je]}if("wrapT"in Bt){var ft=Bt.wrapT;he.parameter(ft,vr),Ee=vr[ft]}}if(Ae.wrapS=Gi,Ae.wrapT=Ee,"anisotropic"in Bt){var At=Bt.anisotropic;he(typeof At=="number"&&At>=1&&At<=Be.maxAnisotropic,"aniso samples must be between 1 and "),Ae.anisotropic=Bt.anisotropic}if("mipmap"in Bt){var $e=!1;switch(typeof Bt.mipmap){case"string":he.parameter(Bt.mipmap,lr,"invalid mipmap hint"),Ae.mipmapHint=lr[Bt.mipmap],Ae.genMipmaps=!0,$e=!0;break;case"boolean":$e=Ae.genMipmaps=Bt.mipmap;break;case"object":he(Array.isArray(Bt.mipmap),"invalid mipmap type"),Ae.genMipmaps=!1,$e=!0;break;default:he.raise("invalid mipmap type")}$e&&!("min"in Bt)&&(Ae.minFilter=Tu)}}function yo(Ae,Bt){B.texParameteri(Bt,$i,Ae.minFilter),B.texParameteri(Bt,kl,Ae.magFilter),B.texParameteri(Bt,Fc,Ae.wrapS),B.texParameteri(Bt,_h,Ae.wrapT),ve.ext_texture_filter_anisotropic&&B.texParameteri(Bt,Dl,Ae.anisotropic),Ae.genMipmaps&&(B.hint(Nc,Ae.mipmapHint),B.generateMipmap(Bt))}var Bn=0,Ln={},ts=Be.maxTextureUnits,po=Array(ts).map(function(){return null});function xi(Ae){er.call(this),this.mipmask=0,this.internalformat=Qs,this.id=Bn++,this.refCount=1,this.target=Ae,this.texture=B.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new Va,Qt.profile&&(this.stats={size:0})}function Wo(Ae){B.activeTexture(cc),B.bindTexture(Ae.target,Ae.texture)}function ua(){var Ae=po[0];Ae?B.bindTexture(Ae.target,Ae.texture):B.bindTexture($o,null)}function us(Ae){var Bt=Ae.texture;he(Bt,"must not double destroy texture");var St=Ae.unit,fn=Ae.target;St>=0&&(B.activeTexture(cc+St),B.bindTexture(fn,null),po[St]=null),B.deleteTexture(Bt),Ae.texture=null,Ae.params=null,Ae.pixels=null,Ae.refCount=0,delete Ln[Ae.id],Pt.textureCount--}v(xi.prototype,{bind:function(){var Ae=this;Ae.bindCount+=1;var Bt=Ae.unit;if(Bt<0){for(var St=0;St<ts;++St){var fn=po[St];if(fn){if(fn.bindCount>0)continue;fn.unit=-1}po[St]=Ae,Bt=St;break}Bt>=ts&&he.raise("insufficient number of texture units"),Qt.profile&&Pt.maxTextureUnits<Bt+1&&(Pt.maxTextureUnits=Bt+1),Ae.unit=Bt,B.activeTexture(cc+Bt),B.bindTexture(Ae.target,Ae.texture)}return Bt},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&us(this)}});function ai(Ae,Bt){var St=new xi($o);Ln[St.id]=St,Pt.textureCount++;function fn(ue,je){var ft=St.texInfo;Va.call(ft);var At=ki();return typeof ue=="number"?typeof je=="number"?ui(At,ue|0,je|0):ui(At,ue|0,ue|0):ue?(he.type(ue,"object","invalid arguments to regl.texture"),Ho(ft,ue),zi(At,ue)):ui(At,1,1),ft.genMipmaps&&(At.mipmask=(At.width<<1)-1),St.mipmask=At.mipmask,rr(St,At),he.texture2D(ft,At,Be),St.internalformat=At.internalformat,fn.width=At.width,fn.height=At.height,Wo(St),qa(At,$o),yo(ft,$o),ua(),No(At),Qt.profile&&(St.stats.size=Hs(St.internalformat,St.type,At.width,At.height,ft.genMipmaps,!1)),fn.format=_r[St.internalformat],fn.type=kr[St.type],fn.mag=ur[ft.magFilter],fn.min=Rr[ft.minFilter],fn.wrapS=qr[ft.wrapS],fn.wrapT=qr[ft.wrapT],fn}function Gi(ue,je,ft,At){he(!!ue,"must specify image data");var $e=je|0,De=ft|0,rt=At|0,ge=Xr();return rr(ge,St),ge.width=0,ge.height=0,Wr(ge,ue),ge.width=ge.width||(St.width>>rt)-$e,ge.height=ge.height||(St.height>>rt)-De,he(St.type===ge.type&&St.format===ge.format&&St.internalformat===ge.internalformat,"incompatible format for texture.subimage"),he($e>=0&&De>=0&&$e+ge.width<=St.width&&De+ge.height<=St.height,"texture.subimage write out of bounds"),he(St.mipmask&1<<rt,"missing mipmap data"),he(ge.data||ge.element||ge.needsCopy,"missing image data"),Wo(St),gi(ge,$o,$e,De,rt),ua(),rn(ge),fn}function Ee(ue,je){var ft=ue|0,At=je|0||ft;if(ft===St.width&&At===St.height)return fn;fn.width=St.width=ft,fn.height=St.height=At,Wo(St);for(var $e=0;St.mipmask>>$e;++$e){var De=ft>>$e,rt=At>>$e;if(!De||!rt)break;B.texImage2D($o,$e,St.format,De,rt,0,St.format,St.type,null)}return ua(),Qt.profile&&(St.stats.size=Hs(St.internalformat,St.type,ft,At,!1,!1)),fn}return fn(Ae,Bt),fn.subimage=Gi,fn.resize=Ee,fn._reglType="texture2d",fn._texture=St,Qt.profile&&(fn.stats=St.stats),fn.destroy=function(){St.decRef()},fn}function Ui(Ae,Bt,St,fn,Gi,Ee){var ue=new xi(Rc);Ln[ue.id]=ue,Pt.cubeCount++;var je=new Array(6);function ft(De,rt,ge,Ze,Se,lt){var wt,fr=ue.texInfo;for(Va.call(fr),wt=0;wt<6;++wt)je[wt]=ki();if(typeof De=="number"||!De){var Nr=De|0||1;for(wt=0;wt<6;++wt)ui(je[wt],Nr,Nr)}else if(typeof De=="object")if(rt)zi(je[0],De),zi(je[1],rt),zi(je[2],ge),zi(je[3],Ze),zi(je[4],Se),zi(je[5],lt);else if(Ho(fr,De),mn(ue,De),"faces"in De){var Br=De.faces;for(he(Array.isArray(Br)&&Br.length===6,"cube faces must be a length 6 array"),wt=0;wt<6;++wt)he(typeof Br[wt]=="object"&&!!Br[wt],"invalid input for cube map face"),rr(je[wt],ue),zi(je[wt],Br[wt])}else for(wt=0;wt<6;++wt)zi(je[wt],De);else he.raise("invalid arguments to cube map");for(rr(ue,je[0]),he.optional(function(){Be.npotTextureCube||he(Bf(ue.width)&&Bf(ue.height),"your browser does not support non power or two texture dimensions")}),fr.genMipmaps?ue.mipmask=(je[0].width<<1)-1:ue.mipmask=je[0].mipmask,he.textureCube(ue,fr,je,Be),ue.internalformat=je[0].internalformat,ft.width=je[0].width,ft.height=je[0].height,Wo(ue),wt=0;wt<6;++wt)qa(je[wt],Cu+wt);for(yo(fr,Rc),ua(),Qt.profile&&(ue.stats.size=Hs(ue.internalformat,ue.type,ft.width,ft.height,fr.genMipmaps,!0)),ft.format=_r[ue.internalformat],ft.type=kr[ue.type],ft.mag=ur[fr.magFilter],ft.min=Rr[fr.minFilter],ft.wrapS=qr[fr.wrapS],ft.wrapT=qr[fr.wrapT],wt=0;wt<6;++wt)No(je[wt]);return ft}function At(De,rt,ge,Ze,Se){he(!!rt,"must specify image data"),he(typeof De=="number"&&De===(De|0)&&De>=0&&De<6,"invalid face");var lt=ge|0,wt=Ze|0,fr=Se|0,Nr=Xr();return rr(Nr,ue),Nr.width=0,Nr.height=0,Wr(Nr,rt),Nr.width=Nr.width||(ue.width>>fr)-lt,Nr.height=Nr.height||(ue.height>>fr)-wt,he(ue.type===Nr.type&&ue.format===Nr.format&&ue.internalformat===Nr.internalformat,"incompatible format for texture.subimage"),he(lt>=0&&wt>=0&&lt+Nr.width<=ue.width&&wt+Nr.height<=ue.height,"texture.subimage write out of bounds"),he(ue.mipmask&1<<fr,"missing mipmap data"),he(Nr.data||Nr.element||Nr.needsCopy,"missing image data"),Wo(ue),gi(Nr,Cu+De,lt,wt,fr),ua(),rn(Nr),ft}function $e(De){var rt=De|0;if(rt!==ue.width){ft.width=ue.width=rt,ft.height=ue.height=rt,Wo(ue);for(var ge=0;ge<6;++ge)for(var Ze=0;ue.mipmask>>Ze;++Ze)B.texImage2D(Cu+ge,Ze,ue.format,rt>>Ze,rt>>Ze,0,ue.format,ue.type,null);return ua(),Qt.profile&&(ue.stats.size=Hs(ue.internalformat,ue.type,ft.width,ft.height,!1,!0)),ft}}return ft(Ae,Bt,St,fn,Gi,Ee),ft.subimage=At,ft.resize=$e,ft._reglType="textureCube",ft._texture=ue,Qt.profile&&(ft.stats=ue.stats),ft.destroy=function(){ue.decRef()},ft}function ya(){for(var Ae=0;Ae<ts;++Ae)B.activeTexture(cc+Ae),B.bindTexture($o,null),po[Ae]=null;ie(Ln).forEach(us),Pt.cubeCount=0,Pt.textureCount=0}Qt.profile&&(Pt.getTotalTextureSize=function(){var Ae=0;return Object.keys(Ln).forEach(function(Bt){Ae+=Ln[Bt].stats.size}),Ae});function Ao(){for(var Ae=0;Ae<ts;++Ae){var Bt=po[Ae];Bt&&(Bt.bindCount=0,Bt.unit=-1,po[Ae]=null)}ie(Ln).forEach(function(St){St.texture=B.createTexture(),B.bindTexture(St.target,St.texture);for(var fn=0;fn<32;++fn)if((St.mipmask&1<<fn)!=0)if(St.target===$o)B.texImage2D($o,fn,St.internalformat,St.width>>fn,St.height>>fn,0,St.internalformat,St.type,null);else for(var Gi=0;Gi<6;++Gi)B.texImage2D(Cu+Gi,fn,St.internalformat,St.width>>fn,St.height>>fn,0,St.internalformat,St.type,null);yo(St.texInfo,St.target)})}function Gl(){for(var Ae=0;Ae<ts;++Ae){var Bt=po[Ae];Bt&&(Bt.bindCount=0,Bt.unit=-1,po[Ae]=null),B.activeTexture(cc+Ae),B.bindTexture($o,null),B.bindTexture(Rc,null)}}return{create2D:ai,createCube:Ui,clear:ya,getTexture:function(Ae){return null},restore:Ao,refresh:Gl}}var pu=36161,Mn=32854,bn=32855,zc=36194,is=33189,as=36168,Jo=34041,nu=35907,to=34836,Ou=34842,Ji=34843,Ta=[];Ta[Mn]=2,Ta[bn]=2,Ta[zc]=2,Ta[is]=2,Ta[as]=1,Ta[Jo]=4,Ta[nu]=4,Ta[to]=16,Ta[Ou]=8,Ta[Ji]=6;function hc(B,ve,Be){return Ta[B]*ve*Be}var Ru=function(B,ve,Be,It,ar){var Pt={rgba4:Mn,rgb565:zc,"rgb5 a1":bn,depth:is,stencil:as,"depth stencil":Jo};ve.ext_srgb&&(Pt.srgba=nu),ve.ext_color_buffer_half_float&&(Pt.rgba16f=Ou,Pt.rgb16f=Ji),ve.webgl_color_buffer_float&&(Pt.rgba32f=to);var Qt=[];Object.keys(Pt).forEach(function(gr){var Sr=Pt[gr];Qt[Sr]=gr});var lr=0,vr={};function yr(gr){this.id=lr++,this.refCount=1,this.renderbuffer=gr,this.format=Mn,this.width=0,this.height=0,ar.profile&&(this.stats={size:0})}yr.prototype.decRef=function(){--this.refCount<=0&&Cr(this)};function Cr(gr){var Sr=gr.renderbuffer;he(Sr,"must not double destroy renderbuffer"),B.bindRenderbuffer(pu,null),B.deleteRenderbuffer(Sr),gr.renderbuffer=null,gr.refCount=0,delete vr[gr.id],It.renderbufferCount--}function Tr(gr,Sr){var ut=new yr(B.createRenderbuffer());vr[ut.id]=ut,It.renderbufferCount++;function jt(kr,ur){var Rr=0,qr=0,Nn=Mn;if(typeof kr=="object"&&kr){var er=kr;if("shape"in er){var rr=er.shape;he(Array.isArray(rr)&&rr.length>=2,"invalid renderbuffer shape"),Rr=rr[0]|0,qr=rr[1]|0}else"radius"in er&&(Rr=qr=er.radius|0),"width"in er&&(Rr=er.width|0),"height"in er&&(qr=er.height|0);"format"in er&&(he.parameter(er.format,Pt,"invalid renderbuffer format"),Nn=Pt[er.format])}else typeof kr=="number"?(Rr=kr|0,typeof ur=="number"?qr=ur|0:qr=Rr):kr?he.raise("invalid arguments to renderbuffer constructor"):Rr=qr=1;if(he(Rr>0&&qr>0&&Rr<=Be.maxRenderbufferSize&&qr<=Be.maxRenderbufferSize,"invalid renderbuffer size"),!(Rr===ut.width&&qr===ut.height&&Nn===ut.format))return jt.width=ut.width=Rr,jt.height=ut.height=qr,ut.format=Nn,B.bindRenderbuffer(pu,ut.renderbuffer),B.renderbufferStorage(pu,Nn,Rr,qr),he(B.getError()===0,"invalid render buffer format"),ar.profile&&(ut.stats.size=hc(ut.format,ut.width,ut.height)),jt.format=Qt[ut.format],jt}function _r(kr,ur){var Rr=kr|0,qr=ur|0||Rr;return Rr===ut.width&&qr===ut.height||(he(Rr>0&&qr>0&&Rr<=Be.maxRenderbufferSize&&qr<=Be.maxRenderbufferSize,"invalid renderbuffer size"),jt.width=ut.width=Rr,jt.height=ut.height=qr,B.bindRenderbuffer(pu,ut.renderbuffer),B.renderbufferStorage(pu,ut.format,Rr,qr),he(B.getError()===0,"invalid render buffer format"),ar.profile&&(ut.stats.size=hc(ut.format,ut.width,ut.height))),jt}return jt(gr,Sr),jt.resize=_r,jt._reglType="renderbuffer",jt._renderbuffer=ut,ar.profile&&(jt.stats=ut.stats),jt.destroy=function(){ut.decRef()},jt}ar.profile&&(It.getTotalRenderbufferSize=function(){var gr=0;return Object.keys(vr).forEach(function(Sr){gr+=vr[Sr].stats.size}),gr});function Ur(){ie(vr).forEach(function(gr){gr.renderbuffer=B.createRenderbuffer(),B.bindRenderbuffer(pu,gr.renderbuffer),B.renderbufferStorage(pu,gr.format,gr.width,gr.height)}),B.bindRenderbuffer(pu,null)}return{create:Tr,clear:function(){ie(vr).forEach(Cr)},restore:Ur}},iu=36160,du=36161,ko=3553,Lu=34069,vu=36064,Uc=36096,Ku=36128,vl=33306,hf=36053,Nl=36054,Bl=36055,Hf=36057,ml=36061,gl=36193,pf=5121,Qo=5126,Ws=6407,ku=6408,Zc=6402,pc=[Ws,ku],yl=[];yl[ku]=4,yl[Ws]=3;var l=[];l[pf]=1,l[Qo]=4,l[gl]=2;var f=32854,c=32855,p=36194,b=33189,w=36168,A=34041,R=35907,U=34836,q=34842,le=34843,fe=[f,c,p,R,q,le,U],pe={};pe[hf]="complete",pe[Nl]="incomplete attachment",pe[Hf]="incomplete dimensions",pe[Bl]="incomplete, missing attachment",pe[ml]="unsupported";function Oe(B,ve,Be,It,ar,Pt){var Qt={cur:null,next:null,dirty:!1,setFBO:null},lr=["rgba"],vr=["rgba4","rgb565","rgb5 a1"];ve.ext_srgb&&vr.push("srgba"),ve.ext_color_buffer_half_float&&vr.push("rgba16f","rgb16f"),ve.webgl_color_buffer_float&&vr.push("rgba32f");var yr=["uint8"];ve.oes_texture_half_float&&yr.push("half float","float16"),ve.oes_texture_float&&yr.push("float","float32");function Cr(xr,Wr,Kr){this.target=xr,this.texture=Wr,this.renderbuffer=Kr;var gi=0,ei=0;Wr?(gi=Wr.width,ei=Wr.height):Kr&&(gi=Kr.width,ei=Kr.height),this.width=gi,this.height=ei}function Tr(xr){xr&&(xr.texture&&xr.texture._texture.decRef(),xr.renderbuffer&&xr.renderbuffer._renderbuffer.decRef())}function Ur(xr,Wr,Kr){if(!!xr)if(xr.texture){var gi=xr.texture._texture,ei=Math.max(1,gi.width),Xr=Math.max(1,gi.height);he(ei===Wr&&Xr===Kr,"inconsistent width/height for supplied texture"),gi.refCount+=1}else{var rn=xr.renderbuffer._renderbuffer;he(rn.width===Wr&&rn.height===Kr,"inconsistent width/height for renderbuffer"),rn.refCount+=1}}function gr(xr,Wr){Wr&&(Wr.texture?B.framebufferTexture2D(iu,xr,Wr.target,Wr.texture._texture.texture,0):B.framebufferRenderbuffer(iu,xr,du,Wr.renderbuffer._renderbuffer.renderbuffer))}function Sr(xr){var Wr=ko,Kr=null,gi=null,ei=xr;typeof xr=="object"&&(ei=xr.data,"target"in xr&&(Wr=xr.target|0)),he.type(ei,"function","invalid attachment data");var Xr=ei._reglType;return Xr==="texture2d"?(Kr=ei,he(Wr===ko)):Xr==="textureCube"?(Kr=ei,he(Wr>=Lu&&Wr<Lu+6,"invalid cube map target")):Xr==="renderbuffer"?(gi=ei,Wr=du):he.raise("invalid regl object for attachment"),new Cr(Wr,Kr,gi)}function ut(xr,Wr,Kr,gi,ei){if(Kr){var Xr=It.create2D({width:xr,height:Wr,format:gi,type:ei});return Xr._texture.refCount=0,new Cr(ko,Xr,null)}else{var rn=ar.create({width:xr,height:Wr,format:gi});return rn._renderbuffer.refCount=0,new Cr(du,null,rn)}}function jt(xr){return xr&&(xr.texture||xr.renderbuffer)}function _r(xr,Wr,Kr){xr&&(xr.texture?xr.texture.resize(Wr,Kr):xr.renderbuffer&&xr.renderbuffer.resize(Wr,Kr),xr.width=Wr,xr.height=Kr)}var kr=0,ur={};function Rr(){this.id=kr++,ur[this.id]=this,this.framebuffer=B.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function qr(xr){xr.colorAttachments.forEach(Tr),Tr(xr.depthAttachment),Tr(xr.stencilAttachment),Tr(xr.depthStencilAttachment)}function Nn(xr){var Wr=xr.framebuffer;he(Wr,"must not double destroy framebuffer"),B.deleteFramebuffer(Wr),xr.framebuffer=null,Pt.framebufferCount--,delete ur[xr.id]}function er(xr){var Wr;B.bindFramebuffer(iu,xr.framebuffer);var Kr=xr.colorAttachments;for(Wr=0;Wr<Kr.length;++Wr)gr(vu+Wr,Kr[Wr]);for(Wr=Kr.length;Wr<Be.maxColorAttachments;++Wr)B.framebufferTexture2D(iu,vu+Wr,ko,null,0);B.framebufferTexture2D(iu,vl,ko,null,0),B.framebufferTexture2D(iu,Uc,ko,null,0),B.framebufferTexture2D(iu,Ku,ko,null,0),gr(Uc,xr.depthAttachment),gr(Ku,xr.stencilAttachment),gr(vl,xr.depthStencilAttachment);var gi=B.checkFramebufferStatus(iu);!B.isContextLost()&&gi!==hf&&he.raise("framebuffer configuration not supported, status = "+pe[gi]),B.bindFramebuffer(iu,Qt.next?Qt.next.framebuffer:null),Qt.cur=Qt.next,B.getError()}function rr(xr,Wr){var Kr=new Rr;Pt.framebufferCount++;function gi(Xr,rn){var $n;he(Qt.next!==Kr,"can not update framebuffer which is currently in use");var ui=0,zi=0,qa=!0,no=!0,ki=null,No=!0,Va="rgba",Ho="uint8",yo=1,Bn=null,Ln=null,ts=null,po=!1;if(typeof Xr=="number")ui=Xr|0,zi=rn|0||ui;else if(!Xr)ui=zi=1;else{he.type(Xr,"object","invalid arguments for framebuffer");var xi=Xr;if("shape"in xi){var Wo=xi.shape;he(Array.isArray(Wo)&&Wo.length>=2,"invalid shape for framebuffer"),ui=Wo[0],zi=Wo[1]}else"radius"in xi&&(ui=zi=xi.radius),"width"in xi&&(ui=xi.width),"height"in xi&&(zi=xi.height);("color"in xi||"colors"in xi)&&(ki=xi.color||xi.colors,Array.isArray(ki)&&he(ki.length===1||ve.webgl_draw_buffers,"multiple render targets not supported")),ki||("colorCount"in xi&&(yo=xi.colorCount|0,he(yo>0,"invalid color buffer count")),"colorTexture"in xi&&(No=!!xi.colorTexture,Va="rgba4"),"colorType"in xi&&(Ho=xi.colorType,No?(he(ve.oes_texture_float||!(Ho==="float"||Ho==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),he(ve.oes_texture_half_float||!(Ho==="half float"||Ho==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):Ho==="half float"||Ho==="float16"?(he(ve.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),Va="rgba16f"):(Ho==="float"||Ho==="float32")&&(he(ve.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),Va="rgba32f"),he.oneOf(Ho,yr,"invalid color type")),"colorFormat"in xi&&(Va=xi.colorFormat,lr.indexOf(Va)>=0?No=!0:vr.indexOf(Va)>=0?No=!1:he.optional(function(){No?he.oneOf(xi.colorFormat,lr,"invalid color format for texture"):he.oneOf(xi.colorFormat,vr,"invalid color format for renderbuffer")}))),("depthTexture"in xi||"depthStencilTexture"in xi)&&(po=!!(xi.depthTexture||xi.depthStencilTexture),he(!po||ve.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in xi&&(typeof xi.depth=="boolean"?qa=xi.depth:(Bn=xi.depth,no=!1)),"stencil"in xi&&(typeof xi.stencil=="boolean"?no=xi.stencil:(Ln=xi.stencil,qa=!1)),"depthStencil"in xi&&(typeof xi.depthStencil=="boolean"?qa=no=xi.depthStencil:(ts=xi.depthStencil,qa=!1,no=!1))}var ua=null,us=null,ai=null,Ui=null;if(Array.isArray(ki))ua=ki.map(Sr);else if(ki)ua=[Sr(ki)];else for(ua=new Array(yo),$n=0;$n<yo;++$n)ua[$n]=ut(ui,zi,No,Va,Ho);he(ve.webgl_draw_buffers||ua.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),he(ua.length<=Be.maxColorAttachments,"too many color attachments, not supported"),ui=ui||ua[0].width,zi=zi||ua[0].height,Bn?us=Sr(Bn):qa&&!no&&(us=ut(ui,zi,po,"depth","uint32")),Ln?ai=Sr(Ln):no&&!qa&&(ai=ut(ui,zi,!1,"stencil","uint8")),ts?Ui=Sr(ts):!Bn&&!Ln&&no&&qa&&(Ui=ut(ui,zi,po,"depth stencil","depth stencil")),he(!!Bn+!!Ln+!!ts<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var ya=null;for($n=0;$n<ua.length;++$n)if(Ur(ua[$n],ui,zi),he(!ua[$n]||ua[$n].texture&&pc.indexOf(ua[$n].texture._texture.format)>=0||ua[$n].renderbuffer&&fe.indexOf(ua[$n].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+$n+" is invalid"),ua[$n]&&ua[$n].texture){var Ao=yl[ua[$n].texture._texture.format]*l[ua[$n].texture._texture.type];ya===null?ya=Ao:he(ya===Ao,"all color attachments much have the same number of bits per pixel.")}return Ur(us,ui,zi),he(!us||us.texture&&us.texture._texture.format===Zc||us.renderbuffer&&us.renderbuffer._renderbuffer.format===b,"invalid depth attachment for framebuffer object"),Ur(ai,ui,zi),he(!ai||ai.renderbuffer&&ai.renderbuffer._renderbuffer.format===w,"invalid stencil attachment for framebuffer object"),Ur(Ui,ui,zi),he(!Ui||Ui.texture&&Ui.texture._texture.format===A||Ui.renderbuffer&&Ui.renderbuffer._renderbuffer.format===A,"invalid depth-stencil attachment for framebuffer object"),qr(Kr),Kr.width=ui,Kr.height=zi,Kr.colorAttachments=ua,Kr.depthAttachment=us,Kr.stencilAttachment=ai,Kr.depthStencilAttachment=Ui,gi.color=ua.map(jt),gi.depth=jt(us),gi.stencil=jt(ai),gi.depthStencil=jt(Ui),gi.width=Kr.width,gi.height=Kr.height,er(Kr),gi}function ei(Xr,rn){he(Qt.next!==Kr,"can not resize a framebuffer which is currently in use");var $n=Math.max(Xr|0,1),ui=Math.max(rn|0||$n,1);if($n===Kr.width&&ui===Kr.height)return gi;for(var zi=Kr.colorAttachments,qa=0;qa<zi.length;++qa)_r(zi[qa],$n,ui);return _r(Kr.depthAttachment,$n,ui),_r(Kr.stencilAttachment,$n,ui),_r(Kr.depthStencilAttachment,$n,ui),Kr.width=gi.width=$n,Kr.height=gi.height=ui,er(Kr),gi}return gi(xr,Wr),v(gi,{resize:ei,_reglType:"framebuffer",_framebuffer:Kr,destroy:function(){Nn(Kr),qr(Kr)},use:function(Xr){Qt.setFBO({framebuffer:gi},Xr)}})}function mn(xr){var Wr=Array(6);function Kr(ei){var Xr;he(Wr.indexOf(Qt.next)<0,"can not update framebuffer which is currently in use");var rn={color:null},$n=0,ui=null,zi="rgba",qa="uint8",no=1;if(typeof ei=="number")$n=ei|0;else if(!ei)$n=1;else{he.type(ei,"object","invalid arguments for framebuffer");var ki=ei;if("shape"in ki){var No=ki.shape;he(Array.isArray(No)&&No.length>=2,"invalid shape for framebuffer"),he(No[0]===No[1],"cube framebuffer must be square"),$n=No[0]}else"radius"in ki&&($n=ki.radius|0),"width"in ki?($n=ki.width|0,"height"in ki&&he(ki.height===$n,"must be square")):"height"in ki&&($n=ki.height|0);("color"in ki||"colors"in ki)&&(ui=ki.color||ki.colors,Array.isArray(ui)&&he(ui.length===1||ve.webgl_draw_buffers,"multiple render targets not supported")),ui||("colorCount"in ki&&(no=ki.colorCount|0,he(no>0,"invalid color buffer count")),"colorType"in ki&&(he.oneOf(ki.colorType,yr,"invalid color type"),qa=ki.colorType),"colorFormat"in ki&&(zi=ki.colorFormat,he.oneOf(ki.colorFormat,lr,"invalid color format for texture"))),"depth"in ki&&(rn.depth=ki.depth),"stencil"in ki&&(rn.stencil=ki.stencil),"depthStencil"in ki&&(rn.depthStencil=ki.depthStencil)}var Va;if(ui)if(Array.isArray(ui))for(Va=[],Xr=0;Xr<ui.length;++Xr)Va[Xr]=ui[Xr];else Va=[ui];else{Va=Array(no);var Ho={radius:$n,format:zi,type:qa};for(Xr=0;Xr<no;++Xr)Va[Xr]=It.createCube(Ho)}for(rn.color=Array(Va.length),Xr=0;Xr<Va.length;++Xr){var yo=Va[Xr];he(typeof yo=="function"&&yo._reglType==="textureCube","invalid cube map"),$n=$n||yo.width,he(yo.width===$n&&yo.height===$n,"invalid cube map shape"),rn.color[Xr]={target:Lu,data:Va[Xr]}}for(Xr=0;Xr<6;++Xr){for(var Bn=0;Bn<Va.length;++Bn)rn.color[Bn].target=Lu+Xr;Xr>0&&(rn.depth=Wr[0].depth,rn.stencil=Wr[0].stencil,rn.depthStencil=Wr[0].depthStencil),Wr[Xr]?Wr[Xr](rn):Wr[Xr]=rr(rn)}return v(Kr,{width:$n,height:$n,color:Va})}function gi(ei){var Xr,rn=ei|0;if(he(rn>0&&rn<=Be.maxCubeMapSize,"invalid radius for cube fbo"),rn===Kr.width)return Kr;var $n=Kr.color;for(Xr=0;Xr<$n.length;++Xr)$n[Xr].resize(rn);for(Xr=0;Xr<6;++Xr)Wr[Xr].resize(rn);return Kr.width=Kr.height=rn,Kr}return Kr(xr),v(Kr,{faces:Wr,resize:gi,_reglType:"framebufferCube",destroy:function(){Wr.forEach(function(ei){ei.destroy()})}})}function Hr(){Qt.cur=null,Qt.next=null,Qt.dirty=!0,ie(ur).forEach(function(xr){xr.framebuffer=B.createFramebuffer(),er(xr)})}return v(Qt,{getFramebuffer:function(xr){if(typeof xr=="function"&&xr._reglType==="framebuffer"){var Wr=xr._framebuffer;if(Wr instanceof Rr)return Wr}return null},create:rr,createCube:mn,clear:function(){ie(ur).forEach(Nn)},restore:Hr})}var Ce=5126,We=34962,Te=34963,He=["attributes","elements","offset","count","primitive","instances"];function Qe(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=Ce,this.offset=0,this.stride=0,this.divisor=0}function yt(B,ve,Be,It,ar,Pt,Qt){for(var lr=Be.maxAttributes,vr=new Array(lr),yr=0;yr<lr;++yr)vr[yr]=new Qe;var Cr=0,Tr={},Ur={Record:Qe,scope:{},state:vr,currentVAO:null,targetVAO:null,restore:Sr()?qr:function(){},createVAO:Nn,getVAO:jt,destroyBuffer:gr,setVAO:Sr()?_r:kr,clear:Sr()?ur:function(){}};function gr(er){for(var rr=0;rr<vr.length;++rr){var mn=vr[rr];mn.buffer===er&&(B.disableVertexAttribArray(rr),mn.buffer=null)}}function Sr(){return ve.oes_vertex_array_object}function ut(){return ve.angle_instanced_arrays}function jt(er){return typeof er=="function"&&er._vao?er._vao:null}function _r(er){if(er!==Ur.currentVAO){var rr=Sr();er?rr.bindVertexArrayOES(er.vao):rr.bindVertexArrayOES(null),Ur.currentVAO=er}}function kr(er){if(er!==Ur.currentVAO){if(er)er.bindAttrs();else{for(var rr=ut(),mn=0;mn<vr.length;++mn){var Hr=vr[mn];Hr.buffer?(B.enableVertexAttribArray(mn),Hr.buffer.bind(),B.vertexAttribPointer(mn,Hr.size,Hr.type,Hr.normalized,Hr.stride,Hr.offfset),rr&&Hr.divisor&&rr.vertexAttribDivisorANGLE(mn,Hr.divisor)):(B.disableVertexAttribArray(mn),B.vertexAttrib4f(mn,Hr.x,Hr.y,Hr.z,Hr.w))}Qt.elements?B.bindBuffer(Te,Qt.elements.buffer.buffer):B.bindBuffer(Te,null)}Ur.currentVAO=er}}function ur(){ie(Tr).forEach(function(er){er.destroy()})}function Rr(){this.id=++Cr,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var er=Sr();er?this.vao=er.createVertexArrayOES():this.vao=null,Tr[this.id]=this,this.buffers=[]}Rr.prototype.bindAttrs=function(){for(var er=ut(),rr=this.attributes,mn=0;mn<rr.length;++mn){var Hr=rr[mn];Hr.buffer?(B.enableVertexAttribArray(mn),B.bindBuffer(We,Hr.buffer.buffer),B.vertexAttribPointer(mn,Hr.size,Hr.type,Hr.normalized,Hr.stride,Hr.offset),er&&Hr.divisor&&er.vertexAttribDivisorANGLE(mn,Hr.divisor)):(B.disableVertexAttribArray(mn),B.vertexAttrib4f(mn,Hr.x,Hr.y,Hr.z,Hr.w))}for(var xr=rr.length;xr<lr;++xr)B.disableVertexAttribArray(xr);var Wr=Pt.getElements(this.elements);Wr?B.bindBuffer(Te,Wr.buffer.buffer):B.bindBuffer(Te,null)},Rr.prototype.refresh=function(){var er=Sr();er&&(er.bindVertexArrayOES(this.vao),this.bindAttrs(),Ur.currentVAO=null,er.bindVertexArrayOES(null))},Rr.prototype.destroy=function(){if(this.vao){var er=Sr();this===Ur.currentVAO&&(Ur.currentVAO=null,er.bindVertexArrayOES(null)),er.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),Tr[this.id]&&(delete Tr[this.id],It.vaoCount-=1)};function qr(){var er=Sr();er&&ie(Tr).forEach(function(rr){rr.refresh()})}function Nn(er){var rr=new Rr;It.vaoCount+=1;function mn(Hr){var xr;if(Array.isArray(Hr))xr=Hr,rr.elements&&rr.ownsElements&&rr.elements.destroy(),rr.elements=null,rr.ownsElements=!1,rr.offset=0,rr.count=0,rr.instances=-1,rr.primitive=4;else{if(he(typeof Hr=="object","invalid arguments for create vao"),he("attributes"in Hr,"must specify attributes for vao"),Hr.elements){var Wr=Hr.elements;rr.ownsElements?typeof Wr=="function"&&Wr._reglType==="elements"?(rr.elements.destroy(),rr.ownsElements=!1):(rr.elements(Wr),rr.ownsElements=!1):Pt.getElements(Hr.elements)?(rr.elements=Hr.elements,rr.ownsElements=!1):(rr.elements=Pt.create(Hr.elements),rr.ownsElements=!0)}else rr.elements=null,rr.ownsElements=!1;xr=Hr.attributes,rr.offset=0,rr.count=-1,rr.instances=-1,rr.primitive=4,rr.elements&&(rr.count=rr.elements._elements.vertCount,rr.primitive=rr.elements._elements.primType),"offset"in Hr&&(rr.offset=Hr.offset|0),"count"in Hr&&(rr.count=Hr.count|0),"instances"in Hr&&(rr.instances=Hr.instances|0),"primitive"in Hr&&(he(Hr.primitive in ir,"bad primitive type: "+Hr.primitive),rr.primitive=ir[Hr.primitive]),he.optional(()=>{for(var qa=Object.keys(Hr),no=0;no<qa.length;++no)he(He.indexOf(qa[no])>=0,'invalid option for vao: "'+qa[no]+'" valid options are '+He)}),he(Array.isArray(xr),"attributes must be an array")}he(xr.length<lr,"too many attributes"),he(xr.length>0,"must specify at least one attribute");var Kr={},gi=rr.attributes;gi.length=xr.length;for(var ei=0;ei<xr.length;++ei){var Xr=xr[ei],rn=gi[ei]=new Qe,$n=Xr.data||Xr;if(Array.isArray($n)||j($n)||ps($n)){var ui;rr.buffers[ei]&&(ui=rr.buffers[ei],j($n)&&ui._buffer.byteLength>=$n.byteLength?ui.subdata($n):(ui.destroy(),rr.buffers[ei]=null)),rr.buffers[ei]||(ui=rr.buffers[ei]=ar.create(Xr,We,!1,!0)),rn.buffer=ar.getBuffer(ui),rn.size=rn.buffer.dimension|0,rn.normalized=!1,rn.type=rn.buffer.dtype,rn.offset=0,rn.stride=0,rn.divisor=0,rn.state=1,Kr[ei]=1}else ar.getBuffer(Xr)?(rn.buffer=ar.getBuffer(Xr),rn.size=rn.buffer.dimension|0,rn.normalized=!1,rn.type=rn.buffer.dtype,rn.offset=0,rn.stride=0,rn.divisor=0,rn.state=1):ar.getBuffer(Xr.buffer)?(rn.buffer=ar.getBuffer(Xr.buffer),rn.size=(+Xr.size||rn.buffer.dimension)|0,rn.normalized=!!Xr.normalized||!1,"type"in Xr?(he.parameter(Xr.type,$s,"invalid buffer type"),rn.type=$s[Xr.type]):rn.type=rn.buffer.dtype,rn.offset=(Xr.offset||0)|0,rn.stride=(Xr.stride||0)|0,rn.divisor=(Xr.divisor||0)|0,rn.state=1,he(rn.size>=1&&rn.size<=4,"size must be between 1 and 4"),he(rn.offset>=0,"invalid offset"),he(rn.stride>=0&&rn.stride<=255,"stride must be between 0 and 255"),he(rn.divisor>=0,"divisor must be positive"),he(!rn.divisor||!!ve.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in Xr?(he(ei>0,"first attribute must not be a constant"),rn.x=+Xr.x||0,rn.y=+Xr.y||0,rn.z=+Xr.z||0,rn.w=+Xr.w||0,rn.state=2):he(!1,"invalid attribute spec for location "+ei)}for(var zi=0;zi<rr.buffers.length;++zi)!Kr[zi]&&rr.buffers[zi]&&(rr.buffers[zi].destroy(),rr.buffers[zi]=null);return rr.refresh(),mn}return mn.destroy=function(){for(var Hr=0;Hr<rr.buffers.length;++Hr)rr.buffers[Hr]&&rr.buffers[Hr].destroy();rr.buffers.length=0,rr.ownsElements&&(rr.elements.destroy(),rr.elements=null,rr.ownsElements=!1),rr.destroy()},mn._vao=rr,mn._reglType="vao",mn(er)}return Ur}var Vt=35632,Nt=35633,Kt=35718,cr=35721;function Ir(B,ve,Be,It){var ar={},Pt={};function Qt(ut,jt,_r,kr){this.name=ut,this.id=jt,this.location=_r,this.info=kr}function lr(ut,jt){for(var _r=0;_r<ut.length;++_r)if(ut[_r].id===jt.id){ut[_r].location=jt.location;return}ut.push(jt)}function vr(ut,jt,_r){var kr=ut===Vt?ar:Pt,ur=kr[jt];if(!ur){var Rr=ve.str(jt);ur=B.createShader(ut),B.shaderSource(ur,Rr),B.compileShader(ur),he.shaderError(B,ur,Rr,ut,_r),kr[jt]=ur}return ur}var yr={},Cr=[],Tr=0;function Ur(ut,jt){this.id=Tr++,this.fragId=ut,this.vertId=jt,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,It.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function gr(ut,jt,_r){var kr,ur,Rr=vr(Vt,ut.fragId),qr=vr(Nt,ut.vertId),Nn=ut.program=B.createProgram();if(B.attachShader(Nn,Rr),B.attachShader(Nn,qr),_r)for(kr=0;kr<_r.length;++kr){var er=_r[kr];B.bindAttribLocation(Nn,er[0],er[1])}B.linkProgram(Nn),he.linkError(B,Nn,ve.str(ut.fragId),ve.str(ut.vertId),jt);var rr=B.getProgramParameter(Nn,Kt);It.profile&&(ut.stats.uniformsCount=rr);var mn=ut.uniforms;for(kr=0;kr<rr;++kr)if(ur=B.getActiveUniform(Nn,kr),ur)if(ur.size>1)for(var Hr=0;Hr<ur.size;++Hr){var xr=ur.name.replace("[0]","["+Hr+"]");lr(mn,new Qt(xr,ve.id(xr),B.getUniformLocation(Nn,xr),ur))}else lr(mn,new Qt(ur.name,ve.id(ur.name),B.getUniformLocation(Nn,ur.name),ur));var Wr=B.getProgramParameter(Nn,cr);It.profile&&(ut.stats.attributesCount=Wr);var Kr=ut.attributes;for(kr=0;kr<Wr;++kr)ur=B.getActiveAttrib(Nn,kr),ur&&lr(Kr,new Qt(ur.name,ve.id(ur.name),B.getAttribLocation(Nn,ur.name),ur))}It.profile&&(Be.getMaxUniformsCount=function(){var ut=0;return Cr.forEach(function(jt){jt.stats.uniformsCount>ut&&(ut=jt.stats.uniformsCount)}),ut},Be.getMaxAttributesCount=function(){var ut=0;return Cr.forEach(function(jt){jt.stats.attributesCount>ut&&(ut=jt.stats.attributesCount)}),ut});function Sr(){ar={},Pt={};for(var ut=0;ut<Cr.length;++ut)gr(Cr[ut],null,Cr[ut].attributes.map(function(jt){return[jt.location,jt.name]}))}return{clear:function(){var ut=B.deleteShader.bind(B);ie(ar).forEach(ut),ar={},ie(Pt).forEach(ut),Pt={},Cr.forEach(function(jt){B.deleteProgram(jt.program)}),Cr.length=0,yr={},Be.shaderCount=0},program:function(ut,jt,_r,kr){he.command(ut>=0,"missing vertex shader",_r),he.command(jt>=0,"missing fragment shader",_r);var ur=yr[jt];ur||(ur=yr[jt]={});var Rr=ur[ut];if(Rr&&(Rr.refCount++,!kr))return Rr;var qr=new Ur(jt,ut);return Be.shaderCount++,gr(qr,_r,kr),Rr||(ur[ut]=qr),Cr.push(qr),v(qr,{destroy:function(){if(qr.refCount--,qr.refCount<=0){B.deleteProgram(qr.program);var Nn=Cr.indexOf(qr);Cr.splice(Nn,1),Be.shaderCount--}ur[qr.vertId].refCount<=0&&(B.deleteShader(Pt[qr.vertId]),delete Pt[qr.vertId],delete yr[qr.fragId][qr.vertId]),Object.keys(yr[qr.fragId]).length||(B.deleteShader(ar[qr.fragId]),delete ar[qr.fragId],delete yr[qr.fragId])}})},restore:Sr,shader:vr,frag:-1,vert:-1}}var Or=6408,tn=5121,Rn=3333,Fn=5126;function Un(B,ve,Be,It,ar,Pt,Qt){function lr(Cr){var Tr;ve.next===null?(he(ar.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),Tr=tn):(he(ve.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),Tr=ve.next.colorAttachments[0].texture._texture.type,he.optional(function(){Pt.oes_texture_float?(he(Tr===tn||Tr===Fn,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),Tr===Fn&&he(Qt.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):he(Tr===tn,"Reading from a framebuffer is only allowed for the type 'uint8'")}));var Ur=0,gr=0,Sr=It.framebufferWidth,ut=It.framebufferHeight,jt=null;j(Cr)?jt=Cr:Cr&&(he.type(Cr,"object","invalid arguments to regl.read()"),Ur=Cr.x|0,gr=Cr.y|0,he(Ur>=0&&Ur<It.framebufferWidth,"invalid x offset for regl.read"),he(gr>=0&&gr<It.framebufferHeight,"invalid y offset for regl.read"),Sr=(Cr.width||It.framebufferWidth-Ur)|0,ut=(Cr.height||It.framebufferHeight-gr)|0,jt=Cr.data||null),jt&&(Tr===tn?he(jt instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):Tr===Fn&&he(jt instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),he(Sr>0&&Sr+Ur<=It.framebufferWidth,"invalid width for read pixels"),he(ut>0&&ut+gr<=It.framebufferHeight,"invalid height for read pixels"),Be();var _r=Sr*ut*4;return jt||(Tr===tn?jt=new Uint8Array(_r):Tr===Fn&&(jt=jt||new Float32Array(_r))),he.isTypedArray(jt,"data buffer for regl.read() must be a typedarray"),he(jt.byteLength>=_r,"data buffer for regl.read() too small"),B.pixelStorei(Rn,4),B.readPixels(Ur,gr,Sr,ut,Or,Tr,jt),jt}function vr(Cr){var Tr;return ve.setFBO({framebuffer:Cr.framebuffer},function(){Tr=lr(Cr)}),Tr}function yr(Cr){return!Cr||!("framebuffer"in Cr)?lr(Cr):vr(Cr)}return yr}function Li(B){return Array.prototype.slice.call(B)}function Zr(B){return Li(B).join("")}function ii(){var B=0,ve=[],Be=[];function It(Tr){for(var Ur=0;Ur<Be.length;++Ur)if(Be[Ur]===Tr)return ve[Ur];var gr="g"+B++;return ve.push(gr),Be.push(Tr),gr}function ar(){var Tr=[];function Ur(){Tr.push.apply(Tr,Li(arguments))}var gr=[];function Sr(){var ut="v"+B++;return gr.push(ut),arguments.length>0&&(Tr.push(ut,"="),Tr.push.apply(Tr,Li(arguments)),Tr.push(";")),ut}return v(Ur,{def:Sr,toString:function(){return Zr([gr.length>0?"var "+gr.join(",")+";":"",Zr(Tr)])}})}function Pt(){var Tr=ar(),Ur=ar(),gr=Tr.toString,Sr=Ur.toString;function ut(jt,_r){Ur(jt,_r,"=",Tr.def(jt,_r),";")}return v(function(){Tr.apply(Tr,Li(arguments))},{def:Tr.def,entry:Tr,exit:Ur,save:ut,set:function(jt,_r,kr){ut(jt,_r),Tr(jt,_r,"=",kr,";")},toString:function(){return gr()+Sr()}})}function Qt(){var Tr=Zr(arguments),Ur=Pt(),gr=Pt(),Sr=Ur.toString,ut=gr.toString;return v(Ur,{then:function(){return Ur.apply(Ur,Li(arguments)),this},else:function(){return gr.apply(gr,Li(arguments)),this},toString:function(){var jt=ut();return jt&&(jt="else{"+jt+"}"),Zr(["if(",Tr,"){",Sr(),"}",jt])}})}var lr=ar(),vr={};function yr(Tr,Ur){var gr=[];function Sr(){var ur="a"+gr.length;return gr.push(ur),ur}Ur=Ur||0;for(var ut=0;ut<Ur;++ut)Sr();var jt=Pt(),_r=jt.toString,kr=vr[Tr]=v(jt,{arg:Sr,toString:function(){return Zr(["function(",gr.join(),"){",_r(),"}"])}});return kr}function Cr(){var Tr=['"use strict";',lr,"return {"];Object.keys(vr).forEach(function(ut){Tr.push('"',ut,'":',vr[ut].toString(),",")}),Tr.push("}");var Ur=Zr(Tr).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),gr=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",Sr=gr?X.Function.apply(null,ve.concat(Ur)):Function.apply(null,ve.concat(Ur));return Sr.apply(null,Be)}return{global:lr,link:It,block:ar,proc:yr,scope:Pt,cond:Qt,compile:Cr}}var si="xyzw".split(""),Qn=5121,Hn=1,mi=2,Kn=0,Wn=1,uo=2,ha=3,Do=4,Fo=5,Za=6,ro="dither",bs="blend.enable",es="blend.color",Du="blend.equation",os="blend.func",au="depth.enable",Ns="depth.func",dc="depth.range",zl="depth.mask",Fu="colorMask",_l="cull.enable",Ul="cull.face",ou="frontFace",Zl="lineWidth",mu="polygonOffset.enable",go="polygonOffset.offset",Nu="sample.alpha",Bu="sample.enable",$u="sample.coverage",ta="stencil.enable",Es="stencil.mask",ss="stencil.func",Ju="stencil.opFront",Vc="stencil.opBack",jc="scissor.enable",df="scissor.box",Xs="viewport",gu="profile",su="framebuffer",xl="vert",Gc="frag",yu="elements",wo="primitive",vc="count",Wf="offset",Eh="instances",vf="vao",Sh="Width",Qh="Height",mc=su+Sh,mf=su+Qh,wh=Xs+Sh,zp=Xs+Qh,gc="drawingBuffer",Fr=gc+Sh,Up=gc+Qh,$t=[os,Du,ss,Ju,Vc,$u,Xs,df,go],gf=34962,ep=34963,Zp=35632,Vp=35633,tp=3553,rp=34067,jp=2884,bl=3042,bd=3024,Co=2960,Xf=2929,np=3089,Yf=32823,qf=32926,yf=32928,Ch=5126,_f=35664,Vl=35665,yc=35666,Kf=5124,Th=35667,_c=35668,Ah=35669,$f=35670,Mh=35671,xf=35672,Hc=35673,Ys=35674,bf=35675,Jf=35676,Ph=35678,Qf=35680,eh=4,Qu=1028,Wc=1029,ip=2304,th=2305,Gp=32775,Ed=32776,Sd=519,uu=7680,Ef=0,Ih=1,xa=32774,Ss=513,Hp=36160,wd=36064,el={"0":0,"1":1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Sf=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],xc={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},bc={"0":0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},rh={frag:Zp,vert:Vp},ap={cw:ip,ccw:th};function Oh(B){return Array.isArray(B)||j(B)||ps(B)}function zu(B){return B.sort(function(ve,Be){return ve===Xs?-1:Be===Xs?1:ve<Be?-1:1})}function ra(B,ve,Be,It){this.thisDep=B,this.contextDep=ve,this.propDep=Be,this.append=It}function Uu(B){return B&&!(B.thisDep||B.contextDep||B.propDep)}function To(B){return new ra(!1,!1,!1,B)}function ws(B,ve){var Be=B.type;if(Be===Kn){var It=B.data.length;return new ra(!0,It>=1,It>=2,ve)}else if(Be===Do){var ar=B.data;return new ra(ar.thisDep,ar.contextDep,ar.propDep,ve)}else{if(Be===Fo)return new ra(!1,!1,!1,ve);if(Be===Za){for(var Pt=!1,Qt=!1,lr=!1,vr=0;vr<B.data.length;++vr){var yr=B.data[vr];if(yr.type===Wn)lr=!0;else if(yr.type===uo)Qt=!0;else if(yr.type===ha)Pt=!0;else if(yr.type===Kn){Pt=!0;var Cr=yr.data;Cr>=1&&(Qt=!0),Cr>=2&&(lr=!0)}else yr.type===Do&&(Pt=Pt||yr.data.thisDep,Qt=Qt||yr.data.contextDep,lr=lr||yr.data.propDep)}return new ra(Pt,Qt,lr,ve)}else return new ra(Be===ha,Be===uo,Be===Wn,ve)}}var Rh=new ra(!1,!1,!1,function(){});function Lh(B,ve,Be,It,ar,Pt,Qt,lr,vr,yr,Cr,Tr,Ur,gr,Sr){var ut=yr.Record,jt={add:32774,subtract:32778,"reverse subtract":32779};Be.ext_blend_minmax&&(jt.min=Gp,jt.max=Ed);var _r=Be.angle_instanced_arrays,kr=Be.webgl_draw_buffers,ur=Be.oes_vertex_array_object,Rr={dirty:!0,profile:Sr.profile},qr={},Nn=[],er={},rr={};function mn(Ee){return Ee.replace(".","_")}function Hr(Ee,ue,je){var ft=mn(Ee);Nn.push(Ee),qr[ft]=Rr[ft]=!!je,er[ft]=ue}function xr(Ee,ue,je){var ft=mn(Ee);Nn.push(Ee),Array.isArray(je)?(Rr[ft]=je.slice(),qr[ft]=je.slice()):Rr[ft]=qr[ft]=je,rr[ft]=ue}Hr(ro,bd),Hr(bs,bl),xr(es,"blendColor",[0,0,0,0]),xr(Du,"blendEquationSeparate",[xa,xa]),xr(os,"blendFuncSeparate",[Ih,Ef,Ih,Ef]),Hr(au,Xf,!0),xr(Ns,"depthFunc",Ss),xr(dc,"depthRange",[0,1]),xr(zl,"depthMask",!0),xr(Fu,Fu,[!0,!0,!0,!0]),Hr(_l,jp),xr(Ul,"cullFace",Wc),xr(ou,ou,th),xr(Zl,Zl,1),Hr(mu,Yf),xr(go,"polygonOffset",[0,0]),Hr(Nu,qf),Hr(Bu,yf),xr($u,"sampleCoverage",[1,!1]),Hr(ta,Co),xr(Es,"stencilMask",-1),xr(ss,"stencilFunc",[Sd,0,-1]),xr(Ju,"stencilOpSeparate",[Qu,uu,uu,uu]),xr(Vc,"stencilOpSeparate",[Wc,uu,uu,uu]),Hr(jc,np),xr(df,"scissor",[0,0,B.drawingBufferWidth,B.drawingBufferHeight]),xr(Xs,Xs,[0,0,B.drawingBufferWidth,B.drawingBufferHeight]);var Wr={gl:B,context:Ur,strings:ve,next:qr,current:Rr,draw:Tr,elements:Pt,buffer:ar,shader:Cr,attributes:yr.state,vao:yr,uniforms:vr,framebuffer:lr,extensions:Be,timer:gr,isBufferArgs:Oh},Kr={primTypes:ir,compareFuncs:xc,blendFuncs:el,blendEquations:jt,stencilOps:bc,glTypes:$s,orientationType:ap};he.optional(function(){Wr.isArrayLike=oo}),kr&&(Kr.backBuffer=[Wc],Kr.drawBuffer=Ge(It.maxDrawbuffers,function(Ee){return Ee===0?[0]:Ge(Ee,function(ue){return wd+ue})}));var gi=0;function ei(){var Ee=ii(),ue=Ee.link,je=Ee.global;Ee.id=gi++,Ee.batchId="0";var ft=ue(Wr),At=Ee.shared={props:"a0"};Object.keys(Wr).forEach(function(Ze){At[Ze]=je.def(ft,".",Ze)}),he.optional(function(){Ee.CHECK=ue(he),Ee.commandStr=he.guessCommand(),Ee.command=ue(Ee.commandStr),Ee.assert=function(Ze,Se,lt){Ze("if(!(",Se,"))",this.CHECK,".commandRaise(",ue(lt),",",this.command,");")},Kr.invalidBlendCombinations=Sf});var $e=Ee.next={},De=Ee.current={};Object.keys(rr).forEach(function(Ze){Array.isArray(Rr[Ze])&&($e[Ze]=je.def(At.next,".",Ze),De[Ze]=je.def(At.current,".",Ze))});var rt=Ee.constants={};Object.keys(Kr).forEach(function(Ze){rt[Ze]=je.def(JSON.stringify(Kr[Ze]))}),Ee.invoke=function(Ze,Se){switch(Se.type){case Kn:var lt=["this",At.context,At.props,Ee.batchId];return Ze.def(ue(Se.data),".call(",lt.slice(0,Math.max(Se.data.length+1,4)),")");case Wn:return Ze.def(At.props,Se.data);case uo:return Ze.def(At.context,Se.data);case ha:return Ze.def("this",Se.data);case Do:return Se.data.append(Ee,Ze),Se.data.ref;case Fo:return Se.data.toString();case Za:return Se.data.map(function(wt){return Ee.invoke(Ze,wt)})}},Ee.attribCache={};var ge={};return Ee.scopeAttrib=function(Ze){var Se=ve.id(Ze);if(Se in ge)return ge[Se];var lt=yr.scope[Se];lt||(lt=yr.scope[Se]=new ut);var wt=ge[Se]=ue(lt);return wt},Ee}function Xr(Ee){var ue=Ee.static,je=Ee.dynamic,ft;if(gu in ue){var At=!!ue[gu];ft=To(function(De,rt){return At}),ft.enable=At}else if(gu in je){var $e=je[gu];ft=ws($e,function(De,rt){return De.invoke(rt,$e)})}return ft}function rn(Ee,ue){var je=Ee.static,ft=Ee.dynamic;if(su in je){var At=je[su];return At?(At=lr.getFramebuffer(At),he.command(At,"invalid framebuffer object"),To(function(De,rt){var ge=De.link(At),Ze=De.shared;rt.set(Ze.framebuffer,".next",ge);var Se=Ze.context;return rt.set(Se,"."+mc,ge+".width"),rt.set(Se,"."+mf,ge+".height"),ge})):To(function(De,rt){var ge=De.shared;rt.set(ge.framebuffer,".next","null");var Ze=ge.context;return rt.set(Ze,"."+mc,Ze+"."+Fr),rt.set(Ze,"."+mf,Ze+"."+Up),"null"})}else if(su in ft){var $e=ft[su];return ws($e,function(De,rt){var ge=De.invoke(rt,$e),Ze=De.shared,Se=Ze.framebuffer,lt=rt.def(Se,".getFramebuffer(",ge,")");he.optional(function(){De.assert(rt,"!"+ge+"||"+lt,"invalid framebuffer object")}),rt.set(Se,".next",lt);var wt=Ze.context;return rt.set(wt,"."+mc,lt+"?"+lt+".width:"+wt+"."+Fr),rt.set(wt,"."+mf,lt+"?"+lt+".height:"+wt+"."+Up),lt})}else return null}function $n(Ee,ue,je){var ft=Ee.static,At=Ee.dynamic;function $e(ge){if(ge in ft){var Ze=ft[ge];he.commandType(Ze,"object","invalid "+ge,je.commandStr);var Se=!0,lt=Ze.x|0,wt=Ze.y|0,fr,Nr;return"width"in Ze?(fr=Ze.width|0,he.command(fr>=0,"invalid "+ge,je.commandStr)):Se=!1,"height"in Ze?(Nr=Ze.height|0,he.command(Nr>=0,"invalid "+ge,je.commandStr)):Se=!1,new ra(!Se&&ue&&ue.thisDep,!Se&&ue&&ue.contextDep,!Se&&ue&&ue.propDep,function(Lr,En){var sn=Lr.shared.context,_n=fr;"width"in Ze||(_n=En.def(sn,".",mc,"-",lt));var yn=Nr;return"height"in Ze||(yn=En.def(sn,".",mf,"-",wt)),[lt,wt,_n,yn]})}else if(ge in At){var Br=At[ge],nn=ws(Br,function(Lr,En){var sn=Lr.invoke(En,Br);he.optional(function(){Lr.assert(En,sn+"&&typeof "+sn+'==="object"',"invalid "+ge)});var _n=Lr.shared.context,yn=En.def(sn,".x|0"),dn=En.def(sn,".y|0"),Jn=En.def('"width" in ',sn,"?",sn,".width|0:","(",_n,".",mc,"-",yn,")"),Ea=En.def('"height" in ',sn,"?",sn,".height|0:","(",_n,".",mf,"-",dn,")");return he.optional(function(){Lr.assert(En,Jn+">=0&&"+Ea+">=0","invalid "+ge)}),[yn,dn,Jn,Ea]});return ue&&(nn.thisDep=nn.thisDep||ue.thisDep,nn.contextDep=nn.contextDep||ue.contextDep,nn.propDep=nn.propDep||ue.propDep),nn}else return ue?new ra(ue.thisDep,ue.contextDep,ue.propDep,function(Lr,En){var sn=Lr.shared.context;return[0,0,En.def(sn,".",mc),En.def(sn,".",mf)]}):null}var De=$e(Xs);if(De){var rt=De;De=new ra(De.thisDep,De.contextDep,De.propDep,function(ge,Ze){var Se=rt.append(ge,Ze),lt=ge.shared.context;return Ze.set(lt,"."+wh,Se[2]),Ze.set(lt,"."+zp,Se[3]),Se})}return{viewport:De,scissor_box:$e(df)}}function ui(Ee,ue){var je=Ee.static,ft=typeof je[Gc]=="string"&&typeof je[xl]=="string";if(ft){if(Object.keys(ue.dynamic).length>0)return null;var At=ue.static,$e=Object.keys(At);if($e.length>0&&typeof At[$e[0]]=="number"){for(var De=[],rt=0;rt<$e.length;++rt)he(typeof At[$e[rt]]=="number","must specify all vertex attribute locations when using vaos"),De.push([At[$e[rt]]|0,$e[rt]]);return De}}return null}function zi(Ee,ue,je){var ft=Ee.static,At=Ee.dynamic;function $e(Se){if(Se in ft){var lt=ve.id(ft[Se]);he.optional(function(){Cr.shader(rh[Se],lt,he.guessCommand())});var wt=To(function(){return lt});return wt.id=lt,wt}else if(Se in At){var fr=At[Se];return ws(fr,function(Nr,Br){var nn=Nr.invoke(Br,fr),Lr=Br.def(Nr.shared.strings,".id(",nn,")");return he.optional(function(){Br(Nr.shared.shader,".shader(",rh[Se],",",Lr,",",Nr.command,");")}),Lr})}return null}var De=$e(Gc),rt=$e(xl),ge=null,Ze;return Uu(De)&&Uu(rt)?(ge=Cr.program(rt.id,De.id,null,je),Ze=To(function(Se,lt){return Se.link(ge)})):Ze=new ra(De&&De.thisDep||rt&&rt.thisDep,De&&De.contextDep||rt&&rt.contextDep,De&&De.propDep||rt&&rt.propDep,function(Se,lt){var wt=Se.shared.shader,fr;De?fr=De.append(Se,lt):fr=lt.def(wt,".",Gc);var Nr;rt?Nr=rt.append(Se,lt):Nr=lt.def(wt,".",xl);var Br=wt+".program("+Nr+","+fr;return he.optional(function(){Br+=","+Se.command}),lt.def(Br+")")}),{frag:De,vert:rt,progVar:Ze,program:ge}}function qa(Ee,ue){var je=Ee.static,ft=Ee.dynamic,At={},$e=!1;function De(){if(vf in je){var En=je[vf];return En!==null&&yr.getVAO(En)===null&&(En=yr.createVAO(En)),$e=!0,At.vao=En,To(function(_n){var yn=yr.getVAO(En);return yn?_n.link(yn):"null"})}else if(vf in ft){$e=!0;var sn=ft[vf];return ws(sn,function(_n,yn){var dn=_n.invoke(yn,sn);return yn.def(_n.shared.vao+".getVAO("+dn+")")})}return null}var rt=De(),ge=!1;function Ze(){if(yu in je){var En=je[yu];if(At.elements=En,Oh(En)){var sn=At.elements=Pt.create(En,!0);En=Pt.getElements(sn),ge=!0}else En&&(En=Pt.getElements(En),ge=!0,he.command(En,"invalid elements",ue.commandStr));var _n=To(function(dn,Jn){if(En){var Ea=dn.link(En);return dn.ELEMENTS=Ea,Ea}return dn.ELEMENTS=null,null});return _n.value=En,_n}else if(yu in ft){ge=!0;var yn=ft[yu];return ws(yn,function(dn,Jn){var Ea=dn.shared,Bo=Ea.isBufferArgs,Da=Ea.elements,pa=dn.invoke(Jn,yn),tl=Jn.def("null"),_o=Jn.def(Bo,"(",pa,")"),Ls=dn.cond(_o).then(tl,"=",Da,".createStream(",pa,");").else(tl,"=",Da,".getElements(",pa,");");return he.optional(function(){dn.assert(Ls.else,"!"+pa+"||"+tl,"invalid elements")}),Jn.entry(Ls),Jn.exit(dn.cond(_o).then(Da,".destroyStream(",tl,");")),dn.ELEMENTS=tl,tl})}else if($e)return new ra(rt.thisDep,rt.contextDep,rt.propDep,function(dn,Jn){return Jn.def(dn.shared.vao+".currentVAO?"+dn.shared.elements+".getElements("+dn.shared.vao+".currentVAO.elements):null")});return null}var Se=Ze();function lt(){if(wo in je){var En=je[wo];return At.primitive=En,he.commandParameter(En,ir,"invalid primitve",ue.commandStr),To(function(_n,yn){return ir[En]})}else if(wo in ft){var sn=ft[wo];return ws(sn,function(_n,yn){var dn=_n.constants.primTypes,Jn=_n.invoke(yn,sn);return he.optional(function(){_n.assert(yn,Jn+" in "+dn,"invalid primitive, must be one of "+Object.keys(ir))}),yn.def(dn,"[",Jn,"]")})}else{if(ge)return Uu(Se)?Se.value?To(function(_n,yn){return yn.def(_n.ELEMENTS,".primType")}):To(function(){return eh}):new ra(Se.thisDep,Se.contextDep,Se.propDep,function(_n,yn){var dn=_n.ELEMENTS;return yn.def(dn,"?",dn,".primType:",eh)});if($e)return new ra(rt.thisDep,rt.contextDep,rt.propDep,function(_n,yn){return yn.def(_n.shared.vao+".currentVAO?"+_n.shared.vao+".currentVAO.primitive:"+eh)})}return null}function wt(En,sn){if(En in je){var _n=je[En]|0;return sn?At.offset=_n:At.instances=_n,he.command(!sn||_n>=0,"invalid "+En,ue.commandStr),To(function(dn,Jn){return sn&&(dn.OFFSET=_n),_n})}else if(En in ft){var yn=ft[En];return ws(yn,function(dn,Jn){var Ea=dn.invoke(Jn,yn);return sn&&(dn.OFFSET=Ea,he.optional(function(){dn.assert(Jn,Ea+">=0","invalid "+En)})),Ea})}else if(sn){if(ge)return To(function(dn,Jn){return dn.OFFSET=0,0});if($e)return new ra(rt.thisDep,rt.contextDep,rt.propDep,function(dn,Jn){return Jn.def(dn.shared.vao+".currentVAO?"+dn.shared.vao+".currentVAO.offset:0")})}else if($e)return new ra(rt.thisDep,rt.contextDep,rt.propDep,function(dn,Jn){return Jn.def(dn.shared.vao+".currentVAO?"+dn.shared.vao+".currentVAO.instances:-1")});return null}var fr=wt(Wf,!0);function Nr(){if(vc in je){var En=je[vc]|0;return At.count=En,he.command(typeof En=="number"&&En>=0,"invalid vertex count",ue.commandStr),To(function(){return En})}else if(vc in ft){var sn=ft[vc];return ws(sn,function(Jn,Ea){var Bo=Jn.invoke(Ea,sn);return he.optional(function(){Jn.assert(Ea,"typeof "+Bo+'==="number"&&'+Bo+">=0&&"+Bo+"===("+Bo+"|0)","invalid vertex count")}),Bo})}else if(ge)if(Uu(Se)){if(Se)return fr?new ra(fr.thisDep,fr.contextDep,fr.propDep,function(Jn,Ea){var Bo=Ea.def(Jn.ELEMENTS,".vertCount-",Jn.OFFSET);return he.optional(function(){Jn.assert(Ea,Bo+">=0","invalid vertex offset/element buffer too small")}),Bo}):To(function(Jn,Ea){return Ea.def(Jn.ELEMENTS,".vertCount")});var _n=To(function(){return-1});return he.optional(function(){_n.MISSING=!0}),_n}else{var yn=new ra(Se.thisDep||fr.thisDep,Se.contextDep||fr.contextDep,Se.propDep||fr.propDep,function(Jn,Ea){var Bo=Jn.ELEMENTS;return Jn.OFFSET?Ea.def(Bo,"?",Bo,".vertCount-",Jn.OFFSET,":-1"):Ea.def(Bo,"?",Bo,".vertCount:-1")});return he.optional(function(){yn.DYNAMIC=!0}),yn}else if($e){var dn=new ra(rt.thisDep,rt.contextDep,rt.propDep,function(Jn,Ea){return Ea.def(Jn.shared.vao,".currentVAO?",Jn.shared.vao,".currentVAO.count:-1")});return dn}return null}var Br=lt(),nn=Nr(),Lr=wt(Eh,!1);return{elements:Se,primitive:Br,count:nn,instances:Lr,offset:fr,vao:rt,vaoActive:$e,elementsActive:ge,static:At}}function no(Ee,ue){var je=Ee.static,ft=Ee.dynamic,At={};return Nn.forEach(function($e){var De=mn($e);function rt(ge,Ze){if($e in je){var Se=ge(je[$e]);At[De]=To(function(){return Se})}else if($e in ft){var lt=ft[$e];At[De]=ws(lt,function(wt,fr){return Ze(wt,fr,wt.invoke(fr,lt))})}}switch($e){case _l:case bs:case ro:case ta:case au:case jc:case mu:case Nu:case Bu:case zl:return rt(function(ge){return he.commandType(ge,"boolean",$e,ue.commandStr),ge},function(ge,Ze,Se){return he.optional(function(){ge.assert(Ze,"typeof "+Se+'==="boolean"',"invalid flag "+$e,ge.commandStr)}),Se});case Ns:return rt(function(ge){return he.commandParameter(ge,xc,"invalid "+$e,ue.commandStr),xc[ge]},function(ge,Ze,Se){var lt=ge.constants.compareFuncs;return he.optional(function(){ge.assert(Ze,Se+" in "+lt,"invalid "+$e+", must be one of "+Object.keys(xc))}),Ze.def(lt,"[",Se,"]")});case dc:return rt(function(ge){return he.command(oo(ge)&&ge.length===2&&typeof ge[0]=="number"&&typeof ge[1]=="number"&&ge[0]<=ge[1],"depth range is 2d array",ue.commandStr),ge},function(ge,Ze,Se){he.optional(function(){ge.assert(Ze,ge.shared.isArrayLike+"("+Se+")&&"+Se+".length===2&&typeof "+Se+'[0]==="number"&&typeof '+Se+'[1]==="number"&&'+Se+"[0]<="+Se+"[1]","depth range must be a 2d array")});var lt=Ze.def("+",Se,"[0]"),wt=Ze.def("+",Se,"[1]");return[lt,wt]});case os:return rt(function(ge){he.commandType(ge,"object","blend.func",ue.commandStr);var Ze="srcRGB"in ge?ge.srcRGB:ge.src,Se="srcAlpha"in ge?ge.srcAlpha:ge.src,lt="dstRGB"in ge?ge.dstRGB:ge.dst,wt="dstAlpha"in ge?ge.dstAlpha:ge.dst;return he.commandParameter(Ze,el,De+".srcRGB",ue.commandStr),he.commandParameter(Se,el,De+".srcAlpha",ue.commandStr),he.commandParameter(lt,el,De+".dstRGB",ue.commandStr),he.commandParameter(wt,el,De+".dstAlpha",ue.commandStr),he.command(Sf.indexOf(Ze+", "+lt)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+Ze+", "+lt+")",ue.commandStr),[el[Ze],el[lt],el[Se],el[wt]]},function(ge,Ze,Se){var lt=ge.constants.blendFuncs;he.optional(function(){ge.assert(Ze,Se+"&&typeof "+Se+'==="object"',"invalid blend func, must be an object")});function wt(sn,_n){var yn=Ze.def('"',sn,_n,'" in ',Se,"?",Se,".",sn,_n,":",Se,".",sn);return he.optional(function(){ge.assert(Ze,yn+" in "+lt,"invalid "+$e+"."+sn+_n+", must be one of "+Object.keys(el))}),yn}var fr=wt("src","RGB"),Nr=wt("dst","RGB");he.optional(function(){var sn=ge.constants.invalidBlendCombinations;ge.assert(Ze,sn+".indexOf("+fr+'+", "+'+Nr+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var Br=Ze.def(lt,"[",fr,"]"),nn=Ze.def(lt,"[",wt("src","Alpha"),"]"),Lr=Ze.def(lt,"[",Nr,"]"),En=Ze.def(lt,"[",wt("dst","Alpha"),"]");return[Br,Lr,nn,En]});case Du:return rt(function(ge){if(typeof ge=="string")return he.commandParameter(ge,jt,"invalid "+$e,ue.commandStr),[jt[ge],jt[ge]];if(typeof ge=="object")return he.commandParameter(ge.rgb,jt,$e+".rgb",ue.commandStr),he.commandParameter(ge.alpha,jt,$e+".alpha",ue.commandStr),[jt[ge.rgb],jt[ge.alpha]];he.commandRaise("invalid blend.equation",ue.commandStr)},function(ge,Ze,Se){var lt=ge.constants.blendEquations,wt=Ze.def(),fr=Ze.def(),Nr=ge.cond("typeof ",Se,'==="string"');return he.optional(function(){function Br(nn,Lr,En){ge.assert(nn,En+" in "+lt,"invalid "+Lr+", must be one of "+Object.keys(jt))}Br(Nr.then,$e,Se),ge.assert(Nr.else,Se+"&&typeof "+Se+'==="object"',"invalid "+$e),Br(Nr.else,$e+".rgb",Se+".rgb"),Br(Nr.else,$e+".alpha",Se+".alpha")}),Nr.then(wt,"=",fr,"=",lt,"[",Se,"];"),Nr.else(wt,"=",lt,"[",Se,".rgb];",fr,"=",lt,"[",Se,".alpha];"),Ze(Nr),[wt,fr]});case es:return rt(function(ge){return he.command(oo(ge)&&ge.length===4,"blend.color must be a 4d array",ue.commandStr),Ge(4,function(Ze){return+ge[Ze]})},function(ge,Ze,Se){return he.optional(function(){ge.assert(Ze,ge.shared.isArrayLike+"("+Se+")&&"+Se+".length===4","blend.color must be a 4d array")}),Ge(4,function(lt){return Ze.def("+",Se,"[",lt,"]")})});case Es:return rt(function(ge){return he.commandType(ge,"number",De,ue.commandStr),ge|0},function(ge,Ze,Se){return he.optional(function(){ge.assert(Ze,"typeof "+Se+'==="number"',"invalid stencil.mask")}),Ze.def(Se,"|0")});case ss:return rt(function(ge){he.commandType(ge,"object",De,ue.commandStr);var Ze=ge.cmp||"keep",Se=ge.ref||0,lt="mask"in ge?ge.mask:-1;return he.commandParameter(Ze,xc,$e+".cmp",ue.commandStr),he.commandType(Se,"number",$e+".ref",ue.commandStr),he.commandType(lt,"number",$e+".mask",ue.commandStr),[xc[Ze],Se,lt]},function(ge,Ze,Se){var lt=ge.constants.compareFuncs;he.optional(function(){function Br(){ge.assert(Ze,Array.prototype.join.call(arguments,""),"invalid stencil.func")}Br(Se+"&&typeof ",Se,'==="object"'),Br('!("cmp" in ',Se,")||(",Se,".cmp in ",lt,")")});var wt=Ze.def('"cmp" in ',Se,"?",lt,"[",Se,".cmp]",":",uu),fr=Ze.def(Se,".ref|0"),Nr=Ze.def('"mask" in ',Se,"?",Se,".mask|0:-1");return[wt,fr,Nr]});case Ju:case Vc:return rt(function(ge){he.commandType(ge,"object",De,ue.commandStr);var Ze=ge.fail||"keep",Se=ge.zfail||"keep",lt=ge.zpass||"keep";return he.commandParameter(Ze,bc,$e+".fail",ue.commandStr),he.commandParameter(Se,bc,$e+".zfail",ue.commandStr),he.commandParameter(lt,bc,$e+".zpass",ue.commandStr),[$e===Vc?Wc:Qu,bc[Ze],bc[Se],bc[lt]]},function(ge,Ze,Se){var lt=ge.constants.stencilOps;he.optional(function(){ge.assert(Ze,Se+"&&typeof "+Se+'==="object"',"invalid "+$e)});function wt(fr){return he.optional(function(){ge.assert(Ze,'!("'+fr+'" in '+Se+")||("+Se+"."+fr+" in "+lt+")","invalid "+$e+"."+fr+", must be one of "+Object.keys(bc))}),Ze.def('"',fr,'" in ',Se,"?",lt,"[",Se,".",fr,"]:",uu)}return[$e===Vc?Wc:Qu,wt("fail"),wt("zfail"),wt("zpass")]});case go:return rt(function(ge){he.commandType(ge,"object",De,ue.commandStr);var Ze=ge.factor|0,Se=ge.units|0;return he.commandType(Ze,"number",De+".factor",ue.commandStr),he.commandType(Se,"number",De+".units",ue.commandStr),[Ze,Se]},function(ge,Ze,Se){he.optional(function(){ge.assert(Ze,Se+"&&typeof "+Se+'==="object"',"invalid "+$e)});var lt=Ze.def(Se,".factor|0"),wt=Ze.def(Se,".units|0");return[lt,wt]});case Ul:return rt(function(ge){var Ze=0;return ge==="front"?Ze=Qu:ge==="back"&&(Ze=Wc),he.command(!!Ze,De,ue.commandStr),Ze},function(ge,Ze,Se){return he.optional(function(){ge.assert(Ze,Se+'==="front"||'+Se+'==="back"',"invalid cull.face")}),Ze.def(Se,'==="front"?',Qu,":",Wc)});case Zl:return rt(function(ge){return he.command(typeof ge=="number"&&ge>=It.lineWidthDims[0]&&ge<=It.lineWidthDims[1],"invalid line width, must be a positive number between "+It.lineWidthDims[0]+" and "+It.lineWidthDims[1],ue.commandStr),ge},function(ge,Ze,Se){return he.optional(function(){ge.assert(Ze,"typeof "+Se+'==="number"&&'+Se+">="+It.lineWidthDims[0]+"&&"+Se+"<="+It.lineWidthDims[1],"invalid line width")}),Se});case ou:return rt(function(ge){return he.commandParameter(ge,ap,De,ue.commandStr),ap[ge]},function(ge,Ze,Se){return he.optional(function(){ge.assert(Ze,Se+'==="cw"||'+Se+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),Ze.def(Se+'==="cw"?'+ip+":"+th)});case Fu:return rt(function(ge){return he.command(oo(ge)&&ge.length===4,"color.mask must be length 4 array",ue.commandStr),ge.map(function(Ze){return!!Ze})},function(ge,Ze,Se){return he.optional(function(){ge.assert(Ze,ge.shared.isArrayLike+"("+Se+")&&"+Se+".length===4","invalid color.mask")}),Ge(4,function(lt){return"!!"+Se+"["+lt+"]"})});case $u:return rt(function(ge){he.command(typeof ge=="object"&&ge,De,ue.commandStr);var Ze="value"in ge?ge.value:1,Se=!!ge.invert;return he.command(typeof Ze=="number"&&Ze>=0&&Ze<=1,"sample.coverage.value must be a number between 0 and 1",ue.commandStr),[Ze,Se]},function(ge,Ze,Se){he.optional(function(){ge.assert(Ze,Se+"&&typeof "+Se+'==="object"',"invalid sample.coverage")});var lt=Ze.def('"value" in ',Se,"?+",Se,".value:1"),wt=Ze.def("!!",Se,".invert");return[lt,wt]})}}),At}function ki(Ee,ue){var je=Ee.static,ft=Ee.dynamic,At={};return Object.keys(je).forEach(function($e){var De=je[$e],rt;if(typeof De=="number"||typeof De=="boolean")rt=To(function(){return De});else if(typeof De=="function"){var ge=De._reglType;ge==="texture2d"||ge==="textureCube"?rt=To(function(Ze){return Ze.link(De)}):ge==="framebuffer"||ge==="framebufferCube"?(he.command(De.color.length>0,'missing color attachment for framebuffer sent to uniform "'+$e+'"',ue.commandStr),rt=To(function(Ze){return Ze.link(De.color[0])})):he.commandRaise('invalid data for uniform "'+$e+'"',ue.commandStr)}else oo(De)?rt=To(function(Ze){var Se=Ze.global.def("[",Ge(De.length,function(lt){return he.command(typeof De[lt]=="number"||typeof De[lt]=="boolean","invalid uniform "+$e,Ze.commandStr),De[lt]}),"]");return Se}):he.commandRaise('invalid or missing data for uniform "'+$e+'"',ue.commandStr);rt.value=De,At[$e]=rt}),Object.keys(ft).forEach(function($e){var De=ft[$e];At[$e]=ws(De,function(rt,ge){return rt.invoke(ge,De)})}),At}function No(Ee,ue){var je=Ee.static,ft=Ee.dynamic,At={};return Object.keys(je).forEach(function($e){var De=je[$e],rt=ve.id($e),ge=new ut;if(Oh(De))ge.state=Hn,ge.buffer=ar.getBuffer(ar.create(De,gf,!1,!0)),ge.type=0;else{var Ze=ar.getBuffer(De);if(Ze)ge.state=Hn,ge.buffer=Ze,ge.type=0;else if(he.command(typeof De=="object"&&De,"invalid data for attribute "+$e,ue.commandStr),"constant"in De){var Se=De.constant;ge.buffer="null",ge.state=mi,typeof Se=="number"?ge.x=Se:(he.command(oo(Se)&&Se.length>0&&Se.length<=4,"invalid constant for attribute "+$e,ue.commandStr),si.forEach(function(Lr,En){En<Se.length&&(ge[Lr]=Se[En])}))}else{Oh(De.buffer)?Ze=ar.getBuffer(ar.create(De.buffer,gf,!1,!0)):Ze=ar.getBuffer(De.buffer),he.command(!!Ze,'missing buffer for attribute "'+$e+'"',ue.commandStr);var lt=De.offset|0;he.command(lt>=0,'invalid offset for attribute "'+$e+'"',ue.commandStr);var wt=De.stride|0;he.command(wt>=0&&wt<256,'invalid stride for attribute "'+$e+'", must be integer betweeen [0, 255]',ue.commandStr);var fr=De.size|0;he.command(!("size"in De)||fr>0&&fr<=4,'invalid size for attribute "'+$e+'", must be 1,2,3,4',ue.commandStr);var Nr=!!De.normalized,Br=0;"type"in De&&(he.commandParameter(De.type,$s,"invalid type for attribute "+$e,ue.commandStr),Br=$s[De.type]);var nn=De.divisor|0;he.optional(function(){"divisor"in De&&(he.command(nn===0||_r,'cannot specify divisor for attribute "'+$e+'", instancing not supported',ue.commandStr),he.command(nn>=0,'invalid divisor for attribute "'+$e+'"',ue.commandStr));var Lr=ue.commandStr,En=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(De).forEach(function(sn){he.command(En.indexOf(sn)>=0,'unknown parameter "'+sn+'" for attribute pointer "'+$e+'" (valid parameters are '+En+")",Lr)})}),ge.buffer=Ze,ge.state=Hn,ge.size=fr,ge.normalized=Nr,ge.type=Br||Ze.dtype,ge.offset=lt,ge.stride=wt,ge.divisor=nn}}At[$e]=To(function(Lr,En){var sn=Lr.attribCache;if(rt in sn)return sn[rt];var _n={isStream:!1};return Object.keys(ge).forEach(function(yn){_n[yn]=ge[yn]}),ge.buffer&&(_n.buffer=Lr.link(ge.buffer),_n.type=_n.type||_n.buffer+".dtype"),sn[rt]=_n,_n})}),Object.keys(ft).forEach(function($e){var De=ft[$e];function rt(ge,Ze){var Se=ge.invoke(Ze,De),lt=ge.shared,wt=ge.constants,fr=lt.isBufferArgs,Nr=lt.buffer;he.optional(function(){ge.assert(Ze,Se+"&&(typeof "+Se+'==="object"||typeof '+Se+'==="function")&&('+fr+"("+Se+")||"+Nr+".getBuffer("+Se+")||"+Nr+".getBuffer("+Se+".buffer)||"+fr+"("+Se+'.buffer)||("constant" in '+Se+"&&(typeof "+Se+'.constant==="number"||'+lt.isArrayLike+"("+Se+".constant))))",'invalid dynamic attribute "'+$e+'"')});var Br={isStream:Ze.def(!1)},nn=new ut;nn.state=Hn,Object.keys(nn).forEach(function(_n){Br[_n]=Ze.def(""+nn[_n])});var Lr=Br.buffer,En=Br.type;Ze("if(",fr,"(",Se,")){",Br.isStream,"=true;",Lr,"=",Nr,".createStream(",gf,",",Se,");",En,"=",Lr,".dtype;","}else{",Lr,"=",Nr,".getBuffer(",Se,");","if(",Lr,"){",En,"=",Lr,".dtype;",'}else if("constant" in ',Se,"){",Br.state,"=",mi,";","if(typeof "+Se+'.constant === "number"){',Br[si[0]],"=",Se,".constant;",si.slice(1).map(function(_n){return Br[_n]}).join("="),"=0;","}else{",si.map(function(_n,yn){return Br[_n]+"="+Se+".constant.length>"+yn+"?"+Se+".constant["+yn+"]:0;"}).join(""),"}}else{","if(",fr,"(",Se,".buffer)){",Lr,"=",Nr,".createStream(",gf,",",Se,".buffer);","}else{",Lr,"=",Nr,".getBuffer(",Se,".buffer);","}",En,'="type" in ',Se,"?",wt.glTypes,"[",Se,".type]:",Lr,".dtype;",Br.normalized,"=!!",Se,".normalized;");function sn(_n){Ze(Br[_n],"=",Se,".",_n,"|0;")}return sn("size"),sn("offset"),sn("stride"),sn("divisor"),Ze("}}"),Ze.exit("if(",Br.isStream,"){",Nr,".destroyStream(",Lr,");","}"),Br}At[$e]=ws(De,rt)}),At}function Va(Ee){var ue=Ee.static,je=Ee.dynamic,ft={};return Object.keys(ue).forEach(function(At){var $e=ue[At];ft[At]=To(function(De,rt){return typeof $e=="number"||typeof $e=="boolean"?""+$e:De.link($e)})}),Object.keys(je).forEach(function(At){var $e=je[At];ft[At]=ws($e,function(De,rt){return De.invoke(rt,$e)})}),ft}function Ho(Ee,ue,je,ft,At){var $e=Ee.static,De=Ee.dynamic;he.optional(function(){var sn=[su,xl,Gc,yu,wo,Wf,vc,Eh,gu,vf].concat(Nn);function _n(yn){Object.keys(yn).forEach(function(dn){he.command(sn.indexOf(dn)>=0,'unknown parameter "'+dn+'"',At.commandStr)})}_n($e),_n(De)});var rt=ui(Ee,ue),ge=rn(Ee,At),Ze=$n(Ee,ge,At),Se=qa(Ee,At),lt=no(Ee,At),wt=zi(Ee,At,rt);function fr(sn){var _n=Ze[sn];_n&&(lt[sn]=_n)}fr(Xs),fr(mn(df));var Nr=Object.keys(lt).length>0,Br={framebuffer:ge,draw:Se,shader:wt,state:lt,dirty:Nr,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(Br.profile=Xr(Ee,At),Br.uniforms=ki(je,At),Br.drawVAO=Br.scopeVAO=Se.vao,!Br.drawVAO&&wt.program&&!rt&&Be.angle_instanced_arrays&&Se.static.elements){var nn=!0,Lr=wt.program.attributes.map(function(sn){var _n=ue.static[sn];return nn=nn&&!!_n,_n});if(nn&&Lr.length>0){var En=yr.getVAO(yr.createVAO({attributes:Lr,elements:Se.static.elements}));Br.drawVAO=new ra(null,null,null,function(sn,_n){return sn.link(En)}),Br.useVAO=!0}}return rt?Br.useVAO=!0:Br.attributes=No(ue,At),Br.context=Va(ft,At),Br}function yo(Ee,ue,je){var ft=Ee.shared,At=ft.context,$e=Ee.scope();Object.keys(je).forEach(function(De){ue.save(At,"."+De);var rt=je[De],ge=rt.append(Ee,ue);Array.isArray(ge)?$e(At,".",De,"=[",ge.join(),"];"):$e(At,".",De,"=",ge,";")}),ue($e)}function Bn(Ee,ue,je,ft){var At=Ee.shared,$e=At.gl,De=At.framebuffer,rt;kr&&(rt=ue.def(At.extensions,".webgl_draw_buffers"));var ge=Ee.constants,Ze=ge.drawBuffer,Se=ge.backBuffer,lt;je?lt=je.append(Ee,ue):lt=ue.def(De,".next"),ft||ue("if(",lt,"!==",De,".cur){"),ue("if(",lt,"){",$e,".bindFramebuffer(",Hp,",",lt,".framebuffer);"),kr&&ue(rt,".drawBuffersWEBGL(",Ze,"[",lt,".colorAttachments.length]);"),ue("}else{",$e,".bindFramebuffer(",Hp,",null);"),kr&&ue(rt,".drawBuffersWEBGL(",Se,");"),ue("}",De,".cur=",lt,";"),ft||ue("}")}function Ln(Ee,ue,je){var ft=Ee.shared,At=ft.gl,$e=Ee.current,De=Ee.next,rt=ft.current,ge=ft.next,Ze=Ee.cond(rt,".dirty");Nn.forEach(function(Se){var lt=mn(Se);if(!(lt in je.state)){var wt,fr;if(lt in De){wt=De[lt],fr=$e[lt];var Nr=Ge(Rr[lt].length,function(nn){return Ze.def(wt,"[",nn,"]")});Ze(Ee.cond(Nr.map(function(nn,Lr){return nn+"!=="+fr+"["+Lr+"]"}).join("||")).then(At,".",rr[lt],"(",Nr,");",Nr.map(function(nn,Lr){return fr+"["+Lr+"]="+nn}).join(";"),";"))}else{wt=Ze.def(ge,".",lt);var Br=Ee.cond(wt,"!==",rt,".",lt);Ze(Br),lt in er?Br(Ee.cond(wt).then(At,".enable(",er[lt],");").else(At,".disable(",er[lt],");"),rt,".",lt,"=",wt,";"):Br(At,".",rr[lt],"(",wt,");",rt,".",lt,"=",wt,";")}}}),Object.keys(je.state).length===0&&Ze(rt,".dirty=false;"),ue(Ze)}function ts(Ee,ue,je,ft){var At=Ee.shared,$e=Ee.current,De=At.current,rt=At.gl;zu(Object.keys(je)).forEach(function(ge){var Ze=je[ge];if(!(ft&&!ft(Ze))){var Se=Ze.append(Ee,ue);if(er[ge]){var lt=er[ge];Uu(Ze)?Se?ue(rt,".enable(",lt,");"):ue(rt,".disable(",lt,");"):ue(Ee.cond(Se).then(rt,".enable(",lt,");").else(rt,".disable(",lt,");")),ue(De,".",ge,"=",Se,";")}else if(oo(Se)){var wt=$e[ge];ue(rt,".",rr[ge],"(",Se,");",Se.map(function(fr,Nr){return wt+"["+Nr+"]="+fr}).join(";"),";")}else ue(rt,".",rr[ge],"(",Se,");",De,".",ge,"=",Se,";")}})}function po(Ee,ue){_r&&(Ee.instancing=ue.def(Ee.shared.extensions,".angle_instanced_arrays"))}function xi(Ee,ue,je,ft,At){var $e=Ee.shared,De=Ee.stats,rt=$e.current,ge=$e.timer,Ze=je.profile;function Se(){var sn=typeof my!="undefined"&&!!my&&typeof my.showToast=="function";return sn||typeof performance=="undefined"?"Date.now()":"performance.now()"}var lt,wt;function fr(sn){lt=ue.def(),sn(lt,"=",Se(),";"),typeof At=="string"?sn(De,".count+=",At,";"):sn(De,".count++;"),gr&&(ft?(wt=ue.def(),sn(wt,"=",ge,".getNumPendingQueries();")):sn(ge,".beginQuery(",De,");"))}function Nr(sn){sn(De,".cpuTime+=",Se(),"-",lt,";"),gr&&(ft?sn(ge,".pushScopeStats(",wt,",",ge,".getNumPendingQueries(),",De,");"):sn(ge,".endQuery();"))}function Br(sn){var _n=ue.def(rt,".profile");ue(rt,".profile=",sn,";"),ue.exit(rt,".profile=",_n,";")}var nn;if(Ze){if(Uu(Ze)){Ze.enable?(fr(ue),Nr(ue.exit),Br("true")):Br("false");return}nn=Ze.append(Ee,ue),Br(nn)}else nn=ue.def(rt,".profile");var Lr=Ee.block();fr(Lr),ue("if(",nn,"){",Lr,"}");var En=Ee.block();Nr(En),ue.exit("if(",nn,"){",En,"}")}function Wo(Ee,ue,je,ft,At){var $e=Ee.shared;function De(ge){switch(ge){case _f:case Th:case Mh:return 2;case Vl:case _c:case xf:return 3;case yc:case Ah:case Hc:return 4;default:return 1}}function rt(ge,Ze,Se){var lt=$e.gl,wt=ue.def(ge,".location"),fr=ue.def($e.attributes,"[",wt,"]"),Nr=Se.state,Br=Se.buffer,nn=[Se.x,Se.y,Se.z,Se.w],Lr=["buffer","normalized","offset","stride"];function En(){ue("if(!",fr,".buffer){",lt,".enableVertexAttribArray(",wt,");}");var _n=Se.type,yn;if(Se.size?yn=ue.def(Se.size,"||",Ze):yn=Ze,ue("if(",fr,".type!==",_n,"||",fr,".size!==",yn,"||",Lr.map(function(Jn){return fr+"."+Jn+"!=="+Se[Jn]}).join("||"),"){",lt,".bindBuffer(",gf,",",Br,".buffer);",lt,".vertexAttribPointer(",[wt,yn,_n,Se.normalized,Se.stride,Se.offset],");",fr,".type=",_n,";",fr,".size=",yn,";",Lr.map(function(Jn){return fr+"."+Jn+"="+Se[Jn]+";"}).join(""),"}"),_r){var dn=Se.divisor;ue("if(",fr,".divisor!==",dn,"){",Ee.instancing,".vertexAttribDivisorANGLE(",[wt,dn],");",fr,".divisor=",dn,";}")}}function sn(){ue("if(",fr,".buffer){",lt,".disableVertexAttribArray(",wt,");",fr,".buffer=null;","}if(",si.map(function(_n,yn){return fr+"."+_n+"!=="+nn[yn]}).join("||"),"){",lt,".vertexAttrib4f(",wt,",",nn,");",si.map(function(_n,yn){return fr+"."+_n+"="+nn[yn]+";"}).join(""),"}")}Nr===Hn?En():Nr===mi?sn():(ue("if(",Nr,"===",Hn,"){"),En(),ue("}else{"),sn(),ue("}"))}ft.forEach(function(ge){var Ze=ge.name,Se=je.attributes[Ze],lt;if(Se){if(!At(Se))return;lt=Se.append(Ee,ue)}else{if(!At(Rh))return;var wt=Ee.scopeAttrib(Ze);he.optional(function(){Ee.assert(ue,wt+".state","missing attribute "+Ze)}),lt={},Object.keys(new ut).forEach(function(fr){lt[fr]=ue.def(wt,".",fr)})}rt(Ee.link(ge),De(ge.info.type),lt)})}function ua(Ee,ue,je,ft,At,$e){for(var De=Ee.shared,rt=De.gl,ge,Ze=0;Ze<ft.length;++Ze){var Se=ft[Ze],lt=Se.name,wt=Se.info.type,fr=je.uniforms[lt],Nr=Ee.link(Se),Br=Nr+".location",nn;if(fr){if(!At(fr))continue;if(Uu(fr)){var Lr=fr.value;if(he.command(Lr!==null&&typeof Lr!="undefined",'missing uniform "'+lt+'"',Ee.commandStr),wt===Ph||wt===Qf){he.command(typeof Lr=="function"&&(wt===Ph&&(Lr._reglType==="texture2d"||Lr._reglType==="framebuffer")||wt===Qf&&(Lr._reglType==="textureCube"||Lr._reglType==="framebufferCube")),"invalid texture for uniform "+lt,Ee.commandStr);var En=Ee.link(Lr._texture||Lr.color[0]._texture);ue(rt,".uniform1i(",Br,",",En+".bind());"),ue.exit(En,".unbind();")}else if(wt===Ys||wt===bf||wt===Jf){he.optional(function(){he.command(oo(Lr),"invalid matrix for uniform "+lt,Ee.commandStr),he.command(wt===Ys&&Lr.length===4||wt===bf&&Lr.length===9||wt===Jf&&Lr.length===16,"invalid length for matrix uniform "+lt,Ee.commandStr)});var sn=Ee.global.def("new Float32Array(["+Array.prototype.slice.call(Lr)+"])"),_n=2;wt===bf?_n=3:wt===Jf&&(_n=4),ue(rt,".uniformMatrix",_n,"fv(",Br,",false,",sn,");")}else{switch(wt){case Ch:he.commandType(Lr,"number","uniform "+lt,Ee.commandStr),ge="1f";break;case _f:he.command(oo(Lr)&&Lr.length===2,"uniform "+lt,Ee.commandStr),ge="2f";break;case Vl:he.command(oo(Lr)&&Lr.length===3,"uniform "+lt,Ee.commandStr),ge="3f";break;case yc:he.command(oo(Lr)&&Lr.length===4,"uniform "+lt,Ee.commandStr),ge="4f";break;case $f:he.commandType(Lr,"boolean","uniform "+lt,Ee.commandStr),ge="1i";break;case Kf:he.commandType(Lr,"number","uniform "+lt,Ee.commandStr),ge="1i";break;case Mh:he.command(oo(Lr)&&Lr.length===2,"uniform "+lt,Ee.commandStr),ge="2i";break;case Th:he.command(oo(Lr)&&Lr.length===2,"uniform "+lt,Ee.commandStr),ge="2i";break;case xf:he.command(oo(Lr)&&Lr.length===3,"uniform "+lt,Ee.commandStr),ge="3i";break;case _c:he.command(oo(Lr)&&Lr.length===3,"uniform "+lt,Ee.commandStr),ge="3i";break;case Hc:he.command(oo(Lr)&&Lr.length===4,"uniform "+lt,Ee.commandStr),ge="4i";break;case Ah:he.command(oo(Lr)&&Lr.length===4,"uniform "+lt,Ee.commandStr),ge="4i";break}ue(rt,".uniform",ge,"(",Br,",",oo(Lr)?Array.prototype.slice.call(Lr):Lr,");")}continue}else nn=fr.append(Ee,ue)}else{if(!At(Rh))continue;nn=ue.def(De.uniforms,"[",ve.id(lt),"]")}wt===Ph?(he(!Array.isArray(nn),"must specify a scalar prop for textures"),ue("if(",nn,"&&",nn,'._reglType==="framebuffer"){',nn,"=",nn,".color[0];","}")):wt===Qf&&(he(!Array.isArray(nn),"must specify a scalar prop for cube maps"),ue("if(",nn,"&&",nn,'._reglType==="framebufferCube"){',nn,"=",nn,".color[0];","}")),he.optional(function(){function _o(cu,El){Ee.assert(ue,cu,'bad data or missing for uniform "'+lt+'".  '+El)}function Ls(cu){he(!Array.isArray(nn),"must not specify an array type for uniform"),_o("typeof "+nn+'==="'+cu+'"',"invalid type, expected "+cu)}function lu(cu,El){Array.isArray(nn)?he(nn.length===cu,"must have length "+cu):_o(De.isArrayLike+"("+nn+")&&"+nn+".length==="+cu,"invalid vector, should have length "+cu,Ee.commandStr)}function kh(cu){he(!Array.isArray(nn),"must not specify a value type"),_o("typeof "+nn+'==="function"&&'+nn+'._reglType==="texture'+(cu===tp?"2d":"Cube")+'"',"invalid texture type",Ee.commandStr)}switch(wt){case Kf:Ls("number");break;case Th:lu(2,"number");break;case _c:lu(3,"number");break;case Ah:lu(4,"number");break;case Ch:Ls("number");break;case _f:lu(2,"number");break;case Vl:lu(3,"number");break;case yc:lu(4,"number");break;case $f:Ls("boolean");break;case Mh:lu(2,"boolean");break;case xf:lu(3,"boolean");break;case Hc:lu(4,"boolean");break;case Ys:lu(4,"number");break;case bf:lu(9,"number");break;case Jf:lu(16,"number");break;case Ph:kh(tp);break;case Qf:kh(rp);break}});var yn=1;switch(wt){case Ph:case Qf:var dn=ue.def(nn,"._texture");ue(rt,".uniform1i(",Br,",",dn,".bind());"),ue.exit(dn,".unbind();");continue;case Kf:case $f:ge="1i";break;case Th:case Mh:ge="2i",yn=2;break;case _c:case xf:ge="3i",yn=3;break;case Ah:case Hc:ge="4i",yn=4;break;case Ch:ge="1f";break;case _f:ge="2f",yn=2;break;case Vl:ge="3f",yn=3;break;case yc:ge="4f",yn=4;break;case Ys:ge="Matrix2fv";break;case bf:ge="Matrix3fv";break;case Jf:ge="Matrix4fv";break}if(ge.charAt(0)==="M"){ue(rt,".uniform",ge,"(",Br,",");var Jn=Math.pow(wt-Ys+2,2),Ea=Ee.global.def("new Float32Array(",Jn,")");Array.isArray(nn)?ue("false,(",Ge(Jn,function(_o){return Ea+"["+_o+"]="+nn[_o]}),",",Ea,")"):ue("false,(Array.isArray(",nn,")||",nn," instanceof Float32Array)?",nn,":(",Ge(Jn,function(_o){return Ea+"["+_o+"]="+nn+"["+_o+"]"}),",",Ea,")"),ue(");")}else if(yn>1){for(var Bo=[],Da=[],pa=0;pa<yn;++pa)Array.isArray(nn)?Da.push(nn[pa]):Da.push(ue.def(nn+"["+pa+"]")),$e&&Bo.push(ue.def());$e&&ue("if(!",Ee.batchId,"||",Bo.map(function(_o,Ls){return _o+"!=="+Da[Ls]}).join("||"),"){",Bo.map(function(_o,Ls){return _o+"="+Da[Ls]+";"}).join("")),ue(rt,".uniform",ge,"(",Br,",",Da.join(","),");"),$e&&ue("}")}else{if(he(!Array.isArray(nn),"uniform value must not be an array"),$e){var tl=ue.def();ue("if(!",Ee.batchId,"||",tl,"!==",nn,"){",tl,"=",nn,";")}ue(rt,".uniform",ge,"(",Br,",",nn,");"),$e&&ue("}")}}}function us(Ee,ue,je,ft){var At=Ee.shared,$e=At.gl,De=At.draw,rt=ft.draw;function ge(){var yn=rt.elements,dn,Jn=ue;return yn?((yn.contextDep&&ft.contextDynamic||yn.propDep)&&(Jn=je),dn=yn.append(Ee,Jn),rt.elementsActive&&Jn("if("+dn+")"+$e+".bindBuffer("+ep+","+dn+".buffer.buffer);")):(dn=Jn.def(),Jn(dn,"=",De,".",yu,";","if(",dn,"){",$e,".bindBuffer(",ep,",",dn,".buffer.buffer);}","else if(",At.vao,".currentVAO){",dn,"=",Ee.shared.elements+".getElements("+At.vao,".currentVAO.elements);",ur?"":"if("+dn+")"+$e+".bindBuffer("+ep+","+dn+".buffer.buffer);","}")),dn}function Ze(){var yn=rt.count,dn,Jn=ue;return yn?((yn.contextDep&&ft.contextDynamic||yn.propDep)&&(Jn=je),dn=yn.append(Ee,Jn),he.optional(function(){yn.MISSING&&Ee.assert(ue,"false","missing vertex count"),yn.DYNAMIC&&Ee.assert(Jn,dn+">=0","missing vertex count")})):(dn=Jn.def(De,".",vc),he.optional(function(){Ee.assert(Jn,dn+">=0","missing vertex count")})),dn}var Se=ge();function lt(yn){var dn=rt[yn];return dn?dn.contextDep&&ft.contextDynamic||dn.propDep?dn.append(Ee,je):dn.append(Ee,ue):ue.def(De,".",yn)}var wt=lt(wo),fr=lt(Wf),Nr=Ze();if(typeof Nr=="number"){if(Nr===0)return}else je("if(",Nr,"){"),je.exit("}");var Br,nn;_r&&(Br=lt(Eh),nn=Ee.instancing);var Lr=Se+".type",En=rt.elements&&Uu(rt.elements)&&!rt.vaoActive;function sn(){function yn(){je(nn,".drawElementsInstancedANGLE(",[wt,Nr,Lr,fr+"<<(("+Lr+"-"+Qn+")>>1)",Br],");")}function dn(){je(nn,".drawArraysInstancedANGLE(",[wt,fr,Nr,Br],");")}Se&&Se!=="null"?En?yn():(je("if(",Se,"){"),yn(),je("}else{"),dn(),je("}")):dn()}function _n(){function yn(){je($e+".drawElements("+[wt,Nr,Lr,fr+"<<(("+Lr+"-"+Qn+")>>1)"]+");")}function dn(){je($e+".drawArrays("+[wt,fr,Nr]+");")}Se&&Se!=="null"?En?yn():(je("if(",Se,"){"),yn(),je("}else{"),dn(),je("}")):dn()}_r&&(typeof Br!="number"||Br>=0)?typeof Br=="string"?(je("if(",Br,">0){"),sn(),je("}else if(",Br,"<0){"),_n(),je("}")):sn():_n()}function ai(Ee,ue,je,ft,At){var $e=ei(),De=$e.proc("body",At);return he.optional(function(){$e.commandStr=ue.commandStr,$e.command=$e.link(ue.commandStr)}),_r&&($e.instancing=De.def($e.shared.extensions,".angle_instanced_arrays")),Ee($e,De,je,ft),$e.compile().body}function Ui(Ee,ue,je,ft){po(Ee,ue),je.useVAO?je.drawVAO?ue(Ee.shared.vao,".setVAO(",je.drawVAO.append(Ee,ue),");"):ue(Ee.shared.vao,".setVAO(",Ee.shared.vao,".targetVAO);"):(ue(Ee.shared.vao,".setVAO(null);"),Wo(Ee,ue,je,ft.attributes,function(){return!0})),ua(Ee,ue,je,ft.uniforms,function(){return!0},!1),us(Ee,ue,ue,je)}function ya(Ee,ue){var je=Ee.proc("draw",1);po(Ee,je),yo(Ee,je,ue.context),Bn(Ee,je,ue.framebuffer),Ln(Ee,je,ue),ts(Ee,je,ue.state),xi(Ee,je,ue,!1,!0);var ft=ue.shader.progVar.append(Ee,je);if(je(Ee.shared.gl,".useProgram(",ft,".program);"),ue.shader.program)Ui(Ee,je,ue,ue.shader.program);else{je(Ee.shared.vao,".setVAO(null);");var At=Ee.global.def("{}"),$e=je.def(ft,".id"),De=je.def(At,"[",$e,"]");je(Ee.cond(De).then(De,".call(this,a0);").else(De,"=",At,"[",$e,"]=",Ee.link(function(rt){return ai(Ui,Ee,ue,rt,1)}),"(",ft,");",De,".call(this,a0);"))}Object.keys(ue.state).length>0&&je(Ee.shared.current,".dirty=true;"),Ee.shared.vao&&je(Ee.shared.vao,".setVAO(null);")}function Ao(Ee,ue,je,ft){Ee.batchId="a1",po(Ee,ue);function At(){return!0}Wo(Ee,ue,je,ft.attributes,At),ua(Ee,ue,je,ft.uniforms,At,!1),us(Ee,ue,ue,je)}function Gl(Ee,ue,je,ft){po(Ee,ue);var At=je.contextDep,$e=ue.def(),De="a0",rt="a1",ge=ue.def();Ee.shared.props=ge,Ee.batchId=$e;var Ze=Ee.scope(),Se=Ee.scope();ue(Ze.entry,"for(",$e,"=0;",$e,"<",rt,";++",$e,"){",ge,"=",De,"[",$e,"];",Se,"}",Ze.exit);function lt(Lr){return Lr.contextDep&&At||Lr.propDep}function wt(Lr){return!lt(Lr)}if(je.needsContext&&yo(Ee,Se,je.context),je.needsFramebuffer&&Bn(Ee,Se,je.framebuffer),ts(Ee,Se,je.state,lt),je.profile&&lt(je.profile)&&xi(Ee,Se,je,!1,!0),ft)je.useVAO?je.drawVAO?lt(je.drawVAO)?Se(Ee.shared.vao,".setVAO(",je.drawVAO.append(Ee,Se),");"):Ze(Ee.shared.vao,".setVAO(",je.drawVAO.append(Ee,Ze),");"):Ze(Ee.shared.vao,".setVAO(",Ee.shared.vao,".targetVAO);"):(Ze(Ee.shared.vao,".setVAO(null);"),Wo(Ee,Ze,je,ft.attributes,wt),Wo(Ee,Se,je,ft.attributes,lt)),ua(Ee,Ze,je,ft.uniforms,wt,!1),ua(Ee,Se,je,ft.uniforms,lt,!0),us(Ee,Ze,Se,je);else{var fr=Ee.global.def("{}"),Nr=je.shader.progVar.append(Ee,Se),Br=Se.def(Nr,".id"),nn=Se.def(fr,"[",Br,"]");Se(Ee.shared.gl,".useProgram(",Nr,".program);","if(!",nn,"){",nn,"=",fr,"[",Br,"]=",Ee.link(function(Lr){return ai(Ao,Ee,je,Lr,2)}),"(",Nr,");}",nn,".call(this,a0[",$e,"],",$e,");")}}function Ae(Ee,ue){var je=Ee.proc("batch",2);Ee.batchId="0",po(Ee,je);var ft=!1,At=!0;Object.keys(ue.context).forEach(function(fr){ft=ft||ue.context[fr].propDep}),ft||(yo(Ee,je,ue.context),At=!1);var $e=ue.framebuffer,De=!1;$e?($e.propDep?ft=De=!0:$e.contextDep&&ft&&(De=!0),De||Bn(Ee,je,$e)):Bn(Ee,je,null),ue.state.viewport&&ue.state.viewport.propDep&&(ft=!0);function rt(fr){return fr.contextDep&&ft||fr.propDep}Ln(Ee,je,ue),ts(Ee,je,ue.state,function(fr){return!rt(fr)}),(!ue.profile||!rt(ue.profile))&&xi(Ee,je,ue,!1,"a1"),ue.contextDep=ft,ue.needsContext=At,ue.needsFramebuffer=De;var ge=ue.shader.progVar;if(ge.contextDep&&ft||ge.propDep)Gl(Ee,je,ue,null);else{var Ze=ge.append(Ee,je);if(je(Ee.shared.gl,".useProgram(",Ze,".program);"),ue.shader.program)Gl(Ee,je,ue,ue.shader.program);else{je(Ee.shared.vao,".setVAO(null);");var Se=Ee.global.def("{}"),lt=je.def(Ze,".id"),wt=je.def(Se,"[",lt,"]");je(Ee.cond(wt).then(wt,".call(this,a0,a1);").else(wt,"=",Se,"[",lt,"]=",Ee.link(function(fr){return ai(Gl,Ee,ue,fr,2)}),"(",Ze,");",wt,".call(this,a0,a1);"))}}Object.keys(ue.state).length>0&&je(Ee.shared.current,".dirty=true;"),Ee.shared.vao&&je(Ee.shared.vao,".setVAO(null);")}function Bt(Ee,ue){var je=Ee.proc("scope",3);Ee.batchId="a2";var ft=Ee.shared,At=ft.current;yo(Ee,je,ue.context),ue.framebuffer&&ue.framebuffer.append(Ee,je),zu(Object.keys(ue.state)).forEach(function(De){var rt=ue.state[De],ge=rt.append(Ee,je);oo(ge)?ge.forEach(function(Ze,Se){je.set(Ee.next[De],"["+Se+"]",Ze)}):je.set(ft.next,"."+De,ge)}),xi(Ee,je,ue,!0,!0),[yu,Wf,vc,Eh,wo].forEach(function(De){var rt=ue.draw[De];!rt||je.set(ft.draw,"."+De,""+rt.append(Ee,je))}),Object.keys(ue.uniforms).forEach(function(De){var rt=ue.uniforms[De].append(Ee,je);Array.isArray(rt)&&(rt="["+rt.join()+"]"),je.set(ft.uniforms,"["+ve.id(De)+"]",rt)}),Object.keys(ue.attributes).forEach(function(De){var rt=ue.attributes[De].append(Ee,je),ge=Ee.scopeAttrib(De);Object.keys(new ut).forEach(function(Ze){je.set(ge,"."+Ze,rt[Ze])})}),ue.scopeVAO&&je.set(ft.vao,".targetVAO",ue.scopeVAO.append(Ee,je));function $e(De){var rt=ue.shader[De];rt&&je.set(ft.shader,"."+De,rt.append(Ee,je))}$e(xl),$e(Gc),Object.keys(ue.state).length>0&&(je(At,".dirty=true;"),je.exit(At,".dirty=true;")),je("a1(",Ee.shared.context,",a0,",Ee.batchId,");")}function St(Ee){if(!(typeof Ee!="object"||oo(Ee))){for(var ue=Object.keys(Ee),je=0;je<ue.length;++je)if(on.isDynamic(Ee[ue[je]]))return!0;return!1}}function fn(Ee,ue,je){var ft=ue.static[je];if(!ft||!St(ft))return;var At=Ee.global,$e=Object.keys(ft),De=!1,rt=!1,ge=!1,Ze=Ee.global.def("{}");$e.forEach(function(lt){var wt=ft[lt];if(on.isDynamic(wt)){typeof wt=="function"&&(wt=ft[lt]=on.unbox(wt));var fr=ws(wt,null);De=De||fr.thisDep,ge=ge||fr.propDep,rt=rt||fr.contextDep}else{switch(At(Ze,".",lt,"="),typeof wt){case"number":At(wt);break;case"string":At('"',wt,'"');break;case"object":Array.isArray(wt)&&At("[",wt.join(),"]");break;default:At(Ee.link(wt));break}At(";")}});function Se(lt,wt){$e.forEach(function(fr){var Nr=ft[fr];if(!!on.isDynamic(Nr)){var Br=lt.invoke(wt,Nr);wt(Ze,".",fr,"=",Br,";")}})}ue.dynamic[je]=new on.DynamicVariable(Do,{thisDep:De,contextDep:rt,propDep:ge,ref:Ze,append:Se}),delete ue.static[je]}function Gi(Ee,ue,je,ft,At){var $e=ei();$e.stats=$e.link(At),Object.keys(ue.static).forEach(function(rt){fn($e,ue,rt)}),$t.forEach(function(rt){fn($e,Ee,rt)});var De=Ho(Ee,ue,je,ft,$e);return ya($e,De),Bt($e,De),Ae($e,De),v($e.compile(),{destroy:function(){De.shader.program.destroy()}})}return{next:qr,current:Rr,procs:function(){var Ee=ei(),ue=Ee.proc("poll"),je=Ee.proc("refresh"),ft=Ee.block();ue(ft),je(ft);var At=Ee.shared,$e=At.gl,De=At.next,rt=At.current;ft(rt,".dirty=false;"),Bn(Ee,ue),Bn(Ee,je,null,!0);var ge;_r&&(ge=Ee.link(_r)),Be.oes_vertex_array_object&&je(Ee.link(Be.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var Ze=0;Ze<It.maxAttributes;++Ze){var Se=je.def(At.attributes,"[",Ze,"]"),lt=Ee.cond(Se,".buffer");lt.then($e,".enableVertexAttribArray(",Ze,");",$e,".bindBuffer(",gf,",",Se,".buffer.buffer);",$e,".vertexAttribPointer(",Ze,",",Se,".size,",Se,".type,",Se,".normalized,",Se,".stride,",Se,".offset);").else($e,".disableVertexAttribArray(",Ze,");",$e,".vertexAttrib4f(",Ze,",",Se,".x,",Se,".y,",Se,".z,",Se,".w);",Se,".buffer=null;"),je(lt),_r&&je(ge,".vertexAttribDivisorANGLE(",Ze,",",Se,".divisor);")}return je(Ee.shared.vao,".currentVAO=null;",Ee.shared.vao,".setVAO(",Ee.shared.vao,".targetVAO);"),Object.keys(er).forEach(function(wt){var fr=er[wt],Nr=ft.def(De,".",wt),Br=Ee.block();Br("if(",Nr,"){",$e,".enable(",fr,")}else{",$e,".disable(",fr,")}",rt,".",wt,"=",Nr,";"),je(Br),ue("if(",Nr,"!==",rt,".",wt,"){",Br,"}")}),Object.keys(rr).forEach(function(wt){var fr=rr[wt],Nr=Rr[wt],Br,nn,Lr=Ee.block();if(Lr($e,".",fr,"("),oo(Nr)){var En=Nr.length;Br=Ee.global.def(De,".",wt),nn=Ee.global.def(rt,".",wt),Lr(Ge(En,function(sn){return Br+"["+sn+"]"}),");",Ge(En,function(sn){return nn+"["+sn+"]="+Br+"["+sn+"];"}).join("")),ue("if(",Ge(En,function(sn){return Br+"["+sn+"]!=="+nn+"["+sn+"]"}).join("||"),"){",Lr,"}")}else Br=ft.def(De,".",wt),nn=ft.def(rt,".",wt),Lr(Br,");",rt,".",wt,"=",Br,";"),ue("if(",Br,"!==",nn,"){",Lr,"}");je(Lr)}),Ee.compile()}(),compile:Gi}}function Wp(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var Cd=34918,Td=34919,op=35007,Ad=function(B,ve){if(!ve.ext_disjoint_timer_query)return null;var Be=[];function It(){return Be.pop()||ve.ext_disjoint_timer_query.createQueryEXT()}function ar(_r){Be.push(_r)}var Pt=[];function Qt(_r){var kr=It();ve.ext_disjoint_timer_query.beginQueryEXT(op,kr),Pt.push(kr),gr(Pt.length-1,Pt.length,_r)}function lr(){ve.ext_disjoint_timer_query.endQueryEXT(op)}function vr(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var yr=[];function Cr(){return yr.pop()||new vr}function Tr(_r){yr.push(_r)}var Ur=[];function gr(_r,kr,ur){var Rr=Cr();Rr.startQueryIndex=_r,Rr.endQueryIndex=kr,Rr.sum=0,Rr.stats=ur,Ur.push(Rr)}var Sr=[],ut=[];function jt(){var _r,kr,ur=Pt.length;if(ur!==0){ut.length=Math.max(ut.length,ur+1),Sr.length=Math.max(Sr.length,ur+1),Sr[0]=0,ut[0]=0;var Rr=0;for(_r=0,kr=0;kr<Pt.length;++kr){var qr=Pt[kr];ve.ext_disjoint_timer_query.getQueryObjectEXT(qr,Td)?(Rr+=ve.ext_disjoint_timer_query.getQueryObjectEXT(qr,Cd),ar(qr)):Pt[_r++]=qr,Sr[kr+1]=Rr,ut[kr+1]=_r}for(Pt.length=_r,_r=0,kr=0;kr<Ur.length;++kr){var Nn=Ur[kr],er=Nn.startQueryIndex,rr=Nn.endQueryIndex;Nn.sum+=Sr[rr]-Sr[er];var mn=ut[er],Hr=ut[rr];Hr===mn?(Nn.stats.gpuTime+=Nn.sum/1e6,Tr(Nn)):(Nn.startQueryIndex=mn,Nn.endQueryIndex=Hr,Ur[_r++]=Nn)}Ur.length=_r}}return{beginQuery:Qt,endQuery:lr,pushScopeStats:gr,update:jt,getNumPendingQueries:function(){return Pt.length},clear:function(){Be.push.apply(Be,Pt);for(var _r=0;_r<Be.length;_r++)ve.ext_disjoint_timer_query.deleteQueryEXT(Be[_r]);Pt.length=0,Be.length=0},restore:function(){Pt.length=0,Be.length=0}}},Md=16384,wf=256,Xp=1024,Yp=34962,Cf="webglcontextlost",Ia="webglcontextrestored",sp=1,jl=2,Tf=3;function up(B,ve){for(var Be=0;Be<B.length;++Be)if(B[Be]===ve)return Be;return-1}function qp(B){var ve=me(B);if(!ve)return null;var Be=ve.gl,It=Be.getContextAttributes(),ar=Be.isContextLost(),Pt=Pe(Be,ve);if(!Pt)return null;var Qt=hs(),lr=Wp(),vr=Pt.extensions,yr=Ad(Be,vr),Cr=Qa(),Tr=Be.drawingBufferWidth,Ur=Be.drawingBufferHeight,gr={tick:0,time:0,viewportWidth:Tr,viewportHeight:Ur,framebufferWidth:Tr,framebufferHeight:Ur,drawingBufferWidth:Tr,drawingBufferHeight:Ur,pixelRatio:ve.pixelRatio},Sr={},ut={elements:null,primitive:4,count:-1,offset:0,instances:-1},jt=Cl(Be,vr),_r=N(Be,lr,ve,Rr),kr=ll(Be,vr,_r,lr),ur=yt(Be,vr,jt,lr,_r,kr,ut);function Rr(ai){return ur.destroyBuffer(ai)}var qr=Ir(Be,Qt,lr,ve),Nn=xs(Be,vr,jt,function(){mn.procs.poll()},gr,lr,ve),er=Ru(Be,vr,jt,lr,ve),rr=Oe(Be,vr,jt,Nn,er,lr),mn=Lh(Be,Qt,vr,jt,_r,kr,Nn,rr,Sr,ur,qr,ut,gr,yr,ve),Hr=Un(Be,rr,mn.procs.poll,gr,It,vr,jt),xr=mn.next,Wr=Be.canvas,Kr=[],gi=[],ei=[],Xr=[ve.onDestroy],rn=null;function $n(){if(Kr.length===0){yr&&yr.update(),rn=null;return}rn=Ri.next($n),po();for(var ai=Kr.length-1;ai>=0;--ai){var Ui=Kr[ai];Ui&&Ui(gr,null,0)}Be.flush(),yr&&yr.update()}function ui(){!rn&&Kr.length>0&&(rn=Ri.next($n))}function zi(){rn&&(Ri.cancel($n),rn=null)}function qa(ai){ai.preventDefault(),ar=!0,zi(),gi.forEach(function(Ui){Ui()})}function no(ai){Be.getError(),ar=!1,Pt.restore(),qr.restore(),_r.restore(),Nn.restore(),er.restore(),rr.restore(),ur.restore(),yr&&yr.restore(),mn.procs.refresh(),ui(),ei.forEach(function(Ui){Ui()})}var ki=typeof my!="undefined"&&!!my&&typeof my.showToast=="function";!ki&&Wr&&(Wr.addEventListener(Cf,qa,!1),Wr.addEventListener(Ia,no,!1));function No(){Kr.length=0,zi(),!ki&&Wr&&(Wr.removeEventListener(Cf,qa),Wr.removeEventListener(Ia,no)),qr.clear(),rr.clear(),er.clear(),ur.clear(),Nn.clear(),kr.clear(),_r.clear(),yr&&yr.clear(),Xr.forEach(function(ai){ai()})}function Va(ai){he(!!ai,"invalid args to regl({...})"),he.type(ai,"object","invalid args to regl({...})");function Ui($e){var De=v({},$e);delete De.uniforms,delete De.attributes,delete De.context,delete De.vao,"stencil"in De&&De.stencil.op&&(De.stencil.opBack=De.stencil.opFront=De.stencil.op,delete De.stencil.op);function rt(ge){if(ge in De){var Ze=De[ge];delete De[ge],Object.keys(Ze).forEach(function(Se){De[ge+"."+Se]=Ze[Se]})}}return rt("blend"),rt("depth"),rt("cull"),rt("stencil"),rt("polygonOffset"),rt("scissor"),rt("sample"),"vao"in $e&&(De.vao=$e.vao),De}function ya($e,De){var rt={},ge={};return Object.keys($e).forEach(function(Ze){var Se=$e[Ze];if(on.isDynamic(Se)){ge[Ze]=on.unbox(Se,Ze);return}else if(De&&Array.isArray(Se)){for(var lt=0;lt<Se.length;++lt)if(on.isDynamic(Se[lt])){ge[Ze]=on.unbox(Se,Ze);return}}rt[Ze]=Se}),{dynamic:ge,static:rt}}var Ao=ya(ai.context||{},!0),Gl=ya(ai.uniforms||{},!0),Ae=ya(ai.attributes||{},!1),Bt=ya(Ui(ai),!1),St={gpuTime:0,cpuTime:0,count:0},fn=mn.compile(Bt,Ae,Gl,Ao,St),Gi=fn.draw,Ee=fn.batch,ue=fn.scope,je=[];function ft($e){for(;je.length<$e;)je.push(null);return je}function At($e,De){var rt;if(ar&&he.raise("context lost"),typeof $e=="function")return ue.call(this,null,$e,0);if(typeof De=="function")if(typeof $e=="number")for(rt=0;rt<$e;++rt)ue.call(this,null,De,rt);else if(Array.isArray($e))for(rt=0;rt<$e.length;++rt)ue.call(this,$e[rt],De,rt);else return ue.call(this,$e,De,0);else if(typeof $e=="number"){if($e>0)return Ee.call(this,ft($e|0),$e|0)}else if(Array.isArray($e)){if($e.length)return Ee.call(this,$e,$e.length)}else return Gi.call(this,$e)}return v(At,{stats:St,destroy:function(){fn.destroy()}})}var Ho=rr.setFBO=Va({framebuffer:on.define.call(null,sp,"framebuffer")});function yo(ai,Ui){var ya=0;mn.procs.poll();var Ao=Ui.color;Ao&&(Be.clearColor(+Ao[0]||0,+Ao[1]||0,+Ao[2]||0,+Ao[3]||0),ya|=Md),"depth"in Ui&&(Be.clearDepth(+Ui.depth),ya|=wf),"stencil"in Ui&&(Be.clearStencil(Ui.stencil|0),ya|=Xp),he(!!ya,"called regl.clear with no buffer specified"),Be.clear(ya)}function Bn(ai){if(he(typeof ai=="object"&&ai,"regl.clear() takes an object as input"),"framebuffer"in ai)if(ai.framebuffer&&ai.framebuffer_reglType==="framebufferCube")for(var Ui=0;Ui<6;++Ui)Ho(v({framebuffer:ai.framebuffer.faces[Ui]},ai),yo);else Ho(ai,yo);else yo(null,ai)}function Ln(ai){he.type(ai,"function","regl.frame() callback must be a function"),Kr.push(ai);function Ui(){var ya=up(Kr,ai);he(ya>=0,"cannot cancel a frame twice");function Ao(){var Gl=up(Kr,Ao);Kr[Gl]=Kr[Kr.length-1],Kr.length-=1,Kr.length<=0&&zi()}Kr[ya]=Ao}return ui(),{cancel:Ui}}function ts(){var ai=xr.viewport,Ui=xr.scissor_box;ai[0]=ai[1]=Ui[0]=Ui[1]=0,gr.viewportWidth=gr.framebufferWidth=gr.drawingBufferWidth=ai[2]=Ui[2]=Be.drawingBufferWidth,gr.viewportHeight=gr.framebufferHeight=gr.drawingBufferHeight=ai[3]=Ui[3]=Be.drawingBufferHeight}function po(){gr.tick+=1,gr.time=Wo(),ts(),mn.procs.poll()}function xi(){Nn.refresh(),ts(),mn.procs.refresh(),yr&&yr.update()}function Wo(){return(Qa()-Cr)/1e3}xi();function ua(ai,Ui){he.type(Ui,"function","listener callback must be a function");var ya;switch(ai){case"frame":return Ln(Ui);case"lost":ya=gi;break;case"restore":ya=ei;break;case"destroy":ya=Xr;break;default:he.raise("invalid event, must be one of frame,lost,restore,destroy")}return ya.push(Ui),{cancel:function(){for(var Ao=0;Ao<ya.length;++Ao)if(ya[Ao]===Ui){ya[Ao]=ya[ya.length-1],ya.pop();return}}}}var us=v(Va,{clear:Bn,prop:on.define.bind(null,sp),context:on.define.bind(null,jl),this:on.define.bind(null,Tf),draw:Va({}),buffer:function(ai){return _r.create(ai,Yp,!1,!1)},elements:function(ai){return kr.create(ai,!1)},texture:Nn.create2D,cube:Nn.createCube,renderbuffer:er.create,framebuffer:rr.create,framebufferCube:rr.createCube,vao:ur.createVAO,attributes:It,frame:Ln,on:ua,limits:jt,hasExtension:function(ai){return jt.extensions.indexOf(ai.toLowerCase())>=0},read:Hr,destroy:No,_gl:Be,_refresh:xi,poll:function(){po(),yr&&yr.update()},now:Wo,stats:lr});return ve.onDone(null,us),us}return qp})},58380:function(Ue){function W(L,X,j){switch(j.length){case 0:return L.call(X);case 1:return L.call(X,j[0]);case 2:return L.call(X,j[0],j[1]);case 3:return L.call(X,j[0],j[1],j[2])}return L.apply(X,j)}Ue.exports=W},77412:function(Ue){function W(L,X){for(var j=-1,v=L==null?0:L.length;++j<v&&X(L[j],j,L)!==!1;);return L}Ue.exports=W},47443:function(Ue,W,L){var X=L(42118);function j(v,Q){var F=v==null?0:v.length;return!!F&&X(v,Q,0)>-1}Ue.exports=j},1196:function(Ue){function W(L,X,j){for(var v=-1,Q=L==null?0:L.length;++v<Q;)if(j(X,L[v]))return!0;return!1}Ue.exports=W},29932:function(Ue){function W(L,X){for(var j=-1,v=L==null?0:L.length,Q=Array(v);++j<v;)Q[j]=X(L[j],j,L);return Q}Ue.exports=W},62663:function(Ue){function W(L,X,j,v){var Q=-1,F=L==null?0:L.length;for(v&&F&&(j=L[++Q]);++Q<F;)j=X(j,L[Q],Q,L);return j}Ue.exports=W},49029:function(Ue){var W=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;function L(X){return X.match(W)||[]}Ue.exports=L},86556:function(Ue,W,L){var X=L(89465),j=L(77813);function v(Q,F,J){(J!==void 0&&!j(Q[F],J)||J===void 0&&!(F in Q))&&X(Q,F,J)}Ue.exports=v},34865:function(Ue,W,L){var X=L(89465),j=L(77813),v=Object.prototype,Q=v.hasOwnProperty;function F(J,ne,ye){var K=J[ne];(!(Q.call(J,ne)&&j(K,ye))||ye===void 0&&!(ne in J))&&X(J,ne,ye)}Ue.exports=F},44037:function(Ue,W,L){var X=L(98363),j=L(3674);function v(Q,F){return Q&&X(F,j(F),Q)}Ue.exports=v},63886:function(Ue,W,L){var X=L(98363),j=L(81704);function v(Q,F){return Q&&X(F,j(F),Q)}Ue.exports=v},89465:function(Ue,W,L){var X=L(38777);function j(v,Q,F){Q=="__proto__"&&X?X(v,Q,{configurable:!0,enumerable:!0,value:F,writable:!0}):v[Q]=F}Ue.exports=j},29750:function(Ue){function W(L,X,j){return L===L&&(j!==void 0&&(L=L<=j?L:j),X!==void 0&&(L=L>=X?L:X)),L}Ue.exports=W},85990:function(Ue,W,L){var X=L(46384),j=L(77412),v=L(34865),Q=L(44037),F=L(63886),J=L(64626),ne=L(278),ye=L(18805),K=L(1911),Ne=L(58234),Ve=L(46904),ke=L(64160),ot=L(43824),Jt=L(29148),pt=L(38517),Zt=L(1469),_t=L(44144),nt=L(56688),et=L(13218),kt=L(72928),Y=L(3674),Wt=L(81704),st=1,Ye=2,ct=4,Je="[object Arguments]",Rt="[object Array]",dr="[object Boolean]",Mr="[object Date]",jr="[object Error]",C="[object Function]",we="[object GeneratorFunction]",Le="[object Map]",Et="[object Number]",gt="[object Object]",Lt="[object RegExp]",Yt="[object Set]",br="[object String]",Yn="[object Symbol]",cn="[object WeakMap]",ci="[object ArrayBuffer]",Zn="[object DataView]",ri="[object Float32Array]",fi="[object Float64Array]",Gn="[object Int8Array]",hi="[object Int16Array]",la="[object Int32Array]",Vi="[object Uint8Array]",Oi="[object Uint8ClampedArray]",qi="[object Uint16Array]",ca="[object Uint32Array]",Ci={};Ci[Je]=Ci[Rt]=Ci[ci]=Ci[Zn]=Ci[dr]=Ci[Mr]=Ci[ri]=Ci[fi]=Ci[Gn]=Ci[hi]=Ci[la]=Ci[Le]=Ci[Et]=Ci[gt]=Ci[Lt]=Ci[Yt]=Ci[br]=Ci[Yn]=Ci[Vi]=Ci[Oi]=Ci[qi]=Ci[ca]=!0,Ci[jr]=Ci[C]=Ci[cn]=!1;function ma(Xn,bi,Ni,Ki,Oo,he){var On,Ua=bi&st,rs=bi&Ye,Dt=bi&ct;if(Ni&&(On=Oo?Ni(Xn,Ki,Oo,he):Ni(Xn)),On!==void 0)return On;if(!et(Xn))return Xn;var tr=Zt(Xn);if(tr){if(On=ot(Xn),!Ua)return ne(Xn,On)}else{var Er=ke(Xn),$r=Er==C||Er==we;if(_t(Xn))return J(Xn,Ua);if(Er==gt||Er==Je||$r&&!Oo){if(On=rs||$r?{}:pt(Xn),!Ua)return rs?K(Xn,F(On,Xn)):ye(Xn,Q(On,Xn))}else{if(!Ci[Er])return Oo?Xn:{};On=Jt(Xn,Er,Ua)}}he||(he=new X);var xn=he.get(Xn);if(xn)return xn;he.set(Xn,On),kt(Xn)?Xn.forEach(function(qn){On.add(ma(qn,bi,Ni,qn,Xn,he))}):nt(Xn)&&Xn.forEach(function(qn,on){On.set(on,ma(qn,bi,Ni,on,Xn,he))});var Dn=Dt?rs?Ve:Ne:rs?Wt:Y,pi=tr?void 0:Dn(Xn);return j(pi||Xn,function(qn,on){pi&&(on=qn,qn=Xn[on]),v(On,on,ma(qn,bi,Ni,on,Xn,he))}),On}Ue.exports=ma},3118:function(Ue,W,L){var X=L(13218),j=Object.create,v=function(){function Q(){}return function(F){if(!X(F))return{};if(j)return j(F);Q.prototype=F;var J=new Q;return Q.prototype=void 0,J}}();Ue.exports=v},41848:function(Ue){function W(L,X,j,v){for(var Q=L.length,F=j+(v?1:-1);v?F--:++F<Q;)if(X(L[F],F,L))return F;return-1}Ue.exports=W},28483:function(Ue,W,L){var X=L(25063),j=X();Ue.exports=j},42118:function(Ue,W,L){var X=L(41848),j=L(62722),v=L(42351);function Q(F,J,ne){return J===J?v(F,J,ne):X(F,j,ne)}Ue.exports=Q},25588:function(Ue,W,L){var X=L(64160),j=L(37005),v="[object Map]";function Q(F){return j(F)&&X(F)==v}Ue.exports=Q},62722:function(Ue){function W(L){return L!==L}Ue.exports=W},29221:function(Ue,W,L){var X=L(64160),j=L(37005),v="[object Set]";function Q(F){return j(F)&&X(F)==v}Ue.exports=Q},10313:function(Ue,W,L){var X=L(13218),j=L(25726),v=L(33498),Q=Object.prototype,F=Q.hasOwnProperty;function J(ne){if(!X(ne))return v(ne);var ye=j(ne),K=[];for(var Ne in ne)Ne=="constructor"&&(ye||!F.call(ne,Ne))||K.push(Ne);return K}Ue.exports=J},42980:function(Ue,W,L){var X=L(46384),j=L(86556),v=L(28483),Q=L(59783),F=L(13218),J=L(81704),ne=L(36390);function ye(K,Ne,Ve,ke,ot){K!==Ne&&v(Ne,function(Jt,pt){if(ot||(ot=new X),F(Jt))Q(K,Ne,pt,Ve,ye,ke,ot);else{var Zt=ke?ke(ne(K,pt),Jt,pt+"",K,Ne,ot):void 0;Zt===void 0&&(Zt=Jt),j(K,pt,Zt)}},J)}Ue.exports=ye},59783:function(Ue,W,L){var X=L(86556),j=L(64626),v=L(77133),Q=L(278),F=L(38517),J=L(35694),ne=L(1469),ye=L(29246),K=L(44144),Ne=L(23560),Ve=L(13218),ke=L(68630),ot=L(36719),Jt=L(36390),pt=L(59881);function Zt(_t,nt,et,kt,Y,Wt,st){var Ye=Jt(_t,et),ct=Jt(nt,et),Je=st.get(ct);if(Je){X(_t,et,Je);return}var Rt=Wt?Wt(Ye,ct,et+"",_t,nt,st):void 0,dr=Rt===void 0;if(dr){var Mr=ne(ct),jr=!Mr&&K(ct),C=!Mr&&!jr&&ot(ct);Rt=ct,Mr||jr||C?ne(Ye)?Rt=Ye:ye(Ye)?Rt=Q(Ye):jr?(dr=!1,Rt=j(ct,!0)):C?(dr=!1,Rt=v(ct,!0)):Rt=[]:ke(ct)||J(ct)?(Rt=Ye,J(Ye)?Rt=pt(Ye):(!Ve(Ye)||Ne(Ye))&&(Rt=F(ct))):dr=!1}dr&&(st.set(ct,Rt),Y(Rt,ct,kt,Wt,st),st.delete(ct)),X(_t,et,Rt)}Ue.exports=Zt},40371:function(Ue){function W(L){return function(X){return X==null?void 0:X[L]}}Ue.exports=W},18674:function(Ue){function W(L){return function(X){return L==null?void 0:L[X]}}Ue.exports=W},5976:function(Ue,W,L){var X=L(6557),j=L(45357),v=L(30061);function Q(F,J){return v(j(F,J,X),F+"")}Ue.exports=Q},56560:function(Ue,W,L){var X=L(75703),j=L(38777),v=L(6557),Q=j?function(F,J){return j(F,"toString",{configurable:!0,enumerable:!1,value:X(J),writable:!0})}:v;Ue.exports=Q},80531:function(Ue,W,L){var X=L(62705),j=L(29932),v=L(1469),Q=L(33448),F=1/0,J=X?X.prototype:void 0,ne=J?J.toString:void 0;function ye(K){if(typeof K=="string")return K;if(v(K))return j(K,ye)+"";if(Q(K))return ne?ne.call(K):"";var Ne=K+"";return Ne=="0"&&1/K==-F?"-0":Ne}Ue.exports=ye},45652:function(Ue,W,L){var X=L(88668),j=L(47443),v=L(1196),Q=L(74757),F=L(23593),J=L(21814),ne=200;function ye(K,Ne,Ve){var ke=-1,ot=j,Jt=K.length,pt=!0,Zt=[],_t=Zt;if(Ve)pt=!1,ot=v;else if(Jt>=ne){var nt=Ne?null:F(K);if(nt)return J(nt);pt=!1,ot=Q,_t=new X}else _t=Ne?[]:Zt;e:for(;++ke<Jt;){var et=K[ke],kt=Ne?Ne(et):et;if(et=Ve||et!==0?et:0,pt&&kt===kt){for(var Y=_t.length;Y--;)if(_t[Y]===kt)continue e;Ne&&_t.push(kt),Zt.push(et)}else ot(_t,kt,Ve)||(_t!==Zt&&_t.push(kt),Zt.push(et))}return Zt}Ue.exports=ye},74318:function(Ue,W,L){var X=L(11149);function j(v){var Q=new v.constructor(v.byteLength);return new X(Q).set(new X(v)),Q}Ue.exports=j},64626:function(Ue,W,L){Ue=L.nmd(Ue);var X=L(55639),j=W&&!W.nodeType&&W,v=j&&!0&&Ue&&!Ue.nodeType&&Ue,Q=v&&v.exports===j,F=Q?X.Buffer:void 0,J=F?F.allocUnsafe:void 0;function ne(ye,K){if(K)return ye.slice();var Ne=ye.length,Ve=J?J(Ne):new ye.constructor(Ne);return ye.copy(Ve),Ve}Ue.exports=ne},57157:function(Ue,W,L){var X=L(74318);function j(v,Q){var F=Q?X(v.buffer):v.buffer;return new v.constructor(F,v.byteOffset,v.byteLength)}Ue.exports=j},93147:function(Ue){var W=/\w*$/;function L(X){var j=new X.constructor(X.source,W.exec(X));return j.lastIndex=X.lastIndex,j}Ue.exports=L},40419:function(Ue,W,L){var X=L(62705),j=X?X.prototype:void 0,v=j?j.valueOf:void 0;function Q(F){return v?Object(v.call(F)):{}}Ue.exports=Q},77133:function(Ue,W,L){var X=L(74318);function j(v,Q){var F=Q?X(v.buffer):v.buffer;return new v.constructor(F,v.byteOffset,v.length)}Ue.exports=j},278:function(Ue){function W(L,X){var j=-1,v=L.length;for(X||(X=Array(v));++j<v;)X[j]=L[j];return X}Ue.exports=W},98363:function(Ue,W,L){var X=L(34865),j=L(89465);function v(Q,F,J,ne){var ye=!J;J||(J={});for(var K=-1,Ne=F.length;++K<Ne;){var Ve=F[K],ke=ne?ne(J[Ve],Q[Ve],Ve,J,Q):void 0;ke===void 0&&(ke=Q[Ve]),ye?j(J,Ve,ke):X(J,Ve,ke)}return J}Ue.exports=v},18805:function(Ue,W,L){var X=L(98363),j=L(99551);function v(Q,F){return X(Q,j(Q),F)}Ue.exports=v},1911:function(Ue,W,L){var X=L(98363),j=L(51442);function v(Q,F){return X(Q,j(Q),F)}Ue.exports=v},21463:function(Ue,W,L){var X=L(5976),j=L(16612);function v(Q){return X(function(F,J){var ne=-1,ye=J.length,K=ye>1?J[ye-1]:void 0,Ne=ye>2?J[2]:void 0;for(K=Q.length>3&&typeof K=="function"?(ye--,K):void 0,Ne&&j(J[0],J[1],Ne)&&(K=ye<3?void 0:K,ye=1),F=Object(F);++ne<ye;){var Ve=J[ne];Ve&&Q(F,Ve,ne,K)}return F})}Ue.exports=v},25063:function(Ue){function W(L){return function(X,j,v){for(var Q=-1,F=Object(X),J=v(X),ne=J.length;ne--;){var ye=J[L?ne:++Q];if(j(F[ye],ye,F)===!1)break}return X}}Ue.exports=W},98805:function(Ue,W,L){var X=L(40180),j=L(62689),v=L(83140),Q=L(79833);function F(J){return function(ne){ne=Q(ne);var ye=j(ne)?v(ne):void 0,K=ye?ye[0]:ne.charAt(0),Ne=ye?X(ye,1).join(""):ne.slice(1);return K[J]()+Ne}}Ue.exports=F},35393:function(Ue,W,L){var X=L(62663),j=L(53816),v=L(58748),Q="['\u2019]",F=RegExp(Q,"g");function J(ne){return function(ye){return X(v(j(ye).replace(F,"")),ne,"")}}Ue.exports=J},23593:function(Ue,W,L){var X=L(58525),j=L(50308),v=L(21814),Q=1/0,F=X&&1/v(new X([,-0]))[1]==Q?function(J){return new X(J)}:j;Ue.exports=F},69389:function(Ue,W,L){var X=L(18674),j={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},v=X(j);Ue.exports=v},38777:function(Ue,W,L){var X=L(10852),j=function(){try{var v=X(Object,"defineProperty");return v({},"",{}),v}catch(Q){}}();Ue.exports=j},46904:function(Ue,W,L){var X=L(68866),j=L(51442),v=L(81704);function Q(F){return X(F,v,j)}Ue.exports=Q},85924:function(Ue,W,L){var X=L(5569),j=X(Object.getPrototypeOf,Object);Ue.exports=j},51442:function(Ue,W,L){var X=L(62488),j=L(85924),v=L(99551),Q=L(70479),F=Object.getOwnPropertySymbols,J=F?function(ne){for(var ye=[];ne;)X(ye,v(ne)),ne=j(ne);return ye}:Q;Ue.exports=J},93157:function(Ue){var W=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;function L(X){return W.test(X)}Ue.exports=L},43824:function(Ue){var W=Object.prototype,L=W.hasOwnProperty;function X(j){var v=j.length,Q=new j.constructor(v);return v&&typeof j[0]=="string"&&L.call(j,"index")&&(Q.index=j.index,Q.input=j.input),Q}Ue.exports=X},29148:function(Ue,W,L){var X=L(74318),j=L(57157),v=L(93147),Q=L(40419),F=L(77133),J="[object Boolean]",ne="[object Date]",ye="[object Map]",K="[object Number]",Ne="[object RegExp]",Ve="[object Set]",ke="[object String]",ot="[object Symbol]",Jt="[object ArrayBuffer]",pt="[object DataView]",Zt="[object Float32Array]",_t="[object Float64Array]",nt="[object Int8Array]",et="[object Int16Array]",kt="[object Int32Array]",Y="[object Uint8Array]",Wt="[object Uint8ClampedArray]",st="[object Uint16Array]",Ye="[object Uint32Array]";function ct(Je,Rt,dr){var Mr=Je.constructor;switch(Rt){case Jt:return X(Je);case J:case ne:return new Mr(+Je);case pt:return j(Je,dr);case Zt:case _t:case nt:case et:case kt:case Y:case Wt:case st:case Ye:return F(Je,dr);case ye:return new Mr;case K:case ke:return new Mr(Je);case Ne:return v(Je);case Ve:return new Mr;case ot:return Q(Je)}}Ue.exports=ct},38517:function(Ue,W,L){var X=L(3118),j=L(85924),v=L(25726);function Q(F){return typeof F.constructor=="function"&&!v(F)?X(j(F)):{}}Ue.exports=Q},16612:function(Ue,W,L){var X=L(77813),j=L(98612),v=L(65776),Q=L(13218);function F(J,ne,ye){if(!Q(ye))return!1;var K=typeof ne;return(K=="number"?j(ye)&&v(ne,ye.length):K=="string"&&ne in ye)?X(ye[ne],J):!1}Ue.exports=F},33498:function(Ue){function W(L){var X=[];if(L!=null)for(var j in Object(L))X.push(j);return X}Ue.exports=W},45357:function(Ue,W,L){var X=L(58380),j=Math.max;function v(Q,F,J){return F=j(F===void 0?Q.length-1:F,0),function(){for(var ne=arguments,ye=-1,K=j(ne.length-F,0),Ne=Array(K);++ye<K;)Ne[ye]=ne[F+ye];ye=-1;for(var Ve=Array(F+1);++ye<F;)Ve[ye]=ne[ye];return Ve[F]=J(Ne),X(Q,this,Ve)}}Ue.exports=v},36390:function(Ue){function W(L,X){if(!(X==="constructor"&&typeof L[X]=="function")&&X!="__proto__")return L[X]}Ue.exports=W},30061:function(Ue,W,L){var X=L(56560),j=L(21275),v=j(X);Ue.exports=v},21275:function(Ue){var W=800,L=16,X=Date.now;function j(v){var Q=0,F=0;return function(){var J=X(),ne=L-(J-F);if(F=J,ne>0){if(++Q>=W)return arguments[0]}else Q=0;return v.apply(void 0,arguments)}}Ue.exports=j},42351:function(Ue){function W(L,X,j){for(var v=j-1,Q=L.length;++v<Q;)if(L[v]===X)return v;return-1}Ue.exports=W},2757:function(Ue){var W="\\ud800-\\udfff",L="\\u0300-\\u036f",X="\\ufe20-\\ufe2f",j="\\u20d0-\\u20ff",v=L+X+j,Q="\\u2700-\\u27bf",F="a-z\\xdf-\\xf6\\xf8-\\xff",J="\\xac\\xb1\\xd7\\xf7",ne="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",ye="\\u2000-\\u206f",K=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Ne="A-Z\\xc0-\\xd6\\xd8-\\xde",Ve="\\ufe0e\\ufe0f",ke=J+ne+ye+K,ot="['\u2019]",Jt="["+ke+"]",pt="["+v+"]",Zt="\\d+",_t="["+Q+"]",nt="["+F+"]",et="[^"+W+ke+Zt+Q+F+Ne+"]",kt="\\ud83c[\\udffb-\\udfff]",Y="(?:"+pt+"|"+kt+")",Wt="[^"+W+"]",st="(?:\\ud83c[\\udde6-\\uddff]){2}",Ye="[\\ud800-\\udbff][\\udc00-\\udfff]",ct="["+Ne+"]",Je="\\u200d",Rt="(?:"+nt+"|"+et+")",dr="(?:"+ct+"|"+et+")",Mr="(?:"+ot+"(?:d|ll|m|re|s|t|ve))?",jr="(?:"+ot+"(?:D|LL|M|RE|S|T|VE))?",C=Y+"?",we="["+Ve+"]?",Le="(?:"+Je+"(?:"+[Wt,st,Ye].join("|")+")"+we+C+")*",Et="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",gt="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Lt=we+C+Le,Yt="(?:"+[_t,st,Ye].join("|")+")"+Lt,br=RegExp([ct+"?"+nt+"+"+Mr+"(?="+[Jt,ct,"$"].join("|")+")",dr+"+"+jr+"(?="+[Jt,ct+Rt,"$"].join("|")+")",ct+"?"+Rt+"+"+Mr,ct+"+"+jr,gt,Et,Zt,Yt].join("|"),"g");function Yn(cn){return cn.match(br)||[]}Ue.exports=Yn},68929:function(Ue,W,L){var X=L(48403),j=L(35393),v=j(function(Q,F,J){return F=F.toLowerCase(),Q+(J?X(F):F)});Ue.exports=v},48403:function(Ue,W,L){var X=L(79833),j=L(11700);function v(Q){return j(X(Q).toLowerCase())}Ue.exports=v},74691:function(Ue,W,L){var X=L(29750),j=L(14841);function v(Q,F,J){return J===void 0&&(J=F,F=void 0),J!==void 0&&(J=j(J),J=J===J?J:0),F!==void 0&&(F=j(F),F=F===F?F:0),X(j(Q),F,J)}Ue.exports=v},50361:function(Ue,W,L){var X=L(85990),j=1,v=4;function Q(F){return X(F,j|v)}Ue.exports=Q},75703:function(Ue){function W(L){return function(){return L}}Ue.exports=W},53816:function(Ue,W,L){var X=L(69389),j=L(79833),v=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Q="\\u0300-\\u036f",F="\\ufe20-\\ufe2f",J="\\u20d0-\\u20ff",ne=Q+F+J,ye="["+ne+"]",K=RegExp(ye,"g");function Ne(Ve){return Ve=j(Ve),Ve&&Ve.replace(v,X).replace(K,"")}Ue.exports=Ne},6557:function(Ue){function W(L){return L}Ue.exports=W},29246:function(Ue,W,L){var X=L(98612),j=L(37005);function v(Q){return j(Q)&&X(Q)}Ue.exports=v},56688:function(Ue,W,L){var X=L(25588),j=L(7518),v=L(31167),Q=v&&v.isMap,F=Q?j(Q):X;Ue.exports=F},14293:function(Ue){function W(L){return L==null}Ue.exports=W},81763:function(Ue,W,L){var X=L(44239),j=L(37005),v="[object Number]";function Q(F){return typeof F=="number"||j(F)&&X(F)==v}Ue.exports=Q},68630:function(Ue,W,L){var X=L(44239),j=L(85924),v=L(37005),Q="[object Object]",F=Function.prototype,J=Object.prototype,ne=F.toString,ye=J.hasOwnProperty,K=ne.call(Object);function Ne(Ve){if(!v(Ve)||X(Ve)!=Q)return!1;var ke=j(Ve);if(ke===null)return!0;var ot=ye.call(ke,"constructor")&&ke.constructor;return typeof ot=="function"&&ot instanceof ot&&ne.call(ot)==K}Ue.exports=Ne},72928:function(Ue,W,L){var X=L(29221),j=L(7518),v=L(31167),Q=v&&v.isSet,F=Q?j(Q):X;Ue.exports=F},47037:function(Ue,W,L){var X=L(44239),j=L(1469),v=L(37005),Q="[object String]";function F(J){return typeof J=="string"||!j(J)&&v(J)&&X(J)==Q}Ue.exports=F},81704:function(Ue,W,L){var X=L(14636),j=L(10313),v=L(98612);function Q(F){return v(F)?X(F,!0):j(F)}Ue.exports=Q},82492:function(Ue,W,L){var X=L(42980),j=L(21463),v=j(function(Q,F,J){X(Q,F,J)});Ue.exports=v},30236:function(Ue,W,L){var X=L(42980),j=L(21463),v=j(function(Q,F,J,ne){X(Q,F,J,ne)});Ue.exports=v},50308:function(Ue){function W(){}Ue.exports=W},59881:function(Ue,W,L){var X=L(98363),j=L(81704);function v(Q){return X(Q,j(Q))}Ue.exports=v},79833:function(Ue,W,L){var X=L(80531);function j(v){return v==null?"":X(v)}Ue.exports=j},44908:function(Ue,W,L){var X=L(45652);function j(v){return v&&v.length?X(v):[]}Ue.exports=j},11700:function(Ue,W,L){var X=L(98805),j=X("toUpperCase");Ue.exports=j},58748:function(Ue,W,L){var X=L(49029),j=L(93157),v=L(79833),Q=L(2757);function F(J,ne,ye){return J=v(J),ne=ye?void 0:ne,ne===void 0?j(J)?Q(J):X(J):J.match(ne)||[]}Ue.exports=F},6158:function(Ue){(function(W,L){Ue.exports=L()})(this,function(){"use strict";var W,L,X;function j(v,Q){if(!W)W=Q;else if(!L)L=Q;else{var F="var sharedChunk = {}; ("+W+")(sharedChunk); ("+L+")(sharedChunk);",J={};W(J),X=Q(J),typeof window!="undefined"&&(X.workerUrl=window.URL.createObjectURL(new Blob([F],{type:"text/javascript"})))}}return j(["exports"],function(v){"use strict";function Q(t,a){return t(a={exports:{}},a.exports),a.exports}var F=J;function J(t,a,s,h){this.cx=3*t,this.bx=3*(s-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*a,this.by=3*(h-a)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=h,this.p2x=s,this.p2y=h}J.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},J.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},J.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},J.prototype.solveCurveX=function(t,a){var s,h,g,m,S;for(a===void 0&&(a=1e-6),g=t,S=0;S<8;S++){if(m=this.sampleCurveX(g)-t,Math.abs(m)<a)return g;var M=this.sampleCurveDerivativeX(g);if(Math.abs(M)<1e-6)break;g-=m/M}if((g=t)<(s=0))return s;if(g>(h=1))return h;for(;s<h;){if(m=this.sampleCurveX(g),Math.abs(m-t)<a)return g;t>m?s=g:h=g,g=.5*(h-s)+s}return g},J.prototype.solve=function(t,a){return this.sampleCurveY(this.solveCurveX(t,a))};var ne=ye;function ye(t,a){this.x=t,this.y=a}ye.prototype={clone:function(){return new ye(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,a){return this.clone()._rotateAround(t,a)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var a=t.x-this.x,s=t.y-this.y;return a*a+s*s},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,a){return Math.atan2(this.x*a-this.y*t,this.x*t+this.y*a)},_matMult:function(t){var a=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=a,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var a=Math.cos(t),s=Math.sin(t),h=s*this.x+a*this.y;return this.x=a*this.x-s*this.y,this.y=h,this},_rotateAround:function(t,a){var s=Math.cos(t),h=Math.sin(t),g=a.y+h*(this.x-a.x)+s*(this.y-a.y);return this.x=a.x+s*(this.x-a.x)-h*(this.y-a.y),this.y=g,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ye.convert=function(t){return t instanceof ye?t:Array.isArray(t)?new ye(t[0],t[1]):t};var K=typeof self!="undefined"?self:{},Ne=Math.pow(2,53)-1;function Ve(t,a,s,h){var g=new F(t,a,s,h);return function(m){return g.solve(m)}}var ke=Ve(.25,.1,.25,1);function ot(t,a,s){return Math.min(s,Math.max(a,t))}function Jt(t,a,s){var h=s-a,g=((t-a)%h+h)%h+a;return g===a?s:g}function pt(t){for(var a=[],s=arguments.length-1;s-- >0;)a[s]=arguments[s+1];for(var h=0,g=a;h<g.length;h+=1){var m=g[h];for(var S in m)t[S]=m[S]}return t}var Zt=1;function _t(){return Zt++}function nt(){return function t(a){return a?(a^16*Math.random()>>a/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function et(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function kt(t,a){t.forEach(function(s){a[s]&&(a[s]=a[s].bind(a))})}function Y(t,a){return t.indexOf(a,t.length-a.length)!==-1}function Wt(t,a,s){var h={};for(var g in t)h[g]=a.call(s||this,t[g],g,t);return h}function st(t,a,s){var h={};for(var g in t)a.call(s||this,t[g],g,t)&&(h[g]=t[g]);return h}function Ye(t){return Array.isArray(t)?t.map(Ye):typeof t=="object"&&t?Wt(t,Ye):t}var ct={};function Je(t){ct[t]||(typeof console!="undefined"&&console.warn(t),ct[t]=!0)}function Rt(t,a,s){return(s.y-t.y)*(a.x-t.x)>(a.y-t.y)*(s.x-t.x)}function dr(t){for(var a=0,s=0,h=t.length,g=h-1,m=void 0,S=void 0;s<h;g=s++)a+=((S=t[g]).x-(m=t[s]).x)*(m.y+S.y);return a}function Mr(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function jr(t){var a={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(h,g,m,S){var M=m||S;return a[g]=!M||M.toLowerCase(),""}),a["max-age"]){var s=parseInt(a["max-age"],10);isNaN(s)?delete a["max-age"]:a["max-age"]=s}return a}var C=null;function we(t){if(C==null){var a=t.navigator?t.navigator.userAgent:null;C=!!t.safari||!(!a||!(/\b(iPad|iPhone|iPod)\b/.test(a)||a.match("Safari")&&!a.match("Chrome")))}return C}function Le(t){try{var a=K[t];return a.setItem("_mapbox_test_",1),a.removeItem("_mapbox_test_"),!0}catch(s){return!1}}var Et,gt,Lt,Yt,br=K.performance&&K.performance.now?K.performance.now.bind(K.performance):Date.now.bind(Date),Yn=K.requestAnimationFrame||K.mozRequestAnimationFrame||K.webkitRequestAnimationFrame||K.msRequestAnimationFrame,cn=K.cancelAnimationFrame||K.mozCancelAnimationFrame||K.webkitCancelAnimationFrame||K.msCancelAnimationFrame,ci={now:br,frame:function(t){var a=Yn(t);return{cancel:function(){return cn(a)}}},getImageData:function(t,a){a===void 0&&(a=0);var s=K.document.createElement("canvas"),h=s.getContext("2d");if(!h)throw new Error("failed to create canvas 2d context");return s.width=t.width,s.height=t.height,h.drawImage(t,0,0,t.width,t.height),h.getImageData(-a,-a,t.width+2*a,t.height+2*a)},resolveURL:function(t){return Et||(Et=K.document.createElement("a")),Et.href=t,Et.href},hardwareConcurrency:K.navigator&&K.navigator.hardwareConcurrency||4,get devicePixelRatio(){return K.devicePixelRatio},get prefersReducedMotion(){return!!K.matchMedia&&(gt==null&&(gt=K.matchMedia("(prefers-reduced-motion: reduce)")),gt.matches)}},Zn={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},ri={supported:!1,testSupport:function(t){!fi&&Yt&&(Gn?hi(t):Lt=t)}},fi=!1,Gn=!1;function hi(t){var a=t.createTexture();t.bindTexture(t.TEXTURE_2D,a);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,Yt),t.isContextLost())return;ri.supported=!0}catch(s){}t.deleteTexture(a),fi=!0}K.document&&((Yt=K.document.createElement("img")).onload=function(){Lt&&hi(Lt),Lt=null,Gn=!0},Yt.onerror=function(){fi=!0,Lt=null},Yt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var la="01",Vi=function(t,a){this._transformRequestFn=t,this._customAccessToken=a,this._createSkuToken()};function Oi(t){return t.indexOf("mapbox:")===0}Vi.prototype._createSkuToken=function(){var t=function(){for(var a="",s=0;s<10;s++)a+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",la,a].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt},Vi.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},Vi.prototype.transformRequest=function(t,a){return this._transformRequestFn&&this._transformRequestFn(t,a)||{url:t}},Vi.prototype.normalizeStyleURL=function(t,a){if(!Oi(t))return t;var s=ma(t);return s.path="/styles/v1"+s.path,this._makeAPIURL(s,this._customAccessToken||a)},Vi.prototype.normalizeGlyphsURL=function(t,a){if(!Oi(t))return t;var s=ma(t);return s.path="/fonts/v1"+s.path,this._makeAPIURL(s,this._customAccessToken||a)},Vi.prototype.normalizeSourceURL=function(t,a){if(!Oi(t))return t;var s=ma(t);return s.path="/v4/"+s.authority+".json",s.params.push("secure"),this._makeAPIURL(s,this._customAccessToken||a)},Vi.prototype.normalizeSpriteURL=function(t,a,s,h){var g=ma(t);return Oi(t)?(g.path="/styles/v1"+g.path+"/sprite"+a+s,this._makeAPIURL(g,this._customAccessToken||h)):(g.path+=""+a+s,Xn(g))},Vi.prototype.normalizeTileURL=function(t,a){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!Oi(t))return t;var s=ma(t);s.path=s.path.replace(/(\.(png|jpg)\d*)(?=$)/,(ci.devicePixelRatio>=2||a===512?"@2x":"")+(ri.supported?".webp":"$1")),s.path=s.path.replace(/^.+\/v4\//,"/"),s.path="/v4"+s.path;var h=this._customAccessToken||function(g){for(var m=0,S=g;m<S.length;m+=1){var M=S[m].match(/^access_token=(.*)$/);if(M)return M[1]}return null}(s.params)||Zn.ACCESS_TOKEN;return Zn.REQUIRE_ACCESS_TOKEN&&h&&this._skuToken&&s.params.push("sku="+this._skuToken),this._makeAPIURL(s,h)},Vi.prototype.canonicalizeTileURL=function(t,a){var s=ma(t);if(!s.path.match(/(^\/v4\/)/)||!s.path.match(/\.[\w]+$/))return t;var h="mapbox://tiles/";h+=s.path.replace("/v4/","");var g=s.params;return a&&(g=g.filter(function(m){return!m.match(/^access_token=/)})),g.length&&(h+="?"+g.join("&")),h},Vi.prototype.canonicalizeTileset=function(t,a){for(var s=!!a&&Oi(a),h=[],g=0,m=t.tiles||[];g<m.length;g+=1){var S=m[g];ca(S)?h.push(this.canonicalizeTileURL(S,s)):h.push(S)}return h},Vi.prototype._makeAPIURL=function(t,a){var s="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",h=ma(Zn.API_URL);if(t.protocol=h.protocol,t.authority=h.authority,t.protocol==="http"){var g=t.params.indexOf("secure");g>=0&&t.params.splice(g,1)}if(h.path!=="/"&&(t.path=""+h.path+t.path),!Zn.REQUIRE_ACCESS_TOKEN)return Xn(t);if(!(a=a||Zn.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+s);if(a[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+s);return t.params=t.params.filter(function(m){return m.indexOf("access_token")===-1}),t.params.push("access_token="+a),Xn(t)};var qi=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function ca(t){return qi.test(t)}var Ci=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ma(t){var a=t.match(Ci);if(!a)throw new Error("Unable to parse URL object");return{protocol:a[1],authority:a[2],path:a[3]||"/",params:a[4]?a[4].split("&"):[]}}function Xn(t){var a=t.params.length?"?"+t.params.join("&"):"";return t.protocol+"://"+t.authority+t.path+a}function bi(t){if(!t)return null;var a=t.split(".");if(!a||a.length!==3)return null;try{return JSON.parse(decodeURIComponent(K.atob(a[1]).split("").map(function(s){return"%"+("00"+s.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch(s){return null}}var Ni=function(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};Ni.prototype.getStorageKey=function(t){var a,s=bi(Zn.ACCESS_TOKEN);return a=s&&s.u?K.btoa(encodeURIComponent(s.u).replace(/%([0-9A-F]{2})/g,function(h,g){return String.fromCharCode(Number("0x"+g))})):Zn.ACCESS_TOKEN||"",t?"mapbox.eventData."+t+":"+a:"mapbox.eventData:"+a},Ni.prototype.fetchEventData=function(){var t=Le("localStorage"),a=this.getStorageKey(),s=this.getStorageKey("uuid");if(t)try{var h=K.localStorage.getItem(a);h&&(this.eventData=JSON.parse(h));var g=K.localStorage.getItem(s);g&&(this.anonId=g)}catch(m){Je("Unable to read from LocalStorage")}},Ni.prototype.saveEventData=function(){var t=Le("localStorage"),a=this.getStorageKey(),s=this.getStorageKey("uuid");if(t)try{K.localStorage.setItem(s,this.anonId),Object.keys(this.eventData).length>=1&&K.localStorage.setItem(a,JSON.stringify(this.eventData))}catch(h){Je("Unable to write to LocalStorage")}},Ni.prototype.processRequests=function(t){},Ni.prototype.postEvent=function(t,a,s,h){var g=this;if(Zn.EVENTS_URL){var m=ma(Zn.EVENTS_URL);m.params.push("access_token="+(h||Zn.ACCESS_TOKEN||""));var S={event:this.type,created:new Date(t).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.2",skuId:la,userId:this.anonId},M=a?pt(S,a):S,k={url:Xn(m),headers:{"Content-Type":"text/plain"},body:JSON.stringify([M])};this.pendingRequest=ba(k,function(z){g.pendingRequest=null,s(z),g.saveEventData(),g.processRequests(h)})}},Ni.prototype.queueRequest=function(t,a){this.queue.push(t),this.processRequests(a)};var Ki,Oo,he=function(t){function a(){t.call(this,"map.load"),this.success={},this.skuToken=""}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.postMapLoadEvent=function(s,h,g,m){this.skuToken=g,(Zn.EVENTS_URL&&m||Zn.ACCESS_TOKEN&&Array.isArray(s)&&s.some(function(S){return Oi(S)||ca(S)}))&&this.queueRequest({id:h,timestamp:Date.now()},m)},a.prototype.processRequests=function(s){var h=this;if(!this.pendingRequest&&this.queue.length!==0){var g=this.queue.shift(),m=g.id,S=g.timestamp;m&&this.success[m]||(this.anonId||this.fetchEventData(),et(this.anonId)||(this.anonId=nt()),this.postEvent(S,{skuToken:this.skuToken},function(M){M||m&&(h.success[m]=!0)},s))}},a}(Ni),On=new(function(t){function a(s){t.call(this,"appUserTurnstile"),this._customAccessToken=s}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.postTurnstileEvent=function(s,h){Zn.EVENTS_URL&&Zn.ACCESS_TOKEN&&Array.isArray(s)&&s.some(function(g){return Oi(g)||ca(g)})&&this.queueRequest(Date.now(),h)},a.prototype.processRequests=function(s){var h=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var g=bi(Zn.ACCESS_TOKEN),m=g?g.u:Zn.ACCESS_TOKEN,S=m!==this.eventData.tokenU;et(this.anonId)||(this.anonId=nt(),S=!0);var M=this.queue.shift();if(this.eventData.lastSuccess){var k=new Date(this.eventData.lastSuccess),z=new Date(M),V=(M-this.eventData.lastSuccess)/864e5;S=S||V>=1||V<-1||k.getDate()!==z.getDate()}else S=!0;if(!S)return this.processRequests();this.postEvent(M,{"enabled.telemetry":!1},function(H){H||(h.eventData.lastSuccess=M,h.eventData.tokenU=m)},s)}},a}(Ni)),Ua=On.postTurnstileEvent.bind(On),rs=new he,Dt=rs.postMapLoadEvent.bind(rs),tr=500,Er=50;function $r(){K.caches&&!Ki&&(Ki=K.caches.open("mapbox-tiles"))}function xn(t){var a=t.indexOf("?");return a<0?t:t.slice(0,a)}var Dn,pi=1/0;function qn(){return Dn==null&&(Dn=K.OffscreenCanvas&&new K.OffscreenCanvas(1,1).getContext("2d")&&typeof K.createImageBitmap=="function"),Dn}var on={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(on);var Ri=function(t){function a(s,h,g){h===401&&ca(g)&&(s+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),t.call(this,s),this.status=h,this.url=g,this.name=this.constructor.name,this.message=s}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},a}(Error),Ii=Mr()?function(){return self.worker&&self.worker.referrer}:function(){return(K.location.protocol==="blob:"?K.parent:K).location.href},Qa,hs,Zo=function(t,a){if(!(/^file:/.test(s=t.url)||/^file:/.test(Ii())&&!/^\w+:/.test(s))){if(K.fetch&&K.Request&&K.AbortController&&K.Request.prototype.hasOwnProperty("signal"))return function(h,g){var m,S=new K.AbortController,M=new K.Request(h.url,{method:h.method||"GET",body:h.body,credentials:h.credentials,headers:h.headers,referrer:Ii(),signal:S.signal}),k=!1,z=!1,V=(m=M.url).indexOf("sku=")>0&&ca(m);h.type==="json"&&M.headers.set("Accept","application/json");var H=function(se,Me,Ie){if(!z){if(se&&se.message!=="SecurityError"&&Je(se),Me&&Ie)return te(Me);var qe=Date.now();K.fetch(M).then(function(ze){if(ze.ok){var at=V?ze.clone():null;return te(ze,at,qe)}return g(new Ri(ze.statusText,ze.status,h.url))}).catch(function(ze){ze.code!==20&&g(new Error(ze.message))})}},te=function(se,Me,Ie){(h.type==="arrayBuffer"?se.arrayBuffer():h.type==="json"?se.json():se.text()).then(function(qe){z||(Me&&Ie&&function(ze,at,bt){if($r(),Ki){var Ut={status:at.status,statusText:at.statusText,headers:new K.Headers};at.headers.forEach(function(or,Ar){return Ut.headers.set(Ar,or)});var Ht=jr(at.headers.get("Cache-Control")||"");Ht["no-store"]||(Ht["max-age"]&&Ut.headers.set("Expires",new Date(bt+1e3*Ht["max-age"]).toUTCString()),new Date(Ut.headers.get("Expires")).getTime()-bt<42e4||function(or,Ar){if(Oo===void 0)try{new Response(new ReadableStream),Oo=!0}catch(Vr){Oo=!1}Oo?Ar(or.body):or.blob().then(Ar)}(at,function(or){var Ar=new K.Response(or,Ut);$r(),Ki&&Ki.then(function(Vr){return Vr.put(xn(ze.url),Ar)}).catch(function(Vr){return Je(Vr.message)})}))}}(M,Me,Ie),k=!0,g(null,qe,se.headers.get("Cache-Control"),se.headers.get("Expires")))}).catch(function(qe){z||g(new Error(qe.message))})};return V?function(se,Me){if($r(),!Ki)return Me(null);var Ie=xn(se.url);Ki.then(function(qe){qe.match(Ie).then(function(ze){var at=function(bt){if(!bt)return!1;var Ut=new Date(bt.headers.get("Expires")||0),Ht=jr(bt.headers.get("Cache-Control")||"");return Ut>Date.now()&&!Ht["no-cache"]}(ze);qe.delete(Ie),at&&qe.put(Ie,ze.clone()),Me(null,ze,at)}).catch(Me)}).catch(Me)}(M,H):H(null,null),{cancel:function(){z=!0,k||S.abort()}}}(t,a);if(Mr()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,a,void 0,!0)}var s;return function(h,g){var m=new K.XMLHttpRequest;for(var S in m.open(h.method||"GET",h.url,!0),h.type==="arrayBuffer"&&(m.responseType="arraybuffer"),h.headers)m.setRequestHeader(S,h.headers[S]);return h.type==="json"&&(m.responseType="text",m.setRequestHeader("Accept","application/json")),m.withCredentials=h.credentials==="include",m.onerror=function(){g(new Error(m.statusText))},m.onload=function(){if((m.status>=200&&m.status<300||m.status===0)&&m.response!==null){var M=m.response;if(h.type==="json")try{M=JSON.parse(m.response)}catch(k){return g(k)}g(null,M,m.getResponseHeader("Cache-Control"),m.getResponseHeader("Expires"))}else g(new Ri(m.statusText,m.status,h.url))},m.send(h.body),{cancel:function(){return m.abort()}}}(t,a)},Fa=function(t,a){return Zo(pt(t,{type:"arrayBuffer"}),a)},ba=function(t,a){return Zo(pt(t,{method:"POST"}),a)},G="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";Qa=[],hs=0;var ee=function(t,a){if(ri.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),hs>=Zn.MAX_PARALLEL_IMAGE_REQUESTS){var s={requestParameters:t,callback:a,cancelled:!1,cancel:function(){this.cancelled=!0}};return Qa.push(s),s}hs++;var h=!1,g=function(){if(!h)for(h=!0,hs--;Qa.length&&hs<Zn.MAX_PARALLEL_IMAGE_REQUESTS;){var S=Qa.shift();S.cancelled||(S.cancel=ee(S.requestParameters,S.callback).cancel)}},m=Fa(t,function(S,M,k,z){g(),S?a(S):M&&(qn()?function(V,H){var te=new K.Blob([new Uint8Array(V)],{type:"image/png"});K.createImageBitmap(te).then(function(se){H(null,se)}).catch(function(se){H(new Error("Could not load image because of "+se.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(M,a):function(V,H,te,se){var Me=new K.Image,Ie=K.URL;Me.onload=function(){H(null,Me),Ie.revokeObjectURL(Me.src),Me.onload=null,K.requestAnimationFrame(function(){Me.src=G})},Me.onerror=function(){return H(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var qe=new K.Blob([new Uint8Array(V)],{type:"image/png"});Me.cacheControl=te,Me.expires=se,Me.src=V.byteLength?Ie.createObjectURL(qe):G}(M,a,k,z))});return{cancel:function(){m.cancel(),g()}}};function ae(t,a,s){s[t]&&s[t].indexOf(a)!==-1||(s[t]=s[t]||[],s[t].push(a))}function me(t,a,s){if(s&&s[t]){var h=s[t].indexOf(a);h!==-1&&s[t].splice(h,1)}}var Pe=function(t,a){a===void 0&&(a={}),pt(this,a),this.type=t},Ge=function(t){function a(s,h){h===void 0&&(h={}),t.call(this,"error",pt({error:s},h))}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a}(Pe),tt=function(){};tt.prototype.on=function(t,a){return this._listeners=this._listeners||{},ae(t,a,this._listeners),this},tt.prototype.off=function(t,a){return me(t,a,this._listeners),me(t,a,this._oneTimeListeners),this},tt.prototype.once=function(t,a){return this._oneTimeListeners=this._oneTimeListeners||{},ae(t,a,this._oneTimeListeners),this},tt.prototype.fire=function(t,a){typeof t=="string"&&(t=new Pe(t,a||{}));var s=t.type;if(this.listens(s)){t.target=this;for(var h=0,g=this._listeners&&this._listeners[s]?this._listeners[s].slice():[];h<g.length;h+=1)g[h].call(this,t);for(var m=0,S=this._oneTimeListeners&&this._oneTimeListeners[s]?this._oneTimeListeners[s].slice():[];m<S.length;m+=1){var M=S[m];me(s,M,this._oneTimeListeners),M.call(this,t)}var k=this._eventedParent;k&&(pt(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),k.fire(t))}else t instanceof Ge&&console.error(t.error);return this},tt.prototype.listens=function(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)},tt.prototype.setEventedParent=function(t,a){return this._eventedParent=t,this._eventedParentData=a,this};var ce={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},Re=function(t,a,s,h){this.message=(t?t+": ":"")+s,h&&(this.identifier=h),a!=null&&a.__line__&&(this.line=a.__line__)};function mt(t){var a=t.value;return a?[new Re(t.key,a,"constants have been deprecated as of v8")]:[]}function hr(t){for(var a=[],s=arguments.length-1;s-- >0;)a[s]=arguments[s+1];for(var h=0,g=a;h<g.length;h+=1){var m=g[h];for(var S in m)t[S]=m[S]}return t}function Ot(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function Ft(t){if(Array.isArray(t))return t.map(Ft);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){var a={};for(var s in t)a[s]=Ft(t[s]);return a}return Ot(t)}var pr=function(t){function a(s,h){t.call(this,h),this.message=h,this.key=s}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a}(Error),gn=function(t,a){a===void 0&&(a=[]),this.parent=t,this.bindings={};for(var s=0,h=a;s<h.length;s+=1){var g=h[s];this.bindings[g[0]]=g[1]}};gn.prototype.concat=function(t){return new gn(this,t)},gn.prototype.get=function(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(t+" not found in scope.")},gn.prototype.has=function(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)};var un={kind:"null"},Tt={kind:"number"},Jr={kind:"string"},Dr={kind:"boolean"},Gr={kind:"color"},vi={kind:"object"},Qr={kind:"value"},An={kind:"collator"},Wi={kind:"formatted"},di={kind:"resolvedImage"};function Ti(t,a){return{kind:"array",itemType:t,N:a}}function _i(t){if(t.kind==="array"){var a=_i(t.itemType);return typeof t.N=="number"?"array<"+a+", "+t.N+">":t.itemType.kind==="value"?"array":"array<"+a+">"}return t.kind}var Ct=[un,Tt,Jr,Dr,Gr,Wi,vi,Ti(Qr),di];function qt(t,a){if(a.kind==="error")return null;if(t.kind==="array"){if(a.kind==="array"&&(a.N===0&&a.itemType.kind==="value"||!qt(t.itemType,a.itemType))&&(typeof t.N!="number"||t.N===a.N))return null}else{if(t.kind===a.kind)return null;if(t.kind==="value"){for(var s=0,h=Ct;s<h.length;s+=1)if(!qt(h[s],a))return null}}return"Expected "+_i(t)+" but found "+_i(a)+" instead."}function Aa(t,a){return a.some(function(s){return s.kind===t.kind})}function Ei(t,a){return a.some(function(s){return s==="null"?t===null:s==="array"?Array.isArray(t):s==="object"?t&&!Array.isArray(t)&&typeof t=="object":s===typeof t})}var Ai=Q(function(t,a){var s={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function h(M){return(M=Math.round(M))<0?0:M>255?255:M}function g(M){return h(M[M.length-1]==="%"?parseFloat(M)/100*255:parseInt(M))}function m(M){return(k=M[M.length-1]==="%"?parseFloat(M)/100:parseFloat(M))<0?0:k>1?1:k;var k}function S(M,k,z){return z<0?z+=1:z>1&&(z-=1),6*z<1?M+(k-M)*z*6:2*z<1?k:3*z<2?M+(k-M)*(2/3-z)*6:M}try{a.parseCSSColor=function(M){var k,z=M.replace(/ /g,"").toLowerCase();if(z in s)return s[z].slice();if(z[0]==="#")return z.length===4?(k=parseInt(z.substr(1),16))>=0&&k<=4095?[(3840&k)>>4|(3840&k)>>8,240&k|(240&k)>>4,15&k|(15&k)<<4,1]:null:z.length===7&&(k=parseInt(z.substr(1),16))>=0&&k<=16777215?[(16711680&k)>>16,(65280&k)>>8,255&k,1]:null;var V=z.indexOf("("),H=z.indexOf(")");if(V!==-1&&H+1===z.length){var te=z.substr(0,V),se=z.substr(V+1,H-(V+1)).split(","),Me=1;switch(te){case"rgba":if(se.length!==4)return null;Me=m(se.pop());case"rgb":return se.length!==3?null:[g(se[0]),g(se[1]),g(se[2]),Me];case"hsla":if(se.length!==4)return null;Me=m(se.pop());case"hsl":if(se.length!==3)return null;var Ie=(parseFloat(se[0])%360+360)%360/360,qe=m(se[1]),ze=m(se[2]),at=ze<=.5?ze*(qe+1):ze+qe-ze*qe,bt=2*ze-at;return[h(255*S(bt,at,Ie+1/3)),h(255*S(bt,at,Ie)),h(255*S(bt,at,Ie-1/3)),Me];default:return null}}return null}}catch(M){}}).parseCSSColor,Bi=function(t,a,s,h){h===void 0&&(h=1),this.r=t,this.g=a,this.b=s,this.a=h};Bi.parse=function(t){if(t){if(t instanceof Bi)return t;if(typeof t=="string"){var a=Ai(t);if(a)return new Bi(a[0]/255*a[3],a[1]/255*a[3],a[2]/255*a[3],a[3])}}},Bi.prototype.toString=function(){var t=this.toArray(),a=t[1],s=t[2],h=t[3];return"rgba("+Math.round(t[0])+","+Math.round(a)+","+Math.round(s)+","+h+")"},Bi.prototype.toArray=function(){var t=this.a;return t===0?[0,0,0,0]:[255*this.r/t,255*this.g/t,255*this.b/t,t]},Bi.black=new Bi(0,0,0,1),Bi.white=new Bi(1,1,1,1),Bi.transparent=new Bi(0,0,0,0),Bi.red=new Bi(1,0,0,1);var Yr=function(t,a,s){this.sensitivity=t?a?"variant":"case":a?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};Yr.prototype.compare=function(t,a){return this.collator.compare(t,a)},Yr.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var wn=function(t,a,s,h,g){this.text=t,this.image=a,this.scale=s,this.fontStack=h,this.textColor=g},zt=function(t){this.sections=t};zt.fromString=function(t){return new zt([new wn(t,null,null,null,null)])},zt.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(t){return t.text.length!==0||t.image&&t.image.name.length!==0})},zt.factory=function(t){return t instanceof zt?t:zt.fromString(t)},zt.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(t){return t.text}).join("")},zt.prototype.serialize=function(){for(var t=["format"],a=0,s=this.sections;a<s.length;a+=1){var h=s[a];if(h.image)t.push(["image",h.image.name]);else{t.push(h.text);var g={};h.fontStack&&(g["text-font"]=["literal",h.fontStack.split(",")]),h.scale&&(g["font-scale"]=h.scale),h.textColor&&(g["text-color"]=["rgba"].concat(h.textColor.toArray())),t.push(g)}}return t};var aa=function(t){this.name=t.name,this.available=t.available};function be(t,a,s,h){return typeof t=="number"&&t>=0&&t<=255&&typeof a=="number"&&a>=0&&a<=255&&typeof s=="number"&&s>=0&&s<=255?h===void 0||typeof h=="number"&&h>=0&&h<=1?null:"Invalid rgba value ["+[t,a,s,h].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof h=="number"?[t,a,s,h]:[t,a,s]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function Ko(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof Bi||t instanceof Yr||t instanceof zt||t instanceof aa)return!0;if(Array.isArray(t)){for(var a=0,s=t;a<s.length;a+=1)if(!Ko(s[a]))return!1;return!0}if(typeof t=="object"){for(var h in t)if(!Ko(t[h]))return!1;return!0}return!1}function ea(t){if(t===null)return un;if(typeof t=="string")return Jr;if(typeof t=="boolean")return Dr;if(typeof t=="number")return Tt;if(t instanceof Bi)return Gr;if(t instanceof Yr)return An;if(t instanceof zt)return Wi;if(t instanceof aa)return di;if(Array.isArray(t)){for(var a,s=t.length,h=0,g=t;h<g.length;h+=1){var m=ea(g[h]);if(a){if(a===m)continue;a=Qr;break}a=m}return Ti(a||Qr,s)}return vi}function hu(t){var a=typeof t;return t===null?"":a==="string"||a==="number"||a==="boolean"?String(t):t instanceof Bi||t instanceof zt||t instanceof aa?t.toString():JSON.stringify(t)}aa.prototype.toString=function(){return this.name},aa.fromString=function(t){return t?new aa({name:t,available:!1}):null},aa.prototype.serialize=function(){return["image",this.name]};var Na=function(t,a){this.type=t,this.value=a};Na.parse=function(t,a){if(t.length!==2)return a.error("'literal' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(!Ko(t[1]))return a.error("invalid value");var s=t[1],h=ea(s),g=a.expectedType;return h.kind!=="array"||h.N!==0||!g||g.kind!=="array"||typeof g.N=="number"&&g.N!==0||(h=g),new Na(h,s)},Na.prototype.evaluate=function(){return this.value},Na.prototype.eachChild=function(){},Na.prototype.outputDefined=function(){return!0},Na.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Bi?["rgba"].concat(this.value.toArray()):this.value instanceof zt?this.value.serialize():this.value};var Ma=function(t){this.name="ExpressionEvaluationError",this.message=t};Ma.prototype.toJSON=function(){return this.message};var Wa={string:Jr,number:Tt,boolean:Dr,object:vi},oa=function(t,a){this.type=t,this.args=a};oa.parse=function(t,a){if(t.length<2)return a.error("Expected at least one argument.");var s,h=1,g=t[0];if(g==="array"){var m,S;if(t.length>2){var M=t[1];if(typeof M!="string"||!(M in Wa)||M==="object")return a.error('The item type argument of "array" must be one of string, number, boolean',1);m=Wa[M],h++}else m=Qr;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return a.error('The length argument to "array" must be a positive integer literal',2);S=t[2],h++}s=Ti(m,S)}else s=Wa[g];for(var k=[];h<t.length;h++){var z=a.parse(t[h],h,Qr);if(!z)return null;k.push(z)}return new oa(s,k)},oa.prototype.evaluate=function(t){for(var a=0;a<this.args.length;a++){var s=this.args[a].evaluate(t);if(!qt(this.type,ea(s)))return s;if(a===this.args.length-1)throw new Ma("Expected value to be of type "+_i(this.type)+", but found "+_i(ea(s))+" instead.")}return null},oa.prototype.eachChild=function(t){this.args.forEach(t)},oa.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},oa.prototype.serialize=function(){var t=this.type,a=[t.kind];if(t.kind==="array"){var s=t.itemType;if(s.kind==="string"||s.kind==="number"||s.kind==="boolean"){a.push(s.kind);var h=t.N;(typeof h=="number"||this.args.length>1)&&a.push(h)}}return a.concat(this.args.map(function(g){return g.serialize()}))};var Eo=function(t){this.type=Wi,this.sections=t};Eo.parse=function(t,a){if(t.length<2)return a.error("Expected at least one argument.");var s=t[1];if(!Array.isArray(s)&&typeof s=="object")return a.error("First argument must be an image or text section.");for(var h=[],g=!1,m=1;m<=t.length-1;++m){var S=t[m];if(g&&typeof S=="object"&&!Array.isArray(S)){g=!1;var M=null;if(S["font-scale"]&&!(M=a.parse(S["font-scale"],1,Tt)))return null;var k=null;if(S["text-font"]&&!(k=a.parse(S["text-font"],1,Ti(Jr))))return null;var z=null;if(S["text-color"]&&!(z=a.parse(S["text-color"],1,Gr)))return null;var V=h[h.length-1];V.scale=M,V.font=k,V.textColor=z}else{var H=a.parse(t[m],1,Qr);if(!H)return null;var te=H.type.kind;if(te!=="string"&&te!=="value"&&te!=="null"&&te!=="resolvedImage")return a.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");g=!0,h.push({content:H,scale:null,font:null,textColor:null})}}return new Eo(h)},Eo.prototype.evaluate=function(t){return new zt(this.sections.map(function(a){var s=a.content.evaluate(t);return ea(s)===di?new wn("",s,null,null,null):new wn(hu(s),null,a.scale?a.scale.evaluate(t):null,a.font?a.font.evaluate(t).join(","):null,a.textColor?a.textColor.evaluate(t):null)}))},Eo.prototype.eachChild=function(t){for(var a=0,s=this.sections;a<s.length;a+=1){var h=s[a];t(h.content),h.scale&&t(h.scale),h.font&&t(h.font),h.textColor&&t(h.textColor)}},Eo.prototype.outputDefined=function(){return!1},Eo.prototype.serialize=function(){for(var t=["format"],a=0,s=this.sections;a<s.length;a+=1){var h=s[a];t.push(h.content.serialize());var g={};h.scale&&(g["font-scale"]=h.scale.serialize()),h.font&&(g["text-font"]=h.font.serialize()),h.textColor&&(g["text-color"]=h.textColor.serialize()),t.push(g)}return t};var Vo=function(t){this.type=di,this.input=t};Vo.parse=function(t,a){if(t.length!==2)return a.error("Expected two arguments.");var s=a.parse(t[1],1,Jr);return s?new Vo(s):a.error("No image name provided.")},Vo.prototype.evaluate=function(t){var a=this.input.evaluate(t),s=aa.fromString(a);return s&&t.availableImages&&(s.available=t.availableImages.indexOf(a)>-1),s},Vo.prototype.eachChild=function(t){t(this.input)},Vo.prototype.outputDefined=function(){return!1},Vo.prototype.serialize=function(){return["image",this.input.serialize()]};var bu={"to-boolean":Dr,"to-color":Gr,"to-number":Tt,"to-string":Jr},co=function(t,a){this.type=t,this.args=a};co.parse=function(t,a){if(t.length<2)return a.error("Expected at least one argument.");var s=t[0];if((s==="to-boolean"||s==="to-string")&&t.length!==2)return a.error("Expected one argument.");for(var h=bu[s],g=[],m=1;m<t.length;m++){var S=a.parse(t[m],m,Qr);if(!S)return null;g.push(S)}return new co(h,g)},co.prototype.evaluate=function(t){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(t));if(this.type.kind==="color"){for(var a,s,h=0,g=this.args;h<g.length;h+=1){if(s=null,(a=g[h].evaluate(t))instanceof Bi)return a;if(typeof a=="string"){var m=t.parseColor(a);if(m)return m}else if(Array.isArray(a)&&!(s=a.length<3||a.length>4?"Invalid rbga value "+JSON.stringify(a)+": expected an array containing either three or four numeric values.":be(a[0],a[1],a[2],a[3])))return new Bi(a[0]/255,a[1]/255,a[2]/255,a[3])}throw new Ma(s||"Could not parse color from value '"+(typeof a=="string"?a:String(JSON.stringify(a)))+"'")}if(this.type.kind==="number"){for(var S=null,M=0,k=this.args;M<k.length;M+=1){if((S=k[M].evaluate(t))===null)return 0;var z=Number(S);if(!isNaN(z))return z}throw new Ma("Could not convert "+JSON.stringify(S)+" to number.")}return this.type.kind==="formatted"?zt.fromString(hu(this.args[0].evaluate(t))):this.type.kind==="resolvedImage"?aa.fromString(hu(this.args[0].evaluate(t))):hu(this.args[0].evaluate(t))},co.prototype.eachChild=function(t){this.args.forEach(t)},co.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},co.prototype.serialize=function(){if(this.type.kind==="formatted")return new Eo([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Vo(this.args[0]).serialize();var t=["to-"+this.type.kind];return this.eachChild(function(a){t.push(a.serialize())}),t};var Ro=["Unknown","Point","LineString","Polygon"],sa=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};sa.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},sa.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?Ro[this.feature.type]:this.feature.type:null},sa.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},sa.prototype.canonicalID=function(){return this.canonical},sa.prototype.properties=function(){return this.feature&&this.feature.properties||{}},sa.prototype.parseColor=function(t){var a=this._parseColorCache[t];return a||(a=this._parseColorCache[t]=Bi.parse(t)),a};var Xa=function(t,a,s,h){this.name=t,this.type=a,this._evaluate=s,this.args=h};Xa.prototype.evaluate=function(t){return this._evaluate(t,this.args)},Xa.prototype.eachChild=function(t){this.args.forEach(t)},Xa.prototype.outputDefined=function(){return!1},Xa.prototype.serialize=function(){return[this.name].concat(this.args.map(function(t){return t.serialize()}))},Xa.parse=function(t,a){var s,h=t[0],g=Xa.definitions[h];if(!g)return a.error('Unknown expression "'+h+'". If you wanted a literal array, use ["literal", [...]].',0);for(var m=Array.isArray(g)?g[0]:g.type,S=Array.isArray(g)?[[g[1],g[2]]]:g.overloads,M=S.filter(function(zn){var ln=zn[0];return!Array.isArray(ln)||ln.length===t.length-1}),k=null,z=0,V=M;z<V.length;z+=1){var H=V[z],te=H[0],se=H[1];k=new ks(a.registry,a.path,null,a.scope);for(var Me=[],Ie=!1,qe=1;qe<t.length;qe++){var ze=t[qe],at=Array.isArray(te)?te[qe-1]:te.type,bt=k.parse(ze,1+Me.length,at);if(!bt){Ie=!0;break}Me.push(bt)}if(!Ie)if(Array.isArray(te)&&te.length!==Me.length)k.error("Expected "+te.length+" arguments, but found "+Me.length+" instead.");else{for(var Ut=0;Ut<Me.length;Ut++){var Ht=Array.isArray(te)?te[Ut]:te.type,or=Me[Ut];k.concat(Ut+1).checkSubtype(Ht,or.type)}if(k.errors.length===0)return new Xa(h,m,se,Me)}}if(M.length===1)(s=a.errors).push.apply(s,k.errors);else{for(var Ar=(M.length?M:S).map(function(zn){var ln;return ln=zn[0],Array.isArray(ln)?"("+ln.map(_i).join(", ")+")":"("+_i(ln.type)+"...)"}).join(" | "),Vr=[],kn=1;kn<t.length;kn++){var an=a.parse(t[kn],1+Vr.length);if(!an)return null;Vr.push(_i(an.type))}a.error("Expected arguments of type "+Ar+", but found ("+Vr.join(", ")+") instead.")}return null},Xa.register=function(t,a){for(var s in Xa.definitions=a,a)t[s]=Xa};var Lo=function(t,a,s){this.type=An,this.locale=s,this.caseSensitive=t,this.diacriticSensitive=a};function Ya(t,a){t[0]=Math.min(t[0],a[0]),t[1]=Math.min(t[1],a[1]),t[2]=Math.max(t[2],a[0]),t[3]=Math.max(t[3],a[1])}function Ps(t,a){return!(t[0]<=a[0]||t[2]>=a[2]||t[1]<=a[1]||t[3]>=a[3])}function Cl(t,a){var s=(180+t[0])/360,h=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,g=Math.pow(2,a.z);return[Math.round(s*g*8192),Math.round(h*g*8192)]}function ps(t,a,s){return a[1]>t[1]!=s[1]>t[1]&&t[0]<(s[0]-a[0])*(t[1]-a[1])/(s[1]-a[1])+a[0]}function ie(t,a){for(var s,h,g,m,S,M,k,z=!1,V=0,H=a.length;V<H;V++)for(var te=a[V],se=0,Me=te.length;se<Me-1;se++){if((m=(s=t)[0]-(h=te[se])[0])*(k=s[1]-(g=te[se+1])[1])-(M=s[0]-g[0])*(S=s[1]-h[1])==0&&m*M<=0&&S*k<=0)return!1;ps(t,te[se],te[se+1])&&(z=!z)}return z}function xe(t,a){for(var s=0;s<a.length;s++)if(ie(t,a[s]))return!0;return!1}function Ke(t,a,s,h){var g=h[0]-s[0],m=h[1]-s[1],S=(t[0]-s[0])*m-g*(t[1]-s[1]),M=(a[0]-s[0])*m-g*(a[1]-s[1]);return S>0&&M<0||S<0&&M>0}function Mt(t,a,s){for(var h=0,g=s;h<g.length;h+=1)for(var m=g[h],S=0;S<m.length-1;++S)if((H=[(V=m[S+1])[0]-(z=m[S])[0],V[1]-z[1]])[0]*(te=[(k=a)[0]-(M=t)[0],k[1]-M[1]])[1]-H[1]*te[0]!=0&&Ke(M,k,z,V)&&Ke(z,V,M,k))return!0;var M,k,z,V,H,te;return!1}function Pr(t,a){for(var s=0;s<t.length;++s)if(!ie(t[s],a))return!1;for(var h=0;h<t.length-1;++h)if(Mt(t[h],t[h+1],a))return!1;return!0}function Tn(t,a){for(var s=0;s<a.length;s++)if(Pr(t,a[s]))return!0;return!1}function Mi(t,a,s){for(var h=[],g=0;g<t.length;g++){for(var m=[],S=0;S<t[g].length;S++){var M=Cl(t[g][S],s);Ya(a,M),m.push(M)}h.push(m)}return h}function eo(t,a,s){for(var h=[],g=0;g<t.length;g++){var m=Mi(t[g],a,s);h.push(m)}return h}function La(t,a,s,h){if(t[0]<s[0]||t[0]>s[2]){var g=.5*h,m=t[0]-s[0]>g?-h:s[0]-t[0]>g?h:0;m===0&&(m=t[0]-s[2]>g?-h:s[2]-t[0]>g?h:0),t[0]+=m}Ya(a,t)}function Ba(t,a,s,h){for(var g=8192*Math.pow(2,h.z),m=[8192*h.x,8192*h.y],S=[],M=0,k=t;M<k.length;M+=1)for(var z=0,V=k[M];z<V.length;z+=1){var H=V[z],te=[H.x+m[0],H.y+m[1]];La(te,a,s,g),S.push(te)}return S}function jo(t,a,s,h){for(var g,m=8192*Math.pow(2,h.z),S=[8192*h.x,8192*h.y],M=[],k=0,z=t;k<z.length;k+=1){for(var V=[],H=0,te=z[k];H<te.length;H+=1){var se=te[H],Me=[se.x+S[0],se.y+S[1]];Ya(a,Me),V.push(Me)}M.push(V)}if(a[2]-a[0]<=m/2){(g=a)[0]=g[1]=1/0,g[2]=g[3]=-1/0;for(var Ie=0,qe=M;Ie<qe.length;Ie+=1)for(var ze=0,at=qe[Ie];ze<at.length;ze+=1)La(at[ze],a,s,m)}return M}Lo.parse=function(t,a){if(t.length!==2)return a.error("Expected one argument.");var s=t[1];if(typeof s!="object"||Array.isArray(s))return a.error("Collator options argument must be an object.");var h=a.parse(s["case-sensitive"]!==void 0&&s["case-sensitive"],1,Dr);if(!h)return null;var g=a.parse(s["diacritic-sensitive"]!==void 0&&s["diacritic-sensitive"],1,Dr);if(!g)return null;var m=null;return s.locale&&!(m=a.parse(s.locale,1,Jr))?null:new Lo(h,g,m)},Lo.prototype.evaluate=function(t){return new Yr(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)},Lo.prototype.eachChild=function(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)},Lo.prototype.outputDefined=function(){return!1},Lo.prototype.serialize=function(){var t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]};var ds=function(t,a){this.type=Dr,this.geojson=t,this.geometries=a};function ao(t){if(t instanceof Xa&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof ds)return!1;var a=!0;return t.eachChild(function(s){a&&!ao(s)&&(a=!1)}),a}function So(t){if(t instanceof Xa&&t.name==="feature-state")return!1;var a=!0;return t.eachChild(function(s){a&&!So(s)&&(a=!1)}),a}function vs(t,a){if(t instanceof Xa&&a.indexOf(t.name)>=0)return!1;var s=!0;return t.eachChild(function(h){s&&!vs(h,a)&&(s=!1)}),s}ds.parse=function(t,a){if(t.length!==2)return a.error("'within' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(Ko(t[1])){var s=t[1];if(s.type==="FeatureCollection")for(var h=0;h<s.features.length;++h){var g=s.features[h].geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new ds(s,s.features[h].geometry)}else if(s.type==="Feature"){var m=s.geometry.type;if(m==="Polygon"||m==="MultiPolygon")return new ds(s,s.geometry)}else if(s.type==="Polygon"||s.type==="MultiPolygon")return new ds(s,s)}return a.error("'within' expression requires valid geojson object that contains polygon geometry type.")},ds.prototype.evaluate=function(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(a,s){var h=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],m=a.canonicalID();if(s.type==="Polygon"){var S=Mi(s.coordinates,g,m),M=Ba(a.geometry(),h,g,m);if(!Ps(h,g))return!1;for(var k=0,z=M;k<z.length;k+=1)if(!ie(z[k],S))return!1}if(s.type==="MultiPolygon"){var V=eo(s.coordinates,g,m),H=Ba(a.geometry(),h,g,m);if(!Ps(h,g))return!1;for(var te=0,se=H;te<se.length;te+=1)if(!xe(se[te],V))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(a,s){var h=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],m=a.canonicalID();if(s.type==="Polygon"){var S=Mi(s.coordinates,g,m),M=jo(a.geometry(),h,g,m);if(!Ps(h,g))return!1;for(var k=0,z=M;k<z.length;k+=1)if(!Pr(z[k],S))return!1}if(s.type==="MultiPolygon"){var V=eo(s.coordinates,g,m),H=jo(a.geometry(),h,g,m);if(!Ps(h,g))return!1;for(var te=0,se=H;te<se.length;te+=1)if(!Tn(se[te],V))return!1}return!0}(t,this.geometries)}return!1},ds.prototype.eachChild=function(){},ds.prototype.outputDefined=function(){return!0},ds.prototype.serialize=function(){return["within",this.geojson]};var Is=function(t,a){this.type=a.type,this.name=t,this.boundExpression=a};Is.parse=function(t,a){if(t.length!==2||typeof t[1]!="string")return a.error("'var' expression requires exactly one string literal argument.");var s=t[1];return a.scope.has(s)?new Is(s,a.scope.get(s)):a.error('Unknown variable "'+s+'". Make sure "'+s+'" has been bound in an enclosing "let" expression before using it.',1)},Is.prototype.evaluate=function(t){return this.boundExpression.evaluate(t)},Is.prototype.eachChild=function(){},Is.prototype.outputDefined=function(){return!1},Is.prototype.serialize=function(){return["var",this.name]};var ks=function(t,a,s,h,g){a===void 0&&(a=[]),h===void 0&&(h=new gn),g===void 0&&(g=[]),this.registry=t,this.path=a,this.key=a.map(function(m){return"["+m+"]"}).join(""),this.scope=h,this.errors=g,this.expectedType=s};function $s(t,a){for(var s,h=t.length-1,g=0,m=h,S=0;g<=m;)if((s=t[S=Math.floor((g+m)/2)])<=a){if(S===h||a<t[S+1])return S;g=S+1}else{if(!(s>a))throw new Ma("Input is not a number.");m=S-1}return 0}ks.prototype.parse=function(t,a,s,h,g){return g===void 0&&(g={}),a?this.concat(a,s,h)._parse(t,g):this._parse(t,g)},ks.prototype._parse=function(t,a){function s(z,V,H){return H==="assert"?new oa(V,[z]):H==="coerce"?new co(V,[z]):z}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var h=t[0];if(typeof h!="string")return this.error("Expression name must be a string, but found "+typeof h+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var g=this.registry[h];if(g){var m=g.parse(t,this);if(!m)return null;if(this.expectedType){var S=this.expectedType,M=m.type;if(S.kind!=="string"&&S.kind!=="number"&&S.kind!=="boolean"&&S.kind!=="object"&&S.kind!=="array"||M.kind!=="value")if(S.kind!=="color"&&S.kind!=="formatted"&&S.kind!=="resolvedImage"||M.kind!=="value"&&M.kind!=="string"){if(this.checkSubtype(S,M))return null}else m=s(m,S,a.typeAnnotation||"coerce");else m=s(m,S,a.typeAnnotation||"assert")}if(!(m instanceof Na)&&m.type.kind!=="resolvedImage"&&function z(V){if(V instanceof Is)return z(V.boundExpression);if(V instanceof Xa&&V.name==="error"||V instanceof Lo||V instanceof ds)return!1;var H=V instanceof co||V instanceof oa,te=!0;return V.eachChild(function(se){te=H?te&&z(se):te&&se instanceof Na}),!!te&&ao(V)&&vs(V,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(m)){var k=new sa;try{m=new Na(m.type,m.evaluate(k))}catch(z){return this.error(z.message),null}}return m}return this.error('Unknown expression "'+h+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof t+" instead.")},ks.prototype.concat=function(t,a,s){var h=typeof t=="number"?this.path.concat(t):this.path,g=s?this.scope.concat(s):this.scope;return new ks(this.registry,h,a||null,g,this.errors)},ks.prototype.error=function(t){for(var a=[],s=arguments.length-1;s-- >0;)a[s]=arguments[s+1];var h=""+this.key+a.map(function(g){return"["+g+"]"}).join("");this.errors.push(new pr(h,t))},ks.prototype.checkSubtype=function(t,a){var s=qt(t,a);return s&&this.error(s),s};var ms=function(t,a,s){this.type=t,this.input=a,this.labels=[],this.outputs=[];for(var h=0,g=s;h<g.length;h+=1){var m=g[h],S=m[1];this.labels.push(m[0]),this.outputs.push(S)}};function ga(t,a,s){return t*(1-s)+a*s}ms.parse=function(t,a){if(t.length-1<4)return a.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return a.error("Expected an even number of arguments.");var s=a.parse(t[1],1,Tt);if(!s)return null;var h=[],g=null;a.expectedType&&a.expectedType.kind!=="value"&&(g=a.expectedType);for(var m=1;m<t.length;m+=2){var S=m===1?-1/0:t[m],M=t[m+1],k=m,z=m+1;if(typeof S!="number")return a.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',k);if(h.length&&h[h.length-1][0]>=S)return a.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',k);var V=a.parse(M,z,g);if(!V)return null;g=g||V.type,h.push([S,V])}return new ms(g,s,h)},ms.prototype.evaluate=function(t){var a=this.labels,s=this.outputs;if(a.length===1)return s[0].evaluate(t);var h=this.input.evaluate(t);if(h<=a[0])return s[0].evaluate(t);var g=a.length;return h>=a[g-1]?s[g-1].evaluate(t):s[$s(a,h)].evaluate(t)},ms.prototype.eachChild=function(t){t(this.input);for(var a=0,s=this.outputs;a<s.length;a+=1)t(s[a])},ms.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})},ms.prototype.serialize=function(){for(var t=["step",this.input.serialize()],a=0;a<this.labels.length;a++)a>0&&t.push(this.labels[a]),t.push(this.outputs[a].serialize());return t};var _a=Object.freeze({__proto__:null,number:ga,color:function(t,a,s){return new Bi(ga(t.r,a.r,s),ga(t.g,a.g,s),ga(t.b,a.b,s),ga(t.a,a.a,s))},array:function(t,a,s){return t.map(function(h,g){return ga(h,a[g],s)})}}),ns=6/29*3*(6/29),Jc=Math.PI/180,Tl=180/Math.PI;function Zs(t){return t>.008856451679035631?Math.pow(t,1/3):t/ns+4/29}function nc(t){return t>6/29?t*t*t:ns*(t-4/29)}function Gu(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Vs(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function ul(t){var a=Vs(t.r),s=Vs(t.g),h=Vs(t.b),g=Zs((.4124564*a+.3575761*s+.1804375*h)/.95047),m=Zs((.2126729*a+.7151522*s+.072175*h)/1);return{l:116*m-16,a:500*(g-m),b:200*(m-Zs((.0193339*a+.119192*s+.9503041*h)/1.08883)),alpha:t.a}}function y(t){var a=(t.l+16)/116,s=isNaN(t.a)?a:a+t.a/500,h=isNaN(t.b)?a:a-t.b/200;return a=1*nc(a),s=.95047*nc(s),h=1.08883*nc(h),new Bi(Gu(3.2404542*s-1.5371385*a-.4985314*h),Gu(-.969266*s+1.8760108*a+.041556*h),Gu(.0556434*s-.2040259*a+1.0572252*h),t.alpha)}function T(t,a,s){var h=a-t;return t+s*(h>180||h<-180?h-360*Math.round(h/360):h)}var N={forward:ul,reverse:y,interpolate:function(t,a,s){return{l:ga(t.l,a.l,s),a:ga(t.a,a.a,s),b:ga(t.b,a.b,s),alpha:ga(t.alpha,a.alpha,s)}}},O={forward:function(t){var a=ul(t),s=a.l,h=a.a,g=a.b,m=Math.atan2(g,h)*Tl;return{h:m<0?m+360:m,c:Math.sqrt(h*h+g*g),l:s,alpha:t.a}},reverse:function(t){var a=t.h*Jc,s=t.c;return y({l:t.l,a:Math.cos(a)*s,b:Math.sin(a)*s,alpha:t.alpha})},interpolate:function(t,a,s){return{h:T(t.h,a.h,s),c:ga(t.c,a.c,s),l:ga(t.l,a.l,s),alpha:ga(t.alpha,a.alpha,s)}}},$=Object.freeze({__proto__:null,lab:N,hcl:O}),_e=function(t,a,s,h,g){this.type=t,this.operator=a,this.interpolation=s,this.input=h,this.labels=[],this.outputs=[];for(var m=0,S=g;m<S.length;m+=1){var M=S[m],k=M[1];this.labels.push(M[0]),this.outputs.push(k)}};function Xe(t,a,s,h){var g=h-s,m=t-s;return g===0?0:a===1?m/g:(Math.pow(a,m)-1)/(Math.pow(a,g)-1)}_e.interpolationFactor=function(t,a,s,h){var g=0;if(t.name==="exponential")g=Xe(a,t.base,s,h);else if(t.name==="linear")g=Xe(a,1,s,h);else if(t.name==="cubic-bezier"){var m=t.controlPoints;g=new F(m[0],m[1],m[2],m[3]).solve(Xe(a,1,s,h))}return g},_e.parse=function(t,a){var s=t[0],h=t[1],g=t[2],m=t.slice(3);if(!Array.isArray(h)||h.length===0)return a.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){var S=h[1];if(typeof S!="number")return a.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:S}}else{if(h[0]!=="cubic-bezier")return a.error("Unknown interpolation type "+String(h[0]),1,0);var M=h.slice(1);if(M.length!==4||M.some(function(qe){return typeof qe!="number"||qe<0||qe>1}))return a.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:M}}if(t.length-1<4)return a.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return a.error("Expected an even number of arguments.");if(!(g=a.parse(g,2,Tt)))return null;var k=[],z=null;s==="interpolate-hcl"||s==="interpolate-lab"?z=Gr:a.expectedType&&a.expectedType.kind!=="value"&&(z=a.expectedType);for(var V=0;V<m.length;V+=2){var H=m[V],te=m[V+1],se=V+3,Me=V+4;if(typeof H!="number")return a.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',se);if(k.length&&k[k.length-1][0]>=H)return a.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',se);var Ie=a.parse(te,Me,z);if(!Ie)return null;z=z||Ie.type,k.push([H,Ie])}return z.kind==="number"||z.kind==="color"||z.kind==="array"&&z.itemType.kind==="number"&&typeof z.N=="number"?new _e(z,s,h,g,k):a.error("Type "+_i(z)+" is not interpolatable.")},_e.prototype.evaluate=function(t){var a=this.labels,s=this.outputs;if(a.length===1)return s[0].evaluate(t);var h=this.input.evaluate(t);if(h<=a[0])return s[0].evaluate(t);var g=a.length;if(h>=a[g-1])return s[g-1].evaluate(t);var m=$s(a,h),S=_e.interpolationFactor(this.interpolation,h,a[m],a[m+1]),M=s[m].evaluate(t),k=s[m+1].evaluate(t);return this.operator==="interpolate"?_a[this.type.kind.toLowerCase()](M,k,S):this.operator==="interpolate-hcl"?O.reverse(O.interpolate(O.forward(M),O.forward(k),S)):N.reverse(N.interpolate(N.forward(M),N.forward(k),S))},_e.prototype.eachChild=function(t){t(this.input);for(var a=0,s=this.outputs;a<s.length;a+=1)t(s[a])},_e.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})},_e.prototype.serialize=function(){var t;t=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var a=[this.operator,t,this.input.serialize()],s=0;s<this.labels.length;s++)a.push(this.labels[s],this.outputs[s].serialize());return a};var ht=function(t,a){this.type=t,this.args=a};ht.parse=function(t,a){if(t.length<2)return a.error("Expectected at least one argument.");var s=null,h=a.expectedType;h&&h.kind!=="value"&&(s=h);for(var g=[],m=0,S=t.slice(1);m<S.length;m+=1){var M=a.parse(S[m],1+g.length,s,void 0,{typeAnnotation:"omit"});if(!M)return null;s=s||M.type,g.push(M)}var k=h&&g.some(function(z){return qt(h,z.type)});return new ht(k?Qr:s,g)},ht.prototype.evaluate=function(t){for(var a,s=null,h=0,g=0,m=this.args;g<m.length&&(h++,(s=m[g].evaluate(t))&&s instanceof aa&&!s.available&&(a||(a=s.name),s=null,h===this.args.length&&(s=a)),s===null);g+=1);return s},ht.prototype.eachChild=function(t){this.args.forEach(t)},ht.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},ht.prototype.serialize=function(){var t=["coalesce"];return this.eachChild(function(a){t.push(a.serialize())}),t};var dt=function(t,a){this.type=a.type,this.bindings=[].concat(t),this.result=a};dt.prototype.evaluate=function(t){return this.result.evaluate(t)},dt.prototype.eachChild=function(t){for(var a=0,s=this.bindings;a<s.length;a+=1)t(s[a][1]);t(this.result)},dt.parse=function(t,a){if(t.length<4)return a.error("Expected at least 3 arguments, but found "+(t.length-1)+" instead.");for(var s=[],h=1;h<t.length-1;h+=2){var g=t[h];if(typeof g!="string")return a.error("Expected string, but found "+typeof g+" instead.",h);if(/[^a-zA-Z0-9_]/.test(g))return a.error("Variable names must contain only alphanumeric characters or '_'.",h);var m=a.parse(t[h+1],h+1);if(!m)return null;s.push([g,m])}var S=a.parse(t[t.length-1],t.length-1,a.expectedType,s);return S?new dt(s,S):null},dt.prototype.outputDefined=function(){return this.result.outputDefined()},dt.prototype.serialize=function(){for(var t=["let"],a=0,s=this.bindings;a<s.length;a+=1){var h=s[a];t.push(h[0],h[1].serialize())}return t.push(this.result.serialize()),t};var ir=function(t,a,s){this.type=t,this.index=a,this.input=s};ir.parse=function(t,a){if(t.length!==3)return a.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var s=a.parse(t[1],1,Tt),h=a.parse(t[2],2,Ti(a.expectedType||Qr));return s&&h?new ir(h.type.itemType,s,h):null},ir.prototype.evaluate=function(t){var a=this.index.evaluate(t),s=this.input.evaluate(t);if(a<0)throw new Ma("Array index out of bounds: "+a+" < 0.");if(a>=s.length)throw new Ma("Array index out of bounds: "+a+" > "+(s.length-1)+".");if(a!==Math.floor(a))throw new Ma("Array index must be an integer, but found "+a+" instead.");return s[a]},ir.prototype.eachChild=function(t){t(this.index),t(this.input)},ir.prototype.outputDefined=function(){return!1},ir.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var sr=function(t,a){this.type=Dr,this.needle=t,this.haystack=a};sr.parse=function(t,a){if(t.length!==3)return a.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var s=a.parse(t[1],1,Qr),h=a.parse(t[2],2,Qr);return s&&h?Aa(s.type,[Dr,Jr,Tt,un,Qr])?new sr(s,h):a.error("Expected first argument to be of type boolean, string, number or null, but found "+_i(s.type)+" instead"):null},sr.prototype.evaluate=function(t){var a=this.needle.evaluate(t),s=this.haystack.evaluate(t);if(!s)return!1;if(!Ei(a,["boolean","string","number","null"]))throw new Ma("Expected first argument to be of type boolean, string, number or null, but found "+_i(ea(a))+" instead.");if(!Ei(s,["string","array"]))throw new Ma("Expected second argument to be of type array or string, but found "+_i(ea(s))+" instead.");return s.indexOf(a)>=0},sr.prototype.eachChild=function(t){t(this.needle),t(this.haystack)},sr.prototype.outputDefined=function(){return!0},sr.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var Cn=function(t,a,s){this.type=Tt,this.needle=t,this.haystack=a,this.fromIndex=s};Cn.parse=function(t,a){if(t.length<=2||t.length>=5)return a.error("Expected 3 or 4 arguments, but found "+(t.length-1)+" instead.");var s=a.parse(t[1],1,Qr),h=a.parse(t[2],2,Qr);if(!s||!h)return null;if(!Aa(s.type,[Dr,Jr,Tt,un,Qr]))return a.error("Expected first argument to be of type boolean, string, number or null, but found "+_i(s.type)+" instead");if(t.length===4){var g=a.parse(t[3],3,Tt);return g?new Cn(s,h,g):null}return new Cn(s,h)},Cn.prototype.evaluate=function(t){var a=this.needle.evaluate(t),s=this.haystack.evaluate(t);if(!Ei(a,["boolean","string","number","null"]))throw new Ma("Expected first argument to be of type boolean, string, number or null, but found "+_i(ea(a))+" instead.");if(!Ei(s,["string","array"]))throw new Ma("Expected second argument to be of type array or string, but found "+_i(ea(s))+" instead.");if(this.fromIndex){var h=this.fromIndex.evaluate(t);return s.indexOf(a,h)}return s.indexOf(a)},Cn.prototype.eachChild=function(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)},Cn.prototype.outputDefined=function(){return!1},Cn.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var ni=function(t,a,s,h,g,m){this.inputType=t,this.type=a,this.input=s,this.cases=h,this.outputs=g,this.otherwise=m};ni.parse=function(t,a){if(t.length<5)return a.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if(t.length%2!=1)return a.error("Expected an even number of arguments.");var s,h;a.expectedType&&a.expectedType.kind!=="value"&&(h=a.expectedType);for(var g={},m=[],S=2;S<t.length-1;S+=2){var M=t[S],k=t[S+1];Array.isArray(M)||(M=[M]);var z=a.concat(S);if(M.length===0)return z.error("Expected at least one branch label.");for(var V=0,H=M;V<H.length;V+=1){var te=H[V];if(typeof te!="number"&&typeof te!="string")return z.error("Branch labels must be numbers or strings.");if(typeof te=="number"&&Math.abs(te)>Number.MAX_SAFE_INTEGER)return z.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof te=="number"&&Math.floor(te)!==te)return z.error("Numeric branch labels must be integer values.");if(s){if(z.checkSubtype(s,ea(te)))return null}else s=ea(te);if(g[String(te)]!==void 0)return z.error("Branch labels must be unique.");g[String(te)]=m.length}var se=a.parse(k,S,h);if(!se)return null;h=h||se.type,m.push(se)}var Me=a.parse(t[1],1,Qr);if(!Me)return null;var Ie=a.parse(t[t.length-1],t.length-1,h);return Ie?Me.type.kind!=="value"&&a.concat(1).checkSubtype(s,Me.type)?null:new ni(s,h,Me,g,m,Ie):null},ni.prototype.evaluate=function(t){var a=this.input.evaluate(t);return(ea(a)===this.inputType&&this.outputs[this.cases[a]]||this.otherwise).evaluate(t)},ni.prototype.eachChild=function(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)},ni.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})&&this.otherwise.outputDefined()},ni.prototype.serialize=function(){for(var t=this,a=["match",this.input.serialize()],s=[],h={},g=0,m=Object.keys(this.cases).sort();g<m.length;g+=1){var S=m[g];(H=h[this.cases[S]])===void 0?(h[this.cases[S]]=s.length,s.push([this.cases[S],[S]])):s[H][1].push(S)}for(var M=function(se){return t.inputType.kind==="number"?Number(se):se},k=0,z=s;k<z.length;k+=1){var V=z[k],H=V[0],te=V[1];a.push(te.length===1?M(te[0]):te.map(M)),a.push(this.outputs[outputIndex$1].serialize())}return a.push(this.otherwise.serialize()),a};var In=function(t,a,s){this.type=t,this.branches=a,this.otherwise=s};In.parse=function(t,a){if(t.length<4)return a.error("Expected at least 3 arguments, but found only "+(t.length-1)+".");if(t.length%2!=0)return a.error("Expected an odd number of arguments.");var s;a.expectedType&&a.expectedType.kind!=="value"&&(s=a.expectedType);for(var h=[],g=1;g<t.length-1;g+=2){var m=a.parse(t[g],g,Dr);if(!m)return null;var S=a.parse(t[g+1],g+1,s);if(!S)return null;h.push([m,S]),s=s||S.type}var M=a.parse(t[t.length-1],t.length-1,s);return M?new In(s,h,M):null},In.prototype.evaluate=function(t){for(var a=0,s=this.branches;a<s.length;a+=1){var h=s[a],g=h[1];if(h[0].evaluate(t))return g.evaluate(t)}return this.otherwise.evaluate(t)},In.prototype.eachChild=function(t){for(var a=0,s=this.branches;a<s.length;a+=1){var h=s[a],g=h[1];t(h[0]),t(g)}t(this.otherwise)},In.prototype.outputDefined=function(){return this.branches.every(function(t){return t[1].outputDefined()})&&this.otherwise.outputDefined()},In.prototype.serialize=function(){var t=["case"];return this.eachChild(function(a){t.push(a.serialize())}),t};var Xi=function(t,a,s,h){this.type=t,this.input=a,this.beginIndex=s,this.endIndex=h};function va(t,a){return t==="=="||t==="!="?a.kind==="boolean"||a.kind==="string"||a.kind==="number"||a.kind==="null"||a.kind==="value":a.kind==="string"||a.kind==="number"||a.kind==="value"}function wa(t,a,s,h){return h.compare(a,s)===0}function ji(t,a,s){var h=t!=="=="&&t!=="!=";return function(){function g(m,S,M){this.type=Dr,this.lhs=m,this.rhs=S,this.collator=M,this.hasUntypedArgument=m.type.kind==="value"||S.type.kind==="value"}return g.parse=function(m,S){if(m.length!==3&&m.length!==4)return S.error("Expected two or three arguments.");var M=m[0],k=S.parse(m[1],1,Qr);if(!k)return null;if(!va(M,k.type))return S.concat(1).error('"'+M+`" comparisons are not supported for type '`+_i(k.type)+"'.");var z=S.parse(m[2],2,Qr);if(!z)return null;if(!va(M,z.type))return S.concat(2).error('"'+M+`" comparisons are not supported for type '`+_i(z.type)+"'.");if(k.type.kind!==z.type.kind&&k.type.kind!=="value"&&z.type.kind!=="value")return S.error("Cannot compare types '"+_i(k.type)+"' and '"+_i(z.type)+"'.");h&&(k.type.kind==="value"&&z.type.kind!=="value"?k=new oa(z.type,[k]):k.type.kind!=="value"&&z.type.kind==="value"&&(z=new oa(k.type,[z])));var V=null;if(m.length===4){if(k.type.kind!=="string"&&z.type.kind!=="string"&&k.type.kind!=="value"&&z.type.kind!=="value")return S.error("Cannot use collator to compare non-string types.");if(!(V=S.parse(m[3],3,An)))return null}return new g(k,z,V)},g.prototype.evaluate=function(m){var S=this.lhs.evaluate(m),M=this.rhs.evaluate(m);if(h&&this.hasUntypedArgument){var k=ea(S),z=ea(M);if(k.kind!==z.kind||k.kind!=="string"&&k.kind!=="number")throw new Ma('Expected arguments for "'+t+'" to be (string, string) or (number, number), but found ('+k.kind+", "+z.kind+") instead.")}if(this.collator&&!h&&this.hasUntypedArgument){var V=ea(S),H=ea(M);if(V.kind!=="string"||H.kind!=="string")return a(m,S,M)}return this.collator?s(m,S,M,this.collator.evaluate(m)):a(m,S,M)},g.prototype.eachChild=function(m){m(this.lhs),m(this.rhs),this.collator&&m(this.collator)},g.prototype.outputDefined=function(){return!0},g.prototype.serialize=function(){var m=[t];return this.eachChild(function(S){m.push(S.serialize())}),m},g}()}Xi.parse=function(t,a){if(t.length<=2||t.length>=5)return a.error("Expected 3 or 4 arguments, but found "+(t.length-1)+" instead.");var s=a.parse(t[1],1,Qr),h=a.parse(t[2],2,Tt);if(!s||!h)return null;if(!Aa(s.type,[Ti(Qr),Jr,Qr]))return a.error("Expected first argument to be of type array or string, but found "+_i(s.type)+" instead");if(t.length===4){var g=a.parse(t[3],3,Tt);return g?new Xi(s.type,s,h,g):null}return new Xi(s.type,s,h)},Xi.prototype.evaluate=function(t){var a=this.input.evaluate(t),s=this.beginIndex.evaluate(t);if(!Ei(a,["string","array"]))throw new Ma("Expected first argument to be of type array or string, but found "+_i(ea(a))+" instead.");if(this.endIndex){var h=this.endIndex.evaluate(t);return a.slice(s,h)}return a.slice(s)},Xi.prototype.eachChild=function(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)},Xi.prototype.outputDefined=function(){return!1},Xi.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var gs=ji("==",function(t,a,s){return a===s},wa),Js=ji("!=",function(t,a,s){return a!==s},function(t,a,s,h){return!wa(0,a,s,h)}),Hu=ji("<",function(t,a,s){return a<s},function(t,a,s,h){return h.compare(a,s)<0}),Qc=ji(">",function(t,a,s){return a>s},function(t,a,s,h){return h.compare(a,s)>0}),ll=ji("<=",function(t,a,s){return a<=s},function(t,a,s,h){return h.compare(a,s)<=0}),Oc=ji(">=",function(t,a,s){return a>=s},function(t,a,s,h){return h.compare(a,s)>=0}),Eu=function(t,a,s,h,g){this.type=Jr,this.number=t,this.locale=a,this.currency=s,this.minFractionDigits=h,this.maxFractionDigits=g};Eu.parse=function(t,a){if(t.length!==3)return a.error("Expected two arguments.");var s=a.parse(t[1],1,Tt);if(!s)return null;var h=t[2];if(typeof h!="object"||Array.isArray(h))return a.error("NumberFormat options argument must be an object.");var g=null;if(h.locale&&!(g=a.parse(h.locale,1,Jr)))return null;var m=null;if(h.currency&&!(m=a.parse(h.currency,1,Jr)))return null;var S=null;if(h["min-fraction-digits"]&&!(S=a.parse(h["min-fraction-digits"],1,Tt)))return null;var M=null;return h["max-fraction-digits"]&&!(M=a.parse(h["max-fraction-digits"],1,Tt))?null:new Eu(s,g,m,S,M)},Eu.prototype.evaluate=function(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))},Eu.prototype.eachChild=function(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)},Eu.prototype.outputDefined=function(){return!1},Eu.prototype.serialize=function(){var t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]};var Su=function(t){this.type=Tt,this.input=t};Su.parse=function(t,a){if(t.length!==2)return a.error("Expected 1 argument, but found "+(t.length-1)+" instead.");var s=a.parse(t[1],1);return s?s.type.kind!=="array"&&s.type.kind!=="string"&&s.type.kind!=="value"?a.error("Expected argument of type string or array, but found "+_i(s.type)+" instead."):new Su(s):null},Su.prototype.evaluate=function(t){var a=this.input.evaluate(t);if(typeof a=="string"||Array.isArray(a))return a.length;throw new Ma("Expected value to be of type string or array, but found "+_i(ea(a))+" instead.")},Su.prototype.eachChild=function(t){t(this.input)},Su.prototype.outputDefined=function(){return!1},Su.prototype.serialize=function(){var t=["length"];return this.eachChild(function(a){t.push(a.serialize())}),t};var wu={"==":gs,"!=":Js,">":Qc,"<":Hu,">=":Oc,"<=":ll,array:oa,at:ir,boolean:oa,case:In,coalesce:ht,collator:Lo,format:Eo,image:Vo,in:sr,"index-of":Cn,interpolate:_e,"interpolate-hcl":_e,"interpolate-lab":_e,length:Su,let:dt,literal:Na,match:ni,number:oa,"number-format":Eu,object:oa,slice:Xi,step:ms,string:oa,"to-boolean":co,"to-color":co,"to-number":co,"to-string":co,var:Is,within:ds};function oo(t,a){var s=a[0],h=a[1],g=a[2],m=a[3];s=s.evaluate(t),h=h.evaluate(t),g=g.evaluate(t);var S=m?m.evaluate(t):1,M=be(s,h,g,S);if(M)throw new Ma(M);return new Bi(s/255*S,h/255*S,g/255*S,S)}function Bf(t,a){return t in a}function zf(t,a){var s=a[t];return s===void 0?null:s}function $o(t){return{type:t}}function Rc(t){return{result:"success",value:t}}function Cu(t){return{result:"error",value:t}}function Qs(t){return t["property-type"]==="data-driven"||t["property-type"]==="cross-faded-data-driven"}function ef(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function Al(t){return!!t.expression&&t.expression.interpolated}function Di(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}function Ml(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function gh(t){return t}function cl(t,a,s){return t!==void 0?t:a!==void 0?a:s!==void 0?s:void 0}function Lc(t,a,s,h,g){return cl(typeof s===g?h[s]:void 0,t.default,a.default)}function Uf(t,a,s){if(Di(s)!=="number")return cl(t.default,a.default);var h=t.stops.length;if(h===1||s<=t.stops[0][0])return t.stops[0][1];if(s>=t.stops[h-1][0])return t.stops[h-1][1];var g=$s(t.stops.map(function(m){return m[0]}),s);return t.stops[g][1]}function yh(t,a,s){var h=t.base!==void 0?t.base:1;if(Di(s)!=="number")return cl(t.default,a.default);var g=t.stops.length;if(g===1||s<=t.stops[0][0])return t.stops[0][1];if(s>=t.stops[g-1][0])return t.stops[g-1][1];var m=$s(t.stops.map(function(H){return H[0]}),s),S=function(H,te,se,Me){var Ie=Me-se,qe=H-se;return Ie===0?0:te===1?qe/Ie:(Math.pow(te,qe)-1)/(Math.pow(te,Ie)-1)}(s,h,t.stops[m][0],t.stops[m+1][0]),M=t.stops[m][1],k=t.stops[m+1][1],z=_a[a.type]||gh;if(t.colorSpace&&t.colorSpace!=="rgb"){var V=$[t.colorSpace];z=function(H,te){return V.reverse(V.interpolate(V.forward(H),V.forward(te),S))}}return typeof M.evaluate=="function"?{evaluate:function(){for(var H=[],te=arguments.length;te--;)H[te]=arguments[te];var se=M.evaluate.apply(void 0,H),Me=k.evaluate.apply(void 0,H);if(se!==void 0&&Me!==void 0)return z(se,Me,S)}}:z(M,k,S)}function Zf(t,a,s){return a.type==="color"?s=Bi.parse(s):a.type==="formatted"?s=zt.fromString(s.toString()):a.type==="resolvedImage"?s=aa.fromString(s.toString()):Di(s)===a.type||a.type==="enum"&&a.values[s]||(s=void 0),cl(s,t.default,a.default)}Xa.register(wu,{error:[{kind:"error"},[Jr],function(t,a){throw new Ma(a[0].evaluate(t))}],typeof:[Jr,[Qr],function(t,a){return _i(ea(a[0].evaluate(t)))}],"to-rgba":[Ti(Tt,4),[Gr],function(t,a){return a[0].evaluate(t).toArray()}],rgb:[Gr,[Tt,Tt,Tt],oo],rgba:[Gr,[Tt,Tt,Tt,Tt],oo],has:{type:Dr,overloads:[[[Jr],function(t,a){return Bf(a[0].evaluate(t),t.properties())}],[[Jr,vi],function(t,a){var s=a[1];return Bf(a[0].evaluate(t),s.evaluate(t))}]]},get:{type:Qr,overloads:[[[Jr],function(t,a){return zf(a[0].evaluate(t),t.properties())}],[[Jr,vi],function(t,a){var s=a[1];return zf(a[0].evaluate(t),s.evaluate(t))}]]},"feature-state":[Qr,[Jr],function(t,a){return zf(a[0].evaluate(t),t.featureState||{})}],properties:[vi,[],function(t){return t.properties()}],"geometry-type":[Jr,[],function(t){return t.geometryType()}],id:[Qr,[],function(t){return t.id()}],zoom:[Tt,[],function(t){return t.globals.zoom}],"heatmap-density":[Tt,[],function(t){return t.globals.heatmapDensity||0}],"line-progress":[Tt,[],function(t){return t.globals.lineProgress||0}],accumulated:[Qr,[],function(t){return t.globals.accumulated===void 0?null:t.globals.accumulated}],"+":[Tt,$o(Tt),function(t,a){for(var s=0,h=0,g=a;h<g.length;h+=1)s+=g[h].evaluate(t);return s}],"*":[Tt,$o(Tt),function(t,a){for(var s=1,h=0,g=a;h<g.length;h+=1)s*=g[h].evaluate(t);return s}],"-":{type:Tt,overloads:[[[Tt,Tt],function(t,a){var s=a[1];return a[0].evaluate(t)-s.evaluate(t)}],[[Tt],function(t,a){return-a[0].evaluate(t)}]]},"/":[Tt,[Tt,Tt],function(t,a){var s=a[1];return a[0].evaluate(t)/s.evaluate(t)}],"%":[Tt,[Tt,Tt],function(t,a){var s=a[1];return a[0].evaluate(t)%s.evaluate(t)}],ln2:[Tt,[],function(){return Math.LN2}],pi:[Tt,[],function(){return Math.PI}],e:[Tt,[],function(){return Math.E}],"^":[Tt,[Tt,Tt],function(t,a){var s=a[1];return Math.pow(a[0].evaluate(t),s.evaluate(t))}],sqrt:[Tt,[Tt],function(t,a){return Math.sqrt(a[0].evaluate(t))}],log10:[Tt,[Tt],function(t,a){return Math.log(a[0].evaluate(t))/Math.LN10}],ln:[Tt,[Tt],function(t,a){return Math.log(a[0].evaluate(t))}],log2:[Tt,[Tt],function(t,a){return Math.log(a[0].evaluate(t))/Math.LN2}],sin:[Tt,[Tt],function(t,a){return Math.sin(a[0].evaluate(t))}],cos:[Tt,[Tt],function(t,a){return Math.cos(a[0].evaluate(t))}],tan:[Tt,[Tt],function(t,a){return Math.tan(a[0].evaluate(t))}],asin:[Tt,[Tt],function(t,a){return Math.asin(a[0].evaluate(t))}],acos:[Tt,[Tt],function(t,a){return Math.acos(a[0].evaluate(t))}],atan:[Tt,[Tt],function(t,a){return Math.atan(a[0].evaluate(t))}],min:[Tt,$o(Tt),function(t,a){return Math.min.apply(Math,a.map(function(s){return s.evaluate(t)}))}],max:[Tt,$o(Tt),function(t,a){return Math.max.apply(Math,a.map(function(s){return s.evaluate(t)}))}],abs:[Tt,[Tt],function(t,a){return Math.abs(a[0].evaluate(t))}],round:[Tt,[Tt],function(t,a){var s=a[0].evaluate(t);return s<0?-Math.round(-s):Math.round(s)}],floor:[Tt,[Tt],function(t,a){return Math.floor(a[0].evaluate(t))}],ceil:[Tt,[Tt],function(t,a){return Math.ceil(a[0].evaluate(t))}],"filter-==":[Dr,[Jr,Qr],function(t,a){var s=a[0],h=a[1];return t.properties()[s.value]===h.value}],"filter-id-==":[Dr,[Qr],function(t,a){var s=a[0];return t.id()===s.value}],"filter-type-==":[Dr,[Jr],function(t,a){var s=a[0];return t.geometryType()===s.value}],"filter-<":[Dr,[Jr,Qr],function(t,a){var s=a[0],h=a[1],g=t.properties()[s.value],m=h.value;return typeof g==typeof m&&g<m}],"filter-id-<":[Dr,[Qr],function(t,a){var s=a[0],h=t.id(),g=s.value;return typeof h==typeof g&&h<g}],"filter->":[Dr,[Jr,Qr],function(t,a){var s=a[0],h=a[1],g=t.properties()[s.value],m=h.value;return typeof g==typeof m&&g>m}],"filter-id->":[Dr,[Qr],function(t,a){var s=a[0],h=t.id(),g=s.value;return typeof h==typeof g&&h>g}],"filter-<=":[Dr,[Jr,Qr],function(t,a){var s=a[0],h=a[1],g=t.properties()[s.value],m=h.value;return typeof g==typeof m&&g<=m}],"filter-id-<=":[Dr,[Qr],function(t,a){var s=a[0],h=t.id(),g=s.value;return typeof h==typeof g&&h<=g}],"filter->=":[Dr,[Jr,Qr],function(t,a){var s=a[0],h=a[1],g=t.properties()[s.value],m=h.value;return typeof g==typeof m&&g>=m}],"filter-id->=":[Dr,[Qr],function(t,a){var s=a[0],h=t.id(),g=s.value;return typeof h==typeof g&&h>=g}],"filter-has":[Dr,[Qr],function(t,a){return a[0].value in t.properties()}],"filter-has-id":[Dr,[],function(t){return t.id()!==null&&t.id()!==void 0}],"filter-type-in":[Dr,[Ti(Jr)],function(t,a){return a[0].value.indexOf(t.geometryType())>=0}],"filter-id-in":[Dr,[Ti(Qr)],function(t,a){return a[0].value.indexOf(t.id())>=0}],"filter-in-small":[Dr,[Jr,Ti(Qr)],function(t,a){var s=a[0];return a[1].value.indexOf(t.properties()[s.value])>=0}],"filter-in-large":[Dr,[Jr,Ti(Qr)],function(t,a){var s=a[0],h=a[1];return function(g,m,S,M){for(;S<=M;){var k=S+M>>1;if(m[k]===g)return!0;m[k]>g?M=k-1:S=k+1}return!1}(t.properties()[s.value],h.value,0,h.value.length-1)}],all:{type:Dr,overloads:[[[Dr,Dr],function(t,a){var s=a[1];return a[0].evaluate(t)&&s.evaluate(t)}],[$o(Dr),function(t,a){for(var s=0,h=a;s<h.length;s+=1)if(!h[s].evaluate(t))return!1;return!0}]]},any:{type:Dr,overloads:[[[Dr,Dr],function(t,a){var s=a[1];return a[0].evaluate(t)||s.evaluate(t)}],[$o(Dr),function(t,a){for(var s=0,h=a;s<h.length;s+=1)if(h[s].evaluate(t))return!0;return!1}]]},"!":[Dr,[Dr],function(t,a){return!a[0].evaluate(t)}],"is-supported-script":[Dr,[Jr],function(t,a){var s=t.globals&&t.globals.isSupportedScript;return!s||s(a[0].evaluate(t))}],upcase:[Jr,[Jr],function(t,a){return a[0].evaluate(t).toUpperCase()}],downcase:[Jr,[Jr],function(t,a){return a[0].evaluate(t).toLowerCase()}],concat:[Jr,$o(Qr),function(t,a){return a.map(function(s){return hu(s.evaluate(t))}).join("")}],"resolved-locale":[Jr,[An],function(t,a){return a[0].evaluate(t).resolvedLocale()}]});var kc=function(t,a){this.expression=t,this._warningHistory={},this._evaluator=new sa,this._defaultValue=a?function(s){return s.type==="color"&&Ml(s.default)?new Bi(0,0,0,0):s.type==="color"?Bi.parse(s.default)||null:s.default===void 0?null:s.default}(a):null,this._enumValues=a&&a.type==="enum"?a.values:null};function ic(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in wu}function ac(t,a){var s=new ks(wu,[],a?function(g){var m={color:Gr,string:Jr,number:Tt,enum:Jr,boolean:Dr,formatted:Wi,resolvedImage:di};return g.type==="array"?Ti(m[g.value]||Qr,g.length):m[g.type]}(a):void 0),h=s.parse(t,void 0,void 0,void 0,a&&a.type==="string"?{typeAnnotation:"coerce"}:void 0);return h?Rc(new kc(h,a)):Cu(s.errors)}kc.prototype.evaluateWithoutErrorHandling=function(t,a,s,h,g,m){return this._evaluator.globals=t,this._evaluator.feature=a,this._evaluator.featureState=s,this._evaluator.canonical=h,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=m,this.expression.evaluate(this._evaluator)},kc.prototype.evaluate=function(t,a,s,h,g,m){this._evaluator.globals=t,this._evaluator.feature=a||null,this._evaluator.featureState=s||null,this._evaluator.canonical=h,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=m||null;try{var S=this.expression.evaluate(this._evaluator);if(S==null||typeof S=="number"&&S!=S)return this._defaultValue;if(this._enumValues&&!(S in this._enumValues))throw new Ma("Expected value to be one of "+Object.keys(this._enumValues).map(function(M){return JSON.stringify(M)}).join(", ")+", but found "+JSON.stringify(S)+" instead.");return S}catch(M){return this._warningHistory[M.message]||(this._warningHistory[M.message]=!0,typeof console!="undefined"&&console.warn(M.message)),this._defaultValue}};var Pl=function(t,a){this.kind=t,this._styleExpression=a,this.isStateDependent=t!=="constant"&&!So(a.expression)};Pl.prototype.evaluateWithoutErrorHandling=function(t,a,s,h,g,m){return this._styleExpression.evaluateWithoutErrorHandling(t,a,s,h,g,m)},Pl.prototype.evaluate=function(t,a,s,h,g,m){return this._styleExpression.evaluate(t,a,s,h,g,m)};var fl=function(t,a,s,h){this.kind=t,this.zoomStops=s,this._styleExpression=a,this.isStateDependent=t!=="camera"&&!So(a.expression),this.interpolationType=h};function Il(t,a){if((t=ac(t,a)).result==="error")return t;var s=t.value.expression,h=ao(s);if(!h&&!Qs(a))return Cu([new pr("","data expressions not supported")]);var g=vs(s,["zoom"]);if(!g&&!ef(a))return Cu([new pr("","zoom expressions not supported")]);var m=function S(M){var k=null;if(M instanceof dt)k=S(M.result);else if(M instanceof ht)for(var z=0,V=M.args;z<V.length&&!(k=S(V[z]));z+=1);else(M instanceof ms||M instanceof _e)&&M.input instanceof Xa&&M.input.name==="zoom"&&(k=M);return k instanceof pr||M.eachChild(function(H){var te=S(H);te instanceof pr?k=te:!k&&te?k=new pr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):k&&te&&k!==te&&(k=new pr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),k}(s);return m||g?m instanceof pr?Cu([m]):m instanceof _e&&!Al(a)?Cu([new pr("",'"interpolate" expressions cannot be used with this property')]):Rc(m?new fl(h?"camera":"composite",t.value,m.labels,m instanceof _e?m.interpolation:void 0):new Pl(h?"constant":"source",t.value)):Cu([new pr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}fl.prototype.evaluateWithoutErrorHandling=function(t,a,s,h,g,m){return this._styleExpression.evaluateWithoutErrorHandling(t,a,s,h,g,m)},fl.prototype.evaluate=function(t,a,s,h,g,m){return this._styleExpression.evaluate(t,a,s,h,g,m)},fl.prototype.interpolationFactor=function(t,a,s){return this.interpolationType?_e.interpolationFactor(this.interpolationType,t,a,s):0};var Wu=function(t,a){this._parameters=t,this._specification=a,hr(this,function s(h,g){var m,S,M,k=g.type==="color",z=h.stops&&typeof h.stops[0][0]=="object",V=z||!(z||h.property!==void 0),H=h.type||(Al(g)?"exponential":"interval");if(k&&((h=hr({},h)).stops&&(h.stops=h.stops.map(function(an){return[an[0],Bi.parse(an[1])]})),h.default=Bi.parse(h.default?h.default:g.default)),h.colorSpace&&h.colorSpace!=="rgb"&&!$[h.colorSpace])throw new Error("Unknown color space: "+h.colorSpace);if(H==="exponential")m=yh;else if(H==="interval")m=Uf;else if(H==="categorical"){m=Lc,S=Object.create(null);for(var te=0,se=h.stops;te<se.length;te+=1){var Me=se[te];S[Me[0]]=Me[1]}M=typeof h.stops[0][0]}else{if(H!=="identity")throw new Error('Unknown function type "'+H+'"');m=Zf}if(z){for(var Ie={},qe=[],ze=0;ze<h.stops.length;ze++){var at=h.stops[ze],bt=at[0].zoom;Ie[bt]===void 0&&(Ie[bt]={zoom:bt,type:h.type,property:h.property,default:h.default,stops:[]},qe.push(bt)),Ie[bt].stops.push([at[0].value,at[1]])}for(var Ut=[],Ht=0,or=qe;Ht<or.length;Ht+=1){var Ar=or[Ht];Ut.push([Ie[Ar].zoom,s(Ie[Ar],g)])}var Vr={name:"linear"};return{kind:"composite",interpolationType:Vr,interpolationFactor:_e.interpolationFactor.bind(void 0,Vr),zoomStops:Ut.map(function(an){return an[0]}),evaluate:function(an,zn){var ln=an.zoom;return yh({stops:Ut,base:h.base},g,ln).evaluate(ln,zn)}}}if(V){var kn=H==="exponential"?{name:"exponential",base:h.base!==void 0?h.base:1}:null;return{kind:"camera",interpolationType:kn,interpolationFactor:_e.interpolationFactor.bind(void 0,kn),zoomStops:h.stops.map(function(an){return an[0]}),evaluate:function(an){return m(h,g,an.zoom,S,M)}}}return{kind:"source",evaluate:function(an,zn){var ln=zn&&zn.properties?zn.properties[h.property]:void 0;return ln===void 0?cl(h.default,g.default):m(h,g,ln,S,M)}}}(this._parameters,this._specification))};function js(t){var a=t.key,s=t.value,h=t.valueSpec||{},g=t.objectElementValidators||{},m=t.style,S=t.styleSpec,M=[],k=Di(s);if(k!=="object")return[new Re(a,s,"object expected, "+k+" found")];for(var z in s){var V=z.split(".")[0],H=h[V]||h["*"],te=void 0;if(g[V])te=g[V];else if(h[V])te=Yi;else if(g["*"])te=g["*"];else{if(!h["*"]){M.push(new Re(a,s[z],'unknown property "'+z+'"'));continue}te=Yi}M=M.concat(te({key:(a&&a+".")+z,value:s[z],valueSpec:H,style:m,styleSpec:S,object:s,objectKey:z},s))}for(var se in h)g[se]||h[se].required&&h[se].default===void 0&&s[se]===void 0&&M.push(new Re(a,s,'missing required property "'+se+'"'));return M}function tf(t){var a=t.value,s=t.valueSpec,h=t.style,g=t.styleSpec,m=t.key,S=t.arrayElementValidator||Yi;if(Di(a)!=="array")return[new Re(m,a,"array expected, "+Di(a)+" found")];if(s.length&&a.length!==s.length)return[new Re(m,a,"array length "+s.length+" expected, length "+a.length+" found")];if(s["min-length"]&&a.length<s["min-length"])return[new Re(m,a,"array length at least "+s["min-length"]+" expected, length "+a.length+" found")];var M={type:s.value,values:s.values};g.$version<7&&(M.function=s.function),Di(s.value)==="object"&&(M=s.value);for(var k=[],z=0;z<a.length;z++)k=k.concat(S({array:a,arrayIndex:z,value:a[z],valueSpec:M,style:h,styleSpec:g,key:m+"["+z+"]"}));return k}function rf(t){var a=t.key,s=t.value,h=t.valueSpec,g=Di(s);return g==="number"&&s!=s&&(g="NaN"),g!=="number"?[new Re(a,s,"number expected, "+g+" found")]:"minimum"in h&&s<h.minimum?[new Re(a,s,s+" is less than the minimum value "+h.minimum)]:"maximum"in h&&s>h.maximum?[new Re(a,s,s+" is greater than the maximum value "+h.maximum)]:[]}function Vf(t){var a,s,h,g=t.valueSpec,m=Ot(t.value.type),S={},M=m!=="categorical"&&t.value.property===void 0,k=!M,z=Di(t.value.stops)==="array"&&Di(t.value.stops[0])==="array"&&Di(t.value.stops[0][0])==="object",V=js({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(se){if(m==="identity")return[new Re(se.key,se.value,'identity function may not have a "stops" property')];var Me=[],Ie=se.value;return Me=Me.concat(tf({key:se.key,value:Ie,valueSpec:se.valueSpec,style:se.style,styleSpec:se.styleSpec,arrayElementValidator:H})),Di(Ie)==="array"&&Ie.length===0&&Me.push(new Re(se.key,Ie,"array must have at least one stop")),Me},default:function(se){return Yi({key:se.key,value:se.value,valueSpec:g,style:se.style,styleSpec:se.styleSpec})}}});return m==="identity"&&M&&V.push(new Re(t.key,t.value,'missing required property "property"')),m==="identity"||t.value.stops||V.push(new Re(t.key,t.value,'missing required property "stops"')),m==="exponential"&&t.valueSpec.expression&&!Al(t.valueSpec)&&V.push(new Re(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(k&&!Qs(t.valueSpec)?V.push(new Re(t.key,t.value,"property functions not supported")):M&&!ef(t.valueSpec)&&V.push(new Re(t.key,t.value,"zoom functions not supported"))),m!=="categorical"&&!z||t.value.property!==void 0||V.push(new Re(t.key,t.value,'"property" property is required')),V;function H(se){var Me=[],Ie=se.value,qe=se.key;if(Di(Ie)!=="array")return[new Re(qe,Ie,"array expected, "+Di(Ie)+" found")];if(Ie.length!==2)return[new Re(qe,Ie,"array length 2 expected, length "+Ie.length+" found")];if(z){if(Di(Ie[0])!=="object")return[new Re(qe,Ie,"object expected, "+Di(Ie[0])+" found")];if(Ie[0].zoom===void 0)return[new Re(qe,Ie,"object stop key must have zoom")];if(Ie[0].value===void 0)return[new Re(qe,Ie,"object stop key must have value")];if(h&&h>Ot(Ie[0].zoom))return[new Re(qe,Ie[0].zoom,"stop zoom values must appear in ascending order")];Ot(Ie[0].zoom)!==h&&(h=Ot(Ie[0].zoom),s=void 0,S={}),Me=Me.concat(js({key:qe+"[0]",value:Ie[0],valueSpec:{zoom:{}},style:se.style,styleSpec:se.styleSpec,objectElementValidators:{zoom:rf,value:te}}))}else Me=Me.concat(te({key:qe+"[0]",value:Ie[0],valueSpec:{},style:se.style,styleSpec:se.styleSpec},Ie));return ic(Ft(Ie[1]))?Me.concat([new Re(qe+"[1]",Ie[1],"expressions are not allowed in function stops.")]):Me.concat(Yi({key:qe+"[1]",value:Ie[1],valueSpec:g,style:se.style,styleSpec:se.styleSpec}))}function te(se,Me){var Ie=Di(se.value),qe=Ot(se.value),ze=se.value!==null?se.value:Me;if(a){if(Ie!==a)return[new Re(se.key,ze,Ie+" stop domain type must match previous stop domain type "+a)]}else a=Ie;if(Ie!=="number"&&Ie!=="string"&&Ie!=="boolean")return[new Re(se.key,ze,"stop domain value must be a number, string, or boolean")];if(Ie!=="number"&&m!=="categorical"){var at="number expected, "+Ie+" found";return Qs(g)&&m===void 0&&(at+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Re(se.key,ze,at)]}return m!=="categorical"||Ie!=="number"||isFinite(qe)&&Math.floor(qe)===qe?m!=="categorical"&&Ie==="number"&&s!==void 0&&qe<s?[new Re(se.key,ze,"stop domain values must appear in ascending order")]:(s=qe,m==="categorical"&&qe in S?[new Re(se.key,ze,"stop domain values must be unique")]:(S[qe]=!0,[])):[new Re(se.key,ze,"integer expected, found "+qe)]}}function eu(t){var a=(t.expressionContext==="property"?Il:ac)(Ft(t.value),t.valueSpec);if(a.result==="error")return a.value.map(function(h){return new Re(""+t.key+h.key,t.value,h.message)});var s=a.value.expression||a.value._styleExpression.expression;if(t.expressionContext==="property"&&t.propertyKey==="text-font"&&!s.outputDefined())return[new Re(t.key,t.value,'Invalid data expression for "'+t.propertyKey+'". Output values must be contained as literals within the expression.')];if(t.expressionContext==="property"&&t.propertyType==="layout"&&!So(s))return[new Re(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if(t.expressionContext==="filter"&&!So(s))return[new Re(t.key,t.value,'"feature-state" data expressions are not supported with filters.')];if(t.expressionContext&&t.expressionContext.indexOf("cluster")===0){if(!vs(s,["zoom","feature-state"]))return[new Re(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(t.expressionContext==="cluster-initial"&&!ao(s))return[new Re(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function oc(t){var a=t.key,s=t.value,h=t.valueSpec,g=[];return Array.isArray(h.values)?h.values.indexOf(Ot(s))===-1&&g.push(new Re(a,s,"expected one of ["+h.values.join(", ")+"], "+JSON.stringify(s)+" found")):Object.keys(h.values).indexOf(Ot(s))===-1&&g.push(new Re(a,s,"expected one of ["+Object.keys(h.values).join(", ")+"], "+JSON.stringify(s)+" found")),g}function Dc(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(var a=0,s=t.slice(1);a<s.length;a+=1){var h=s[a];if(!Dc(h)&&typeof h!="boolean")return!1}return!0;default:return!0}}Wu.deserialize=function(t){return new Wu(t._parameters,t._specification)},Wu.serialize=function(t){return{_parameters:t._parameters,_specification:t._specification}};var nf={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Ol(t){if(t==null)return{filter:function(){return!0},needGeometry:!1};Dc(t)||(t=af(t));var a=ac(t,nf);if(a.result==="error")throw new Error(a.value.map(function(s){return s.key+": "+s.message}).join(", "));return{filter:function(s,h,g){return a.value.evaluate(s,h,{},g)},needGeometry:function s(h){if(!Array.isArray(h))return!1;if(h[0]==="within")return!0;for(var g=1;g<h.length;g++)if(s(h[g]))return!0;return!1}(t)}}function Jh(t,a){return t<a?-1:t>a?1:0}function af(t){if(!t)return!0;var a,s=t[0];return t.length<=1?s!=="any":s==="=="?Rl(t[1],t[2],"=="):s==="!="?Ll(Rl(t[1],t[2],"==")):s==="<"||s===">"||s==="<="||s===">="?Rl(t[1],t[2],s):s==="any"?(a=t.slice(1),["any"].concat(a.map(af))):s==="all"?["all"].concat(t.slice(1).map(af)):s==="none"?["all"].concat(t.slice(1).map(af).map(Ll)):s==="in"?of(t[1],t.slice(2)):s==="!in"?Ll(of(t[1],t.slice(2))):s==="has"?sf(t[1]):s==="!has"?Ll(sf(t[1])):s!=="within"||t}function Rl(t,a,s){switch(t){case"$type":return["filter-type-"+s,a];case"$id":return["filter-id-"+s,a];default:return["filter-"+s,t,a]}}function of(t,a){if(a.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",a]];case"$id":return["filter-id-in",["literal",a]];default:return a.length>200&&!a.some(function(s){return typeof s!=typeof a[0]})?["filter-in-large",t,["literal",a.sort(Jh)]]:["filter-in-small",t,["literal",a]]}}function sf(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function Ll(t){return["!",t]}function Fc(t){return Dc(Ft(t.value))?eu(hr({},t,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function a(s){var h=s.value,g=s.key;if(Di(h)!=="array")return[new Re(g,h,"array expected, "+Di(h)+" found")];var m,S=s.styleSpec,M=[];if(h.length<1)return[new Re(g,h,"filter array must have at least 1 element")];switch(M=M.concat(oc({key:g+"[0]",value:h[0],valueSpec:S.filter_operator,style:s.style,styleSpec:s.styleSpec})),Ot(h[0])){case"<":case"<=":case">":case">=":h.length>=2&&Ot(h[1])==="$type"&&M.push(new Re(g,h,'"$type" cannot be use with operator "'+h[0]+'"'));case"==":case"!=":h.length!==3&&M.push(new Re(g,h,'filter array for operator "'+h[0]+'" must have 3 elements'));case"in":case"!in":h.length>=2&&(m=Di(h[1]))!=="string"&&M.push(new Re(g+"[1]",h[1],"string expected, "+m+" found"));for(var k=2;k<h.length;k++)m=Di(h[k]),Ot(h[1])==="$type"?M=M.concat(oc({key:g+"["+k+"]",value:h[k],valueSpec:S.geometry_type,style:s.style,styleSpec:s.styleSpec})):m!=="string"&&m!=="number"&&m!=="boolean"&&M.push(new Re(g+"["+k+"]",h[k],"string, number, or boolean expected, "+m+" found"));break;case"any":case"all":case"none":for(var z=1;z<h.length;z++)M=M.concat(a({key:g+"["+z+"]",value:h[z],style:s.style,styleSpec:s.styleSpec}));break;case"has":case"!has":m=Di(h[1]),h.length!==2?M.push(new Re(g,h,'filter array for "'+h[0]+'" operator must have 2 elements')):m!=="string"&&M.push(new Re(g+"[1]",h[1],"string expected, "+m+" found"));break;case"within":m=Di(h[1]),h.length!==2?M.push(new Re(g,h,'filter array for "'+h[0]+'" operator must have 2 elements')):m!=="object"&&M.push(new Re(g+"[1]",h[1],"object expected, "+m+" found"))}return M}(t)}function _h(t,a){var s=t.key,h=t.style,g=t.styleSpec,m=t.value,S=t.objectKey,M=g[a+"_"+t.layerType];if(!M)return[];var k=S.match(/^(.*)-transition$/);if(a==="paint"&&k&&M[k[1]]&&M[k[1]].transition)return Yi({key:s,value:m,valueSpec:g.transition,style:h,styleSpec:g});var z,V=t.valueSpec||M[S];if(!V)return[new Re(s,m,'unknown property "'+S+'"')];if(Di(m)==="string"&&Qs(V)&&!V.tokens&&(z=/^{([^}]+)}$/.exec(m)))return[new Re(s,m,'"'+S+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(z[1])+" }`.")];var H=[];return t.layerType==="symbol"&&(S==="text-field"&&h&&!h.glyphs&&H.push(new Re(s,m,'use of "text-field" requires a style "glyphs" property')),S==="text-font"&&Ml(Ft(m))&&Ot(m.type)==="identity"&&H.push(new Re(s,m,'"text-font" does not support identity functions'))),H.concat(Yi({key:t.key,value:m,valueSpec:V,style:h,styleSpec:g,expressionContext:"property",propertyType:a,propertyKey:S}))}function xh(t){return _h(t,"paint")}function sc(t){return _h(t,"layout")}function bh(t){var a=[],s=t.value,h=t.key,g=t.style,m=t.styleSpec;s.type||s.ref||a.push(new Re(h,s,'either "type" or "ref" is required'));var S,M=Ot(s.type),k=Ot(s.ref);if(s.id)for(var z=Ot(s.id),V=0;V<t.arrayIndex;V++){var H=g.layers[V];Ot(H.id)===z&&a.push(new Re(h,s.id,'duplicate layer id "'+s.id+'", previously used at line '+H.id.__line__))}if("ref"in s)["type","source","source-layer","filter","layout"].forEach(function(Me){Me in s&&a.push(new Re(h,s[Me],'"'+Me+'" is prohibited for ref layers'))}),g.layers.forEach(function(Me){Ot(Me.id)===k&&(S=Me)}),S?S.ref?a.push(new Re(h,s.ref,"ref cannot reference another ref layer")):M=Ot(S.type):a.push(new Re(h,s.ref,'ref layer "'+k+'" not found'));else if(M!=="background")if(s.source){var te=g.sources&&g.sources[s.source],se=te&&Ot(te.type);te?se==="vector"&&M==="raster"?a.push(new Re(h,s.source,'layer "'+s.id+'" requires a raster source')):se==="raster"&&M!=="raster"?a.push(new Re(h,s.source,'layer "'+s.id+'" requires a vector source')):se!=="vector"||s["source-layer"]?se==="raster-dem"&&M!=="hillshade"?a.push(new Re(h,s.source,"raster-dem source can only be used with layer type 'hillshade'.")):M!=="line"||!s.paint||!s.paint["line-gradient"]||se==="geojson"&&te.lineMetrics||a.push(new Re(h,s,'layer "'+s.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):a.push(new Re(h,s,'layer "'+s.id+'" must specify a "source-layer"')):a.push(new Re(h,s.source,'source "'+s.source+'" not found'))}else a.push(new Re(h,s,'missing required property "source"'));return a=a.concat(js({key:h,value:s,valueSpec:m.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return Yi({key:h+".type",value:s.type,valueSpec:m.layer.type,style:t.style,styleSpec:t.styleSpec,object:s,objectKey:"type"})},filter:Fc,layout:function(Me){return js({layer:s,key:Me.key,value:Me.value,style:Me.style,styleSpec:Me.styleSpec,objectElementValidators:{"*":function(Ie){return sc(hr({layerType:M},Ie))}}})},paint:function(Me){return js({layer:s,key:Me.key,value:Me.value,style:Me.style,styleSpec:Me.styleSpec,objectElementValidators:{"*":function(Ie){return xh(hr({layerType:M},Ie))}}})}}}))}function kl(t){var a=t.value,s=t.key,h=Di(a);return h!=="string"?[new Re(s,a,"string expected, "+h+" found")]:[]}var $i={promoteId:function(t){var a=t.key,s=t.value;if(Di(s)==="string")return kl({key:a,value:s});var h=[];for(var g in s)h.push.apply(h,kl({key:a+"."+g,value:s[g]}));return h}};function uc(t){var a=t.value,s=t.key,h=t.styleSpec,g=t.style;if(!a.type)return[new Re(s,a,'"type" is required')];var m,S=Ot(a.type);switch(S){case"vector":case"raster":case"raster-dem":return js({key:s,value:a,valueSpec:h["source_"+S.replace("-","_")],style:t.style,styleSpec:h,objectElementValidators:$i});case"geojson":if(m=js({key:s,value:a,valueSpec:h.source_geojson,style:g,styleSpec:h,objectElementValidators:$i}),a.cluster)for(var M in a.clusterProperties){var k=a.clusterProperties[M],z=k[0],V=typeof z=="string"?[z,["accumulated"],["get",M]]:z;m.push.apply(m,eu({key:s+"."+M+".map",value:k[1],expressionContext:"cluster-map"})),m.push.apply(m,eu({key:s+"."+M+".reduce",value:V,expressionContext:"cluster-reduce"}))}return m;case"video":return js({key:s,value:a,valueSpec:h.source_video,style:g,styleSpec:h});case"image":return js({key:s,value:a,valueSpec:h.source_image,style:g,styleSpec:h});case"canvas":return[new Re(s,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return oc({key:s+".type",value:a.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:g,styleSpec:h})}}function fa(t){var a=t.value,s=t.styleSpec,h=s.light,g=t.style,m=[],S=Di(a);if(a===void 0)return m;if(S!=="object")return m.concat([new Re("light",a,"object expected, "+S+" found")]);for(var M in a){var k=M.match(/^(.*)-transition$/);m=m.concat(k&&h[k[1]]&&h[k[1]].transition?Yi({key:M,value:a[M],valueSpec:s.transition,style:g,styleSpec:s}):h[M]?Yi({key:M,value:a[M],valueSpec:h[M],style:g,styleSpec:s}):[new Re(M,a[M],'unknown property "'+M+'"')])}return m}var Tu={"*":function(){return[]},array:tf,boolean:function(t){var a=t.value,s=t.key,h=Di(a);return h!=="boolean"?[new Re(s,a,"boolean expected, "+h+" found")]:[]},number:rf,color:function(t){var a=t.key,s=t.value,h=Di(s);return h!=="string"?[new Re(a,s,"color expected, "+h+" found")]:Ai(s)===null?[new Re(a,s,'color expected, "'+s+'" found')]:[]},constants:mt,enum:oc,filter:Fc,function:Vf,layer:bh,object:js,source:uc,light:fa,string:kl,formatted:function(t){return kl(t).length===0?[]:eu(t)},resolvedImage:function(t){return kl(t).length===0?[]:eu(t)}};function Yi(t){var a=t.value,s=t.valueSpec,h=t.styleSpec;return s.expression&&Ml(Ot(a))?Vf(t):s.expression&&ic(Ft(a))?eu(t):s.type&&Tu[s.type]?Tu[s.type](t):js(hr({},t,{valueSpec:s.type?h[s.type]:s}))}function Pa(t){var a=t.value,s=t.key,h=kl(t);return h.length||(a.indexOf("{fontstack}")===-1&&h.push(new Re(s,a,'"glyphs" url must include a "{fontstack}" token')),a.indexOf("{range}")===-1&&h.push(new Re(s,a,'"glyphs" url must include a "{range}" token'))),h}function ys(t,a){a===void 0&&(a=ce);var s=[];return s=s.concat(Yi({key:"",value:t,valueSpec:a.$root,styleSpec:a,style:t,objectElementValidators:{glyphs:Pa,"*":function(){return[]}}})),t.constants&&(s=s.concat(mt({key:"constants",value:t.constants,style:t,styleSpec:a}))),Nc(s)}function Nc(t){return[].concat(t).sort(function(a,s){return a.line-s.line})}function Xu(t){return function(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];return Nc(t.apply(this,a))}}ys.source=Xu(uc),ys.light=Xu(fa),ys.layer=Xu(bh),ys.filter=Xu(Fc),ys.paintProperty=Xu(xh),ys.layoutProperty=Xu(sc);var za=ys,lc=za.light,Dl=za.paintProperty,Yu=za.layoutProperty;function Bc(t,a){var s=!1;if(a&&a.length)for(var h=0,g=a;h<g.length;h+=1)t.fire(new Ge(new Error(g[h].message))),s=!0;return s}var Au=fo;function fo(t,a,s){var h=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var g=new Int32Array(this.arrayBuffer);t=g[0],this.d=(a=g[1])+2*(s=g[2]);for(var m=0;m<this.d*this.d;m++){var S=g[3+m],M=g[3+m+1];h.push(S===M?null:g.subarray(S,M))}var k=g[3+h.length+1];this.keys=g.subarray(g[3+h.length],k),this.bboxes=g.subarray(k),this.insert=this._insertReadonly}else{this.d=a+2*s;for(var z=0;z<this.d*this.d;z++)h.push([]);this.keys=[],this.bboxes=[]}this.n=a,this.extent=t,this.padding=s,this.scale=a/t,this.uid=0;var V=s/a*t;this.min=-V,this.max=t+V}fo.prototype.insert=function(t,a,s,h,g){this._forEachCell(a,s,h,g,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(a),this.bboxes.push(s),this.bboxes.push(h),this.bboxes.push(g)},fo.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},fo.prototype._insertCell=function(t,a,s,h,g,m){this.cells[g].push(m)},fo.prototype.query=function(t,a,s,h,g){var m=this.min,S=this.max;if(t<=m&&a<=m&&S<=s&&S<=h&&!g)return Array.prototype.slice.call(this.keys);var M=[];return this._forEachCell(t,a,s,h,this._queryCell,M,{},g),M},fo.prototype._queryCell=function(t,a,s,h,g,m,S,M){var k=this.cells[g];if(k!==null)for(var z=this.keys,V=this.bboxes,H=0;H<k.length;H++){var te=k[H];if(S[te]===void 0){var se=4*te;(M?M(V[se+0],V[se+1],V[se+2],V[se+3]):t<=V[se+2]&&a<=V[se+3]&&s>=V[se+0]&&h>=V[se+1])?(S[te]=!0,m.push(z[te])):S[te]=!1}}},fo.prototype._forEachCell=function(t,a,s,h,g,m,S,M){for(var k=this._convertToCellCoord(t),z=this._convertToCellCoord(a),V=this._convertToCellCoord(s),H=this._convertToCellCoord(h),te=k;te<=V;te++)for(var se=z;se<=H;se++){var Me=this.d*se+te;if((!M||M(this._convertFromCellCoord(te),this._convertFromCellCoord(se),this._convertFromCellCoord(te+1),this._convertFromCellCoord(se+1)))&&g.call(this,t,a,s,h,Me,m,S,M))return}},fo.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},fo.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},fo.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,a=3+this.cells.length+1+1,s=0,h=0;h<this.cells.length;h++)s+=this.cells[h].length;var g=new Int32Array(a+s+this.keys.length+this.bboxes.length);g[0]=this.extent,g[1]=this.n,g[2]=this.padding;for(var m=a,S=0;S<t.length;S++){var M=t[S];g[3+S]=m,g.set(M,m),m+=M.length}return g[3+t.length]=m,g.set(this.keys,m),g[3+t.length+1]=m+=this.keys.length,g.set(this.bboxes,m),m+=this.bboxes.length,g.buffer};var Fl=K.ImageData,cc=K.ImageBitmap,ho={};function pn(t,a,s){s===void 0&&(s={}),Object.defineProperty(a,"_classRegistryKey",{value:t,writeable:!1}),ho[t]={klass:a,omit:s.omit||[],shallow:s.shallow||[]}}for(var so in pn("Object",Object),Au.serialize=function(t,a){var s=t.toArrayBuffer();return a&&a.push(s),{buffer:s}},Au.deserialize=function(t){return new Au(t.buffer)},pn("Grid",Au),pn("Color",Bi),pn("Error",Error),pn("ResolvedImage",aa),pn("StylePropertyFunction",Wu),pn("StyleExpression",kc,{omit:["_evaluator"]}),pn("ZoomDependentExpression",fl),pn("ZoomConstantExpression",Pl),pn("CompoundExpression",Xa,{omit:["_evaluate"]}),wu)wu[so]._classRegistryKey||pn("Expression_"+so,wu[so]);function qu(t){return t&&typeof ArrayBuffer!="undefined"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function ka(t){return cc&&t instanceof cc}function Gs(t,a){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(qu(t)||ka(t))return a&&a.push(t),t;if(ArrayBuffer.isView(t)){var s=t;return a&&a.push(s.buffer),s}if(t instanceof Fl)return a&&a.push(t.data.buffer),t;if(Array.isArray(t)){for(var h=[],g=0,m=t;g<m.length;g+=1)h.push(Gs(m[g],a));return h}if(typeof t=="object"){var S=t.constructor,M=S._classRegistryKey;if(!M)throw new Error("can't serialize object of unregistered class");var k=S.serialize?S.serialize(t,a):{};if(!S.serialize){for(var z in t)if(t.hasOwnProperty(z)&&!(ho[M].omit.indexOf(z)>=0)){var V=t[z];k[z]=ho[M].shallow.indexOf(z)>=0?V:Gs(V,a)}t instanceof Error&&(k.message=t.message)}if(k.$name)throw new Error("$name property is reserved for worker serialization logic.");return M!=="Object"&&(k.$name=M),k}throw new Error("can't serialize object of type "+typeof t)}function Os(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||qu(t)||ka(t)||ArrayBuffer.isView(t)||t instanceof Fl)return t;if(Array.isArray(t))return t.map(Os);if(typeof t=="object"){var a=t.$name||"Object",s=ho[a].klass;if(!s)throw new Error("can't deserialize unregistered class "+a);if(s.deserialize)return s.deserialize(t);for(var h=Object.create(s.prototype),g=0,m=Object.keys(t);g<m.length;g+=1){var S=m[g];if(S!=="$name"){var M=t[S];h[S]=ho[a].shallow.indexOf(S)>=0?M:Os(M)}}return h}throw new Error("can't deserialize object of type "+typeof t)}var uf=function(){this.first=!0};uf.prototype.update=function(t,a){var s=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=s,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=s,!0):(this.lastFloorZoom>s?(this.lastIntegerZoom=s+1,this.lastIntegerZoomTime=a):this.lastFloorZoom<s&&(this.lastIntegerZoom=s,this.lastIntegerZoomTime=a),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=s,!0))};var zr={"Latin-1 Supplement":function(t){return t>=128&&t<=255},Arabic:function(t){return t>=1536&&t<=1791},"Arabic Supplement":function(t){return t>=1872&&t<=1919},"Arabic Extended-A":function(t){return t>=2208&&t<=2303},"Hangul Jamo":function(t){return t>=4352&&t<=4607},"Unified Canadian Aboriginal Syllabics":function(t){return t>=5120&&t<=5759},Khmer:function(t){return t>=6016&&t<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(t){return t>=6320&&t<=6399},"General Punctuation":function(t){return t>=8192&&t<=8303},"Letterlike Symbols":function(t){return t>=8448&&t<=8527},"Number Forms":function(t){return t>=8528&&t<=8591},"Miscellaneous Technical":function(t){return t>=8960&&t<=9215},"Control Pictures":function(t){return t>=9216&&t<=9279},"Optical Character Recognition":function(t){return t>=9280&&t<=9311},"Enclosed Alphanumerics":function(t){return t>=9312&&t<=9471},"Geometric Shapes":function(t){return t>=9632&&t<=9727},"Miscellaneous Symbols":function(t){return t>=9728&&t<=9983},"Miscellaneous Symbols and Arrows":function(t){return t>=11008&&t<=11263},"CJK Radicals Supplement":function(t){return t>=11904&&t<=12031},"Kangxi Radicals":function(t){return t>=12032&&t<=12255},"Ideographic Description Characters":function(t){return t>=12272&&t<=12287},"CJK Symbols and Punctuation":function(t){return t>=12288&&t<=12351},Hiragana:function(t){return t>=12352&&t<=12447},Katakana:function(t){return t>=12448&&t<=12543},Bopomofo:function(t){return t>=12544&&t<=12591},"Hangul Compatibility Jamo":function(t){return t>=12592&&t<=12687},Kanbun:function(t){return t>=12688&&t<=12703},"Bopomofo Extended":function(t){return t>=12704&&t<=12735},"CJK Strokes":function(t){return t>=12736&&t<=12783},"Katakana Phonetic Extensions":function(t){return t>=12784&&t<=12799},"Enclosed CJK Letters and Months":function(t){return t>=12800&&t<=13055},"CJK Compatibility":function(t){return t>=13056&&t<=13311},"CJK Unified Ideographs Extension A":function(t){return t>=13312&&t<=19903},"Yijing Hexagram Symbols":function(t){return t>=19904&&t<=19967},"CJK Unified Ideographs":function(t){return t>=19968&&t<=40959},"Yi Syllables":function(t){return t>=40960&&t<=42127},"Yi Radicals":function(t){return t>=42128&&t<=42191},"Hangul Jamo Extended-A":function(t){return t>=43360&&t<=43391},"Hangul Syllables":function(t){return t>=44032&&t<=55215},"Hangul Jamo Extended-B":function(t){return t>=55216&&t<=55295},"Private Use Area":function(t){return t>=57344&&t<=63743},"CJK Compatibility Ideographs":function(t){return t>=63744&&t<=64255},"Arabic Presentation Forms-A":function(t){return t>=64336&&t<=65023},"Vertical Forms":function(t){return t>=65040&&t<=65055},"CJK Compatibility Forms":function(t){return t>=65072&&t<=65103},"Small Form Variants":function(t){return t>=65104&&t<=65135},"Arabic Presentation Forms-B":function(t){return t>=65136&&t<=65279},"Halfwidth and Fullwidth Forms":function(t){return t>=65280&&t<=65519}};function fc(t){for(var a=0,s=t;a<s.length;a+=1)if(lf(s[a].charCodeAt(0)))return!0;return!1}function lf(t){return!(t!==746&&t!==747&&(t<4352||!(zr["Bopomofo Extended"](t)||zr.Bopomofo(t)||zr["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||zr["CJK Compatibility Ideographs"](t)||zr["CJK Compatibility"](t)||zr["CJK Radicals Supplement"](t)||zr["CJK Strokes"](t)||!(!zr["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||zr["CJK Unified Ideographs Extension A"](t)||zr["CJK Unified Ideographs"](t)||zr["Enclosed CJK Letters and Months"](t)||zr["Hangul Compatibility Jamo"](t)||zr["Hangul Jamo Extended-A"](t)||zr["Hangul Jamo Extended-B"](t)||zr["Hangul Jamo"](t)||zr["Hangul Syllables"](t)||zr.Hiragana(t)||zr["Ideographic Description Characters"](t)||zr.Kanbun(t)||zr["Kangxi Radicals"](t)||zr["Katakana Phonetic Extensions"](t)||zr.Katakana(t)&&t!==12540||!(!zr["Halfwidth and Fullwidth Forms"](t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!zr["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||zr["Unified Canadian Aboriginal Syllabics"](t)||zr["Unified Canadian Aboriginal Syllabics Extended"](t)||zr["Vertical Forms"](t)||zr["Yijing Hexagram Symbols"](t)||zr["Yi Syllables"](t)||zr["Yi Radicals"](t))))}function hl(t){return!(lf(t)||function(a){return!!(zr["Latin-1 Supplement"](a)&&(a===167||a===169||a===174||a===177||a===188||a===189||a===190||a===215||a===247)||zr["General Punctuation"](a)&&(a===8214||a===8224||a===8225||a===8240||a===8241||a===8251||a===8252||a===8258||a===8263||a===8264||a===8265||a===8273)||zr["Letterlike Symbols"](a)||zr["Number Forms"](a)||zr["Miscellaneous Technical"](a)&&(a>=8960&&a<=8967||a>=8972&&a<=8991||a>=8996&&a<=9e3||a===9003||a>=9085&&a<=9114||a>=9150&&a<=9165||a===9167||a>=9169&&a<=9179||a>=9186&&a<=9215)||zr["Control Pictures"](a)&&a!==9251||zr["Optical Character Recognition"](a)||zr["Enclosed Alphanumerics"](a)||zr["Geometric Shapes"](a)||zr["Miscellaneous Symbols"](a)&&!(a>=9754&&a<=9759)||zr["Miscellaneous Symbols and Arrows"](a)&&(a>=11026&&a<=11055||a>=11088&&a<=11097||a>=11192&&a<=11243)||zr["CJK Symbols and Punctuation"](a)||zr.Katakana(a)||zr["Private Use Area"](a)||zr["CJK Compatibility Forms"](a)||zr["Small Form Variants"](a)||zr["Halfwidth and Fullwidth Forms"](a)||a===8734||a===8756||a===8757||a>=9984&&a<=10087||a>=10102&&a<=10131||a===65532||a===65533)}(t))}function Ca(t){return t>=1424&&t<=2303||zr["Arabic Presentation Forms-A"](t)||zr["Arabic Presentation Forms-B"](t)}function _s(t,a){return!(!a&&Ca(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||zr.Khmer(t))}function cf(t){for(var a=0,s=t;a<s.length;a+=1)if(Ca(s[a].charCodeAt(0)))return!0;return!1}var Mu=null,Ds="unavailable",Pu=null,jf=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&(Ds="error"),Mu&&Mu(t)};function pl(){Gf.fire(new Pe("pluginStateChange",{pluginStatus:Ds,pluginURL:Pu}))}var Gf=new tt,ff=function(){return Ds},tu=function(){if(Ds!=="deferred"||!Pu)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Ds="loading",pl(),Pu&&Fa({url:Pu},function(t){t?jf(t):(Ds="loaded",pl())})},Rs={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return Ds==="loaded"||Rs.applyArabicShaping!=null},isLoading:function(){return Ds==="loading"},setState:function(t){Ds=t.pluginStatus,Pu=t.pluginURL},isParsed:function(){return Rs.applyArabicShaping!=null&&Rs.processBidirectionalText!=null&&Rs.processStyledBidirectionalText!=null},getPluginURL:function(){return Pu}},Si=function(t,a){this.zoom=t,a?(this.now=a.now,this.fadeDuration=a.fadeDuration,this.zoomHistory=a.zoomHistory,this.transition=a.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new uf,this.transition={})};Si.prototype.isSupportedScript=function(t){return function(a,s){for(var h=0,g=a;h<g.length;h+=1)if(!_s(g[h].charCodeAt(0),s))return!1;return!0}(t,Rs.isLoaded())},Si.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},Si.prototype.getCrossfadeParameters=function(){var t=this.zoom,a=t-Math.floor(t),s=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:a+(1-a)*s}:{fromScale:.5,toScale:1,t:1-(1-s)*a}};var Iu=function(t,a){this.property=t,this.value=a,this.expression=function(s,h){if(Ml(s))return new Wu(s,h);if(ic(s)){var g=Il(s,h);if(g.result==="error")throw new Error(g.value.map(function(S){return S.key+": "+S.message}).join(", "));return g.value}var m=s;return typeof s=="string"&&h.type==="color"&&(m=Bi.parse(s)),{kind:"constant",evaluate:function(){return m}}}(a===void 0?t.specification.default:a,t.specification)};Iu.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},Iu.prototype.possiblyEvaluate=function(t,a,s){return this.property.possiblyEvaluate(this,t,a,s)};var ru=function(t){this.property=t,this.value=new Iu(t,void 0)};ru.prototype.transitioned=function(t,a){return new dl(this.property,this.value,a,pt({},t.transition,this.transition),t.now)},ru.prototype.untransitioned=function(){return new dl(this.property,this.value,null,{},0)};var Go=function(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)};Go.prototype.getValue=function(t){return Ye(this._values[t].value.value)},Go.prototype.setValue=function(t,a){this._values.hasOwnProperty(t)||(this._values[t]=new ru(this._values[t].property)),this._values[t].value=new Iu(this._values[t].property,a===null?void 0:Ye(a))},Go.prototype.getTransition=function(t){return Ye(this._values[t].transition)},Go.prototype.setTransition=function(t,a){this._values.hasOwnProperty(t)||(this._values[t]=new ru(this._values[t].property)),this._values[t].transition=Ye(a)||void 0},Go.prototype.serialize=function(){for(var t={},a=0,s=Object.keys(this._values);a<s.length;a+=1){var h=s[a],g=this.getValue(h);g!==void 0&&(t[h]=g);var m=this.getTransition(h);m!==void 0&&(t[h+"-transition"]=m)}return t},Go.prototype.transitioned=function(t,a){for(var s=new Fs(this._properties),h=0,g=Object.keys(this._values);h<g.length;h+=1){var m=g[h];s._values[m]=this._values[m].transitioned(t,a._values[m])}return s},Go.prototype.untransitioned=function(){for(var t=new Fs(this._properties),a=0,s=Object.keys(this._values);a<s.length;a+=1){var h=s[a];t._values[h]=this._values[h].untransitioned()}return t};var dl=function(t,a,s,h,g){this.property=t,this.value=a,this.begin=g+h.delay||0,this.end=this.begin+h.duration||0,t.specification.transition&&(h.delay||h.duration)&&(this.prior=s)};dl.prototype.possiblyEvaluate=function(t,a,s){var h=t.now||0,g=this.value.possiblyEvaluate(t,a,s),m=this.prior;if(m){if(h>this.end)return this.prior=null,g;if(this.value.isDataDriven())return this.prior=null,g;if(h<this.begin)return m.possiblyEvaluate(t,a,s);var S=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(m.possiblyEvaluate(t,a,s),g,function(M){if(M<=0)return 0;if(M>=1)return 1;var k=M*M,z=k*M;return 4*(M<.5?z:3*(M-k)+z-.75)}(S))}return g};var Fs=function(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)};Fs.prototype.possiblyEvaluate=function(t,a,s){for(var h=new pu(this._properties),g=0,m=Object.keys(this._values);g<m.length;g+=1){var S=m[g];h._values[S]=this._values[S].possiblyEvaluate(t,a,s)}return h},Fs.prototype.hasTransition=function(){for(var t=0,a=Object.keys(this._values);t<a.length;t+=1)if(this._values[a[t]].prior)return!0;return!1};var Hs=function(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)};Hs.prototype.getValue=function(t){return Ye(this._values[t].value)},Hs.prototype.setValue=function(t,a){this._values[t]=new Iu(this._values[t].property,a===null?void 0:Ye(a))},Hs.prototype.serialize=function(){for(var t={},a=0,s=Object.keys(this._values);a<s.length;a+=1){var h=s[a],g=this.getValue(h);g!==void 0&&(t[h]=g)}return t},Hs.prototype.possiblyEvaluate=function(t,a,s){for(var h=new pu(this._properties),g=0,m=Object.keys(this._values);g<m.length;g+=1){var S=m[g];h._values[S]=this._values[S].possiblyEvaluate(t,a,s)}return h};var xs=function(t,a,s){this.property=t,this.value=a,this.parameters=s};xs.prototype.isConstant=function(){return this.value.kind==="constant"},xs.prototype.constantOr=function(t){return this.value.kind==="constant"?this.value.value:t},xs.prototype.evaluate=function(t,a,s,h){return this.property.evaluate(this.value,this.parameters,t,a,s,h)};var pu=function(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)};pu.prototype.get=function(t){return this._values[t]};var Mn=function(t){this.specification=t};Mn.prototype.possiblyEvaluate=function(t,a){return t.expression.evaluate(a)},Mn.prototype.interpolate=function(t,a,s){var h=_a[this.specification.type];return h?h(t,a,s):t};var bn=function(t,a){this.specification=t,this.overrides=a};bn.prototype.possiblyEvaluate=function(t,a,s,h){return new xs(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(a,null,{},s,h)}:t.expression,a)},bn.prototype.interpolate=function(t,a,s){if(t.value.kind!=="constant"||a.value.kind!=="constant")return t;if(t.value.value===void 0||a.value.value===void 0)return new xs(this,{kind:"constant",value:void 0},t.parameters);var h=_a[this.specification.type];return h?new xs(this,{kind:"constant",value:h(t.value.value,a.value.value,s)},t.parameters):t},bn.prototype.evaluate=function(t,a,s,h,g,m){return t.kind==="constant"?t.value:t.evaluate(a,s,h,g,m)};var zc=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.possiblyEvaluate=function(s,h,g,m){if(s.value===void 0)return new xs(this,{kind:"constant",value:void 0},h);if(s.expression.kind==="constant"){var S=s.expression.evaluate(h,null,{},g,m),M=s.property.specification.type==="resolvedImage"&&typeof S!="string"?S.name:S,k=this._calculate(M,M,M,h);return new xs(this,{kind:"constant",value:k},h)}if(s.expression.kind==="camera"){var z=this._calculate(s.expression.evaluate({zoom:h.zoom-1}),s.expression.evaluate({zoom:h.zoom}),s.expression.evaluate({zoom:h.zoom+1}),h);return new xs(this,{kind:"constant",value:z},h)}return new xs(this,s.expression,h)},a.prototype.evaluate=function(s,h,g,m,S,M){if(s.kind==="source"){var k=s.evaluate(h,g,m,S,M);return this._calculate(k,k,k,h)}return s.kind==="composite"?this._calculate(s.evaluate({zoom:Math.floor(h.zoom)-1},g,m),s.evaluate({zoom:Math.floor(h.zoom)},g,m),s.evaluate({zoom:Math.floor(h.zoom)+1},g,m),h):s.value},a.prototype._calculate=function(s,h,g,m){return m.zoom>m.zoomHistory.lastIntegerZoom?{from:s,to:h}:{from:g,to:h}},a.prototype.interpolate=function(s){return s},a}(bn),is=function(t){this.specification=t};is.prototype.possiblyEvaluate=function(t,a,s,h){if(t.value!==void 0){if(t.expression.kind==="constant"){var g=t.expression.evaluate(a,null,{},s,h);return this._calculate(g,g,g,a)}return this._calculate(t.expression.evaluate(new Si(Math.floor(a.zoom-1),a)),t.expression.evaluate(new Si(Math.floor(a.zoom),a)),t.expression.evaluate(new Si(Math.floor(a.zoom+1),a)),a)}},is.prototype._calculate=function(t,a,s,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:t,to:a}:{from:s,to:a}},is.prototype.interpolate=function(t){return t};var as=function(t){this.specification=t};as.prototype.possiblyEvaluate=function(t,a,s,h){return!!t.expression.evaluate(a,null,{},s,h)},as.prototype.interpolate=function(){return!1};var Jo=function(t){for(var a in this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],t){var s=t[a];s.specification.overridable&&this.overridableProperties.push(a);var h=this.defaultPropertyValues[a]=new Iu(s,void 0),g=this.defaultTransitionablePropertyValues[a]=new ru(s);this.defaultTransitioningPropertyValues[a]=g.untransitioned(),this.defaultPossiblyEvaluatedValues[a]=h.possiblyEvaluate({})}};pn("DataDrivenProperty",bn),pn("DataConstantProperty",Mn),pn("CrossFadedDataDrivenProperty",zc),pn("CrossFadedProperty",is),pn("ColorRampProperty",as);var nu=function(t){function a(s,h){if(t.call(this),this.id=s.id,this.type=s.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},s.type!=="custom"&&(this.metadata=(s=s).metadata,this.minzoom=s.minzoom,this.maxzoom=s.maxzoom,s.type!=="background"&&(this.source=s.source,this.sourceLayer=s["source-layer"],this.filter=s.filter),h.layout&&(this._unevaluatedLayout=new Hs(h.layout)),h.paint)){for(var g in this._transitionablePaint=new Go(h.paint),s.paint)this.setPaintProperty(g,s.paint[g],{validate:!1});for(var m in s.layout)this.setLayoutProperty(m,s.layout[m],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new pu(h.paint)}}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},a.prototype.getLayoutProperty=function(s){return s==="visibility"?this.visibility:this._unevaluatedLayout.getValue(s)},a.prototype.setLayoutProperty=function(s,h,g){g===void 0&&(g={}),h!=null&&this._validate(Yu,"layers."+this.id+".layout."+s,s,h,g)||(s!=="visibility"?this._unevaluatedLayout.setValue(s,h):this.visibility=h)},a.prototype.getPaintProperty=function(s){return Y(s,"-transition")?this._transitionablePaint.getTransition(s.slice(0,-"-transition".length)):this._transitionablePaint.getValue(s)},a.prototype.setPaintProperty=function(s,h,g){if(g===void 0&&(g={}),h!=null&&this._validate(Dl,"layers."+this.id+".paint."+s,s,h,g))return!1;if(Y(s,"-transition"))return this._transitionablePaint.setTransition(s.slice(0,-"-transition".length),h||void 0),!1;var m=this._transitionablePaint._values[s],S=m.property.specification["property-type"]==="cross-faded-data-driven",M=m.value.isDataDriven(),k=m.value;this._transitionablePaint.setValue(s,h),this._handleSpecialPaintPropertyUpdate(s);var z=this._transitionablePaint._values[s].value;return z.isDataDriven()||M||S||this._handleOverridablePaintPropertyUpdate(s,k,z)},a.prototype._handleSpecialPaintPropertyUpdate=function(s){},a.prototype._handleOverridablePaintPropertyUpdate=function(s,h,g){return!1},a.prototype.isHidden=function(s){return!!(this.minzoom&&s<this.minzoom)||!!(this.maxzoom&&s>=this.maxzoom)||this.visibility==="none"},a.prototype.updateTransitions=function(s){this._transitioningPaint=this._transitionablePaint.transitioned(s,this._transitioningPaint)},a.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},a.prototype.recalculate=function(s,h){s.getCrossfadeParameters&&(this._crossfadeParameters=s.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(s,void 0,h)),this.paint=this._transitioningPaint.possiblyEvaluate(s,void 0,h)},a.prototype.serialize=function(){var s={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(s.layout=s.layout||{},s.layout.visibility=this.visibility),st(s,function(h,g){return!(h===void 0||g==="layout"&&!Object.keys(h).length||g==="paint"&&!Object.keys(h).length)})},a.prototype._validate=function(s,h,g,m,S){return S===void 0&&(S={}),(!S||S.validate!==!1)&&Bc(this,s.call(za,{key:h,layerType:this.type,objectKey:g,value:m,styleSpec:ce,style:{glyphs:!0,sprite:!0}}))},a.prototype.is3D=function(){return!1},a.prototype.isTileClipped=function(){return!1},a.prototype.hasOffscreenPass=function(){return!1},a.prototype.resize=function(){},a.prototype.isStateDependent=function(){for(var s in this.paint._values){var h=this.paint.get(s);if(h instanceof xs&&Qs(h.property.specification)&&(h.value.kind==="source"||h.value.kind==="composite")&&h.value.isStateDependent)return!0}return!1},a}(tt),to={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},Ou=function(t,a){this._structArray=t,this._pos1=a*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},Ji=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function Ta(t,a){a===void 0&&(a=1);var s=0,h=0;return{members:t.map(function(g){var m=to[g.type].BYTES_PER_ELEMENT,S=s=hc(s,Math.max(a,m)),M=g.components||1;return h=Math.max(h,m),s+=m*M,{name:g.name,type:g.type,components:M,offset:S}}),size:hc(s,Math.max(h,a)),alignment:a}}function hc(t,a){return Math.ceil(t/a)*a}Ji.serialize=function(t,a){return t._trim(),a&&(t.isTransferred=!0,a.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}},Ji.deserialize=function(t){var a=Object.create(this.prototype);return a.arrayBuffer=t.arrayBuffer,a.length=t.length,a.capacity=t.arrayBuffer.byteLength/a.bytesPerElement,a._refreshViews(),a},Ji.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},Ji.prototype.clear=function(){this.length=0},Ji.prototype.resize=function(t){this.reserve(t),this.length=t},Ji.prototype.reserve=function(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var a=this.uint8;this._refreshViews(),a&&this.uint8.set(a)}},Ji.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var Ru=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h){var g=this.length;return this.resize(g+1),this.emplace(g,s,h)},a.prototype.emplace=function(s,h,g){var m=2*s;return this.int16[m+0]=h,this.int16[m+1]=g,s},a}(Ji);Ru.prototype.bytesPerElement=4,pn("StructArrayLayout2i4",Ru);var iu=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,g,m){var S=this.length;return this.resize(S+1),this.emplace(S,s,h,g,m)},a.prototype.emplace=function(s,h,g,m,S){var M=4*s;return this.int16[M+0]=h,this.int16[M+1]=g,this.int16[M+2]=m,this.int16[M+3]=S,s},a}(Ji);iu.prototype.bytesPerElement=8,pn("StructArrayLayout4i8",iu);var du=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,g,m,S,M){var k=this.length;return this.resize(k+1),this.emplace(k,s,h,g,m,S,M)},a.prototype.emplace=function(s,h,g,m,S,M,k){var z=6*s;return this.int16[z+0]=h,this.int16[z+1]=g,this.int16[z+2]=m,this.int16[z+3]=S,this.int16[z+4]=M,this.int16[z+5]=k,s},a}(Ji);du.prototype.bytesPerElement=12,pn("StructArrayLayout2i4i12",du);var ko=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,g,m,S,M){var k=this.length;return this.resize(k+1),this.emplace(k,s,h,g,m,S,M)},a.prototype.emplace=function(s,h,g,m,S,M,k){var z=4*s,V=8*s;return this.int16[z+0]=h,this.int16[z+1]=g,this.uint8[V+4]=m,this.uint8[V+5]=S,this.uint8[V+6]=M,this.uint8[V+7]=k,s},a}(Ji);ko.prototype.bytesPerElement=8,pn("StructArrayLayout2i4ub8",ko);var Lu=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h){var g=this.length;return this.resize(g+1),this.emplace(g,s,h)},a.prototype.emplace=function(s,h,g){var m=2*s;return this.float32[m+0]=h,this.float32[m+1]=g,s},a}(Ji);Lu.prototype.bytesPerElement=8,pn("StructArrayLayout2f8",Lu);var vu=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,g,m,S,M,k,z,V,H){var te=this.length;return this.resize(te+1),this.emplace(te,s,h,g,m,S,M,k,z,V,H)},a.prototype.emplace=function(s,h,g,m,S,M,k,z,V,H,te){var se=10*s;return this.uint16[se+0]=h,this.uint16[se+1]=g,this.uint16[se+2]=m,this.uint16[se+3]=S,this.uint16[se+4]=M,this.uint16[se+5]=k,this.uint16[se+6]=z,this.uint16[se+7]=V,this.uint16[se+8]=H,this.uint16[se+9]=te,s},a}(Ji);vu.prototype.bytesPerElement=20,pn("StructArrayLayout10ui20",vu);var Uc=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,g,m,S,M,k,z,V,H,te,se){var Me=this.length;return this.resize(Me+1),this.emplace(Me,s,h,g,m,S,M,k,z,V,H,te,se)},a.prototype.emplace=function(s,h,g,m,S,M,k,z,V,H,te,se,Me){var Ie=12*s;return this.int16[Ie+0]=h,this.int16[Ie+1]=g,this.int16[Ie+2]=m,this.int16[Ie+3]=S,this.uint16[Ie+4]=M,this.uint16[Ie+5]=k,this.uint16[Ie+6]=z,this.uint16[Ie+7]=V,this.int16[Ie+8]=H,this.int16[Ie+9]=te,this.int16[Ie+10]=se,this.int16[Ie+11]=Me,s},a}(Ji);Uc.prototype.bytesPerElement=24,pn("StructArrayLayout4i4ui4i24",Uc);var Ku=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,g){var m=this.length;return this.resize(m+1),this.emplace(m,s,h,g)},a.prototype.emplace=function(s,h,g,m){var S=3*s;return this.float32[S+0]=h,this.float32[S+1]=g,this.float32[S+2]=m,s},a}(Ji);Ku.prototype.bytesPerElement=12,pn("StructArrayLayout3f12",Ku);var vl=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s){var h=this.length;return this.resize(h+1),this.emplace(h,s)},a.prototype.emplace=function(s,h){return this.uint32[1*s+0]=h,s},a}(Ji);vl.prototype.bytesPerElement=4,pn("StructArrayLayout1ul4",vl);var hf=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,g,m,S,M,k,z,V){var H=this.length;return this.resize(H+1),this.emplace(H,s,h,g,m,S,M,k,z,V)},a.prototype.emplace=function(s,h,g,m,S,M,k,z,V,H){var te=10*s,se=5*s;return this.int16[te+0]=h,this.int16[te+1]=g,this.int16[te+2]=m,this.int16[te+3]=S,this.int16[te+4]=M,this.int16[te+5]=k,this.uint32[se+3]=z,this.uint16[te+8]=V,this.uint16[te+9]=H,s},a}(Ji);hf.prototype.bytesPerElement=20,pn("StructArrayLayout6i1ul2ui20",hf);var Nl=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,g,m,S,M){var k=this.length;return this.resize(k+1),this.emplace(k,s,h,g,m,S,M)},a.prototype.emplace=function(s,h,g,m,S,M,k){var z=6*s;return this.int16[z+0]=h,this.int16[z+1]=g,this.int16[z+2]=m,this.int16[z+3]=S,this.int16[z+4]=M,this.int16[z+5]=k,s},a}(Ji);Nl.prototype.bytesPerElement=12,pn("StructArrayLayout2i2i2i12",Nl);var Bl=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,g,m,S){var M=this.length;return this.resize(M+1),this.emplace(M,s,h,g,m,S)},a.prototype.emplace=function(s,h,g,m,S,M){var k=4*s,z=8*s;return this.float32[k+0]=h,this.float32[k+1]=g,this.float32[k+2]=m,this.int16[z+6]=S,this.int16[z+7]=M,s},a}(Ji);Bl.prototype.bytesPerElement=16,pn("StructArrayLayout2f1f2i16",Bl);var Hf=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,g,m){var S=this.length;return this.resize(S+1),this.emplace(S,s,h,g,m)},a.prototype.emplace=function(s,h,g,m,S){var M=12*s,k=3*s;return this.uint8[M+0]=h,this.uint8[M+1]=g,this.float32[k+1]=m,this.float32[k+2]=S,s},a}(Ji);Hf.prototype.bytesPerElement=12,pn("StructArrayLayout2ub2f12",Hf);var ml=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,g){var m=this.length;return this.resize(m+1),this.emplace(m,s,h,g)},a.prototype.emplace=function(s,h,g,m){var S=3*s;return this.uint16[S+0]=h,this.uint16[S+1]=g,this.uint16[S+2]=m,s},a}(Ji);ml.prototype.bytesPerElement=6,pn("StructArrayLayout3ui6",ml);var gl=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,g,m,S,M,k,z,V,H,te,se,Me,Ie,qe,ze,at){var bt=this.length;return this.resize(bt+1),this.emplace(bt,s,h,g,m,S,M,k,z,V,H,te,se,Me,Ie,qe,ze,at)},a.prototype.emplace=function(s,h,g,m,S,M,k,z,V,H,te,se,Me,Ie,qe,ze,at,bt){var Ut=24*s,Ht=12*s,or=48*s;return this.int16[Ut+0]=h,this.int16[Ut+1]=g,this.uint16[Ut+2]=m,this.uint16[Ut+3]=S,this.uint32[Ht+2]=M,this.uint32[Ht+3]=k,this.uint32[Ht+4]=z,this.uint16[Ut+10]=V,this.uint16[Ut+11]=H,this.uint16[Ut+12]=te,this.float32[Ht+7]=se,this.float32[Ht+8]=Me,this.uint8[or+36]=Ie,this.uint8[or+37]=qe,this.uint8[or+38]=ze,this.uint32[Ht+10]=at,this.int16[Ut+22]=bt,s},a}(Ji);gl.prototype.bytesPerElement=48,pn("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",gl);var pf=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,g,m,S,M,k,z,V,H,te,se,Me,Ie,qe,ze,at,bt,Ut,Ht,or,Ar,Vr,kn,an,zn,ln,Pi){var ti=this.length;return this.resize(ti+1),this.emplace(ti,s,h,g,m,S,M,k,z,V,H,te,se,Me,Ie,qe,ze,at,bt,Ut,Ht,or,Ar,Vr,kn,an,zn,ln,Pi)},a.prototype.emplace=function(s,h,g,m,S,M,k,z,V,H,te,se,Me,Ie,qe,ze,at,bt,Ut,Ht,or,Ar,Vr,kn,an,zn,ln,Pi,ti){var Sn=34*s,Zi=17*s;return this.int16[Sn+0]=h,this.int16[Sn+1]=g,this.int16[Sn+2]=m,this.int16[Sn+3]=S,this.int16[Sn+4]=M,this.int16[Sn+5]=k,this.int16[Sn+6]=z,this.int16[Sn+7]=V,this.uint16[Sn+8]=H,this.uint16[Sn+9]=te,this.uint16[Sn+10]=se,this.uint16[Sn+11]=Me,this.uint16[Sn+12]=Ie,this.uint16[Sn+13]=qe,this.uint16[Sn+14]=ze,this.uint16[Sn+15]=at,this.uint16[Sn+16]=bt,this.uint16[Sn+17]=Ut,this.uint16[Sn+18]=Ht,this.uint16[Sn+19]=or,this.uint16[Sn+20]=Ar,this.uint16[Sn+21]=Vr,this.uint16[Sn+22]=kn,this.uint32[Zi+12]=an,this.float32[Zi+13]=zn,this.float32[Zi+14]=ln,this.float32[Zi+15]=Pi,this.float32[Zi+16]=ti,s},a}(Ji);pf.prototype.bytesPerElement=68,pn("StructArrayLayout8i15ui1ul4f68",pf);var Qo=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s){var h=this.length;return this.resize(h+1),this.emplace(h,s)},a.prototype.emplace=function(s,h){return this.float32[1*s+0]=h,s},a}(Ji);Qo.prototype.bytesPerElement=4,pn("StructArrayLayout1f4",Qo);var Ws=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,g){var m=this.length;return this.resize(m+1),this.emplace(m,s,h,g)},a.prototype.emplace=function(s,h,g,m){var S=3*s;return this.int16[S+0]=h,this.int16[S+1]=g,this.int16[S+2]=m,s},a}(Ji);Ws.prototype.bytesPerElement=6,pn("StructArrayLayout3i6",Ws);var ku=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,g){var m=this.length;return this.resize(m+1),this.emplace(m,s,h,g)},a.prototype.emplace=function(s,h,g,m){var S=4*s;return this.uint32[2*s+0]=h,this.uint16[S+2]=g,this.uint16[S+3]=m,s},a}(Ji);ku.prototype.bytesPerElement=8,pn("StructArrayLayout1ul2ui8",ku);var Zc=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h){var g=this.length;return this.resize(g+1),this.emplace(g,s,h)},a.prototype.emplace=function(s,h,g){var m=2*s;return this.uint16[m+0]=h,this.uint16[m+1]=g,s},a}(Ji);Zc.prototype.bytesPerElement=4,pn("StructArrayLayout2ui4",Zc);var pc=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s){var h=this.length;return this.resize(h+1),this.emplace(h,s)},a.prototype.emplace=function(s,h){return this.uint16[1*s+0]=h,s},a}(Ji);pc.prototype.bytesPerElement=2,pn("StructArrayLayout1ui2",pc);var yl=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,h,g,m){var S=this.length;return this.resize(S+1),this.emplace(S,s,h,g,m)},a.prototype.emplace=function(s,h,g,m,S){var M=4*s;return this.float32[M+0]=h,this.float32[M+1]=g,this.float32[M+2]=m,this.float32[M+3]=S,s},a}(Ji);yl.prototype.bytesPerElement=16,pn("StructArrayLayout4f16",yl);var l=function(t){function a(){t.apply(this,arguments)}t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a;var s={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return s.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},s.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},s.x1.get=function(){return this._structArray.int16[this._pos2+2]},s.y1.get=function(){return this._structArray.int16[this._pos2+3]},s.x2.get=function(){return this._structArray.int16[this._pos2+4]},s.y2.get=function(){return this._structArray.int16[this._pos2+5]},s.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},s.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},s.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},s.anchorPoint.get=function(){return new ne(this.anchorPointX,this.anchorPointY)},Object.defineProperties(a.prototype,s),a}(Ou);l.prototype.size=20;var f=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.get=function(s){return new l(this,s)},a}(hf);pn("CollisionBoxArray",f);var c=function(t){function a(){t.apply(this,arguments)}t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a;var s={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return s.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},s.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},s.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},s.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},s.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},s.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},s.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},s.segment.get=function(){return this._structArray.uint16[this._pos2+10]},s.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},s.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},s.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},s.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},s.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},s.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},s.placedOrientation.set=function(h){this._structArray.uint8[this._pos1+37]=h},s.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},s.hidden.set=function(h){this._structArray.uint8[this._pos1+38]=h},s.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},s.crossTileID.set=function(h){this._structArray.uint32[this._pos4+10]=h},s.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(a.prototype,s),a}(Ou);c.prototype.size=48;var p=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.get=function(s){return new c(this,s)},a}(gl);pn("PlacedSymbolArray",p);var b=function(t){function a(){t.apply(this,arguments)}t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a;var s={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return s.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},s.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},s.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},s.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},s.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},s.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},s.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},s.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},s.key.get=function(){return this._structArray.uint16[this._pos2+8]},s.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},s.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},s.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},s.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},s.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},s.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},s.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},s.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},s.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},s.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},s.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},s.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},s.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},s.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},s.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},s.crossTileID.set=function(h){this._structArray.uint32[this._pos4+12]=h},s.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},s.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},s.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},s.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(a.prototype,s),a}(Ou);b.prototype.size=68;var w=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.get=function(s){return new b(this,s)},a}(pf);pn("SymbolInstanceArray",w);var A=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.getoffsetX=function(s){return this.float32[1*s+0]},a}(Qo);pn("GlyphOffsetArray",A);var R=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.getx=function(s){return this.int16[3*s+0]},a.prototype.gety=function(s){return this.int16[3*s+1]},a.prototype.gettileUnitDistanceFromAnchor=function(s){return this.int16[3*s+2]},a}(Ws);pn("SymbolLineVertexArray",R);var U=function(t){function a(){t.apply(this,arguments)}t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a;var s={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return s.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},s.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},s.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(a.prototype,s),a}(Ou);U.prototype.size=8;var q=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.get=function(s){return new U(this,s)},a}(ku);pn("FeatureIndexArray",q);var le=Ta([{name:"a_pos",components:2,type:"Int16"}],4).members,fe=function(t){t===void 0&&(t=[]),this.segments=t};function pe(t,a){return 256*(t=ot(Math.floor(t),0,255))+ot(Math.floor(a),0,255)}fe.prototype.prepareSegment=function(t,a,s,h){var g=this.segments[this.segments.length-1];return t>fe.MAX_VERTEX_ARRAY_LENGTH&&Je("Max vertices per segment is "+fe.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+t),(!g||g.vertexLength+t>fe.MAX_VERTEX_ARRAY_LENGTH||g.sortKey!==h)&&(g={vertexOffset:a.length,primitiveOffset:s.length,vertexLength:0,primitiveLength:0},h!==void 0&&(g.sortKey=h),this.segments.push(g)),g},fe.prototype.get=function(){return this.segments},fe.prototype.destroy=function(){for(var t=0,a=this.segments;t<a.length;t+=1){var s=a[t];for(var h in s.vaos)s.vaos[h].destroy()}},fe.simpleSegment=function(t,a,s,h){return new fe([{vertexOffset:t,primitiveOffset:a,vertexLength:s,primitiveLength:h,vaos:{},sortKey:0}])},fe.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,pn("SegmentVector",fe);var Oe=Ta([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),Ce=Q(function(t){t.exports=function(a,s){var h,g,m,S,M,k,z,V;for(g=a.length-(h=3&a.length),m=s,M=3432918353,k=461845907,V=0;V<g;)z=255&a.charCodeAt(V)|(255&a.charCodeAt(++V))<<8|(255&a.charCodeAt(++V))<<16|(255&a.charCodeAt(++V))<<24,++V,m=27492+(65535&(S=5*(65535&(m=(m^=z=(65535&(z=(z=(65535&z)*M+(((z>>>16)*M&65535)<<16)&4294967295)<<15|z>>>17))*k+(((z>>>16)*k&65535)<<16)&4294967295)<<13|m>>>19))+((5*(m>>>16)&65535)<<16)&4294967295))+((58964+(S>>>16)&65535)<<16);switch(z=0,h){case 3:z^=(255&a.charCodeAt(V+2))<<16;case 2:z^=(255&a.charCodeAt(V+1))<<8;case 1:m^=z=(65535&(z=(z=(65535&(z^=255&a.charCodeAt(V)))*M+(((z>>>16)*M&65535)<<16)&4294967295)<<15|z>>>17))*k+(((z>>>16)*k&65535)<<16)&4294967295}return m^=a.length,m=2246822507*(65535&(m^=m>>>16))+((2246822507*(m>>>16)&65535)<<16)&4294967295,m=3266489909*(65535&(m^=m>>>13))+((3266489909*(m>>>16)&65535)<<16)&4294967295,(m^=m>>>16)>>>0}}),We=Q(function(t){t.exports=function(a,s){for(var h,g=a.length,m=s^g,S=0;g>=4;)h=1540483477*(65535&(h=255&a.charCodeAt(S)|(255&a.charCodeAt(++S))<<8|(255&a.charCodeAt(++S))<<16|(255&a.charCodeAt(++S))<<24))+((1540483477*(h>>>16)&65535)<<16),m=1540483477*(65535&m)+((1540483477*(m>>>16)&65535)<<16)^(h=1540483477*(65535&(h^=h>>>24))+((1540483477*(h>>>16)&65535)<<16)),g-=4,++S;switch(g){case 3:m^=(255&a.charCodeAt(S+2))<<16;case 2:m^=(255&a.charCodeAt(S+1))<<8;case 1:m=1540483477*(65535&(m^=255&a.charCodeAt(S)))+((1540483477*(m>>>16)&65535)<<16)}return m=1540483477*(65535&(m^=m>>>13))+((1540483477*(m>>>16)&65535)<<16),(m^=m>>>15)>>>0}}),Te=Ce,He=We;Te.murmur3=Ce,Te.murmur2=He;var Qe=function(){this.ids=[],this.positions=[],this.indexed=!1};Qe.prototype.add=function(t,a,s,h){this.ids.push(Vt(t)),this.positions.push(a,s,h)},Qe.prototype.getPositions=function(t){for(var a=Vt(t),s=0,h=this.ids.length-1;s<h;){var g=s+h>>1;this.ids[g]>=a?h=g:s=g+1}for(var m=[];this.ids[s]===a;)m.push({index:this.positions[3*s],start:this.positions[3*s+1],end:this.positions[3*s+2]}),s++;return m},Qe.serialize=function(t,a){var s=new Float64Array(t.ids),h=new Uint32Array(t.positions);return function g(m,S,M,k){for(;M<k;){for(var z=m[M+k>>1],V=M-1,H=k+1;;){do V++;while(m[V]<z);do H--;while(m[H]>z);if(V>=H)break;Nt(m,V,H),Nt(S,3*V,3*H),Nt(S,3*V+1,3*H+1),Nt(S,3*V+2,3*H+2)}H-M<k-H?(g(m,S,M,H),M=H+1):(g(m,S,H+1,k),k=H)}}(s,h,0,s.length-1),a&&a.push(s.buffer,h.buffer),{ids:s,positions:h}},Qe.deserialize=function(t){var a=new Qe;return a.ids=t.ids,a.positions=t.positions,a.indexed=!0,a};var yt=Math.pow(2,53)-1;function Vt(t){var a=+t;return!isNaN(a)&&a<=yt?a:Te(String(t))}function Nt(t,a,s){var h=t[a];t[a]=t[s],t[s]=h}pn("FeaturePositionMap",Qe);var Kt=function(t,a){this.gl=t.gl,this.location=a},cr=function(t){function a(s,h){t.call(this,s,h),this.current=0}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.set=function(s){this.current!==s&&(this.current=s,this.gl.uniform1i(this.location,s))},a}(Kt),Ir=function(t){function a(s,h){t.call(this,s,h),this.current=0}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.set=function(s){this.current!==s&&(this.current=s,this.gl.uniform1f(this.location,s))},a}(Kt),Or=function(t){function a(s,h){t.call(this,s,h),this.current=[0,0]}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.set=function(s){s[0]===this.current[0]&&s[1]===this.current[1]||(this.current=s,this.gl.uniform2f(this.location,s[0],s[1]))},a}(Kt),tn=function(t){function a(s,h){t.call(this,s,h),this.current=[0,0,0]}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.set=function(s){s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]||(this.current=s,this.gl.uniform3f(this.location,s[0],s[1],s[2]))},a}(Kt),Rn=function(t){function a(s,h){t.call(this,s,h),this.current=[0,0,0,0]}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.set=function(s){s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]&&s[3]===this.current[3]||(this.current=s,this.gl.uniform4f(this.location,s[0],s[1],s[2],s[3]))},a}(Kt),Fn=function(t){function a(s,h){t.call(this,s,h),this.current=Bi.transparent}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.set=function(s){s.r===this.current.r&&s.g===this.current.g&&s.b===this.current.b&&s.a===this.current.a||(this.current=s,this.gl.uniform4f(this.location,s.r,s.g,s.b,s.a))},a}(Kt),Un=new Float32Array(16),Li=function(t){function a(s,h){t.call(this,s,h),this.current=Un}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.set=function(s){if(s[12]!==this.current[12]||s[0]!==this.current[0])return this.current=s,void this.gl.uniformMatrix4fv(this.location,!1,s);for(var h=1;h<16;h++)if(s[h]!==this.current[h]){this.current=s,this.gl.uniformMatrix4fv(this.location,!1,s);break}},a}(Kt);function Zr(t){return[pe(255*t.r,255*t.g),pe(255*t.b,255*t.a)]}var ii=function(t,a,s){this.value=t,this.uniformNames=a.map(function(h){return"u_"+h}),this.type=s};ii.prototype.setUniform=function(t,a,s){t.set(s.constantOr(this.value))},ii.prototype.getBinding=function(t,a,s){return this.type==="color"?new Fn(t,a):new Ir(t,a)};var si=function(t,a){this.uniformNames=a.map(function(s){return"u_"+s}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};si.prototype.setConstantPatternPositions=function(t,a){this.pixelRatioFrom=a.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=a.tlbr,this.patternTo=t.tlbr},si.prototype.setUniform=function(t,a,s,h){var g=h==="u_pattern_to"?this.patternTo:h==="u_pattern_from"?this.patternFrom:h==="u_pixel_ratio_to"?this.pixelRatioTo:h==="u_pixel_ratio_from"?this.pixelRatioFrom:null;g&&t.set(g)},si.prototype.getBinding=function(t,a,s){return s.substr(0,9)==="u_pattern"?new Rn(t,a):new Ir(t,a)};var Qn=function(t,a,s,h){this.expression=t,this.type=s,this.maxValue=0,this.paintVertexAttributes=a.map(function(g){return{name:"a_"+g,type:"Float32",components:s==="color"?2:1,offset:0}}),this.paintVertexArray=new h};Qn.prototype.populatePaintArray=function(t,a,s,h,g){var m=this.paintVertexArray.length,S=this.expression.evaluate(new Si(0),a,{},h,[],g);this.paintVertexArray.resize(t),this._setPaintValue(m,t,S)},Qn.prototype.updatePaintArray=function(t,a,s,h){var g=this.expression.evaluate({zoom:0},s,h);this._setPaintValue(t,a,g)},Qn.prototype._setPaintValue=function(t,a,s){if(this.type==="color")for(var h=Zr(s),g=t;g<a;g++)this.paintVertexArray.emplace(g,h[0],h[1]);else{for(var m=t;m<a;m++)this.paintVertexArray.emplace(m,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}},Qn.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Qn.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var Hn=function(t,a,s,h,g,m){this.expression=t,this.uniformNames=a.map(function(S){return"u_"+S+"_t"}),this.type=s,this.useIntegerZoom=h,this.zoom=g,this.maxValue=0,this.paintVertexAttributes=a.map(function(S){return{name:"a_"+S,type:"Float32",components:s==="color"?4:2,offset:0}}),this.paintVertexArray=new m};Hn.prototype.populatePaintArray=function(t,a,s,h,g){var m=this.expression.evaluate(new Si(this.zoom),a,{},h,[],g),S=this.expression.evaluate(new Si(this.zoom+1),a,{},h,[],g),M=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(M,t,m,S)},Hn.prototype.updatePaintArray=function(t,a,s,h){var g=this.expression.evaluate({zoom:this.zoom},s,h),m=this.expression.evaluate({zoom:this.zoom+1},s,h);this._setPaintValue(t,a,g,m)},Hn.prototype._setPaintValue=function(t,a,s,h){if(this.type==="color")for(var g=Zr(s),m=Zr(h),S=t;S<a;S++)this.paintVertexArray.emplace(S,g[0],g[1],m[0],m[1]);else{for(var M=t;M<a;M++)this.paintVertexArray.emplace(M,s,h);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(h))}},Hn.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Hn.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},Hn.prototype.setUniform=function(t,a){var s=this.useIntegerZoom?Math.floor(a.zoom):a.zoom,h=ot(this.expression.interpolationFactor(s,this.zoom,this.zoom+1),0,1);t.set(h)},Hn.prototype.getBinding=function(t,a,s){return new Ir(t,a)};var mi=function(t,a,s,h,g,m){this.expression=t,this.type=a,this.useIntegerZoom=s,this.zoom=h,this.layerId=m,this.zoomInPaintVertexArray=new g,this.zoomOutPaintVertexArray=new g};mi.prototype.populatePaintArray=function(t,a,s){var h=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(h,t,a.patterns&&a.patterns[this.layerId],s)},mi.prototype.updatePaintArray=function(t,a,s,h,g){this._setPaintValues(t,a,s.patterns&&s.patterns[this.layerId],g)},mi.prototype._setPaintValues=function(t,a,s,h){if(h&&s){var g=h[s.min],m=h[s.mid],S=h[s.max];if(g&&m&&S)for(var M=t;M<a;M++)this.zoomInPaintVertexArray.emplace(M,m.tl[0],m.tl[1],m.br[0],m.br[1],g.tl[0],g.tl[1],g.br[0],g.br[1],m.pixelRatio,g.pixelRatio),this.zoomOutPaintVertexArray.emplace(M,m.tl[0],m.tl[1],m.br[0],m.br[1],S.tl[0],S.tl[1],S.br[0],S.br[1],m.pixelRatio,S.pixelRatio)}},mi.prototype.upload=function(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,Oe.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,Oe.members,this.expression.isStateDependent))},mi.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var Kn=function(t,a,s){this.binders={},this._buffers=[];var h=[];for(var g in t.paint._values)if(s(g)){var m=t.paint.get(g);if(m instanceof xs&&Qs(m.property.specification)){var S=uo(g,t.type),M=m.value,k=m.property.specification.type,z=m.property.useIntegerZoom,V=m.property.specification["property-type"],H=V==="cross-faded"||V==="cross-faded-data-driven";if(M.kind==="constant")this.binders[g]=H?new si(M.value,S):new ii(M.value,S,k),h.push("/u_"+g);else if(M.kind==="source"||H){var te=ha(g,k,"source");this.binders[g]=H?new mi(M,k,z,a,te,t.id):new Qn(M,S,k,te),h.push("/a_"+g)}else{var se=ha(g,k,"composite");this.binders[g]=new Hn(M,S,k,z,a,se),h.push("/z_"+g)}}}this.cacheKey=h.sort().join("")};Kn.prototype.getMaxValue=function(t){var a=this.binders[t];return a instanceof Qn||a instanceof Hn?a.maxValue:0},Kn.prototype.populatePaintArrays=function(t,a,s,h,g){for(var m in this.binders){var S=this.binders[m];(S instanceof Qn||S instanceof Hn||S instanceof mi)&&S.populatePaintArray(t,a,s,h,g)}},Kn.prototype.setConstantPatternPositions=function(t,a){for(var s in this.binders){var h=this.binders[s];h instanceof si&&h.setConstantPatternPositions(t,a)}},Kn.prototype.updatePaintArrays=function(t,a,s,h,g){var m=!1;for(var S in t)for(var M=0,k=a.getPositions(S);M<k.length;M+=1){var z=k[M],V=s.feature(z.index);for(var H in this.binders){var te=this.binders[H];if((te instanceof Qn||te instanceof Hn||te instanceof mi)&&te.expression.isStateDependent===!0){var se=h.paint.get(H);te.expression=se.value,te.updatePaintArray(z.start,z.end,V,t[S],g),m=!0}}}return m},Kn.prototype.defines=function(){var t=[];for(var a in this.binders){var s=this.binders[a];(s instanceof ii||s instanceof si)&&t.push.apply(t,s.uniformNames.map(function(h){return"#define HAS_UNIFORM_"+h}))}return t},Kn.prototype.getBinderAttributes=function(){var t=[];for(var a in this.binders){var s=this.binders[a];if(s instanceof Qn||s instanceof Hn)for(var h=0;h<s.paintVertexAttributes.length;h++)t.push(s.paintVertexAttributes[h].name);else if(s instanceof mi)for(var g=0;g<Oe.members.length;g++)t.push(Oe.members[g].name)}return t},Kn.prototype.getBinderUniforms=function(){var t=[];for(var a in this.binders){var s=this.binders[a];if(s instanceof ii||s instanceof si||s instanceof Hn)for(var h=0,g=s.uniformNames;h<g.length;h+=1)t.push(g[h])}return t},Kn.prototype.getPaintVertexBuffers=function(){return this._buffers},Kn.prototype.getUniforms=function(t,a){var s=[];for(var h in this.binders){var g=this.binders[h];if(g instanceof ii||g instanceof si||g instanceof Hn)for(var m=0,S=g.uniformNames;m<S.length;m+=1){var M=S[m];if(a[M]){var k=g.getBinding(t,a[M],M);s.push({name:M,property:h,binding:k})}}}return s},Kn.prototype.setUniforms=function(t,a,s,h){for(var g=0,m=a;g<m.length;g+=1){var S=m[g],M=S.name,k=S.property;this.binders[k].setUniform(S.binding,h,s.get(k),M)}},Kn.prototype.updatePaintBuffers=function(t){for(var a in this._buffers=[],this.binders){var s=this.binders[a];if(t&&s instanceof mi){var h=t.fromScale===2?s.zoomInPaintVertexBuffer:s.zoomOutPaintVertexBuffer;h&&this._buffers.push(h)}else(s instanceof Qn||s instanceof Hn)&&s.paintVertexBuffer&&this._buffers.push(s.paintVertexBuffer)}},Kn.prototype.upload=function(t){for(var a in this.binders){var s=this.binders[a];(s instanceof Qn||s instanceof Hn||s instanceof mi)&&s.upload(t)}this.updatePaintBuffers()},Kn.prototype.destroy=function(){for(var t in this.binders){var a=this.binders[t];(a instanceof Qn||a instanceof Hn||a instanceof mi)&&a.destroy()}};var Wn=function(t,a,s){s===void 0&&(s=function(){return!0}),this.programConfigurations={};for(var h=0,g=t;h<g.length;h+=1){var m=g[h];this.programConfigurations[m.id]=new Kn(m,a,s)}this.needsUpload=!1,this._featureMap=new Qe,this._bufferOffset=0};function uo(t,a){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[t]||[t.replace(a+"-","").replace(/-/g,"_")]}function ha(t,a,s){var h={color:{source:Lu,composite:yl},number:{source:Qo,composite:Lu}},g=function(m){return{"line-pattern":{source:vu,composite:vu},"fill-pattern":{source:vu,composite:vu},"fill-extrusion-pattern":{source:vu,composite:vu}}[m]}(t);return g&&g[s]||h[a][s]}Wn.prototype.populatePaintArrays=function(t,a,s,h,g,m){for(var S in this.programConfigurations)this.programConfigurations[S].populatePaintArrays(t,a,h,g,m);a.id!==void 0&&this._featureMap.add(a.id,s,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0},Wn.prototype.updatePaintArrays=function(t,a,s,h){for(var g=0,m=s;g<m.length;g+=1){var S=m[g];this.needsUpload=this.programConfigurations[S.id].updatePaintArrays(t,this._featureMap,a,S,h)||this.needsUpload}},Wn.prototype.get=function(t){return this.programConfigurations[t]},Wn.prototype.upload=function(t){if(this.needsUpload){for(var a in this.programConfigurations)this.programConfigurations[a].upload(t);this.needsUpload=!1}},Wn.prototype.destroy=function(){for(var t in this.programConfigurations)this.programConfigurations[t].destroy()},pn("ConstantBinder",ii),pn("CrossFadedConstantBinder",si),pn("SourceExpressionBinder",Qn),pn("CrossFadedCompositeBinder",mi),pn("CompositeExpressionBinder",Hn),pn("ProgramConfiguration",Kn,{omit:["_buffers"]}),pn("ProgramConfigurationSet",Wn);var Do=Math.pow(2,14)-1,Fo=-Do-1;function Za(t){for(var a=8192/t.extent,s=t.loadGeometry(),h=0;h<s.length;h++)for(var g=s[h],m=0;m<g.length;m++){var S=g[m],M=Math.round(S.x*a),k=Math.round(S.y*a);S.x=ot(M,Fo,Do),S.y=ot(k,Fo,Do),(M<S.x||M>S.x+1||k<S.y||k>S.y+1)&&Je("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return s}function ro(t,a){return{type:t.type,id:t.id,properties:t.properties,geometry:a?Za(t):[]}}function bs(t,a,s,h,g){t.emplaceBack(2*a+(h+1)/2,2*s+(g+1)/2)}var es=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(a){return a.id}),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Ru,this.indexArray=new ml,this.segments=new fe,this.programConfigurations=new Wn(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(function(a){return a.isStateDependent()}).map(function(a){return a.id})};function Du(t,a){for(var s=0;s<t.length;s++)if(ou(a,t[s]))return!0;for(var h=0;h<a.length;h++)if(ou(t,a[h]))return!0;return!!dc(t,a)}function os(t,a,s){return!!ou(t,a)||!!Fu(a,t,s)}function au(t,a){if(t.length===1)return Ul(a,t[0]);for(var s=0;s<a.length;s++)for(var h=a[s],g=0;g<h.length;g++)if(ou(t,h[g]))return!0;for(var m=0;m<t.length;m++)if(Ul(a,t[m]))return!0;for(var S=0;S<a.length;S++)if(dc(t,a[S]))return!0;return!1}function Ns(t,a,s){if(t.length>1){if(dc(t,a))return!0;for(var h=0;h<a.length;h++)if(Fu(a[h],t,s))return!0}for(var g=0;g<t.length;g++)if(Fu(t[g],a,s))return!0;return!1}function dc(t,a){if(t.length===0||a.length===0)return!1;for(var s=0;s<t.length-1;s++)for(var h=t[s],g=t[s+1],m=0;m<a.length-1;m++)if(zl(h,g,a[m],a[m+1]))return!0;return!1}function zl(t,a,s,h){return Rt(t,s,h)!==Rt(a,s,h)&&Rt(t,a,s)!==Rt(t,a,h)}function Fu(t,a,s){var h=s*s;if(a.length===1)return t.distSqr(a[0])<h;for(var g=1;g<a.length;g++)if(_l(t,a[g-1],a[g])<h)return!0;return!1}function _l(t,a,s){var h=a.distSqr(s);if(h===0)return t.distSqr(a);var g=((t.x-a.x)*(s.x-a.x)+(t.y-a.y)*(s.y-a.y))/h;return t.distSqr(g<0?a:g>1?s:s.sub(a)._mult(g)._add(a))}function Ul(t,a){for(var s,h,g,m=!1,S=0;S<t.length;S++)for(var M=0,k=(s=t[S]).length-1;M<s.length;k=M++)(h=s[M]).y>a.y!=(g=s[k]).y>a.y&&a.x<(g.x-h.x)*(a.y-h.y)/(g.y-h.y)+h.x&&(m=!m);return m}function ou(t,a){for(var s=!1,h=0,g=t.length-1;h<t.length;g=h++){var m=t[h],S=t[g];m.y>a.y!=S.y>a.y&&a.x<(S.x-m.x)*(a.y-m.y)/(S.y-m.y)+m.x&&(s=!s)}return s}function Zl(t,a,s){var h=s[0],g=s[2];if(t.x<h.x&&a.x<h.x||t.x>g.x&&a.x>g.x||t.y<h.y&&a.y<h.y||t.y>g.y&&a.y>g.y)return!1;var m=Rt(t,a,s[0]);return m!==Rt(t,a,s[1])||m!==Rt(t,a,s[2])||m!==Rt(t,a,s[3])}function mu(t,a,s){var h=a.paint.get(t).value;return h.kind==="constant"?h.value:s.programConfigurations.get(a.id).getMaxValue(t)}function go(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function Nu(t,a,s,h,g){if(!a[0]&&!a[1])return t;var m=ne.convert(a)._mult(g);s==="viewport"&&m._rotate(-h);for(var S=[],M=0;M<t.length;M++)S.push(t[M].sub(m));return S}es.prototype.populate=function(t,a,s){var h=this.layers[0],g=[],m=null;h.type==="circle"&&(m=h.layout.get("circle-sort-key"));for(var S=0,M=t;S<M.length;S+=1){var k=M[S],z=k.feature,V=k.id,H=k.index,te=k.sourceLayerIndex,se=this.layers[0]._featureFilter.needGeometry,Me=ro(z,se);if(this.layers[0]._featureFilter.filter(new Si(this.zoom),Me,s)){var Ie=m?m.evaluate(Me,{},s):void 0,qe={id:V,properties:z.properties,type:z.type,sourceLayerIndex:te,index:H,geometry:se?Me.geometry:Za(z),patterns:{},sortKey:Ie};g.push(qe)}}m&&g.sort(function(Vr,kn){return Vr.sortKey-kn.sortKey});for(var ze=0,at=g;ze<at.length;ze+=1){var bt=at[ze],Ut=bt.geometry,Ht=bt.index,or=bt.sourceLayerIndex,Ar=t[Ht].feature;this.addFeature(bt,Ut,Ht,s),a.featureIndex.insert(Ar,Ut,Ht,or,this.index)}},es.prototype.update=function(t,a,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,a,this.stateDependentLayers,s)},es.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},es.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},es.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,le),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},es.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},es.prototype.addFeature=function(t,a,s,h){for(var g=0,m=a;g<m.length;g+=1)for(var S=0,M=m[g];S<M.length;S+=1){var k=M[S],z=k.x,V=k.y;if(!(z<0||z>=8192||V<0||V>=8192)){var H=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),te=H.vertexLength;bs(this.layoutVertexArray,z,V,-1,-1),bs(this.layoutVertexArray,z,V,1,-1),bs(this.layoutVertexArray,z,V,1,1),bs(this.layoutVertexArray,z,V,-1,1),this.indexArray.emplaceBack(te,te+1,te+2),this.indexArray.emplaceBack(te,te+3,te+2),H.vertexLength+=4,H.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,{},h)},pn("CircleBucket",es,{omit:["layers"]});var Bu=new Jo({"circle-sort-key":new bn(ce.layout_circle["circle-sort-key"])}),$u={paint:new Jo({"circle-radius":new bn(ce.paint_circle["circle-radius"]),"circle-color":new bn(ce.paint_circle["circle-color"]),"circle-blur":new bn(ce.paint_circle["circle-blur"]),"circle-opacity":new bn(ce.paint_circle["circle-opacity"]),"circle-translate":new Mn(ce.paint_circle["circle-translate"]),"circle-translate-anchor":new Mn(ce.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Mn(ce.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Mn(ce.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new bn(ce.paint_circle["circle-stroke-width"]),"circle-stroke-color":new bn(ce.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new bn(ce.paint_circle["circle-stroke-opacity"])}),layout:Bu},ta=typeof Float32Array!="undefined"?Float32Array:Array;function Es(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ss(t,a,s){var h=a[0],g=a[1],m=a[2],S=a[3],M=a[4],k=a[5],z=a[6],V=a[7],H=a[8],te=a[9],se=a[10],Me=a[11],Ie=a[12],qe=a[13],ze=a[14],at=a[15],bt=s[0],Ut=s[1],Ht=s[2],or=s[3];return t[0]=bt*h+Ut*M+Ht*H+or*Ie,t[1]=bt*g+Ut*k+Ht*te+or*qe,t[2]=bt*m+Ut*z+Ht*se+or*ze,t[3]=bt*S+Ut*V+Ht*Me+or*at,t[4]=(bt=s[4])*h+(Ut=s[5])*M+(Ht=s[6])*H+(or=s[7])*Ie,t[5]=bt*g+Ut*k+Ht*te+or*qe,t[6]=bt*m+Ut*z+Ht*se+or*ze,t[7]=bt*S+Ut*V+Ht*Me+or*at,t[8]=(bt=s[8])*h+(Ut=s[9])*M+(Ht=s[10])*H+(or=s[11])*Ie,t[9]=bt*g+Ut*k+Ht*te+or*qe,t[10]=bt*m+Ut*z+Ht*se+or*ze,t[11]=bt*S+Ut*V+Ht*Me+or*at,t[12]=(bt=s[12])*h+(Ut=s[13])*M+(Ht=s[14])*H+(or=s[15])*Ie,t[13]=bt*g+Ut*k+Ht*te+or*qe,t[14]=bt*m+Ut*z+Ht*se+or*ze,t[15]=bt*S+Ut*V+Ht*Me+or*at,t}Math.hypot||(Math.hypot=function(){for(var t=arguments,a=0,s=arguments.length;s--;)a+=t[s]*t[s];return Math.sqrt(a)});var Ju,Vc=ss;function jc(t,a,s){var h=a[0],g=a[1],m=a[2],S=a[3];return t[0]=s[0]*h+s[4]*g+s[8]*m+s[12]*S,t[1]=s[1]*h+s[5]*g+s[9]*m+s[13]*S,t[2]=s[2]*h+s[6]*g+s[10]*m+s[14]*S,t[3]=s[3]*h+s[7]*g+s[11]*m+s[15]*S,t}Ju=new ta(3),ta!=Float32Array&&(Ju[0]=0,Ju[1]=0,Ju[2]=0),function(){var t=new ta(4);ta!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0)}();var df=(function(){var t=new ta(2);ta!=Float32Array&&(t[0]=0,t[1]=0)}(),function(t){function a(s){t.call(this,s,$u)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.createBucket=function(s){return new es(s)},a.prototype.queryRadius=function(s){var h=s;return mu("circle-radius",this,h)+mu("circle-stroke-width",this,h)+go(this.paint.get("circle-translate"))},a.prototype.queryIntersectsFeature=function(s,h,g,m,S,M,k,z){for(var V=Nu(s,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),M.angle,k),H=this.paint.get("circle-radius").evaluate(h,g)+this.paint.get("circle-stroke-width").evaluate(h,g),te=this.paint.get("circle-pitch-alignment")==="map",se=te?V:function(Ar,Vr){return Ar.map(function(kn){return Xs(kn,Vr)})}(V,z),Me=te?H*k:H,Ie=0,qe=m;Ie<qe.length;Ie+=1)for(var ze=0,at=qe[Ie];ze<at.length;ze+=1){var bt=at[ze],Ut=te?bt:Xs(bt,z),Ht=Me,or=jc([],[bt.x,bt.y,0,1],z);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Ht*=or[3]/M.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Ht*=M.cameraToCenterDistance/or[3]),os(se,Ut,Ht))return!0}return!1},a}(nu));function Xs(t,a){var s=jc([],[t.x,t.y,0,1],a);return new ne(s[0]/s[3],s[1]/s[3])}var gu=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a}(es);function su(t,a,s,h){var g=a.width,m=a.height;if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==g*m*s)throw new RangeError("mismatched image size")}else h=new Uint8Array(g*m*s);return t.width=g,t.height=m,t.data=h,t}function xl(t,a,s){var h=a.width,g=a.height;if(h!==t.width||g!==t.height){var m=su({},{width:h,height:g},s);Gc(t,m,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,h),height:Math.min(t.height,g)},s),t.width=h,t.height=g,t.data=m.data}}function Gc(t,a,s,h,g,m){if(g.width===0||g.height===0)return a;if(g.width>t.width||g.height>t.height||s.x>t.width-g.width||s.y>t.height-g.height)throw new RangeError("out of range source coordinates for image copy");if(g.width>a.width||g.height>a.height||h.x>a.width-g.width||h.y>a.height-g.height)throw new RangeError("out of range destination coordinates for image copy");for(var S=t.data,M=a.data,k=0;k<g.height;k++)for(var z=((s.y+k)*t.width+s.x)*m,V=((h.y+k)*a.width+h.x)*m,H=0;H<g.width*m;H++)M[V+H]=S[z+H];return a}pn("HeatmapBucket",gu,{omit:["layers"]});var yu=function(t,a){su(this,t,1,a)};yu.prototype.resize=function(t){xl(this,t,1)},yu.prototype.clone=function(){return new yu({width:this.width,height:this.height},new Uint8Array(this.data))},yu.copy=function(t,a,s,h,g){Gc(t,a,s,h,g,1)};var wo=function(t,a){su(this,t,4,a)};wo.prototype.resize=function(t){xl(this,t,4)},wo.prototype.replace=function(t,a){a?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t},wo.prototype.clone=function(){return new wo({width:this.width,height:this.height},new Uint8Array(this.data))},wo.copy=function(t,a,s,h,g){Gc(t,a,s,h,g,4)},pn("AlphaImage",yu),pn("RGBAImage",wo);var vc={paint:new Jo({"heatmap-radius":new bn(ce.paint_heatmap["heatmap-radius"]),"heatmap-weight":new bn(ce.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Mn(ce.paint_heatmap["heatmap-intensity"]),"heatmap-color":new as(ce.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Mn(ce.paint_heatmap["heatmap-opacity"])})};function Wf(t){var a={},s=t.resolution||256,h=t.clips?t.clips.length:1,g=t.image||new wo({width:s,height:h}),m=function(Me,Ie,qe){a[t.evaluationKey]=qe;var ze=t.expression.evaluate(a);g.data[Me+Ie+0]=Math.floor(255*ze.r/ze.a),g.data[Me+Ie+1]=Math.floor(255*ze.g/ze.a),g.data[Me+Ie+2]=Math.floor(255*ze.b/ze.a),g.data[Me+Ie+3]=Math.floor(255*ze.a)};if(t.clips)for(var S=0,M=0;S<h;++S,M+=4*s)for(var k=0,z=0;k<s;k++,z+=4){var V=k/(s-1),H=t.clips[S];m(M,z,H.start*(1-V)+H.end*V)}else for(var te=0,se=0;te<s;te++,se+=4)m(0,se,te/(s-1));return g}var Eh=function(t){function a(s){t.call(this,s,vc),this._updateColorRamp()}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.createBucket=function(s){return new gu(s)},a.prototype._handleSpecialPaintPropertyUpdate=function(s){s==="heatmap-color"&&this._updateColorRamp()},a.prototype._updateColorRamp=function(){this.colorRamp=Wf({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},a.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},a.prototype.queryRadius=function(){return 0},a.prototype.queryIntersectsFeature=function(){return!1},a.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},a}(nu),vf={paint:new Jo({"hillshade-illumination-direction":new Mn(ce.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Mn(ce.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Mn(ce.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Mn(ce.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Mn(ce.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Mn(ce.paint_hillshade["hillshade-accent-color"])})},Sh=function(t){function a(s){t.call(this,s,vf)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},a}(nu),Qh=Ta([{name:"a_pos",components:2,type:"Int16"}],4).members,mc=wh,mf=wh;function wh(t,a,s){s=s||2;var h,g,m,S,M,k,z,V=a&&a.length,H=V?a[0]*s:t.length,te=zp(t,0,H,s,!0),se=[];if(!te||te.next===te.prev)return se;if(V&&(te=function(Ie,qe,ze,at){var bt,Ut,Ht,or=[];for(bt=0,Ut=qe.length;bt<Ut;bt++)(Ht=zp(Ie,qe[bt]*at,bt<Ut-1?qe[bt+1]*at:Ie.length,at,!1))===Ht.next&&(Ht.steiner=!0),or.push(jp(Ht));for(or.sort(Zp),bt=0;bt<or.length;bt++)Vp(or[bt],ze),ze=gc(ze,ze.next);return ze}(t,a,te,s)),t.length>80*s){h=m=t[0],g=S=t[1];for(var Me=s;Me<H;Me+=s)(M=t[Me])<h&&(h=M),(k=t[Me+1])<g&&(g=k),M>m&&(m=M),k>S&&(S=k);z=(z=Math.max(m-h,S-g))!==0?1/z:0}return Fr(te,se,s,h,g,z),se}function zp(t,a,s,h,g){var m,S;if(g===Kf(t,a,s,h)>0)for(m=a;m<s;m+=h)S=_f(m,t[m],t[m+1],S);else for(m=s-h;m>=a;m-=h)S=_f(m,t[m],t[m+1],S);return S&&Xf(S,S.next)&&(Vl(S),S=S.next),S}function gc(t,a){if(!t)return t;a||(a=t);var s,h=t;do if(s=!1,h.steiner||!Xf(h,h.next)&&Co(h.prev,h,h.next)!==0)h=h.next;else{if(Vl(h),(h=a=h.prev)===h.next)break;s=!0}while(s||h!==a);return a}function Fr(t,a,s,h,g,m,S){if(t){!S&&m&&function(V,H,te,se){var Me=V;do Me.z===null&&(Me.z=rp(Me.x,Me.y,H,te,se)),Me.prevZ=Me.prev,Me.nextZ=Me.next,Me=Me.next;while(Me!==V);Me.prevZ.nextZ=null,Me.prevZ=null,function(Ie){var qe,ze,at,bt,Ut,Ht,or,Ar,Vr=1;do{for(ze=Ie,Ie=null,Ut=null,Ht=0;ze;){for(Ht++,at=ze,or=0,qe=0;qe<Vr&&(or++,at=at.nextZ);qe++);for(Ar=Vr;or>0||Ar>0&&at;)or!==0&&(Ar===0||!at||ze.z<=at.z)?(bt=ze,ze=ze.nextZ,or--):(bt=at,at=at.nextZ,Ar--),Ut?Ut.nextZ=bt:Ie=bt,bt.prevZ=Ut,Ut=bt;ze=at}Ut.nextZ=null,Vr*=2}while(Ht>1)}(Me)}(t,h,g,m);for(var M,k,z=t;t.prev!==t.next;)if(M=t.prev,k=t.next,m?$t(t,h,g,m):Up(t))a.push(M.i/s),a.push(t.i/s),a.push(k.i/s),Vl(t),t=k.next,z=k.next;else if((t=k)===z){S?S===1?Fr(t=gf(gc(t),a,s),a,s,h,g,m,2):S===2&&ep(t,a,s,h,g,m):Fr(gc(t),a,s,h,g,m,1);break}}}function Up(t){var a=t.prev,s=t,h=t.next;if(Co(a,s,h)>=0)return!1;for(var g=t.next.next;g!==t.prev;){if(bl(a.x,a.y,s.x,s.y,h.x,h.y,g.x,g.y)&&Co(g.prev,g,g.next)>=0)return!1;g=g.next}return!0}function $t(t,a,s,h){var g=t.prev,m=t,S=t.next;if(Co(g,m,S)>=0)return!1;for(var M=g.x>m.x?g.x>S.x?g.x:S.x:m.x>S.x?m.x:S.x,k=g.y>m.y?g.y>S.y?g.y:S.y:m.y>S.y?m.y:S.y,z=rp(g.x<m.x?g.x<S.x?g.x:S.x:m.x<S.x?m.x:S.x,g.y<m.y?g.y<S.y?g.y:S.y:m.y<S.y?m.y:S.y,a,s,h),V=rp(M,k,a,s,h),H=t.prevZ,te=t.nextZ;H&&H.z>=z&&te&&te.z<=V;){if(H!==t.prev&&H!==t.next&&bl(g.x,g.y,m.x,m.y,S.x,S.y,H.x,H.y)&&Co(H.prev,H,H.next)>=0||(H=H.prevZ,te!==t.prev&&te!==t.next&&bl(g.x,g.y,m.x,m.y,S.x,S.y,te.x,te.y)&&Co(te.prev,te,te.next)>=0))return!1;te=te.nextZ}for(;H&&H.z>=z;){if(H!==t.prev&&H!==t.next&&bl(g.x,g.y,m.x,m.y,S.x,S.y,H.x,H.y)&&Co(H.prev,H,H.next)>=0)return!1;H=H.prevZ}for(;te&&te.z<=V;){if(te!==t.prev&&te!==t.next&&bl(g.x,g.y,m.x,m.y,S.x,S.y,te.x,te.y)&&Co(te.prev,te,te.next)>=0)return!1;te=te.nextZ}return!0}function gf(t,a,s){var h=t;do{var g=h.prev,m=h.next.next;!Xf(g,m)&&np(g,h,h.next,m)&&yf(g,m)&&yf(m,g)&&(a.push(g.i/s),a.push(h.i/s),a.push(m.i/s),Vl(h),Vl(h.next),h=t=m),h=h.next}while(h!==t);return gc(h)}function ep(t,a,s,h,g,m){var S=t;do{for(var M=S.next.next;M!==S.prev;){if(S.i!==M.i&&bd(S,M)){var k=Ch(S,M);return S=gc(S,S.next),k=gc(k,k.next),Fr(S,a,s,h,g,m),void Fr(k,a,s,h,g,m)}M=M.next}S=S.next}while(S!==t)}function Zp(t,a){return t.x-a.x}function Vp(t,a){if(a=function(h,g){var m,S=g,M=h.x,k=h.y,z=-1/0;do{if(k<=S.y&&k>=S.next.y&&S.next.y!==S.y){var V=S.x+(k-S.y)*(S.next.x-S.x)/(S.next.y-S.y);if(V<=M&&V>z){if(z=V,V===M){if(k===S.y)return S;if(k===S.next.y)return S.next}m=S.x<S.next.x?S:S.next}}S=S.next}while(S!==g);if(!m)return null;if(M===z)return m;var H,te=m,se=m.x,Me=m.y,Ie=1/0;S=m;do M>=S.x&&S.x>=se&&M!==S.x&&bl(k<Me?M:z,k,se,Me,k<Me?z:M,k,S.x,S.y)&&(H=Math.abs(k-S.y)/(M-S.x),yf(S,h)&&(H<Ie||H===Ie&&(S.x>m.x||S.x===m.x&&tp(m,S)))&&(m=S,Ie=H)),S=S.next;while(S!==te);return m}(t,a)){var s=Ch(a,t);gc(a,a.next),gc(s,s.next)}}function tp(t,a){return Co(t.prev,t,a.prev)<0&&Co(a.next,t,t.next)<0}function rp(t,a,s,h,g){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-s)*g)|t<<8))|t<<4))|t<<2))|t<<1))|(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=32767*(a-h)*g)|a<<8))|a<<4))|a<<2))|a<<1))<<1}function jp(t){var a=t,s=t;do(a.x<s.x||a.x===s.x&&a.y<s.y)&&(s=a),a=a.next;while(a!==t);return s}function bl(t,a,s,h,g,m,S,M){return(g-S)*(a-M)-(t-S)*(m-M)>=0&&(t-S)*(h-M)-(s-S)*(a-M)>=0&&(s-S)*(m-M)-(g-S)*(h-M)>=0}function bd(t,a){return t.next.i!==a.i&&t.prev.i!==a.i&&!function(s,h){var g=s;do{if(g.i!==s.i&&g.next.i!==s.i&&g.i!==h.i&&g.next.i!==h.i&&np(g,g.next,s,h))return!0;g=g.next}while(g!==s);return!1}(t,a)&&(yf(t,a)&&yf(a,t)&&function(s,h){var g=s,m=!1,S=(s.x+h.x)/2,M=(s.y+h.y)/2;do g.y>M!=g.next.y>M&&g.next.y!==g.y&&S<(g.next.x-g.x)*(M-g.y)/(g.next.y-g.y)+g.x&&(m=!m),g=g.next;while(g!==s);return m}(t,a)&&(Co(t.prev,t,a.prev)||Co(t,a.prev,a))||Xf(t,a)&&Co(t.prev,t,t.next)>0&&Co(a.prev,a,a.next)>0)}function Co(t,a,s){return(a.y-t.y)*(s.x-a.x)-(a.x-t.x)*(s.y-a.y)}function Xf(t,a){return t.x===a.x&&t.y===a.y}function np(t,a,s,h){var g=qf(Co(t,a,s)),m=qf(Co(t,a,h)),S=qf(Co(s,h,t)),M=qf(Co(s,h,a));return g!==m&&S!==M||!(g!==0||!Yf(t,s,a))||!(m!==0||!Yf(t,h,a))||!(S!==0||!Yf(s,t,h))||!(M!==0||!Yf(s,a,h))}function Yf(t,a,s){return a.x<=Math.max(t.x,s.x)&&a.x>=Math.min(t.x,s.x)&&a.y<=Math.max(t.y,s.y)&&a.y>=Math.min(t.y,s.y)}function qf(t){return t>0?1:t<0?-1:0}function yf(t,a){return Co(t.prev,t,t.next)<0?Co(t,a,t.next)>=0&&Co(t,t.prev,a)>=0:Co(t,a,t.prev)<0||Co(t,t.next,a)<0}function Ch(t,a){var s=new yc(t.i,t.x,t.y),h=new yc(a.i,a.x,a.y),g=t.next,m=a.prev;return t.next=a,a.prev=t,s.next=g,g.prev=s,h.next=s,s.prev=h,m.next=h,h.prev=m,h}function _f(t,a,s,h){var g=new yc(t,a,s);return h?(g.next=h.next,g.prev=h,h.next.prev=g,h.next=g):(g.prev=g,g.next=g),g}function Vl(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function yc(t,a,s){this.i=t,this.x=a,this.y=s,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Kf(t,a,s,h){for(var g=0,m=a,S=s-h;m<s;m+=h)g+=(t[S]-t[m])*(t[m+1]+t[S+1]),S=m;return g}function Th(t,a,s,h,g){(function m(S,M,k,z,V){for(;z>k;){if(z-k>600){var H=z-k+1,te=M-k+1,se=Math.log(H),Me=.5*Math.exp(2*se/3),Ie=.5*Math.sqrt(se*Me*(H-Me)/H)*(te-H/2<0?-1:1);m(S,M,Math.max(k,Math.floor(M-te*Me/H+Ie)),Math.min(z,Math.floor(M+(H-te)*Me/H+Ie)),V)}var qe=S[M],ze=k,at=z;for(_c(S,k,M),V(S[z],qe)>0&&_c(S,k,z);ze<at;){for(_c(S,ze,at),ze++,at--;V(S[ze],qe)<0;)ze++;for(;V(S[at],qe)>0;)at--}V(S[k],qe)===0?_c(S,k,at):_c(S,++at,z),at<=M&&(k=at+1),M<=at&&(z=at-1)}})(t,a,s||0,h||t.length-1,g||Ah)}function _c(t,a,s){var h=t[a];t[a]=t[s],t[s]=h}function Ah(t,a){return t<a?-1:t>a?1:0}function $f(t,a){var s=t.length;if(s<=1)return[t];for(var h,g,m=[],S=0;S<s;S++){var M=dr(t[S]);M!==0&&(t[S].area=Math.abs(M),g===void 0&&(g=M<0),g===M<0?(h&&m.push(h),h=[t[S]]):h.push(t[S]))}if(h&&m.push(h),a>1)for(var k=0;k<m.length;k++)m[k].length<=a||(Th(m[k],a,1,m[k].length-1,Mh),m[k]=m[k].slice(0,a));return m}function Mh(t,a){return a.area-t.area}function xf(t,a,s){for(var h=s.patternDependencies,g=!1,m=0,S=a;m<S.length;m+=1){var M=S[m].paint.get(t+"-pattern");M.isConstant()||(g=!0);var k=M.constantOr(null);k&&(g=!0,h[k.to]=!0,h[k.from]=!0)}return g}function Hc(t,a,s,h,g){for(var m=g.patternDependencies,S=0,M=a;S<M.length;S+=1){var k=M[S],z=k.paint.get(t+"-pattern").value;if(z.kind!=="constant"){var V=z.evaluate({zoom:h-1},s,{},g.availableImages),H=z.evaluate({zoom:h},s,{},g.availableImages),te=z.evaluate({zoom:h+1},s,{},g.availableImages);H=H&&H.name?H.name:H,te=te&&te.name?te.name:te,m[V=V&&V.name?V.name:V]=!0,m[H]=!0,m[te]=!0,s.patterns[k.id]={min:V,mid:H,max:te}}}return s}wh.deviation=function(t,a,s,h){var g=a&&a.length,m=Math.abs(Kf(t,0,g?a[0]*s:t.length,s));if(g)for(var S=0,M=a.length;S<M;S++)m-=Math.abs(Kf(t,a[S]*s,S<M-1?a[S+1]*s:t.length,s));var k=0;for(S=0;S<h.length;S+=3){var z=h[S]*s,V=h[S+1]*s,H=h[S+2]*s;k+=Math.abs((t[z]-t[H])*(t[V+1]-t[z+1])-(t[z]-t[V])*(t[H+1]-t[z+1]))}return m===0&&k===0?0:Math.abs((k-m)/m)},wh.flatten=function(t){for(var a=t[0][0].length,s={vertices:[],holes:[],dimensions:a},h=0,g=0;g<t.length;g++){for(var m=0;m<t[g].length;m++)for(var S=0;S<a;S++)s.vertices.push(t[g][m][S]);g>0&&s.holes.push(h+=t[g-1].length)}return s},mc.default=mf;var Ys=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(a){return a.id}),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ru,this.indexArray=new ml,this.indexArray2=new Zc,this.programConfigurations=new Wn(t.layers,t.zoom),this.segments=new fe,this.segments2=new fe,this.stateDependentLayerIds=this.layers.filter(function(a){return a.isStateDependent()}).map(function(a){return a.id})};Ys.prototype.populate=function(t,a,s){this.hasPattern=xf("fill",this.layers,a);for(var h=this.layers[0].layout.get("fill-sort-key"),g=[],m=0,S=t;m<S.length;m+=1){var M=S[m],k=M.feature,z=M.id,V=M.index,H=M.sourceLayerIndex,te=this.layers[0]._featureFilter.needGeometry,se=ro(k,te);if(this.layers[0]._featureFilter.filter(new Si(this.zoom),se,s)){var Me=h?h.evaluate(se,{},s,a.availableImages):void 0,Ie={id:z,properties:k.properties,type:k.type,sourceLayerIndex:H,index:V,geometry:te?se.geometry:Za(k),patterns:{},sortKey:Me};g.push(Ie)}}h&&g.sort(function(Ar,Vr){return Ar.sortKey-Vr.sortKey});for(var qe=0,ze=g;qe<ze.length;qe+=1){var at=ze[qe],bt=at.geometry,Ut=at.index,Ht=at.sourceLayerIndex;if(this.hasPattern){var or=Hc("fill",this.layers,at,this.zoom,a);this.patternFeatures.push(or)}else this.addFeature(at,bt,Ut,s,{});a.featureIndex.insert(t[Ut].feature,bt,Ut,Ht,this.index)}},Ys.prototype.update=function(t,a,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,a,this.stateDependentLayers,s)},Ys.prototype.addFeatures=function(t,a,s){for(var h=0,g=this.patternFeatures;h<g.length;h+=1){var m=g[h];this.addFeature(m,m.geometry,m.index,a,s)}},Ys.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Ys.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Ys.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Qh),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0},Ys.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},Ys.prototype.addFeature=function(t,a,s,h,g){for(var m=0,S=$f(a,500);m<S.length;m+=1){for(var M=S[m],k=0,z=0,V=M;z<V.length;z+=1)k+=V[z].length;for(var H=this.segments.prepareSegment(k,this.layoutVertexArray,this.indexArray),te=H.vertexLength,se=[],Me=[],Ie=0,qe=M;Ie<qe.length;Ie+=1){var ze=qe[Ie];if(ze.length!==0){ze!==M[0]&&Me.push(se.length/2);var at=this.segments2.prepareSegment(ze.length,this.layoutVertexArray,this.indexArray2),bt=at.vertexLength;this.layoutVertexArray.emplaceBack(ze[0].x,ze[0].y),this.indexArray2.emplaceBack(bt+ze.length-1,bt),se.push(ze[0].x),se.push(ze[0].y);for(var Ut=1;Ut<ze.length;Ut++)this.layoutVertexArray.emplaceBack(ze[Ut].x,ze[Ut].y),this.indexArray2.emplaceBack(bt+Ut-1,bt+Ut),se.push(ze[Ut].x),se.push(ze[Ut].y);at.vertexLength+=ze.length,at.primitiveLength+=ze.length}}for(var Ht=mc(se,Me),or=0;or<Ht.length;or+=3)this.indexArray.emplaceBack(te+Ht[or],te+Ht[or+1],te+Ht[or+2]);H.vertexLength+=k,H.primitiveLength+=Ht.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,g,h)},pn("FillBucket",Ys,{omit:["layers","patternFeatures"]});var bf=new Jo({"fill-sort-key":new bn(ce.layout_fill["fill-sort-key"])}),Jf={paint:new Jo({"fill-antialias":new Mn(ce.paint_fill["fill-antialias"]),"fill-opacity":new bn(ce.paint_fill["fill-opacity"]),"fill-color":new bn(ce.paint_fill["fill-color"]),"fill-outline-color":new bn(ce.paint_fill["fill-outline-color"]),"fill-translate":new Mn(ce.paint_fill["fill-translate"]),"fill-translate-anchor":new Mn(ce.paint_fill["fill-translate-anchor"]),"fill-pattern":new zc(ce.paint_fill["fill-pattern"])}),layout:bf},Ph=function(t){function a(s){t.call(this,s,Jf)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.recalculate=function(s,h){t.prototype.recalculate.call(this,s,h);var g=this.paint._values["fill-outline-color"];g.value.kind==="constant"&&g.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},a.prototype.createBucket=function(s){return new Ys(s)},a.prototype.queryRadius=function(){return go(this.paint.get("fill-translate"))},a.prototype.queryIntersectsFeature=function(s,h,g,m,S,M,k){return au(Nu(s,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),M.angle,k),m)},a.prototype.isTileClipped=function(){return!0},a}(nu),Qf=Ta([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,eh=Qu;function Qu(t,a,s,h,g){this.properties={},this.extent=s,this.type=0,this._pbf=t,this._geometry=-1,this._keys=h,this._values=g,t.readFields(Wc,this,a)}function Wc(t,a,s){t==1?a.id=s.readVarint():t==2?function(h,g){for(var m=h.readVarint()+h.pos;h.pos<m;){var S=g._keys[h.readVarint()],M=g._values[h.readVarint()];g.properties[S]=M}}(s,a):t==3?a.type=s.readVarint():t==4&&(a._geometry=s.pos)}function ip(t){for(var a,s,h=0,g=0,m=t.length,S=m-1;g<m;S=g++)h+=((s=t[S]).x-(a=t[g]).x)*(a.y+s.y);return h}Qu.types=["Unknown","Point","LineString","Polygon"],Qu.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var a,s=t.readVarint()+t.pos,h=1,g=0,m=0,S=0,M=[];t.pos<s;){if(g<=0){var k=t.readVarint();h=7&k,g=k>>3}if(g--,h===1||h===2)m+=t.readSVarint(),S+=t.readSVarint(),h===1&&(a&&M.push(a),a=[]),a.push(new ne(m,S));else{if(h!==7)throw new Error("unknown command "+h);a&&a.push(a[0].clone())}}return a&&M.push(a),M},Qu.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var a=t.readVarint()+t.pos,s=1,h=0,g=0,m=0,S=1/0,M=-1/0,k=1/0,z=-1/0;t.pos<a;){if(h<=0){var V=t.readVarint();s=7&V,h=V>>3}if(h--,s===1||s===2)(g+=t.readSVarint())<S&&(S=g),g>M&&(M=g),(m+=t.readSVarint())<k&&(k=m),m>z&&(z=m);else if(s!==7)throw new Error("unknown command "+s)}return[S,k,M,z]},Qu.prototype.toGeoJSON=function(t,a,s){var h,g,m=this.extent*Math.pow(2,s),S=this.extent*t,M=this.extent*a,k=this.loadGeometry(),z=Qu.types[this.type];function V(se){for(var Me=0;Me<se.length;Me++){var Ie=se[Me];se[Me]=[360*(Ie.x+S)/m-180,360/Math.PI*Math.atan(Math.exp((180-360*(Ie.y+M)/m)*Math.PI/180))-90]}}switch(this.type){case 1:var H=[];for(h=0;h<k.length;h++)H[h]=k[h][0];V(k=H);break;case 2:for(h=0;h<k.length;h++)V(k[h]);break;case 3:for(k=function(se){var Me=se.length;if(Me<=1)return[se];for(var Ie,qe,ze=[],at=0;at<Me;at++){var bt=ip(se[at]);bt!==0&&(qe===void 0&&(qe=bt<0),qe===bt<0?(Ie&&ze.push(Ie),Ie=[se[at]]):Ie.push(se[at]))}return Ie&&ze.push(Ie),ze}(k),h=0;h<k.length;h++)for(g=0;g<k[h].length;g++)V(k[h][g])}k.length===1?k=k[0]:z="Multi"+z;var te={type:"Feature",geometry:{type:z,coordinates:k},properties:this.properties};return"id"in this&&(te.id=this.id),te};var th=Gp;function Gp(t,a){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(Ed,this,a),this.length=this._features.length}function Ed(t,a,s){t===15?a.version=s.readVarint():t===1?a.name=s.readString():t===5?a.extent=s.readVarint():t===2?a._features.push(s.pos):t===3?a._keys.push(s.readString()):t===4&&a._values.push(function(h){for(var g=null,m=h.readVarint()+h.pos;h.pos<m;){var S=h.readVarint()>>3;g=S===1?h.readString():S===2?h.readFloat():S===3?h.readDouble():S===4?h.readVarint64():S===5?h.readVarint():S===6?h.readSVarint():S===7?h.readBoolean():null}return g}(s))}function Sd(t,a,s){if(t===3){var h=new th(s,s.readVarint()+s.pos);h.length&&(a[h.name]=h)}}Gp.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var a=this._pbf.readVarint()+this._pbf.pos;return new eh(this._pbf,a,this.extent,this._keys,this._values)};var uu={VectorTile:function(t,a){this.layers=t.readFields(Sd,{},a)},VectorTileFeature:eh,VectorTileLayer:th},Ef=uu.VectorTileFeature.types,Ih=Math.pow(2,13);function xa(t,a,s,h,g,m,S,M){t.emplaceBack(a,s,2*Math.floor(h*Ih)+S,g*Ih*2,m*Ih*2,Math.round(M))}var Ss=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(a){return a.id}),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new du,this.indexArray=new ml,this.programConfigurations=new Wn(t.layers,t.zoom),this.segments=new fe,this.stateDependentLayerIds=this.layers.filter(function(a){return a.isStateDependent()}).map(function(a){return a.id})};function Hp(t,a){return t.x===a.x&&(t.x<0||t.x>8192)||t.y===a.y&&(t.y<0||t.y>8192)}Ss.prototype.populate=function(t,a,s){this.features=[],this.hasPattern=xf("fill-extrusion",this.layers,a);for(var h=0,g=t;h<g.length;h+=1){var m=g[h],S=m.feature,M=m.id,k=m.index,z=m.sourceLayerIndex,V=this.layers[0]._featureFilter.needGeometry,H=ro(S,V);if(this.layers[0]._featureFilter.filter(new Si(this.zoom),H,s)){var te={id:M,sourceLayerIndex:z,index:k,geometry:V?H.geometry:Za(S),properties:S.properties,type:S.type,patterns:{}};this.hasPattern?this.features.push(Hc("fill-extrusion",this.layers,te,this.zoom,a)):this.addFeature(te,te.geometry,k,s,{}),a.featureIndex.insert(S,te.geometry,k,z,this.index,!0)}}},Ss.prototype.addFeatures=function(t,a,s){for(var h=0,g=this.features;h<g.length;h+=1){var m=g[h];this.addFeature(m,m.geometry,m.index,a,s)}},Ss.prototype.update=function(t,a,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,a,this.stateDependentLayers,s)},Ss.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Ss.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Ss.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Qf),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},Ss.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Ss.prototype.addFeature=function(t,a,s,h,g){for(var m=0,S=$f(a,500);m<S.length;m+=1){for(var M=S[m],k=0,z=0,V=M;z<V.length;z+=1)k+=V[z].length;for(var H=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),te=0,se=M;te<se.length;te+=1){var Me=se[te];if(Me.length!==0&&!((Zi=Me).every(function(li){return li.x<0})||Zi.every(function(li){return li.x>8192})||Zi.every(function(li){return li.y<0})||Zi.every(function(li){return li.y>8192})))for(var Ie=0,qe=0;qe<Me.length;qe++){var ze=Me[qe];if(qe>=1){var at=Me[qe-1];if(!Hp(ze,at)){H.vertexLength+4>fe.MAX_VERTEX_ARRAY_LENGTH&&(H=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var bt=ze.sub(at)._perp()._unit(),Ut=at.dist(ze);Ie+Ut>32768&&(Ie=0),xa(this.layoutVertexArray,ze.x,ze.y,bt.x,bt.y,0,0,Ie),xa(this.layoutVertexArray,ze.x,ze.y,bt.x,bt.y,0,1,Ie),xa(this.layoutVertexArray,at.x,at.y,bt.x,bt.y,0,0,Ie+=Ut),xa(this.layoutVertexArray,at.x,at.y,bt.x,bt.y,0,1,Ie);var Ht=H.vertexLength;this.indexArray.emplaceBack(Ht,Ht+2,Ht+1),this.indexArray.emplaceBack(Ht+1,Ht+2,Ht+3),H.vertexLength+=4,H.primitiveLength+=2}}}}if(H.vertexLength+k>fe.MAX_VERTEX_ARRAY_LENGTH&&(H=this.segments.prepareSegment(k,this.layoutVertexArray,this.indexArray)),Ef[t.type]==="Polygon"){for(var or=[],Ar=[],Vr=H.vertexLength,kn=0,an=M;kn<an.length;kn+=1){var zn=an[kn];if(zn.length!==0){zn!==M[0]&&Ar.push(or.length/2);for(var ln=0;ln<zn.length;ln++){var Pi=zn[ln];xa(this.layoutVertexArray,Pi.x,Pi.y,0,0,1,1,0),or.push(Pi.x),or.push(Pi.y)}}}for(var ti=mc(or,Ar),Sn=0;Sn<ti.length;Sn+=3)this.indexArray.emplaceBack(Vr+ti[Sn],Vr+ti[Sn+2],Vr+ti[Sn+1]);H.primitiveLength+=ti.length/3,H.vertexLength+=k}}var Zi;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,g,h)},pn("FillExtrusionBucket",Ss,{omit:["layers","features"]});var wd={paint:new Jo({"fill-extrusion-opacity":new Mn(ce["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new bn(ce["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Mn(ce["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Mn(ce["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new zc(ce["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new bn(ce["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new bn(ce["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Mn(ce["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},el=function(t){function a(s){t.call(this,s,wd)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.createBucket=function(s){return new Ss(s)},a.prototype.queryRadius=function(){return go(this.paint.get("fill-extrusion-translate"))},a.prototype.is3D=function(){return!0},a.prototype.queryIntersectsFeature=function(s,h,g,m,S,M,k,z){var V=Nu(s,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),M.angle,k),H=this.paint.get("fill-extrusion-height").evaluate(h,g),te=this.paint.get("fill-extrusion-base").evaluate(h,g),se=function(Ie,qe,ze,at){for(var bt=[],Ut=0,Ht=Ie;Ut<Ht.length;Ut+=1){var or=Ht[Ut],Ar=[or.x,or.y,0,1];jc(Ar,Ar,qe),bt.push(new ne(Ar[0]/Ar[3],Ar[1]/Ar[3]))}return bt}(V,z),Me=function(Ie,qe,ze,at){for(var bt=[],Ut=[],Ht=at[8]*qe,or=at[9]*qe,Ar=at[10]*qe,Vr=at[11]*qe,kn=at[8]*ze,an=at[9]*ze,zn=at[10]*ze,ln=at[11]*ze,Pi=0,ti=Ie;Pi<ti.length;Pi+=1){for(var Sn=[],Zi=[],li=0,na=ti[Pi];li<na.length;li+=1){var Vn=na[li],Qi=Vn.x,Ka=Vn.y,vo=at[0]*Qi+at[4]*Ka+at[12],lo=at[1]*Qi+at[5]*Ka+at[13],ja=at[2]*Qi+at[6]*Ka+at[14],mo=at[3]*Qi+at[7]*Ka+at[15],Yo=ja+Ar,zo=mo+Vr,qs=vo+kn,cs=lo+an,Bs=ja+zn,xo=mo+ln,fs=new ne((vo+Ht)/zo,(lo+or)/zo);fs.z=Yo/zo,Sn.push(fs);var Hi=new ne(qs/xo,cs/xo);Hi.z=Bs/xo,Zi.push(Hi)}bt.push(Sn),Ut.push(Zi)}return[bt,Ut]}(m,te,H,z);return function(Ie,qe,ze){var at=1/0;au(ze,qe)&&(at=xc(ze,qe[0]));for(var bt=0;bt<qe.length;bt++)for(var Ut=qe[bt],Ht=Ie[bt],or=0;or<Ut.length-1;or++){var Ar=Ut[or],Vr=[Ar,Ut[or+1],Ht[or+1],Ht[or],Ar];Du(ze,Vr)&&(at=Math.min(at,xc(ze,Vr)))}return at!==1/0&&at}(Me[0],Me[1],se)},a}(nu);function Sf(t,a){return t.x*a.x+t.y*a.y}function xc(t,a){if(t.length===1){for(var s,h=0,g=a[h++];!s||g.equals(s);)if(!(s=a[h++]))return 1/0;for(;h<a.length;h++){var m=a[h],S=t[0],M=s.sub(g),k=m.sub(g),z=S.sub(g),V=Sf(M,M),H=Sf(M,k),te=Sf(k,k),se=Sf(z,M),Me=Sf(z,k),Ie=V*te-H*H,qe=(te*se-H*Me)/Ie,ze=(V*Me-H*se)/Ie,at=g.z*(1-qe-ze)+s.z*qe+m.z*ze;if(isFinite(at))return at}return 1/0}for(var bt=1/0,Ut=0,Ht=a;Ut<Ht.length;Ut+=1)bt=Math.min(bt,Ht[Ut].z);return bt}var bc=Ta([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,rh=Ta([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,ap=uu.VectorTileFeature.types,Oh=Math.cos(Math.PI/180*37.5),zu=Math.pow(2,14)/.5,ra=function(t){var a=this;this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(s){return s.id}),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(s){a.gradients[s.id]={}}),this.layoutVertexArray=new ko,this.layoutVertexArray2=new Lu,this.indexArray=new ml,this.programConfigurations=new Wn(t.layers,t.zoom),this.segments=new fe,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(s){return s.isStateDependent()}).map(function(s){return s.id})};ra.prototype.populate=function(t,a,s){this.hasPattern=xf("line",this.layers,a);for(var h=this.layers[0].layout.get("line-sort-key"),g=[],m=0,S=t;m<S.length;m+=1){var M=S[m],k=M.feature,z=M.id,V=M.index,H=M.sourceLayerIndex,te=this.layers[0]._featureFilter.needGeometry,se=ro(k,te);if(this.layers[0]._featureFilter.filter(new Si(this.zoom),se,s)){var Me=h?h.evaluate(se,{},s):void 0,Ie={id:z,properties:k.properties,type:k.type,sourceLayerIndex:H,index:V,geometry:te?se.geometry:Za(k),patterns:{},sortKey:Me};g.push(Ie)}}h&&g.sort(function(Ar,Vr){return Ar.sortKey-Vr.sortKey});for(var qe=0,ze=g;qe<ze.length;qe+=1){var at=ze[qe],bt=at.geometry,Ut=at.index,Ht=at.sourceLayerIndex;if(this.hasPattern){var or=Hc("line",this.layers,at,this.zoom,a);this.patternFeatures.push(or)}else this.addFeature(at,bt,Ut,s,{});a.featureIndex.insert(t[Ut].feature,bt,Ut,Ht,this.index)}},ra.prototype.update=function(t,a,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,a,this.stateDependentLayers,s)},ra.prototype.addFeatures=function(t,a,s){for(var h=0,g=this.patternFeatures;h<g.length;h+=1){var m=g[h];this.addFeature(m,m.geometry,m.index,a,s)}},ra.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},ra.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},ra.prototype.upload=function(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,rh)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,bc),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},ra.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},ra.prototype.lineFeatureClips=function(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}},ra.prototype.addFeature=function(t,a,s,h,g){var m=this.layers[0].layout,S=m.get("line-join").evaluate(t,{}),M=m.get("line-cap"),k=m.get("line-miter-limit"),z=m.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(var V=0,H=a;V<H.length;V+=1)this.addLine(H[V],t,S,M,k,z);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,g,h)},ra.prototype.addLine=function(t,a,s,h,g,m){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var S=0;S<t.length-1;S++)this.totalDistance+=t[S].dist(t[S+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var M=ap[a.type]==="Polygon",k=t.length;k>=2&&t[k-1].equals(t[k-2]);)k--;for(var z=0;z<k-1&&t[z].equals(t[z+1]);)z++;if(!(k<(M?3:2))){s==="bevel"&&(g=1.05);var V,H=this.overscaling<=16?122880/(512*this.overscaling):0,te=this.segments.prepareSegment(10*k,this.layoutVertexArray,this.indexArray),se=void 0,Me=void 0,Ie=void 0,qe=void 0;this.e1=this.e2=-1,M&&(qe=t[z].sub(V=t[k-2])._unit()._perp());for(var ze=z;ze<k;ze++)if(!(Me=ze===k-1?M?t[z+1]:void 0:t[ze+1])||!t[ze].equals(Me)){qe&&(Ie=qe),V&&(se=V),V=t[ze],qe=Me?Me.sub(V)._unit()._perp():Ie;var at=(Ie=Ie||qe).add(qe);at.x===0&&at.y===0||at._unit();var bt=Ie.x*qe.x+Ie.y*qe.y,Ut=at.x*qe.x+at.y*qe.y,Ht=Ut!==0?1/Ut:1/0,or=2*Math.sqrt(2-2*Ut),Ar=Ut<Oh&&se&&Me,Vr=Ie.x*qe.y-Ie.y*qe.x>0;if(Ar&&ze>z){var kn=V.dist(se);if(kn>2*H){var an=V.sub(V.sub(se)._mult(H/kn)._round());this.updateDistance(se,an),this.addCurrentVertex(an,Ie,0,0,te),se=an}}var zn=se&&Me,ln=zn?s:M?"butt":h;if(zn&&ln==="round"&&(Ht<m?ln="miter":Ht<=2&&(ln="fakeround")),ln==="miter"&&Ht>g&&(ln="bevel"),ln==="bevel"&&(Ht>2&&(ln="flipbevel"),Ht<g&&(ln="miter")),se&&this.updateDistance(se,V),ln==="miter")at._mult(Ht),this.addCurrentVertex(V,at,0,0,te);else if(ln==="flipbevel"){if(Ht>100)at=qe.mult(-1);else{var Pi=Ht*Ie.add(qe).mag()/Ie.sub(qe).mag();at._perp()._mult(Pi*(Vr?-1:1))}this.addCurrentVertex(V,at,0,0,te),this.addCurrentVertex(V,at.mult(-1),0,0,te)}else if(ln==="bevel"||ln==="fakeround"){var ti=-Math.sqrt(Ht*Ht-1),Sn=Vr?ti:0,Zi=Vr?0:ti;if(se&&this.addCurrentVertex(V,Ie,Sn,Zi,te),ln==="fakeround")for(var li=Math.round(180*or/Math.PI/20),na=1;na<li;na++){var Vn=na/li;if(Vn!==.5){var Qi=Vn-.5;Vn+=Vn*Qi*(Vn-1)*((1.0904+bt*(bt*(3.55645-1.43519*bt)-3.2452))*Qi*Qi+(.848013+bt*(.215638*bt-1.06021)))}var Ka=qe.sub(Ie)._mult(Vn)._add(Ie)._unit()._mult(Vr?-1:1);this.addHalfVertex(V,Ka.x,Ka.y,!1,Vr,0,te)}Me&&this.addCurrentVertex(V,qe,-Sn,-Zi,te)}else if(ln==="butt")this.addCurrentVertex(V,at,0,0,te);else if(ln==="square"){var vo=se?1:-1;this.addCurrentVertex(V,at,vo,vo,te)}else ln==="round"&&(se&&(this.addCurrentVertex(V,Ie,0,0,te),this.addCurrentVertex(V,Ie,1,1,te,!0)),Me&&(this.addCurrentVertex(V,qe,-1,-1,te,!0),this.addCurrentVertex(V,qe,0,0,te)));if(Ar&&ze<k-1){var lo=V.dist(Me);if(lo>2*H){var ja=V.add(Me.sub(V)._mult(H/lo)._round());this.updateDistance(V,ja),this.addCurrentVertex(ja,qe,0,0,te),V=ja}}}}},ra.prototype.addCurrentVertex=function(t,a,s,h,g,m){m===void 0&&(m=!1);var S=a.y*h-a.x,M=-a.y-a.x*h;this.addHalfVertex(t,a.x+a.y*s,a.y-a.x*s,m,!1,s,g),this.addHalfVertex(t,S,M,m,!0,-h,g),this.distance>zu/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(t,a,s,h,g,m))},ra.prototype.addHalfVertex=function(t,a,s,h,g,m,S){var M=.5*(this.lineClips?this.scaledDistance*(zu-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t.x<<1)+(h?1:0),(t.y<<1)+(g?1:0),Math.round(63*a)+128,Math.round(63*s)+128,1+(m===0?0:m<0?-1:1)|(63&M)<<2,M>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var k=S.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,k),S.primitiveLength++),g?this.e2=k:this.e1=k},ra.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},ra.prototype.updateDistance=function(t,a){this.distance+=t.dist(a),this.updateScaledDistance()},pn("LineBucket",ra,{omit:["layers","patternFeatures"]});var Uu=new Jo({"line-cap":new Mn(ce.layout_line["line-cap"]),"line-join":new bn(ce.layout_line["line-join"]),"line-miter-limit":new Mn(ce.layout_line["line-miter-limit"]),"line-round-limit":new Mn(ce.layout_line["line-round-limit"]),"line-sort-key":new bn(ce.layout_line["line-sort-key"])}),To={paint:new Jo({"line-opacity":new bn(ce.paint_line["line-opacity"]),"line-color":new bn(ce.paint_line["line-color"]),"line-translate":new Mn(ce.paint_line["line-translate"]),"line-translate-anchor":new Mn(ce.paint_line["line-translate-anchor"]),"line-width":new bn(ce.paint_line["line-width"]),"line-gap-width":new bn(ce.paint_line["line-gap-width"]),"line-offset":new bn(ce.paint_line["line-offset"]),"line-blur":new bn(ce.paint_line["line-blur"]),"line-dasharray":new is(ce.paint_line["line-dasharray"]),"line-pattern":new zc(ce.paint_line["line-pattern"]),"line-gradient":new as(ce.paint_line["line-gradient"])}),layout:Uu},ws=new(function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.possiblyEvaluate=function(s,h){return h=new Si(Math.floor(h.zoom),{now:h.now,fadeDuration:h.fadeDuration,zoomHistory:h.zoomHistory,transition:h.transition}),t.prototype.possiblyEvaluate.call(this,s,h)},a.prototype.evaluate=function(s,h,g,m){return h=pt({},h,{zoom:Math.floor(h.zoom)}),t.prototype.evaluate.call(this,s,h,g,m)},a}(bn))(To.paint.properties["line-width"].specification);ws.useIntegerZoom=!0;var Rh=function(t){function a(s){t.call(this,s,To),this.gradientVersion=0}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._handleSpecialPaintPropertyUpdate=function(s){s==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof ms,this.gradientVersion=(this.gradientVersion+1)%Ne)},a.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},a.prototype.recalculate=function(s,h){t.prototype.recalculate.call(this,s,h),this.paint._values["line-floorwidth"]=ws.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,s)},a.prototype.createBucket=function(s){return new ra(s)},a.prototype.queryRadius=function(s){var h=s,g=Lh(mu("line-width",this,h),mu("line-gap-width",this,h)),m=mu("line-offset",this,h);return g/2+Math.abs(m)+go(this.paint.get("line-translate"))},a.prototype.queryIntersectsFeature=function(s,h,g,m,S,M,k){var z=Nu(s,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),M.angle,k),V=k/2*Lh(this.paint.get("line-width").evaluate(h,g),this.paint.get("line-gap-width").evaluate(h,g)),H=this.paint.get("line-offset").evaluate(h,g);return H&&(m=function(te,se){for(var Me=[],Ie=new ne(0,0),qe=0;qe<te.length;qe++){for(var ze=te[qe],at=[],bt=0;bt<ze.length;bt++){var Ut=ze[bt],Ht=ze[bt+1],or=bt===0?Ie:Ut.sub(ze[bt-1])._unit()._perp(),Ar=bt===ze.length-1?Ie:Ht.sub(Ut)._unit()._perp(),Vr=or._add(Ar)._unit();Vr._mult(1/(Vr.x*Ar.x+Vr.y*Ar.y)),at.push(Vr._mult(se)._add(Ut))}Me.push(at)}return Me}(m,H*k)),function(te,se,Me){for(var Ie=0;Ie<se.length;Ie++){var qe=se[Ie];if(te.length>=3){for(var ze=0;ze<qe.length;ze++)if(ou(te,qe[ze]))return!0}if(Ns(te,qe,Me))return!0}return!1}(z,m,V)},a.prototype.isTileClipped=function(){return!0},a}(nu);function Lh(t,a){return a>0?a+2*t:t}var Wp=Ta([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Cd=Ta([{name:"a_projected_pos",components:3,type:"Float32"}],4),Td=(Ta([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),Ta([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),op=(Ta([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),Ta([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),Ad=Ta([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Md(t,a,s){return t.sections.forEach(function(h){h.text=function(g,m,S){var M=m.layout.get("text-transform").evaluate(S,{});return M==="uppercase"?g=g.toLocaleUpperCase():M==="lowercase"&&(g=g.toLocaleLowerCase()),Rs.applyArabicShaping&&(g=Rs.applyArabicShaping(g)),g}(h.text,a,s)}),t}Ta([{name:"triangle",components:3,type:"Uint16"}]),Ta([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Ta([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Ta([{type:"Float32",name:"offsetX"}]),Ta([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var wf={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"},Xp=function(t,a,s,h,g){var m,S,M=8*g-h-1,k=(1<<M)-1,z=k>>1,V=-7,H=s?g-1:0,te=s?-1:1,se=t[a+H];for(H+=te,m=se&(1<<-V)-1,se>>=-V,V+=M;V>0;m=256*m+t[a+H],H+=te,V-=8);for(S=m&(1<<-V)-1,m>>=-V,V+=h;V>0;S=256*S+t[a+H],H+=te,V-=8);if(m===0)m=1-z;else{if(m===k)return S?NaN:1/0*(se?-1:1);S+=Math.pow(2,h),m-=z}return(se?-1:1)*S*Math.pow(2,m-h)},Yp=function(t,a,s,h,g,m){var S,M,k,z=8*m-g-1,V=(1<<z)-1,H=V>>1,te=g===23?Math.pow(2,-24)-Math.pow(2,-77):0,se=h?0:m-1,Me=h?1:-1,Ie=a<0||a===0&&1/a<0?1:0;for(a=Math.abs(a),isNaN(a)||a===1/0?(M=isNaN(a)?1:0,S=V):(S=Math.floor(Math.log(a)/Math.LN2),a*(k=Math.pow(2,-S))<1&&(S--,k*=2),(a+=S+H>=1?te/k:te*Math.pow(2,1-H))*k>=2&&(S++,k/=2),S+H>=V?(M=0,S=V):S+H>=1?(M=(a*k-1)*Math.pow(2,g),S+=H):(M=a*Math.pow(2,H-1)*Math.pow(2,g),S=0));g>=8;t[s+se]=255&M,se+=Me,M/=256,g-=8);for(S=S<<g|M,z+=g;z>0;t[s+se]=255&S,se+=Me,S/=256,z-=8);t[s+se-Me]|=128*Ie},Cf=Ia;function Ia(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}Ia.Varint=0,Ia.Fixed64=1,Ia.Bytes=2,Ia.Fixed32=5;var sp=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function jl(t){return t.type===Ia.Bytes?t.readVarint()+t.pos:t.pos+1}function Tf(t,a,s){return s?4294967296*a+(t>>>0):4294967296*(a>>>0)+(t>>>0)}function up(t,a,s){var h=a<=16383?1:a<=2097151?2:a<=268435455?3:Math.floor(Math.log(a)/(7*Math.LN2));s.realloc(h);for(var g=s.pos-1;g>=t;g--)s.buf[g+h]=s.buf[g]}function qp(t,a){for(var s=0;s<t.length;s++)a.writeVarint(t[s])}function B(t,a){for(var s=0;s<t.length;s++)a.writeSVarint(t[s])}function ve(t,a){for(var s=0;s<t.length;s++)a.writeFloat(t[s])}function Be(t,a){for(var s=0;s<t.length;s++)a.writeDouble(t[s])}function It(t,a){for(var s=0;s<t.length;s++)a.writeBoolean(t[s])}function ar(t,a){for(var s=0;s<t.length;s++)a.writeFixed32(t[s])}function Pt(t,a){for(var s=0;s<t.length;s++)a.writeSFixed32(t[s])}function Qt(t,a){for(var s=0;s<t.length;s++)a.writeFixed64(t[s])}function lr(t,a){for(var s=0;s<t.length;s++)a.writeSFixed64(t[s])}function vr(t,a){return(t[a]|t[a+1]<<8|t[a+2]<<16)+16777216*t[a+3]}function yr(t,a,s){t[s]=a,t[s+1]=a>>>8,t[s+2]=a>>>16,t[s+3]=a>>>24}function Cr(t,a){return(t[a]|t[a+1]<<8|t[a+2]<<16)+(t[a+3]<<24)}function Tr(t,a,s){t===1&&s.readMessage(Ur,a)}function Ur(t,a,s){if(t===3){var h=s.readMessage(gr,{}),g=h.width,m=h.height,S=h.left,M=h.top,k=h.advance;a.push({id:h.id,bitmap:new yu({width:g+6,height:m+6},h.bitmap),metrics:{width:g,height:m,left:S,top:M,advance:k}})}}function gr(t,a,s){t===1?a.id=s.readVarint():t===2?a.bitmap=s.readBytes():t===3?a.width=s.readVarint():t===4?a.height=s.readVarint():t===5?a.left=s.readSVarint():t===6?a.top=s.readSVarint():t===7&&(a.advance=s.readVarint())}function Sr(t){for(var a=0,s=0,h=0,g=t;h<g.length;h+=1){var m=g[h];a+=m.w*m.h,s=Math.max(s,m.w)}t.sort(function(Ie,qe){return qe.h-Ie.h});for(var S=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(a/.95)),s),h:1/0}],M=0,k=0,z=0,V=t;z<V.length;z+=1)for(var H=V[z],te=S.length-1;te>=0;te--){var se=S[te];if(!(H.w>se.w||H.h>se.h)){if(H.x=se.x,H.y=se.y,k=Math.max(k,H.y+H.h),M=Math.max(M,H.x+H.w),H.w===se.w&&H.h===se.h){var Me=S.pop();te<S.length&&(S[te]=Me)}else H.h===se.h?(se.x+=H.w,se.w-=H.w):H.w===se.w?(se.y+=H.h,se.h-=H.h):(S.push({x:se.x+H.w,y:se.y,w:se.w-H.w,h:H.h}),se.y+=H.h,se.h-=H.h);break}}return{w:M,h:k,fill:a/(M*k)||0}}Ia.prototype={destroy:function(){this.buf=null},readFields:function(t,a,s){for(s=s||this.length;this.pos<s;){var h=this.readVarint(),g=h>>3,m=this.pos;this.type=7&h,t(g,a,this),this.pos===m&&this.skip(h)}return a},readMessage:function(t,a){return this.readFields(t,a,this.readVarint()+this.pos)},readFixed32:function(){var t=vr(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=Cr(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=vr(this.buf,this.pos)+4294967296*vr(this.buf,this.pos+4);return this.pos+=8,t},readSFixed64:function(){var t=vr(this.buf,this.pos)+4294967296*Cr(this.buf,this.pos+4);return this.pos+=8,t},readFloat:function(){var t=Xp(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=Xp(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var a,s,h=this.buf;return a=127&(s=h[this.pos++]),s<128?a:(a|=(127&(s=h[this.pos++]))<<7,s<128?a:(a|=(127&(s=h[this.pos++]))<<14,s<128?a:(a|=(127&(s=h[this.pos++]))<<21,s<128?a:function(g,m,S){var M,k,z=S.buf;if(M=(112&(k=z[S.pos++]))>>4,k<128||(M|=(127&(k=z[S.pos++]))<<3,k<128)||(M|=(127&(k=z[S.pos++]))<<10,k<128)||(M|=(127&(k=z[S.pos++]))<<17,k<128)||(M|=(127&(k=z[S.pos++]))<<24,k<128)||(M|=(1&(k=z[S.pos++]))<<31,k<128))return Tf(g,M,m);throw new Error("Expected varint not more than 10 bytes")}(a|=(15&(s=h[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,a=this.pos;return this.pos=t,t-a>=12&&sp?function(s,h,g){return sp.decode(s.subarray(h,g))}(this.buf,a,t):function(s,h,g){for(var m="",S=h;S<g;){var M,k,z,V=s[S],H=null,te=V>239?4:V>223?3:V>191?2:1;if(S+te>g)break;te===1?V<128&&(H=V):te===2?(192&(M=s[S+1]))==128&&(H=(31&V)<<6|63&M)<=127&&(H=null):te===3?(k=s[S+2],(192&(M=s[S+1]))==128&&(192&k)==128&&((H=(15&V)<<12|(63&M)<<6|63&k)<=2047||H>=55296&&H<=57343)&&(H=null)):te===4&&(k=s[S+2],z=s[S+3],(192&(M=s[S+1]))==128&&(192&k)==128&&(192&z)==128&&((H=(15&V)<<18|(63&M)<<12|(63&k)<<6|63&z)<=65535||H>=1114112)&&(H=null)),H===null?(H=65533,te=1):H>65535&&(H-=65536,m+=String.fromCharCode(H>>>10&1023|55296),H=56320|1023&H),m+=String.fromCharCode(H),S+=te}return m}(this.buf,a,t)},readBytes:function(){var t=this.readVarint()+this.pos,a=this.buf.subarray(this.pos,t);return this.pos=t,a},readPackedVarint:function(t,a){if(this.type!==Ia.Bytes)return t.push(this.readVarint(a));var s=jl(this);for(t=t||[];this.pos<s;)t.push(this.readVarint(a));return t},readPackedSVarint:function(t){if(this.type!==Ia.Bytes)return t.push(this.readSVarint());var a=jl(this);for(t=t||[];this.pos<a;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==Ia.Bytes)return t.push(this.readBoolean());var a=jl(this);for(t=t||[];this.pos<a;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==Ia.Bytes)return t.push(this.readFloat());var a=jl(this);for(t=t||[];this.pos<a;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==Ia.Bytes)return t.push(this.readDouble());var a=jl(this);for(t=t||[];this.pos<a;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==Ia.Bytes)return t.push(this.readFixed32());var a=jl(this);for(t=t||[];this.pos<a;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==Ia.Bytes)return t.push(this.readSFixed32());var a=jl(this);for(t=t||[];this.pos<a;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==Ia.Bytes)return t.push(this.readFixed64());var a=jl(this);for(t=t||[];this.pos<a;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==Ia.Bytes)return t.push(this.readSFixed64());var a=jl(this);for(t=t||[];this.pos<a;)t.push(this.readSFixed64());return t},skip:function(t){var a=7&t;if(a===Ia.Varint)for(;this.buf[this.pos++]>127;);else if(a===Ia.Bytes)this.pos=this.readVarint()+this.pos;else if(a===Ia.Fixed32)this.pos+=4;else{if(a!==Ia.Fixed64)throw new Error("Unimplemented type: "+a);this.pos+=8}},writeTag:function(t,a){this.writeVarint(t<<3|a)},realloc:function(t){for(var a=this.length||16;a<this.pos+t;)a*=2;if(a!==this.length){var s=new Uint8Array(a);s.set(this.buf),this.buf=s,this.length=a}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),yr(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),yr(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),yr(this.buf,-1&t,this.pos),yr(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),yr(this.buf,-1&t,this.pos),yr(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(a,s){var h,g;if(a>=0?(h=a%4294967296|0,g=a/4294967296|0):(g=~(-a/4294967296),4294967295^(h=~(-a%4294967296))?h=h+1|0:(h=0,g=g+1|0)),a>=18446744073709552e3||a<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");s.realloc(10),function(m,S,M){M.buf[M.pos++]=127&m|128,m>>>=7,M.buf[M.pos++]=127&m|128,m>>>=7,M.buf[M.pos++]=127&m|128,m>>>=7,M.buf[M.pos++]=127&m|128,M.buf[M.pos]=127&(m>>>=7)}(h,0,s),function(m,S){var M=(7&m)<<4;S.buf[S.pos++]|=M|((m>>>=3)?128:0),m&&(S.buf[S.pos++]=127&m|((m>>>=7)?128:0),m&&(S.buf[S.pos++]=127&m|((m>>>=7)?128:0),m&&(S.buf[S.pos++]=127&m|((m>>>=7)?128:0),m&&(S.buf[S.pos++]=127&m|((m>>>=7)?128:0),m&&(S.buf[S.pos++]=127&m)))))}(g,s)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var a=this.pos;this.pos=function(h,g,m){for(var S,M,k=0;k<g.length;k++){if((S=g.charCodeAt(k))>55295&&S<57344){if(!M){S>56319||k+1===g.length?(h[m++]=239,h[m++]=191,h[m++]=189):M=S;continue}if(S<56320){h[m++]=239,h[m++]=191,h[m++]=189,M=S;continue}S=M-55296<<10|S-56320|65536,M=null}else M&&(h[m++]=239,h[m++]=191,h[m++]=189,M=null);S<128?h[m++]=S:(S<2048?h[m++]=S>>6|192:(S<65536?h[m++]=S>>12|224:(h[m++]=S>>18|240,h[m++]=S>>12&63|128),h[m++]=S>>6&63|128),h[m++]=63&S|128)}return m}(this.buf,t,this.pos);var s=this.pos-a;s>=128&&up(a,s,this),this.pos=a-1,this.writeVarint(s),this.pos+=s},writeFloat:function(t){this.realloc(4),Yp(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),Yp(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var a=t.length;this.writeVarint(a),this.realloc(a);for(var s=0;s<a;s++)this.buf[this.pos++]=t[s]},writeRawMessage:function(t,a){this.pos++;var s=this.pos;t(a,this);var h=this.pos-s;h>=128&&up(s,h,this),this.pos=s-1,this.writeVarint(h),this.pos+=h},writeMessage:function(t,a,s){this.writeTag(t,Ia.Bytes),this.writeRawMessage(a,s)},writePackedVarint:function(t,a){a.length&&this.writeMessage(t,qp,a)},writePackedSVarint:function(t,a){a.length&&this.writeMessage(t,B,a)},writePackedBoolean:function(t,a){a.length&&this.writeMessage(t,It,a)},writePackedFloat:function(t,a){a.length&&this.writeMessage(t,ve,a)},writePackedDouble:function(t,a){a.length&&this.writeMessage(t,Be,a)},writePackedFixed32:function(t,a){a.length&&this.writeMessage(t,ar,a)},writePackedSFixed32:function(t,a){a.length&&this.writeMessage(t,Pt,a)},writePackedFixed64:function(t,a){a.length&&this.writeMessage(t,Qt,a)},writePackedSFixed64:function(t,a){a.length&&this.writeMessage(t,lr,a)},writeBytesField:function(t,a){this.writeTag(t,Ia.Bytes),this.writeBytes(a)},writeFixed32Field:function(t,a){this.writeTag(t,Ia.Fixed32),this.writeFixed32(a)},writeSFixed32Field:function(t,a){this.writeTag(t,Ia.Fixed32),this.writeSFixed32(a)},writeFixed64Field:function(t,a){this.writeTag(t,Ia.Fixed64),this.writeFixed64(a)},writeSFixed64Field:function(t,a){this.writeTag(t,Ia.Fixed64),this.writeSFixed64(a)},writeVarintField:function(t,a){this.writeTag(t,Ia.Varint),this.writeVarint(a)},writeSVarintField:function(t,a){this.writeTag(t,Ia.Varint),this.writeSVarint(a)},writeStringField:function(t,a){this.writeTag(t,Ia.Bytes),this.writeString(a)},writeFloatField:function(t,a){this.writeTag(t,Ia.Fixed32),this.writeFloat(a)},writeDoubleField:function(t,a){this.writeTag(t,Ia.Fixed64),this.writeDouble(a)},writeBooleanField:function(t,a){this.writeVarintField(t,Boolean(a))}};var ut=function(t,a){var s=a.pixelRatio,h=a.version,g=a.stretchX,m=a.stretchY,S=a.content;this.paddedRect=t,this.pixelRatio=s,this.stretchX=g,this.stretchY=m,this.content=S,this.version=h},jt={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};jt.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},jt.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},jt.tlbr.get=function(){return this.tl.concat(this.br)},jt.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(ut.prototype,jt);var _r=function(t,a){var s={},h={};this.haveRenderCallbacks=[];var g=[];this.addImages(t,s,g),this.addImages(a,h,g);var m=Sr(g),S=new wo({width:m.w||1,height:m.h||1});for(var M in t){var k=t[M],z=s[M].paddedRect;wo.copy(k.data,S,{x:0,y:0},{x:z.x+1,y:z.y+1},k.data)}for(var V in a){var H=a[V],te=h[V].paddedRect,se=te.x+1,Me=te.y+1,Ie=H.data.width,qe=H.data.height;wo.copy(H.data,S,{x:0,y:0},{x:se,y:Me},H.data),wo.copy(H.data,S,{x:0,y:qe-1},{x:se,y:Me-1},{width:Ie,height:1}),wo.copy(H.data,S,{x:0,y:0},{x:se,y:Me+qe},{width:Ie,height:1}),wo.copy(H.data,S,{x:Ie-1,y:0},{x:se-1,y:Me},{width:1,height:qe}),wo.copy(H.data,S,{x:0,y:0},{x:se+Ie,y:Me},{width:1,height:qe})}this.image=S,this.iconPositions=s,this.patternPositions=h};_r.prototype.addImages=function(t,a,s){for(var h in t){var g=t[h],m={x:0,y:0,w:g.data.width+2,h:g.data.height+2};s.push(m),a[h]=new ut(m,g),g.hasRenderCallback&&this.haveRenderCallbacks.push(h)}},_r.prototype.patchUpdatedImages=function(t,a){for(var s in t.dispatchRenderCallbacks(this.haveRenderCallbacks),t.updatedImages)this.patchUpdatedImage(this.iconPositions[s],t.getImage(s),a),this.patchUpdatedImage(this.patternPositions[s],t.getImage(s),a)},_r.prototype.patchUpdatedImage=function(t,a,s){if(t&&a&&t.version!==a.version){t.version=a.version;var h=t.tl;s.update(a.data,void 0,{x:h[0],y:h[1]})}},pn("ImagePosition",ut),pn("ImageAtlas",_r);var kr={horizontal:1,vertical:2,horizontalOnly:3},ur=function(){this.scale=1,this.fontStack="",this.imageName=null};ur.forText=function(t,a){var s=new ur;return s.scale=t||1,s.fontStack=a,s},ur.forImage=function(t){var a=new ur;return a.imageName=t,a};var Rr=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function qr(t,a,s,h,g,m,S,M,k,z,V,H,te,se,Me,Ie){var qe,ze=Rr.fromFeature(t,g);H===kr.vertical&&ze.verticalizePunctuation();var at=Rs.processBidirectionalText,bt=Rs.processStyledBidirectionalText;if(at&&ze.sections.length===1){qe=[];for(var Ut=0,Ht=at(ze.toString(),Wr(ze,z,m,a,h,se,Me));Ut<Ht.length;Ut+=1){var or=Ht[Ut],Ar=new Rr;Ar.text=or,Ar.sections=ze.sections;for(var Vr=0;Vr<or.length;Vr++)Ar.sectionIndex.push(0);qe.push(Ar)}}else if(bt){qe=[];for(var kn=0,an=bt(ze.text,ze.sectionIndex,Wr(ze,z,m,a,h,se,Me));kn<an.length;kn+=1){var zn=an[kn],ln=new Rr;ln.text=zn[0],ln.sectionIndex=zn[1],ln.sections=ze.sections,qe.push(ln)}}else qe=function(Sn,Zi){for(var li=[],na=Sn.text,Vn=0,Qi=0,Ka=Zi;Qi<Ka.length;Qi+=1){var vo=Ka[Qi];li.push(Sn.substring(Vn,vo)),Vn=vo}return Vn<na.length&&li.push(Sn.substring(Vn,na.length)),li}(ze,Wr(ze,z,m,a,h,se,Me));var Pi=[],ti={positionedLines:Pi,text:ze.toString(),top:V[1],bottom:V[1],left:V[0],right:V[0],writingMode:H,iconsInText:!1,verticalizable:!1};return function(Sn,Zi,li,na,Vn,Qi,Ka,vo,lo,ja,mo,Yo){for(var zo=0,qs=-17,cs=0,Bs=0,xo=vo==="right"?1:vo==="left"?0:.5,fs=0,Hi=0,Oa=Vn;Hi<Oa.length;Hi+=1){var Sa=Oa[Hi];Sa.trim();var ia=Sa.getMaxScale(),zs=24*(ia-1),Ts={positionedGlyphs:[],lineOffset:0};Sn.positionedLines[fs]=Ts;var Ga=Ts.positionedGlyphs,Mo=0;if(Sa.length()){for(var As=0;As<Sa.length();As++){var da=Sa.getSection(As),Wl=Sa.getSectionIndex(As),_u=Sa.getCharCode(As),Xl=0,bo=null,Yl=null,il=null,ih=24,qo=!(lo===kr.horizontal||!mo&&!lf(_u)||mo&&(Nn[_u]||(Sc=_u,zr.Arabic(Sc)||zr["Arabic Supplement"](Sc)||zr["Arabic Extended-A"](Sc)||zr["Arabic Presentation Forms-A"](Sc)||zr["Arabic Presentation Forms-B"](Sc))));if(da.imageName){var ah=na[da.imageName];if(!ah)continue;il=da.imageName,Sn.iconsInText=Sn.iconsInText||!0,Yl=ah.paddedRect;var Ec=ah.displaySize;da.scale=24*da.scale/Yo,Xl=zs+(24-Ec[1]*da.scale),ih=(bo={width:Ec[0],height:Ec[1],left:1,top:-3,advance:qo?Ec[1]:Ec[0]}).advance;var oh=qo?Ec[0]*da.scale-24*ia:Ec[1]*da.scale-24*ia;oh>0&&oh>Mo&&(Mo=oh)}else{var fp=li[da.fontStack],sh=fp&&fp[_u];if(sh&&sh.rect)Yl=sh.rect,bo=sh.metrics;else{var Dh=Zi[da.fontStack],hp=Dh&&Dh[_u];if(!hp)continue;bo=hp.metrics}Xl=24*(ia-da.scale)}qo?(Sn.verticalizable=!0,Ga.push({glyph:_u,imageName:il,x:zo,y:qs+Xl,vertical:qo,scale:da.scale,fontStack:da.fontStack,sectionIndex:Wl,metrics:bo,rect:Yl}),zo+=ih*da.scale+ja):(Ga.push({glyph:_u,imageName:il,x:zo,y:qs+Xl,vertical:qo,scale:da.scale,fontStack:da.fontStack,sectionIndex:Wl,metrics:bo,rect:Yl}),zo+=bo.advance*da.scale+ja)}Ga.length!==0&&(cs=Math.max(zo-ja,cs),gi(Ga,0,Ga.length-1,xo,Mo)),zo=0;var pp=Qi*ia+Mo;Ts.lineOffset=Math.max(Mo,zs),qs+=pp,Bs=Math.max(pp,Bs),++fs}else qs+=Qi,++fs}var Sc,Fh=qs- -17,uh=Kr(Ka),Xc=uh.horizontalAlign,lh=uh.verticalAlign;(function(dp,vp,mp,gp,$p,yp,Nh,_p,Jp){var ch,xp=(vp-mp)*$p;ch=yp!==Nh?-_p*gp- -17:(-gp*Jp+.5)*Nh;for(var fh=0,Bh=dp;fh<Bh.length;fh+=1)for(var ql=0,zh=Bh[fh].positionedGlyphs;ql<zh.length;ql+=1){var Uh=zh[ql];Uh.x+=xp,Uh.y+=ch}})(Sn.positionedLines,xo,Xc,lh,cs,Bs,Qi,Fh,Vn.length),Sn.top+=-lh*Fh,Sn.bottom=Sn.top+Fh,Sn.left+=-Xc*cs,Sn.right=Sn.left+cs}(ti,a,s,h,qe,S,M,k,H,z,te,Ie),!function(Sn){for(var Zi=0,li=Sn;Zi<li.length;Zi+=1)if(li[Zi].positionedGlyphs.length!==0)return!1;return!0}(Pi)&&ti}Rr.fromFeature=function(t,a){for(var s=new Rr,h=0;h<t.sections.length;h++){var g=t.sections[h];g.image?s.addImageSection(g):s.addTextSection(g,a)}return s},Rr.prototype.length=function(){return this.text.length},Rr.prototype.getSection=function(t){return this.sections[this.sectionIndex[t]]},Rr.prototype.getSectionIndex=function(t){return this.sectionIndex[t]},Rr.prototype.getCharCode=function(t){return this.text.charCodeAt(t)},Rr.prototype.verticalizePunctuation=function(){this.text=function(t){for(var a="",s=0;s<t.length;s++){var h=t.charCodeAt(s+1)||null,g=t.charCodeAt(s-1)||null;a+=h&&hl(h)&&!wf[t[s+1]]||g&&hl(g)&&!wf[t[s-1]]||!wf[t[s]]?t[s]:wf[t[s]]}return a}(this.text)},Rr.prototype.trim=function(){for(var t=0,a=0;a<this.text.length&&Nn[this.text.charCodeAt(a)];a++)t++;for(var s=this.text.length,h=this.text.length-1;h>=0&&h>=t&&Nn[this.text.charCodeAt(h)];h--)s--;this.text=this.text.substring(t,s),this.sectionIndex=this.sectionIndex.slice(t,s)},Rr.prototype.substring=function(t,a){var s=new Rr;return s.text=this.text.substring(t,a),s.sectionIndex=this.sectionIndex.slice(t,a),s.sections=this.sections,s},Rr.prototype.toString=function(){return this.text},Rr.prototype.getMaxScale=function(){var t=this;return this.sectionIndex.reduce(function(a,s){return Math.max(a,t.sections[s].scale)},0)},Rr.prototype.addTextSection=function(t,a){this.text+=t.text,this.sections.push(ur.forText(t.scale,t.fontStack||a));for(var s=this.sections.length-1,h=0;h<t.text.length;++h)this.sectionIndex.push(s)},Rr.prototype.addImageSection=function(t){var a=t.image?t.image.name:"";if(a.length!==0){var s=this.getNextImageSectionCharCode();s?(this.text+=String.fromCharCode(s),this.sections.push(ur.forImage(a)),this.sectionIndex.push(this.sections.length-1)):Je("Reached maximum number of images 6401")}else Je("Can't add FormattedSection with an empty image.")},Rr.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var Nn={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},er={};function rr(t,a,s,h,g,m){if(a.imageName){var S=h[a.imageName];return S?S.displaySize[0]*a.scale*24/m+g:0}var M=s[a.fontStack],k=M&&M[t];return k?k.metrics.advance*a.scale+g:0}function mn(t,a,s,h){var g=Math.pow(t-a,2);return h?t<a?g/2:2*g:g+Math.abs(s)*s}function Hr(t,a,s){var h=0;return t===10&&(h-=1e4),s&&(h+=150),t!==40&&t!==65288||(h+=50),a!==41&&a!==65289||(h+=50),h}function xr(t,a,s,h,g,m){for(var S=null,M=mn(a,s,g,m),k=0,z=h;k<z.length;k+=1){var V=z[k],H=mn(a-V.x,s,g,m)+V.badness;H<=M&&(S=V,M=H)}return{index:t,x:a,priorBreak:S,badness:M}}function Wr(t,a,s,h,g,m,S){if(m!=="point")return[];if(!t)return[];for(var M,k=[],z=function(qe,ze,at,bt,Ut,Ht){for(var or=0,Ar=0;Ar<qe.length();Ar++){var Vr=qe.getSection(Ar);or+=rr(qe.getCharCode(Ar),Vr,bt,Ut,ze,Ht)}return or/Math.max(1,Math.ceil(or/at))}(t,a,s,h,g,S),V=t.text.indexOf("\u200B")>=0,H=0,te=0;te<t.length();te++){var se=t.getSection(te),Me=t.getCharCode(te);if(Nn[Me]||(H+=rr(Me,se,h,g,a,S)),te<t.length()-1){var Ie=!((M=Me)<11904||!(zr["Bopomofo Extended"](M)||zr.Bopomofo(M)||zr["CJK Compatibility Forms"](M)||zr["CJK Compatibility Ideographs"](M)||zr["CJK Compatibility"](M)||zr["CJK Radicals Supplement"](M)||zr["CJK Strokes"](M)||zr["CJK Symbols and Punctuation"](M)||zr["CJK Unified Ideographs Extension A"](M)||zr["CJK Unified Ideographs"](M)||zr["Enclosed CJK Letters and Months"](M)||zr["Halfwidth and Fullwidth Forms"](M)||zr.Hiragana(M)||zr["Ideographic Description Characters"](M)||zr["Kangxi Radicals"](M)||zr["Katakana Phonetic Extensions"](M)||zr.Katakana(M)||zr["Vertical Forms"](M)||zr["Yi Radicals"](M)||zr["Yi Syllables"](M)));(er[Me]||Ie||se.imageName)&&k.push(xr(te+1,H,z,k,Hr(Me,t.getCharCode(te+1),Ie&&V),!1))}}return function qe(ze){return ze?qe(ze.priorBreak).concat(ze.index):[]}(xr(t.length(),H,z,k,0,!0))}function Kr(t){var a=.5,s=.5;switch(t){case"right":case"top-right":case"bottom-right":a=1;break;case"left":case"top-left":case"bottom-left":a=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":s=1;break;case"top":case"top-right":case"top-left":s=0}return{horizontalAlign:a,verticalAlign:s}}function gi(t,a,s,h,g){if(h||g)for(var m=t[s],S=(t[s].x+m.metrics.advance*m.scale)*h,M=a;M<=s;M++)t[M].x-=S,t[M].y+=g}function ei(t,a,s,h,g,m){var S,M=t.image;if(M.content){var k=M.content,z=M.pixelRatio||1;S=[k[0]/z,k[1]/z,M.displaySize[0]-k[2]/z,M.displaySize[1]-k[3]/z]}var V,H,te,se,Me=a.left*m,Ie=a.right*m;s==="width"||s==="both"?(se=g[0]+Me-h[3],H=g[0]+Ie+h[1]):H=(se=g[0]+(Me+Ie-M.displaySize[0])/2)+M.displaySize[0];var qe=a.top*m,ze=a.bottom*m;return s==="height"||s==="both"?(V=g[1]+qe-h[0],te=g[1]+ze+h[2]):te=(V=g[1]+(qe+ze-M.displaySize[1])/2)+M.displaySize[1],{image:M,top:V,right:H,bottom:te,left:se,collisionPadding:S}}er[10]=!0,er[32]=!0,er[38]=!0,er[40]=!0,er[41]=!0,er[43]=!0,er[45]=!0,er[47]=!0,er[173]=!0,er[183]=!0,er[8203]=!0,er[8208]=!0,er[8211]=!0,er[8231]=!0;var Xr=function(t){function a(s,h,g,m){t.call(this,s,h),this.angle=g,m!==void 0&&(this.segment=m)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.clone=function(){return new a(this.x,this.y,this.angle,this.segment)},a}(ne);function rn(t,a){var s=a.expression;if(s.kind==="constant")return{kind:"constant",layoutSize:s.evaluate(new Si(t+1))};if(s.kind==="source")return{kind:"source"};for(var h=s.zoomStops,g=s.interpolationType,m=0;m<h.length&&h[m]<=t;)m++;for(var S=m=Math.max(0,m-1);S<h.length&&h[S]<t+1;)S++;S=Math.min(h.length-1,S);var M=h[m],k=h[S];return s.kind==="composite"?{kind:"composite",minZoom:M,maxZoom:k,interpolationType:g}:{kind:"camera",minZoom:M,maxZoom:k,minSize:s.evaluate(new Si(M)),maxSize:s.evaluate(new Si(k)),interpolationType:g}}function $n(t,a,s){var h=a.uSize,g=s.lowerSize;return t.kind==="source"?g/128:t.kind==="composite"?ga(g/128,s.upperSize/128,a.uSizeT):h}function ui(t,a){var s=0,h=0;if(t.kind==="constant")h=t.layoutSize;else if(t.kind!=="source"){var g=t.interpolationType,m=g?ot(_e.interpolationFactor(g,a,t.minZoom,t.maxZoom),0,1):0;t.kind==="camera"?h=ga(t.minSize,t.maxSize,m):s=m}return{uSizeT:s,uSize:h}}pn("Anchor",Xr);var zi=Object.freeze({__proto__:null,getSizeData:rn,evaluateSizeForFeature:$n,evaluateSizeForZoom:ui,SIZE_PACK_FACTOR:128});function qa(t,a,s,h,g){if(a.segment===void 0)return!0;for(var m=a,S=a.segment+1,M=0;M>-s/2;){if(--S<0)return!1;M-=t[S].dist(m),m=t[S]}M+=t[S].dist(t[S+1]),S++;for(var k=[],z=0;M<s/2;){var V=t[S],H=t[S+1];if(!H)return!1;var te=t[S-1].angleTo(V)-V.angleTo(H);for(te=Math.abs((te+3*Math.PI)%(2*Math.PI)-Math.PI),k.push({distance:M,angleDelta:te}),z+=te;M-k[0].distance>h;)z-=k.shift().angleDelta;if(z>g)return!1;S++,M+=V.dist(H)}return!0}function no(t){for(var a=0,s=0;s<t.length-1;s++)a+=t[s].dist(t[s+1]);return a}function ki(t,a,s){return t?.6*a*s:0}function No(t,a){return Math.max(t?t.right-t.left:0,a?a.right-a.left:0)}function Va(t,a,s,h,g,m){for(var S=ki(s,g,m),M=No(s,h)*m,k=0,z=no(t)/2,V=0;V<t.length-1;V++){var H=t[V],te=t[V+1],se=H.dist(te);if(k+se>z){var Me=(z-k)/se,Ie=ga(H.x,te.x,Me),qe=ga(H.y,te.y,Me),ze=new Xr(Ie,qe,te.angleTo(H),V);return ze._round(),!S||qa(t,ze,M,S,a)?ze:void 0}k+=se}}function Ho(t,a,s,h,g,m,S,M,k){var z=ki(h,m,S),V=No(h,g),H=V*S,te=t[0].x===0||t[0].x===k||t[0].y===0||t[0].y===k;return a-H<a/4&&(a=H+a/4),function se(Me,Ie,qe,ze,at,bt,Ut,Ht,or){for(var Ar=bt/2,Vr=no(Me),kn=0,an=Ie-qe,zn=[],ln=0;ln<Me.length-1;ln++){for(var Pi=Me[ln],ti=Me[ln+1],Sn=Pi.dist(ti),Zi=ti.angleTo(Pi);an+qe<kn+Sn;){var li=((an+=qe)-kn)/Sn,na=ga(Pi.x,ti.x,li),Vn=ga(Pi.y,ti.y,li);if(na>=0&&na<or&&Vn>=0&&Vn<or&&an-Ar>=0&&an+Ar<=Vr){var Qi=new Xr(na,Vn,Zi,ln);Qi._round(),ze&&!qa(Me,Qi,bt,ze,at)||zn.push(Qi)}}kn+=Sn}return Ht||zn.length||Ut||(zn=se(Me,kn/2,qe,ze,at,bt,Ut,!0,or)),zn}(t,te?a/2*M%a:(V/2+2*m)*S*M%a,a,z,s,H,te,!1,k)}function yo(t,a,s,h,g){for(var m=[],S=0;S<t.length;S++)for(var M=t[S],k=void 0,z=0;z<M.length-1;z++){var V=M[z],H=M[z+1];V.x<a&&H.x<a||(V.x<a?V=new ne(a,V.y+(a-V.x)/(H.x-V.x)*(H.y-V.y))._round():H.x<a&&(H=new ne(a,V.y+(a-V.x)/(H.x-V.x)*(H.y-V.y))._round()),V.y<s&&H.y<s||(V.y<s?V=new ne(V.x+(s-V.y)/(H.y-V.y)*(H.x-V.x),s)._round():H.y<s&&(H=new ne(V.x+(s-V.y)/(H.y-V.y)*(H.x-V.x),s)._round()),V.x>=h&&H.x>=h||(V.x>=h?V=new ne(h,V.y+(h-V.x)/(H.x-V.x)*(H.y-V.y))._round():H.x>=h&&(H=new ne(h,V.y+(h-V.x)/(H.x-V.x)*(H.y-V.y))._round()),V.y>=g&&H.y>=g||(V.y>=g?V=new ne(V.x+(g-V.y)/(H.y-V.y)*(H.x-V.x),g)._round():H.y>=g&&(H=new ne(V.x+(g-V.y)/(H.y-V.y)*(H.x-V.x),g)._round()),k&&V.equals(k[k.length-1])||m.push(k=[V]),k.push(H)))))}return m}function Bn(t,a,s,h){var g=[],m=t.image,S=m.pixelRatio,M=m.paddedRect.w-2,k=m.paddedRect.h-2,z=t.right-t.left,V=t.bottom-t.top,H=m.stretchX||[[0,M]],te=m.stretchY||[[0,k]],se=function(na,Vn){return na+Vn[1]-Vn[0]},Me=H.reduce(se,0),Ie=te.reduce(se,0),qe=M-Me,ze=k-Ie,at=0,bt=Me,Ut=0,Ht=Ie,or=0,Ar=qe,Vr=0,kn=ze;if(m.content&&h){var an=m.content;at=Ln(H,0,an[0]),Ut=Ln(te,0,an[1]),bt=Ln(H,an[0],an[2]),Ht=Ln(te,an[1],an[3]),or=an[0]-at,Vr=an[1]-Ut,Ar=an[2]-an[0]-bt,kn=an[3]-an[1]-Ht}var zn=function(na,Vn,Qi,Ka){var vo=po(na.stretch-at,bt,z,t.left),lo=xi(na.fixed-or,Ar,na.stretch,Me),ja=po(Vn.stretch-Ut,Ht,V,t.top),mo=xi(Vn.fixed-Vr,kn,Vn.stretch,Ie),Yo=po(Qi.stretch-at,bt,z,t.left),zo=xi(Qi.fixed-or,Ar,Qi.stretch,Me),qs=po(Ka.stretch-Ut,Ht,V,t.top),cs=xi(Ka.fixed-Vr,kn,Ka.stretch,Ie),Bs=new ne(vo,ja),xo=new ne(Yo,ja),fs=new ne(Yo,qs),Hi=new ne(vo,qs),Oa=new ne(lo/S,mo/S),Sa=new ne(zo/S,cs/S),ia=a*Math.PI/180;if(ia){var zs=Math.sin(ia),Ts=Math.cos(ia),Ga=[Ts,-zs,zs,Ts];Bs._matMult(Ga),xo._matMult(Ga),Hi._matMult(Ga),fs._matMult(Ga)}var Mo=na.stretch+na.fixed,As=Vn.stretch+Vn.fixed;return{tl:Bs,tr:xo,bl:Hi,br:fs,tex:{x:m.paddedRect.x+1+Mo,y:m.paddedRect.y+1+As,w:Qi.stretch+Qi.fixed-Mo,h:Ka.stretch+Ka.fixed-As},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Oa,pixelOffsetBR:Sa,minFontScaleX:Ar/S/z,minFontScaleY:kn/S/V,isSDF:s}};if(h&&(m.stretchX||m.stretchY))for(var ln=ts(H,qe,Me),Pi=ts(te,ze,Ie),ti=0;ti<ln.length-1;ti++)for(var Sn=ln[ti],Zi=ln[ti+1],li=0;li<Pi.length-1;li++)g.push(zn(Sn,Pi[li],Zi,Pi[li+1]));else g.push(zn({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:M+1},{fixed:0,stretch:k+1}));return g}function Ln(t,a,s){for(var h=0,g=0,m=t;g<m.length;g+=1){var S=m[g];h+=Math.max(a,Math.min(s,S[1]))-Math.max(a,Math.min(s,S[0]))}return h}function ts(t,a,s){for(var h=[{fixed:-1,stretch:0}],g=0,m=t;g<m.length;g+=1){var S=m[g],M=S[0],k=S[1],z=h[h.length-1];h.push({fixed:M-z.stretch,stretch:z.stretch}),h.push({fixed:M-z.stretch,stretch:z.stretch+(k-M)})}return h.push({fixed:a+1,stretch:s}),h}function po(t,a,s,h){return t/a*s+h}function xi(t,a,s,h){return t-a*s/h}var Wo=function(t,a,s,h,g,m,S,M,k,z){if(this.boxStartIndex=t.length,k){var V=m.top,H=m.bottom,te=m.collisionPadding;te&&(V-=te[1],H+=te[3]);var se=H-V;se>0&&(se=Math.max(10,se),this.circleDiameter=se)}else{var Me=m.top*S-M,Ie=m.bottom*S+M,qe=m.left*S-M,ze=m.right*S+M,at=m.collisionPadding;if(at&&(qe-=at[0]*S,Me-=at[1]*S,ze+=at[2]*S,Ie+=at[3]*S),z){var bt=new ne(qe,Me),Ut=new ne(ze,Me),Ht=new ne(qe,Ie),or=new ne(ze,Ie),Ar=z*Math.PI/180;bt._rotate(Ar),Ut._rotate(Ar),Ht._rotate(Ar),or._rotate(Ar),qe=Math.min(bt.x,Ut.x,Ht.x,or.x),ze=Math.max(bt.x,Ut.x,Ht.x,or.x),Me=Math.min(bt.y,Ut.y,Ht.y,or.y),Ie=Math.max(bt.y,Ut.y,Ht.y,or.y)}t.emplaceBack(a.x,a.y,qe,Me,ze,Ie,s,h,g)}this.boxEndIndex=t.length},ua=function(t,a){if(t===void 0&&(t=[]),a===void 0&&(a=us),this.data=t,this.length=this.data.length,this.compare=a,this.length>0)for(var s=(this.length>>1)-1;s>=0;s--)this._down(s)};function us(t,a){return t<a?-1:t>a?1:0}function ai(t,a,s){a===void 0&&(a=1),s===void 0&&(s=!1);for(var h=1/0,g=1/0,m=-1/0,S=-1/0,M=t[0],k=0;k<M.length;k++){var z=M[k];(!k||z.x<h)&&(h=z.x),(!k||z.y<g)&&(g=z.y),(!k||z.x>m)&&(m=z.x),(!k||z.y>S)&&(S=z.y)}var V=Math.min(m-h,S-g),H=V/2,te=new ua([],Ui);if(V===0)return new ne(h,g);for(var se=h;se<m;se+=V)for(var Me=g;Me<S;Me+=V)te.push(new ya(se+H,Me+H,H,t));for(var Ie=function(at){for(var bt=0,Ut=0,Ht=0,or=at[0],Ar=0,Vr=or.length,kn=Vr-1;Ar<Vr;kn=Ar++){var an=or[Ar],zn=or[kn],ln=an.x*zn.y-zn.x*an.y;Ut+=(an.x+zn.x)*ln,Ht+=(an.y+zn.y)*ln,bt+=3*ln}return new ya(Ut/bt,Ht/bt,0,at)}(t),qe=te.length;te.length;){var ze=te.pop();(ze.d>Ie.d||!Ie.d)&&(Ie=ze,s&&console.log("found best %d after %d probes",Math.round(1e4*ze.d)/1e4,qe)),ze.max-Ie.d<=a||(te.push(new ya(ze.p.x-(H=ze.h/2),ze.p.y-H,H,t)),te.push(new ya(ze.p.x+H,ze.p.y-H,H,t)),te.push(new ya(ze.p.x-H,ze.p.y+H,H,t)),te.push(new ya(ze.p.x+H,ze.p.y+H,H,t)),qe+=4)}return s&&(console.log("num probes: "+qe),console.log("best distance: "+Ie.d)),Ie.p}function Ui(t,a){return a.max-t.max}function ya(t,a,s,h){this.p=new ne(t,a),this.h=s,this.d=function(g,m){for(var S=!1,M=1/0,k=0;k<m.length;k++)for(var z=m[k],V=0,H=z.length,te=H-1;V<H;te=V++){var se=z[V],Me=z[te];se.y>g.y!=Me.y>g.y&&g.x<(Me.x-se.x)*(g.y-se.y)/(Me.y-se.y)+se.x&&(S=!S),M=Math.min(M,_l(g,se,Me))}return(S?1:-1)*Math.sqrt(M)}(this.p,h),this.max=this.d+this.h*Math.SQRT2}ua.prototype.push=function(t){this.data.push(t),this.length++,this._up(this.length-1)},ua.prototype.pop=function(){if(this.length!==0){var t=this.data[0],a=this.data.pop();return this.length--,this.length>0&&(this.data[0]=a,this._down(0)),t}},ua.prototype.peek=function(){return this.data[0]},ua.prototype._up=function(t){for(var a=this.data,s=this.compare,h=a[t];t>0;){var g=t-1>>1,m=a[g];if(s(h,m)>=0)break;a[t]=m,t=g}a[t]=h},ua.prototype._down=function(t){for(var a=this.data,s=this.compare,h=this.length>>1,g=a[t];t<h;){var m=1+(t<<1),S=a[m],M=m+1;if(M<this.length&&s(a[M],S)<0&&(m=M,S=a[M]),s(S,g)>=0)break;a[t]=S,t=m}a[t]=g};var Ao=Number.POSITIVE_INFINITY;function Gl(t,a){return a[1]!==Ao?function(s,h,g){var m=0,S=0;switch(h=Math.abs(h),g=Math.abs(g),s){case"top-right":case"top-left":case"top":S=g-7;break;case"bottom-right":case"bottom-left":case"bottom":S=7-g}switch(s){case"top-right":case"bottom-right":case"right":m=-h;break;case"top-left":case"bottom-left":case"left":m=h}return[m,S]}(t,a[0],a[1]):function(s,h){var g=0,m=0;h<0&&(h=0);var S=h/Math.sqrt(2);switch(s){case"top-right":case"top-left":m=S-7;break;case"bottom-right":case"bottom-left":m=7-S;break;case"bottom":m=7-h;break;case"top":m=h-7}switch(s){case"top-right":case"bottom-right":g=-S;break;case"top-left":case"bottom-left":g=S;break;case"left":g=h;break;case"right":g=-h}return[g,m]}(t,a[0])}function Ae(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Bt(t,a,s,h,g,m,S,M,k,z,V,H,te,se,Me){var Ie=function(Ut,Ht,or,Ar,Vr,kn,an,zn){for(var ln=Ar.layout.get("text-rotate").evaluate(kn,{})*Math.PI/180,Pi=[],ti=0,Sn=Ht.positionedLines;ti<Sn.length;ti+=1)for(var Zi=Sn[ti],li=0,na=Zi.positionedGlyphs;li<na.length;li+=1){var Vn=na[li];if(Vn.rect){var Qi=Vn.rect||{},Ka=4,vo=!0,lo=1,ja=0,mo=(Vr||zn)&&Vn.vertical,Yo=Vn.metrics.advance*Vn.scale/2;if(zn&&Ht.verticalizable&&(ja=Zi.lineOffset/2-(Vn.imageName?-(24-Vn.metrics.width*Vn.scale)/2:24*(Vn.scale-1))),Vn.imageName){var zo=an[Vn.imageName];vo=zo.sdf,Ka=1/(lo=zo.pixelRatio)}var qs=Vr?[Vn.x+Yo,Vn.y]:[0,0],cs=Vr?[0,0]:[Vn.x+Yo+or[0],Vn.y+or[1]-ja],Bs=[0,0];mo&&(Bs=cs,cs=[0,0]);var xo=(Vn.metrics.left-Ka)*Vn.scale-Yo+cs[0],fs=(-Vn.metrics.top-Ka)*Vn.scale+cs[1],Hi=xo+Qi.w*Vn.scale/lo,Oa=fs+Qi.h*Vn.scale/lo,Sa=new ne(xo,fs),ia=new ne(Hi,fs),zs=new ne(xo,Oa),Ts=new ne(Hi,Oa);if(mo){var Ga=new ne(-Yo,Yo- -17),Mo=-Math.PI/2,As=12-Yo,da=new ne(22-As,-(Vn.imageName?As:0)),Wl=new(Function.prototype.bind.apply(ne,[null].concat(Bs)));Sa._rotateAround(Mo,Ga)._add(da)._add(Wl),ia._rotateAround(Mo,Ga)._add(da)._add(Wl),zs._rotateAround(Mo,Ga)._add(da)._add(Wl),Ts._rotateAround(Mo,Ga)._add(da)._add(Wl)}if(ln){var _u=Math.sin(ln),Xl=Math.cos(ln),bo=[Xl,-_u,_u,Xl];Sa._matMult(bo),ia._matMult(bo),zs._matMult(bo),Ts._matMult(bo)}var Yl=new ne(0,0),il=new ne(0,0);Pi.push({tl:Sa,tr:ia,bl:zs,br:Ts,tex:Qi,writingMode:Ht.writingMode,glyphOffset:qs,sectionIndex:Vn.sectionIndex,isSDF:vo,pixelOffsetTL:Yl,pixelOffsetBR:il,minFontScaleX:0,minFontScaleY:0})}}return Pi}(0,s,M,g,m,S,h,t.allowVerticalPlacement),qe=t.textSizeData,ze=null;qe.kind==="source"?(ze=[128*g.layout.get("text-size").evaluate(S,{})])[0]>32640&&Je(t.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):qe.kind==="composite"&&((ze=[128*se.compositeTextSizes[0].evaluate(S,{},Me),128*se.compositeTextSizes[1].evaluate(S,{},Me)])[0]>32640||ze[1]>32640)&&Je(t.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),t.addSymbols(t.text,Ie,ze,M,m,S,z,a,k.lineStartIndex,k.lineLength,te,Me);for(var at=0,bt=V;at<bt.length;at+=1)H[bt[at]]=t.text.placedSymbolArray.length-1;return 4*Ie.length}function St(t){for(var a in t)return t[a];return null}function fn(t,a,s,h){var g=t.compareText;if(a in g){for(var m=g[a],S=m.length-1;S>=0;S--)if(h.dist(m[S])<s)return!0}else g[a]=[];return g[a].push(h),!1}var Gi=uu.VectorTileFeature.types,Ee=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function ue(t,a,s,h,g,m,S,M,k,z,V,H,te){var se=M?Math.min(32640,Math.round(M[0])):0,Me=M?Math.min(32640,Math.round(M[1])):0;t.emplaceBack(a,s,Math.round(32*h),Math.round(32*g),m,S,(se<<1)+(k?1:0),Me,16*z,16*V,256*H,256*te)}function je(t,a,s){t.emplaceBack(a.x,a.y,s),t.emplaceBack(a.x,a.y,s),t.emplaceBack(a.x,a.y,s),t.emplaceBack(a.x,a.y,s)}function ft(t){for(var a=0,s=t.sections;a<s.length;a+=1)if(cf(s[a].text))return!0;return!1}var At=function(t){this.layoutVertexArray=new Uc,this.indexArray=new ml,this.programConfigurations=t,this.segments=new fe,this.dynamicLayoutVertexArray=new Ku,this.opacityVertexArray=new vl,this.placedSymbolArray=new p};At.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},At.prototype.upload=function(t,a,s,h){this.isEmpty()||(s&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Wp.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,a),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Cd.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,Ee,!0),this.opacityVertexBuffer.itemSize=1),(s||h)&&this.programConfigurations.upload(t))},At.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},pn("SymbolBuffers",At);var $e=function(t,a,s){this.layoutVertexArray=new t,this.layoutAttributes=a,this.indexArray=new s,this.segments=new fe,this.collisionVertexArray=new Hf};$e.prototype.upload=function(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Td.members,!0)},$e.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},pn("CollisionBuffers",$e);var De=function(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(m){return m.id}),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Es([]),this.placementViewportMatrix=Es([]);var a=this.layers[0]._unevaluatedLayout._values;this.textSizeData=rn(this.zoom,a["text-size"]),this.iconSizeData=rn(this.zoom,a["icon-size"]);var s=this.layers[0].layout,h=s.get("symbol-sort-key"),g=s.get("symbol-z-order");this.canOverlap=s.get("text-allow-overlap")||s.get("icon-allow-overlap")||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey=g!=="viewport-y"&&h.constantOr(1)!==void 0,this.sortFeaturesByY=(g==="viewport-y"||g==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,s.get("symbol-placement")==="point"&&(this.writingModes=s.get("text-writing-mode").map(function(m){return kr[m]})),this.stateDependentLayerIds=this.layers.filter(function(m){return m.isStateDependent()}).map(function(m){return m.id}),this.sourceID=t.sourceID};De.prototype.createArrays=function(){this.text=new At(new Wn(this.layers,this.zoom,function(t){return/^text/.test(t)})),this.icon=new At(new Wn(this.layers,this.zoom,function(t){return/^icon/.test(t)})),this.glyphOffsetArray=new A,this.lineVertexArray=new R,this.symbolInstances=new w},De.prototype.calculateGlyphDependencies=function(t,a,s,h,g){for(var m=0;m<t.length;m++)if(a[t.charCodeAt(m)]=!0,(s||h)&&g){var S=wf[t.charAt(m)];S&&(a[S.charCodeAt(0)]=!0)}},De.prototype.populate=function(t,a,s){var h=this.layers[0],g=h.layout,m=g.get("text-font"),S=g.get("text-field"),M=g.get("icon-image"),k=(S.value.kind!=="constant"||S.value.value instanceof zt&&!S.value.value.isEmpty()||S.value.value.toString().length>0)&&(m.value.kind!=="constant"||m.value.value.length>0),z=M.value.kind!=="constant"||!!M.value.value||Object.keys(M.parameters).length>0,V=g.get("symbol-sort-key");if(this.features=[],k||z){for(var H=a.iconDependencies,te=a.glyphDependencies,se=a.availableImages,Me=new Si(this.zoom),Ie=0,qe=t;Ie<qe.length;Ie+=1){var ze=qe[Ie],at=ze.feature,bt=ze.id,Ut=ze.index,Ht=ze.sourceLayerIndex,or=h._featureFilter.needGeometry,Ar=ro(at,or);if(h._featureFilter.filter(Me,Ar,s)){or||(Ar.geometry=Za(at));var Vr=void 0;if(k){var kn=h.getValueAndResolveTokens("text-field",Ar,s,se),an=zt.factory(kn);ft(an)&&(this.hasRTLText=!0),(!this.hasRTLText||ff()==="unavailable"||this.hasRTLText&&Rs.isParsed())&&(Vr=Md(an,h,Ar))}var zn=void 0;if(z){var ln=h.getValueAndResolveTokens("icon-image",Ar,s,se);zn=ln instanceof aa?ln:aa.fromString(ln)}if(Vr||zn){var Pi=this.sortFeaturesByKey?V.evaluate(Ar,{},s):void 0;if(this.features.push({id:bt,text:Vr,icon:zn,index:Ut,sourceLayerIndex:Ht,geometry:Ar.geometry,properties:at.properties,type:Gi[at.type],sortKey:Pi}),zn&&(H[zn.name]=!0),Vr){var ti=m.evaluate(Ar,{},s).join(","),Sn=g.get("text-rotation-alignment")==="map"&&g.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(kr.vertical)>=0;for(var Zi=0,li=Vr.sections;Zi<li.length;Zi+=1){var na=li[Zi];if(na.image)H[na.image.name]=!0;else{var Vn=fc(Vr.toString()),Qi=na.fontStack||ti,Ka=te[Qi]=te[Qi]||{};this.calculateGlyphDependencies(na.text,Ka,Sn,this.allowVerticalPlacement,Vn)}}}}}}g.get("symbol-placement")==="line"&&(this.features=function(vo){var lo={},ja={},mo=[],Yo=0;function zo(Ga){mo.push(vo[Ga]),Yo++}function qs(Ga,Mo,As){var da=ja[Ga];return delete ja[Ga],ja[Mo]=da,mo[da].geometry[0].pop(),mo[da].geometry[0]=mo[da].geometry[0].concat(As[0]),da}function cs(Ga,Mo,As){var da=lo[Mo];return delete lo[Mo],lo[Ga]=da,mo[da].geometry[0].shift(),mo[da].geometry[0]=As[0].concat(mo[da].geometry[0]),da}function Bs(Ga,Mo,As){var da=As?Mo[0][Mo[0].length-1]:Mo[0][0];return Ga+":"+da.x+":"+da.y}for(var xo=0;xo<vo.length;xo++){var fs=vo[xo],Hi=fs.geometry,Oa=fs.text?fs.text.toString():null;if(Oa){var Sa=Bs(Oa,Hi),ia=Bs(Oa,Hi,!0);if(Sa in ja&&ia in lo&&ja[Sa]!==lo[ia]){var zs=cs(Sa,ia,Hi),Ts=qs(Sa,ia,mo[zs].geometry);delete lo[Sa],delete ja[ia],ja[Bs(Oa,mo[Ts].geometry,!0)]=Ts,mo[zs].geometry=null}else Sa in ja?qs(Sa,ia,Hi):ia in lo?cs(Sa,ia,Hi):(zo(xo),lo[Sa]=Yo-1,ja[ia]=Yo-1)}else zo(xo)}return mo.filter(function(Ga){return Ga.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(vo,lo){return vo.sortKey-lo.sortKey})}},De.prototype.update=function(t,a,s){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,a,this.layers,s),this.icon.programConfigurations.updatePaintArrays(t,a,this.layers,s))},De.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},De.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},De.prototype.upload=function(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},De.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},De.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},De.prototype.addToLineVertexArray=function(t,a){var s=this.lineVertexArray.length;if(t.segment!==void 0){for(var h=t.dist(a[t.segment+1]),g=t.dist(a[t.segment]),m={},S=t.segment+1;S<a.length;S++)m[S]={x:a[S].x,y:a[S].y,tileUnitDistanceFromAnchor:h},S<a.length-1&&(h+=a[S+1].dist(a[S]));for(var M=t.segment||0;M>=0;M--)m[M]={x:a[M].x,y:a[M].y,tileUnitDistanceFromAnchor:g},M>0&&(g+=a[M-1].dist(a[M]));for(var k=0;k<a.length;k++){var z=m[k];this.lineVertexArray.emplaceBack(z.x,z.y,z.tileUnitDistanceFromAnchor)}}return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}},De.prototype.addSymbols=function(t,a,s,h,g,m,S,M,k,z,V,H){for(var te=t.indexArray,se=t.layoutVertexArray,Me=t.segments.prepareSegment(4*a.length,se,te,this.canOverlap?m.sortKey:void 0),Ie=this.glyphOffsetArray.length,qe=Me.vertexLength,ze=this.allowVerticalPlacement&&S===kr.vertical?Math.PI/2:0,at=m.text&&m.text.sections,bt=0;bt<a.length;bt++){var Ut=a[bt],Ht=Ut.tl,or=Ut.tr,Ar=Ut.bl,Vr=Ut.br,kn=Ut.tex,an=Ut.pixelOffsetTL,zn=Ut.pixelOffsetBR,ln=Ut.minFontScaleX,Pi=Ut.minFontScaleY,ti=Ut.glyphOffset,Sn=Ut.isSDF,Zi=Ut.sectionIndex,li=Me.vertexLength,na=ti[1];ue(se,M.x,M.y,Ht.x,na+Ht.y,kn.x,kn.y,s,Sn,an.x,an.y,ln,Pi),ue(se,M.x,M.y,or.x,na+or.y,kn.x+kn.w,kn.y,s,Sn,zn.x,an.y,ln,Pi),ue(se,M.x,M.y,Ar.x,na+Ar.y,kn.x,kn.y+kn.h,s,Sn,an.x,zn.y,ln,Pi),ue(se,M.x,M.y,Vr.x,na+Vr.y,kn.x+kn.w,kn.y+kn.h,s,Sn,zn.x,zn.y,ln,Pi),je(t.dynamicLayoutVertexArray,M,ze),te.emplaceBack(li,li+1,li+2),te.emplaceBack(li+1,li+2,li+3),Me.vertexLength+=4,Me.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ti[0]),bt!==a.length-1&&Zi===a[bt+1].sectionIndex||t.programConfigurations.populatePaintArrays(se.length,m,m.index,{},H,at&&at[Zi])}t.placedSymbolArray.emplaceBack(M.x,M.y,Ie,this.glyphOffsetArray.length-Ie,qe,k,z,M.segment,s?s[0]:0,s?s[1]:0,h[0],h[1],S,0,!1,0,V)},De.prototype._addCollisionDebugVertex=function(t,a,s,h,g,m){return a.emplaceBack(0,0),t.emplaceBack(s.x,s.y,h,g,Math.round(m.x),Math.round(m.y))},De.prototype.addCollisionDebugVertices=function(t,a,s,h,g,m,S){var M=g.segments.prepareSegment(4,g.layoutVertexArray,g.indexArray),k=M.vertexLength,z=g.layoutVertexArray,V=g.collisionVertexArray,H=S.anchorX,te=S.anchorY;this._addCollisionDebugVertex(z,V,m,H,te,new ne(t,a)),this._addCollisionDebugVertex(z,V,m,H,te,new ne(s,a)),this._addCollisionDebugVertex(z,V,m,H,te,new ne(s,h)),this._addCollisionDebugVertex(z,V,m,H,te,new ne(t,h)),M.vertexLength+=4;var se=g.indexArray;se.emplaceBack(k,k+1),se.emplaceBack(k+1,k+2),se.emplaceBack(k+2,k+3),se.emplaceBack(k+3,k),M.primitiveLength+=4},De.prototype.addDebugCollisionBoxes=function(t,a,s,h){for(var g=t;g<a;g++){var m=this.collisionBoxArray.get(g);this.addCollisionDebugVertices(m.x1,m.y1,m.x2,m.y2,h?this.textCollisionBox:this.iconCollisionBox,m.anchorPoint,s)}},De.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new $e(Nl,op.members,Zc),this.iconCollisionBox=new $e(Nl,op.members,Zc);for(var t=0;t<this.symbolInstances.length;t++){var a=this.symbolInstances.get(t);this.addDebugCollisionBoxes(a.textBoxStartIndex,a.textBoxEndIndex,a,!0),this.addDebugCollisionBoxes(a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a,!0),this.addDebugCollisionBoxes(a.iconBoxStartIndex,a.iconBoxEndIndex,a,!1),this.addDebugCollisionBoxes(a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex,a,!1)}},De.prototype._deserializeCollisionBoxesForSymbol=function(t,a,s,h,g,m,S,M,k){for(var z={},V=a;V<s;V++){var H=t.get(V);z.textBox={x1:H.x1,y1:H.y1,x2:H.x2,y2:H.y2,anchorPointX:H.anchorPointX,anchorPointY:H.anchorPointY},z.textFeatureIndex=H.featureIndex;break}for(var te=h;te<g;te++){var se=t.get(te);z.verticalTextBox={x1:se.x1,y1:se.y1,x2:se.x2,y2:se.y2,anchorPointX:se.anchorPointX,anchorPointY:se.anchorPointY},z.verticalTextFeatureIndex=se.featureIndex;break}for(var Me=m;Me<S;Me++){var Ie=t.get(Me);z.iconBox={x1:Ie.x1,y1:Ie.y1,x2:Ie.x2,y2:Ie.y2,anchorPointX:Ie.anchorPointX,anchorPointY:Ie.anchorPointY},z.iconFeatureIndex=Ie.featureIndex;break}for(var qe=M;qe<k;qe++){var ze=t.get(qe);z.verticalIconBox={x1:ze.x1,y1:ze.y1,x2:ze.x2,y2:ze.y2,anchorPointX:ze.anchorPointX,anchorPointY:ze.anchorPointY},z.verticalIconFeatureIndex=ze.featureIndex;break}return z},De.prototype.deserializeCollisionBoxes=function(t){this.collisionArrays=[];for(var a=0;a<this.symbolInstances.length;a++){var s=this.symbolInstances.get(a);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}},De.prototype.hasTextData=function(){return this.text.segments.get().length>0},De.prototype.hasIconData=function(){return this.icon.segments.get().length>0},De.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},De.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},De.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},De.prototype.addIndicesForPlacedSymbol=function(t,a){for(var s=t.placedSymbolArray.get(a),h=s.vertexStartIndex+4*s.numGlyphs,g=s.vertexStartIndex;g<h;g+=4)t.indexArray.emplaceBack(g,g+1,g+2),t.indexArray.emplaceBack(g+1,g+2,g+3)},De.prototype.getSortedSymbolIndexes=function(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var a=Math.sin(t),s=Math.cos(t),h=[],g=[],m=[],S=0;S<this.symbolInstances.length;++S){m.push(S);var M=this.symbolInstances.get(S);h.push(0|Math.round(a*M.anchorX+s*M.anchorY)),g.push(M.featureIndex)}return m.sort(function(k,z){return h[k]-h[z]||g[z]-g[k]}),m},De.prototype.addToSortKeyRanges=function(t,a){var s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===a?s.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:a,symbolInstanceStart:t,symbolInstanceEnd:t+1})},De.prototype.sortFeatures=function(t){var a=this;if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var s=0,h=this.symbolInstanceIndexes;s<h.length;s+=1){var g=this.symbolInstances.get(h[s]);this.featureSortOrder.push(g.featureIndex),[g.rightJustifiedTextSymbolIndex,g.centerJustifiedTextSymbolIndex,g.leftJustifiedTextSymbolIndex].forEach(function(m,S,M){m>=0&&M.indexOf(m)===S&&a.addIndicesForPlacedSymbol(a.text,m)}),g.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,g.verticalPlacedTextSymbolIndex),g.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,g.placedIconSymbolIndex),g.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,g.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},pn("SymbolBucket",De,{omit:["layers","collisionBoxArray","features","compareText"]}),De.MAX_GLYPHS=65535,De.addDynamicAttributes=je;var rt=new Jo({"symbol-placement":new Mn(ce.layout_symbol["symbol-placement"]),"symbol-spacing":new Mn(ce.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Mn(ce.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new bn(ce.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Mn(ce.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Mn(ce.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Mn(ce.layout_symbol["icon-ignore-placement"]),"icon-optional":new Mn(ce.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Mn(ce.layout_symbol["icon-rotation-alignment"]),"icon-size":new bn(ce.layout_symbol["icon-size"]),"icon-text-fit":new Mn(ce.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Mn(ce.layout_symbol["icon-text-fit-padding"]),"icon-image":new bn(ce.layout_symbol["icon-image"]),"icon-rotate":new bn(ce.layout_symbol["icon-rotate"]),"icon-padding":new Mn(ce.layout_symbol["icon-padding"]),"icon-keep-upright":new Mn(ce.layout_symbol["icon-keep-upright"]),"icon-offset":new bn(ce.layout_symbol["icon-offset"]),"icon-anchor":new bn(ce.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Mn(ce.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Mn(ce.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Mn(ce.layout_symbol["text-rotation-alignment"]),"text-field":new bn(ce.layout_symbol["text-field"]),"text-font":new bn(ce.layout_symbol["text-font"]),"text-size":new bn(ce.layout_symbol["text-size"]),"text-max-width":new bn(ce.layout_symbol["text-max-width"]),"text-line-height":new Mn(ce.layout_symbol["text-line-height"]),"text-letter-spacing":new bn(ce.layout_symbol["text-letter-spacing"]),"text-justify":new bn(ce.layout_symbol["text-justify"]),"text-radial-offset":new bn(ce.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Mn(ce.layout_symbol["text-variable-anchor"]),"text-anchor":new bn(ce.layout_symbol["text-anchor"]),"text-max-angle":new Mn(ce.layout_symbol["text-max-angle"]),"text-writing-mode":new Mn(ce.layout_symbol["text-writing-mode"]),"text-rotate":new bn(ce.layout_symbol["text-rotate"]),"text-padding":new Mn(ce.layout_symbol["text-padding"]),"text-keep-upright":new Mn(ce.layout_symbol["text-keep-upright"]),"text-transform":new bn(ce.layout_symbol["text-transform"]),"text-offset":new bn(ce.layout_symbol["text-offset"]),"text-allow-overlap":new Mn(ce.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Mn(ce.layout_symbol["text-ignore-placement"]),"text-optional":new Mn(ce.layout_symbol["text-optional"])}),ge={paint:new Jo({"icon-opacity":new bn(ce.paint_symbol["icon-opacity"]),"icon-color":new bn(ce.paint_symbol["icon-color"]),"icon-halo-color":new bn(ce.paint_symbol["icon-halo-color"]),"icon-halo-width":new bn(ce.paint_symbol["icon-halo-width"]),"icon-halo-blur":new bn(ce.paint_symbol["icon-halo-blur"]),"icon-translate":new Mn(ce.paint_symbol["icon-translate"]),"icon-translate-anchor":new Mn(ce.paint_symbol["icon-translate-anchor"]),"text-opacity":new bn(ce.paint_symbol["text-opacity"]),"text-color":new bn(ce.paint_symbol["text-color"],{runtimeType:Gr,getOverride:function(t){return t.textColor},hasOverride:function(t){return!!t.textColor}}),"text-halo-color":new bn(ce.paint_symbol["text-halo-color"]),"text-halo-width":new bn(ce.paint_symbol["text-halo-width"]),"text-halo-blur":new bn(ce.paint_symbol["text-halo-blur"]),"text-translate":new Mn(ce.paint_symbol["text-translate"]),"text-translate-anchor":new Mn(ce.paint_symbol["text-translate-anchor"])}),layout:rt},Ze=function(t){this.type=t.property.overrides?t.property.overrides.runtimeType:un,this.defaultValue=t};Ze.prototype.evaluate=function(t){if(t.formattedSection){var a=this.defaultValue.property.overrides;if(a&&a.hasOverride(t.formattedSection))return a.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default},Ze.prototype.eachChild=function(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)},Ze.prototype.outputDefined=function(){return!1},Ze.prototype.serialize=function(){return null},pn("FormatSectionOverride",Ze,{omit:["defaultValue"]});var Se=function(t){function a(s){t.call(this,s,ge)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.recalculate=function(s,h){if(t.prototype.recalculate.call(this,s,h),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var g=this.layout.get("text-writing-mode");if(g){for(var m=[],S=0,M=g;S<M.length;S+=1){var k=M[S];m.indexOf(k)<0&&m.push(k)}this.layout._values["text-writing-mode"]=m}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},a.prototype.getValueAndResolveTokens=function(s,h,g,m){var S=this.layout.get(s).evaluate(h,{},g,m),M=this._unevaluatedLayout._values[s];return M.isDataDriven()||ic(M.value)||!S?S:function(k,z){return z.replace(/{([^{}]+)}/g,function(V,H){return H in k?String(k[H]):""})}(h.properties,S)},a.prototype.createBucket=function(s){return new De(s)},a.prototype.queryRadius=function(){return 0},a.prototype.queryIntersectsFeature=function(){return!1},a.prototype._setPaintOverrides=function(){for(var s=0,h=ge.paint.overridableProperties;s<h.length;s+=1){var g=h[s];if(a.hasPaintOverride(this.layout,g)){var m,S=this.paint.get(g),M=new Ze(S),k=new kc(M,S.property.specification);m=S.value.kind==="constant"||S.value.kind==="source"?new Pl("source",k):new fl("composite",k,S.value.zoomStops,S.value._interpolationType),this.paint._values[g]=new xs(S.property,m,S.parameters)}}},a.prototype._handleOverridablePaintPropertyUpdate=function(s,h,g){return!(!this.layout||h.isDataDriven()||g.isDataDriven())&&a.hasPaintOverride(this.layout,s)},a.hasPaintOverride=function(s,h){var g=s.get("text-field"),m=ge.paint.properties[h],S=!1,M=function(V){for(var H=0,te=V;H<te.length;H+=1)if(m.overrides&&m.overrides.hasOverride(te[H]))return void(S=!0)};if(g.value.kind==="constant"&&g.value.value instanceof zt)M(g.value.value.sections);else if(g.value.kind==="source"){var k=function(V){S||(V instanceof Na&&ea(V.value)===Wi?M(V.value.sections):V instanceof Eo?M(V.sections):V.eachChild(k))},z=g.value;z._styleExpression&&k(z._styleExpression.expression)}return S},a}(nu),lt={paint:new Jo({"background-color":new Mn(ce.paint_background["background-color"]),"background-pattern":new is(ce.paint_background["background-pattern"]),"background-opacity":new Mn(ce.paint_background["background-opacity"])})},wt=function(t){function a(s){t.call(this,s,lt)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a}(nu),fr={paint:new Jo({"raster-opacity":new Mn(ce.paint_raster["raster-opacity"]),"raster-hue-rotate":new Mn(ce.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Mn(ce.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Mn(ce.paint_raster["raster-brightness-max"]),"raster-saturation":new Mn(ce.paint_raster["raster-saturation"]),"raster-contrast":new Mn(ce.paint_raster["raster-contrast"]),"raster-resampling":new Mn(ce.paint_raster["raster-resampling"]),"raster-fade-duration":new Mn(ce.paint_raster["raster-fade-duration"])})},Nr=function(t){function a(s){t.call(this,s,fr)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a}(nu),Br=function(t){function a(s){t.call(this,s,{}),this.implementation=s}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},a.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},a.prototype.recalculate=function(){},a.prototype.updateTransitions=function(){},a.prototype.hasTransition=function(){},a.prototype.serialize=function(){},a.prototype.onAdd=function(s){this.implementation.onAdd&&this.implementation.onAdd(s,s.painter.context.gl)},a.prototype.onRemove=function(s){this.implementation.onRemove&&this.implementation.onRemove(s,s.painter.context.gl)},a}(nu),nn={circle:df,heatmap:Eh,hillshade:Sh,fill:Ph,"fill-extrusion":el,line:Rh,symbol:Se,background:wt,raster:Nr},Lr=K.HTMLImageElement,En=K.HTMLCanvasElement,sn=K.HTMLVideoElement,_n=K.ImageData,yn=K.ImageBitmap,dn=function(t,a,s,h){this.context=t,this.format=s,this.texture=t.gl.createTexture(),this.update(a,h)};dn.prototype.update=function(t,a,s){var h=t.width,g=t.height,m=!(this.size&&this.size[0]===h&&this.size[1]===g||s),S=this.context,M=S.gl;if(this.useMipmap=Boolean(a&&a.useMipmap),M.bindTexture(M.TEXTURE_2D,this.texture),S.pixelStoreUnpackFlipY.set(!1),S.pixelStoreUnpack.set(1),S.pixelStoreUnpackPremultiplyAlpha.set(this.format===M.RGBA&&(!a||a.premultiply!==!1)),m)this.size=[h,g],t instanceof Lr||t instanceof En||t instanceof sn||t instanceof _n||yn&&t instanceof yn?M.texImage2D(M.TEXTURE_2D,0,this.format,this.format,M.UNSIGNED_BYTE,t):M.texImage2D(M.TEXTURE_2D,0,this.format,h,g,0,this.format,M.UNSIGNED_BYTE,t.data);else{var k=s||{x:0,y:0},z=k.x,V=k.y;t instanceof Lr||t instanceof En||t instanceof sn||t instanceof _n||yn&&t instanceof yn?M.texSubImage2D(M.TEXTURE_2D,0,z,V,M.RGBA,M.UNSIGNED_BYTE,t):M.texSubImage2D(M.TEXTURE_2D,0,z,V,h,g,M.RGBA,M.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&M.generateMipmap(M.TEXTURE_2D)},dn.prototype.bind=function(t,a,s){var h=this.context.gl;h.bindTexture(h.TEXTURE_2D,this.texture),s!==h.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(s=h.LINEAR),t!==this.filter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,t),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,s||t),this.filter=t),a!==this.wrap&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,a),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,a),this.wrap=a)},dn.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},dn.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var Jn=function(t){var a=this;this._callback=t,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){a._triggered=!1,a._callback()})};Jn.prototype.trigger=function(){var t=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){t._triggered=!1,t._callback()},0))},Jn.prototype.remove=function(){delete this._channel,this._callback=function(){}};var Ea=function(t,a,s){this.target=t,this.parent=a,this.mapId=s,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},kt(["receive","process"],this),this.invoker=new Jn(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Mr()?t:K};function Bo(t,a,s){var h=2*Math.PI*6378137/256/Math.pow(2,s);return[t*h-2*Math.PI*6378137/2,a*h-2*Math.PI*6378137/2]}Ea.prototype.send=function(t,a,s,h,g){var m=this;g===void 0&&(g=!1);var S=Math.round(1e18*Math.random()).toString(36).substring(0,10);s&&(this.callbacks[S]=s);var M=we(this.globalScope)?void 0:[];return this.target.postMessage({id:S,type:t,hasCallback:!!s,targetMapId:h,mustQueue:g,sourceMapId:this.mapId,data:Gs(a,M)},M),{cancel:function(){s&&delete m.callbacks[S],m.target.postMessage({id:S,type:"<cancel>",targetMapId:h,sourceMapId:m.mapId})}}},Ea.prototype.receive=function(t){var a=t.data,s=a.id;if(s&&(!a.targetMapId||this.mapId===a.targetMapId))if(a.type==="<cancel>"){delete this.tasks[s];var h=this.cancelCallbacks[s];delete this.cancelCallbacks[s],h&&h()}else Mr()||a.mustQueue?(this.tasks[s]=a,this.taskQueue.push(s),this.invoker.trigger()):this.processTask(s,a)},Ea.prototype.process=function(){if(this.taskQueue.length){var t=this.taskQueue.shift(),a=this.tasks[t];delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),a&&this.processTask(t,a)}},Ea.prototype.processTask=function(t,a){var s=this;if(a.type==="<response>"){var h=this.callbacks[t];delete this.callbacks[t],h&&(a.error?h(Os(a.error)):h(null,Os(a.data)))}else{var g=!1,m=we(this.globalScope)?void 0:[],S=a.hasCallback?function(V,H){g=!0,delete s.cancelCallbacks[t],s.target.postMessage({id:t,type:"<response>",sourceMapId:s.mapId,error:V?Gs(V):null,data:Gs(H,m)},m)}:function(V){g=!0},M=null,k=Os(a.data);if(this.parent[a.type])M=this.parent[a.type](a.sourceMapId,k,S);else if(this.parent.getWorkerSource){var z=a.type.split(".");M=this.parent.getWorkerSource(a.sourceMapId,z[0],k.source)[z[1]](k,S)}else S(new Error("Could not find function "+a.type));!g&&M&&M.cancel&&(this.cancelCallbacks[t]=M.cancel)}},Ea.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var Da=function(t,a){t&&(a?this.setSouthWest(t).setNorthEast(a):t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))};Da.prototype.setNorthEast=function(t){return this._ne=t instanceof pa?new pa(t.lng,t.lat):pa.convert(t),this},Da.prototype.setSouthWest=function(t){return this._sw=t instanceof pa?new pa(t.lng,t.lat):pa.convert(t),this},Da.prototype.extend=function(t){var a,s,h=this._sw,g=this._ne;if(t instanceof pa)a=t,s=t;else{if(!(t instanceof Da))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(Da.convert(t)):this.extend(pa.convert(t)):this;if(s=t._ne,!(a=t._sw)||!s)return this}return h||g?(h.lng=Math.min(a.lng,h.lng),h.lat=Math.min(a.lat,h.lat),g.lng=Math.max(s.lng,g.lng),g.lat=Math.max(s.lat,g.lat)):(this._sw=new pa(a.lng,a.lat),this._ne=new pa(s.lng,s.lat)),this},Da.prototype.getCenter=function(){return new pa((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},Da.prototype.getSouthWest=function(){return this._sw},Da.prototype.getNorthEast=function(){return this._ne},Da.prototype.getNorthWest=function(){return new pa(this.getWest(),this.getNorth())},Da.prototype.getSouthEast=function(){return new pa(this.getEast(),this.getSouth())},Da.prototype.getWest=function(){return this._sw.lng},Da.prototype.getSouth=function(){return this._sw.lat},Da.prototype.getEast=function(){return this._ne.lng},Da.prototype.getNorth=function(){return this._ne.lat},Da.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},Da.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},Da.prototype.isEmpty=function(){return!(this._sw&&this._ne)},Da.prototype.contains=function(t){var a=pa.convert(t),s=a.lng,h=a.lat,g=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(g=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=h&&h<=this._ne.lat&&g},Da.convert=function(t){return!t||t instanceof Da?t:new Da(t)};var pa=function(t,a){if(isNaN(t)||isNaN(a))throw new Error("Invalid LngLat object: ("+t+", "+a+")");if(this.lng=+t,this.lat=+a,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};pa.prototype.wrap=function(){return new pa(Jt(this.lng,-180,180),this.lat)},pa.prototype.toArray=function(){return[this.lng,this.lat]},pa.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},pa.prototype.distanceTo=function(t){var a=Math.PI/180,s=this.lat*a,h=t.lat*a,g=Math.sin(s)*Math.sin(h)+Math.cos(s)*Math.cos(h)*Math.cos((t.lng-this.lng)*a);return 63710088e-1*Math.acos(Math.min(g,1))},pa.prototype.toBounds=function(t){t===void 0&&(t=0);var a=360*t/40075017,s=a/Math.cos(Math.PI/180*this.lat);return new Da(new pa(this.lng-s,this.lat-a),new pa(this.lng+s,this.lat+a))},pa.convert=function(t){if(t instanceof pa)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new pa(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new pa(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var tl=2*Math.PI*63710088e-1;function _o(t){return tl*Math.cos(t*Math.PI/180)}function Ls(t){return(180+t)/360}function lu(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function kh(t,a){return t/_o(a)}function cu(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}var El=function(t,a,s){s===void 0&&(s=0),this.x=+t,this.y=+a,this.z=+s};El.fromLngLat=function(t,a){a===void 0&&(a=0);var s=pa.convert(t);return new El(Ls(s.lng),lu(s.lat),kh(a,s.lat))},El.prototype.toLngLat=function(){return new pa(360*this.x-180,cu(this.y))},El.prototype.toAltitude=function(){return this.z*_o(cu(this.y))},El.prototype.meterInMercatorCoordinateUnits=function(){return 1/tl*(t=cu(this.y),1/Math.cos(t*Math.PI/180));var t};var Af=function(t,a,s){this.z=t,this.x=a,this.y=s,this.key=lp(0,t,t,a,s)};Af.prototype.equals=function(t){return this.z===t.z&&this.x===t.x&&this.y===t.y},Af.prototype.url=function(t,a){var s,h,g,m,S,M=(h=this.y,g=this.z,m=Bo(256*(s=this.x),256*(h=Math.pow(2,g)-h-1),g),S=Bo(256*(s+1),256*(h+1),g),m[0]+","+m[1]+","+S[0]+","+S[1]),k=function(z,V,H){for(var te,se="",Me=z;Me>0;Me--)se+=(V&(te=1<<Me-1)?1:0)+(H&te?2:0);return se}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(a==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",k).replace("{bbox-epsg-3857}",M)},Af.prototype.getTilePoint=function(t){var a=Math.pow(2,this.z);return new ne(8192*(t.x*a-this.x),8192*(t.y*a-this.y))},Af.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var mv=function(t,a){this.wrap=t,this.canonical=a,this.key=lp(t,a.z,a.z,a.x,a.y)},Xo=function(t,a,s,h,g){this.overscaledZ=t,this.wrap=a,this.canonical=new Af(s,+h,+g),this.key=lp(a,t,s,h,g)};function lp(t,a,s,h,g){(t*=2)<0&&(t=-1*t-1);var m=1<<s;return(m*m*t+m*g+h).toString(36)+s.toString(36)+a.toString(36)}Xo.prototype.equals=function(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)},Xo.prototype.scaledTo=function(t){var a=this.canonical.z-t;return t>this.canonical.z?new Xo(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Xo(t,this.wrap,t,this.canonical.x>>a,this.canonical.y>>a)},Xo.prototype.calculateScaledKey=function(t,a){var s=this.canonical.z-t;return t>this.canonical.z?lp(this.wrap*+a,t,this.canonical.z,this.canonical.x,this.canonical.y):lp(this.wrap*+a,t,t,this.canonical.x>>s,this.canonical.y>>s)},Xo.prototype.isChildOf=function(t){if(t.wrap!==this.wrap)return!1;var a=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>a&&t.canonical.y===this.canonical.y>>a},Xo.prototype.children=function(t){if(this.overscaledZ>=t)return[new Xo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var a=this.canonical.z+1,s=2*this.canonical.x,h=2*this.canonical.y;return[new Xo(a,this.wrap,a,s,h),new Xo(a,this.wrap,a,s+1,h),new Xo(a,this.wrap,a,s,h+1),new Xo(a,this.wrap,a,s+1,h+1)]},Xo.prototype.isLessThan=function(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))},Xo.prototype.wrapped=function(){return new Xo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},Xo.prototype.unwrapTo=function(t){return new Xo(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)},Xo.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},Xo.prototype.toUnwrapped=function(){return new mv(this.wrap,this.canonical)},Xo.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},Xo.prototype.getTilePoint=function(t){return this.canonical.getTilePoint(new El(t.x-this.wrap,t.y))},pn("CanonicalTileID",Af),pn("OverscaledTileID",Xo,{omit:["posMatrix"]});var rl=function(t,a,s){if(this.uid=t,a.height!==a.width)throw new RangeError("DEM tiles must be square");if(s&&s!=="mapbox"&&s!=="terrarium")return Je('"'+s+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=a.height;var h=this.dim=a.height-2;this.data=new Uint32Array(a.data.buffer),this.encoding=s||"mapbox";for(var g=0;g<h;g++)this.data[this._idx(-1,g)]=this.data[this._idx(0,g)],this.data[this._idx(h,g)]=this.data[this._idx(h-1,g)],this.data[this._idx(g,-1)]=this.data[this._idx(g,0)],this.data[this._idx(g,h)]=this.data[this._idx(g,h-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(h,-1)]=this.data[this._idx(h-1,0)],this.data[this._idx(-1,h)]=this.data[this._idx(0,h-1)],this.data[this._idx(h,h)]=this.data[this._idx(h-1,h-1)]};rl.prototype.get=function(t,a){var s=new Uint8Array(this.data.buffer),h=4*this._idx(t,a);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(s[h],s[h+1],s[h+2])},rl.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},rl.prototype._idx=function(t,a){if(t<-1||t>=this.dim+1||a<-1||a>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(a+1)*this.stride+(t+1)},rl.prototype._unpackMapbox=function(t,a,s){return(256*t*256+256*a+s)/10-1e4},rl.prototype._unpackTerrarium=function(t,a,s){return 256*t+a+s/256-32768},rl.prototype.getPixels=function(){return new wo({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},rl.prototype.backfillBorder=function(t,a,s){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");var h=a*this.dim,g=a*this.dim+this.dim,m=s*this.dim,S=s*this.dim+this.dim;switch(a){case-1:h=g-1;break;case 1:g=h+1}switch(s){case-1:m=S-1;break;case 1:S=m+1}for(var M=-a*this.dim,k=-s*this.dim,z=m;z<S;z++)for(var V=h;V<g;V++)this.data[this._idx(V,z)]=t.data[this._idx(V+M,z+k)]},pn("DEMData",rl);var Cs=function(t){this._stringToNumber={},this._numberToString=[];for(var a=0;a<t.length;a++){var s=t[a];this._stringToNumber[s]=a,this._numberToString[a]=s}};Cs.prototype.encode=function(t){return this._stringToNumber[t]},Cs.prototype.decode=function(t){return this._numberToString[t]};var cp=function(t,a,s,h,g){this.type="Feature",this._vectorTileFeature=t,t._z=a,t._x=s,t._y=h,this.properties=t.properties,this.id=g},Kp={geometry:{configurable:!0}};Kp.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},Kp.geometry.set=function(t){this._geometry=t},cp.prototype.toJSON=function(){var t={geometry:this.geometry};for(var a in this)a!=="_geometry"&&a!=="_vectorTileFeature"&&(t[a]=this[a]);return t},Object.defineProperties(cp.prototype,Kp);var nh=function(){this.state={},this.stateChanges={},this.deletedStates={}};nh.prototype.updateState=function(t,a,s){var h=String(a);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][h]=this.stateChanges[t][h]||{},pt(this.stateChanges[t][h],s),this.deletedStates[t]===null)for(var g in this.deletedStates[t]={},this.state[t])g!==h&&(this.deletedStates[t][g]=null);else if(this.deletedStates[t]&&this.deletedStates[t][h]===null)for(var m in this.deletedStates[t][h]={},this.state[t][h])s[m]||(this.deletedStates[t][h][m]=null);else for(var S in s)this.deletedStates[t]&&this.deletedStates[t][h]&&this.deletedStates[t][h][S]===null&&delete this.deletedStates[t][h][S]},nh.prototype.removeFeatureState=function(t,a,s){if(this.deletedStates[t]!==null){var h=String(a);if(this.deletedStates[t]=this.deletedStates[t]||{},s&&a!==void 0)this.deletedStates[t][h]!==null&&(this.deletedStates[t][h]=this.deletedStates[t][h]||{},this.deletedStates[t][h][s]=null);else if(a!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][h])for(s in this.deletedStates[t][h]={},this.stateChanges[t][h])this.deletedStates[t][h][s]=null;else this.deletedStates[t][h]=null;else this.deletedStates[t]=null}},nh.prototype.getState=function(t,a){var s=String(a),h=pt({},(this.state[t]||{})[s],(this.stateChanges[t]||{})[s]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){var g=this.deletedStates[t][a];if(g===null)return{};for(var m in g)delete h[m]}return h},nh.prototype.initializeTileState=function(t,a){t.setFeatureState(this.state,a)},nh.prototype.coalesceChanges=function(t,a){var s={};for(var h in this.stateChanges){this.state[h]=this.state[h]||{};var g={};for(var m in this.stateChanges[h])this.state[h][m]||(this.state[h][m]={}),pt(this.state[h][m],this.stateChanges[h][m]),g[m]=this.state[h][m];s[h]=g}for(var S in this.deletedStates){this.state[S]=this.state[S]||{};var M={};if(this.deletedStates[S]===null)for(var k in this.state[S])M[k]={},this.state[S][k]={};else for(var z in this.deletedStates[S]){if(this.deletedStates[S][z]===null)this.state[S][z]={};else for(var V=0,H=Object.keys(this.deletedStates[S][z]);V<H.length;V+=1)delete this.state[S][z][H[V]];M[z]=this.state[S][z]}s[S]=s[S]||{},pt(s[S],M)}if(this.stateChanges={},this.deletedStates={},Object.keys(s).length!==0)for(var te in t)t[te].setFeatureState(s,a)};var Hl=function(t,a){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Au(8192,16,0),this.grid3D=new Au(8192,16,0),this.featureIndexArray=new q,this.promoteId=a};function Pd(t,a,s,h,g){return Wt(t,function(m,S){var M=a instanceof pu?a.get(S):null;return M&&M.evaluate?M.evaluate(s,h,g):M})}function gv(t){for(var a=1/0,s=1/0,h=-1/0,g=-1/0,m=0,S=t;m<S.length;m+=1){var M=S[m];a=Math.min(a,M.x),s=Math.min(s,M.y),h=Math.max(h,M.x),g=Math.max(g,M.y)}return{minX:a,minY:s,maxX:h,maxY:g}}function mm(t,a){return a-t}Hl.prototype.insert=function(t,a,s,h,g,m){var S=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,h,g);for(var M=m?this.grid3D:this.grid,k=0;k<a.length;k++){for(var z=a[k],V=[1/0,1/0,-1/0,-1/0],H=0;H<z.length;H++){var te=z[H];V[0]=Math.min(V[0],te.x),V[1]=Math.min(V[1],te.y),V[2]=Math.max(V[2],te.x),V[3]=Math.max(V[3],te.y)}V[0]<8192&&V[1]<8192&&V[2]>=0&&V[3]>=0&&M.insert(S,V[0],V[1],V[2],V[3])}},Hl.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new uu.VectorTile(new Cf(this.rawTileData)).layers,this.sourceLayerCoder=new Cs(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},Hl.prototype.query=function(t,a,s,h){var g=this;this.loadVTLayers();for(var m=t.params||{},S=8192/t.tileSize/t.scale,M=Ol(m.filter),k=t.queryGeometry,z=t.queryPadding*S,V=gv(k),H=this.grid.query(V.minX-z,V.minY-z,V.maxX+z,V.maxY+z),te=gv(t.cameraQueryGeometry),se=this.grid3D.query(te.minX-z,te.minY-z,te.maxX+z,te.maxY+z,function(Ut,Ht,or,Ar){return function(Vr,kn,an,zn,ln){for(var Pi=0,ti=Vr;Pi<ti.length;Pi+=1){var Sn=ti[Pi];if(kn<=Sn.x&&an<=Sn.y&&zn>=Sn.x&&ln>=Sn.y)return!0}var Zi=[new ne(kn,an),new ne(kn,ln),new ne(zn,ln),new ne(zn,an)];if(Vr.length>2){for(var li=0,na=Zi;li<na.length;li+=1)if(ou(Vr,na[li]))return!0}for(var Vn=0;Vn<Vr.length-1;Vn++)if(Zl(Vr[Vn],Vr[Vn+1],Zi))return!0;return!1}(t.cameraQueryGeometry,Ut-z,Ht-z,or+z,Ar+z)}),Me=0,Ie=se;Me<Ie.length;Me+=1)H.push(Ie[Me]);H.sort(mm);for(var qe,ze={},at=function(Ut){var Ht=H[Ut];if(Ht!==qe){qe=Ht;var or=g.featureIndexArray.get(Ht),Ar=null;g.loadMatchingFeature(ze,or.bucketIndex,or.sourceLayerIndex,or.featureIndex,M,m.layers,m.availableImages,a,s,h,function(Vr,kn,an){return Ar||(Ar=Za(Vr)),kn.queryIntersectsFeature(k,Vr,an,Ar,g.z,t.transform,S,t.pixelPosMatrix)})}},bt=0;bt<H.length;bt++)at(bt);return ze},Hl.prototype.loadMatchingFeature=function(t,a,s,h,g,m,S,M,k,z,V){var H=this.bucketLayerIDs[a];if(!m||function(Vr,kn){for(var an=0;an<Vr.length;an++)if(kn.indexOf(Vr[an])>=0)return!0;return!1}(m,H)){var te=this.sourceLayerCoder.decode(s),se=this.vtLayers[te].feature(h);if(g.needGeometry){var Me=ro(se,!0);if(!g.filter(new Si(this.tileID.overscaledZ),Me,this.tileID.canonical))return}else if(!g.filter(new Si(this.tileID.overscaledZ),se))return;for(var Ie=this.getId(se,te),qe=0;qe<H.length;qe++){var ze=H[qe];if(!(m&&m.indexOf(ze)<0)){var at=M[ze];if(at){var bt={};Ie!==void 0&&z&&(bt=z.getState(at.sourceLayer||"_geojsonTileLayer",Ie));var Ut=pt({},k[ze]);Ut.paint=Pd(Ut.paint,at.paint,se,bt,S),Ut.layout=Pd(Ut.layout,at.layout,se,bt,S);var Ht=!V||V(se,at,bt);if(Ht){var or=new cp(se,this.z,this.x,this.y,Ie);or.layer=Ut;var Ar=t[ze];Ar===void 0&&(Ar=t[ze]=[]),Ar.push({featureIndex:h,feature:or,intersectionZ:Ht})}}}}}},Hl.prototype.lookupSymbolFeatures=function(t,a,s,h,g,m,S,M){var k={};this.loadVTLayers();for(var z=Ol(g),V=0,H=t;V<H.length;V+=1)this.loadMatchingFeature(k,s,h,H[V],z,m,S,M,a);return k},Hl.prototype.hasLayer=function(t){for(var a=0,s=this.bucketLayerIDs;a<s.length;a+=1)for(var h=0,g=s[a];h<g.length;h+=1)if(t===g[h])return!0;return!1},Hl.prototype.getId=function(t,a){var s=t.id;return this.promoteId&&typeof(s=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[a]])=="boolean"&&(s=Number(s)),s},pn("FeatureIndex",Hl,{omit:["rawTileData","sourceLayerCoder"]});var ls=function(t,a){this.tileID=t,this.uid=_t(),this.uses=0,this.tileSize=a,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};ls.prototype.registerFadeDuration=function(t){var a=t+this.timeAdded;a<ci.now()||this.fadeEndTime&&a<this.fadeEndTime||(this.fadeEndTime=a)},ls.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},ls.prototype.loadVectorData=function(t,a,s){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){for(var h in t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(z,V){var H={};if(!V)return H;for(var te=function(){var Ie=Me[se],qe=Ie.layerIds.map(function(bt){return V.getLayer(bt)}).filter(Boolean);if(qe.length!==0){Ie.layers=qe,Ie.stateDependentLayerIds&&(Ie.stateDependentLayers=Ie.stateDependentLayerIds.map(function(bt){return qe.filter(function(Ut){return Ut.id===bt})[0]}));for(var ze=0,at=qe;ze<at.length;ze+=1)H[at[ze].id]=Ie}},se=0,Me=z;se<Me.length;se+=1)te();return H}(t.buckets,a.style),this.hasSymbolBuckets=!1,this.buckets){var g=this.buckets[h];if(g instanceof De){if(this.hasSymbolBuckets=!0,!s)break;g.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var m in this.buckets){var S=this.buckets[m];if(S instanceof De&&S.hasRTLText){this.hasRTLText=!0,Rs.isLoading()||Rs.isLoaded()||ff()!=="deferred"||tu();break}}for(var M in this.queryPadding=0,this.buckets){var k=this.buckets[M];this.queryPadding=Math.max(this.queryPadding,a.style.getLayer(M).queryRadius(k))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new f},ls.prototype.unloadVectorData=function(){for(var t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},ls.prototype.getBucket=function(t){return this.buckets[t.id]},ls.prototype.upload=function(t){for(var a in this.buckets){var s=this.buckets[a];s.uploadPending()&&s.upload(t)}var h=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new dn(t,this.imageAtlas.image,h.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new dn(t,this.glyphAtlasImage,h.ALPHA),this.glyphAtlasImage=null)},ls.prototype.prepare=function(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)},ls.prototype.queryRenderedFeatures=function(t,a,s,h,g,m,S,M,k,z){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:h,cameraQueryGeometry:g,scale:m,tileSize:this.tileSize,pixelPosMatrix:z,transform:M,params:S,queryPadding:this.queryPadding*k},t,a,s):{}},ls.prototype.querySourceFeatures=function(t,a){var s=this.latestFeatureIndex;if(s&&s.rawTileData){var h=s.loadVTLayers(),g=a?a.sourceLayer:"",m=h._geojsonTileLayer||h[g];if(m)for(var S=Ol(a&&a.filter),M=this.tileID.canonical,k=M.z,z=M.x,V=M.y,H={z:k,x:z,y:V},te=0;te<m.length;te++){var se=m.feature(te);if(S.needGeometry){var Me=ro(se,!0);if(!S.filter(new Si(this.tileID.overscaledZ),Me,this.tileID.canonical))continue}else if(!S.filter(new Si(this.tileID.overscaledZ),se))continue;var Ie=s.getId(se,g),qe=new cp(se,k,z,V,Ie);qe.tile=H,t.push(qe)}}},ls.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},ls.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},ls.prototype.setExpiryData=function(t){var a=this.expirationTime;if(t.cacheControl){var s=jr(t.cacheControl);s["max-age"]&&(this.expirationTime=Date.now()+1e3*s["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){var h=Date.now(),g=!1;if(this.expirationTime>h)g=!1;else if(a)if(this.expirationTime<a)g=!0;else{var m=this.expirationTime-a;m?this.expirationTime=h+Math.max(m,3e4):g=!0}else g=!0;g?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},ls.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},ls.prototype.setFeatureState=function(t,a){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(t).length!==0){var s=this.latestFeatureIndex.loadVTLayers();for(var h in this.buckets)if(a.style.hasLayer(h)){var g=this.buckets[h],m=g.layers[0].sourceLayer||"_geojsonTileLayer",S=s[m],M=t[m];if(S&&M&&Object.keys(M).length!==0){g.update(M,S,this.imageAtlas&&this.imageAtlas.patternPositions||{});var k=a&&a.style&&a.style.getLayer(h);k&&(this.queryPadding=Math.max(this.queryPadding,k.queryRadius(g)))}}}},ls.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},ls.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<ci.now()},ls.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},ls.prototype.setHoldDuration=function(t){this.symbolFadeHoldUntil=ci.now()+t},ls.prototype.setDependencies=function(t,a){for(var s={},h=0,g=a;h<g.length;h+=1)s[g[h]]=!0;this.dependencies[t]=s},ls.prototype.hasDependency=function(t,a){for(var s=0,h=t;s<h.length;s+=1){var g=this.dependencies[h[s]];if(g){for(var m=0,S=a;m<S.length;m+=1)if(g[S[m]])return!0}}return!1};var Mf=K.performance,nl=function(t){this._marks={start:[t.url,"start"].join("#"),end:[t.url,"end"].join("#"),measure:t.url.toString()},Mf.mark(this._marks.start)};nl.prototype.finish=function(){Mf.mark(this._marks.end);var t=Mf.getEntriesByName(this._marks.measure);return t.length===0&&(Mf.measure(this._marks.measure,this._marks.start,this._marks.end),t=Mf.getEntriesByName(this._marks.measure),Mf.clearMarks(this._marks.start),Mf.clearMarks(this._marks.end),Mf.clearMeasures(this._marks.measure)),t},v.Actor=Ea,v.AlphaImage=yu,v.CanonicalTileID=Af,v.CollisionBoxArray=f,v.Color=Bi,v.DEMData=rl,v.DataConstantProperty=Mn,v.DictionaryCoder=Cs,v.EXTENT=8192,v.ErrorEvent=Ge,v.EvaluationParameters=Si,v.Event=Pe,v.Evented=tt,v.FeatureIndex=Hl,v.FillBucket=Ys,v.FillExtrusionBucket=Ss,v.ImageAtlas=_r,v.ImagePosition=ut,v.LineBucket=ra,v.LngLat=pa,v.LngLatBounds=Da,v.MercatorCoordinate=El,v.ONE_EM=24,v.OverscaledTileID=Xo,v.Point=ne,v.Point$1=ne,v.Properties=Jo,v.Protobuf=Cf,v.RGBAImage=wo,v.RequestManager=Vi,v.RequestPerformance=nl,v.ResourceType=on,v.SegmentVector=fe,v.SourceFeatureState=nh,v.StructArrayLayout1ui2=pc,v.StructArrayLayout2f1f2i16=Bl,v.StructArrayLayout2i4=Ru,v.StructArrayLayout3ui6=ml,v.StructArrayLayout4i8=iu,v.SymbolBucket=De,v.Texture=dn,v.Tile=ls,v.Transitionable=Go,v.Uniform1f=Ir,v.Uniform1i=cr,v.Uniform2f=Or,v.Uniform3f=tn,v.Uniform4f=Rn,v.UniformColor=Fn,v.UniformMatrix4f=Li,v.UnwrappedTileID=mv,v.ValidationError=Re,v.WritingMode=kr,v.ZoomHistory=uf,v.add=function(t,a,s){return t[0]=a[0]+s[0],t[1]=a[1]+s[1],t[2]=a[2]+s[2],t},v.addDynamicAttributes=je,v.asyncAll=function(t,a,s){if(!t.length)return s(null,[]);var h=t.length,g=new Array(t.length),m=null;t.forEach(function(S,M){a(S,function(k,z){k&&(m=k),g[M]=z,--h==0&&s(m,g)})})},v.bezier=Ve,v.bindAll=kt,v.browser=ci,v.cacheEntryPossiblyAdded=function(t){++pi>Er&&(t.getActor().send("enforceCacheSizeLimit",tr),pi=0)},v.clamp=ot,v.clearTileCache=function(t){var a=K.caches.delete("mapbox-tiles");t&&a.catch(t).then(function(){return t()})},v.clipLine=yo,v.clone=function(t){var a=new ta(16);return a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[8]=t[8],a[9]=t[9],a[10]=t[10],a[11]=t[11],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15],a},v.clone$1=Ye,v.clone$2=function(t){var a=new ta(3);return a[0]=t[0],a[1]=t[1],a[2]=t[2],a},v.collisionCircleLayout=Ad,v.config=Zn,v.create=function(){var t=new ta(16);return ta!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},v.create$1=function(){var t=new ta(9);return ta!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},v.create$2=function(){var t=new ta(4);return ta!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},v.createCommonjsModule=Q,v.createExpression=ac,v.createLayout=Ta,v.createStyleLayer=function(t){return t.type==="custom"?new Br(t):new nn[t.type](t)},v.cross=function(t,a,s){var h=a[0],g=a[1],m=a[2],S=s[0],M=s[1],k=s[2];return t[0]=g*k-m*M,t[1]=m*S-h*k,t[2]=h*M-g*S,t},v.deepEqual=function t(a,s){if(Array.isArray(a)){if(!Array.isArray(s)||a.length!==s.length)return!1;for(var h=0;h<a.length;h++)if(!t(a[h],s[h]))return!1;return!0}if(typeof a=="object"&&a!==null&&s!==null){if(typeof s!="object"||Object.keys(a).length!==Object.keys(s).length)return!1;for(var g in a)if(!t(a[g],s[g]))return!1;return!0}return a===s},v.dot=function(t,a){return t[0]*a[0]+t[1]*a[1]+t[2]*a[2]},v.dot$1=function(t,a){return t[0]*a[0]+t[1]*a[1]+t[2]*a[2]+t[3]*a[3]},v.ease=ke,v.emitValidationErrors=Bc,v.endsWith=Y,v.enforceCacheSizeLimit=function(t){$r(),Ki&&Ki.then(function(a){a.keys().then(function(s){for(var h=0;h<s.length-t;h++)a.delete(s[h])})})},v.evaluateSizeForFeature=$n,v.evaluateSizeForZoom=ui,v.evaluateVariableOffset=Gl,v.evented=Gf,v.extend=pt,v.featureFilter=Ol,v.filterObject=st,v.fromRotation=function(t,a){var s=Math.sin(a),h=Math.cos(a);return t[0]=h,t[1]=s,t[2]=0,t[3]=-s,t[4]=h,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},v.getAnchorAlignment=Kr,v.getAnchorJustification=Ae,v.getArrayBuffer=Fa,v.getImage=ee,v.getJSON=function(t,a){return Zo(pt(t,{type:"json"}),a)},v.getRTLTextPluginStatus=ff,v.getReferrer=Ii,v.getVideo=function(t,a){var s,h,g=K.document.createElement("video");g.muted=!0,g.onloadstart=function(){a(null,g)};for(var m=0;m<t.length;m++){var S=K.document.createElement("source");s=t[m],h=void 0,(h=K.document.createElement("a")).href=s,(h.protocol!==K.document.location.protocol||h.host!==K.document.location.host)&&(g.crossOrigin="Anonymous"),S.src=t[m],g.appendChild(S)}return{cancel:function(){}}},v.identity=Es,v.invert=function(t,a){var s=a[0],h=a[1],g=a[2],m=a[3],S=a[4],M=a[5],k=a[6],z=a[7],V=a[8],H=a[9],te=a[10],se=a[11],Me=a[12],Ie=a[13],qe=a[14],ze=a[15],at=s*M-h*S,bt=s*k-g*S,Ut=s*z-m*S,Ht=h*k-g*M,or=h*z-m*M,Ar=g*z-m*k,Vr=V*Ie-H*Me,kn=V*qe-te*Me,an=V*ze-se*Me,zn=H*qe-te*Ie,ln=H*ze-se*Ie,Pi=te*ze-se*qe,ti=at*Pi-bt*ln+Ut*zn+Ht*an-or*kn+Ar*Vr;return ti?(t[0]=(M*Pi-k*ln+z*zn)*(ti=1/ti),t[1]=(g*ln-h*Pi-m*zn)*ti,t[2]=(Ie*Ar-qe*or+ze*Ht)*ti,t[3]=(te*or-H*Ar-se*Ht)*ti,t[4]=(k*an-S*Pi-z*kn)*ti,t[5]=(s*Pi-g*an+m*kn)*ti,t[6]=(qe*Ut-Me*Ar-ze*bt)*ti,t[7]=(V*Ar-te*Ut+se*bt)*ti,t[8]=(S*ln-M*an+z*Vr)*ti,t[9]=(h*an-s*ln-m*Vr)*ti,t[10]=(Me*or-Ie*Ut+ze*at)*ti,t[11]=(H*Ut-V*or-se*at)*ti,t[12]=(M*kn-S*zn-k*Vr)*ti,t[13]=(s*zn-h*kn+g*Vr)*ti,t[14]=(Ie*bt-Me*Ht-qe*at)*ti,t[15]=(V*Ht-H*bt+te*at)*ti,t):null},v.isChar=zr,v.isMapboxURL=Oi,v.keysDifference=function(t,a){var s=[];for(var h in t)h in a||s.push(h);return s},v.makeRequest=Zo,v.mapObject=Wt,v.mercatorXfromLng=Ls,v.mercatorYfromLat=lu,v.mercatorZfromAltitude=kh,v.mul=Vc,v.multiply=ss,v.mvt=uu,v.nextPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},v.normalize=function(t,a){var s=a[0],h=a[1],g=a[2],m=s*s+h*h+g*g;return m>0&&(m=1/Math.sqrt(m)),t[0]=a[0]*m,t[1]=a[1]*m,t[2]=a[2]*m,t},v.number=ga,v.offscreenCanvasSupported=qn,v.ortho=function(t,a,s,h,g,m,S){var M=1/(a-s),k=1/(h-g),z=1/(m-S);return t[0]=-2*M,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*k,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*z,t[11]=0,t[12]=(a+s)*M,t[13]=(g+h)*k,t[14]=(S+m)*z,t[15]=1,t},v.parseGlyphPBF=function(t){return new Cf(t).readFields(Tr,[])},v.pbf=Cf,v.performSymbolLayout=function(t,a,s,h,g,m,S){t.createArrays(),t.tilePixelRatio=8192/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;var M=t.layers[0].layout,k=t.layers[0]._unevaluatedLayout._values,z={};if(t.textSizeData.kind==="composite"){var V=t.textSizeData,H=V.maxZoom;z.compositeTextSizes=[k["text-size"].possiblyEvaluate(new Si(V.minZoom),S),k["text-size"].possiblyEvaluate(new Si(H),S)]}if(t.iconSizeData.kind==="composite"){var te=t.iconSizeData,se=te.maxZoom;z.compositeIconSizes=[k["icon-size"].possiblyEvaluate(new Si(te.minZoom),S),k["icon-size"].possiblyEvaluate(new Si(se),S)]}z.layoutTextSize=k["text-size"].possiblyEvaluate(new Si(t.zoom+1),S),z.layoutIconSize=k["icon-size"].possiblyEvaluate(new Si(t.zoom+1),S),z.textMaxSize=k["text-size"].possiblyEvaluate(new Si(18));for(var Me=24*M.get("text-line-height"),Ie=M.get("text-rotation-alignment")==="map"&&M.get("symbol-placement")!=="point",qe=M.get("text-keep-upright"),ze=M.get("text-size"),at=function(){var Ht=Ut[bt],or=M.get("text-font").evaluate(Ht,{},S).join(","),Ar=ze.evaluate(Ht,{},S),Vr=z.layoutTextSize.evaluate(Ht,{},S),kn=z.layoutIconSize.evaluate(Ht,{},S),an={horizontal:{},vertical:void 0},zn=Ht.text,ln=[0,0];if(zn){var Pi=zn.toString(),ti=24*M.get("text-letter-spacing").evaluate(Ht,{},S),Sn=function(Hi){for(var Oa=0,Sa=Hi;Oa<Sa.length;Oa+=1)if(ia=Sa[Oa].charCodeAt(0),zr.Arabic(ia)||zr["Arabic Supplement"](ia)||zr["Arabic Extended-A"](ia)||zr["Arabic Presentation Forms-A"](ia)||zr["Arabic Presentation Forms-B"](ia))return!1;var ia;return!0}(Pi)?ti:0,Zi=M.get("text-anchor").evaluate(Ht,{},S),li=M.get("text-variable-anchor");if(!li){var na=M.get("text-radial-offset").evaluate(Ht,{},S);ln=na?Gl(Zi,[24*na,Ao]):M.get("text-offset").evaluate(Ht,{},S).map(function(Hi){return 24*Hi})}var Vn=Ie?"center":M.get("text-justify").evaluate(Ht,{},S),Qi=M.get("symbol-placement"),Ka=Qi==="point"?24*M.get("text-max-width").evaluate(Ht,{},S):0,vo=function(){t.allowVerticalPlacement&&fc(Pi)&&(an.vertical=qr(zn,a,s,g,or,Ka,Me,Zi,"left",Sn,ln,kr.vertical,!0,Qi,Vr,Ar))};if(!Ie&&li){for(var lo=Vn==="auto"?li.map(function(Hi){return Ae(Hi)}):[Vn],ja=!1,mo=0;mo<lo.length;mo++){var Yo=lo[mo];if(!an.horizontal[Yo])if(ja)an.horizontal[Yo]=an.horizontal[0];else{var zo=qr(zn,a,s,g,or,Ka,Me,"center",Yo,Sn,ln,kr.horizontal,!1,Qi,Vr,Ar);zo&&(an.horizontal[Yo]=zo,ja=zo.positionedLines.length===1)}}vo()}else{Vn==="auto"&&(Vn=Ae(Zi));var qs=qr(zn,a,s,g,or,Ka,Me,Zi,Vn,Sn,ln,kr.horizontal,!1,Qi,Vr,Ar);qs&&(an.horizontal[Vn]=qs),vo(),fc(Pi)&&Ie&&qe&&(an.vertical=qr(zn,a,s,g,or,Ka,Me,Zi,Vn,Sn,ln,kr.vertical,!1,Qi,Vr,Ar))}}var cs=void 0,Bs=!1;if(Ht.icon&&Ht.icon.name){var xo=h[Ht.icon.name];xo&&(cs=function(Hi,Oa,Sa){var ia=Kr(Sa),zs=Oa[0]-Hi.displaySize[0]*ia.horizontalAlign,Ts=Oa[1]-Hi.displaySize[1]*ia.verticalAlign;return{image:Hi,top:Ts,bottom:Ts+Hi.displaySize[1],left:zs,right:zs+Hi.displaySize[0]}}(g[Ht.icon.name],M.get("icon-offset").evaluate(Ht,{},S),M.get("icon-anchor").evaluate(Ht,{},S)),Bs=xo.sdf,t.sdfIcons===void 0?t.sdfIcons=xo.sdf:t.sdfIcons!==xo.sdf&&Je("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(xo.pixelRatio!==t.pixelRatio||M.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}var fs=St(an.horizontal)||an.vertical;t.iconsInText=!!fs&&fs.iconsInText,(fs||cs)&&function(Hi,Oa,Sa,ia,zs,Ts,Ga,Mo,As,da,Wl){var _u=Ts.textMaxSize.evaluate(Oa,{});_u===void 0&&(_u=Ga);var Xl,bo=Hi.layers[0].layout,Yl=bo.get("icon-offset").evaluate(Oa,{},Wl),il=St(Sa.horizontal),ih=Ga/24,qo=Hi.tilePixelRatio*ih,ah=Hi.tilePixelRatio*_u/24,Ec=Hi.tilePixelRatio*Mo,oh=Hi.tilePixelRatio*bo.get("symbol-spacing"),fp=bo.get("text-padding")*Hi.tilePixelRatio,sh=bo.get("icon-padding")*Hi.tilePixelRatio,Dh=bo.get("text-max-angle")/180*Math.PI,hp=bo.get("text-rotation-alignment")==="map"&&bo.get("symbol-placement")!=="point",pp=bo.get("icon-rotation-alignment")==="map"&&bo.get("symbol-placement")!=="point",Sc=bo.get("symbol-placement"),Fh=oh/2,uh=bo.get("icon-text-fit");ia&&uh!=="none"&&(Hi.allowVerticalPlacement&&Sa.vertical&&(Xl=ei(ia,Sa.vertical,uh,bo.get("icon-text-fit-padding"),Yl,ih)),il&&(ia=ei(ia,il,uh,bo.get("icon-text-fit-padding"),Yl,ih)));var Xc=function(gm,bp){bp.x<0||bp.x>=8192||bp.y<0||bp.y>=8192||function(Po,Kl,ym,Pf,Ld,xv,Qp,wc,ed,If,$l,Ep,td,kd,hh,Dd,Sp,Fd,Nd,bv,Zu,rd,Bd,Jl,Ev){var nd,Of,Zh,Vh,ph,jh=Po.addToLineVertexArray(Kl,ym),zd=0,Ud=0,Zd=0,Vd=0,jd=-1,Gd=-1,Yc={},Sv=Te(""),Hd=0,Wd=0;if(wc._unevaluatedLayout.getValue("text-radial-offset")===void 0?(Hd=(nd=wc.layout.get("text-offset").evaluate(Zu,{},Jl).map(function(Wh){return 24*Wh}))[0],Wd=nd[1]):(Hd=24*wc.layout.get("text-radial-offset").evaluate(Zu,{},Jl),Wd=Ao),Po.allowVerticalPlacement&&Pf.vertical){var wv=wc.layout.get("text-rotate").evaluate(Zu,{},Jl)+90;Vh=new Wo(ed,Kl,If,$l,Ep,Pf.vertical,td,kd,hh,wv),Qp&&(ph=new Wo(ed,Kl,If,$l,Ep,Qp,Sp,Fd,hh,wv))}if(Ld){var id=wc.layout.get("icon-rotate").evaluate(Zu,{}),Xd=wc.layout.get("icon-text-fit")!=="none",Yd=Bn(Ld,id,Bd,Xd),wp=Qp?Bn(Qp,id,Bd,Xd):void 0;Zh=new Wo(ed,Kl,If,$l,Ep,Ld,Sp,Fd,!1,id),zd=4*Yd.length;var qd=Po.iconSizeData,Gh=null;qd.kind==="source"?(Gh=[128*wc.layout.get("icon-size").evaluate(Zu,{})])[0]>32640&&Je(Po.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):qd.kind==="composite"&&((Gh=[128*rd.compositeIconSizes[0].evaluate(Zu,{},Jl),128*rd.compositeIconSizes[1].evaluate(Zu,{},Jl)])[0]>32640||Gh[1]>32640)&&Je(Po.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),Po.addSymbols(Po.icon,Yd,Gh,bv,Nd,Zu,!1,Kl,jh.lineStartIndex,jh.lineLength,-1,Jl),jd=Po.icon.placedSymbolArray.length-1,wp&&(Ud=4*wp.length,Po.addSymbols(Po.icon,wp,Gh,bv,Nd,Zu,kr.vertical,Kl,jh.lineStartIndex,jh.lineLength,-1,Jl),Gd=Po.icon.placedSymbolArray.length-1)}for(var Hh in Pf.horizontal){var ad=Pf.horizontal[Hh];if(!Of){Sv=Te(ad.text);var Rf=wc.layout.get("text-rotate").evaluate(Zu,{},Jl);Of=new Wo(ed,Kl,If,$l,Ep,ad,td,kd,hh,Rf)}var Kd=ad.positionedLines.length===1;if(Zd+=Bt(Po,Kl,ad,xv,wc,hh,Zu,Dd,jh,Pf.vertical?kr.horizontal:kr.horizontalOnly,Kd?Object.keys(Pf.horizontal):[Hh],Yc,jd,rd,Jl),Kd)break}Pf.vertical&&(Vd+=Bt(Po,Kl,Pf.vertical,xv,wc,hh,Zu,Dd,jh,kr.vertical,["vertical"],Yc,Gd,rd,Jl));var Cv=Of?Of.boxStartIndex:Po.collisionBoxArray.length,Tv=Of?Of.boxEndIndex:Po.collisionBoxArray.length,Av=Vh?Vh.boxStartIndex:Po.collisionBoxArray.length,_m=Vh?Vh.boxEndIndex:Po.collisionBoxArray.length,xm=Zh?Zh.boxStartIndex:Po.collisionBoxArray.length,bm=Zh?Zh.boxEndIndex:Po.collisionBoxArray.length,Em=ph?ph.boxStartIndex:Po.collisionBoxArray.length,Sm=ph?ph.boxEndIndex:Po.collisionBoxArray.length,Ql=-1,Cp=function(Wh,Mv){return Wh&&Wh.circleDiameter?Math.max(Wh.circleDiameter,Mv):Mv};Ql=Cp(Of,Ql),Ql=Cp(Vh,Ql),Ql=Cp(Zh,Ql);var $d=(Ql=Cp(ph,Ql))>-1?1:0;$d&&(Ql*=Ev/24),Po.glyphOffsetArray.length>=De.MAX_GLYPHS&&Je("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Zu.sortKey!==void 0&&Po.addToSortKeyRanges(Po.symbolInstances.length,Zu.sortKey),Po.symbolInstances.emplaceBack(Kl.x,Kl.y,Yc.right>=0?Yc.right:-1,Yc.center>=0?Yc.center:-1,Yc.left>=0?Yc.left:-1,Yc.vertical||-1,jd,Gd,Sv,Cv,Tv,Av,_m,xm,bm,Em,Sm,If,Zd,Vd,zd,Ud,$d,0,td,Hd,Wd,Ql)}(Hi,bp,gm,Sa,ia,zs,Xl,Hi.layers[0],Hi.collisionBoxArray,Oa.index,Oa.sourceLayerIndex,Hi.index,qo,fp,hp,As,Ec,sh,pp,Yl,Oa,Ts,da,Wl,Ga)};if(Sc==="line")for(var lh=0,dp=yo(Oa.geometry,0,0,8192,8192);lh<dp.length;lh+=1)for(var vp=dp[lh],mp=0,gp=Ho(vp,oh,Dh,Sa.vertical||il,ia,24,ah,Hi.overscaling,8192);mp<gp.length;mp+=1){var $p=gp[mp];il&&fn(Hi,il.text,Fh,$p)||Xc(vp,$p)}else if(Sc==="line-center")for(var yp=0,Nh=Oa.geometry;yp<Nh.length;yp+=1){var _p=Nh[yp];if(_p.length>1){var Jp=Va(_p,Dh,Sa.vertical||il,ia,24,ah);Jp&&Xc(_p,Jp)}}else if(Oa.type==="Polygon")for(var ch=0,xp=$f(Oa.geometry,0);ch<xp.length;ch+=1){var fh=xp[ch],Bh=ai(fh,16);Xc(fh[0],new Xr(Bh.x,Bh.y,0))}else if(Oa.type==="LineString")for(var ql=0,zh=Oa.geometry;ql<zh.length;ql+=1){var Uh=zh[ql];Xc(Uh,new Xr(Uh[0].x,Uh[0].y,0))}else if(Oa.type==="Point")for(var Id=0,yv=Oa.geometry;Id<yv.length;Id+=1)for(var Od=0,_v=yv[Id];Od<_v.length;Od+=1){var Rd=_v[Od];Xc([Rd],new Xr(Rd.x,Rd.y,0))}}(t,Ht,an,cs,h,z,Vr,kn,ln,Bs,S)},bt=0,Ut=t.features;bt<Ut.length;bt+=1)at();m&&t.generateCollisionDebugBuffers()},v.perspective=function(t,a,s,h,g){var m,S=1/Math.tan(a/2);return t[0]=S/s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=S,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,g!=null&&g!==1/0?(t[10]=(g+h)*(m=1/(h-g)),t[14]=2*g*h*m):(t[10]=-1,t[14]=-2*h),t},v.pick=function(t,a){for(var s={},h=0;h<a.length;h++){var g=a[h];g in t&&(s[g]=t[g])}return s},v.plugin=Rs,v.polygonIntersectsPolygon=Du,v.postMapLoadEvent=Dt,v.postTurnstileEvent=Ua,v.potpack=Sr,v.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],v.register=pn,v.registerForPluginStateChange=function(t){return t({pluginStatus:Ds,pluginURL:Pu}),Gf.on("pluginStateChange",t),t},v.renderColorRamp=Wf,v.rotate=function(t,a,s){var h=a[0],g=a[1],m=a[2],S=a[3],M=Math.sin(s),k=Math.cos(s);return t[0]=h*k+m*M,t[1]=g*k+S*M,t[2]=h*-M+m*k,t[3]=g*-M+S*k,t},v.rotateX=function(t,a,s){var h=Math.sin(s),g=Math.cos(s),m=a[4],S=a[5],M=a[6],k=a[7],z=a[8],V=a[9],H=a[10],te=a[11];return a!==t&&(t[0]=a[0],t[1]=a[1],t[2]=a[2],t[3]=a[3],t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15]),t[4]=m*g+z*h,t[5]=S*g+V*h,t[6]=M*g+H*h,t[7]=k*g+te*h,t[8]=z*g-m*h,t[9]=V*g-S*h,t[10]=H*g-M*h,t[11]=te*g-k*h,t},v.rotateZ=function(t,a,s){var h=Math.sin(s),g=Math.cos(s),m=a[0],S=a[1],M=a[2],k=a[3],z=a[4],V=a[5],H=a[6],te=a[7];return a!==t&&(t[8]=a[8],t[9]=a[9],t[10]=a[10],t[11]=a[11],t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15]),t[0]=m*g+z*h,t[1]=S*g+V*h,t[2]=M*g+H*h,t[3]=k*g+te*h,t[4]=z*g-m*h,t[5]=V*g-S*h,t[6]=H*g-M*h,t[7]=te*g-k*h,t},v.scale=function(t,a,s){var h=s[0],g=s[1],m=s[2];return t[0]=a[0]*h,t[1]=a[1]*h,t[2]=a[2]*h,t[3]=a[3]*h,t[4]=a[4]*g,t[5]=a[5]*g,t[6]=a[6]*g,t[7]=a[7]*g,t[8]=a[8]*m,t[9]=a[9]*m,t[10]=a[10]*m,t[11]=a[11]*m,t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15],t},v.scale$1=function(t,a,s){return t[0]=a[0]*s,t[1]=a[1]*s,t[2]=a[2]*s,t[3]=a[3]*s,t},v.scale$2=function(t,a,s){return t[0]=a[0]*s,t[1]=a[1]*s,t[2]=a[2]*s,t},v.setCacheLimits=function(t,a){tr=t,Er=a},v.setRTLTextPlugin=function(t,a,s){if(s===void 0&&(s=!1),Ds==="deferred"||Ds==="loading"||Ds==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");Pu=ci.resolveURL(t),Ds="deferred",Mu=a,pl(),s||tu()},v.sphericalToCartesian=function(t){var a=t[0],s=t[1],h=t[2];return s+=90,s*=Math.PI/180,h*=Math.PI/180,{x:a*Math.cos(s)*Math.sin(h),y:a*Math.sin(s)*Math.sin(h),z:a*Math.cos(h)}},v.sqrLen=function(t){var a=t[0],s=t[1];return a*a+s*s},v.styleSpec=ce,v.sub=function(t,a,s){return t[0]=a[0]-s[0],t[1]=a[1]-s[1],t[2]=a[2]-s[2],t},v.symbolSize=zi,v.transformMat3=function(t,a,s){var h=a[0],g=a[1],m=a[2];return t[0]=h*s[0]+g*s[3]+m*s[6],t[1]=h*s[1]+g*s[4]+m*s[7],t[2]=h*s[2]+g*s[5]+m*s[8],t},v.transformMat4=jc,v.translate=function(t,a,s){var h,g,m,S,M,k,z,V,H,te,se,Me,Ie=s[0],qe=s[1],ze=s[2];return a===t?(t[12]=a[0]*Ie+a[4]*qe+a[8]*ze+a[12],t[13]=a[1]*Ie+a[5]*qe+a[9]*ze+a[13],t[14]=a[2]*Ie+a[6]*qe+a[10]*ze+a[14],t[15]=a[3]*Ie+a[7]*qe+a[11]*ze+a[15]):(g=a[1],m=a[2],S=a[3],M=a[4],k=a[5],z=a[6],V=a[7],H=a[8],te=a[9],se=a[10],Me=a[11],t[0]=h=a[0],t[1]=g,t[2]=m,t[3]=S,t[4]=M,t[5]=k,t[6]=z,t[7]=V,t[8]=H,t[9]=te,t[10]=se,t[11]=Me,t[12]=h*Ie+M*qe+H*ze+a[12],t[13]=g*Ie+k*qe+te*ze+a[13],t[14]=m*Ie+z*qe+se*ze+a[14],t[15]=S*Ie+V*qe+Me*ze+a[15]),t},v.triggerPluginCompletionEvent=jf,v.uniqueId=_t,v.validateCustomStyleLayer=function(t){var a=[],s=t.id;return s===void 0&&a.push({message:"layers."+s+': missing required property "id"'}),t.render===void 0&&a.push({message:"layers."+s+': missing required method "render"'}),t.renderingMode&&t.renderingMode!=="2d"&&t.renderingMode!=="3d"&&a.push({message:"layers."+s+': property "renderingMode" must be either "2d" or "3d"'}),a},v.validateLight=lc,v.validateStyle=za,v.values=function(t){var a=[];for(var s in t)a.push(t[s]);return a},v.vectorTile=uu,v.version="1.13.2",v.warnOnce=Je,v.webpSupported=ri,v.window=K,v.wrap=Jt}),j(["./shared"],function(v){"use strict";function Q(G){var ee=typeof G;if(ee==="number"||ee==="boolean"||ee==="string"||G==null)return JSON.stringify(G);if(Array.isArray(G)){for(var ae="[",me=0,Pe=G;me<Pe.length;me+=1)ae+=Q(Pe[me])+",";return ae+"]"}for(var Ge=Object.keys(G).sort(),tt="{",ce=0;ce<Ge.length;ce++)tt+=JSON.stringify(Ge[ce])+":"+Q(G[Ge[ce]])+",";return tt+"}"}function F(G){for(var ee="",ae=0,me=v.refProperties;ae<me.length;ae+=1)ee+="/"+Q(G[me[ae]]);return ee}var J=function(G){this.keyCache={},G&&this.replace(G)};J.prototype.replace=function(G){this._layerConfigs={},this._layers={},this.update(G,[])},J.prototype.update=function(G,ee){for(var ae=this,me=0,Pe=G;me<Pe.length;me+=1){var Ge=Pe[me];this._layerConfigs[Ge.id]=Ge;var tt=this._layers[Ge.id]=v.createStyleLayer(Ge);tt._featureFilter=v.featureFilter(tt.filter),this.keyCache[Ge.id]&&delete this.keyCache[Ge.id]}for(var ce=0,Re=ee;ce<Re.length;ce+=1){var mt=Re[ce];delete this.keyCache[mt],delete this._layerConfigs[mt],delete this._layers[mt]}this.familiesBySource={};for(var hr=0,Ot=function(Dr,Gr){for(var vi={},Qr=0;Qr<Dr.length;Qr++){var An=Gr&&Gr[Dr[Qr].id]||F(Dr[Qr]);Gr&&(Gr[Dr[Qr].id]=An);var Wi=vi[An];Wi||(Wi=vi[An]=[]),Wi.push(Dr[Qr])}var di=[];for(var Ti in vi)di.push(vi[Ti]);return di}(v.values(this._layerConfigs),this.keyCache);hr<Ot.length;hr+=1){var Ft=Ot[hr].map(function(Dr){return ae._layers[Dr.id]}),pr=Ft[0];if(pr.visibility!=="none"){var gn=pr.source||"",un=this.familiesBySource[gn];un||(un=this.familiesBySource[gn]={});var Tt=pr.sourceLayer||"_geojsonTileLayer",Jr=un[Tt];Jr||(Jr=un[Tt]=[]),Jr.push(Ft)}}};var ne=function(G){var ee={},ae=[];for(var me in G){var Pe=G[me],Ge=ee[me]={};for(var tt in Pe){var ce=Pe[+tt];if(ce&&ce.bitmap.width!==0&&ce.bitmap.height!==0){var Re={x:0,y:0,w:ce.bitmap.width+2,h:ce.bitmap.height+2};ae.push(Re),Ge[tt]={rect:Re,metrics:ce.metrics}}}}var mt=v.potpack(ae),hr=new v.AlphaImage({width:mt.w||1,height:mt.h||1});for(var Ot in G){var Ft=G[Ot];for(var pr in Ft){var gn=Ft[+pr];if(gn&&gn.bitmap.width!==0&&gn.bitmap.height!==0){var un=ee[Ot][pr].rect;v.AlphaImage.copy(gn.bitmap,hr,{x:0,y:0},{x:un.x+1,y:un.y+1},gn.bitmap)}}}this.image=hr,this.positions=ee};v.register("GlyphAtlas",ne);var ye=function(G){this.tileID=new v.OverscaledTileID(G.tileID.overscaledZ,G.tileID.wrap,G.tileID.canonical.z,G.tileID.canonical.x,G.tileID.canonical.y),this.uid=G.uid,this.zoom=G.zoom,this.pixelRatio=G.pixelRatio,this.tileSize=G.tileSize,this.source=G.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=G.showCollisionBoxes,this.collectResourceTiming=!!G.collectResourceTiming,this.returnDependencies=!!G.returnDependencies,this.promoteId=G.promoteId};function K(G,ee,ae){for(var me=new v.EvaluationParameters(ee),Pe=0,Ge=G;Pe<Ge.length;Pe+=1)Ge[Pe].recalculate(me,ae)}function Ne(G,ee){var ae=v.getArrayBuffer(G.request,function(me,Pe,Ge,tt){me?ee(me):Pe&&ee(null,{vectorTile:new v.vectorTile.VectorTile(new v.pbf(Pe)),rawData:Pe,cacheControl:Ge,expires:tt})});return function(){ae.cancel(),ee()}}ye.prototype.parse=function(G,ee,ae,me,Pe){var Ge=this;this.status="parsing",this.data=G,this.collisionBoxArray=new v.CollisionBoxArray;var tt=new v.DictionaryCoder(Object.keys(G.layers).sort()),ce=new v.FeatureIndex(this.tileID,this.promoteId);ce.bucketLayerIDs=[];var Re,mt,hr,Ot,Ft={},pr={featureIndex:ce,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ae},gn=ee.familiesBySource[this.source];for(var un in gn){var Tt=G.layers[un];if(Tt){Tt.version===1&&v.warnOnce('Vector tile source "'+this.source+'" layer "'+un+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var Jr=tt.encode(un),Dr=[],Gr=0;Gr<Tt.length;Gr++){var vi=Tt.feature(Gr),Qr=ce.getId(vi,un);Dr.push({feature:vi,id:Qr,index:Gr,sourceLayerIndex:Jr})}for(var An=0,Wi=gn[un];An<Wi.length;An+=1){var di=Wi[An],Ti=di[0];Ti.minzoom&&this.zoom<Math.floor(Ti.minzoom)||Ti.maxzoom&&this.zoom>=Ti.maxzoom||Ti.visibility!=="none"&&(K(di,this.zoom,ae),(Ft[Ti.id]=Ti.createBucket({index:ce.bucketLayerIDs.length,layers:di,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Jr,sourceID:this.source})).populate(Dr,pr,this.tileID.canonical),ce.bucketLayerIDs.push(di.map(function(Ei){return Ei.id})))}}}var _i=v.mapObject(pr.glyphDependencies,function(Ei){return Object.keys(Ei).map(Number)});Object.keys(_i).length?me.send("getGlyphs",{uid:this.uid,stacks:_i},function(Ei,Ai){Re||(Re=Ei,mt=Ai,Aa.call(Ge))}):mt={};var Ct=Object.keys(pr.iconDependencies);Ct.length?me.send("getImages",{icons:Ct,source:this.source,tileID:this.tileID,type:"icons"},function(Ei,Ai){Re||(Re=Ei,hr=Ai,Aa.call(Ge))}):hr={};var qt=Object.keys(pr.patternDependencies);function Aa(){if(Re)return Pe(Re);if(mt&&hr&&Ot){var Ei=new ne(mt),Ai=new v.ImageAtlas(hr,Ot);for(var Bi in Ft){var Yr=Ft[Bi];Yr instanceof v.SymbolBucket?(K(Yr.layers,this.zoom,ae),v.performSymbolLayout(Yr,mt,Ei.positions,hr,Ai.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):Yr.hasPattern&&(Yr instanceof v.LineBucket||Yr instanceof v.FillBucket||Yr instanceof v.FillExtrusionBucket)&&(K(Yr.layers,this.zoom,ae),Yr.addFeatures(pr,this.tileID.canonical,Ai.patternPositions))}this.status="done",Pe(null,{buckets:v.values(Ft).filter(function(wn){return!wn.isEmpty()}),featureIndex:ce,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ei.image,imageAtlas:Ai,glyphMap:this.returnDependencies?mt:null,iconMap:this.returnDependencies?hr:null,glyphPositions:this.returnDependencies?Ei.positions:null})}}qt.length?me.send("getImages",{icons:qt,source:this.source,tileID:this.tileID,type:"patterns"},function(Ei,Ai){Re||(Re=Ei,Ot=Ai,Aa.call(Ge))}):Ot={},Aa.call(this)};var Ve=function(G,ee,ae,me){this.actor=G,this.layerIndex=ee,this.availableImages=ae,this.loadVectorData=me||Ne,this.loading={},this.loaded={}};Ve.prototype.loadTile=function(G,ee){var ae=this,me=G.uid;this.loading||(this.loading={});var Pe=!!(G&&G.request&&G.request.collectResourceTiming)&&new v.RequestPerformance(G.request),Ge=this.loading[me]=new ye(G);Ge.abort=this.loadVectorData(G,function(tt,ce){if(delete ae.loading[me],tt||!ce)return Ge.status="done",ae.loaded[me]=Ge,ee(tt);var Re=ce.rawData,mt={};ce.expires&&(mt.expires=ce.expires),ce.cacheControl&&(mt.cacheControl=ce.cacheControl);var hr={};if(Pe){var Ot=Pe.finish();Ot&&(hr.resourceTiming=JSON.parse(JSON.stringify(Ot)))}Ge.vectorTile=ce.vectorTile,Ge.parse(ce.vectorTile,ae.layerIndex,ae.availableImages,ae.actor,function(Ft,pr){if(Ft||!pr)return ee(Ft);ee(null,v.extend({rawTileData:Re.slice(0)},pr,mt,hr))}),ae.loaded=ae.loaded||{},ae.loaded[me]=Ge})},Ve.prototype.reloadTile=function(G,ee){var ae=this,me=this.loaded,Pe=G.uid,Ge=this;if(me&&me[Pe]){var tt=me[Pe];tt.showCollisionBoxes=G.showCollisionBoxes;var ce=function(Re,mt){var hr=tt.reloadCallback;hr&&(delete tt.reloadCallback,tt.parse(tt.vectorTile,Ge.layerIndex,ae.availableImages,Ge.actor,hr)),ee(Re,mt)};tt.status==="parsing"?tt.reloadCallback=ce:tt.status==="done"&&(tt.vectorTile?tt.parse(tt.vectorTile,this.layerIndex,this.availableImages,this.actor,ce):ce())}},Ve.prototype.abortTile=function(G,ee){var ae=this.loading,me=G.uid;ae&&ae[me]&&ae[me].abort&&(ae[me].abort(),delete ae[me]),ee()},Ve.prototype.removeTile=function(G,ee){var ae=this.loaded,me=G.uid;ae&&ae[me]&&delete ae[me],ee()};var ke=v.window.ImageBitmap,ot=function(){this.loaded={}};function Jt(G,ee){if(G.length!==0){pt(G[0],ee);for(var ae=1;ae<G.length;ae++)pt(G[ae],!ee)}}function pt(G,ee){for(var ae=0,me=0,Pe=G.length,Ge=Pe-1;me<Pe;Ge=me++)ae+=(G[me][0]-G[Ge][0])*(G[Ge][1]+G[me][1]);ae>=0!=!!ee&&G.reverse()}ot.prototype.loadTile=function(G,ee){var ae=G.uid,me=G.encoding,Pe=G.rawImageData,Ge=ke&&Pe instanceof ke?this.getImageData(Pe):Pe,tt=new v.DEMData(ae,Ge,me);this.loaded=this.loaded||{},this.loaded[ae]=tt,ee(null,tt)},ot.prototype.getImageData=function(G){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(G.width,G.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=G.width,this.offscreenCanvas.height=G.height,this.offscreenCanvasContext.drawImage(G,0,0,G.width,G.height);var ee=this.offscreenCanvasContext.getImageData(-1,-1,G.width+2,G.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new v.RGBAImage({width:ee.width,height:ee.height},ee.data)},ot.prototype.removeTile=function(G){var ee=this.loaded,ae=G.uid;ee&&ee[ae]&&delete ee[ae]};var Zt=v.vectorTile.VectorTileFeature.prototype.toGeoJSON,_t=function(G){this._feature=G,this.extent=v.EXTENT,this.type=G.type,this.properties=G.tags,"id"in G&&!isNaN(G.id)&&(this.id=parseInt(G.id,10))};_t.prototype.loadGeometry=function(){if(this._feature.type===1){for(var G=[],ee=0,ae=this._feature.geometry;ee<ae.length;ee+=1){var me=ae[ee];G.push([new v.Point$1(me[0],me[1])])}return G}for(var Pe=[],Ge=0,tt=this._feature.geometry;Ge<tt.length;Ge+=1){for(var ce=[],Re=0,mt=tt[Ge];Re<mt.length;Re+=1){var hr=mt[Re];ce.push(new v.Point$1(hr[0],hr[1]))}Pe.push(ce)}return Pe},_t.prototype.toGeoJSON=function(G,ee,ae){return Zt.call(this,G,ee,ae)};var nt=function(G){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=v.EXTENT,this.length=G.length,this._features=G};nt.prototype.feature=function(G){return new _t(this._features[G])};var et=v.vectorTile.VectorTileFeature,kt=Y;function Y(G,ee){this.options=ee||{},this.features=G,this.length=G.length}function Wt(G,ee){this.id=typeof G.id=="number"?G.id:void 0,this.type=G.type,this.rawGeometry=G.type===1?[G.geometry]:G.geometry,this.properties=G.tags,this.extent=ee||4096}Y.prototype.feature=function(G){return new Wt(this.features[G],this.options.extent)},Wt.prototype.loadGeometry=function(){var G=this.rawGeometry;this.geometry=[];for(var ee=0;ee<G.length;ee++){for(var ae=G[ee],me=[],Pe=0;Pe<ae.length;Pe++)me.push(new v.Point$1(ae[Pe][0],ae[Pe][1]));this.geometry.push(me)}return this.geometry},Wt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var G=this.geometry,ee=1/0,ae=-1/0,me=1/0,Pe=-1/0,Ge=0;Ge<G.length;Ge++)for(var tt=G[Ge],ce=0;ce<tt.length;ce++){var Re=tt[ce];ee=Math.min(ee,Re.x),ae=Math.max(ae,Re.x),me=Math.min(me,Re.y),Pe=Math.max(Pe,Re.y)}return[ee,me,ae,Pe]},Wt.prototype.toGeoJSON=et.prototype.toGeoJSON;var st=ct,Ye=kt;function ct(G){var ee=new v.pbf;return function(ae,me){for(var Pe in ae.layers)me.writeMessage(3,Je,ae.layers[Pe])}(G,ee),ee.finish()}function Je(G,ee){var ae;ee.writeVarintField(15,G.version||1),ee.writeStringField(1,G.name||""),ee.writeVarintField(5,G.extent||4096);var me={keys:[],values:[],keycache:{},valuecache:{}};for(ae=0;ae<G.length;ae++)me.feature=G.feature(ae),ee.writeMessage(2,Rt,me);var Pe=me.keys;for(ae=0;ae<Pe.length;ae++)ee.writeStringField(3,Pe[ae]);var Ge=me.values;for(ae=0;ae<Ge.length;ae++)ee.writeMessage(4,we,Ge[ae])}function Rt(G,ee){var ae=G.feature;ae.id!==void 0&&ee.writeVarintField(1,ae.id),ee.writeMessage(2,dr,G),ee.writeVarintField(3,ae.type),ee.writeMessage(4,C,ae)}function dr(G,ee){var ae=G.feature,me=G.keys,Pe=G.values,Ge=G.keycache,tt=G.valuecache;for(var ce in ae.properties){var Re=Ge[ce];Re===void 0&&(me.push(ce),Ge[ce]=Re=me.length-1),ee.writeVarint(Re);var mt=ae.properties[ce],hr=typeof mt;hr!=="string"&&hr!=="boolean"&&hr!=="number"&&(mt=JSON.stringify(mt));var Ot=hr+":"+mt,Ft=tt[Ot];Ft===void 0&&(Pe.push(mt),tt[Ot]=Ft=Pe.length-1),ee.writeVarint(Ft)}}function Mr(G,ee){return(ee<<3)+(7&G)}function jr(G){return G<<1^G>>31}function C(G,ee){for(var ae=G.loadGeometry(),me=G.type,Pe=0,Ge=0,tt=ae.length,ce=0;ce<tt;ce++){var Re=ae[ce],mt=1;me===1&&(mt=Re.length),ee.writeVarint(Mr(1,mt));for(var hr=me===3?Re.length-1:Re.length,Ot=0;Ot<hr;Ot++){Ot===1&&me!==1&&ee.writeVarint(Mr(2,hr-1));var Ft=Re[Ot].x-Pe,pr=Re[Ot].y-Ge;ee.writeVarint(jr(Ft)),ee.writeVarint(jr(pr)),Pe+=Ft,Ge+=pr}me===3&&ee.writeVarint(Mr(7,1))}}function we(G,ee){var ae=typeof G;ae==="string"?ee.writeStringField(1,G):ae==="boolean"?ee.writeBooleanField(7,G):ae==="number"&&(G%1!=0?ee.writeDoubleField(3,G):G<0?ee.writeSVarintField(6,G):ee.writeVarintField(5,G))}function Le(G,ee,ae,me){Et(G,ae,me),Et(ee,2*ae,2*me),Et(ee,2*ae+1,2*me+1)}function Et(G,ee,ae){var me=G[ee];G[ee]=G[ae],G[ae]=me}function gt(G,ee,ae,me){var Pe=G-ae,Ge=ee-me;return Pe*Pe+Ge*Ge}st.fromVectorTileJs=ct,st.fromGeojsonVt=function(G,ee){ee=ee||{};var ae={};for(var me in G)ae[me]=new kt(G[me].features,ee),ae[me].name=me,ae[me].version=ee.version,ae[me].extent=ee.extent;return ct({layers:ae})},st.GeoJSONWrapper=Ye;var Lt=function(G){return G[0]},Yt=function(G){return G[1]},br=function(G,ee,ae,me,Pe){ee===void 0&&(ee=Lt),ae===void 0&&(ae=Yt),me===void 0&&(me=64),Pe===void 0&&(Pe=Float64Array),this.nodeSize=me,this.points=G;for(var Ge=G.length<65536?Uint16Array:Uint32Array,tt=this.ids=new Ge(G.length),ce=this.coords=new Pe(2*G.length),Re=0;Re<G.length;Re++)tt[Re]=Re,ce[2*Re]=ee(G[Re]),ce[2*Re+1]=ae(G[Re]);(function mt(hr,Ot,Ft,pr,gn,un){if(!(gn-pr<=Ft)){var Tt=pr+gn>>1;(function Jr(Dr,Gr,vi,Qr,An,Wi){for(;An>Qr;){if(An-Qr>600){var di=An-Qr+1,Ti=vi-Qr+1,_i=Math.log(di),Ct=.5*Math.exp(2*_i/3),qt=.5*Math.sqrt(_i*Ct*(di-Ct)/di)*(Ti-di/2<0?-1:1);Jr(Dr,Gr,vi,Math.max(Qr,Math.floor(vi-Ti*Ct/di+qt)),Math.min(An,Math.floor(vi+(di-Ti)*Ct/di+qt)),Wi)}var Aa=Gr[2*vi+Wi],Ei=Qr,Ai=An;for(Le(Dr,Gr,Qr,vi),Gr[2*An+Wi]>Aa&&Le(Dr,Gr,Qr,An);Ei<Ai;){for(Le(Dr,Gr,Ei,Ai),Ei++,Ai--;Gr[2*Ei+Wi]<Aa;)Ei++;for(;Gr[2*Ai+Wi]>Aa;)Ai--}Gr[2*Qr+Wi]===Aa?Le(Dr,Gr,Qr,Ai):Le(Dr,Gr,++Ai,An),Ai<=vi&&(Qr=Ai+1),vi<=Ai&&(An=Ai-1)}})(hr,Ot,Tt,pr,gn,un%2),mt(hr,Ot,Ft,pr,Tt-1,un+1),mt(hr,Ot,Ft,Tt+1,gn,un+1)}})(tt,ce,me,0,tt.length-1,0)};br.prototype.range=function(G,ee,ae,me){return function(Pe,Ge,tt,ce,Re,mt,hr){for(var Ot,Ft,pr=[0,Pe.length-1,0],gn=[];pr.length;){var un=pr.pop(),Tt=pr.pop(),Jr=pr.pop();if(Tt-Jr<=hr)for(var Dr=Jr;Dr<=Tt;Dr++)Ft=Ge[2*Dr+1],(Ot=Ge[2*Dr])>=tt&&Ot<=Re&&Ft>=ce&&Ft<=mt&&gn.push(Pe[Dr]);else{var Gr=Math.floor((Jr+Tt)/2);Ft=Ge[2*Gr+1],(Ot=Ge[2*Gr])>=tt&&Ot<=Re&&Ft>=ce&&Ft<=mt&&gn.push(Pe[Gr]);var vi=(un+1)%2;(un===0?tt<=Ot:ce<=Ft)&&(pr.push(Jr),pr.push(Gr-1),pr.push(vi)),(un===0?Re>=Ot:mt>=Ft)&&(pr.push(Gr+1),pr.push(Tt),pr.push(vi))}}return gn}(this.ids,this.coords,G,ee,ae,me,this.nodeSize)},br.prototype.within=function(G,ee,ae){return function(me,Pe,Ge,tt,ce,Re){for(var mt=[0,me.length-1,0],hr=[],Ot=ce*ce;mt.length;){var Ft=mt.pop(),pr=mt.pop(),gn=mt.pop();if(pr-gn<=Re)for(var un=gn;un<=pr;un++)gt(Pe[2*un],Pe[2*un+1],Ge,tt)<=Ot&&hr.push(me[un]);else{var Tt=Math.floor((gn+pr)/2),Jr=Pe[2*Tt],Dr=Pe[2*Tt+1];gt(Jr,Dr,Ge,tt)<=Ot&&hr.push(me[Tt]);var Gr=(Ft+1)%2;(Ft===0?Ge-ce<=Jr:tt-ce<=Dr)&&(mt.push(gn),mt.push(Tt-1),mt.push(Gr)),(Ft===0?Ge+ce>=Jr:tt+ce>=Dr)&&(mt.push(Tt+1),mt.push(pr),mt.push(Gr))}}return hr}(this.ids,this.coords,G,ee,ae,this.nodeSize)};var Yn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(G){return G}},cn=function(G){this.options=la(Object.create(Yn),G),this.trees=new Array(this.options.maxZoom+1)};function ci(G,ee,ae,me,Pe){return{x:G,y:ee,zoom:1/0,id:ae,parentId:-1,numPoints:me,properties:Pe}}function Zn(G,ee){var ae=G.geometry.coordinates,me=ae[1];return{x:Gn(ae[0]),y:hi(me),zoom:1/0,index:ee,parentId:-1}}function ri(G){return{type:"Feature",id:G.id,properties:fi(G),geometry:{type:"Point",coordinates:[(me=G.x,360*(me-.5)),(ee=G.y,ae=(180-360*ee)*Math.PI/180,360*Math.atan(Math.exp(ae))/Math.PI-90)]}};var ee,ae,me}function fi(G){var ee=G.numPoints,ae=ee>=1e4?Math.round(ee/1e3)+"k":ee>=1e3?Math.round(ee/100)/10+"k":ee;return la(la({},G.properties),{cluster:!0,cluster_id:G.id,point_count:ee,point_count_abbreviated:ae})}function Gn(G){return G/360+.5}function hi(G){var ee=Math.sin(G*Math.PI/180),ae=.5-.25*Math.log((1+ee)/(1-ee))/Math.PI;return ae<0?0:ae>1?1:ae}function la(G,ee){for(var ae in ee)G[ae]=ee[ae];return G}function Vi(G){return G.x}function Oi(G){return G.y}function qi(G,ee,ae,me,Pe,Ge){var tt=Pe-ae,ce=Ge-me;if(tt!==0||ce!==0){var Re=((G-ae)*tt+(ee-me)*ce)/(tt*tt+ce*ce);Re>1?(ae=Pe,me=Ge):Re>0&&(ae+=tt*Re,me+=ce*Re)}return(tt=G-ae)*tt+(ce=ee-me)*ce}function ca(G,ee,ae,me){var Pe={id:G===void 0?null:G,type:ee,geometry:ae,tags:me,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Ge){var tt=Ge.geometry,ce=Ge.type;if(ce==="Point"||ce==="MultiPoint"||ce==="LineString")Ci(Ge,tt);else if(ce==="Polygon"||ce==="MultiLineString")for(var Re=0;Re<tt.length;Re++)Ci(Ge,tt[Re]);else if(ce==="MultiPolygon")for(Re=0;Re<tt.length;Re++)for(var mt=0;mt<tt[Re].length;mt++)Ci(Ge,tt[Re][mt])}(Pe),Pe}function Ci(G,ee){for(var ae=0;ae<ee.length;ae+=3)G.minX=Math.min(G.minX,ee[ae]),G.minY=Math.min(G.minY,ee[ae+1]),G.maxX=Math.max(G.maxX,ee[ae]),G.maxY=Math.max(G.maxY,ee[ae+1])}function ma(G,ee,ae,me){if(ee.geometry){var Pe=ee.geometry.coordinates,Ge=ee.geometry.type,tt=Math.pow(ae.tolerance/((1<<ae.maxZoom)*ae.extent),2),ce=[],Re=ee.id;if(ae.promoteId?Re=ee.properties[ae.promoteId]:ae.generateId&&(Re=me||0),Ge==="Point")Xn(Pe,ce);else if(Ge==="MultiPoint")for(var mt=0;mt<Pe.length;mt++)Xn(Pe[mt],ce);else if(Ge==="LineString")bi(Pe,ce,tt,!1);else if(Ge==="MultiLineString"){if(ae.lineMetrics){for(mt=0;mt<Pe.length;mt++)bi(Pe[mt],ce=[],tt,!1),G.push(ca(Re,"LineString",ce,ee.properties));return}Ni(Pe,ce,tt,!1)}else if(Ge==="Polygon")Ni(Pe,ce,tt,!0);else{if(Ge!=="MultiPolygon"){if(Ge==="GeometryCollection"){for(mt=0;mt<ee.geometry.geometries.length;mt++)ma(G,{id:Re,geometry:ee.geometry.geometries[mt],properties:ee.properties},ae,me);return}throw new Error("Input data is not a valid GeoJSON object.")}for(mt=0;mt<Pe.length;mt++){var hr=[];Ni(Pe[mt],hr,tt,!0),ce.push(hr)}}G.push(ca(Re,Ge,ce,ee.properties))}}function Xn(G,ee){ee.push(Ki(G[0])),ee.push(Oo(G[1])),ee.push(0)}function bi(G,ee,ae,me){for(var Pe,Ge,tt=0,ce=0;ce<G.length;ce++){var Re=Ki(G[ce][0]),mt=Oo(G[ce][1]);ee.push(Re),ee.push(mt),ee.push(0),ce>0&&(tt+=me?(Pe*mt-Re*Ge)/2:Math.sqrt(Math.pow(Re-Pe,2)+Math.pow(mt-Ge,2))),Pe=Re,Ge=mt}var hr=ee.length-3;ee[2]=1,function Ot(Ft,pr,gn,un){for(var Tt,Jr=un,Dr=gn-pr>>1,Gr=gn-pr,vi=Ft[pr],Qr=Ft[pr+1],An=Ft[gn],Wi=Ft[gn+1],di=pr+3;di<gn;di+=3){var Ti=qi(Ft[di],Ft[di+1],vi,Qr,An,Wi);if(Ti>Jr)Tt=di,Jr=Ti;else if(Ti===Jr){var _i=Math.abs(di-Dr);_i<Gr&&(Tt=di,Gr=_i)}}Jr>un&&(Tt-pr>3&&Ot(Ft,pr,Tt,un),Ft[Tt+2]=Jr,gn-Tt>3&&Ot(Ft,Tt,gn,un))}(ee,0,hr,ae),ee[hr+2]=1,ee.size=Math.abs(tt),ee.start=0,ee.end=ee.size}function Ni(G,ee,ae,me){for(var Pe=0;Pe<G.length;Pe++){var Ge=[];bi(G[Pe],Ge,ae,me),ee.push(Ge)}}function Ki(G){return G/360+.5}function Oo(G){var ee=Math.sin(G*Math.PI/180),ae=.5-.25*Math.log((1+ee)/(1-ee))/Math.PI;return ae<0?0:ae>1?1:ae}function he(G,ee,ae,me,Pe,Ge,tt,ce){if(me/=ee,Ge>=(ae/=ee)&&tt<me)return G;if(tt<ae||Ge>=me)return null;for(var Re=[],mt=0;mt<G.length;mt++){var hr=G[mt],Ot=hr.geometry,Ft=hr.type,pr=Pe===0?hr.minX:hr.minY,gn=Pe===0?hr.maxX:hr.maxY;if(pr>=ae&&gn<me)Re.push(hr);else if(!(gn<ae||pr>=me)){var un=[];if(Ft==="Point"||Ft==="MultiPoint")On(Ot,un,ae,me,Pe);else if(Ft==="LineString")Ua(Ot,un,ae,me,Pe,!1,ce.lineMetrics);else if(Ft==="MultiLineString")Dt(Ot,un,ae,me,Pe,!1);else if(Ft==="Polygon")Dt(Ot,un,ae,me,Pe,!0);else if(Ft==="MultiPolygon")for(var Tt=0;Tt<Ot.length;Tt++){var Jr=[];Dt(Ot[Tt],Jr,ae,me,Pe,!0),Jr.length&&un.push(Jr)}if(un.length){if(ce.lineMetrics&&Ft==="LineString"){for(Tt=0;Tt<un.length;Tt++)Re.push(ca(hr.id,Ft,un[Tt],hr.tags));continue}Ft!=="LineString"&&Ft!=="MultiLineString"||(un.length===1?(Ft="LineString",un=un[0]):Ft="MultiLineString"),Ft!=="Point"&&Ft!=="MultiPoint"||(Ft=un.length===3?"Point":"MultiPoint"),Re.push(ca(hr.id,Ft,un,hr.tags))}}}return Re.length?Re:null}function On(G,ee,ae,me,Pe){for(var Ge=0;Ge<G.length;Ge+=3){var tt=G[Ge+Pe];tt>=ae&&tt<=me&&(ee.push(G[Ge]),ee.push(G[Ge+1]),ee.push(G[Ge+2]))}}function Ua(G,ee,ae,me,Pe,Ge,tt){for(var ce,Re,mt=rs(G),hr=Pe===0?Er:$r,Ot=G.start,Ft=0;Ft<G.length-3;Ft+=3){var pr=G[Ft],gn=G[Ft+1],un=G[Ft+2],Tt=G[Ft+3],Jr=G[Ft+4],Dr=Pe===0?pr:gn,Gr=Pe===0?Tt:Jr,vi=!1;tt&&(ce=Math.sqrt(Math.pow(pr-Tt,2)+Math.pow(gn-Jr,2))),Dr<ae?Gr>ae&&(Re=hr(mt,pr,gn,Tt,Jr,ae),tt&&(mt.start=Ot+ce*Re)):Dr>me?Gr<me&&(Re=hr(mt,pr,gn,Tt,Jr,me),tt&&(mt.start=Ot+ce*Re)):tr(mt,pr,gn,un),Gr<ae&&Dr>=ae&&(Re=hr(mt,pr,gn,Tt,Jr,ae),vi=!0),Gr>me&&Dr<=me&&(Re=hr(mt,pr,gn,Tt,Jr,me),vi=!0),!Ge&&vi&&(tt&&(mt.end=Ot+ce*Re),ee.push(mt),mt=rs(G)),tt&&(Ot+=ce)}var Qr=G.length-3;pr=G[Qr],gn=G[Qr+1],un=G[Qr+2],(Dr=Pe===0?pr:gn)>=ae&&Dr<=me&&tr(mt,pr,gn,un),Qr=mt.length-3,Ge&&Qr>=3&&(mt[Qr]!==mt[0]||mt[Qr+1]!==mt[1])&&tr(mt,mt[0],mt[1],mt[2]),mt.length&&ee.push(mt)}function rs(G){var ee=[];return ee.size=G.size,ee.start=G.start,ee.end=G.end,ee}function Dt(G,ee,ae,me,Pe,Ge){for(var tt=0;tt<G.length;tt++)Ua(G[tt],ee,ae,me,Pe,Ge,!1)}function tr(G,ee,ae,me){G.push(ee),G.push(ae),G.push(me)}function Er(G,ee,ae,me,Pe,Ge){var tt=(Ge-ee)/(me-ee);return G.push(Ge),G.push(ae+(Pe-ae)*tt),G.push(1),tt}function $r(G,ee,ae,me,Pe,Ge){var tt=(Ge-ae)/(Pe-ae);return G.push(ee+(me-ee)*tt),G.push(Ge),G.push(1),tt}function xn(G,ee){for(var ae=[],me=0;me<G.length;me++){var Pe,Ge=G[me],tt=Ge.type;if(tt==="Point"||tt==="MultiPoint"||tt==="LineString")Pe=Dn(Ge.geometry,ee);else if(tt==="MultiLineString"||tt==="Polygon"){Pe=[];for(var ce=0;ce<Ge.geometry.length;ce++)Pe.push(Dn(Ge.geometry[ce],ee))}else if(tt==="MultiPolygon")for(Pe=[],ce=0;ce<Ge.geometry.length;ce++){for(var Re=[],mt=0;mt<Ge.geometry[ce].length;mt++)Re.push(Dn(Ge.geometry[ce][mt],ee));Pe.push(Re)}ae.push(ca(Ge.id,tt,Pe,Ge.tags))}return ae}function Dn(G,ee){var ae=[];ae.size=G.size,G.start!==void 0&&(ae.start=G.start,ae.end=G.end);for(var me=0;me<G.length;me+=3)ae.push(G[me]+ee,G[me+1],G[me+2]);return ae}function pi(G,ee){if(G.transformed)return G;var ae,me,Pe,Ge=1<<G.z,tt=G.x,ce=G.y;for(ae=0;ae<G.features.length;ae++){var Re=G.features[ae],mt=Re.geometry,hr=Re.type;if(Re.geometry=[],hr===1)for(me=0;me<mt.length;me+=2)Re.geometry.push(qn(mt[me],mt[me+1],ee,Ge,tt,ce));else for(me=0;me<mt.length;me++){var Ot=[];for(Pe=0;Pe<mt[me].length;Pe+=2)Ot.push(qn(mt[me][Pe],mt[me][Pe+1],ee,Ge,tt,ce));Re.geometry.push(Ot)}}return G.transformed=!0,G}function qn(G,ee,ae,me,Pe,Ge){return[Math.round(ae*(G*me-Pe)),Math.round(ae*(ee*me-Ge))]}function on(G,ee,ae,me,Pe){for(var Ge=ee===Pe.maxZoom?0:Pe.tolerance/((1<<ee)*Pe.extent),tt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:ae,y:me,z:ee,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ce=0;ce<G.length;ce++){tt.numFeatures++,Ri(tt,G[ce],Ge,Pe);var Re=G[ce].minX,mt=G[ce].minY,hr=G[ce].maxX,Ot=G[ce].maxY;Re<tt.minX&&(tt.minX=Re),mt<tt.minY&&(tt.minY=mt),hr>tt.maxX&&(tt.maxX=hr),Ot>tt.maxY&&(tt.maxY=Ot)}return tt}function Ri(G,ee,ae,me){var Pe=ee.geometry,Ge=ee.type,tt=[];if(Ge==="Point"||Ge==="MultiPoint")for(var ce=0;ce<Pe.length;ce+=3)tt.push(Pe[ce]),tt.push(Pe[ce+1]),G.numPoints++,G.numSimplified++;else if(Ge==="LineString")Ii(tt,Pe,G,ae,!1,!1);else if(Ge==="MultiLineString"||Ge==="Polygon")for(ce=0;ce<Pe.length;ce++)Ii(tt,Pe[ce],G,ae,Ge==="Polygon",ce===0);else if(Ge==="MultiPolygon")for(var Re=0;Re<Pe.length;Re++){var mt=Pe[Re];for(ce=0;ce<mt.length;ce++)Ii(tt,mt[ce],G,ae,!0,ce===0)}if(tt.length){var hr=ee.tags||null;if(Ge==="LineString"&&me.lineMetrics){for(var Ot in hr={},ee.tags)hr[Ot]=ee.tags[Ot];hr.mapbox_clip_start=Pe.start/Pe.size,hr.mapbox_clip_end=Pe.end/Pe.size}var Ft={geometry:tt,type:Ge==="Polygon"||Ge==="MultiPolygon"?3:Ge==="LineString"||Ge==="MultiLineString"?2:1,tags:hr};ee.id!==null&&(Ft.id=ee.id),G.features.push(Ft)}}function Ii(G,ee,ae,me,Pe,Ge){var tt=me*me;if(me>0&&ee.size<(Pe?tt:me))ae.numPoints+=ee.length/3;else{for(var ce=[],Re=0;Re<ee.length;Re+=3)(me===0||ee[Re+2]>tt)&&(ae.numSimplified++,ce.push(ee[Re]),ce.push(ee[Re+1])),ae.numPoints++;Pe&&function(mt,hr){for(var Ot=0,Ft=0,pr=mt.length,gn=pr-2;Ft<pr;gn=Ft,Ft+=2)Ot+=(mt[Ft]-mt[gn])*(mt[Ft+1]+mt[gn+1]);if(Ot>0===hr)for(Ft=0,pr=mt.length;Ft<pr/2;Ft+=2){var un=mt[Ft],Tt=mt[Ft+1];mt[Ft]=mt[pr-2-Ft],mt[Ft+1]=mt[pr-1-Ft],mt[pr-2-Ft]=un,mt[pr-1-Ft]=Tt}}(ce,Ge),G.push(ce)}}function Qa(G,ee){var ae=(ee=this.options=function(Pe,Ge){for(var tt in Ge)Pe[tt]=Ge[tt];return Pe}(Object.create(this.options),ee)).debug;if(ae&&console.time("preprocess data"),ee.maxZoom<0||ee.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ee.promoteId&&ee.generateId)throw new Error("promoteId and generateId cannot be used together.");var me=function(Pe,Ge){var tt=[];if(Pe.type==="FeatureCollection")for(var ce=0;ce<Pe.features.length;ce++)ma(tt,Pe.features[ce],Ge,ce);else ma(tt,Pe.type==="Feature"?Pe:{geometry:Pe},Ge);return tt}(G,ee);this.tiles={},this.tileCoords=[],ae&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ee.indexMaxZoom,ee.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(me=function(Pe,Ge){var tt=Ge.buffer/Ge.extent,ce=Pe,Re=he(Pe,1,-1-tt,tt,0,-1,2,Ge),mt=he(Pe,1,1-tt,2+tt,0,-1,2,Ge);return(Re||mt)&&(ce=he(Pe,1,-tt,1+tt,0,-1,2,Ge)||[],Re&&(ce=xn(Re,1).concat(ce)),mt&&(ce=ce.concat(xn(mt,-1)))),ce}(me,ee)).length&&this.splitTile(me,0,0,0),ae&&(me.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function hs(G,ee,ae){return 32*((1<<G)*ae+ee)+G}function Zo(G,ee){var ae=G.tileID.canonical;if(!this._geoJSONIndex)return ee(null,null);var me=this._geoJSONIndex.getTile(ae.z,ae.x,ae.y);if(!me)return ee(null,null);var Pe=new nt(me.features),Ge=st(Pe);Ge.byteOffset===0&&Ge.byteLength===Ge.buffer.byteLength||(Ge=new Uint8Array(Ge)),ee(null,{vectorTile:Pe,rawData:Ge.buffer})}cn.prototype.load=function(G){var ee=this.options,ae=ee.log,me=ee.minZoom,Pe=ee.maxZoom,Ge=ee.nodeSize;ae&&console.time("total time");var tt="prepare "+G.length+" points";ae&&console.time(tt),this.points=G;for(var ce=[],Re=0;Re<G.length;Re++)G[Re].geometry&&ce.push(Zn(G[Re],Re));this.trees[Pe+1]=new br(ce,Vi,Oi,Ge,Float32Array),ae&&console.timeEnd(tt);for(var mt=Pe;mt>=me;mt--){var hr=+Date.now();ce=this._cluster(ce,mt),this.trees[mt]=new br(ce,Vi,Oi,Ge,Float32Array),ae&&console.log("z%d: %d clusters in %dms",mt,ce.length,+Date.now()-hr)}return ae&&console.timeEnd("total time"),this},cn.prototype.getClusters=function(G,ee){var ae=((G[0]+180)%360+360)%360-180,me=Math.max(-90,Math.min(90,G[1])),Pe=G[2]===180?180:((G[2]+180)%360+360)%360-180,Ge=Math.max(-90,Math.min(90,G[3]));if(G[2]-G[0]>=360)ae=-180,Pe=180;else if(ae>Pe){var tt=this.getClusters([ae,me,180,Ge],ee),ce=this.getClusters([-180,me,Pe,Ge],ee);return tt.concat(ce)}for(var Re=this.trees[this._limitZoom(ee)],mt=[],hr=0,Ot=Re.range(Gn(ae),hi(Ge),Gn(Pe),hi(me));hr<Ot.length;hr+=1){var Ft=Re.points[Ot[hr]];mt.push(Ft.numPoints?ri(Ft):this.points[Ft.index])}return mt},cn.prototype.getChildren=function(G){var ee=this._getOriginId(G),ae=this._getOriginZoom(G),me="No cluster with the specified id.",Pe=this.trees[ae];if(!Pe)throw new Error(me);var Ge=Pe.points[ee];if(!Ge)throw new Error(me);for(var tt=this.options.radius/(this.options.extent*Math.pow(2,ae-1)),ce=[],Re=0,mt=Pe.within(Ge.x,Ge.y,tt);Re<mt.length;Re+=1){var hr=Pe.points[mt[Re]];hr.parentId===G&&ce.push(hr.numPoints?ri(hr):this.points[hr.index])}if(ce.length===0)throw new Error(me);return ce},cn.prototype.getLeaves=function(G,ee,ae){var me=[];return this._appendLeaves(me,G,ee=ee||10,ae=ae||0,0),me},cn.prototype.getTile=function(G,ee,ae){var me=this.trees[this._limitZoom(G)],Pe=Math.pow(2,G),Ge=this.options,tt=Ge.radius/Ge.extent,ce=(ae-tt)/Pe,Re=(ae+1+tt)/Pe,mt={features:[]};return this._addTileFeatures(me.range((ee-tt)/Pe,ce,(ee+1+tt)/Pe,Re),me.points,ee,ae,Pe,mt),ee===0&&this._addTileFeatures(me.range(1-tt/Pe,ce,1,Re),me.points,Pe,ae,Pe,mt),ee===Pe-1&&this._addTileFeatures(me.range(0,ce,tt/Pe,Re),me.points,-1,ae,Pe,mt),mt.features.length?mt:null},cn.prototype.getClusterExpansionZoom=function(G){for(var ee=this._getOriginZoom(G)-1;ee<=this.options.maxZoom;){var ae=this.getChildren(G);if(ee++,ae.length!==1)break;G=ae[0].properties.cluster_id}return ee},cn.prototype._appendLeaves=function(G,ee,ae,me,Pe){for(var Ge=0,tt=this.getChildren(ee);Ge<tt.length;Ge+=1){var ce=tt[Ge],Re=ce.properties;if(Re&&Re.cluster?Pe+Re.point_count<=me?Pe+=Re.point_count:Pe=this._appendLeaves(G,Re.cluster_id,ae,me,Pe):Pe<me?Pe++:G.push(ce),G.length===ae)break}return Pe},cn.prototype._addTileFeatures=function(G,ee,ae,me,Pe,Ge){for(var tt=0,ce=G;tt<ce.length;tt+=1){var Re=ee[ce[tt]],mt=Re.numPoints,hr={type:1,geometry:[[Math.round(this.options.extent*(Re.x*Pe-ae)),Math.round(this.options.extent*(Re.y*Pe-me))]],tags:mt?fi(Re):this.points[Re.index].properties},Ot=void 0;mt?Ot=Re.id:this.options.generateId?Ot=Re.index:this.points[Re.index].id&&(Ot=this.points[Re.index].id),Ot!==void 0&&(hr.id=Ot),Ge.features.push(hr)}},cn.prototype._limitZoom=function(G){return Math.max(this.options.minZoom,Math.min(+G,this.options.maxZoom+1))},cn.prototype._cluster=function(G,ee){for(var ae=[],me=this.options,Pe=me.reduce,Ge=me.minPoints,tt=me.radius/(me.extent*Math.pow(2,ee)),ce=0;ce<G.length;ce++){var Re=G[ce];if(!(Re.zoom<=ee)){Re.zoom=ee;for(var mt=this.trees[ee+1],hr=mt.within(Re.x,Re.y,tt),Ot=Re.numPoints||1,Ft=Ot,pr=0,gn=hr;pr<gn.length;pr+=1){var un=mt.points[gn[pr]];un.zoom>ee&&(Ft+=un.numPoints||1)}if(Ft>=Ge){for(var Tt=Re.x*Ot,Jr=Re.y*Ot,Dr=Pe&&Ot>1?this._map(Re,!0):null,Gr=(ce<<5)+(ee+1)+this.points.length,vi=0,Qr=hr;vi<Qr.length;vi+=1){var An=mt.points[Qr[vi]];if(!(An.zoom<=ee)){An.zoom=ee;var Wi=An.numPoints||1;Tt+=An.x*Wi,Jr+=An.y*Wi,An.parentId=Gr,Pe&&(Dr||(Dr=this._map(Re,!0)),Pe(Dr,this._map(An)))}}Re.parentId=Gr,ae.push(ci(Tt/Ft,Jr/Ft,Gr,Ft,Dr))}else if(ae.push(Re),Ft>1)for(var di=0,Ti=hr;di<Ti.length;di+=1){var _i=mt.points[Ti[di]];_i.zoom<=ee||(_i.zoom=ee,ae.push(_i))}}}return ae},cn.prototype._getOriginId=function(G){return G-this.points.length>>5},cn.prototype._getOriginZoom=function(G){return(G-this.points.length)%32},cn.prototype._map=function(G,ee){if(G.numPoints)return ee?la({},G.properties):G.properties;var ae=this.points[G.index].properties,me=this.options.map(ae);return ee&&me===ae?la({},me):me},Qa.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Qa.prototype.splitTile=function(G,ee,ae,me,Pe,Ge,tt){for(var ce=[G,ee,ae,me],Re=this.options,mt=Re.debug;ce.length;){me=ce.pop(),ae=ce.pop(),ee=ce.pop(),G=ce.pop();var hr=1<<ee,Ot=hs(ee,ae,me),Ft=this.tiles[Ot];if(!Ft&&(mt>1&&console.time("creation"),Ft=this.tiles[Ot]=on(G,ee,ae,me,Re),this.tileCoords.push({z:ee,x:ae,y:me}),mt)){mt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ee,ae,me,Ft.numFeatures,Ft.numPoints,Ft.numSimplified),console.timeEnd("creation"));var pr="z"+ee;this.stats[pr]=(this.stats[pr]||0)+1,this.total++}if(Ft.source=G,Pe){if(ee===Re.maxZoom||ee===Pe)continue;var gn=1<<Pe-ee;if(ae!==Math.floor(Ge/gn)||me!==Math.floor(tt/gn))continue}else if(ee===Re.indexMaxZoom||Ft.numPoints<=Re.indexMaxPoints)continue;if(Ft.source=null,G.length!==0){mt>1&&console.time("clipping");var un,Tt,Jr,Dr,Gr,vi,Qr=.5*Re.buffer/Re.extent,An=.5-Qr,Wi=.5+Qr,di=1+Qr;un=Tt=Jr=Dr=null,Gr=he(G,hr,ae-Qr,ae+Wi,0,Ft.minX,Ft.maxX,Re),vi=he(G,hr,ae+An,ae+di,0,Ft.minX,Ft.maxX,Re),G=null,Gr&&(un=he(Gr,hr,me-Qr,me+Wi,1,Ft.minY,Ft.maxY,Re),Tt=he(Gr,hr,me+An,me+di,1,Ft.minY,Ft.maxY,Re),Gr=null),vi&&(Jr=he(vi,hr,me-Qr,me+Wi,1,Ft.minY,Ft.maxY,Re),Dr=he(vi,hr,me+An,me+di,1,Ft.minY,Ft.maxY,Re),vi=null),mt>1&&console.timeEnd("clipping"),ce.push(un||[],ee+1,2*ae,2*me),ce.push(Tt||[],ee+1,2*ae,2*me+1),ce.push(Jr||[],ee+1,2*ae+1,2*me),ce.push(Dr||[],ee+1,2*ae+1,2*me+1)}}},Qa.prototype.getTile=function(G,ee,ae){var me=this.options,Pe=me.extent,Ge=me.debug;if(G<0||G>24)return null;var tt=1<<G,ce=hs(G,ee=(ee%tt+tt)%tt,ae);if(this.tiles[ce])return pi(this.tiles[ce],Pe);Ge>1&&console.log("drilling down to z%d-%d-%d",G,ee,ae);for(var Re,mt=G,hr=ee,Ot=ae;!Re&&mt>0;)mt--,hr=Math.floor(hr/2),Ot=Math.floor(Ot/2),Re=this.tiles[hs(mt,hr,Ot)];return Re&&Re.source?(Ge>1&&console.log("found parent tile z%d-%d-%d",mt,hr,Ot),Ge>1&&console.time("drilling down"),this.splitTile(Re.source,mt,hr,Ot,G,ee,ae),Ge>1&&console.timeEnd("drilling down"),this.tiles[ce]?pi(this.tiles[ce],Pe):null):null};var Fa=function(G){function ee(ae,me,Pe,Ge){G.call(this,ae,me,Pe,Zo),Ge&&(this.loadGeoJSON=Ge)}return G&&(ee.__proto__=G),(ee.prototype=Object.create(G&&G.prototype)).constructor=ee,ee.prototype.loadData=function(ae,me){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=me,this._pendingLoadDataParams=ae,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},ee.prototype._loadData=function(){var ae=this;if(this._pendingCallback&&this._pendingLoadDataParams){var me=this._pendingCallback,Pe=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var Ge=!!(Pe&&Pe.request&&Pe.request.collectResourceTiming)&&new v.RequestPerformance(Pe.request);this.loadGeoJSON(Pe,function(tt,ce){if(tt||!ce)return me(tt);if(typeof ce!="object")return me(new Error("Input data given to '"+Pe.source+"' is not a valid GeoJSON object."));(function Ft(pr,gn){var un,Tt=pr&&pr.type;if(Tt==="FeatureCollection")for(un=0;un<pr.features.length;un++)Ft(pr.features[un],gn);else if(Tt==="GeometryCollection")for(un=0;un<pr.geometries.length;un++)Ft(pr.geometries[un],gn);else if(Tt==="Feature")Ft(pr.geometry,gn);else if(Tt==="Polygon")Jt(pr.coordinates,gn);else if(Tt==="MultiPolygon")for(un=0;un<pr.coordinates.length;un++)Jt(pr.coordinates[un],gn);return pr})(ce,!0);try{if(Pe.filter){var Re=v.createExpression(Pe.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Re.result==="error")throw new Error(Re.value.map(function(Ft){return Ft.key+": "+Ft.message}).join(", "));var mt=ce.features.filter(function(Ft){return Re.value.evaluate({zoom:0},Ft)});ce={type:"FeatureCollection",features:mt}}ae._geoJSONIndex=Pe.cluster?new cn(function(Ft){var pr=Ft.superclusterOptions,gn=Ft.clusterProperties;if(!gn||!pr)return pr;for(var un={},Tt={},Jr={accumulated:null,zoom:0},Dr={properties:null},Gr=Object.keys(gn),vi=0,Qr=Gr;vi<Qr.length;vi+=1){var An=Qr[vi],Wi=gn[An],di=Wi[0],Ti=v.createExpression(Wi[1]),_i=v.createExpression(typeof di=="string"?[di,["accumulated"],["get",An]]:di);un[An]=Ti.value,Tt[An]=_i.value}return pr.map=function(Ct){Dr.properties=Ct;for(var qt={},Aa=0,Ei=Gr;Aa<Ei.length;Aa+=1){var Ai=Ei[Aa];qt[Ai]=un[Ai].evaluate(Jr,Dr)}return qt},pr.reduce=function(Ct,qt){Dr.properties=qt;for(var Aa=0,Ei=Gr;Aa<Ei.length;Aa+=1){var Ai=Ei[Aa];Jr.accumulated=Ct[Ai],Ct[Ai]=Tt[Ai].evaluate(Jr,Dr)}},pr}(Pe)).load(ce.features):function(Ft,pr){return new Qa(Ft,pr)}(ce,Pe.geojsonVtOptions)}catch(Ft){return me(Ft)}ae.loaded={};var hr={};if(Ge){var Ot=Ge.finish();Ot&&(hr.resourceTiming={},hr.resourceTiming[Pe.source]=JSON.parse(JSON.stringify(Ot)))}me(null,hr)})}},ee.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},ee.prototype.reloadTile=function(ae,me){var Pe=this.loaded;return Pe&&Pe[ae.uid]?G.prototype.reloadTile.call(this,ae,me):this.loadTile(ae,me)},ee.prototype.loadGeoJSON=function(ae,me){if(ae.request)v.getJSON(ae.request,me);else{if(typeof ae.data!="string")return me(new Error("Input data given to '"+ae.source+"' is not a valid GeoJSON object."));try{return me(null,JSON.parse(ae.data))}catch(Pe){return me(new Error("Input data given to '"+ae.source+"' is not a valid GeoJSON object."))}}},ee.prototype.removeSource=function(ae,me){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),me()},ee.prototype.getClusterExpansionZoom=function(ae,me){try{me(null,this._geoJSONIndex.getClusterExpansionZoom(ae.clusterId))}catch(Pe){me(Pe)}},ee.prototype.getClusterChildren=function(ae,me){try{me(null,this._geoJSONIndex.getChildren(ae.clusterId))}catch(Pe){me(Pe)}},ee.prototype.getClusterLeaves=function(ae,me){try{me(null,this._geoJSONIndex.getLeaves(ae.clusterId,ae.limit,ae.offset))}catch(Pe){me(Pe)}},ee}(Ve),ba=function(G){var ee=this;this.self=G,this.actor=new v.Actor(G,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:Ve,geojson:Fa},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(ae,me){if(ee.workerSourceTypes[ae])throw new Error('Worker source with name "'+ae+'" already registered.');ee.workerSourceTypes[ae]=me},this.self.registerRTLTextPlugin=function(ae){if(v.plugin.isParsed())throw new Error("RTL text plugin already registered.");v.plugin.applyArabicShaping=ae.applyArabicShaping,v.plugin.processBidirectionalText=ae.processBidirectionalText,v.plugin.processStyledBidirectionalText=ae.processStyledBidirectionalText}};return ba.prototype.setReferrer=function(G,ee){this.referrer=ee},ba.prototype.setImages=function(G,ee,ae){for(var me in this.availableImages[G]=ee,this.workerSources[G]){var Pe=this.workerSources[G][me];for(var Ge in Pe)Pe[Ge].availableImages=ee}ae()},ba.prototype.setLayers=function(G,ee,ae){this.getLayerIndex(G).replace(ee),ae()},ba.prototype.updateLayers=function(G,ee,ae){this.getLayerIndex(G).update(ee.layers,ee.removedIds),ae()},ba.prototype.loadTile=function(G,ee,ae){this.getWorkerSource(G,ee.type,ee.source).loadTile(ee,ae)},ba.prototype.loadDEMTile=function(G,ee,ae){this.getDEMWorkerSource(G,ee.source).loadTile(ee,ae)},ba.prototype.reloadTile=function(G,ee,ae){this.getWorkerSource(G,ee.type,ee.source).reloadTile(ee,ae)},ba.prototype.abortTile=function(G,ee,ae){this.getWorkerSource(G,ee.type,ee.source).abortTile(ee,ae)},ba.prototype.removeTile=function(G,ee,ae){this.getWorkerSource(G,ee.type,ee.source).removeTile(ee,ae)},ba.prototype.removeDEMTile=function(G,ee){this.getDEMWorkerSource(G,ee.source).removeTile(ee)},ba.prototype.removeSource=function(G,ee,ae){if(this.workerSources[G]&&this.workerSources[G][ee.type]&&this.workerSources[G][ee.type][ee.source]){var me=this.workerSources[G][ee.type][ee.source];delete this.workerSources[G][ee.type][ee.source],me.removeSource!==void 0?me.removeSource(ee,ae):ae()}},ba.prototype.loadWorkerSource=function(G,ee,ae){try{this.self.importScripts(ee.url),ae()}catch(me){ae(me.toString())}},ba.prototype.syncRTLPluginState=function(G,ee,ae){try{v.plugin.setState(ee);var me=v.plugin.getPluginURL();if(v.plugin.isLoaded()&&!v.plugin.isParsed()&&me!=null){this.self.importScripts(me);var Pe=v.plugin.isParsed();ae(Pe?void 0:new Error("RTL Text Plugin failed to import scripts from "+me),Pe)}}catch(Ge){ae(Ge.toString())}},ba.prototype.getAvailableImages=function(G){var ee=this.availableImages[G];return ee||(ee=[]),ee},ba.prototype.getLayerIndex=function(G){var ee=this.layerIndexes[G];return ee||(ee=this.layerIndexes[G]=new J),ee},ba.prototype.getWorkerSource=function(G,ee,ae){var me=this;return this.workerSources[G]||(this.workerSources[G]={}),this.workerSources[G][ee]||(this.workerSources[G][ee]={}),this.workerSources[G][ee][ae]||(this.workerSources[G][ee][ae]=new this.workerSourceTypes[ee]({send:function(Pe,Ge,tt){me.actor.send(Pe,Ge,tt,G)}},this.getLayerIndex(G),this.getAvailableImages(G))),this.workerSources[G][ee][ae]},ba.prototype.getDEMWorkerSource=function(G,ee){return this.demWorkerSources[G]||(this.demWorkerSources[G]={}),this.demWorkerSources[G][ee]||(this.demWorkerSources[G][ee]=new ot),this.demWorkerSources[G][ee]},ba.prototype.enforceCacheSizeLimit=function(G,ee){v.enforceCacheSizeLimit(ee)},typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new ba(self)),ba}),j(["./shared"],function(v){"use strict";var Q=v.createCommonjsModule(function(l){function f(b){return!c(b)}function c(b){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var A,R,U=new Blob([""],{type:"text/javascript"}),q=URL.createObjectURL(U);try{R=new Worker(q),A=!0}catch(le){A=!1}return R&&R.terminate(),URL.revokeObjectURL(q),A}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var A=document.createElement("canvas");A.width=A.height=1;var R=A.getContext("2d");if(!R)return!1;var U=R.getImageData(0,0,1,1);return U&&U.width===A.width}()?(p[w=b&&b.failIfMajorPerformanceCaveat]===void 0&&(p[w]=function(A){var R=function(q){var le=document.createElement("canvas"),fe=Object.create(f.webGLContextAttributes);return fe.failIfMajorPerformanceCaveat=q,le.probablySupportsContext?le.probablySupportsContext("webgl",fe)||le.probablySupportsContext("experimental-webgl",fe):le.supportsContext?le.supportsContext("webgl",fe)||le.supportsContext("experimental-webgl",fe):le.getContext("webgl",fe)||le.getContext("experimental-webgl",fe)}(A);if(!R)return!1;var U=R.createShader(R.VERTEX_SHADER);return!(!U||R.isContextLost())&&(R.shaderSource(U,"void main() {}"),R.compileShader(U),R.getShaderParameter(U,R.COMPILE_STATUS)===!0)}(w)),p[w]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var w}l.exports?l.exports=f:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=f,window.mapboxgl.notSupportedReason=c);var p={};f.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),F={create:function(l,f,c){var p=v.window.document.createElement(l);return f!==void 0&&(p.className=f),c&&c.appendChild(p),p},createNS:function(l,f){return v.window.document.createElementNS(l,f)}},J=v.window.document&&v.window.document.documentElement.style;function ne(l){if(!J)return l[0];for(var f=0;f<l.length;f++)if(l[f]in J)return l[f];return l[0]}var ye,K=ne(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);F.disableDrag=function(){J&&K&&(ye=J[K],J[K]="none")},F.enableDrag=function(){J&&K&&(J[K]=ye)};var Ne=ne(["transform","WebkitTransform"]);F.setTransform=function(l,f){l.style[Ne]=f};var Ve=!1;try{var ke=Object.defineProperty({},"passive",{get:function(){Ve=!0}});v.window.addEventListener("test",ke,ke),v.window.removeEventListener("test",ke,ke)}catch(l){Ve=!1}F.addEventListener=function(l,f,c,p){p===void 0&&(p={}),l.addEventListener(f,c,"passive"in p&&Ve?p:p.capture)},F.removeEventListener=function(l,f,c,p){p===void 0&&(p={}),l.removeEventListener(f,c,"passive"in p&&Ve?p:p.capture)};var ot=function(l){l.preventDefault(),l.stopPropagation(),v.window.removeEventListener("click",ot,!0)};function Jt(l){var f=l.userImage;return!!(f&&f.render&&f.render())&&(l.data.replace(new Uint8Array(f.data.buffer)),!0)}F.suppressClick=function(){v.window.addEventListener("click",ot,!0),v.window.setTimeout(function(){v.window.removeEventListener("click",ot,!0)},0)},F.mousePos=function(l,f){var c=l.getBoundingClientRect();return new v.Point(f.clientX-c.left-l.clientLeft,f.clientY-c.top-l.clientTop)},F.touchPos=function(l,f){for(var c=l.getBoundingClientRect(),p=[],b=0;b<f.length;b++)p.push(new v.Point(f[b].clientX-c.left-l.clientLeft,f[b].clientY-c.top-l.clientTop));return p},F.mouseButton=function(l){return v.window.InstallTrigger!==void 0&&l.button===2&&l.ctrlKey&&v.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:l.button},F.remove=function(l){l.parentNode&&l.parentNode.removeChild(l)};var pt=function(l){function f(){l.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new v.RGBAImage({width:1,height:1}),this.dirty=!0}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.isLoaded=function(){return this.loaded},f.prototype.setLoaded=function(c){if(this.loaded!==c&&(this.loaded=c,c)){for(var p=0,b=this.requestors;p<b.length;p+=1){var w=b[p];this._notify(w.ids,w.callback)}this.requestors=[]}},f.prototype.getImage=function(c){return this.images[c]},f.prototype.addImage=function(c,p){this._validate(c,p)&&(this.images[c]=p)},f.prototype._validate=function(c,p){var b=!0;return this._validateStretch(p.stretchX,p.data&&p.data.width)||(this.fire(new v.ErrorEvent(new Error('Image "'+c+'" has invalid "stretchX" value'))),b=!1),this._validateStretch(p.stretchY,p.data&&p.data.height)||(this.fire(new v.ErrorEvent(new Error('Image "'+c+'" has invalid "stretchY" value'))),b=!1),this._validateContent(p.content,p)||(this.fire(new v.ErrorEvent(new Error('Image "'+c+'" has invalid "content" value'))),b=!1),b},f.prototype._validateStretch=function(c,p){if(!c)return!0;for(var b=0,w=0,A=c;w<A.length;w+=1){var R=A[w];if(R[0]<b||R[1]<R[0]||p<R[1])return!1;b=R[1]}return!0},f.prototype._validateContent=function(c,p){return!(c&&(c.length!==4||c[0]<0||p.data.width<c[0]||c[1]<0||p.data.height<c[1]||c[2]<0||p.data.width<c[2]||c[3]<0||p.data.height<c[3]||c[2]<c[0]||c[3]<c[1]))},f.prototype.updateImage=function(c,p){p.version=this.images[c].version+1,this.images[c]=p,this.updatedImages[c]=!0},f.prototype.removeImage=function(c){var p=this.images[c];delete this.images[c],delete this.patterns[c],p.userImage&&p.userImage.onRemove&&p.userImage.onRemove()},f.prototype.listImages=function(){return Object.keys(this.images)},f.prototype.getImages=function(c,p){var b=!0;if(!this.isLoaded())for(var w=0,A=c;w<A.length;w+=1)this.images[A[w]]||(b=!1);this.isLoaded()||b?this._notify(c,p):this.requestors.push({ids:c,callback:p})},f.prototype._notify=function(c,p){for(var b={},w=0,A=c;w<A.length;w+=1){var R=A[w];this.images[R]||this.fire(new v.Event("styleimagemissing",{id:R}));var U=this.images[R];U?b[R]={data:U.data.clone(),pixelRatio:U.pixelRatio,sdf:U.sdf,version:U.version,stretchX:U.stretchX,stretchY:U.stretchY,content:U.content,hasRenderCallback:Boolean(U.userImage&&U.userImage.render)}:v.warnOnce('Image "'+R+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}p(null,b)},f.prototype.getPixelSize=function(){var c=this.atlasImage;return{width:c.width,height:c.height}},f.prototype.getPattern=function(c){var p=this.patterns[c],b=this.getImage(c);if(!b)return null;if(p&&p.position.version===b.version)return p.position;if(p)p.position.version=b.version;else{var w={w:b.data.width+2,h:b.data.height+2,x:0,y:0},A=new v.ImagePosition(w,b);this.patterns[c]={bin:w,position:A}}return this._updatePatternAtlas(),this.patterns[c].position},f.prototype.bind=function(c){var p=c.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new v.Texture(c,this.atlasImage,p.RGBA),this.atlasTexture.bind(p.LINEAR,p.CLAMP_TO_EDGE)},f.prototype._updatePatternAtlas=function(){var c=[];for(var p in this.patterns)c.push(this.patterns[p].bin);var b=v.potpack(c),w=b.w,A=b.h,R=this.atlasImage;for(var U in R.resize({width:w||1,height:A||1}),this.patterns){var q=this.patterns[U].bin,le=q.x+1,fe=q.y+1,pe=this.images[U].data,Oe=pe.width,Ce=pe.height;v.RGBAImage.copy(pe,R,{x:0,y:0},{x:le,y:fe},{width:Oe,height:Ce}),v.RGBAImage.copy(pe,R,{x:0,y:Ce-1},{x:le,y:fe-1},{width:Oe,height:1}),v.RGBAImage.copy(pe,R,{x:0,y:0},{x:le,y:fe+Ce},{width:Oe,height:1}),v.RGBAImage.copy(pe,R,{x:Oe-1,y:0},{x:le-1,y:fe},{width:1,height:Ce}),v.RGBAImage.copy(pe,R,{x:0,y:0},{x:le+Oe,y:fe},{width:1,height:Ce})}this.dirty=!0},f.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},f.prototype.dispatchRenderCallbacks=function(c){for(var p=0,b=c;p<b.length;p+=1){var w=b[p];if(!this.callbackDispatchedThisFrame[w]){this.callbackDispatchedThisFrame[w]=!0;var A=this.images[w];Jt(A)&&this.updateImage(w,A)}}},f}(v.Evented),Zt=et,_t=et,nt=1e20;function et(l,f,c,p,b,w){this.fontSize=l||24,this.buffer=f===void 0?3:f,this.cutoff=p||.25,this.fontFamily=b||"sans-serif",this.fontWeight=w||"normal",this.radius=c||8;var A=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=A,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(A*A),this.gridInner=new Float64Array(A*A),this.f=new Float64Array(A),this.d=new Float64Array(A),this.z=new Float64Array(A+1),this.v=new Int16Array(A),this.middle=Math.round(A/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function kt(l,f,c,p,b,w,A){for(var R=0;R<f;R++){for(var U=0;U<c;U++)p[U]=l[U*f+R];for(Y(p,b,w,A,c),U=0;U<c;U++)l[U*f+R]=b[U]}for(U=0;U<c;U++){for(R=0;R<f;R++)p[R]=l[U*f+R];for(Y(p,b,w,A,f),R=0;R<f;R++)l[U*f+R]=Math.sqrt(b[R])}}function Y(l,f,c,p,b){c[0]=0,p[0]=-nt,p[1]=+nt;for(var w=1,A=0;w<b;w++){for(var R=(l[w]+w*w-(l[c[A]]+c[A]*c[A]))/(2*w-2*c[A]);R<=p[A];)A--,R=(l[w]+w*w-(l[c[A]]+c[A]*c[A]))/(2*w-2*c[A]);c[++A]=w,p[A]=R,p[A+1]=+nt}for(w=0,A=0;w<b;w++){for(;p[A+1]<w;)A++;f[w]=(w-c[A])*(w-c[A])+l[c[A]]}}et.prototype.draw=function(l){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(l,this.buffer,this.middle);for(var f=this.ctx.getImageData(0,0,this.size,this.size),c=new Uint8ClampedArray(this.size*this.size),p=0;p<this.size*this.size;p++){var b=f.data[4*p+3]/255;this.gridOuter[p]=b===1?0:b===0?nt:Math.pow(Math.max(0,.5-b),2),this.gridInner[p]=b===1?nt:b===0?0:Math.pow(Math.max(0,b-.5),2)}for(kt(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),kt(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),p=0;p<this.size*this.size;p++)c[p]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[p]-this.gridInner[p])/this.radius+this.cutoff))));return c},Zt.default=_t;var Wt=function(l,f){this.requestManager=l,this.localIdeographFontFamily=f,this.entries={}};Wt.prototype.setURL=function(l){this.url=l},Wt.prototype.getGlyphs=function(l,f){var c=this,p=[];for(var b in l)for(var w=0,A=l[b];w<A.length;w+=1)p.push({stack:b,id:A[w]});v.asyncAll(p,function(R,U){var q=R.stack,le=R.id,fe=c.entries[q];fe||(fe=c.entries[q]={glyphs:{},requests:{},ranges:{}});var pe=fe.glyphs[le];if(pe===void 0){if(pe=c._tinySDF(fe,q,le))return fe.glyphs[le]=pe,void U(null,{stack:q,id:le,glyph:pe});var Oe=Math.floor(le/256);if(256*Oe>65535)U(new Error("glyphs > 65535 not supported"));else if(fe.ranges[Oe])U(null,{stack:q,id:le,glyph:pe});else{var Ce=fe.requests[Oe];Ce||(Ce=fe.requests[Oe]=[],Wt.loadGlyphRange(q,Oe,c.url,c.requestManager,function(We,Te){if(Te){for(var He in Te)c._doesCharSupportLocalGlyph(+He)||(fe.glyphs[+He]=Te[+He]);fe.ranges[Oe]=!0}for(var Qe=0,yt=Ce;Qe<yt.length;Qe+=1)(0,yt[Qe])(We,Te);delete fe.requests[Oe]})),Ce.push(function(We,Te){We?U(We):Te&&U(null,{stack:q,id:le,glyph:Te[le]||null})})}}else U(null,{stack:q,id:le,glyph:pe})},function(R,U){if(R)f(R);else if(U){for(var q={},le=0,fe=U;le<fe.length;le+=1){var pe=fe[le],Oe=pe.stack,Ce=pe.id,We=pe.glyph;(q[Oe]||(q[Oe]={}))[Ce]=We&&{id:We.id,bitmap:We.bitmap.clone(),metrics:We.metrics}}f(null,q)}})},Wt.prototype._doesCharSupportLocalGlyph=function(l){return!!this.localIdeographFontFamily&&(v.isChar["CJK Unified Ideographs"](l)||v.isChar["Hangul Syllables"](l)||v.isChar.Hiragana(l)||v.isChar.Katakana(l))},Wt.prototype._tinySDF=function(l,f,c){var p=this.localIdeographFontFamily;if(p&&this._doesCharSupportLocalGlyph(c)){var b=l.tinySDF;if(!b){var w="400";/bold/i.test(f)?w="900":/medium/i.test(f)?w="500":/light/i.test(f)&&(w="200"),b=l.tinySDF=new Wt.TinySDF(24,3,8,.25,p,w)}return{id:c,bitmap:new v.AlphaImage({width:30,height:30},b.draw(String.fromCharCode(c))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},Wt.loadGlyphRange=function(l,f,c,p,b){var w=256*f,A=w+255,R=p.transformRequest(p.normalizeGlyphsURL(c).replace("{fontstack}",l).replace("{range}",w+"-"+A),v.ResourceType.Glyphs);v.getArrayBuffer(R,function(U,q){if(U)b(U);else if(q){for(var le={},fe=0,pe=v.parseGlyphPBF(q);fe<pe.length;fe+=1){var Oe=pe[fe];le[Oe.id]=Oe}b(null,le)}})},Wt.TinySDF=Zt;var st=function(){this.specification=v.styleSpec.light.position};st.prototype.possiblyEvaluate=function(l,f){return v.sphericalToCartesian(l.expression.evaluate(f))},st.prototype.interpolate=function(l,f,c){return{x:v.number(l.x,f.x,c),y:v.number(l.y,f.y,c),z:v.number(l.z,f.z,c)}};var Ye=new v.Properties({anchor:new v.DataConstantProperty(v.styleSpec.light.anchor),position:new st,color:new v.DataConstantProperty(v.styleSpec.light.color),intensity:new v.DataConstantProperty(v.styleSpec.light.intensity)}),ct=function(l){function f(c){l.call(this),this._transitionable=new v.Transitionable(Ye),this.setLight(c),this._transitioning=this._transitionable.untransitioned()}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getLight=function(){return this._transitionable.serialize()},f.prototype.setLight=function(c,p){if(p===void 0&&(p={}),!this._validate(v.validateLight,c,p))for(var b in c){var w=c[b];v.endsWith(b,"-transition")?this._transitionable.setTransition(b.slice(0,-"-transition".length),w):this._transitionable.setValue(b,w)}},f.prototype.updateTransitions=function(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)},f.prototype.hasTransition=function(){return this._transitioning.hasTransition()},f.prototype.recalculate=function(c){this.properties=this._transitioning.possiblyEvaluate(c)},f.prototype._validate=function(c,p,b){return(!b||b.validate!==!1)&&v.emitValidationErrors(this,c.call(v.validateStyle,v.extend({value:p,style:{glyphs:!0,sprite:!0},styleSpec:v.styleSpec})))},f}(v.Evented),Je=function(l,f){this.width=l,this.height=f,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};Je.prototype.getDash=function(l,f){var c=l.join(",")+String(f);return this.dashEntry[c]||(this.dashEntry[c]=this.addDash(l,f)),this.dashEntry[c]},Je.prototype.getDashRanges=function(l,f,c){var p=[],b=l.length%2==1?-l[l.length-1]*c:0,w=l[0]*c,A=!0;p.push({left:b,right:w,isDash:A,zeroLength:l[0]===0});for(var R=l[0],U=1;U<l.length;U++){var q=l[U];p.push({left:b=R*c,right:w=(R+=q)*c,isDash:A=!A,zeroLength:q===0})}return p},Je.prototype.addRoundDash=function(l,f,c){for(var p=f/2,b=-c;b<=c;b++)for(var w=this.width*(this.nextRow+c+b),A=0,R=l[A],U=0;U<this.width;U++){U/R.right>1&&(R=l[++A]);var q=Math.abs(U-R.left),le=Math.abs(U-R.right),fe=Math.min(q,le),pe=void 0,Oe=b/c*(p+1);if(R.isDash){var Ce=p-Math.abs(Oe);pe=Math.sqrt(fe*fe+Ce*Ce)}else pe=p-Math.sqrt(fe*fe+Oe*Oe);this.data[w+U]=Math.max(0,Math.min(255,pe+128))}},Je.prototype.addRegularDash=function(l){for(var f=l.length-1;f>=0;--f){var c=l[f],p=l[f+1];c.zeroLength?l.splice(f,1):p&&p.isDash===c.isDash&&(p.left=c.left,l.splice(f,1))}var b=l[0],w=l[l.length-1];b.isDash===w.isDash&&(b.left=w.left-this.width,w.right=b.right+this.width);for(var A=this.width*this.nextRow,R=0,U=l[R],q=0;q<this.width;q++){q/U.right>1&&(U=l[++R]);var le=Math.abs(q-U.left),fe=Math.abs(q-U.right),pe=Math.min(le,fe);this.data[A+q]=Math.max(0,Math.min(255,(U.isDash?pe:-pe)+128))}},Je.prototype.addDash=function(l,f){var c=f?7:0,p=2*c+1;if(this.nextRow+p>this.height)return v.warnOnce("LineAtlas out of space"),null;for(var b=0,w=0;w<l.length;w++)b+=l[w];if(b!==0){var A=this.width/b,R=this.getDashRanges(l,this.width,A);f?this.addRoundDash(R,A,c):this.addRegularDash(R)}var U={y:(this.nextRow+c+.5)/this.height,height:2*c/this.height,width:b};return this.nextRow+=p,this.dirty=!0,U},Je.prototype.bind=function(l){var f=l.gl;this.texture?(f.bindTexture(f.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,f.texSubImage2D(f.TEXTURE_2D,0,0,0,this.width,this.height,f.ALPHA,f.UNSIGNED_BYTE,this.data))):(this.texture=f.createTexture(),f.bindTexture(f.TEXTURE_2D,this.texture),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.REPEAT),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.REPEAT),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.LINEAR),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.LINEAR),f.texImage2D(f.TEXTURE_2D,0,f.ALPHA,this.width,this.height,0,f.ALPHA,f.UNSIGNED_BYTE,this.data))};var Rt=function l(f,c){this.workerPool=f,this.actors=[],this.currentActor=0,this.id=v.uniqueId();for(var p=this.workerPool.acquire(this.id),b=0;b<p.length;b++){var w=new l.Actor(p[b],c,this.id);w.name="Worker "+b,this.actors.push(w)}};function dr(l,f,c){var p=function(b,w){if(b)return c(b);if(w){var A=v.pick(v.extend(w,l),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);w.vector_layers&&(A.vectorLayers=w.vector_layers,A.vectorLayerIds=A.vectorLayers.map(function(R){return R.id})),A.tiles=f.canonicalizeTileset(A,l.url),c(null,A)}};return l.url?v.getJSON(f.transformRequest(f.normalizeSourceURL(l.url),v.ResourceType.Source),p):v.browser.frame(function(){return p(null,l)})}Rt.prototype.broadcast=function(l,f,c){v.asyncAll(this.actors,function(p,b){p.send(l,f,b)},c=c||function(){})},Rt.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},Rt.prototype.remove=function(){this.actors.forEach(function(l){l.remove()}),this.actors=[],this.workerPool.release(this.id)},Rt.Actor=v.Actor;var Mr=function(l,f,c){this.bounds=v.LngLatBounds.convert(this.validateBounds(l)),this.minzoom=f||0,this.maxzoom=c||24};Mr.prototype.validateBounds=function(l){return Array.isArray(l)&&l.length===4?[Math.max(-180,l[0]),Math.max(-90,l[1]),Math.min(180,l[2]),Math.min(90,l[3])]:[-180,-90,180,90]},Mr.prototype.contains=function(l){var f=Math.pow(2,l.z),c=Math.floor(v.mercatorXfromLng(this.bounds.getWest())*f),p=Math.floor(v.mercatorYfromLat(this.bounds.getNorth())*f),b=Math.ceil(v.mercatorXfromLng(this.bounds.getEast())*f),w=Math.ceil(v.mercatorYfromLat(this.bounds.getSouth())*f);return l.x>=c&&l.x<b&&l.y>=p&&l.y<w};var jr=function(l){function f(c,p,b,w){if(l.call(this),this.id=c,this.dispatcher=b,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,v.extend(this,v.pick(p,["url","scheme","tileSize","promoteId"])),this._options=v.extend({type:"vector"},p),this._collectResourceTiming=p.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(w)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){var c=this;this._loaded=!1,this.fire(new v.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=dr(this._options,this.map._requestManager,function(p,b){c._tileJSONRequest=null,c._loaded=!0,p?c.fire(new v.ErrorEvent(p)):b&&(v.extend(c,b),b.bounds&&(c.tileBounds=new Mr(b.bounds,c.minzoom,c.maxzoom)),v.postTurnstileEvent(b.tiles,c.map._requestManager._customAccessToken),v.postMapLoadEvent(b.tiles,c.map._getMapId(),c.map._requestManager._skuToken,c.map._requestManager._customAccessToken),c.fire(new v.Event("data",{dataType:"source",sourceDataType:"metadata"})),c.fire(new v.Event("data",{dataType:"source",sourceDataType:"content"})))})},f.prototype.loaded=function(){return this._loaded},f.prototype.hasTile=function(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)},f.prototype.onAdd=function(c){this.map=c,this.load()},f.prototype.setSourceProperty=function(c){this._tileJSONRequest&&this._tileJSONRequest.cancel(),c(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},f.prototype.setTiles=function(c){var p=this;return this.setSourceProperty(function(){p._options.tiles=c}),this},f.prototype.setUrl=function(c){var p=this;return this.setSourceProperty(function(){p.url=c,p._options.url=c}),this},f.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},f.prototype.serialize=function(){return v.extend({},this._options)},f.prototype.loadTile=function(c,p){var b=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme)),w={request:this.map._requestManager.transformRequest(b,v.ResourceType.Tile),uid:c.uid,tileID:c.tileID,zoom:c.tileID.overscaledZ,tileSize:this.tileSize*c.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:v.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function A(R,U){return delete c.request,c.aborted?p(null):R&&R.status!==404?p(R):(U&&U.resourceTiming&&(c.resourceTiming=U.resourceTiming),this.map._refreshExpiredTiles&&U&&c.setExpiryData(U),c.loadVectorData(U,this.map.painter),v.cacheEntryPossiblyAdded(this.dispatcher),p(null),void(c.reloadCallback&&(this.loadTile(c,c.reloadCallback),c.reloadCallback=null)))}w.request.collectResourceTiming=this._collectResourceTiming,c.actor&&c.state!=="expired"?c.state==="loading"?c.reloadCallback=p:c.request=c.actor.send("reloadTile",w,A.bind(this)):(c.actor=this.dispatcher.getActor(),c.request=c.actor.send("loadTile",w,A.bind(this)))},f.prototype.abortTile=function(c){c.request&&(c.request.cancel(),delete c.request),c.actor&&c.actor.send("abortTile",{uid:c.uid,type:this.type,source:this.id},void 0)},f.prototype.unloadTile=function(c){c.unloadVectorData(),c.actor&&c.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id},void 0)},f.prototype.hasTransition=function(){return!1},f}(v.Evented),C=function(l){function f(c,p,b,w){l.call(this),this.id=c,this.dispatcher=b,this.setEventedParent(w),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=v.extend({type:"raster"},p),v.extend(this,v.pick(p,["url","scheme","tileSize"]))}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){var c=this;this._loaded=!1,this.fire(new v.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=dr(this._options,this.map._requestManager,function(p,b){c._tileJSONRequest=null,c._loaded=!0,p?c.fire(new v.ErrorEvent(p)):b&&(v.extend(c,b),b.bounds&&(c.tileBounds=new Mr(b.bounds,c.minzoom,c.maxzoom)),v.postTurnstileEvent(b.tiles),v.postMapLoadEvent(b.tiles,c.map._getMapId(),c.map._requestManager._skuToken),c.fire(new v.Event("data",{dataType:"source",sourceDataType:"metadata"})),c.fire(new v.Event("data",{dataType:"source",sourceDataType:"content"})))})},f.prototype.loaded=function(){return this._loaded},f.prototype.onAdd=function(c){this.map=c,this.load()},f.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},f.prototype.serialize=function(){return v.extend({},this._options)},f.prototype.hasTile=function(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)},f.prototype.loadTile=function(c,p){var b=this,w=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);c.request=v.getImage(this.map._requestManager.transformRequest(w,v.ResourceType.Tile),function(A,R){if(delete c.request,c.aborted)c.state="unloaded",p(null);else if(A)c.state="errored",p(A);else if(R){b.map._refreshExpiredTiles&&c.setExpiryData(R),delete R.cacheControl,delete R.expires;var U=b.map.painter.context,q=U.gl;c.texture=b.map.painter.getTileTexture(R.width),c.texture?c.texture.update(R,{useMipmap:!0}):(c.texture=new v.Texture(U,R,q.RGBA,{useMipmap:!0}),c.texture.bind(q.LINEAR,q.CLAMP_TO_EDGE,q.LINEAR_MIPMAP_NEAREST),U.extTextureFilterAnisotropic&&q.texParameterf(q.TEXTURE_2D,U.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,U.extTextureFilterAnisotropicMax)),c.state="loaded",v.cacheEntryPossiblyAdded(b.dispatcher),p(null)}})},f.prototype.abortTile=function(c,p){c.request&&(c.request.cancel(),delete c.request),p()},f.prototype.unloadTile=function(c,p){c.texture&&this.map.painter.saveTileTexture(c.texture),p()},f.prototype.hasTransition=function(){return!1},f}(v.Evented),we=function(l){function f(c,p,b,w){l.call(this,c,p,b,w),this.type="raster-dem",this.maxzoom=22,this._options=v.extend({type:"raster-dem"},p),this.encoding=p.encoding||"mapbox"}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},f.prototype.loadTile=function(c,p){var b=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function w(A,R){A&&(c.state="errored",p(A)),R&&(c.dem=R,c.needsHillshadePrepare=!0,c.state="loaded",p(null))}c.request=v.getImage(this.map._requestManager.transformRequest(b,v.ResourceType.Tile),function(A,R){if(delete c.request,c.aborted)c.state="unloaded",p(null);else if(A)c.state="errored",p(A);else if(R){this.map._refreshExpiredTiles&&c.setExpiryData(R),delete R.cacheControl,delete R.expires;var U=v.window.ImageBitmap&&R instanceof v.window.ImageBitmap&&v.offscreenCanvasSupported()?R:v.browser.getImageData(R,1),q={uid:c.uid,coord:c.tileID,source:this.id,rawImageData:U,encoding:this.encoding};c.actor&&c.state!=="expired"||(c.actor=this.dispatcher.getActor(),c.actor.send("loadDEMTile",q,w.bind(this)))}}.bind(this)),c.neighboringTiles=this._getNeighboringTiles(c.tileID)},f.prototype._getNeighboringTiles=function(c){var p=c.canonical,b=Math.pow(2,p.z),w=(p.x-1+b)%b,A=p.x===0?c.wrap-1:c.wrap,R=(p.x+1+b)%b,U=p.x+1===b?c.wrap+1:c.wrap,q={};return q[new v.OverscaledTileID(c.overscaledZ,A,p.z,w,p.y).key]={backfilled:!1},q[new v.OverscaledTileID(c.overscaledZ,U,p.z,R,p.y).key]={backfilled:!1},p.y>0&&(q[new v.OverscaledTileID(c.overscaledZ,A,p.z,w,p.y-1).key]={backfilled:!1},q[new v.OverscaledTileID(c.overscaledZ,c.wrap,p.z,p.x,p.y-1).key]={backfilled:!1},q[new v.OverscaledTileID(c.overscaledZ,U,p.z,R,p.y-1).key]={backfilled:!1}),p.y+1<b&&(q[new v.OverscaledTileID(c.overscaledZ,A,p.z,w,p.y+1).key]={backfilled:!1},q[new v.OverscaledTileID(c.overscaledZ,c.wrap,p.z,p.x,p.y+1).key]={backfilled:!1},q[new v.OverscaledTileID(c.overscaledZ,U,p.z,R,p.y+1).key]={backfilled:!1}),q},f.prototype.unloadTile=function(c){c.demTexture&&this.map.painter.saveTileTexture(c.demTexture),c.fbo&&(c.fbo.destroy(),delete c.fbo),c.dem&&delete c.dem,delete c.neighboringTiles,c.state="unloaded",c.actor&&c.actor.send("removeDEMTile",{uid:c.uid,source:this.id})},f}(C),Le=function(l){function f(c,p,b,w){l.call(this),this.id=c,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=b.getActor(),this.setEventedParent(w),this._data=p.data,this._options=v.extend({},p),this._collectResourceTiming=p.collectResourceTiming,this._resourceTiming=[],p.maxzoom!==void 0&&(this.maxzoom=p.maxzoom),p.type&&(this.type=p.type),p.attribution&&(this.attribution=p.attribution),this.promoteId=p.promoteId;var A=v.EXTENT/this.tileSize;this.workerOptions=v.extend({source:this.id,cluster:p.cluster||!1,geojsonVtOptions:{buffer:(p.buffer!==void 0?p.buffer:128)*A,tolerance:(p.tolerance!==void 0?p.tolerance:.375)*A,extent:v.EXTENT,maxZoom:this.maxzoom,lineMetrics:p.lineMetrics||!1,generateId:p.generateId||!1},superclusterOptions:{maxZoom:p.clusterMaxZoom!==void 0?Math.min(p.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,p.clusterMinPoints||2),extent:v.EXTENT,radius:(p.clusterRadius||50)*A,log:!1,generateId:p.generateId||!1},clusterProperties:p.clusterProperties,filter:p.filter},p.workerOptions)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){var c=this;this.fire(new v.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(p){if(p)c.fire(new v.ErrorEvent(p));else{var b={dataType:"source",sourceDataType:"metadata"};c._collectResourceTiming&&c._resourceTiming&&c._resourceTiming.length>0&&(b.resourceTiming=c._resourceTiming,c._resourceTiming=[]),c.fire(new v.Event("data",b))}})},f.prototype.onAdd=function(c){this.map=c,this.load()},f.prototype.setData=function(c){var p=this;return this._data=c,this.fire(new v.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(b){if(b)p.fire(new v.ErrorEvent(b));else{var w={dataType:"source",sourceDataType:"content"};p._collectResourceTiming&&p._resourceTiming&&p._resourceTiming.length>0&&(w.resourceTiming=p._resourceTiming,p._resourceTiming=[]),p.fire(new v.Event("data",w))}}),this},f.prototype.getClusterExpansionZoom=function(c,p){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:c,source:this.id},p),this},f.prototype.getClusterChildren=function(c,p){return this.actor.send("geojson.getClusterChildren",{clusterId:c,source:this.id},p),this},f.prototype.getClusterLeaves=function(c,p,b,w){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:c,limit:p,offset:b},w),this},f.prototype._updateWorkerData=function(c){var p=this;this._loaded=!1;var b=v.extend({},this.workerOptions),w=this._data;typeof w=="string"?(b.request=this.map._requestManager.transformRequest(v.browser.resolveURL(w),v.ResourceType.Source),b.request.collectResourceTiming=this._collectResourceTiming):b.data=JSON.stringify(w),this.actor.send(this.type+".loadData",b,function(A,R){p._removed||R&&R.abandoned||(p._loaded=!0,R&&R.resourceTiming&&R.resourceTiming[p.id]&&(p._resourceTiming=R.resourceTiming[p.id].slice(0)),p.actor.send(p.type+".coalesce",{source:b.source},null),c(A))})},f.prototype.loaded=function(){return this._loaded},f.prototype.loadTile=function(c,p){var b=this,w=c.actor?"reloadTile":"loadTile";c.actor=this.actor,c.request=this.actor.send(w,{type:this.type,uid:c.uid,tileID:c.tileID,zoom:c.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:v.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(A,R){return delete c.request,c.unloadVectorData(),c.aborted?p(null):A?p(A):(c.loadVectorData(R,b.map.painter,w==="reloadTile"),p(null))})},f.prototype.abortTile=function(c){c.request&&(c.request.cancel(),delete c.request),c.aborted=!0},f.prototype.unloadTile=function(c){c.unloadVectorData(),this.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id})},f.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},f.prototype.serialize=function(){return v.extend({},this._options,{type:this.type,data:this._data})},f.prototype.hasTransition=function(){return!1},f}(v.Evented),Et=v.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),gt=function(l){function f(c,p,b,w){l.call(this),this.id=c,this.dispatcher=b,this.coordinates=p.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(w),this.options=p}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(c,p){var b=this;this._loaded=!1,this.fire(new v.Event("dataloading",{dataType:"source"})),this.url=this.options.url,v.getImage(this.map._requestManager.transformRequest(this.url,v.ResourceType.Image),function(w,A){b._loaded=!0,w?b.fire(new v.ErrorEvent(w)):A&&(b.image=A,c&&(b.coordinates=c),p&&p(),b._finishLoading())})},f.prototype.loaded=function(){return this._loaded},f.prototype.updateImage=function(c){var p=this;return this.image&&c.url?(this.options.url=c.url,this.load(c.coordinates,function(){p.texture=null}),this):this},f.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new v.Event("data",{dataType:"source",sourceDataType:"metadata"})))},f.prototype.onAdd=function(c){this.map=c,this.load()},f.prototype.setCoordinates=function(c){var p=this;this.coordinates=c;var b=c.map(v.MercatorCoordinate.fromLngLat);this.tileID=function(A){for(var R=1/0,U=1/0,q=-1/0,le=-1/0,fe=0,pe=A;fe<pe.length;fe+=1){var Oe=pe[fe];R=Math.min(R,Oe.x),U=Math.min(U,Oe.y),q=Math.max(q,Oe.x),le=Math.max(le,Oe.y)}var Ce=Math.max(q-R,le-U),We=Math.max(0,Math.floor(-Math.log(Ce)/Math.LN2)),Te=Math.pow(2,We);return new v.CanonicalTileID(We,Math.floor((R+q)/2*Te),Math.floor((U+le)/2*Te))}(b),this.minzoom=this.maxzoom=this.tileID.z;var w=b.map(function(A){return p.tileID.getTilePoint(A)._round()});return this._boundsArray=new v.StructArrayLayout4i8,this._boundsArray.emplaceBack(w[0].x,w[0].y,0,0),this._boundsArray.emplaceBack(w[1].x,w[1].y,v.EXTENT,0),this._boundsArray.emplaceBack(w[3].x,w[3].y,0,v.EXTENT),this._boundsArray.emplaceBack(w[2].x,w[2].y,v.EXTENT,v.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new v.Event("data",{dataType:"source",sourceDataType:"content"})),this},f.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var c=this.map.painter.context,p=c.gl;for(var b in this.boundsBuffer||(this.boundsBuffer=c.createVertexBuffer(this._boundsArray,Et.members)),this.boundsSegments||(this.boundsSegments=v.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new v.Texture(c,this.image,p.RGBA),this.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE)),this.tiles){var w=this.tiles[b];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture)}}},f.prototype.loadTile=function(c,p){this.tileID&&this.tileID.equals(c.tileID.canonical)?(this.tiles[String(c.tileID.wrap)]=c,c.buckets={},p(null)):(c.state="errored",p(null))},f.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},f.prototype.hasTransition=function(){return!1},f}(v.Evented),Lt=function(l){function f(c,p,b,w){l.call(this,c,p,b,w),this.roundZoom=!0,this.type="video",this.options=p}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){var c=this;this._loaded=!1;var p=this.options;this.urls=[];for(var b=0,w=p.urls;b<w.length;b+=1)this.urls.push(this.map._requestManager.transformRequest(w[b],v.ResourceType.Source).url);v.getVideo(this.urls,function(A,R){c._loaded=!0,A?c.fire(new v.ErrorEvent(A)):R&&(c.video=R,c.video.loop=!0,c.video.addEventListener("playing",function(){c.map.triggerRepaint()}),c.map&&c.video.play(),c._finishLoading())})},f.prototype.pause=function(){this.video&&this.video.pause()},f.prototype.play=function(){this.video&&this.video.play()},f.prototype.seek=function(c){if(this.video){var p=this.video.seekable;c<p.start(0)||c>p.end(0)?this.fire(new v.ErrorEvent(new v.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+p.start(0)+" and "+p.end(0)+"-second mark."))):this.video.currentTime=c}},f.prototype.getVideo=function(){return this.video},f.prototype.onAdd=function(c){this.map||(this.map=c,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},f.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var c=this.map.painter.context,p=c.gl;for(var b in this.boundsBuffer||(this.boundsBuffer=c.createVertexBuffer(this._boundsArray,Et.members)),this.boundsSegments||(this.boundsSegments=v.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE),p.texSubImage2D(p.TEXTURE_2D,0,0,0,p.RGBA,p.UNSIGNED_BYTE,this.video)):(this.texture=new v.Texture(c,this.video,p.RGBA),this.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE)),this.tiles){var w=this.tiles[b];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture)}}},f.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},f.prototype.hasTransition=function(){return this.video&&!this.video.paused},f}(gt),Yt=function(l){function f(c,p,b,w){l.call(this,c,p,b,w),p.coordinates?Array.isArray(p.coordinates)&&p.coordinates.length===4&&!p.coordinates.some(function(A){return!Array.isArray(A)||A.length!==2||A.some(function(R){return typeof R!="number"})})||this.fire(new v.ErrorEvent(new v.ValidationError("sources."+c,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new v.ErrorEvent(new v.ValidationError("sources."+c,null,'missing required property "coordinates"'))),p.animate&&typeof p.animate!="boolean"&&this.fire(new v.ErrorEvent(new v.ValidationError("sources."+c,null,'optional "animate" property must be a boolean value'))),p.canvas?typeof p.canvas=="string"||p.canvas instanceof v.window.HTMLCanvasElement||this.fire(new v.ErrorEvent(new v.ValidationError("sources."+c,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new v.ErrorEvent(new v.ValidationError("sources."+c,null,'missing required property "canvas"'))),this.options=p,this.animate=p.animate===void 0||p.animate}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof v.window.HTMLCanvasElement?this.options.canvas:v.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new v.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},f.prototype.getCanvas=function(){return this.canvas},f.prototype.onAdd=function(c){this.map=c,this.load(),this.canvas&&this.animate&&this.play()},f.prototype.onRemove=function(){this.pause()},f.prototype.prepare=function(){var c=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,c=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,c=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var p=this.map.painter.context,b=p.gl;for(var w in this.boundsBuffer||(this.boundsBuffer=p.createVertexBuffer(this._boundsArray,Et.members)),this.boundsSegments||(this.boundsSegments=v.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(c||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new v.Texture(p,this.canvas,b.RGBA,{premultiply:!0}),this.tiles){var A=this.tiles[w];A.state!=="loaded"&&(A.state="loaded",A.texture=this.texture)}}},f.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},f.prototype.hasTransition=function(){return this._playing},f.prototype._hasInvalidDimensions=function(){for(var c=0,p=[this.canvas.width,this.canvas.height];c<p.length;c+=1){var b=p[c];if(isNaN(b)||b<=0)return!0}return!1},f}(gt),br={vector:jr,raster:C,"raster-dem":we,geojson:Le,video:Lt,image:gt,canvas:Yt};function Yn(l,f){var c=v.identity([]);return v.translate(c,c,[1,1,0]),v.scale(c,c,[.5*l.width,.5*l.height,1]),v.multiply(c,c,l.calculatePosMatrix(f.toUnwrapped()))}function cn(l,f,c,p,b,w){var A=function(We,Te,He){if(We)for(var Qe=0,yt=We;Qe<yt.length;Qe+=1){var Vt=Te[yt[Qe]];if(Vt&&Vt.source===He&&Vt.type==="fill-extrusion")return!0}else for(var Nt in Te){var Kt=Te[Nt];if(Kt.source===He&&Kt.type==="fill-extrusion")return!0}return!1}(b&&b.layers,f,l.id),R=w.maxPitchScaleFactor(),U=l.tilesIn(p,R,A);U.sort(ci);for(var q=[],le=0,fe=U;le<fe.length;le+=1){var pe=fe[le];q.push({wrappedTileID:pe.tileID.wrapped().key,queryResults:pe.tile.queryRenderedFeatures(f,c,l._state,pe.queryGeometry,pe.cameraQueryGeometry,pe.scale,b,w,R,Yn(l.transform,pe.tileID))})}var Oe=function(We){for(var Te={},He={},Qe=0,yt=We;Qe<yt.length;Qe+=1){var Vt=yt[Qe],Nt=Vt.queryResults,Kt=Vt.wrappedTileID,cr=He[Kt]=He[Kt]||{};for(var Ir in Nt)for(var Or=Nt[Ir],tn=cr[Ir]=cr[Ir]||{},Rn=Te[Ir]=Te[Ir]||[],Fn=0,Un=Or;Fn<Un.length;Fn+=1){var Li=Un[Fn];tn[Li.featureIndex]||(tn[Li.featureIndex]=!0,Rn.push(Li))}}return Te}(q);for(var Ce in Oe)Oe[Ce].forEach(function(We){var Te=We.feature,He=l.getFeatureState(Te.layer["source-layer"],Te.id);Te.source=Te.layer.source,Te.layer["source-layer"]&&(Te.sourceLayer=Te.layer["source-layer"]),Te.state=He});return Oe}function ci(l,f){var c=l.tileID,p=f.tileID;return c.overscaledZ-p.overscaledZ||c.canonical.y-p.canonical.y||c.wrap-p.wrap||c.canonical.x-p.canonical.x}var Zn=function(l,f){this.max=l,this.onRemove=f,this.reset()};Zn.prototype.reset=function(){for(var l in this.data)for(var f=0,c=this.data[l];f<c.length;f+=1){var p=c[f];p.timeout&&clearTimeout(p.timeout),this.onRemove(p.value)}return this.data={},this.order=[],this},Zn.prototype.add=function(l,f,c){var p=this,b=l.wrapped().key;this.data[b]===void 0&&(this.data[b]=[]);var w={value:f,timeout:void 0};if(c!==void 0&&(w.timeout=setTimeout(function(){p.remove(l,w)},c)),this.data[b].push(w),this.order.push(b),this.order.length>this.max){var A=this._getAndRemoveByKey(this.order[0]);A&&this.onRemove(A)}return this},Zn.prototype.has=function(l){return l.wrapped().key in this.data},Zn.prototype.getAndRemove=function(l){return this.has(l)?this._getAndRemoveByKey(l.wrapped().key):null},Zn.prototype._getAndRemoveByKey=function(l){var f=this.data[l].shift();return f.timeout&&clearTimeout(f.timeout),this.data[l].length===0&&delete this.data[l],this.order.splice(this.order.indexOf(l),1),f.value},Zn.prototype.getByKey=function(l){var f=this.data[l];return f?f[0].value:null},Zn.prototype.get=function(l){return this.has(l)?this.data[l.wrapped().key][0].value:null},Zn.prototype.remove=function(l,f){if(!this.has(l))return this;var c=l.wrapped().key,p=f===void 0?0:this.data[c].indexOf(f),b=this.data[c][p];return this.data[c].splice(p,1),b.timeout&&clearTimeout(b.timeout),this.data[c].length===0&&delete this.data[c],this.onRemove(b.value),this.order.splice(this.order.indexOf(c),1),this},Zn.prototype.setMaxSize=function(l){for(this.max=l;this.order.length>this.max;){var f=this._getAndRemoveByKey(this.order[0]);f&&this.onRemove(f)}return this},Zn.prototype.filter=function(l){var f=[];for(var c in this.data)for(var p=0,b=this.data[c];p<b.length;p+=1){var w=b[p];l(w.value)||f.push(w)}for(var A=0,R=f;A<R.length;A+=1){var U=R[A];this.remove(U.value.tileID,U)}};var ri=function(l,f,c){this.context=l;var p=l.gl;this.buffer=p.createBuffer(),this.dynamicDraw=Boolean(c),this.context.unbindVAO(),l.bindElementBuffer.set(this.buffer),p.bufferData(p.ELEMENT_ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||delete f.arrayBuffer};ri.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},ri.prototype.updateData=function(l){var f=this.context.gl;this.context.unbindVAO(),this.bind(),f.bufferSubData(f.ELEMENT_ARRAY_BUFFER,0,l.arrayBuffer)},ri.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var fi={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},Gn=function(l,f,c,p){this.length=f.length,this.attributes=c,this.itemSize=f.bytesPerElement,this.dynamicDraw=p,this.context=l;var b=l.gl;this.buffer=b.createBuffer(),l.bindVertexBuffer.set(this.buffer),b.bufferData(b.ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||delete f.arrayBuffer};Gn.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},Gn.prototype.updateData=function(l){var f=this.context.gl;this.bind(),f.bufferSubData(f.ARRAY_BUFFER,0,l.arrayBuffer)},Gn.prototype.enableAttributes=function(l,f){for(var c=0;c<this.attributes.length;c++){var p=f.attributes[this.attributes[c].name];p!==void 0&&l.enableVertexAttribArray(p)}},Gn.prototype.setVertexAttribPointers=function(l,f,c){for(var p=0;p<this.attributes.length;p++){var b=this.attributes[p],w=f.attributes[b.name];w!==void 0&&l.vertexAttribPointer(w,b.components,l[fi[b.type]],!1,this.itemSize,b.offset+this.itemSize*(c||0))}},Gn.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var hi=function(l){this.gl=l.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};hi.prototype.get=function(){return this.current},hi.prototype.set=function(l){},hi.prototype.getDefault=function(){return this.default},hi.prototype.setDefault=function(){this.set(this.default)};var la=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return v.Color.transparent},f.prototype.set=function(c){var p=this.current;(c.r!==p.r||c.g!==p.g||c.b!==p.b||c.a!==p.a||this.dirty)&&(this.gl.clearColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)},f}(hi),Vi=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return 1},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.clearDepth(c),this.current=c,this.dirty=!1)},f}(hi),Oi=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return 0},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.clearStencil(c),this.current=c,this.dirty=!1)},f}(hi),qi=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return[!0,!0,!0,!0]},f.prototype.set=function(c){var p=this.current;(c[0]!==p[0]||c[1]!==p[1]||c[2]!==p[2]||c[3]!==p[3]||this.dirty)&&(this.gl.colorMask(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)},f}(hi),ca=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!0},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.depthMask(c),this.current=c,this.dirty=!1)},f}(hi),Ci=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return 255},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.stencilMask(c),this.current=c,this.dirty=!1)},f}(hi),ma=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},f.prototype.set=function(c){var p=this.current;(c.func!==p.func||c.ref!==p.ref||c.mask!==p.mask||this.dirty)&&(this.gl.stencilFunc(c.func,c.ref,c.mask),this.current=c,this.dirty=!1)},f}(hi),Xn=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){var c=this.gl;return[c.KEEP,c.KEEP,c.KEEP]},f.prototype.set=function(c){var p=this.current;(c[0]!==p[0]||c[1]!==p[1]||c[2]!==p[2]||this.dirty)&&(this.gl.stencilOp(c[0],c[1],c[2]),this.current=c,this.dirty=!1)},f}(hi),bi=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var p=this.gl;c?p.enable(p.STENCIL_TEST):p.disable(p.STENCIL_TEST),this.current=c,this.dirty=!1}},f}(hi),Ni=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return[0,1]},f.prototype.set=function(c){var p=this.current;(c[0]!==p[0]||c[1]!==p[1]||this.dirty)&&(this.gl.depthRange(c[0],c[1]),this.current=c,this.dirty=!1)},f}(hi),Ki=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var p=this.gl;c?p.enable(p.DEPTH_TEST):p.disable(p.DEPTH_TEST),this.current=c,this.dirty=!1}},f}(hi),Oo=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.LESS},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.depthFunc(c),this.current=c,this.dirty=!1)},f}(hi),he=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var p=this.gl;c?p.enable(p.BLEND):p.disable(p.BLEND),this.current=c,this.dirty=!1}},f}(hi),On=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){var c=this.gl;return[c.ONE,c.ZERO]},f.prototype.set=function(c){var p=this.current;(c[0]!==p[0]||c[1]!==p[1]||this.dirty)&&(this.gl.blendFunc(c[0],c[1]),this.current=c,this.dirty=!1)},f}(hi),Ua=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return v.Color.transparent},f.prototype.set=function(c){var p=this.current;(c.r!==p.r||c.g!==p.g||c.b!==p.b||c.a!==p.a||this.dirty)&&(this.gl.blendColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)},f}(hi),rs=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.FUNC_ADD},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.blendEquation(c),this.current=c,this.dirty=!1)},f}(hi),Dt=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var p=this.gl;c?p.enable(p.CULL_FACE):p.disable(p.CULL_FACE),this.current=c,this.dirty=!1}},f}(hi),tr=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.BACK},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.cullFace(c),this.current=c,this.dirty=!1)},f}(hi),Er=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.CCW},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.frontFace(c),this.current=c,this.dirty=!1)},f}(hi),$r=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.useProgram(c),this.current=c,this.dirty=!1)},f}(hi),xn=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.TEXTURE0},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.activeTexture(c),this.current=c,this.dirty=!1)},f}(hi),Dn=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){var c=this.gl;return[0,0,c.drawingBufferWidth,c.drawingBufferHeight]},f.prototype.set=function(c){var p=this.current;(c[0]!==p[0]||c[1]!==p[1]||c[2]!==p[2]||c[3]!==p[3]||this.dirty)&&(this.gl.viewport(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)},f}(hi),pi=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){if(c!==this.current||this.dirty){var p=this.gl;p.bindFramebuffer(p.FRAMEBUFFER,c),this.current=c,this.dirty=!1}},f}(hi),qn=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){if(c!==this.current||this.dirty){var p=this.gl;p.bindRenderbuffer(p.RENDERBUFFER,c),this.current=c,this.dirty=!1}},f}(hi),on=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){if(c!==this.current||this.dirty){var p=this.gl;p.bindTexture(p.TEXTURE_2D,c),this.current=c,this.dirty=!1}},f}(hi),Ri=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){if(c!==this.current||this.dirty){var p=this.gl;p.bindBuffer(p.ARRAY_BUFFER,c),this.current=c,this.dirty=!1}},f}(hi),Ii=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){var p=this.gl;p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,c),this.current=c,this.dirty=!1},f}(hi),Qa=function(l){function f(c){l.call(this,c),this.vao=c.extVertexArrayObject}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){this.vao&&(c!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(c),this.current=c,this.dirty=!1)},f}(hi),hs=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return 4},f.prototype.set=function(c){if(c!==this.current||this.dirty){var p=this.gl;p.pixelStorei(p.UNPACK_ALIGNMENT,c),this.current=c,this.dirty=!1}},f}(hi),Zo=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var p=this.gl;p.pixelStorei(p.UNPACK_PREMULTIPLY_ALPHA_WEBGL,c),this.current=c,this.dirty=!1}},f}(hi),Fa=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var p=this.gl;p.pixelStorei(p.UNPACK_FLIP_Y_WEBGL,c),this.current=c,this.dirty=!1}},f}(hi),ba=function(l){function f(c,p){l.call(this,c),this.context=c,this.parent=p}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f}(hi),G=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.setDirty=function(){this.dirty=!0},f.prototype.set=function(c){if(c!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var p=this.gl;p.framebufferTexture2D(p.FRAMEBUFFER,p.COLOR_ATTACHMENT0,p.TEXTURE_2D,c,0),this.current=c,this.dirty=!1}},f}(ba),ee=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.set=function(c){if(c!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var p=this.gl;p.framebufferRenderbuffer(p.FRAMEBUFFER,p.DEPTH_ATTACHMENT,p.RENDERBUFFER,c),this.current=c,this.dirty=!1}},f}(ba),ae=function(l,f,c,p){this.context=l,this.width=f,this.height=c;var b=this.framebuffer=l.gl.createFramebuffer();this.colorAttachment=new G(l,b),p&&(this.depthAttachment=new ee(l,b))};ae.prototype.destroy=function(){var l=this.context.gl,f=this.colorAttachment.get();if(f&&l.deleteTexture(f),this.depthAttachment){var c=this.depthAttachment.get();c&&l.deleteRenderbuffer(c)}l.deleteFramebuffer(this.framebuffer)};var me=function(l,f,c){this.func=l,this.mask=f,this.range=c};me.ReadOnly=!1,me.ReadWrite=!0,me.disabled=new me(519,me.ReadOnly,[0,1]);var Pe=function(l,f,c,p,b,w){this.test=l,this.ref=f,this.mask=c,this.fail=p,this.depthFail=b,this.pass=w};Pe.disabled=new Pe({func:519,mask:0},0,0,7680,7680,7680);var Ge=function(l,f,c){this.blendFunction=l,this.blendColor=f,this.mask=c};Ge.disabled=new Ge(Ge.Replace=[1,0],v.Color.transparent,[!1,!1,!1,!1]),Ge.unblended=new Ge(Ge.Replace,v.Color.transparent,[!0,!0,!0,!0]),Ge.alphaBlended=new Ge([1,771],v.Color.transparent,[!0,!0,!0,!0]);var tt=function(l,f,c){this.enable=l,this.mode=f,this.frontFace=c};tt.disabled=new tt(!1,1029,2305),tt.backCCW=new tt(!0,1029,2305);var ce=function(l){this.gl=l,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new la(this),this.clearDepth=new Vi(this),this.clearStencil=new Oi(this),this.colorMask=new qi(this),this.depthMask=new ca(this),this.stencilMask=new Ci(this),this.stencilFunc=new ma(this),this.stencilOp=new Xn(this),this.stencilTest=new bi(this),this.depthRange=new Ni(this),this.depthTest=new Ki(this),this.depthFunc=new Oo(this),this.blend=new he(this),this.blendFunc=new On(this),this.blendColor=new Ua(this),this.blendEquation=new rs(this),this.cullFace=new Dt(this),this.cullFaceSide=new tr(this),this.frontFace=new Er(this),this.program=new $r(this),this.activeTexture=new xn(this),this.viewport=new Dn(this),this.bindFramebuffer=new pi(this),this.bindRenderbuffer=new qn(this),this.bindTexture=new on(this),this.bindVertexBuffer=new Ri(this),this.bindElementBuffer=new Ii(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Qa(this),this.pixelStoreUnpack=new hs(this),this.pixelStoreUnpackPremultiplyAlpha=new Zo(this),this.pixelStoreUnpackFlipY=new Fa(this),this.extTextureFilterAnisotropic=l.getExtension("EXT_texture_filter_anisotropic")||l.getExtension("MOZ_EXT_texture_filter_anisotropic")||l.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=l.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=l.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(l.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=l.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=l.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=l.getParameter(l.MAX_TEXTURE_SIZE)};ce.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},ce.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},ce.prototype.createIndexBuffer=function(l,f){return new ri(this,l,f)},ce.prototype.createVertexBuffer=function(l,f,c){return new Gn(this,l,f,c)},ce.prototype.createRenderbuffer=function(l,f,c){var p=this.gl,b=p.createRenderbuffer();return this.bindRenderbuffer.set(b),p.renderbufferStorage(p.RENDERBUFFER,l,f,c),this.bindRenderbuffer.set(null),b},ce.prototype.createFramebuffer=function(l,f,c){return new ae(this,l,f,c)},ce.prototype.clear=function(l){var f=l.color,c=l.depth,p=this.gl,b=0;f&&(b|=p.COLOR_BUFFER_BIT,this.clearColor.set(f),this.colorMask.set([!0,!0,!0,!0])),c!==void 0&&(b|=p.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),p.clear(b)},ce.prototype.setCullFace=function(l){l.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(l.mode),this.frontFace.set(l.frontFace))},ce.prototype.setDepthMode=function(l){l.func!==this.gl.ALWAYS||l.mask?(this.depthTest.set(!0),this.depthFunc.set(l.func),this.depthMask.set(l.mask),this.depthRange.set(l.range)):this.depthTest.set(!1)},ce.prototype.setStencilMode=function(l){l.test.func!==this.gl.ALWAYS||l.mask?(this.stencilTest.set(!0),this.stencilMask.set(l.mask),this.stencilOp.set([l.fail,l.depthFail,l.pass]),this.stencilFunc.set({func:l.test.func,ref:l.ref,mask:l.test.mask})):this.stencilTest.set(!1)},ce.prototype.setColorMode=function(l){v.deepEqual(l.blendFunction,Ge.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(l.blendFunction),this.blendColor.set(l.blendColor)),this.colorMask.set(l.mask)},ce.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var Re=function(l){function f(c,p,b){var w=this;l.call(this),this.id=c,this.dispatcher=b,this.on("data",function(A){A.dataType==="source"&&A.sourceDataType==="metadata"&&(w._sourceLoaded=!0),w._sourceLoaded&&!w._paused&&A.dataType==="source"&&A.sourceDataType==="content"&&(w.reload(),w.transform&&w.update(w.transform))}),this.on("error",function(){w._sourceErrored=!0}),this._source=function(A,R,U,q){var le=new br[R.type](A,R,U,q);if(le.id!==A)throw new Error("Expected Source id to be "+A+" instead of "+le.id);return v.bindAll(["load","abort","unload","serialize","prepare"],le),le}(c,p,b,this),this._tiles={},this._cache=new Zn(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new v.SourceFeatureState}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.onAdd=function(c){this.map=c,this._maxTileCacheSize=c?c._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(c)},f.prototype.onRemove=function(c){this._source&&this._source.onRemove&&this._source.onRemove(c)},f.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var c in this._tiles){var p=this._tiles[c];if(p.state!=="loaded"&&p.state!=="errored")return!1}return!0},f.prototype.getSource=function(){return this._source},f.prototype.pause=function(){this._paused=!0},f.prototype.resume=function(){if(this._paused){var c=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,c&&this.reload(),this.transform&&this.update(this.transform)}},f.prototype._loadTile=function(c,p){return this._source.loadTile(c,p)},f.prototype._unloadTile=function(c){if(this._source.unloadTile)return this._source.unloadTile(c,function(){})},f.prototype._abortTile=function(c){if(this._source.abortTile)return this._source.abortTile(c,function(){})},f.prototype.serialize=function(){return this._source.serialize()},f.prototype.prepare=function(c){for(var p in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var b=this._tiles[p];b.upload(c),b.prepare(this.map.style.imageManager)}},f.prototype.getIds=function(){return v.values(this._tiles).map(function(c){return c.tileID}).sort(mt).map(function(c){return c.key})},f.prototype.getRenderableIds=function(c){var p=this,b=[];for(var w in this._tiles)this._isIdRenderable(w,c)&&b.push(this._tiles[w]);return c?b.sort(function(A,R){var U=A.tileID,q=R.tileID,le=new v.Point(U.canonical.x,U.canonical.y)._rotate(p.transform.angle),fe=new v.Point(q.canonical.x,q.canonical.y)._rotate(p.transform.angle);return U.overscaledZ-q.overscaledZ||fe.y-le.y||fe.x-le.x}).map(function(A){return A.tileID.key}):b.map(function(A){return A.tileID}).sort(mt).map(function(A){return A.key})},f.prototype.hasRenderableParent=function(c){var p=this.findLoadedParent(c,0);return!!p&&this._isIdRenderable(p.tileID.key)},f.prototype._isIdRenderable=function(c,p){return this._tiles[c]&&this._tiles[c].hasData()&&!this._coveredTiles[c]&&(p||!this._tiles[c].holdingForFade())},f.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var c in this._cache.reset(),this._tiles)this._tiles[c].state!=="errored"&&this._reloadTile(c,"reloading")},f.prototype._reloadTile=function(c,p){var b=this._tiles[c];b&&(b.state!=="loading"&&(b.state=p),this._loadTile(b,this._tileLoaded.bind(this,b,c,p)))},f.prototype._tileLoaded=function(c,p,b,w){if(w)return c.state="errored",void(w.status!==404?this._source.fire(new v.ErrorEvent(w,{tile:c})):this.update(this.transform));c.timeAdded=v.browser.now(),b==="expired"&&(c.refreshedUponExpiration=!0),this._setTileReloadTimer(p,c),this.getSource().type==="raster-dem"&&c.dem&&this._backfillDEM(c),this._state.initializeTileState(c,this.map?this.map.painter:null),this._source.fire(new v.Event("data",{dataType:"source",tile:c,coord:c.tileID}))},f.prototype._backfillDEM=function(c){for(var p=this.getRenderableIds(),b=0;b<p.length;b++){var w=p[b];if(c.neighboringTiles&&c.neighboringTiles[w]){var A=this.getTileByID(w);R(c,A),R(A,c)}}function R(U,q){U.needsHillshadePrepare=!0;var le=q.tileID.canonical.x-U.tileID.canonical.x,fe=q.tileID.canonical.y-U.tileID.canonical.y,pe=Math.pow(2,U.tileID.canonical.z),Oe=q.tileID.key;le===0&&fe===0||Math.abs(fe)>1||(Math.abs(le)>1&&(Math.abs(le+pe)===1?le+=pe:Math.abs(le-pe)===1&&(le-=pe)),q.dem&&U.dem&&(U.dem.backfillBorder(q.dem,le,fe),U.neighboringTiles&&U.neighboringTiles[Oe]&&(U.neighboringTiles[Oe].backfilled=!0)))}},f.prototype.getTile=function(c){return this.getTileByID(c.key)},f.prototype.getTileByID=function(c){return this._tiles[c]},f.prototype._retainLoadedChildren=function(c,p,b,w){for(var A in this._tiles){var R=this._tiles[A];if(!(w[A]||!R.hasData()||R.tileID.overscaledZ<=p||R.tileID.overscaledZ>b)){for(var U=R.tileID;R&&R.tileID.overscaledZ>p+1;){var q=R.tileID.scaledTo(R.tileID.overscaledZ-1);(R=this._tiles[q.key])&&R.hasData()&&(U=q)}for(var le=U;le.overscaledZ>p;)if(c[(le=le.scaledTo(le.overscaledZ-1)).key]){w[U.key]=U;break}}}},f.prototype.findLoadedParent=function(c,p){if(c.key in this._loadedParentTiles){var b=this._loadedParentTiles[c.key];return b&&b.tileID.overscaledZ>=p?b:null}for(var w=c.overscaledZ-1;w>=p;w--){var A=c.scaledTo(w),R=this._getLoadedTile(A);if(R)return R}},f.prototype._getLoadedTile=function(c){var p=this._tiles[c.key];return p&&p.hasData()?p:this._cache.getByKey(c.wrapped().key)},f.prototype.updateCacheSize=function(c){var p=Math.ceil(c.width/this._source.tileSize)+1,b=Math.ceil(c.height/this._source.tileSize)+1,w=Math.floor(p*b*5),A=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,w):w;this._cache.setMaxSize(A)},f.prototype.handleWrapJump=function(c){var p=Math.round((c-(this._prevLng===void 0?c:this._prevLng))/360);if(this._prevLng=c,p){var b={};for(var w in this._tiles){var A=this._tiles[w];A.tileID=A.tileID.unwrapTo(A.tileID.wrap+p),b[A.tileID.key]=A}for(var R in this._tiles=b,this._timers)clearTimeout(this._timers[R]),delete this._timers[R];for(var U in this._tiles)this._setTileReloadTimer(U,this._tiles[U])}},f.prototype.update=function(c){var p=this;if(this.transform=c,this._sourceLoaded&&!this._paused){var b;this.updateCacheSize(c),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?b=c.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(cr){return new v.OverscaledTileID(cr.canonical.z,cr.wrap,cr.canonical.z,cr.canonical.x,cr.canonical.y)}):(b=c.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(b=b.filter(function(cr){return p._source.hasTile(cr)}))):b=[];var w=c.coveringZoomLevel(this._source),A=Math.max(w-f.maxOverzooming,this._source.minzoom),R=Math.max(w+f.maxUnderzooming,this._source.minzoom),U=this._updateRetainedTiles(b,w);if(hr(this._source.type)){for(var q={},le={},fe=0,pe=Object.keys(U);fe<pe.length;fe+=1){var Oe=pe[fe],Ce=U[Oe],We=this._tiles[Oe];if(We&&!(We.fadeEndTime&&We.fadeEndTime<=v.browser.now())){var Te=this.findLoadedParent(Ce,A);Te&&(this._addTile(Te.tileID),q[Te.tileID.key]=Te.tileID),le[Oe]=Ce}}for(var He in this._retainLoadedChildren(le,w,R,U),q)U[He]||(this._coveredTiles[He]=!0,U[He]=q[He])}for(var Qe in U)this._tiles[Qe].clearFadeHold();for(var yt=0,Vt=v.keysDifference(this._tiles,U);yt<Vt.length;yt+=1){var Nt=Vt[yt],Kt=this._tiles[Nt];Kt.hasSymbolBuckets&&!Kt.holdingForFade()?Kt.setHoldDuration(this.map._fadeDuration):Kt.hasSymbolBuckets&&!Kt.symbolFadeFinished()||this._removeTile(Nt)}this._updateLoadedParentTileCache()}},f.prototype.releaseSymbolFadeTiles=function(){for(var c in this._tiles)this._tiles[c].holdingForFade()&&this._removeTile(c)},f.prototype._updateRetainedTiles=function(c,p){for(var b={},w={},A=Math.max(p-f.maxOverzooming,this._source.minzoom),R=Math.max(p+f.maxUnderzooming,this._source.minzoom),U={},q=0,le=c;q<le.length;q+=1){var fe=le[q],pe=this._addTile(fe);b[fe.key]=fe,pe.hasData()||p<this._source.maxzoom&&(U[fe.key]=fe)}this._retainLoadedChildren(U,p,R,b);for(var Oe=0,Ce=c;Oe<Ce.length;Oe+=1){var We=Ce[Oe],Te=this._tiles[We.key];if(!Te.hasData()){if(p+1>this._source.maxzoom){var He=We.children(this._source.maxzoom)[0],Qe=this.getTile(He);if(Qe&&Qe.hasData()){b[He.key]=He;continue}}else{var yt=We.children(this._source.maxzoom);if(b[yt[0].key]&&b[yt[1].key]&&b[yt[2].key]&&b[yt[3].key])continue}for(var Vt=Te.wasRequested(),Nt=We.overscaledZ-1;Nt>=A;--Nt){var Kt=We.scaledTo(Nt);if(w[Kt.key]||(w[Kt.key]=!0,!(Te=this.getTile(Kt))&&Vt&&(Te=this._addTile(Kt)),Te&&(b[Kt.key]=Kt,Vt=Te.wasRequested(),Te.hasData())))break}}}return b},f.prototype._updateLoadedParentTileCache=function(){for(var c in this._loadedParentTiles={},this._tiles){for(var p=[],b=void 0,w=this._tiles[c].tileID;w.overscaledZ>0;){if(w.key in this._loadedParentTiles){b=this._loadedParentTiles[w.key];break}p.push(w.key);var A=w.scaledTo(w.overscaledZ-1);if(b=this._getLoadedTile(A))break;w=A}for(var R=0,U=p;R<U.length;R+=1)this._loadedParentTiles[U[R]]=b}},f.prototype._addTile=function(c){var p=this._tiles[c.key];if(p)return p;(p=this._cache.getAndRemove(c))&&(this._setTileReloadTimer(c.key,p),p.tileID=c,this._state.initializeTileState(p,this.map?this.map.painter:null),this._cacheTimers[c.key]&&(clearTimeout(this._cacheTimers[c.key]),delete this._cacheTimers[c.key],this._setTileReloadTimer(c.key,p)));var b=Boolean(p);return b||(p=new v.Tile(c,this._source.tileSize*c.overscaleFactor()),this._loadTile(p,this._tileLoaded.bind(this,p,c.key,p.state))),p?(p.uses++,this._tiles[c.key]=p,b||this._source.fire(new v.Event("dataloading",{tile:p,coord:p.tileID,dataType:"source"})),p):null},f.prototype._setTileReloadTimer=function(c,p){var b=this;c in this._timers&&(clearTimeout(this._timers[c]),delete this._timers[c]);var w=p.getExpiryTimeout();w&&(this._timers[c]=setTimeout(function(){b._reloadTile(c,"expired"),delete b._timers[c]},w))},f.prototype._removeTile=function(c){var p=this._tiles[c];p&&(p.uses--,delete this._tiles[c],this._timers[c]&&(clearTimeout(this._timers[c]),delete this._timers[c]),p.uses>0||(p.hasData()&&p.state!=="reloading"?this._cache.add(p.tileID,p,p.getExpiryTimeout()):(p.aborted=!0,this._abortTile(p),this._unloadTile(p))))},f.prototype.clearTiles=function(){for(var c in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(c);this._cache.reset()},f.prototype.tilesIn=function(c,p,b){var w=this,A=[],R=this.transform;if(!R)return A;for(var U=b?R.getCameraQueryGeometry(c):c,q=c.map(function(Nt){return R.pointCoordinate(Nt)}),le=U.map(function(Nt){return R.pointCoordinate(Nt)}),fe=this.getIds(),pe=1/0,Oe=1/0,Ce=-1/0,We=-1/0,Te=0,He=le;Te<He.length;Te+=1){var Qe=He[Te];pe=Math.min(pe,Qe.x),Oe=Math.min(Oe,Qe.y),Ce=Math.max(Ce,Qe.x),We=Math.max(We,Qe.y)}for(var yt=function(Nt){var Kt=w._tiles[fe[Nt]];if(!Kt.holdingForFade()){var cr=Kt.tileID,Ir=Math.pow(2,R.zoom-Kt.tileID.overscaledZ),Or=p*Kt.queryPadding*v.EXTENT/Kt.tileSize/Ir,tn=[cr.getTilePoint(new v.MercatorCoordinate(pe,Oe)),cr.getTilePoint(new v.MercatorCoordinate(Ce,We))];if(tn[0].x-Or<v.EXTENT&&tn[0].y-Or<v.EXTENT&&tn[1].x+Or>=0&&tn[1].y+Or>=0){var Rn=q.map(function(Un){return cr.getTilePoint(Un)}),Fn=le.map(function(Un){return cr.getTilePoint(Un)});A.push({tile:Kt,tileID:cr,queryGeometry:Rn,cameraQueryGeometry:Fn,scale:Ir})}}},Vt=0;Vt<fe.length;Vt++)yt(Vt);return A},f.prototype.getVisibleCoordinates=function(c){for(var p=this,b=this.getRenderableIds(c).map(function(U){return p._tiles[U].tileID}),w=0,A=b;w<A.length;w+=1){var R=A[w];R.posMatrix=this.transform.calculatePosMatrix(R.toUnwrapped())}return b},f.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(hr(this._source.type))for(var c in this._tiles){var p=this._tiles[c];if(p.fadeEndTime!==void 0&&p.fadeEndTime>=v.browser.now())return!0}return!1},f.prototype.setFeatureState=function(c,p,b){this._state.updateState(c=c||"_geojsonTileLayer",p,b)},f.prototype.removeFeatureState=function(c,p,b){this._state.removeFeatureState(c=c||"_geojsonTileLayer",p,b)},f.prototype.getFeatureState=function(c,p){return this._state.getState(c=c||"_geojsonTileLayer",p)},f.prototype.setDependencies=function(c,p,b){var w=this._tiles[c];w&&w.setDependencies(p,b)},f.prototype.reloadTilesForDependencies=function(c,p){for(var b in this._tiles)this._tiles[b].hasDependency(c,p)&&this._reloadTile(b,"reloading");this._cache.filter(function(w){return!w.hasDependency(c,p)})},f}(v.Evented);function mt(l,f){var c=Math.abs(2*l.wrap)-+(l.wrap<0),p=Math.abs(2*f.wrap)-+(f.wrap<0);return l.overscaledZ-f.overscaledZ||p-c||f.canonical.y-l.canonical.y||f.canonical.x-l.canonical.x}function hr(l){return l==="raster"||l==="image"||l==="video"}function Ot(){return new v.window.Worker(yl.workerUrl)}Re.maxOverzooming=10,Re.maxUnderzooming=3;var Ft="mapboxgl_preloaded_worker_pool",pr=function(){this.active={}};pr.prototype.acquire=function(l){if(!this.workers)for(this.workers=[];this.workers.length<pr.workerCount;)this.workers.push(new Ot);return this.active[l]=!0,this.workers.slice()},pr.prototype.release=function(l){delete this.active[l],this.numActive()===0&&(this.workers.forEach(function(f){f.terminate()}),this.workers=null)},pr.prototype.isPreloaded=function(){return!!this.active[Ft]},pr.prototype.numActive=function(){return Object.keys(this.active).length};var gn,un=Math.floor(v.browser.hardwareConcurrency/2);function Tt(){return gn||(gn=new pr),gn}function Jr(l,f){var c={};for(var p in l)p!=="ref"&&(c[p]=l[p]);return v.refProperties.forEach(function(b){b in f&&(c[b]=f[b])}),c}function Dr(l){l=l.slice();for(var f=Object.create(null),c=0;c<l.length;c++)f[l[c].id]=l[c];for(var p=0;p<l.length;p++)"ref"in l[p]&&(l[p]=Jr(l[p],f[l[p].ref]));return l}pr.workerCount=Math.max(Math.min(un,6),1);var Gr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function vi(l,f,c){c.push({command:Gr.addSource,args:[l,f[l]]})}function Qr(l,f,c){f.push({command:Gr.removeSource,args:[l]}),c[l]=!0}function An(l,f,c,p){Qr(l,c,p),vi(l,f,c)}function Wi(l,f,c){var p;for(p in l[c])if(l[c].hasOwnProperty(p)&&p!=="data"&&!v.deepEqual(l[c][p],f[c][p]))return!1;for(p in f[c])if(f[c].hasOwnProperty(p)&&p!=="data"&&!v.deepEqual(l[c][p],f[c][p]))return!1;return!0}function di(l,f,c,p,b,w){var A;for(A in f=f||{},l=l||{})l.hasOwnProperty(A)&&(v.deepEqual(l[A],f[A])||c.push({command:w,args:[p,A,f[A],b]}));for(A in f)f.hasOwnProperty(A)&&!l.hasOwnProperty(A)&&(v.deepEqual(l[A],f[A])||c.push({command:w,args:[p,A,f[A],b]}))}function Ti(l){return l.id}function _i(l,f){return l[f.id]=f,l}var Ct=function(l,f){this.reset(l,f)};Ct.prototype.reset=function(l,f){this.points=l||[],this._distances=[0];for(var c=1;c<this.points.length;c++)this._distances[c]=this._distances[c-1]+this.points[c].dist(this.points[c-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(f||0,.5*this.length),this.paddedLength=this.length-2*this.padding},Ct.prototype.lerp=function(l){if(this.points.length===1)return this.points[0];l=v.clamp(l,0,1);for(var f=1,c=this._distances[f],p=l*this.paddedLength+this.padding;c<p&&f<this._distances.length;)c=this._distances[++f];var b=f-1,w=this._distances[b],A=c-w,R=A>0?(p-w)/A:0;return this.points[b].mult(1-R).add(this.points[f].mult(R))};var qt=function(l,f,c){var p=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(l/c),this.yCellCount=Math.ceil(f/c);for(var w=0;w<this.xCellCount*this.yCellCount;w++)p.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=l,this.height=f,this.xScale=this.xCellCount/l,this.yScale=this.yCellCount/f,this.boxUid=0,this.circleUid=0};function Aa(l,f,c,p,b){var w=v.create();return f?(v.scale(w,w,[1/b,1/b,1]),c||v.rotateZ(w,w,p.angle)):v.multiply(w,p.labelPlaneMatrix,l),w}function Ei(l,f,c,p,b){if(f){var w=v.clone(l);return v.scale(w,w,[b,b,1]),c||v.rotateZ(w,w,-p.angle),w}return p.glCoordMatrix}function Ai(l,f){var c=[l.x,l.y,0,1];Ma(c,c,f);var p=c[3];return{point:new v.Point(c[0]/p,c[1]/p),signedDistanceFromCamera:p}}function Bi(l,f){return .5+l/f*.5}function Yr(l,f){var c=l[0]/l[3],p=l[1]/l[3];return c>=-f[0]&&c<=f[0]&&p>=-f[1]&&p<=f[1]}function wn(l,f,c,p,b,w,A,R){var U=p?l.textSizeData:l.iconSizeData,q=v.evaluateSizeForZoom(U,c.transform.zoom),le=[256/c.width*2+1,256/c.height*2+1],fe=p?l.text.dynamicLayoutVertexArray:l.icon.dynamicLayoutVertexArray;fe.clear();for(var pe=l.lineVertexArray,Oe=p?l.text.placedSymbolArray:l.icon.placedSymbolArray,Ce=c.transform.width/c.transform.height,We=!1,Te=0;Te<Oe.length;Te++){var He=Oe.get(Te);if(He.hidden||He.writingMode===v.WritingMode.vertical&&!We)Na(He.numGlyphs,fe);else{We=!1;var Qe=[He.anchorX,He.anchorY,0,1];if(v.transformMat4(Qe,Qe,f),Yr(Qe,le)){var yt=Bi(c.transform.cameraToCenterDistance,Qe[3]),Vt=v.evaluateSizeForFeature(U,q,He),Nt=A?Vt/yt:Vt*yt,Kt=new v.Point(He.anchorX,He.anchorY),cr=Ai(Kt,b).point,Ir={},Or=be(He,Nt,!1,R,f,b,w,l.glyphOffsetArray,pe,fe,cr,Kt,Ir,Ce);We=Or.useVertical,(Or.notEnoughRoom||We||Or.needsFlipping&&be(He,Nt,!0,R,f,b,w,l.glyphOffsetArray,pe,fe,cr,Kt,Ir,Ce).notEnoughRoom)&&Na(He.numGlyphs,fe)}else Na(He.numGlyphs,fe)}}p?l.text.dynamicLayoutVertexBuffer.updateData(fe):l.icon.dynamicLayoutVertexBuffer.updateData(fe)}function zt(l,f,c,p,b,w,A,R,U,q,le){var fe=R.glyphStartIndex+R.numGlyphs,pe=R.lineStartIndex,Oe=R.lineStartIndex+R.lineLength,Ce=f.getoffsetX(R.glyphStartIndex),We=f.getoffsetX(fe-1),Te=ea(l*Ce,c,p,b,w,A,R.segment,pe,Oe,U,q,le);if(!Te)return null;var He=ea(l*We,c,p,b,w,A,R.segment,pe,Oe,U,q,le);return He?{first:Te,last:He}:null}function aa(l,f,c,p){return l===v.WritingMode.horizontal&&Math.abs(c.y-f.y)>Math.abs(c.x-f.x)*p?{useVertical:!0}:(l===v.WritingMode.vertical?f.y<c.y:f.x>c.x)?{needsFlipping:!0}:null}function be(l,f,c,p,b,w,A,R,U,q,le,fe,pe,Oe){var Ce,We=f/24,Te=l.lineOffsetX*We,He=l.lineOffsetY*We;if(l.numGlyphs>1){var Qe=l.glyphStartIndex+l.numGlyphs,yt=l.lineStartIndex,Vt=l.lineStartIndex+l.lineLength,Nt=zt(We,R,Te,He,c,le,fe,l,U,w,pe);if(!Nt)return{notEnoughRoom:!0};var Kt=Ai(Nt.first.point,A).point,cr=Ai(Nt.last.point,A).point;if(p&&!c){var Ir=aa(l.writingMode,Kt,cr,Oe);if(Ir)return Ir}Ce=[Nt.first];for(var Or=l.glyphStartIndex+1;Or<Qe-1;Or++)Ce.push(ea(We*R.getoffsetX(Or),Te,He,c,le,fe,l.segment,yt,Vt,U,w,pe));Ce.push(Nt.last)}else{if(p&&!c){var tn=Ai(fe,b).point,Rn=l.lineStartIndex+l.segment+1,Fn=new v.Point(U.getx(Rn),U.gety(Rn)),Un=Ai(Fn,b),Li=Un.signedDistanceFromCamera>0?Un.point:Ko(fe,Fn,tn,1,b),Zr=aa(l.writingMode,tn,Li,Oe);if(Zr)return Zr}var ii=ea(We*R.getoffsetX(l.glyphStartIndex),Te,He,c,le,fe,l.segment,l.lineStartIndex,l.lineStartIndex+l.lineLength,U,w,pe);if(!ii)return{notEnoughRoom:!0};Ce=[ii]}for(var si=0,Qn=Ce;si<Qn.length;si+=1){var Hn=Qn[si];v.addDynamicAttributes(q,Hn.point,Hn.angle)}return{}}function Ko(l,f,c,p,b){var w=Ai(l.add(l.sub(f)._unit()),b).point,A=c.sub(w);return c.add(A._mult(p/A.mag()))}function ea(l,f,c,p,b,w,A,R,U,q,le,fe){var pe=p?l-f:l+f,Oe=pe>0?1:-1,Ce=0;p&&(Oe*=-1,Ce=Math.PI),Oe<0&&(Ce+=Math.PI);for(var We=Oe>0?R+A:R+A+1,Te=b,He=b,Qe=0,yt=0,Vt=Math.abs(pe),Nt=[];Qe+yt<=Vt;){if((We+=Oe)<R||We>=U)return null;if(He=Te,Nt.push(Te),(Te=fe[We])===void 0){var Kt=new v.Point(q.getx(We),q.gety(We)),cr=Ai(Kt,le);if(cr.signedDistanceFromCamera>0)Te=fe[We]=cr.point;else{var Ir=We-Oe;Te=Ko(Qe===0?w:new v.Point(q.getx(Ir),q.gety(Ir)),Kt,He,Vt-Qe+1,le)}}Qe+=yt,yt=He.dist(Te)}var Or=(Vt-Qe)/yt,tn=Te.sub(He),Rn=tn.mult(Or)._add(He);Rn._add(tn._unit()._perp()._mult(c*Oe));var Fn=Ce+Math.atan2(Te.y-He.y,Te.x-He.x);return Nt.push(Rn),{point:Rn,angle:Fn,path:Nt}}qt.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},qt.prototype.insert=function(l,f,c,p,b){this._forEachCell(f,c,p,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(l),this.bboxes.push(f),this.bboxes.push(c),this.bboxes.push(p),this.bboxes.push(b)},qt.prototype.insertCircle=function(l,f,c,p){this._forEachCell(f-p,c-p,f+p,c+p,this._insertCircleCell,this.circleUid++),this.circleKeys.push(l),this.circles.push(f),this.circles.push(c),this.circles.push(p)},qt.prototype._insertBoxCell=function(l,f,c,p,b,w){this.boxCells[b].push(w)},qt.prototype._insertCircleCell=function(l,f,c,p,b,w){this.circleCells[b].push(w)},qt.prototype._query=function(l,f,c,p,b,w){if(c<0||l>this.width||p<0||f>this.height)return!b&&[];var A=[];if(l<=0&&f<=0&&this.width<=c&&this.height<=p){if(b)return!0;for(var R=0;R<this.boxKeys.length;R++)A.push({key:this.boxKeys[R],x1:this.bboxes[4*R],y1:this.bboxes[4*R+1],x2:this.bboxes[4*R+2],y2:this.bboxes[4*R+3]});for(var U=0;U<this.circleKeys.length;U++){var q=this.circles[3*U],le=this.circles[3*U+1],fe=this.circles[3*U+2];A.push({key:this.circleKeys[U],x1:q-fe,y1:le-fe,x2:q+fe,y2:le+fe})}return w?A.filter(w):A}return this._forEachCell(l,f,c,p,this._queryCell,A,{hitTest:b,seenUids:{box:{},circle:{}}},w),b?A.length>0:A},qt.prototype._queryCircle=function(l,f,c,p,b){var w=l-c,A=l+c,R=f-c,U=f+c;if(A<0||w>this.width||U<0||R>this.height)return!p&&[];var q=[];return this._forEachCell(w,R,A,U,this._queryCellCircle,q,{hitTest:p,circle:{x:l,y:f,radius:c},seenUids:{box:{},circle:{}}},b),p?q.length>0:q},qt.prototype.query=function(l,f,c,p,b){return this._query(l,f,c,p,!1,b)},qt.prototype.hitTest=function(l,f,c,p,b){return this._query(l,f,c,p,!0,b)},qt.prototype.hitTestCircle=function(l,f,c,p){return this._queryCircle(l,f,c,!0,p)},qt.prototype._queryCell=function(l,f,c,p,b,w,A,R){var U=A.seenUids,q=this.boxCells[b];if(q!==null)for(var le=this.bboxes,fe=0,pe=q;fe<pe.length;fe+=1){var Oe=pe[fe];if(!U.box[Oe]){U.box[Oe]=!0;var Ce=4*Oe;if(l<=le[Ce+2]&&f<=le[Ce+3]&&c>=le[Ce+0]&&p>=le[Ce+1]&&(!R||R(this.boxKeys[Oe]))){if(A.hitTest)return w.push(!0),!0;w.push({key:this.boxKeys[Oe],x1:le[Ce],y1:le[Ce+1],x2:le[Ce+2],y2:le[Ce+3]})}}}var We=this.circleCells[b];if(We!==null)for(var Te=this.circles,He=0,Qe=We;He<Qe.length;He+=1){var yt=Qe[He];if(!U.circle[yt]){U.circle[yt]=!0;var Vt=3*yt;if(this._circleAndRectCollide(Te[Vt],Te[Vt+1],Te[Vt+2],l,f,c,p)&&(!R||R(this.circleKeys[yt]))){if(A.hitTest)return w.push(!0),!0;var Nt=Te[Vt],Kt=Te[Vt+1],cr=Te[Vt+2];w.push({key:this.circleKeys[yt],x1:Nt-cr,y1:Kt-cr,x2:Nt+cr,y2:Kt+cr})}}}},qt.prototype._queryCellCircle=function(l,f,c,p,b,w,A,R){var U=A.circle,q=A.seenUids,le=this.boxCells[b];if(le!==null)for(var fe=this.bboxes,pe=0,Oe=le;pe<Oe.length;pe+=1){var Ce=Oe[pe];if(!q.box[Ce]){q.box[Ce]=!0;var We=4*Ce;if(this._circleAndRectCollide(U.x,U.y,U.radius,fe[We+0],fe[We+1],fe[We+2],fe[We+3])&&(!R||R(this.boxKeys[Ce])))return w.push(!0),!0}}var Te=this.circleCells[b];if(Te!==null)for(var He=this.circles,Qe=0,yt=Te;Qe<yt.length;Qe+=1){var Vt=yt[Qe];if(!q.circle[Vt]){q.circle[Vt]=!0;var Nt=3*Vt;if(this._circlesCollide(He[Nt],He[Nt+1],He[Nt+2],U.x,U.y,U.radius)&&(!R||R(this.circleKeys[Vt])))return w.push(!0),!0}}},qt.prototype._forEachCell=function(l,f,c,p,b,w,A,R){for(var U=this._convertToXCellCoord(l),q=this._convertToYCellCoord(f),le=this._convertToXCellCoord(c),fe=this._convertToYCellCoord(p),pe=U;pe<=le;pe++)for(var Oe=q;Oe<=fe;Oe++)if(b.call(this,l,f,c,p,this.xCellCount*Oe+pe,w,A,R))return},qt.prototype._convertToXCellCoord=function(l){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(l*this.xScale)))},qt.prototype._convertToYCellCoord=function(l){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(l*this.yScale)))},qt.prototype._circlesCollide=function(l,f,c,p,b,w){var A=p-l,R=b-f,U=c+w;return U*U>A*A+R*R},qt.prototype._circleAndRectCollide=function(l,f,c,p,b,w,A){var R=(w-p)/2,U=Math.abs(l-(p+R));if(U>R+c)return!1;var q=(A-b)/2,le=Math.abs(f-(b+q));if(le>q+c)return!1;if(U<=R||le<=q)return!0;var fe=U-R,pe=le-q;return fe*fe+pe*pe<=c*c};var hu=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Na(l,f){for(var c=0;c<l;c++){var p=f.length;f.resize(p+4),f.float32.set(hu,3*p)}}function Ma(l,f,c){var p=f[0],b=f[1];return l[0]=c[0]*p+c[4]*b+c[12],l[1]=c[1]*p+c[5]*b+c[13],l[3]=c[3]*p+c[7]*b+c[15],l}var Wa=function(l,f,c){f===void 0&&(f=new qt(l.width+200,l.height+200,25)),c===void 0&&(c=new qt(l.width+200,l.height+200,25)),this.transform=l,this.grid=f,this.ignoredGrid=c,this.pitchfactor=Math.cos(l._pitch)*l.cameraToCenterDistance,this.screenRightBoundary=l.width+100,this.screenBottomBoundary=l.height+100,this.gridRightBoundary=l.width+200,this.gridBottomBoundary=l.height+200};function oa(l,f,c){return f*(v.EXTENT/(l.tileSize*Math.pow(2,c-l.tileID.overscaledZ)))}Wa.prototype.placeCollisionBox=function(l,f,c,p,b){var w=this.projectAndGetPerspectiveRatio(p,l.anchorPointX,l.anchorPointY),A=c*w.perspectiveRatio,R=l.x1*A+w.point.x,U=l.y1*A+w.point.y,q=l.x2*A+w.point.x,le=l.y2*A+w.point.y;return!this.isInsideGrid(R,U,q,le)||!f&&this.grid.hitTest(R,U,q,le,b)?{box:[],offscreen:!1}:{box:[R,U,q,le],offscreen:this.isOffscreen(R,U,q,le)}},Wa.prototype.placeCollisionCircles=function(l,f,c,p,b,w,A,R,U,q,le,fe,pe){var Oe=[],Ce=new v.Point(f.anchorX,f.anchorY),We=Ai(Ce,w),Te=Bi(this.transform.cameraToCenterDistance,We.signedDistanceFromCamera),He=(q?b/Te:b*Te)/v.ONE_EM,Qe=Ai(Ce,A).point,yt=zt(He,p,f.lineOffsetX*He,f.lineOffsetY*He,!1,Qe,Ce,f,c,A,{}),Vt=!1,Nt=!1,Kt=!0;if(yt){for(var cr=.5*fe*Te+pe,Ir=new v.Point(-100,-100),Or=new v.Point(this.screenRightBoundary,this.screenBottomBoundary),tn=new Ct,Rn=yt.first,Fn=yt.last,Un=[],Li=Rn.path.length-1;Li>=1;Li--)Un.push(Rn.path[Li]);for(var Zr=1;Zr<Fn.path.length;Zr++)Un.push(Fn.path[Zr]);var ii=2.5*cr;if(R){var si=Un.map(function(Ns){return Ai(Ns,R)});Un=si.some(function(Ns){return Ns.signedDistanceFromCamera<=0})?[]:si.map(function(Ns){return Ns.point})}var Qn=[];if(Un.length>0){for(var Hn=Un[0].clone(),mi=Un[0].clone(),Kn=1;Kn<Un.length;Kn++)Hn.x=Math.min(Hn.x,Un[Kn].x),Hn.y=Math.min(Hn.y,Un[Kn].y),mi.x=Math.max(mi.x,Un[Kn].x),mi.y=Math.max(mi.y,Un[Kn].y);Qn=Hn.x>=Ir.x&&mi.x<=Or.x&&Hn.y>=Ir.y&&mi.y<=Or.y?[Un]:mi.x<Ir.x||Hn.x>Or.x||mi.y<Ir.y||Hn.y>Or.y?[]:v.clipLine([Un],Ir.x,Ir.y,Or.x,Or.y)}for(var Wn=0,uo=Qn;Wn<uo.length;Wn+=1){var ha;tn.reset(uo[Wn],.25*cr),ha=tn.length<=.5*cr?1:Math.ceil(tn.paddedLength/ii)+1;for(var Do=0;Do<ha;Do++){var Fo=Do/Math.max(ha-1,1),Za=tn.lerp(Fo),ro=Za.x+100,bs=Za.y+100;Oe.push(ro,bs,cr,0);var es=ro-cr,Du=bs-cr,os=ro+cr,au=bs+cr;if(Kt=Kt&&this.isOffscreen(es,Du,os,au),Nt=Nt||this.isInsideGrid(es,Du,os,au),!l&&this.grid.hitTestCircle(ro,bs,cr,le)&&(Vt=!0,!U))return{circles:[],offscreen:!1,collisionDetected:Vt}}}}return{circles:!U&&Vt||!Nt?[]:Oe,offscreen:Kt,collisionDetected:Vt}},Wa.prototype.queryRenderedSymbols=function(l){if(l.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var f=[],c=1/0,p=1/0,b=-1/0,w=-1/0,A=0,R=l;A<R.length;A+=1){var U=R[A],q=new v.Point(U.x+100,U.y+100);c=Math.min(c,q.x),p=Math.min(p,q.y),b=Math.max(b,q.x),w=Math.max(w,q.y),f.push(q)}for(var le={},fe={},pe=0,Oe=this.grid.query(c,p,b,w).concat(this.ignoredGrid.query(c,p,b,w));pe<Oe.length;pe+=1){var Ce=Oe[pe],We=Ce.key;if(le[We.bucketInstanceId]===void 0&&(le[We.bucketInstanceId]={}),!le[We.bucketInstanceId][We.featureIndex]){var Te=[new v.Point(Ce.x1,Ce.y1),new v.Point(Ce.x2,Ce.y1),new v.Point(Ce.x2,Ce.y2),new v.Point(Ce.x1,Ce.y2)];v.polygonIntersectsPolygon(f,Te)&&(le[We.bucketInstanceId][We.featureIndex]=!0,fe[We.bucketInstanceId]===void 0&&(fe[We.bucketInstanceId]=[]),fe[We.bucketInstanceId].push(We.featureIndex))}}return fe},Wa.prototype.insertCollisionBox=function(l,f,c,p,b){(f?this.ignoredGrid:this.grid).insert({bucketInstanceId:c,featureIndex:p,collisionGroupID:b},l[0],l[1],l[2],l[3])},Wa.prototype.insertCollisionCircles=function(l,f,c,p,b){for(var w=f?this.ignoredGrid:this.grid,A={bucketInstanceId:c,featureIndex:p,collisionGroupID:b},R=0;R<l.length;R+=4)w.insertCircle(A,l[R],l[R+1],l[R+2])},Wa.prototype.projectAndGetPerspectiveRatio=function(l,f,c){var p=[f,c,0,1];return Ma(p,p,l),{point:new v.Point((p[0]/p[3]+1)/2*this.transform.width+100,(-p[1]/p[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/p[3]*.5}},Wa.prototype.isOffscreen=function(l,f,c,p){return c<100||l>=this.screenRightBoundary||p<100||f>this.screenBottomBoundary},Wa.prototype.isInsideGrid=function(l,f,c,p){return c>=0&&l<this.gridRightBoundary&&p>=0&&f<this.gridBottomBoundary},Wa.prototype.getViewportMatrix=function(){var l=v.identity([]);return v.translate(l,l,[-100,-100,0]),l};var Eo=function(l,f,c,p){this.opacity=l?Math.max(0,Math.min(1,l.opacity+(l.placed?f:-f))):p&&c?1:0,this.placed=c};Eo.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var Vo=function(l,f,c,p,b){this.text=new Eo(l?l.text:null,f,c,b),this.icon=new Eo(l?l.icon:null,f,p,b)};Vo.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var bu=function(l,f,c){this.text=l,this.icon=f,this.skipFade=c},co=function(){this.invProjMatrix=v.create(),this.viewportMatrix=v.create(),this.circles=[]},Ro=function(l,f,c,p,b){this.bucketInstanceId=l,this.featureIndex=f,this.sourceLayerIndex=c,this.bucketIndex=p,this.tileID=b},sa=function(l){this.crossSourceCollisions=l,this.maxGroupID=0,this.collisionGroups={}};function Xa(l,f,c,p,b){var w=v.getAnchorAlignment(l),A=-(w.horizontalAlign-.5)*f,R=-(w.verticalAlign-.5)*c,U=v.evaluateVariableOffset(l,p);return new v.Point(A+U[0]*b,R+U[1]*b)}function Lo(l,f,c,p,b,w){var A=l.x1,R=l.x2,U=l.y1,q=l.y2,le=l.anchorPointX,fe=l.anchorPointY,pe=new v.Point(f,c);return p&&pe._rotate(b?w:-w),{x1:A+pe.x,y1:U+pe.y,x2:R+pe.x,y2:q+pe.y,anchorPointX:le,anchorPointY:fe}}sa.prototype.get=function(l){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[l]){var f=++this.maxGroupID;this.collisionGroups[l]={ID:f,predicate:function(c){return c.collisionGroupID===f}}}return this.collisionGroups[l]};var Ya=function(l,f,c,p){this.transform=l.clone(),this.collisionIndex=new Wa(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=f,this.retainedQueryData={},this.collisionGroups=new sa(c),this.collisionCircleArrays={},this.prevPlacement=p,p&&(p.prevPlacement=void 0),this.placedOrientations={}};function Ps(l,f,c,p,b){l.emplaceBack(f?1:0,c?1:0,p||0,b||0),l.emplaceBack(f?1:0,c?1:0,p||0,b||0),l.emplaceBack(f?1:0,c?1:0,p||0,b||0),l.emplaceBack(f?1:0,c?1:0,p||0,b||0)}Ya.prototype.getBucketParts=function(l,f,c,p){var b=c.getBucket(f),w=c.latestFeatureIndex;if(b&&w&&f.id===b.layerIds[0]){var A=c.collisionBoxArray,R=b.layers[0].layout,U=Math.pow(2,this.transform.zoom-c.tileID.overscaledZ),q=c.tileSize/v.EXTENT,le=this.transform.calculatePosMatrix(c.tileID.toUnwrapped()),fe=R.get("text-pitch-alignment")==="map",pe=R.get("text-rotation-alignment")==="map",Oe=oa(c,1,this.transform.zoom),Ce=Aa(le,fe,pe,this.transform,Oe),We=null;if(fe){var Te=Ei(le,fe,pe,this.transform,Oe);We=v.multiply([],this.transform.labelPlaneMatrix,Te)}this.retainedQueryData[b.bucketInstanceId]=new Ro(b.bucketInstanceId,w,b.sourceLayerIndex,b.index,c.tileID);var He={bucket:b,layout:R,posMatrix:le,textLabelPlaneMatrix:Ce,labelToScreenMatrix:We,scale:U,textPixelRatio:q,holdingForFade:c.holdingForFade(),collisionBoxArray:A,partiallyEvaluatedTextSize:v.evaluateSizeForZoom(b.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(b.sourceID)};if(p)for(var Qe=0,yt=b.sortKeyRanges;Qe<yt.length;Qe+=1){var Vt=yt[Qe];l.push({sortKey:Vt.sortKey,symbolInstanceStart:Vt.symbolInstanceStart,symbolInstanceEnd:Vt.symbolInstanceEnd,parameters:He})}else l.push({symbolInstanceStart:0,symbolInstanceEnd:b.symbolInstances.length,parameters:He})}},Ya.prototype.attemptAnchorPlacement=function(l,f,c,p,b,w,A,R,U,q,le,fe,pe,Oe,Ce){var We,Te=[fe.textOffset0,fe.textOffset1],He=Xa(l,c,p,Te,b),Qe=this.collisionIndex.placeCollisionBox(Lo(f,He.x,He.y,w,A,this.transform.angle),le,R,U,q.predicate);if(!Ce||this.collisionIndex.placeCollisionBox(Lo(Ce,He.x,He.y,w,A,this.transform.angle),le,R,U,q.predicate).box.length!==0)return Qe.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[fe.crossTileID]&&this.prevPlacement.placements[fe.crossTileID]&&this.prevPlacement.placements[fe.crossTileID].text&&(We=this.prevPlacement.variableOffsets[fe.crossTileID].anchor),this.variableOffsets[fe.crossTileID]={textOffset:Te,width:c,height:p,anchor:l,textBoxScale:b,prevAnchor:We},this.markUsedJustification(pe,l,fe,Oe),pe.allowVerticalPlacement&&(this.markUsedOrientation(pe,Oe,fe),this.placedOrientations[fe.crossTileID]=Oe),{shift:He,placedGlyphBoxes:Qe}):void 0},Ya.prototype.placeLayerBucketPart=function(l,f,c){var p=this,b=l.parameters,w=b.bucket,A=b.layout,R=b.posMatrix,U=b.textLabelPlaneMatrix,q=b.labelToScreenMatrix,le=b.textPixelRatio,fe=b.holdingForFade,pe=b.collisionBoxArray,Oe=b.partiallyEvaluatedTextSize,Ce=b.collisionGroup,We=A.get("text-optional"),Te=A.get("icon-optional"),He=A.get("text-allow-overlap"),Qe=A.get("icon-allow-overlap"),yt=A.get("text-rotation-alignment")==="map",Vt=A.get("text-pitch-alignment")==="map",Nt=A.get("icon-text-fit")!=="none",Kt=A.get("symbol-z-order")==="viewport-y",cr=He&&(Qe||!w.hasIconData()||Te),Ir=Qe&&(He||!w.hasTextData()||We);!w.collisionArrays&&pe&&w.deserializeCollisionBoxes(pe);var Or=function(Zr,ii){if(!f[Zr.crossTileID])if(fe)p.placements[Zr.crossTileID]=new bu(!1,!1,!1);else{var si,Qn=!1,Hn=!1,mi=!0,Kn=null,Wn={box:null,offscreen:null},uo={box:null,offscreen:null},ha=null,Do=null,Fo=0,Za=0,ro=0;ii.textFeatureIndex?Fo=ii.textFeatureIndex:Zr.useRuntimeCollisionCircles&&(Fo=Zr.featureIndex),ii.verticalTextFeatureIndex&&(Za=ii.verticalTextFeatureIndex);var bs=ii.textBox;if(bs){var es=function(ta){var Es=v.WritingMode.horizontal;if(w.allowVerticalPlacement&&!ta&&p.prevPlacement){var ss=p.prevPlacement.placedOrientations[Zr.crossTileID];ss&&(p.placedOrientations[Zr.crossTileID]=ss,p.markUsedOrientation(w,Es=ss,Zr))}return Es},Du=function(ta,Es){if(w.allowVerticalPlacement&&Zr.numVerticalGlyphVertices>0&&ii.verticalTextBox)for(var ss=0,Ju=w.writingModes;ss<Ju.length&&(Ju[ss]===v.WritingMode.vertical?(Wn=Es(),uo=Wn):Wn=ta(),!(Wn&&Wn.box&&Wn.box.length));ss+=1);else Wn=ta()};if(A.get("text-variable-anchor")){var os=A.get("text-variable-anchor");if(p.prevPlacement&&p.prevPlacement.variableOffsets[Zr.crossTileID]){var au=p.prevPlacement.variableOffsets[Zr.crossTileID];os.indexOf(au.anchor)>0&&(os=os.filter(function(ta){return ta!==au.anchor})).unshift(au.anchor)}var Ns=function(ta,Es,ss){for(var Ju=ta.x2-ta.x1,Vc=ta.y2-ta.y1,jc=Zr.textBoxScale,df=Nt&&!Qe?Es:null,Xs={box:[],offscreen:!1},gu=He?2*os.length:os.length,su=0;su<gu;++su){var xl=p.attemptAnchorPlacement(os[su%os.length],ta,Ju,Vc,jc,yt,Vt,le,R,Ce,su>=os.length,Zr,w,ss,df);if(xl&&(Xs=xl.placedGlyphBoxes)&&Xs.box&&Xs.box.length){Qn=!0,Kn=xl.shift;break}}return Xs};Du(function(){return Ns(bs,ii.iconBox,v.WritingMode.horizontal)},function(){var ta=ii.verticalTextBox;return w.allowVerticalPlacement&&!(Wn&&Wn.box&&Wn.box.length)&&Zr.numVerticalGlyphVertices>0&&ta?Ns(ta,ii.verticalIconBox,v.WritingMode.vertical):{box:null,offscreen:null}}),Wn&&(Qn=Wn.box,mi=Wn.offscreen);var dc=es(Wn&&Wn.box);if(!Qn&&p.prevPlacement){var zl=p.prevPlacement.variableOffsets[Zr.crossTileID];zl&&(p.variableOffsets[Zr.crossTileID]=zl,p.markUsedJustification(w,zl.anchor,Zr,dc))}}else{var Fu=function(ta,Es){var ss=p.collisionIndex.placeCollisionBox(ta,He,le,R,Ce.predicate);return ss&&ss.box&&ss.box.length&&(p.markUsedOrientation(w,Es,Zr),p.placedOrientations[Zr.crossTileID]=Es),ss};Du(function(){return Fu(bs,v.WritingMode.horizontal)},function(){var ta=ii.verticalTextBox;return w.allowVerticalPlacement&&Zr.numVerticalGlyphVertices>0&&ta?Fu(ta,v.WritingMode.vertical):{box:null,offscreen:null}}),es(Wn&&Wn.box&&Wn.box.length)}}if(Qn=(si=Wn)&&si.box&&si.box.length>0,mi=si&&si.offscreen,Zr.useRuntimeCollisionCircles){var _l=w.text.placedSymbolArray.get(Zr.centerJustifiedTextSymbolIndex),Ul=v.evaluateSizeForFeature(w.textSizeData,Oe,_l),ou=A.get("text-padding");ha=p.collisionIndex.placeCollisionCircles(He,_l,w.lineVertexArray,w.glyphOffsetArray,Ul,R,U,q,c,Vt,Ce.predicate,Zr.collisionCircleDiameter,ou),Qn=He||ha.circles.length>0&&!ha.collisionDetected,mi=mi&&ha.offscreen}if(ii.iconFeatureIndex&&(ro=ii.iconFeatureIndex),ii.iconBox){var Zl=function(ta){var Es=Nt&&Kn?Lo(ta,Kn.x,Kn.y,yt,Vt,p.transform.angle):ta;return p.collisionIndex.placeCollisionBox(Es,Qe,le,R,Ce.predicate)};Hn=uo&&uo.box&&uo.box.length&&ii.verticalIconBox?(Do=Zl(ii.verticalIconBox)).box.length>0:(Do=Zl(ii.iconBox)).box.length>0,mi=mi&&Do.offscreen}var mu=We||Zr.numHorizontalGlyphVertices===0&&Zr.numVerticalGlyphVertices===0,go=Te||Zr.numIconVertices===0;if(mu||go?go?mu||(Hn=Hn&&Qn):Qn=Hn&&Qn:Hn=Qn=Hn&&Qn,Qn&&si&&si.box&&p.collisionIndex.insertCollisionBox(si.box,A.get("text-ignore-placement"),w.bucketInstanceId,uo&&uo.box&&Za?Za:Fo,Ce.ID),Hn&&Do&&p.collisionIndex.insertCollisionBox(Do.box,A.get("icon-ignore-placement"),w.bucketInstanceId,ro,Ce.ID),ha&&(Qn&&p.collisionIndex.insertCollisionCircles(ha.circles,A.get("text-ignore-placement"),w.bucketInstanceId,Fo,Ce.ID),c)){var Nu=w.bucketInstanceId,Bu=p.collisionCircleArrays[Nu];Bu===void 0&&(Bu=p.collisionCircleArrays[Nu]=new co);for(var $u=0;$u<ha.circles.length;$u+=4)Bu.circles.push(ha.circles[$u+0]),Bu.circles.push(ha.circles[$u+1]),Bu.circles.push(ha.circles[$u+2]),Bu.circles.push(ha.collisionDetected?1:0)}p.placements[Zr.crossTileID]=new bu(Qn||cr,Hn||Ir,mi||w.justReloaded),f[Zr.crossTileID]=!0}};if(Kt)for(var tn=w.getSortedSymbolIndexes(this.transform.angle),Rn=tn.length-1;Rn>=0;--Rn){var Fn=tn[Rn];Or(w.symbolInstances.get(Fn),w.collisionArrays[Fn])}else for(var Un=l.symbolInstanceStart;Un<l.symbolInstanceEnd;Un++)Or(w.symbolInstances.get(Un),w.collisionArrays[Un]);if(c&&w.bucketInstanceId in this.collisionCircleArrays){var Li=this.collisionCircleArrays[w.bucketInstanceId];v.invert(Li.invProjMatrix,R),Li.viewportMatrix=this.collisionIndex.getViewportMatrix()}w.justReloaded=!1},Ya.prototype.markUsedJustification=function(l,f,c,p){var b;b=p===v.WritingMode.vertical?c.verticalPlacedTextSymbolIndex:{left:c.leftJustifiedTextSymbolIndex,center:c.centerJustifiedTextSymbolIndex,right:c.rightJustifiedTextSymbolIndex}[v.getAnchorJustification(f)];for(var w=0,A=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex,c.verticalPlacedTextSymbolIndex];w<A.length;w+=1){var R=A[w];R>=0&&(l.text.placedSymbolArray.get(R).crossTileID=b>=0&&R!==b?0:c.crossTileID)}},Ya.prototype.markUsedOrientation=function(l,f,c){for(var p=f===v.WritingMode.horizontal||f===v.WritingMode.horizontalOnly?f:0,b=f===v.WritingMode.vertical?f:0,w=0,A=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex];w<A.length;w+=1)l.text.placedSymbolArray.get(A[w]).placedOrientation=p;c.verticalPlacedTextSymbolIndex&&(l.text.placedSymbolArray.get(c.verticalPlacedTextSymbolIndex).placedOrientation=b)},Ya.prototype.commit=function(l){this.commitTime=l,this.zoomAtLastRecencyCheck=this.transform.zoom;var f=this.prevPlacement,c=!1;this.prevZoomAdjustment=f?f.zoomAdjustment(this.transform.zoom):0;var p=f?f.symbolFadeChange(l):1,b=f?f.opacities:{},w=f?f.variableOffsets:{},A=f?f.placedOrientations:{};for(var R in this.placements){var U=this.placements[R],q=b[R];q?(this.opacities[R]=new Vo(q,p,U.text,U.icon),c=c||U.text!==q.text.placed||U.icon!==q.icon.placed):(this.opacities[R]=new Vo(null,p,U.text,U.icon,U.skipFade),c=c||U.text||U.icon)}for(var le in b){var fe=b[le];if(!this.opacities[le]){var pe=new Vo(fe,p,!1,!1);pe.isHidden()||(this.opacities[le]=pe,c=c||fe.text.placed||fe.icon.placed)}}for(var Oe in w)this.variableOffsets[Oe]||!this.opacities[Oe]||this.opacities[Oe].isHidden()||(this.variableOffsets[Oe]=w[Oe]);for(var Ce in A)this.placedOrientations[Ce]||!this.opacities[Ce]||this.opacities[Ce].isHidden()||(this.placedOrientations[Ce]=A[Ce]);c?this.lastPlacementChangeTime=l:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=f?f.lastPlacementChangeTime:l)},Ya.prototype.updateLayerOpacities=function(l,f){for(var c={},p=0,b=f;p<b.length;p+=1){var w=b[p],A=w.getBucket(l);A&&w.latestFeatureIndex&&l.id===A.layerIds[0]&&this.updateBucketOpacities(A,c,w.collisionBoxArray)}},Ya.prototype.updateBucketOpacities=function(l,f,c){var p=this;l.hasTextData()&&l.text.opacityVertexArray.clear(),l.hasIconData()&&l.icon.opacityVertexArray.clear(),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexArray.clear(),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexArray.clear();var b=l.layers[0].layout,w=new Vo(null,0,!1,!1,!0),A=b.get("text-allow-overlap"),R=b.get("icon-allow-overlap"),U=b.get("text-variable-anchor"),q=b.get("text-rotation-alignment")==="map",le=b.get("text-pitch-alignment")==="map",fe=b.get("icon-text-fit")!=="none",pe=new Vo(null,0,A&&(R||!l.hasIconData()||b.get("icon-optional")),R&&(A||!l.hasTextData()||b.get("text-optional")),!0);!l.collisionArrays&&c&&(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData())&&l.deserializeCollisionBoxes(c);for(var Oe=function(He,Qe,yt){for(var Vt=0;Vt<Qe/4;Vt++)He.opacityVertexArray.emplaceBack(yt)},Ce=function(He){var Qe=l.symbolInstances.get(He),yt=Qe.numHorizontalGlyphVertices,Vt=Qe.numVerticalGlyphVertices,Nt=Qe.crossTileID,Kt=p.opacities[Nt];f[Nt]?Kt=w:Kt||(p.opacities[Nt]=Kt=pe),f[Nt]=!0;var cr=Qe.numIconVertices>0,Ir=p.placedOrientations[Qe.crossTileID],Or=Ir===v.WritingMode.vertical,tn=Ir===v.WritingMode.horizontal||Ir===v.WritingMode.horizontalOnly;if(yt>0||Vt>0){var Rn=Tn(Kt.text);Oe(l.text,yt,Or?Mi:Rn),Oe(l.text,Vt,tn?Mi:Rn);var Fn=Kt.text.isHidden();[Qe.rightJustifiedTextSymbolIndex,Qe.centerJustifiedTextSymbolIndex,Qe.leftJustifiedTextSymbolIndex].forEach(function(Wn){Wn>=0&&(l.text.placedSymbolArray.get(Wn).hidden=Fn||Or?1:0)}),Qe.verticalPlacedTextSymbolIndex>=0&&(l.text.placedSymbolArray.get(Qe.verticalPlacedTextSymbolIndex).hidden=Fn||tn?1:0);var Un=p.variableOffsets[Qe.crossTileID];Un&&p.markUsedJustification(l,Un.anchor,Qe,Ir);var Li=p.placedOrientations[Qe.crossTileID];Li&&(p.markUsedJustification(l,"left",Qe,Li),p.markUsedOrientation(l,Li,Qe))}if(cr){var Zr=Tn(Kt.icon),ii=!(fe&&Qe.verticalPlacedIconSymbolIndex&&Or);Qe.placedIconSymbolIndex>=0&&(Oe(l.icon,Qe.numIconVertices,ii?Zr:Mi),l.icon.placedSymbolArray.get(Qe.placedIconSymbolIndex).hidden=Kt.icon.isHidden()),Qe.verticalPlacedIconSymbolIndex>=0&&(Oe(l.icon,Qe.numVerticalIconVertices,ii?Mi:Zr),l.icon.placedSymbolArray.get(Qe.verticalPlacedIconSymbolIndex).hidden=Kt.icon.isHidden())}if(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData()){var si=l.collisionArrays[He];if(si){var Qn=new v.Point(0,0);if(si.textBox||si.verticalTextBox){var Hn=!0;if(U){var mi=p.variableOffsets[Nt];mi?(Qn=Xa(mi.anchor,mi.width,mi.height,mi.textOffset,mi.textBoxScale),q&&Qn._rotate(le?p.transform.angle:-p.transform.angle)):Hn=!1}si.textBox&&Ps(l.textCollisionBox.collisionVertexArray,Kt.text.placed,!Hn||Or,Qn.x,Qn.y),si.verticalTextBox&&Ps(l.textCollisionBox.collisionVertexArray,Kt.text.placed,!Hn||tn,Qn.x,Qn.y)}var Kn=Boolean(!tn&&si.verticalIconBox);si.iconBox&&Ps(l.iconCollisionBox.collisionVertexArray,Kt.icon.placed,Kn,fe?Qn.x:0,fe?Qn.y:0),si.verticalIconBox&&Ps(l.iconCollisionBox.collisionVertexArray,Kt.icon.placed,!Kn,fe?Qn.x:0,fe?Qn.y:0)}}},We=0;We<l.symbolInstances.length;We++)Ce(We);if(l.sortFeatures(this.transform.angle),this.retainedQueryData[l.bucketInstanceId]&&(this.retainedQueryData[l.bucketInstanceId].featureSortOrder=l.featureSortOrder),l.hasTextData()&&l.text.opacityVertexBuffer&&l.text.opacityVertexBuffer.updateData(l.text.opacityVertexArray),l.hasIconData()&&l.icon.opacityVertexBuffer&&l.icon.opacityVertexBuffer.updateData(l.icon.opacityVertexArray),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexBuffer&&l.iconCollisionBox.collisionVertexBuffer.updateData(l.iconCollisionBox.collisionVertexArray),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexBuffer&&l.textCollisionBox.collisionVertexBuffer.updateData(l.textCollisionBox.collisionVertexArray),l.bucketInstanceId in this.collisionCircleArrays){var Te=this.collisionCircleArrays[l.bucketInstanceId];l.placementInvProjMatrix=Te.invProjMatrix,l.placementViewportMatrix=Te.viewportMatrix,l.collisionCircleArray=Te.circles,delete this.collisionCircleArrays[l.bucketInstanceId]}},Ya.prototype.symbolFadeChange=function(l){return this.fadeDuration===0?1:(l-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},Ya.prototype.zoomAdjustment=function(l){return Math.max(0,(this.transform.zoom-l)/1.5)},Ya.prototype.hasTransitions=function(l){return this.stale||l-this.lastPlacementChangeTime<this.fadeDuration},Ya.prototype.stillRecent=function(l,f){var c=this.zoomAtLastRecencyCheck===f?1-this.zoomAdjustment(f):1;return this.zoomAtLastRecencyCheck=f,this.commitTime+this.fadeDuration*c>l},Ya.prototype.setStale=function(){this.stale=!0};var Cl=Math.pow(2,25),ps=Math.pow(2,24),ie=Math.pow(2,17),xe=Math.pow(2,16),Ke=Math.pow(2,9),Mt=Math.pow(2,8),Pr=Math.pow(2,1);function Tn(l){if(l.opacity===0&&!l.placed)return 0;if(l.opacity===1&&l.placed)return 4294967295;var f=l.placed?1:0,c=Math.floor(127*l.opacity);return c*Cl+f*ps+c*ie+f*xe+c*Ke+f*Mt+c*Pr+f}var Mi=0,eo=function(l){this._sortAcrossTiles=l.layout.get("symbol-z-order")!=="viewport-y"&&l.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};eo.prototype.continuePlacement=function(l,f,c,p,b){for(var w=this._bucketParts;this._currentTileIndex<l.length;)if(f.getBucketParts(w,p,l[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,w.sort(function(A,R){return A.sortKey-R.sortKey}));this._currentPartIndex<w.length;)if(f.placeLayerBucketPart(w[this._currentPartIndex],this._seenCrossTileIDs,c),this._currentPartIndex++,b())return!0;return!1};var La=function(l,f,c,p,b,w,A){this.placement=new Ya(l,b,w,A),this._currentPlacementIndex=f.length-1,this._forceFullPlacement=c,this._showCollisionBoxes=p,this._done=!1};La.prototype.isDone=function(){return this._done},La.prototype.continuePlacement=function(l,f,c){for(var p=this,b=v.browser.now(),w=function(){var U=v.browser.now()-b;return!p._forceFullPlacement&&U>2};this._currentPlacementIndex>=0;){var A=f[l[this._currentPlacementIndex]],R=this.placement.collisionIndex.transform.zoom;if(A.type==="symbol"&&(!A.minzoom||A.minzoom<=R)&&(!A.maxzoom||A.maxzoom>R)){if(this._inProgressLayer||(this._inProgressLayer=new eo(A)),this._inProgressLayer.continuePlacement(c[A.source],this.placement,this._showCollisionBoxes,A,w))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},La.prototype.commit=function(l){return this.placement.commit(l),this.placement};var Ba=512/v.EXTENT/2,jo=function(l,f,c){this.tileID=l,this.indexedSymbolInstances={},this.bucketInstanceId=c;for(var p=0;p<f.length;p++){var b=f.get(p),w=b.key;this.indexedSymbolInstances[w]||(this.indexedSymbolInstances[w]=[]),this.indexedSymbolInstances[w].push({crossTileID:b.crossTileID,coord:this.getScaledCoordinates(b,l)})}};jo.prototype.getScaledCoordinates=function(l,f){var c=Ba/Math.pow(2,f.canonical.z-this.tileID.canonical.z);return{x:Math.floor((f.canonical.x*v.EXTENT+l.anchorX)*c),y:Math.floor((f.canonical.y*v.EXTENT+l.anchorY)*c)}},jo.prototype.findMatches=function(l,f,c){for(var p=this.tileID.canonical.z<f.canonical.z?1:Math.pow(2,this.tileID.canonical.z-f.canonical.z),b=0;b<l.length;b++){var w=l.get(b);if(!w.crossTileID){var A=this.indexedSymbolInstances[w.key];if(A)for(var R=this.getScaledCoordinates(w,f),U=0,q=A;U<q.length;U+=1){var le=q[U];if(Math.abs(le.coord.x-R.x)<=p&&Math.abs(le.coord.y-R.y)<=p&&!c[le.crossTileID]){c[le.crossTileID]=!0,w.crossTileID=le.crossTileID;break}}}}};var ds=function(){this.maxCrossTileID=0};ds.prototype.generate=function(){return++this.maxCrossTileID};var ao=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};ao.prototype.handleWrapJump=function(l){var f=Math.round((l-this.lng)/360);if(f!==0)for(var c in this.indexes){var p=this.indexes[c],b={};for(var w in p){var A=p[w];A.tileID=A.tileID.unwrapTo(A.tileID.wrap+f),b[A.tileID.key]=A}this.indexes[c]=b}this.lng=l},ao.prototype.addBucket=function(l,f,c){if(this.indexes[l.overscaledZ]&&this.indexes[l.overscaledZ][l.key]){if(this.indexes[l.overscaledZ][l.key].bucketInstanceId===f.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(l.overscaledZ,this.indexes[l.overscaledZ][l.key])}for(var p=0;p<f.symbolInstances.length;p++)f.symbolInstances.get(p).crossTileID=0;this.usedCrossTileIDs[l.overscaledZ]||(this.usedCrossTileIDs[l.overscaledZ]={});var b=this.usedCrossTileIDs[l.overscaledZ];for(var w in this.indexes){var A=this.indexes[w];if(Number(w)>l.overscaledZ)for(var R in A){var U=A[R];U.tileID.isChildOf(l)&&U.findMatches(f.symbolInstances,l,b)}else{var q=A[l.scaledTo(Number(w)).key];q&&q.findMatches(f.symbolInstances,l,b)}}for(var le=0;le<f.symbolInstances.length;le++){var fe=f.symbolInstances.get(le);fe.crossTileID||(fe.crossTileID=c.generate(),b[fe.crossTileID]=!0)}return this.indexes[l.overscaledZ]===void 0&&(this.indexes[l.overscaledZ]={}),this.indexes[l.overscaledZ][l.key]=new jo(l,f.symbolInstances,f.bucketInstanceId),!0},ao.prototype.removeBucketCrossTileIDs=function(l,f){for(var c in f.indexedSymbolInstances)for(var p=0,b=f.indexedSymbolInstances[c];p<b.length;p+=1)delete this.usedCrossTileIDs[l][b[p].crossTileID]},ao.prototype.removeStaleBuckets=function(l){var f=!1;for(var c in this.indexes){var p=this.indexes[c];for(var b in p)l[p[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(c,p[b]),delete p[b],f=!0)}return f};var So=function(){this.layerIndexes={},this.crossTileIDs=new ds,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};So.prototype.addLayer=function(l,f,c){var p=this.layerIndexes[l.id];p===void 0&&(p=this.layerIndexes[l.id]=new ao);var b=!1,w={};p.handleWrapJump(c);for(var A=0,R=f;A<R.length;A+=1){var U=R[A],q=U.getBucket(l);q&&l.id===q.layerIds[0]&&(q.bucketInstanceId||(q.bucketInstanceId=++this.maxBucketInstanceId),p.addBucket(U.tileID,q,this.crossTileIDs)&&(b=!0),w[q.bucketInstanceId]=!0)}return p.removeStaleBuckets(w)&&(b=!0),b},So.prototype.pruneUnusedLayers=function(l){var f={};for(var c in l.forEach(function(p){f[p]=!0}),this.layerIndexes)f[c]||delete this.layerIndexes[c]};var vs=function(l,f){return v.emitValidationErrors(l,f&&f.filter(function(c){return c.identifier!=="source.canvas"}))},Is=v.pick(Gr,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),ks=v.pick(Gr,["setCenter","setZoom","setBearing","setPitch"]),$s=function(){var l={},f=v.styleSpec.$version;for(var c in v.styleSpec.$root){var p,b=v.styleSpec.$root[c];b.required&&(p=c==="version"?f:b.type==="array"?[]:{})!=null&&(l[c]=p)}return l}(),ms=function(l){function f(c,p){var b=this;p===void 0&&(p={}),l.call(this),this.map=c,this.dispatcher=new Rt(Tt(),this),this.imageManager=new pt,this.imageManager.setEventedParent(this),this.glyphManager=new Wt(c._requestManager,p.localIdeographFontFamily),this.lineAtlas=new Je(256,512),this.crossTileSymbolIndex=new So,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new v.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",v.getReferrer());var w=this;this._rtlTextPluginCallback=f.registerForPluginStateChange(function(A){w.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:A.pluginStatus,pluginURL:A.pluginURL},function(R,U){if(v.triggerPluginCompletionEvent(R),U&&U.every(function(le){return le}))for(var q in w.sourceCaches)w.sourceCaches[q].reload()})}),this.on("data",function(A){if(A.dataType==="source"&&A.sourceDataType==="metadata"){var R=b.sourceCaches[A.sourceId];if(R){var U=R.getSource();if(U&&U.vectorLayerIds)for(var q in b._layers){var le=b._layers[q];le.source===U.id&&b._validateLayer(le)}}}})}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.loadURL=function(c,p){var b=this;p===void 0&&(p={}),this.fire(new v.Event("dataloading",{dataType:"style"}));var w=typeof p.validate=="boolean"?p.validate:!v.isMapboxURL(c);c=this.map._requestManager.normalizeStyleURL(c,p.accessToken);var A=this.map._requestManager.transformRequest(c,v.ResourceType.Style);this._request=v.getJSON(A,function(R,U){b._request=null,R?b.fire(new v.ErrorEvent(R)):U&&b._load(U,w)})},f.prototype.loadJSON=function(c,p){var b=this;p===void 0&&(p={}),this.fire(new v.Event("dataloading",{dataType:"style"})),this._request=v.browser.frame(function(){b._request=null,b._load(c,p.validate!==!1)})},f.prototype.loadEmpty=function(){this.fire(new v.Event("dataloading",{dataType:"style"})),this._load($s,!1)},f.prototype._load=function(c,p){if(!p||!vs(this,v.validateStyle(c))){for(var b in this._loaded=!0,this.stylesheet=c,c.sources)this.addSource(b,c.sources[b],{validate:!1});c.sprite?this._loadSprite(c.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(c.glyphs);var w=Dr(this.stylesheet.layers);this._order=w.map(function(q){return q.id}),this._layers={},this._serializedLayers={};for(var A=0,R=w;A<R.length;A+=1){var U=R[A];(U=v.createStyleLayer(U)).setEventedParent(this,{layer:{id:U.id}}),this._layers[U.id]=U,this._serializedLayers[U.id]=U.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new ct(this.stylesheet.light),this.fire(new v.Event("data",{dataType:"style"})),this.fire(new v.Event("style.load"))}},f.prototype._loadSprite=function(c){var p=this;this._spriteRequest=function(b,w,A){var R,U,q,le=v.browser.devicePixelRatio>1?"@2x":"",fe=v.getJSON(w.transformRequest(w.normalizeSpriteURL(b,le,".json"),v.ResourceType.SpriteJSON),function(Ce,We){fe=null,q||(q=Ce,R=We,Oe())}),pe=v.getImage(w.transformRequest(w.normalizeSpriteURL(b,le,".png"),v.ResourceType.SpriteImage),function(Ce,We){pe=null,q||(q=Ce,U=We,Oe())});function Oe(){if(q)A(q);else if(R&&U){var Ce=v.browser.getImageData(U),We={};for(var Te in R){var He=R[Te],Qe=He.width,yt=He.height,Vt=He.x,Nt=He.y,Kt=He.sdf,cr=He.pixelRatio,Ir=He.stretchX,Or=He.stretchY,tn=He.content,Rn=new v.RGBAImage({width:Qe,height:yt});v.RGBAImage.copy(Ce,Rn,{x:Vt,y:Nt},{x:0,y:0},{width:Qe,height:yt}),We[Te]={data:Rn,pixelRatio:cr,sdf:Kt,stretchX:Ir,stretchY:Or,content:tn}}A(null,We)}}return{cancel:function(){fe&&(fe.cancel(),fe=null),pe&&(pe.cancel(),pe=null)}}}(c,this.map._requestManager,function(b,w){if(p._spriteRequest=null,b)p.fire(new v.ErrorEvent(b));else if(w)for(var A in w)p.imageManager.addImage(A,w[A]);p.imageManager.setLoaded(!0),p._availableImages=p.imageManager.listImages(),p.dispatcher.broadcast("setImages",p._availableImages),p.fire(new v.Event("data",{dataType:"style"}))})},f.prototype._validateLayer=function(c){var p=this.sourceCaches[c.source];if(p){var b=c.sourceLayer;if(b){var w=p.getSource();(w.type==="geojson"||w.vectorLayerIds&&w.vectorLayerIds.indexOf(b)===-1)&&this.fire(new v.ErrorEvent(new Error('Source layer "'+b+'" does not exist on source "'+w.id+'" as specified by style layer "'+c.id+'"')))}}},f.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var c in this.sourceCaches)if(!this.sourceCaches[c].loaded())return!1;return!!this.imageManager.isLoaded()},f.prototype._serializeLayers=function(c){for(var p=[],b=0,w=c;b<w.length;b+=1){var A=this._layers[w[b]];A.type!=="custom"&&p.push(A.serialize())}return p},f.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var c in this.sourceCaches)if(this.sourceCaches[c].hasTransition())return!0;for(var p in this._layers)if(this._layers[p].hasTransition())return!0;return!1},f.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},f.prototype.update=function(c){if(this._loaded){var p=this._changed;if(this._changed){var b=Object.keys(this._updatedLayers),w=Object.keys(this._removedLayers);for(var A in(b.length||w.length)&&this._updateWorkerLayers(b,w),this._updatedSources){var R=this._updatedSources[A];R==="reload"?this._reloadSource(A):R==="clear"&&this._clearSource(A)}for(var U in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[U].updateTransitions(c);this.light.updateTransitions(c),this._resetUpdates()}var q={};for(var le in this.sourceCaches){var fe=this.sourceCaches[le];q[le]=fe.used,fe.used=!1}for(var pe=0,Oe=this._order;pe<Oe.length;pe+=1){var Ce=this._layers[Oe[pe]];Ce.recalculate(c,this._availableImages),!Ce.isHidden(c.zoom)&&Ce.source&&(this.sourceCaches[Ce.source].used=!0)}for(var We in q){var Te=this.sourceCaches[We];q[We]!==Te.used&&Te.fire(new v.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:We}))}this.light.recalculate(c),this.z=c.zoom,p&&this.fire(new v.Event("data",{dataType:"style"}))}},f.prototype._updateTilesForChangedImages=function(){var c=Object.keys(this._changedImages);if(c.length){for(var p in this.sourceCaches)this.sourceCaches[p].reloadTilesForDependencies(["icons","patterns"],c);this._changedImages={}}},f.prototype._updateWorkerLayers=function(c,p){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(c),removedIds:p})},f.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},f.prototype.setState=function(c){var p=this;if(this._checkLoaded(),vs(this,v.validateStyle(c)))return!1;(c=v.clone$1(c)).layers=Dr(c.layers);var b=function(A,R){if(!A)return[{command:Gr.setStyle,args:[R]}];var U=[];try{if(!v.deepEqual(A.version,R.version))return[{command:Gr.setStyle,args:[R]}];v.deepEqual(A.center,R.center)||U.push({command:Gr.setCenter,args:[R.center]}),v.deepEqual(A.zoom,R.zoom)||U.push({command:Gr.setZoom,args:[R.zoom]}),v.deepEqual(A.bearing,R.bearing)||U.push({command:Gr.setBearing,args:[R.bearing]}),v.deepEqual(A.pitch,R.pitch)||U.push({command:Gr.setPitch,args:[R.pitch]}),v.deepEqual(A.sprite,R.sprite)||U.push({command:Gr.setSprite,args:[R.sprite]}),v.deepEqual(A.glyphs,R.glyphs)||U.push({command:Gr.setGlyphs,args:[R.glyphs]}),v.deepEqual(A.transition,R.transition)||U.push({command:Gr.setTransition,args:[R.transition]}),v.deepEqual(A.light,R.light)||U.push({command:Gr.setLight,args:[R.light]});var q={},le=[];(function(pe,Oe,Ce,We){var Te;for(Te in Oe=Oe||{},pe=pe||{})pe.hasOwnProperty(Te)&&(Oe.hasOwnProperty(Te)||Qr(Te,Ce,We));for(Te in Oe)Oe.hasOwnProperty(Te)&&(pe.hasOwnProperty(Te)?v.deepEqual(pe[Te],Oe[Te])||(pe[Te].type==="geojson"&&Oe[Te].type==="geojson"&&Wi(pe,Oe,Te)?Ce.push({command:Gr.setGeoJSONSourceData,args:[Te,Oe[Te].data]}):An(Te,Oe,Ce,We)):vi(Te,Oe,Ce))})(A.sources,R.sources,le,q);var fe=[];A.layers&&A.layers.forEach(function(pe){q[pe.source]?U.push({command:Gr.removeLayer,args:[pe.id]}):fe.push(pe)}),U=U.concat(le),function(pe,Oe,Ce){Oe=Oe||[];var We,Te,He,Qe,yt,Vt,Nt,Kt=(pe=pe||[]).map(Ti),cr=Oe.map(Ti),Ir=pe.reduce(_i,{}),Or=Oe.reduce(_i,{}),tn=Kt.slice(),Rn=Object.create(null);for(We=0,Te=0;We<Kt.length;We++)Or.hasOwnProperty(He=Kt[We])?Te++:(Ce.push({command:Gr.removeLayer,args:[He]}),tn.splice(tn.indexOf(He,Te),1));for(We=0,Te=0;We<cr.length;We++)tn[tn.length-1-We]!==(He=cr[cr.length-1-We])&&(Ir.hasOwnProperty(He)?(Ce.push({command:Gr.removeLayer,args:[He]}),tn.splice(tn.lastIndexOf(He,tn.length-Te),1)):Te++,Ce.push({command:Gr.addLayer,args:[Or[He],Vt=tn[tn.length-We]]}),tn.splice(tn.length-We,0,He),Rn[He]=!0);for(We=0;We<cr.length;We++)if(Qe=Ir[He=cr[We]],yt=Or[He],!Rn[He]&&!v.deepEqual(Qe,yt))if(v.deepEqual(Qe.source,yt.source)&&v.deepEqual(Qe["source-layer"],yt["source-layer"])&&v.deepEqual(Qe.type,yt.type)){for(Nt in di(Qe.layout,yt.layout,Ce,He,null,Gr.setLayoutProperty),di(Qe.paint,yt.paint,Ce,He,null,Gr.setPaintProperty),v.deepEqual(Qe.filter,yt.filter)||Ce.push({command:Gr.setFilter,args:[He,yt.filter]}),v.deepEqual(Qe.minzoom,yt.minzoom)&&v.deepEqual(Qe.maxzoom,yt.maxzoom)||Ce.push({command:Gr.setLayerZoomRange,args:[He,yt.minzoom,yt.maxzoom]}),Qe)Qe.hasOwnProperty(Nt)&&Nt!=="layout"&&Nt!=="paint"&&Nt!=="filter"&&Nt!=="metadata"&&Nt!=="minzoom"&&Nt!=="maxzoom"&&(Nt.indexOf("paint.")===0?di(Qe[Nt],yt[Nt],Ce,He,Nt.slice(6),Gr.setPaintProperty):v.deepEqual(Qe[Nt],yt[Nt])||Ce.push({command:Gr.setLayerProperty,args:[He,Nt,yt[Nt]]}));for(Nt in yt)yt.hasOwnProperty(Nt)&&!Qe.hasOwnProperty(Nt)&&Nt!=="layout"&&Nt!=="paint"&&Nt!=="filter"&&Nt!=="metadata"&&Nt!=="minzoom"&&Nt!=="maxzoom"&&(Nt.indexOf("paint.")===0?di(Qe[Nt],yt[Nt],Ce,He,Nt.slice(6),Gr.setPaintProperty):v.deepEqual(Qe[Nt],yt[Nt])||Ce.push({command:Gr.setLayerProperty,args:[He,Nt,yt[Nt]]}))}else Ce.push({command:Gr.removeLayer,args:[He]}),Vt=tn[tn.lastIndexOf(He)+1],Ce.push({command:Gr.addLayer,args:[yt,Vt]})}(fe,R.layers,U)}catch(pe){console.warn("Unable to compute style diff:",pe),U=[{command:Gr.setStyle,args:[R]}]}return U}(this.serialize(),c).filter(function(A){return!(A.command in ks)});if(b.length===0)return!1;var w=b.filter(function(A){return!(A.command in Is)});if(w.length>0)throw new Error("Unimplemented: "+w.map(function(A){return A.command}).join(", ")+".");return b.forEach(function(A){A.command!=="setTransition"&&p[A.command].apply(p,A.args)}),this.stylesheet=c,!0},f.prototype.addImage=function(c,p){if(this.getImage(c))return this.fire(new v.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(c,p),this._afterImageUpdated(c)},f.prototype.updateImage=function(c,p){this.imageManager.updateImage(c,p)},f.prototype.getImage=function(c){return this.imageManager.getImage(c)},f.prototype.removeImage=function(c){if(!this.getImage(c))return this.fire(new v.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(c),this._afterImageUpdated(c)},f.prototype._afterImageUpdated=function(c){this._availableImages=this.imageManager.listImages(),this._changedImages[c]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new v.Event("data",{dataType:"style"}))},f.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},f.prototype.addSource=function(c,p,b){var w=this;if(b===void 0&&(b={}),this._checkLoaded(),this.sourceCaches[c]!==void 0)throw new Error("There is already a source with this ID");if(!p.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(p).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(p.type)>=0&&this._validate(v.validateStyle.source,"sources."+c,p,null,b))){this.map&&this.map._collectResourceTiming&&(p.collectResourceTiming=!0);var A=this.sourceCaches[c]=new Re(c,p,this.dispatcher);A.style=this,A.setEventedParent(this,function(){return{isSourceLoaded:w.loaded(),source:A.serialize(),sourceId:c}}),A.onAdd(this.map),this._changed=!0}},f.prototype.removeSource=function(c){if(this._checkLoaded(),this.sourceCaches[c]===void 0)throw new Error("There is no source with this ID");for(var p in this._layers)if(this._layers[p].source===c)return this.fire(new v.ErrorEvent(new Error('Source "'+c+'" cannot be removed while layer "'+p+'" is using it.')));var b=this.sourceCaches[c];delete this.sourceCaches[c],delete this._updatedSources[c],b.fire(new v.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:c})),b.setEventedParent(null),b.clearTiles(),b.onRemove&&b.onRemove(this.map),this._changed=!0},f.prototype.setGeoJSONSourceData=function(c,p){this._checkLoaded(),this.sourceCaches[c].getSource().setData(p),this._changed=!0},f.prototype.getSource=function(c){return this.sourceCaches[c]&&this.sourceCaches[c].getSource()},f.prototype.addLayer=function(c,p,b){b===void 0&&(b={}),this._checkLoaded();var w=c.id;if(this.getLayer(w))this.fire(new v.ErrorEvent(new Error('Layer with id "'+w+'" already exists on this map')));else{var A;if(c.type==="custom"){if(vs(this,v.validateCustomStyleLayer(c)))return;A=v.createStyleLayer(c)}else{if(typeof c.source=="object"&&(this.addSource(w,c.source),c=v.clone$1(c),c=v.extend(c,{source:w})),this._validate(v.validateStyle.layer,"layers."+w,c,{arrayIndex:-1},b))return;A=v.createStyleLayer(c),this._validateLayer(A),A.setEventedParent(this,{layer:{id:w}}),this._serializedLayers[A.id]=A.serialize()}var R=p?this._order.indexOf(p):this._order.length;if(p&&R===-1)this.fire(new v.ErrorEvent(new Error('Layer with id "'+p+'" does not exist on this map.')));else{if(this._order.splice(R,0,w),this._layerOrderChanged=!0,this._layers[w]=A,this._removedLayers[w]&&A.source&&A.type!=="custom"){var U=this._removedLayers[w];delete this._removedLayers[w],U.type!==A.type?this._updatedSources[A.source]="clear":(this._updatedSources[A.source]="reload",this.sourceCaches[A.source].pause())}this._updateLayer(A),A.onAdd&&A.onAdd(this.map)}}},f.prototype.moveLayer=function(c,p){if(this._checkLoaded(),this._changed=!0,this._layers[c]){if(c!==p){var b=this._order.indexOf(c);this._order.splice(b,1);var w=p?this._order.indexOf(p):this._order.length;p&&w===-1?this.fire(new v.ErrorEvent(new Error('Layer with id "'+p+'" does not exist on this map.'))):(this._order.splice(w,0,c),this._layerOrderChanged=!0)}}else this.fire(new v.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be moved.")))},f.prototype.removeLayer=function(c){this._checkLoaded();var p=this._layers[c];if(p){p.setEventedParent(null);var b=this._order.indexOf(c);this._order.splice(b,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[c]=p,delete this._layers[c],delete this._serializedLayers[c],delete this._updatedLayers[c],delete this._updatedPaintProps[c],p.onRemove&&p.onRemove(this.map)}else this.fire(new v.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be removed.")))},f.prototype.getLayer=function(c){return this._layers[c]},f.prototype.hasLayer=function(c){return c in this._layers},f.prototype.setLayerZoomRange=function(c,p,b){this._checkLoaded();var w=this.getLayer(c);w?w.minzoom===p&&w.maxzoom===b||(p!=null&&(w.minzoom=p),b!=null&&(w.maxzoom=b),this._updateLayer(w)):this.fire(new v.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot have zoom extent.")))},f.prototype.setFilter=function(c,p,b){b===void 0&&(b={}),this._checkLoaded();var w=this.getLayer(c);if(w){if(!v.deepEqual(w.filter,p))return p==null?(w.filter=void 0,void this._updateLayer(w)):void(this._validate(v.validateStyle.filter,"layers."+w.id+".filter",p,null,b)||(w.filter=v.clone$1(p),this._updateLayer(w)))}else this.fire(new v.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be filtered.")))},f.prototype.getFilter=function(c){return v.clone$1(this.getLayer(c).filter)},f.prototype.setLayoutProperty=function(c,p,b,w){w===void 0&&(w={}),this._checkLoaded();var A=this.getLayer(c);A?v.deepEqual(A.getLayoutProperty(p),b)||(A.setLayoutProperty(p,b,w),this._updateLayer(A)):this.fire(new v.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be styled.")))},f.prototype.getLayoutProperty=function(c,p){var b=this.getLayer(c);if(b)return b.getLayoutProperty(p);this.fire(new v.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style.")))},f.prototype.setPaintProperty=function(c,p,b,w){w===void 0&&(w={}),this._checkLoaded();var A=this.getLayer(c);A?v.deepEqual(A.getPaintProperty(p),b)||(A.setPaintProperty(p,b,w)&&this._updateLayer(A),this._changed=!0,this._updatedPaintProps[c]=!0):this.fire(new v.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be styled.")))},f.prototype.getPaintProperty=function(c,p){return this.getLayer(c).getPaintProperty(p)},f.prototype.setFeatureState=function(c,p){this._checkLoaded();var b=c.source,w=c.sourceLayer,A=this.sourceCaches[b];if(A!==void 0){var R=A.getSource().type;R==="geojson"&&w?this.fire(new v.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):R!=="vector"||w?(c.id===void 0&&this.fire(new v.ErrorEvent(new Error("The feature id parameter must be provided."))),A.setFeatureState(w,c.id,p)):this.fire(new v.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new v.ErrorEvent(new Error("The source '"+b+"' does not exist in the map's style.")))},f.prototype.removeFeatureState=function(c,p){this._checkLoaded();var b=c.source,w=this.sourceCaches[b];if(w!==void 0){var A=w.getSource().type,R=A==="vector"?c.sourceLayer:void 0;A!=="vector"||R?p&&typeof c.id!="string"&&typeof c.id!="number"?this.fire(new v.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):w.removeFeatureState(R,c.id,p):this.fire(new v.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new v.ErrorEvent(new Error("The source '"+b+"' does not exist in the map's style.")))},f.prototype.getFeatureState=function(c){this._checkLoaded();var p=c.source,b=c.sourceLayer,w=this.sourceCaches[p];if(w!==void 0){if(w.getSource().type!=="vector"||b)return c.id===void 0&&this.fire(new v.ErrorEvent(new Error("The feature id parameter must be provided."))),w.getFeatureState(b,c.id);this.fire(new v.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new v.ErrorEvent(new Error("The source '"+p+"' does not exist in the map's style.")))},f.prototype.getTransition=function(){return v.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},f.prototype.serialize=function(){return v.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:v.mapObject(this.sourceCaches,function(c){return c.serialize()}),layers:this._serializeLayers(this._order)},function(c){return c!==void 0})},f.prototype._updateLayer=function(c){this._updatedLayers[c.id]=!0,c.source&&!this._updatedSources[c.source]&&this.sourceCaches[c.source].getSource().type!=="raster"&&(this._updatedSources[c.source]="reload",this.sourceCaches[c.source].pause()),this._changed=!0},f.prototype._flattenAndSortRenderedFeatures=function(c){for(var p=this,b=function(Ir){return p._layers[Ir].type==="fill-extrusion"},w={},A=[],R=this._order.length-1;R>=0;R--){var U=this._order[R];if(b(U)){w[U]=R;for(var q=0,le=c;q<le.length;q+=1){var fe=le[q][U];if(fe)for(var pe=0,Oe=fe;pe<Oe.length;pe+=1)A.push(Oe[pe])}}}A.sort(function(Ir,Or){return Or.intersectionZ-Ir.intersectionZ});for(var Ce=[],We=this._order.length-1;We>=0;We--){var Te=this._order[We];if(b(Te))for(var He=A.length-1;He>=0;He--){var Qe=A[He].feature;if(w[Qe.layer.id]<We)break;Ce.push(Qe),A.pop()}else for(var yt=0,Vt=c;yt<Vt.length;yt+=1){var Nt=Vt[yt][Te];if(Nt)for(var Kt=0,cr=Nt;Kt<cr.length;Kt+=1)Ce.push(cr[Kt].feature)}}return Ce},f.prototype.queryRenderedFeatures=function(c,p,b){p&&p.filter&&this._validate(v.validateStyle.filter,"queryRenderedFeatures.filter",p.filter,null,p);var w={};if(p&&p.layers){if(!Array.isArray(p.layers))return this.fire(new v.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var A=0,R=p.layers;A<R.length;A+=1){var U=R[A],q=this._layers[U];if(!q)return this.fire(new v.ErrorEvent(new Error("The layer '"+U+"' does not exist in the map's style and cannot be queried for features."))),[];w[q.source]=!0}}var le=[];for(var fe in p.availableImages=this._availableImages,this.sourceCaches)p.layers&&!w[fe]||le.push(cn(this.sourceCaches[fe],this._layers,this._serializedLayers,c,p,b));return this.placement&&le.push(function(pe,Oe,Ce,We,Te,He,Qe){for(var yt={},Vt=He.queryRenderedSymbols(We),Nt=[],Kt=0,cr=Object.keys(Vt).map(Number);Kt<cr.length;Kt+=1)Nt.push(Qe[cr[Kt]]);Nt.sort(ci);for(var Ir=function(){var Un=tn[Or],Li=Un.featureIndex.lookupSymbolFeatures(Vt[Un.bucketInstanceId],Oe,Un.bucketIndex,Un.sourceLayerIndex,Te.filter,Te.layers,Te.availableImages,pe);for(var Zr in Li){var ii=yt[Zr]=yt[Zr]||[],si=Li[Zr];si.sort(function(mi,Kn){var Wn=Un.featureSortOrder;if(Wn){var uo=Wn.indexOf(mi.featureIndex);return Wn.indexOf(Kn.featureIndex)-uo}return Kn.featureIndex-mi.featureIndex});for(var Qn=0,Hn=si;Qn<Hn.length;Qn+=1)ii.push(Hn[Qn])}},Or=0,tn=Nt;Or<tn.length;Or+=1)Ir();var Rn=function(Un){yt[Un].forEach(function(Li){var Zr=Li.feature,ii=Ce[pe[Un].source].getFeatureState(Zr.layer["source-layer"],Zr.id);Zr.source=Zr.layer.source,Zr.layer["source-layer"]&&(Zr.sourceLayer=Zr.layer["source-layer"]),Zr.state=ii})};for(var Fn in yt)Rn(Fn);return yt}(this._layers,this._serializedLayers,this.sourceCaches,c,p,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(le)},f.prototype.querySourceFeatures=function(c,p){p&&p.filter&&this._validate(v.validateStyle.filter,"querySourceFeatures.filter",p.filter,null,p);var b=this.sourceCaches[c];return b?function(w,A){for(var R=w.getRenderableIds().map(function(Oe){return w.getTileByID(Oe)}),U=[],q={},le=0;le<R.length;le++){var fe=R[le],pe=fe.tileID.canonical.key;q[pe]||(q[pe]=!0,fe.querySourceFeatures(U,A))}return U}(b,p):[]},f.prototype.addSourceType=function(c,p,b){return f.getSourceType(c)?b(new Error('A source type called "'+c+'" already exists.')):(f.setSourceType(c,p),p.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:c,url:p.workerSourceURL},b):b(null,null))},f.prototype.getLight=function(){return this.light.getLight()},f.prototype.setLight=function(c,p){p===void 0&&(p={}),this._checkLoaded();var b=this.light.getLight(),w=!1;for(var A in c)if(!v.deepEqual(c[A],b[A])){w=!0;break}if(w){var R={now:v.browser.now(),transition:v.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(c,p),this.light.updateTransitions(R)}},f.prototype._validate=function(c,p,b,w,A){return A===void 0&&(A={}),(!A||A.validate!==!1)&&vs(this,c.call(v.validateStyle,v.extend({key:p,style:this.serialize(),value:b,styleSpec:v.styleSpec},w)))},f.prototype._remove=function(){for(var c in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),v.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[c].setEventedParent(null);for(var p in this.sourceCaches)this.sourceCaches[p].clearTiles(),this.sourceCaches[p].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},f.prototype._clearSource=function(c){this.sourceCaches[c].clearTiles()},f.prototype._reloadSource=function(c){this.sourceCaches[c].resume(),this.sourceCaches[c].reload()},f.prototype._updateSources=function(c){for(var p in this.sourceCaches)this.sourceCaches[p].update(c)},f.prototype._generateCollisionBoxes=function(){for(var c in this.sourceCaches)this._reloadSource(c)},f.prototype._updatePlacement=function(c,p,b,w,A){A===void 0&&(A=!1);for(var R=!1,U=!1,q={},le=0,fe=this._order;le<fe.length;le+=1){var pe=this._layers[fe[le]];if(pe.type==="symbol"){if(!q[pe.source]){var Oe=this.sourceCaches[pe.source];q[pe.source]=Oe.getRenderableIds(!0).map(function(Qe){return Oe.getTileByID(Qe)}).sort(function(Qe,yt){return yt.tileID.overscaledZ-Qe.tileID.overscaledZ||(Qe.tileID.isLessThan(yt.tileID)?-1:1)})}var Ce=this.crossTileSymbolIndex.addLayer(pe,q[pe.source],c.center.lng);R=R||Ce}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((A=A||this._layerOrderChanged||b===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(v.browser.now(),c.zoom))&&(this.pauseablePlacement=new La(c,this._order,A,p,b,w,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,q),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(v.browser.now()),U=!0),R&&this.pauseablePlacement.placement.setStale()),U||R)for(var We=0,Te=this._order;We<Te.length;We+=1){var He=this._layers[Te[We]];He.type==="symbol"&&this.placement.updateLayerOpacities(He,q[He.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(v.browser.now())},f.prototype._releaseSymbolFadeTiles=function(){for(var c in this.sourceCaches)this.sourceCaches[c].releaseSymbolFadeTiles()},f.prototype.getImages=function(c,p,b){this.imageManager.getImages(p.icons,b),this._updateTilesForChangedImages();var w=this.sourceCaches[p.source];w&&w.setDependencies(p.tileID.key,p.type,p.icons)},f.prototype.getGlyphs=function(c,p,b){this.glyphManager.getGlyphs(p.stacks,b)},f.prototype.getResource=function(c,p,b){return v.makeRequest(p,b)},f}(v.Evented);ms.getSourceType=function(l){return br[l]},ms.setSourceType=function(l,f){br[l]=f},ms.registerForPluginStateChange=v.registerForPluginStateChange;var ga=v.createLayout([{name:"a_pos",type:"Int16",components:2}]),_a=ji(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),ns=ji(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Jc=ji(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),Tl=ji(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),Zs=ji("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),nc=ji(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),Gu=ji(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),Vs=ji("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),ul=ji("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),y=ji("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),T=ji(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),N=ji(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),O=ji(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),$=ji(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),_e=ji(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),Xe=ji(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),ht=ji(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),dt=ji(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),ir=ji(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),sr=ji(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),Cn=ji(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),ni=ji(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),In=ji(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),Xi=ji(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),va=ji(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),wa=ji(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function ji(l,f){var c=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,p=f.match(/attribute ([\w]+) ([\w]+)/g),b=l.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),w=f.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),A=w?w.concat(b):b,R={};return{fragmentSource:l=l.replace(c,function(U,q,le,fe,pe){return R[pe]=!0,q==="define"?`
#ifndef HAS_UNIFORM_u_`+pe+`
varying `+le+" "+fe+" "+pe+`;
#else
uniform `+le+" "+fe+" u_"+pe+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+pe+`
    `+le+" "+fe+" "+pe+" = u_"+pe+`;
#endif
`}),vertexSource:f=f.replace(c,function(U,q,le,fe,pe){var Oe=fe==="float"?"vec2":"vec4",Ce=pe.match(/color/)?"color":Oe;return R[pe]?q==="define"?`
#ifndef HAS_UNIFORM_u_`+pe+`
uniform lowp float u_`+pe+`_t;
attribute `+le+" "+Oe+" a_"+pe+`;
varying `+le+" "+fe+" "+pe+`;
#else
uniform `+le+" "+fe+" u_"+pe+`;
#endif
`:Ce==="vec4"?`
#ifndef HAS_UNIFORM_u_`+pe+`
    `+pe+" = a_"+pe+`;
#else
    `+le+" "+fe+" "+pe+" = u_"+pe+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+pe+`
    `+pe+" = unpack_mix_"+Ce+"(a_"+pe+", u_"+pe+`_t);
#else
    `+le+" "+fe+" "+pe+" = u_"+pe+`;
#endif
`:q==="define"?`
#ifndef HAS_UNIFORM_u_`+pe+`
uniform lowp float u_`+pe+`_t;
attribute `+le+" "+Oe+" a_"+pe+`;
#else
uniform `+le+" "+fe+" u_"+pe+`;
#endif
`:Ce==="vec4"?`
#ifndef HAS_UNIFORM_u_`+pe+`
    `+le+" "+fe+" "+pe+" = a_"+pe+`;
#else
    `+le+" "+fe+" "+pe+" = u_"+pe+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+pe+`
    `+le+" "+fe+" "+pe+" = unpack_mix_"+Ce+"(a_"+pe+", u_"+pe+`_t);
#else
    `+le+" "+fe+" "+pe+" = u_"+pe+`;
#endif
`}),staticAttributes:p,staticUniforms:A}}var gs=Object.freeze({__proto__:null,prelude:_a,background:ns,backgroundPattern:Jc,circle:Tl,clippingMask:Zs,heatmap:nc,heatmapTexture:Gu,collisionBox:Vs,collisionCircle:ul,debug:y,fill:T,fillOutline:N,fillOutlinePattern:O,fillPattern:$,fillExtrusion:_e,fillExtrusionPattern:Xe,hillshadePrepare:ht,hillshade:dt,line:ir,lineGradient:sr,linePattern:Cn,lineSDF:ni,raster:In,symbolIcon:Xi,symbolSDF:va,symbolTextAndIcon:wa}),Js=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function Hu(l){for(var f=[],c=0;c<l.length;c++)if(l[c]!==null){var p=l[c].split(" ");f.push(p.pop())}return f}Js.prototype.bind=function(l,f,c,p,b,w,A,R){this.context=l;for(var U=this.boundPaintVertexBuffers.length!==p.length,q=0;!U&&q<p.length;q++)this.boundPaintVertexBuffers[q]!==p[q]&&(U=!0);l.extVertexArrayObject&&this.vao&&this.boundProgram===f&&this.boundLayoutVertexBuffer===c&&!U&&this.boundIndexBuffer===b&&this.boundVertexOffset===w&&this.boundDynamicVertexBuffer===A&&this.boundDynamicVertexBuffer2===R?(l.bindVertexArrayOES.set(this.vao),A&&A.bind(),b&&b.dynamicDraw&&b.bind(),R&&R.bind()):this.freshBind(f,c,p,b,w,A,R)},Js.prototype.freshBind=function(l,f,c,p,b,w,A){var R,U=l.numAttributes,q=this.context,le=q.gl;if(q.extVertexArrayObject)this.vao&&this.destroy(),this.vao=q.extVertexArrayObject.createVertexArrayOES(),q.bindVertexArrayOES.set(this.vao),R=0,this.boundProgram=l,this.boundLayoutVertexBuffer=f,this.boundPaintVertexBuffers=c,this.boundIndexBuffer=p,this.boundVertexOffset=b,this.boundDynamicVertexBuffer=w,this.boundDynamicVertexBuffer2=A;else{R=q.currentNumAttributes||0;for(var fe=U;fe<R;fe++)le.disableVertexAttribArray(fe)}f.enableAttributes(le,l);for(var pe=0,Oe=c;pe<Oe.length;pe+=1)Oe[pe].enableAttributes(le,l);w&&w.enableAttributes(le,l),A&&A.enableAttributes(le,l),f.bind(),f.setVertexAttribPointers(le,l,b);for(var Ce=0,We=c;Ce<We.length;Ce+=1){var Te=We[Ce];Te.bind(),Te.setVertexAttribPointers(le,l,b)}w&&(w.bind(),w.setVertexAttribPointers(le,l,b)),p&&p.bind(),A&&(A.bind(),A.setVertexAttribPointers(le,l,b)),q.currentNumAttributes=U},Js.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var Qc=function(l,f,c,p,b,w){var A=l.gl;this.program=A.createProgram();for(var R=Hu(c.staticAttributes),U=p?p.getBinderAttributes():[],q=R.concat(U),le=c.staticUniforms?Hu(c.staticUniforms):[],fe=p?p.getBinderUniforms():[],pe=[],Oe=0,Ce=le.concat(fe);Oe<Ce.length;Oe+=1){var We=Ce[Oe];pe.indexOf(We)<0&&pe.push(We)}var Te=p?p.defines():[];w&&Te.push("#define OVERDRAW_INSPECTOR;");var He=Te.concat(_a.fragmentSource,c.fragmentSource).join(`
`),Qe=Te.concat(_a.vertexSource,c.vertexSource).join(`
`),yt=A.createShader(A.FRAGMENT_SHADER);if(A.isContextLost())this.failedToCreate=!0;else{A.shaderSource(yt,He),A.compileShader(yt),A.attachShader(this.program,yt);var Vt=A.createShader(A.VERTEX_SHADER);if(A.isContextLost())this.failedToCreate=!0;else{A.shaderSource(Vt,Qe),A.compileShader(Vt),A.attachShader(this.program,Vt),this.attributes={};var Nt={};this.numAttributes=q.length;for(var Kt=0;Kt<this.numAttributes;Kt++)q[Kt]&&(A.bindAttribLocation(this.program,Kt,q[Kt]),this.attributes[q[Kt]]=Kt);A.linkProgram(this.program),A.deleteShader(Vt),A.deleteShader(yt);for(var cr=0;cr<pe.length;cr++){var Ir=pe[cr];if(Ir&&!Nt[Ir]){var Or=A.getUniformLocation(this.program,Ir);Or&&(Nt[Ir]=Or)}}this.fixedUniforms=b(l,Nt),this.binderUniforms=p?p.getUniforms(l,Nt):[]}}};function ll(l,f,c){var p=1/oa(c,1,f.transform.tileZoom),b=Math.pow(2,c.tileID.overscaledZ),w=c.tileSize*Math.pow(2,f.transform.tileZoom)/b,A=w*(c.tileID.canonical.x+c.tileID.wrap*b),R=w*c.tileID.canonical.y;return{u_image:0,u_texsize:c.imageAtlasTexture.size,u_scale:[p,l.fromScale,l.toScale],u_fade:l.t,u_pixel_coord_upper:[A>>16,R>>16],u_pixel_coord_lower:[65535&A,65535&R]}}Qc.prototype.draw=function(l,f,c,p,b,w,A,R,U,q,le,fe,pe,Oe,Ce,We){var Te,He=l.gl;if(!this.failedToCreate){for(var Qe in l.program.set(this.program),l.setDepthMode(c),l.setStencilMode(p),l.setColorMode(b),l.setCullFace(w),this.fixedUniforms)this.fixedUniforms[Qe].set(A[Qe]);Oe&&Oe.setUniforms(l,this.binderUniforms,fe,{zoom:pe});for(var yt=(Te={},Te[He.LINES]=2,Te[He.TRIANGLES]=3,Te[He.LINE_STRIP]=1,Te)[f],Vt=0,Nt=le.get();Vt<Nt.length;Vt+=1){var Kt=Nt[Vt],cr=Kt.vaos||(Kt.vaos={});(cr[R]||(cr[R]=new Js)).bind(l,this,U,Oe?Oe.getPaintVertexBuffers():[],q,Kt.vertexOffset,Ce,We),He.drawElements(f,Kt.primitiveLength*yt,He.UNSIGNED_SHORT,Kt.primitiveOffset*yt*2)}}};var Oc=function(l,f,c,p){var b=f.style.light,w=b.properties.get("position"),A=[w.x,w.y,w.z],R=v.create$1();b.properties.get("anchor")==="viewport"&&v.fromRotation(R,-f.transform.angle),v.transformMat3(A,A,R);var U=b.properties.get("color");return{u_matrix:l,u_lightpos:A,u_lightintensity:b.properties.get("intensity"),u_lightcolor:[U.r,U.g,U.b],u_vertical_gradient:+c,u_opacity:p}},Eu=function(l,f,c,p,b,w,A){return v.extend(Oc(l,f,c,p),ll(w,f,A),{u_height_factor:-Math.pow(2,b.overscaledZ)/A.tileSize/8})},Su=function(l){return{u_matrix:l}},wu=function(l,f,c,p){return v.extend(Su(l),ll(c,f,p))},oo=function(l,f){return{u_matrix:l,u_world:f}},Bf=function(l,f,c,p,b){return v.extend(wu(l,f,c,p),{u_world:b})},zf=function(l,f,c,p){var b,w,A=l.transform;if(p.paint.get("circle-pitch-alignment")==="map"){var R=oa(c,1,A.zoom);b=!0,w=[R,R]}else b=!1,w=A.pixelsToGLUnits;return{u_camera_to_center_distance:A.cameraToCenterDistance,u_scale_with_map:+(p.paint.get("circle-pitch-scale")==="map"),u_matrix:l.translatePosMatrix(f.posMatrix,c,p.paint.get("circle-translate"),p.paint.get("circle-translate-anchor")),u_pitch_with_map:+b,u_device_pixel_ratio:v.browser.devicePixelRatio,u_extrude_scale:w}},$o=function(l,f,c){var p=oa(c,1,f.zoom),b=Math.pow(2,f.zoom-c.tileID.overscaledZ),w=c.tileID.overscaleFactor();return{u_matrix:l,u_camera_to_center_distance:f.cameraToCenterDistance,u_pixels_to_tile_units:p,u_extrude_scale:[f.pixelsToGLUnits[0]/(p*b),f.pixelsToGLUnits[1]/(p*b)],u_overscale_factor:w}},Rc=function(l,f,c){return{u_matrix:l,u_inv_matrix:f,u_camera_to_center_distance:c.cameraToCenterDistance,u_viewport_size:[c.width,c.height]}},Cu=function(l,f,c){return c===void 0&&(c=1),{u_matrix:l,u_color:f,u_overlay:0,u_overlay_scale:c}},Qs=function(l){return{u_matrix:l}},ef=function(l,f,c,p){return{u_matrix:l,u_extrude_scale:oa(f,1,c),u_intensity:p}},Al=function(l,f,c){var p=l.transform;return{u_matrix:Lc(l,f,c),u_ratio:1/oa(f,1,p.zoom),u_device_pixel_ratio:v.browser.devicePixelRatio,u_units_to_pixels:[1/p.pixelsToGLUnits[0],1/p.pixelsToGLUnits[1]]}},Di=function(l,f,c,p){return v.extend(Al(l,f,c),{u_image:0,u_image_height:p})},Ml=function(l,f,c,p){var b=l.transform,w=cl(f,b);return{u_matrix:Lc(l,f,c),u_texsize:f.imageAtlasTexture.size,u_ratio:1/oa(f,1,b.zoom),u_device_pixel_ratio:v.browser.devicePixelRatio,u_image:0,u_scale:[w,p.fromScale,p.toScale],u_fade:p.t,u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]]}},gh=function(l,f,c,p,b){var w=l.lineAtlas,A=cl(f,l.transform),R=c.layout.get("line-cap")==="round",U=w.getDash(p.from,R),q=w.getDash(p.to,R),le=U.width*b.fromScale,fe=q.width*b.toScale;return v.extend(Al(l,f,c),{u_patternscale_a:[A/le,-U.height/2],u_patternscale_b:[A/fe,-q.height/2],u_sdfgamma:w.width/(256*Math.min(le,fe)*v.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:U.y,u_tex_y_b:q.y,u_mix:b.t})};function cl(l,f){return 1/oa(l,1,f.tileZoom)}function Lc(l,f,c){return l.translatePosMatrix(f.tileID.posMatrix,f,c.paint.get("line-translate"),c.paint.get("line-translate-anchor"))}var Uf=function(l,f,c,p,b){return{u_matrix:l,u_tl_parent:f,u_scale_parent:c,u_buffer_scale:1,u_fade_t:p.mix,u_opacity:p.opacity*b.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:b.paint.get("raster-brightness-min"),u_brightness_high:b.paint.get("raster-brightness-max"),u_saturation_factor:(A=b.paint.get("raster-saturation"),A>0?1-1/(1.001-A):-A),u_contrast_factor:(w=b.paint.get("raster-contrast"),w>0?1/(1-w):1+w),u_spin_weights:yh(b.paint.get("raster-hue-rotate"))};var w,A};function yh(l){l*=Math.PI/180;var f=Math.sin(l),c=Math.cos(l);return[(2*c+1)/3,(-Math.sqrt(3)*f-c+1)/3,(Math.sqrt(3)*f-c+1)/3]}var Zf,kc=function(l,f,c,p,b,w,A,R,U,q){var le=b.transform;return{u_is_size_zoom_constant:+(l==="constant"||l==="source"),u_is_size_feature_constant:+(l==="constant"||l==="camera"),u_size_t:f?f.uSizeT:0,u_size:f?f.uSize:0,u_camera_to_center_distance:le.cameraToCenterDistance,u_pitch:le.pitch/360*2*Math.PI,u_rotate_symbol:+c,u_aspect_ratio:le.width/le.height,u_fade_change:b.options.fadeDuration?b.symbolFadeChange:1,u_matrix:w,u_label_plane_matrix:A,u_coord_matrix:R,u_is_text:+U,u_pitch_with_map:+p,u_texsize:q,u_texture:0}},ic=function(l,f,c,p,b,w,A,R,U,q,le){var fe=b.transform;return v.extend(kc(l,f,c,p,b,w,A,R,U,q),{u_gamma_scale:p?Math.cos(fe._pitch)*fe.cameraToCenterDistance:1,u_device_pixel_ratio:v.browser.devicePixelRatio,u_is_halo:+le})},ac=function(l,f,c,p,b,w,A,R,U,q){return v.extend(ic(l,f,c,p,b,w,A,R,!0,U,!0),{u_texsize_icon:q,u_texture_icon:1})},Pl=function(l,f,c){return{u_matrix:l,u_opacity:f,u_color:c}},fl=function(l,f,c,p,b,w){return v.extend(function(A,R,U,q){var le=U.imageManager.getPattern(A.from.toString()),fe=U.imageManager.getPattern(A.to.toString()),pe=U.imageManager.getPixelSize(),Oe=pe.width,Ce=pe.height,We=Math.pow(2,q.tileID.overscaledZ),Te=q.tileSize*Math.pow(2,U.transform.tileZoom)/We,He=Te*(q.tileID.canonical.x+q.tileID.wrap*We),Qe=Te*q.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:le.tl,u_pattern_br_a:le.br,u_pattern_tl_b:fe.tl,u_pattern_br_b:fe.br,u_texsize:[Oe,Ce],u_mix:R.t,u_pattern_size_a:le.displaySize,u_pattern_size_b:fe.displaySize,u_scale_a:R.fromScale,u_scale_b:R.toScale,u_tile_units_to_pixels:1/oa(q,1,U.transform.tileZoom),u_pixel_coord_upper:[He>>16,Qe>>16],u_pixel_coord_lower:[65535&He,65535&Qe]}}(p,w,c,b),{u_matrix:l,u_opacity:f})},Il={fillExtrusion:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_lightpos:new v.Uniform3f(l,f.u_lightpos),u_lightintensity:new v.Uniform1f(l,f.u_lightintensity),u_lightcolor:new v.Uniform3f(l,f.u_lightcolor),u_vertical_gradient:new v.Uniform1f(l,f.u_vertical_gradient),u_opacity:new v.Uniform1f(l,f.u_opacity)}},fillExtrusionPattern:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_lightpos:new v.Uniform3f(l,f.u_lightpos),u_lightintensity:new v.Uniform1f(l,f.u_lightintensity),u_lightcolor:new v.Uniform3f(l,f.u_lightcolor),u_vertical_gradient:new v.Uniform1f(l,f.u_vertical_gradient),u_height_factor:new v.Uniform1f(l,f.u_height_factor),u_image:new v.Uniform1i(l,f.u_image),u_texsize:new v.Uniform2f(l,f.u_texsize),u_pixel_coord_upper:new v.Uniform2f(l,f.u_pixel_coord_upper),u_pixel_coord_lower:new v.Uniform2f(l,f.u_pixel_coord_lower),u_scale:new v.Uniform3f(l,f.u_scale),u_fade:new v.Uniform1f(l,f.u_fade),u_opacity:new v.Uniform1f(l,f.u_opacity)}},fill:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix)}},fillPattern:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_image:new v.Uniform1i(l,f.u_image),u_texsize:new v.Uniform2f(l,f.u_texsize),u_pixel_coord_upper:new v.Uniform2f(l,f.u_pixel_coord_upper),u_pixel_coord_lower:new v.Uniform2f(l,f.u_pixel_coord_lower),u_scale:new v.Uniform3f(l,f.u_scale),u_fade:new v.Uniform1f(l,f.u_fade)}},fillOutline:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_world:new v.Uniform2f(l,f.u_world)}},fillOutlinePattern:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_world:new v.Uniform2f(l,f.u_world),u_image:new v.Uniform1i(l,f.u_image),u_texsize:new v.Uniform2f(l,f.u_texsize),u_pixel_coord_upper:new v.Uniform2f(l,f.u_pixel_coord_upper),u_pixel_coord_lower:new v.Uniform2f(l,f.u_pixel_coord_lower),u_scale:new v.Uniform3f(l,f.u_scale),u_fade:new v.Uniform1f(l,f.u_fade)}},circle:function(l,f){return{u_camera_to_center_distance:new v.Uniform1f(l,f.u_camera_to_center_distance),u_scale_with_map:new v.Uniform1i(l,f.u_scale_with_map),u_pitch_with_map:new v.Uniform1i(l,f.u_pitch_with_map),u_extrude_scale:new v.Uniform2f(l,f.u_extrude_scale),u_device_pixel_ratio:new v.Uniform1f(l,f.u_device_pixel_ratio),u_matrix:new v.UniformMatrix4f(l,f.u_matrix)}},collisionBox:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_camera_to_center_distance:new v.Uniform1f(l,f.u_camera_to_center_distance),u_pixels_to_tile_units:new v.Uniform1f(l,f.u_pixels_to_tile_units),u_extrude_scale:new v.Uniform2f(l,f.u_extrude_scale),u_overscale_factor:new v.Uniform1f(l,f.u_overscale_factor)}},collisionCircle:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_inv_matrix:new v.UniformMatrix4f(l,f.u_inv_matrix),u_camera_to_center_distance:new v.Uniform1f(l,f.u_camera_to_center_distance),u_viewport_size:new v.Uniform2f(l,f.u_viewport_size)}},debug:function(l,f){return{u_color:new v.UniformColor(l,f.u_color),u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_overlay:new v.Uniform1i(l,f.u_overlay),u_overlay_scale:new v.Uniform1f(l,f.u_overlay_scale)}},clippingMask:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix)}},heatmap:function(l,f){return{u_extrude_scale:new v.Uniform1f(l,f.u_extrude_scale),u_intensity:new v.Uniform1f(l,f.u_intensity),u_matrix:new v.UniformMatrix4f(l,f.u_matrix)}},heatmapTexture:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_world:new v.Uniform2f(l,f.u_world),u_image:new v.Uniform1i(l,f.u_image),u_color_ramp:new v.Uniform1i(l,f.u_color_ramp),u_opacity:new v.Uniform1f(l,f.u_opacity)}},hillshade:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_image:new v.Uniform1i(l,f.u_image),u_latrange:new v.Uniform2f(l,f.u_latrange),u_light:new v.Uniform2f(l,f.u_light),u_shadow:new v.UniformColor(l,f.u_shadow),u_highlight:new v.UniformColor(l,f.u_highlight),u_accent:new v.UniformColor(l,f.u_accent)}},hillshadePrepare:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_image:new v.Uniform1i(l,f.u_image),u_dimension:new v.Uniform2f(l,f.u_dimension),u_zoom:new v.Uniform1f(l,f.u_zoom),u_unpack:new v.Uniform4f(l,f.u_unpack)}},line:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_ratio:new v.Uniform1f(l,f.u_ratio),u_device_pixel_ratio:new v.Uniform1f(l,f.u_device_pixel_ratio),u_units_to_pixels:new v.Uniform2f(l,f.u_units_to_pixels)}},lineGradient:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_ratio:new v.Uniform1f(l,f.u_ratio),u_device_pixel_ratio:new v.Uniform1f(l,f.u_device_pixel_ratio),u_units_to_pixels:new v.Uniform2f(l,f.u_units_to_pixels),u_image:new v.Uniform1i(l,f.u_image),u_image_height:new v.Uniform1f(l,f.u_image_height)}},linePattern:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_texsize:new v.Uniform2f(l,f.u_texsize),u_ratio:new v.Uniform1f(l,f.u_ratio),u_device_pixel_ratio:new v.Uniform1f(l,f.u_device_pixel_ratio),u_image:new v.Uniform1i(l,f.u_image),u_units_to_pixels:new v.Uniform2f(l,f.u_units_to_pixels),u_scale:new v.Uniform3f(l,f.u_scale),u_fade:new v.Uniform1f(l,f.u_fade)}},lineSDF:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_ratio:new v.Uniform1f(l,f.u_ratio),u_device_pixel_ratio:new v.Uniform1f(l,f.u_device_pixel_ratio),u_units_to_pixels:new v.Uniform2f(l,f.u_units_to_pixels),u_patternscale_a:new v.Uniform2f(l,f.u_patternscale_a),u_patternscale_b:new v.Uniform2f(l,f.u_patternscale_b),u_sdfgamma:new v.Uniform1f(l,f.u_sdfgamma),u_image:new v.Uniform1i(l,f.u_image),u_tex_y_a:new v.Uniform1f(l,f.u_tex_y_a),u_tex_y_b:new v.Uniform1f(l,f.u_tex_y_b),u_mix:new v.Uniform1f(l,f.u_mix)}},raster:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_tl_parent:new v.Uniform2f(l,f.u_tl_parent),u_scale_parent:new v.Uniform1f(l,f.u_scale_parent),u_buffer_scale:new v.Uniform1f(l,f.u_buffer_scale),u_fade_t:new v.Uniform1f(l,f.u_fade_t),u_opacity:new v.Uniform1f(l,f.u_opacity),u_image0:new v.Uniform1i(l,f.u_image0),u_image1:new v.Uniform1i(l,f.u_image1),u_brightness_low:new v.Uniform1f(l,f.u_brightness_low),u_brightness_high:new v.Uniform1f(l,f.u_brightness_high),u_saturation_factor:new v.Uniform1f(l,f.u_saturation_factor),u_contrast_factor:new v.Uniform1f(l,f.u_contrast_factor),u_spin_weights:new v.Uniform3f(l,f.u_spin_weights)}},symbolIcon:function(l,f){return{u_is_size_zoom_constant:new v.Uniform1i(l,f.u_is_size_zoom_constant),u_is_size_feature_constant:new v.Uniform1i(l,f.u_is_size_feature_constant),u_size_t:new v.Uniform1f(l,f.u_size_t),u_size:new v.Uniform1f(l,f.u_size),u_camera_to_center_distance:new v.Uniform1f(l,f.u_camera_to_center_distance),u_pitch:new v.Uniform1f(l,f.u_pitch),u_rotate_symbol:new v.Uniform1i(l,f.u_rotate_symbol),u_aspect_ratio:new v.Uniform1f(l,f.u_aspect_ratio),u_fade_change:new v.Uniform1f(l,f.u_fade_change),u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_label_plane_matrix:new v.UniformMatrix4f(l,f.u_label_plane_matrix),u_coord_matrix:new v.UniformMatrix4f(l,f.u_coord_matrix),u_is_text:new v.Uniform1i(l,f.u_is_text),u_pitch_with_map:new v.Uniform1i(l,f.u_pitch_with_map),u_texsize:new v.Uniform2f(l,f.u_texsize),u_texture:new v.Uniform1i(l,f.u_texture)}},symbolSDF:function(l,f){return{u_is_size_zoom_constant:new v.Uniform1i(l,f.u_is_size_zoom_constant),u_is_size_feature_constant:new v.Uniform1i(l,f.u_is_size_feature_constant),u_size_t:new v.Uniform1f(l,f.u_size_t),u_size:new v.Uniform1f(l,f.u_size),u_camera_to_center_distance:new v.Uniform1f(l,f.u_camera_to_center_distance),u_pitch:new v.Uniform1f(l,f.u_pitch),u_rotate_symbol:new v.Uniform1i(l,f.u_rotate_symbol),u_aspect_ratio:new v.Uniform1f(l,f.u_aspect_ratio),u_fade_change:new v.Uniform1f(l,f.u_fade_change),u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_label_plane_matrix:new v.UniformMatrix4f(l,f.u_label_plane_matrix),u_coord_matrix:new v.UniformMatrix4f(l,f.u_coord_matrix),u_is_text:new v.Uniform1i(l,f.u_is_text),u_pitch_with_map:new v.Uniform1i(l,f.u_pitch_with_map),u_texsize:new v.Uniform2f(l,f.u_texsize),u_texture:new v.Uniform1i(l,f.u_texture),u_gamma_scale:new v.Uniform1f(l,f.u_gamma_scale),u_device_pixel_ratio:new v.Uniform1f(l,f.u_device_pixel_ratio),u_is_halo:new v.Uniform1i(l,f.u_is_halo)}},symbolTextAndIcon:function(l,f){return{u_is_size_zoom_constant:new v.Uniform1i(l,f.u_is_size_zoom_constant),u_is_size_feature_constant:new v.Uniform1i(l,f.u_is_size_feature_constant),u_size_t:new v.Uniform1f(l,f.u_size_t),u_size:new v.Uniform1f(l,f.u_size),u_camera_to_center_distance:new v.Uniform1f(l,f.u_camera_to_center_distance),u_pitch:new v.Uniform1f(l,f.u_pitch),u_rotate_symbol:new v.Uniform1i(l,f.u_rotate_symbol),u_aspect_ratio:new v.Uniform1f(l,f.u_aspect_ratio),u_fade_change:new v.Uniform1f(l,f.u_fade_change),u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_label_plane_matrix:new v.UniformMatrix4f(l,f.u_label_plane_matrix),u_coord_matrix:new v.UniformMatrix4f(l,f.u_coord_matrix),u_is_text:new v.Uniform1i(l,f.u_is_text),u_pitch_with_map:new v.Uniform1i(l,f.u_pitch_with_map),u_texsize:new v.Uniform2f(l,f.u_texsize),u_texsize_icon:new v.Uniform2f(l,f.u_texsize_icon),u_texture:new v.Uniform1i(l,f.u_texture),u_texture_icon:new v.Uniform1i(l,f.u_texture_icon),u_gamma_scale:new v.Uniform1f(l,f.u_gamma_scale),u_device_pixel_ratio:new v.Uniform1f(l,f.u_device_pixel_ratio),u_is_halo:new v.Uniform1i(l,f.u_is_halo)}},background:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_opacity:new v.Uniform1f(l,f.u_opacity),u_color:new v.UniformColor(l,f.u_color)}},backgroundPattern:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_opacity:new v.Uniform1f(l,f.u_opacity),u_image:new v.Uniform1i(l,f.u_image),u_pattern_tl_a:new v.Uniform2f(l,f.u_pattern_tl_a),u_pattern_br_a:new v.Uniform2f(l,f.u_pattern_br_a),u_pattern_tl_b:new v.Uniform2f(l,f.u_pattern_tl_b),u_pattern_br_b:new v.Uniform2f(l,f.u_pattern_br_b),u_texsize:new v.Uniform2f(l,f.u_texsize),u_mix:new v.Uniform1f(l,f.u_mix),u_pattern_size_a:new v.Uniform2f(l,f.u_pattern_size_a),u_pattern_size_b:new v.Uniform2f(l,f.u_pattern_size_b),u_scale_a:new v.Uniform1f(l,f.u_scale_a),u_scale_b:new v.Uniform1f(l,f.u_scale_b),u_pixel_coord_upper:new v.Uniform2f(l,f.u_pixel_coord_upper),u_pixel_coord_lower:new v.Uniform2f(l,f.u_pixel_coord_lower),u_tile_units_to_pixels:new v.Uniform1f(l,f.u_tile_units_to_pixels)}}};function Wu(l,f,c,p,b,w,A){for(var R=l.context,U=R.gl,q=l.useProgram("collisionBox"),le=[],fe=0,pe=0,Oe=0;Oe<p.length;Oe++){var Ce=p[Oe],We=f.getTile(Ce),Te=We.getBucket(c);if(Te){var He=Ce.posMatrix;b[0]===0&&b[1]===0||(He=l.translatePosMatrix(Ce.posMatrix,We,b,w));var Qe=A?Te.textCollisionBox:Te.iconCollisionBox,yt=Te.collisionCircleArray;if(yt.length>0){var Vt=v.create(),Nt=He;v.mul(Vt,Te.placementInvProjMatrix,l.transform.glCoordMatrix),v.mul(Vt,Vt,Te.placementViewportMatrix),le.push({circleArray:yt,circleOffset:pe,transform:Nt,invTransform:Vt}),pe=fe+=yt.length/4}Qe&&q.draw(R,U.LINES,me.disabled,Pe.disabled,l.colorModeForRenderPass(),tt.disabled,$o(He,l.transform,We),c.id,Qe.layoutVertexBuffer,Qe.indexBuffer,Qe.segments,null,l.transform.zoom,null,null,Qe.collisionVertexBuffer)}}if(A&&le.length){var Kt=l.useProgram("collisionCircle"),cr=new v.StructArrayLayout2f1f2i16;cr.resize(4*fe),cr._trim();for(var Ir=0,Or=0,tn=le;Or<tn.length;Or+=1)for(var Rn=tn[Or],Fn=0;Fn<Rn.circleArray.length/4;Fn++){var Un=4*Fn,Li=Rn.circleArray[Un+0],Zr=Rn.circleArray[Un+1],ii=Rn.circleArray[Un+2],si=Rn.circleArray[Un+3];cr.emplace(Ir++,Li,Zr,ii,si,0),cr.emplace(Ir++,Li,Zr,ii,si,1),cr.emplace(Ir++,Li,Zr,ii,si,2),cr.emplace(Ir++,Li,Zr,ii,si,3)}(!Zf||Zf.length<2*fe)&&(Zf=function(ha){var Do=2*ha,Fo=new v.StructArrayLayout3ui6;Fo.resize(Do),Fo._trim();for(var Za=0;Za<Do;Za++){var ro=6*Za;Fo.uint16[ro+0]=4*Za+0,Fo.uint16[ro+1]=4*Za+1,Fo.uint16[ro+2]=4*Za+2,Fo.uint16[ro+3]=4*Za+2,Fo.uint16[ro+4]=4*Za+3,Fo.uint16[ro+5]=4*Za+0}return Fo}(fe));for(var Qn=R.createIndexBuffer(Zf,!0),Hn=R.createVertexBuffer(cr,v.collisionCircleLayout.members,!0),mi=0,Kn=le;mi<Kn.length;mi+=1){var Wn=Kn[mi],uo=Rc(Wn.transform,Wn.invTransform,l.transform);Kt.draw(R,U.TRIANGLES,me.disabled,Pe.disabled,l.colorModeForRenderPass(),tt.disabled,uo,c.id,Hn,Qn,v.SegmentVector.simpleSegment(0,2*Wn.circleOffset,Wn.circleArray.length,Wn.circleArray.length/2),null,l.transform.zoom,null,null,null)}Hn.destroy(),Qn.destroy()}}var js=v.identity(new Float32Array(16));function tf(l,f,c,p,b,w){var A=v.getAnchorAlignment(l),R=-(A.horizontalAlign-.5)*f,U=-(A.verticalAlign-.5)*c,q=v.evaluateVariableOffset(l,p);return new v.Point((R/b+q[0])*w,(U/b+q[1])*w)}function rf(l,f,c,p,b,w,A,R,U,q,le){var fe=l.text.placedSymbolArray,pe=l.text.dynamicLayoutVertexArray,Oe=l.icon.dynamicLayoutVertexArray,Ce={};pe.clear();for(var We=0;We<fe.length;We++){var Te=fe.get(We),He=Te.hidden||!Te.crossTileID||l.allowVerticalPlacement&&!Te.placedOrientation?null:p[Te.crossTileID];if(He){var Qe=new v.Point(Te.anchorX,Te.anchorY),yt=Ai(Qe,c?R:A),Vt=Bi(w.cameraToCenterDistance,yt.signedDistanceFromCamera),Nt=b.evaluateSizeForFeature(l.textSizeData,q,Te)*Vt/v.ONE_EM;c&&(Nt*=l.tilePixelRatio/U);for(var Kt=tf(He.anchor,He.width,He.height,He.textOffset,He.textBoxScale,Nt),cr=c?Ai(Qe.add(Kt),A).point:yt.point.add(f?Kt.rotate(-w.angle):Kt),Ir=l.allowVerticalPlacement&&Te.placedOrientation===v.WritingMode.vertical?Math.PI/2:0,Or=0;Or<Te.numGlyphs;Or++)v.addDynamicAttributes(pe,cr,Ir);le&&Te.associatedIconIndex>=0&&(Ce[Te.associatedIconIndex]={shiftedAnchor:cr,angle:Ir})}else Na(Te.numGlyphs,pe)}if(le){Oe.clear();for(var tn=l.icon.placedSymbolArray,Rn=0;Rn<tn.length;Rn++){var Fn=tn.get(Rn);if(Fn.hidden)Na(Fn.numGlyphs,Oe);else{var Un=Ce[Rn];if(Un)for(var Li=0;Li<Fn.numGlyphs;Li++)v.addDynamicAttributes(Oe,Un.shiftedAnchor,Un.angle);else Na(Fn.numGlyphs,Oe)}}l.icon.dynamicLayoutVertexBuffer.updateData(Oe)}l.text.dynamicLayoutVertexBuffer.updateData(pe)}function Vf(l,f,c){return c.iconsInText&&f?"symbolTextAndIcon":l?"symbolSDF":"symbolIcon"}function eu(l,f,c,p,b,w,A,R,U,q,le,fe){for(var pe=l.context,Oe=pe.gl,Ce=l.transform,We=R==="map",Te=U==="map",He=We&&c.layout.get("symbol-placement")!=="point",Qe=We&&!Te&&!He,yt=c.layout.get("symbol-sort-key").constantOr(1)!==void 0,Vt=!1,Nt=l.depthModeForSublayer(0,me.ReadOnly),Kt=c.layout.get("text-variable-anchor"),cr=[],Ir=0,Or=p;Ir<Or.length;Ir+=1){var tn=Or[Ir],Rn=f.getTile(tn),Fn=Rn.getBucket(c);if(Fn){var Un=b?Fn.text:Fn.icon;if(Un&&Un.segments.get().length){var Li=Un.programConfigurations.get(c.id),Zr=b||Fn.sdfIcons,ii=b?Fn.textSizeData:Fn.iconSizeData,si=Te||Ce.pitch!==0,Qn=l.useProgram(Vf(Zr,b,Fn),Li),Hn=v.evaluateSizeForZoom(ii,Ce.zoom),mi=void 0,Kn=[0,0],Wn=void 0,uo=void 0,ha=null,Do=void 0;if(b)Wn=Rn.glyphAtlasTexture,uo=Oe.LINEAR,mi=Rn.glyphAtlasTexture.size,Fn.iconsInText&&(Kn=Rn.imageAtlasTexture.size,ha=Rn.imageAtlasTexture,Do=si||l.options.rotating||l.options.zooming||ii.kind==="composite"||ii.kind==="camera"?Oe.LINEAR:Oe.NEAREST);else{var Fo=c.layout.get("icon-size").constantOr(0)!==1||Fn.iconsNeedLinear;Wn=Rn.imageAtlasTexture,uo=Zr||l.options.rotating||l.options.zooming||Fo||si?Oe.LINEAR:Oe.NEAREST,mi=Rn.imageAtlasTexture.size}var Za=oa(Rn,1,l.transform.zoom),ro=Aa(tn.posMatrix,Te,We,l.transform,Za),bs=Ei(tn.posMatrix,Te,We,l.transform,Za),es=Kt&&Fn.hasTextData(),Du=c.layout.get("icon-text-fit")!=="none"&&es&&Fn.hasIconData();He&&wn(Fn,tn.posMatrix,l,b,ro,bs,Te,q);var os=l.translatePosMatrix(tn.posMatrix,Rn,w,A),au=He||b&&Kt||Du?js:ro,Ns=l.translatePosMatrix(bs,Rn,w,A,!0),dc=Zr&&c.paint.get(b?"text-halo-width":"icon-halo-width").constantOr(1)!==0,zl={program:Qn,buffers:Un,uniformValues:Zr?Fn.iconsInText?ac(ii.kind,Hn,Qe,Te,l,os,au,Ns,mi,Kn):ic(ii.kind,Hn,Qe,Te,l,os,au,Ns,b,mi,!0):kc(ii.kind,Hn,Qe,Te,l,os,au,Ns,b,mi),atlasTexture:Wn,atlasTextureIcon:ha,atlasInterpolation:uo,atlasInterpolationIcon:Do,isSDF:Zr,hasHalo:dc};if(yt&&Fn.canOverlap){Vt=!0;for(var Fu=0,_l=Un.segments.get();Fu<_l.length;Fu+=1){var Ul=_l[Fu];cr.push({segments:new v.SegmentVector([Ul]),sortKey:Ul.sortKey,state:zl})}}else cr.push({segments:Un.segments,sortKey:0,state:zl})}}}Vt&&cr.sort(function(Bu,$u){return Bu.sortKey-$u.sortKey});for(var ou=0,Zl=cr;ou<Zl.length;ou+=1){var mu=Zl[ou],go=mu.state;if(pe.activeTexture.set(Oe.TEXTURE0),go.atlasTexture.bind(go.atlasInterpolation,Oe.CLAMP_TO_EDGE),go.atlasTextureIcon&&(pe.activeTexture.set(Oe.TEXTURE1),go.atlasTextureIcon&&go.atlasTextureIcon.bind(go.atlasInterpolationIcon,Oe.CLAMP_TO_EDGE)),go.isSDF){var Nu=go.uniformValues;go.hasHalo&&(Nu.u_is_halo=1,oc(go.buffers,mu.segments,c,l,go.program,Nt,le,fe,Nu)),Nu.u_is_halo=0}oc(go.buffers,mu.segments,c,l,go.program,Nt,le,fe,go.uniformValues)}}function oc(l,f,c,p,b,w,A,R,U){var q=p.context;b.draw(q,q.gl.TRIANGLES,w,A,R,tt.disabled,U,c.id,l.layoutVertexBuffer,l.indexBuffer,f,c.paint,p.transform.zoom,l.programConfigurations.get(c.id),l.dynamicLayoutVertexBuffer,l.opacityVertexBuffer)}function Dc(l,f,c,p,b,w,A){var R,U,q,le,fe,pe=l.context.gl,Oe=c.paint.get("fill-pattern"),Ce=Oe&&Oe.constantOr(1),We=c.getCrossfadeParameters();A?(U=Ce&&!c.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",R=pe.LINES):(U=Ce?"fillPattern":"fill",R=pe.TRIANGLES);for(var Te=0,He=p;Te<He.length;Te+=1){var Qe=He[Te],yt=f.getTile(Qe);if(!Ce||yt.patternsLoaded()){var Vt=yt.getBucket(c);if(Vt){var Nt=Vt.programConfigurations.get(c.id),Kt=l.useProgram(U,Nt);Ce&&(l.context.activeTexture.set(pe.TEXTURE0),yt.imageAtlasTexture.bind(pe.LINEAR,pe.CLAMP_TO_EDGE),Nt.updatePaintBuffers(We));var cr=Oe.constantOr(null);if(cr&&yt.imageAtlas){var Ir=yt.imageAtlas,Or=Ir.patternPositions[cr.to.toString()],tn=Ir.patternPositions[cr.from.toString()];Or&&tn&&Nt.setConstantPatternPositions(Or,tn)}var Rn=l.translatePosMatrix(Qe.posMatrix,yt,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor"));if(A){le=Vt.indexBuffer2,fe=Vt.segments2;var Fn=[pe.drawingBufferWidth,pe.drawingBufferHeight];q=U==="fillOutlinePattern"&&Ce?Bf(Rn,l,We,yt,Fn):oo(Rn,Fn)}else le=Vt.indexBuffer,fe=Vt.segments,q=Ce?wu(Rn,l,We,yt):Su(Rn);Kt.draw(l.context,R,b,l.stencilModeForClipping(Qe),w,tt.disabled,q,c.id,Vt.layoutVertexBuffer,le,fe,c.paint,l.transform.zoom,Nt)}}}}function nf(l,f,c,p,b,w,A){for(var R=l.context,U=R.gl,q=c.paint.get("fill-extrusion-pattern"),le=q.constantOr(1),fe=c.getCrossfadeParameters(),pe=c.paint.get("fill-extrusion-opacity"),Oe=0,Ce=p;Oe<Ce.length;Oe+=1){var We=Ce[Oe],Te=f.getTile(We),He=Te.getBucket(c);if(He){var Qe=He.programConfigurations.get(c.id),yt=l.useProgram(le?"fillExtrusionPattern":"fillExtrusion",Qe);le&&(l.context.activeTexture.set(U.TEXTURE0),Te.imageAtlasTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),Qe.updatePaintBuffers(fe));var Vt=q.constantOr(null);if(Vt&&Te.imageAtlas){var Nt=Te.imageAtlas,Kt=Nt.patternPositions[Vt.to.toString()],cr=Nt.patternPositions[Vt.from.toString()];Kt&&cr&&Qe.setConstantPatternPositions(Kt,cr)}var Ir=l.translatePosMatrix(We.posMatrix,Te,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),Or=c.paint.get("fill-extrusion-vertical-gradient"),tn=le?Eu(Ir,l,Or,pe,We,fe,Te):Oc(Ir,l,Or,pe);yt.draw(R,R.gl.TRIANGLES,b,w,A,tt.backCCW,tn,c.id,He.layoutVertexBuffer,He.indexBuffer,He.segments,c.paint,l.transform.zoom,Qe)}}}function Ol(l,f,c,p,b,w){var A=l.context,R=A.gl,U=f.fbo;if(U){var q=l.useProgram("hillshade");A.activeTexture.set(R.TEXTURE0),R.bindTexture(R.TEXTURE_2D,U.colorAttachment.get());var le=function(fe,pe,Oe){var Ce=Oe.paint.get("hillshade-shadow-color"),We=Oe.paint.get("hillshade-highlight-color"),Te=Oe.paint.get("hillshade-accent-color"),He=Oe.paint.get("hillshade-illumination-direction")*(Math.PI/180);Oe.paint.get("hillshade-illumination-anchor")==="viewport"&&(He-=fe.transform.angle);var Qe,yt,Vt,Nt=!fe.options.moving;return{u_matrix:fe.transform.calculatePosMatrix(pe.tileID.toUnwrapped(),Nt),u_image:0,u_latrange:(Qe=pe.tileID,yt=Math.pow(2,Qe.canonical.z),Vt=Qe.canonical.y,[new v.MercatorCoordinate(0,Vt/yt).toLngLat().lat,new v.MercatorCoordinate(0,(Vt+1)/yt).toLngLat().lat]),u_light:[Oe.paint.get("hillshade-exaggeration"),He],u_shadow:Ce,u_highlight:We,u_accent:Te}}(l,f,c);q.draw(A,R.TRIANGLES,p,b,w,tt.disabled,le,c.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments)}}function Jh(l,f,c,p,b,w){var A=l.context,R=A.gl,U=f.dem;if(U&&U.data){var q=U.dim,le=U.stride,fe=U.getPixels();if(A.activeTexture.set(R.TEXTURE1),A.pixelStoreUnpackPremultiplyAlpha.set(!1),f.demTexture=f.demTexture||l.getTileTexture(le),f.demTexture){var pe=f.demTexture;pe.update(fe,{premultiply:!1}),pe.bind(R.NEAREST,R.CLAMP_TO_EDGE)}else f.demTexture=new v.Texture(A,fe,R.RGBA,{premultiply:!1}),f.demTexture.bind(R.NEAREST,R.CLAMP_TO_EDGE);A.activeTexture.set(R.TEXTURE0);var Oe=f.fbo;if(!Oe){var Ce=new v.Texture(A,{width:q,height:q,data:null},R.RGBA);Ce.bind(R.LINEAR,R.CLAMP_TO_EDGE),(Oe=f.fbo=A.createFramebuffer(q,q,!0)).colorAttachment.set(Ce.texture)}A.bindFramebuffer.set(Oe.framebuffer),A.viewport.set([0,0,q,q]),l.useProgram("hillshadePrepare").draw(A,R.TRIANGLES,p,b,w,tt.disabled,function(We,Te){var He=Te.stride,Qe=v.create();return v.ortho(Qe,0,v.EXTENT,-v.EXTENT,0,0,1),v.translate(Qe,Qe,[0,-v.EXTENT,0]),{u_matrix:Qe,u_image:1,u_dimension:[He,He],u_zoom:We.overscaledZ,u_unpack:Te.getUnpackVector()}}(f.tileID,U),c.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments),f.needsHillshadePrepare=!1}}function af(l,f,c,p,b){var w=p.paint.get("raster-fade-duration");if(w>0){var A=v.browser.now(),R=(A-l.timeAdded)/w,U=f?(A-f.timeAdded)/w:-1,q=c.getSource(),le=b.coveringZoomLevel({tileSize:q.tileSize,roundZoom:q.roundZoom}),fe=!f||Math.abs(f.tileID.overscaledZ-le)>Math.abs(l.tileID.overscaledZ-le),pe=fe&&l.refreshedUponExpiration?1:v.clamp(fe?R:1-U,0,1);return l.refreshedUponExpiration&&R>=1&&(l.refreshedUponExpiration=!1),f?{opacity:1,mix:1-pe}:{opacity:pe,mix:0}}return{opacity:1,mix:0}}var Rl=new v.Color(1,0,0,1),of=new v.Color(0,1,0,1),sf=new v.Color(0,0,1,1),Ll=new v.Color(1,0,1,1),Fc=new v.Color(0,1,1,1);function _h(l,f,c,p){sc(l,0,f+c/2,l.transform.width,c,p)}function xh(l,f,c,p){sc(l,f-c/2,0,c,l.transform.height,p)}function sc(l,f,c,p,b,w){var A=l.context,R=A.gl;R.enable(R.SCISSOR_TEST),R.scissor(f*v.browser.devicePixelRatio,c*v.browser.devicePixelRatio,p*v.browser.devicePixelRatio,b*v.browser.devicePixelRatio),A.clear({color:w}),R.disable(R.SCISSOR_TEST)}function bh(l,f,c){var p=l.context,b=p.gl,w=c.posMatrix,A=l.useProgram("debug"),R=me.disabled,U=Pe.disabled,q=l.colorModeForRenderPass();p.activeTexture.set(b.TEXTURE0),l.emptyTexture.bind(b.LINEAR,b.CLAMP_TO_EDGE),A.draw(p,b.LINE_STRIP,R,U,q,tt.disabled,Cu(w,v.Color.red),"$debug",l.debugBuffer,l.tileBorderIndexBuffer,l.debugSegments);var le=f.getTileByID(c.key).latestRawTileData,fe=Math.floor((le&&le.byteLength||0)/1024),pe=f.getTile(c).tileSize,Oe=512/Math.min(pe,512)*(c.overscaledZ/l.transform.zoom)*.5,Ce=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(Ce+=" => "+c.overscaledZ),function(We,Te){We.initDebugOverlayCanvas();var He=We.debugOverlayCanvas,Qe=We.context.gl,yt=We.debugOverlayCanvas.getContext("2d");yt.clearRect(0,0,He.width,He.height),yt.shadowColor="white",yt.shadowBlur=2,yt.lineWidth=1.5,yt.strokeStyle="white",yt.textBaseline="top",yt.font="bold 36px Open Sans, sans-serif",yt.fillText(Te,5,5),yt.strokeText(Te,5,5),We.debugOverlayTexture.update(He),We.debugOverlayTexture.bind(Qe.LINEAR,Qe.CLAMP_TO_EDGE)}(l,Ce+" "+fe+"kb"),A.draw(p,b.TRIANGLES,R,U,Ge.alphaBlended,tt.disabled,Cu(w,v.Color.transparent,Oe),"$debug",l.debugBuffer,l.quadTriangleIndexBuffer,l.debugSegments)}var kl={symbol:function(l,f,c,p,b){if(l.renderPass==="translucent"){var w=Pe.disabled,A=l.colorModeForRenderPass();c.layout.get("text-variable-anchor")&&function(R,U,q,le,fe,pe,Oe){for(var Ce=U.transform,We=fe==="map",Te=pe==="map",He=0,Qe=R;He<Qe.length;He+=1){var yt=Qe[He],Vt=le.getTile(yt),Nt=Vt.getBucket(q);if(Nt&&Nt.text&&Nt.text.segments.get().length){var Kt=v.evaluateSizeForZoom(Nt.textSizeData,Ce.zoom),cr=oa(Vt,1,U.transform.zoom),Ir=Aa(yt.posMatrix,Te,We,U.transform,cr),Or=q.layout.get("icon-text-fit")!=="none"&&Nt.hasIconData();if(Kt){var tn=Math.pow(2,Ce.zoom-Vt.tileID.overscaledZ);rf(Nt,We,Te,Oe,v.symbolSize,Ce,Ir,yt.posMatrix,tn,Kt,Or)}}}}(p,l,c,f,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),b),c.paint.get("icon-opacity").constantOr(1)!==0&&eu(l,f,c,p,!1,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),c.layout.get("icon-rotation-alignment"),c.layout.get("icon-pitch-alignment"),c.layout.get("icon-keep-upright"),w,A),c.paint.get("text-opacity").constantOr(1)!==0&&eu(l,f,c,p,!0,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),c.layout.get("text-keep-upright"),w,A),f.map.showCollisionBoxes&&(Wu(l,f,c,p,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),Wu(l,f,c,p,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))}},circle:function(l,f,c,p){if(l.renderPass==="translucent"){var b=c.paint.get("circle-opacity"),w=c.paint.get("circle-stroke-width"),A=c.paint.get("circle-stroke-opacity"),R=c.layout.get("circle-sort-key").constantOr(1)!==void 0;if(b.constantOr(1)!==0||w.constantOr(1)!==0&&A.constantOr(1)!==0){for(var U=l.context,q=U.gl,le=l.depthModeForSublayer(0,me.ReadOnly),fe=Pe.disabled,pe=l.colorModeForRenderPass(),Oe=[],Ce=0;Ce<p.length;Ce++){var We=p[Ce],Te=f.getTile(We),He=Te.getBucket(c);if(He){var Qe=He.programConfigurations.get(c.id),yt={programConfiguration:Qe,program:l.useProgram("circle",Qe),layoutVertexBuffer:He.layoutVertexBuffer,indexBuffer:He.indexBuffer,uniformValues:zf(l,We,Te,c)};if(R)for(var Vt=0,Nt=He.segments.get();Vt<Nt.length;Vt+=1){var Kt=Nt[Vt];Oe.push({segments:new v.SegmentVector([Kt]),sortKey:Kt.sortKey,state:yt})}else Oe.push({segments:He.segments,sortKey:0,state:yt})}}R&&Oe.sort(function(Rn,Fn){return Rn.sortKey-Fn.sortKey});for(var cr=0,Ir=Oe;cr<Ir.length;cr+=1){var Or=Ir[cr],tn=Or.state;tn.program.draw(U,q.TRIANGLES,le,fe,pe,tt.disabled,tn.uniformValues,c.id,tn.layoutVertexBuffer,tn.indexBuffer,Or.segments,c.paint,l.transform.zoom,tn.programConfiguration)}}}},heatmap:function(l,f,c,p){if(c.paint.get("heatmap-opacity")!==0)if(l.renderPass==="offscreen"){var b=l.context,w=b.gl,A=Pe.disabled,R=new Ge([w.ONE,w.ONE],v.Color.transparent,[!0,!0,!0,!0]);(function(Oe,Ce,We){var Te=Oe.gl;Oe.activeTexture.set(Te.TEXTURE1),Oe.viewport.set([0,0,Ce.width/4,Ce.height/4]);var He=We.heatmapFbo;if(He)Te.bindTexture(Te.TEXTURE_2D,He.colorAttachment.get()),Oe.bindFramebuffer.set(He.framebuffer);else{var Qe=Te.createTexture();Te.bindTexture(Te.TEXTURE_2D,Qe),Te.texParameteri(Te.TEXTURE_2D,Te.TEXTURE_WRAP_S,Te.CLAMP_TO_EDGE),Te.texParameteri(Te.TEXTURE_2D,Te.TEXTURE_WRAP_T,Te.CLAMP_TO_EDGE),Te.texParameteri(Te.TEXTURE_2D,Te.TEXTURE_MIN_FILTER,Te.LINEAR),Te.texParameteri(Te.TEXTURE_2D,Te.TEXTURE_MAG_FILTER,Te.LINEAR),He=We.heatmapFbo=Oe.createFramebuffer(Ce.width/4,Ce.height/4,!1),function(yt,Vt,Nt,Kt){var cr=yt.gl;cr.texImage2D(cr.TEXTURE_2D,0,cr.RGBA,Vt.width/4,Vt.height/4,0,cr.RGBA,yt.extRenderToTextureHalfFloat?yt.extTextureHalfFloat.HALF_FLOAT_OES:cr.UNSIGNED_BYTE,null),Kt.colorAttachment.set(Nt)}(Oe,Ce,Qe,He)}})(b,l,c),b.clear({color:v.Color.transparent});for(var U=0;U<p.length;U++){var q=p[U];if(!f.hasRenderableParent(q)){var le=f.getTile(q),fe=le.getBucket(c);if(fe){var pe=fe.programConfigurations.get(c.id);l.useProgram("heatmap",pe).draw(b,w.TRIANGLES,me.disabled,A,R,tt.disabled,ef(q.posMatrix,le,l.transform.zoom,c.paint.get("heatmap-intensity")),c.id,fe.layoutVertexBuffer,fe.indexBuffer,fe.segments,c.paint,l.transform.zoom,pe)}}}b.viewport.set([0,0,l.width,l.height])}else l.renderPass==="translucent"&&(l.context.setColorMode(l.colorModeForRenderPass()),function(Oe,Ce){var We=Oe.context,Te=We.gl,He=Ce.heatmapFbo;if(He){We.activeTexture.set(Te.TEXTURE0),Te.bindTexture(Te.TEXTURE_2D,He.colorAttachment.get()),We.activeTexture.set(Te.TEXTURE1);var Qe=Ce.colorRampTexture;Qe||(Qe=Ce.colorRampTexture=new v.Texture(We,Ce.colorRamp,Te.RGBA)),Qe.bind(Te.LINEAR,Te.CLAMP_TO_EDGE),Oe.useProgram("heatmapTexture").draw(We,Te.TRIANGLES,me.disabled,Pe.disabled,Oe.colorModeForRenderPass(),tt.disabled,function(yt,Vt,Nt,Kt){var cr=v.create();v.ortho(cr,0,yt.width,yt.height,0,0,1);var Ir=yt.context.gl;return{u_matrix:cr,u_world:[Ir.drawingBufferWidth,Ir.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:Vt.paint.get("heatmap-opacity")}}(Oe,Ce),Ce.id,Oe.viewportBuffer,Oe.quadTriangleIndexBuffer,Oe.viewportSegments,Ce.paint,Oe.transform.zoom)}}(l,c))},line:function(l,f,c,p){if(l.renderPass==="translucent"){var b=c.paint.get("line-opacity"),w=c.paint.get("line-width");if(b.constantOr(1)!==0&&w.constantOr(1)!==0)for(var A=l.depthModeForSublayer(0,me.ReadOnly),R=l.colorModeForRenderPass(),U=c.paint.get("line-dasharray"),q=c.paint.get("line-pattern"),le=q.constantOr(1),fe=c.paint.get("line-gradient"),pe=c.getCrossfadeParameters(),Oe=le?"linePattern":U?"lineSDF":fe?"lineGradient":"line",Ce=l.context,We=Ce.gl,Te=!0,He=0,Qe=p;He<Qe.length;He+=1){var yt=Qe[He],Vt=f.getTile(yt);if(!le||Vt.patternsLoaded()){var Nt=Vt.getBucket(c);if(Nt){var Kt=Nt.programConfigurations.get(c.id),cr=l.context.program.get(),Ir=l.useProgram(Oe,Kt),Or=Te||Ir.program!==cr,tn=q.constantOr(null);if(tn&&Vt.imageAtlas){var Rn=Vt.imageAtlas,Fn=Rn.patternPositions[tn.to.toString()],Un=Rn.patternPositions[tn.from.toString()];Fn&&Un&&Kt.setConstantPatternPositions(Fn,Un)}var Li=le?Ml(l,Vt,c,pe):U?gh(l,Vt,c,U,pe):fe?Di(l,Vt,c,Nt.lineClipsArray.length):Al(l,Vt,c);if(le)Ce.activeTexture.set(We.TEXTURE0),Vt.imageAtlasTexture.bind(We.LINEAR,We.CLAMP_TO_EDGE),Kt.updatePaintBuffers(pe);else if(U&&(Or||l.lineAtlas.dirty))Ce.activeTexture.set(We.TEXTURE0),l.lineAtlas.bind(Ce);else if(fe){var Zr=Nt.gradients[c.id],ii=Zr.texture;if(c.gradientVersion!==Zr.version){var si=256;if(c.stepInterpolant){var Qn=f.getSource().maxzoom,Hn=yt.canonical.z===Qn?Math.ceil(1<<l.transform.maxZoom-yt.canonical.z):1;si=v.clamp(v.nextPowerOfTwo(Nt.maxLineLength/v.EXTENT*1024*Hn),256,Ce.maxTextureSize)}Zr.gradient=v.renderColorRamp({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:si,image:Zr.gradient||void 0,clips:Nt.lineClipsArray}),Zr.texture?Zr.texture.update(Zr.gradient):Zr.texture=new v.Texture(Ce,Zr.gradient,We.RGBA),Zr.version=c.gradientVersion,ii=Zr.texture}Ce.activeTexture.set(We.TEXTURE0),ii.bind(c.stepInterpolant?We.NEAREST:We.LINEAR,We.CLAMP_TO_EDGE)}Ir.draw(Ce,We.TRIANGLES,A,l.stencilModeForClipping(yt),R,tt.disabled,Li,c.id,Nt.layoutVertexBuffer,Nt.indexBuffer,Nt.segments,c.paint,l.transform.zoom,Kt,Nt.layoutVertexBuffer2),Te=!1}}}}},fill:function(l,f,c,p){var b=c.paint.get("fill-color"),w=c.paint.get("fill-opacity");if(w.constantOr(1)!==0){var A=l.colorModeForRenderPass(),R=c.paint.get("fill-pattern"),U=l.opaquePassEnabledForLayer()&&!R.constantOr(1)&&b.constantOr(v.Color.transparent).a===1&&w.constantOr(0)===1?"opaque":"translucent";if(l.renderPass===U){var q=l.depthModeForSublayer(1,l.renderPass==="opaque"?me.ReadWrite:me.ReadOnly);Dc(l,f,c,p,q,A,!1)}if(l.renderPass==="translucent"&&c.paint.get("fill-antialias")){var le=l.depthModeForSublayer(c.getPaintProperty("fill-outline-color")?2:0,me.ReadOnly);Dc(l,f,c,p,le,A,!0)}}},"fill-extrusion":function(l,f,c,p){var b=c.paint.get("fill-extrusion-opacity");if(b!==0&&l.renderPass==="translucent"){var w=new me(l.context.gl.LEQUAL,me.ReadWrite,l.depthRangeFor3D);if(b!==1||c.paint.get("fill-extrusion-pattern").constantOr(1))nf(l,f,c,p,w,Pe.disabled,Ge.disabled),nf(l,f,c,p,w,l.stencilModeFor3D(),l.colorModeForRenderPass());else{var A=l.colorModeForRenderPass();nf(l,f,c,p,w,Pe.disabled,A)}}},hillshade:function(l,f,c,p){if(l.renderPass==="offscreen"||l.renderPass==="translucent"){for(var b=l.context,w=l.depthModeForSublayer(0,me.ReadOnly),A=l.colorModeForRenderPass(),R=l.renderPass==="translucent"?l.stencilConfigForOverlap(p):[{},p],U=R[0],q=0,le=R[1];q<le.length;q+=1){var fe=le[q],pe=f.getTile(fe);pe.needsHillshadePrepare&&l.renderPass==="offscreen"?Jh(l,pe,c,w,Pe.disabled,A):l.renderPass==="translucent"&&Ol(l,pe,c,w,U[fe.overscaledZ],A)}b.viewport.set([0,0,l.width,l.height])}},raster:function(l,f,c,p){if(l.renderPass==="translucent"&&c.paint.get("raster-opacity")!==0&&p.length)for(var b=l.context,w=b.gl,A=f.getSource(),R=l.useProgram("raster"),U=l.colorModeForRenderPass(),q=A instanceof gt?[{},p]:l.stencilConfigForOverlap(p),le=q[0],fe=q[1],pe=fe[fe.length-1].overscaledZ,Oe=!l.options.moving,Ce=0,We=fe;Ce<We.length;Ce+=1){var Te=We[Ce],He=l.depthModeForSublayer(Te.overscaledZ-pe,c.paint.get("raster-opacity")===1?me.ReadWrite:me.ReadOnly,w.LESS),Qe=f.getTile(Te),yt=l.transform.calculatePosMatrix(Te.toUnwrapped(),Oe);Qe.registerFadeDuration(c.paint.get("raster-fade-duration"));var Vt=f.findLoadedParent(Te,0),Nt=af(Qe,Vt,f,c,l.transform),Kt=void 0,cr=void 0,Ir=c.paint.get("raster-resampling")==="nearest"?w.NEAREST:w.LINEAR;b.activeTexture.set(w.TEXTURE0),Qe.texture.bind(Ir,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST),b.activeTexture.set(w.TEXTURE1),Vt?(Vt.texture.bind(Ir,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST),Kt=Math.pow(2,Vt.tileID.overscaledZ-Qe.tileID.overscaledZ),cr=[Qe.tileID.canonical.x*Kt%1,Qe.tileID.canonical.y*Kt%1]):Qe.texture.bind(Ir,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST);var Or=Uf(yt,cr||[0,0],Kt||1,Nt,c);A instanceof gt?R.draw(b,w.TRIANGLES,He,Pe.disabled,U,tt.disabled,Or,c.id,A.boundsBuffer,l.quadTriangleIndexBuffer,A.boundsSegments):R.draw(b,w.TRIANGLES,He,le[Te.overscaledZ],U,tt.disabled,Or,c.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments)}},background:function(l,f,c){var p=c.paint.get("background-color"),b=c.paint.get("background-opacity");if(b!==0){var w=l.context,A=w.gl,R=l.transform,U=R.tileSize,q=c.paint.get("background-pattern");if(!l.isPatternMissing(q)){var le=!q&&p.a===1&&b===1&&l.opaquePassEnabledForLayer()?"opaque":"translucent";if(l.renderPass===le){var fe=Pe.disabled,pe=l.depthModeForSublayer(0,le==="opaque"?me.ReadWrite:me.ReadOnly),Oe=l.colorModeForRenderPass(),Ce=l.useProgram(q?"backgroundPattern":"background"),We=R.coveringTiles({tileSize:U});q&&(w.activeTexture.set(A.TEXTURE0),l.imageManager.bind(l.context));for(var Te=c.getCrossfadeParameters(),He=0,Qe=We;He<Qe.length;He+=1){var yt=Qe[He],Vt=l.transform.calculatePosMatrix(yt.toUnwrapped()),Nt=q?fl(Vt,b,l,q,{tileID:yt,tileSize:U},Te):Pl(Vt,b,p);Ce.draw(w,A.TRIANGLES,pe,fe,Oe,tt.disabled,Nt,c.id,l.tileExtentBuffer,l.quadTriangleIndexBuffer,l.tileExtentSegments)}}}}},debug:function(l,f,c){for(var p=0;p<c.length;p++)bh(l,f,c[p])},custom:function(l,f,c){var p=l.context,b=c.implementation;if(l.renderPass==="offscreen"){var w=b.prerender;w&&(l.setCustomLayerDefaults(),p.setColorMode(l.colorModeForRenderPass()),w.call(b,p.gl,l.transform.customLayerMatrix()),p.setDirty(),l.setBaseState())}else if(l.renderPass==="translucent"){l.setCustomLayerDefaults(),p.setColorMode(l.colorModeForRenderPass()),p.setStencilMode(Pe.disabled);var A=b.renderingMode==="3d"?new me(l.context.gl.LEQUAL,me.ReadWrite,l.depthRangeFor3D):l.depthModeForSublayer(0,me.ReadOnly);p.setDepthMode(A),b.render(p.gl,l.transform.customLayerMatrix()),p.setDirty(),l.setBaseState(),p.bindFramebuffer.set(null)}}},$i=function(l,f){this.context=new ce(l),this.transform=f,this._tileTextures={},this.setup(),this.numSublayers=Re.maxUnderzooming+Re.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new So,this.gpuTimers={}};$i.prototype.resize=function(l,f){if(this.width=l*v.browser.devicePixelRatio,this.height=f*v.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var c=0,p=this.style._order;c<p.length;c+=1)this.style._layers[p[c]].resize()},$i.prototype.setup=function(){var l=this.context,f=new v.StructArrayLayout2i4;f.emplaceBack(0,0),f.emplaceBack(v.EXTENT,0),f.emplaceBack(0,v.EXTENT),f.emplaceBack(v.EXTENT,v.EXTENT),this.tileExtentBuffer=l.createVertexBuffer(f,ga.members),this.tileExtentSegments=v.SegmentVector.simpleSegment(0,0,4,2);var c=new v.StructArrayLayout2i4;c.emplaceBack(0,0),c.emplaceBack(v.EXTENT,0),c.emplaceBack(0,v.EXTENT),c.emplaceBack(v.EXTENT,v.EXTENT),this.debugBuffer=l.createVertexBuffer(c,ga.members),this.debugSegments=v.SegmentVector.simpleSegment(0,0,4,5);var p=new v.StructArrayLayout4i8;p.emplaceBack(0,0,0,0),p.emplaceBack(v.EXTENT,0,v.EXTENT,0),p.emplaceBack(0,v.EXTENT,0,v.EXTENT),p.emplaceBack(v.EXTENT,v.EXTENT,v.EXTENT,v.EXTENT),this.rasterBoundsBuffer=l.createVertexBuffer(p,Et.members),this.rasterBoundsSegments=v.SegmentVector.simpleSegment(0,0,4,2);var b=new v.StructArrayLayout2i4;b.emplaceBack(0,0),b.emplaceBack(1,0),b.emplaceBack(0,1),b.emplaceBack(1,1),this.viewportBuffer=l.createVertexBuffer(b,ga.members),this.viewportSegments=v.SegmentVector.simpleSegment(0,0,4,2);var w=new v.StructArrayLayout1ui2;w.emplaceBack(0),w.emplaceBack(1),w.emplaceBack(3),w.emplaceBack(2),w.emplaceBack(0),this.tileBorderIndexBuffer=l.createIndexBuffer(w);var A=new v.StructArrayLayout3ui6;A.emplaceBack(0,1,2),A.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=l.createIndexBuffer(A),this.emptyTexture=new v.Texture(l,{width:1,height:1,data:new Uint8Array([0,0,0,0])},l.gl.RGBA);var R=this.context.gl;this.stencilClearMode=new Pe({func:R.ALWAYS,mask:0},0,255,R.ZERO,R.ZERO,R.ZERO)},$i.prototype.clearStencil=function(){var l=this.context,f=l.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var c=v.create();v.ortho(c,0,this.width,this.height,0,0,1),v.scale(c,c,[f.drawingBufferWidth,f.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(l,f.TRIANGLES,me.disabled,this.stencilClearMode,Ge.disabled,tt.disabled,Qs(c),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},$i.prototype._renderTileClippingMasks=function(l,f){if(this.currentStencilSource!==l.source&&l.isTileClipped()&&f&&f.length){this.currentStencilSource=l.source;var c=this.context,p=c.gl;this.nextStencilID+f.length>256&&this.clearStencil(),c.setColorMode(Ge.disabled),c.setDepthMode(me.disabled);var b=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var w=0,A=f;w<A.length;w+=1){var R=A[w],U=this._tileClippingMaskIDs[R.key]=this.nextStencilID++;b.draw(c,p.TRIANGLES,me.disabled,new Pe({func:p.ALWAYS,mask:0},U,255,p.KEEP,p.KEEP,p.REPLACE),Ge.disabled,tt.disabled,Qs(R.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},$i.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var l=this.nextStencilID++,f=this.context.gl;return new Pe({func:f.NOTEQUAL,mask:255},l,255,f.KEEP,f.KEEP,f.REPLACE)},$i.prototype.stencilModeForClipping=function(l){var f=this.context.gl;return new Pe({func:f.EQUAL,mask:255},this._tileClippingMaskIDs[l.key],0,f.KEEP,f.KEEP,f.REPLACE)},$i.prototype.stencilConfigForOverlap=function(l){var f,c=this.context.gl,p=l.sort(function(U,q){return q.overscaledZ-U.overscaledZ}),b=p[p.length-1].overscaledZ,w=p[0].overscaledZ-b+1;if(w>1){this.currentStencilSource=void 0,this.nextStencilID+w>256&&this.clearStencil();for(var A={},R=0;R<w;R++)A[R+b]=new Pe({func:c.GEQUAL,mask:255},R+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=w,[A,p]}return[(f={},f[b]=Pe.disabled,f),p]},$i.prototype.colorModeForRenderPass=function(){var l=this.context.gl;return this._showOverdrawInspector?new Ge([l.CONSTANT_COLOR,l.ONE],new v.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Ge.unblended:Ge.alphaBlended},$i.prototype.depthModeForSublayer=function(l,f,c){if(!this.opaquePassEnabledForLayer())return me.disabled;var p=1-((1+this.currentLayer)*this.numSublayers+l)*this.depthEpsilon;return new me(c||this.context.gl.LEQUAL,f,[p,p])},$i.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},$i.prototype.render=function(l,f){var c=this;this.style=l,this.options=f,this.lineAtlas=l.lineAtlas,this.imageManager=l.imageManager,this.glyphManager=l.glyphManager,this.symbolFadeChange=l.placement.symbolFadeChange(v.browser.now()),this.imageManager.beginFrame();var p=this.style._order,b=this.style.sourceCaches;for(var w in b){var A=b[w];A.used&&A.prepare(this.context)}var R,U,q={},le={},fe={};for(var pe in b){var Oe=b[pe];q[pe]=Oe.getVisibleCoordinates(),le[pe]=q[pe].slice().reverse(),fe[pe]=Oe.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var Ce=0;Ce<p.length;Ce++)if(this.style._layers[p[Ce]].is3D()){this.opaquePassCutoff=Ce;break}this.renderPass="offscreen";for(var We=0,Te=p;We<Te.length;We+=1){var He=this.style._layers[Te[We]];if(He.hasOffscreenPass()&&!He.isHidden(this.transform.zoom)){var Qe=le[He.source];(He.type==="custom"||Qe.length)&&this.renderLayer(this,b[He.source],He,Qe)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:f.showOverdrawInspector?v.Color.black:v.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=f.showOverdrawInspector,this.depthRangeFor3D=[0,1-(l._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=p.length-1;this.currentLayer>=0;this.currentLayer--){var yt=this.style._layers[p[this.currentLayer]],Vt=b[yt.source],Nt=q[yt.source];this._renderTileClippingMasks(yt,Nt),this.renderLayer(this,Vt,yt,Nt)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<p.length;this.currentLayer++){var Kt=this.style._layers[p[this.currentLayer]],cr=b[Kt.source],Ir=(Kt.type==="symbol"?fe:le)[Kt.source];this._renderTileClippingMasks(Kt,q[Kt.source]),this.renderLayer(this,cr,Kt,Ir)}this.options.showTileBoundaries&&(v.values(this.style._layers).forEach(function(Or){Or.source&&!Or.isHidden(c.transform.zoom)&&(Or.source!==(U&&U.id)&&(U=c.style.sourceCaches[Or.source]),(!R||R.getSource().maxzoom<U.getSource().maxzoom)&&(R=U))}),R&&kl.debug(this,R,R.getVisibleCoordinates())),this.options.showPadding&&function(Or){var tn=Or.transform.padding;_h(Or,Or.transform.height-(tn.top||0),3,Rl),_h(Or,tn.bottom||0,3,of),xh(Or,tn.left||0,3,sf),xh(Or,Or.transform.width-(tn.right||0),3,Ll);var Rn=Or.transform.centerPoint;(function(Fn,Un,Li,Zr){sc(Fn,Un-1,Li-10,2,20,Zr),sc(Fn,Un-10,Li-1,20,2,Zr)})(Or,Rn.x,Or.transform.height-Rn.y,Fc)}(this),this.context.setDefault()},$i.prototype.renderLayer=function(l,f,c,p){c.isHidden(this.transform.zoom)||(c.type==="background"||c.type==="custom"||p.length)&&(this.id=c.id,this.gpuTimingStart(c),kl[c.type](l,f,c,p,this.style.placement.variableOffsets),this.gpuTimingEnd())},$i.prototype.gpuTimingStart=function(l){if(this.options.gpuTiming){var f=this.context.extTimerQuery,c=this.gpuTimers[l.id];c||(c=this.gpuTimers[l.id]={calls:0,cpuTime:0,query:f.createQueryEXT()}),c.calls++,f.beginQueryEXT(f.TIME_ELAPSED_EXT,c.query)}},$i.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var l=this.context.extTimerQuery;l.endQueryEXT(l.TIME_ELAPSED_EXT)}},$i.prototype.collectGpuTimers=function(){var l=this.gpuTimers;return this.gpuTimers={},l},$i.prototype.queryGpuTimers=function(l){var f={};for(var c in l){var p=l[c],b=this.context.extTimerQuery,w=b.getQueryObjectEXT(p.query,b.QUERY_RESULT_EXT)/1e6;b.deleteQueryEXT(p.query),f[c]=w}return f},$i.prototype.translatePosMatrix=function(l,f,c,p,b){if(!c[0]&&!c[1])return l;var w=b?p==="map"?this.transform.angle:0:p==="viewport"?-this.transform.angle:0;if(w){var A=Math.sin(w),R=Math.cos(w);c=[c[0]*R-c[1]*A,c[0]*A+c[1]*R]}var U=[b?c[0]:oa(f,c[0],this.transform.zoom),b?c[1]:oa(f,c[1],this.transform.zoom),0],q=new Float32Array(16);return v.translate(q,l,U),q},$i.prototype.saveTileTexture=function(l){var f=this._tileTextures[l.size[0]];f?f.push(l):this._tileTextures[l.size[0]]=[l]},$i.prototype.getTileTexture=function(l){var f=this._tileTextures[l];return f&&f.length>0?f.pop():null},$i.prototype.isPatternMissing=function(l){if(!l)return!1;if(!l.from||!l.to)return!0;var f=this.imageManager.getPattern(l.from.toString()),c=this.imageManager.getPattern(l.to.toString());return!f||!c},$i.prototype.useProgram=function(l,f){this.cache=this.cache||{};var c=""+l+(f?f.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[c]||(this.cache[c]=new Qc(this.context,l,gs[l],f,Il[l],this._showOverdrawInspector)),this.cache[c]},$i.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},$i.prototype.setBaseState=function(){var l=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(l.FUNC_ADD)},$i.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=v.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new v.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},$i.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var uc=function(l,f){this.points=l,this.planes=f};uc.fromInvProjectionMatrix=function(l,f,c){var p=Math.pow(2,c),b=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(A){return v.transformMat4([],A,l)}).map(function(A){return v.scale$1([],A,1/A[3]/f*p)}),w=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(A){var R=v.sub([],b[A[0]],b[A[1]]),U=v.sub([],b[A[2]],b[A[1]]),q=v.normalize([],v.cross([],R,U)),le=-v.dot(q,b[A[1]]);return q.concat(le)});return new uc(b,w)};var fa=function(l,f){this.min=l,this.max=f,this.center=v.scale$2([],v.add([],this.min,this.max),.5)};fa.prototype.quadrant=function(l){for(var f=[l%2==0,l<2],c=v.clone$2(this.min),p=v.clone$2(this.max),b=0;b<f.length;b++)c[b]=f[b]?this.min[b]:this.center[b],p[b]=f[b]?this.center[b]:this.max[b];return p[2]=this.max[2],new fa(c,p)},fa.prototype.distanceX=function(l){return Math.max(Math.min(this.max[0],l[0]),this.min[0])-l[0]},fa.prototype.distanceY=function(l){return Math.max(Math.min(this.max[1],l[1]),this.min[1])-l[1]},fa.prototype.intersects=function(l){for(var f=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],c=!0,p=0;p<l.planes.length;p++){for(var b=l.planes[p],w=0,A=0;A<f.length;A++)w+=v.dot$1(b,f[A])>=0;if(w===0)return 0;w!==f.length&&(c=!1)}if(c)return 2;for(var R=0;R<3;R++){for(var U=Number.MAX_VALUE,q=-Number.MAX_VALUE,le=0;le<l.points.length;le++){var fe=l.points[le][R]-this.min[R];U=Math.min(U,fe),q=Math.max(q,fe)}if(q<0||U>this.max[R]-this.min[R])return 0}return 1};var Tu=function(l,f,c,p){if(l===void 0&&(l=0),f===void 0&&(f=0),c===void 0&&(c=0),p===void 0&&(p=0),isNaN(l)||l<0||isNaN(f)||f<0||isNaN(c)||c<0||isNaN(p)||p<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=l,this.bottom=f,this.left=c,this.right=p};Tu.prototype.interpolate=function(l,f,c){return f.top!=null&&l.top!=null&&(this.top=v.number(l.top,f.top,c)),f.bottom!=null&&l.bottom!=null&&(this.bottom=v.number(l.bottom,f.bottom,c)),f.left!=null&&l.left!=null&&(this.left=v.number(l.left,f.left,c)),f.right!=null&&l.right!=null&&(this.right=v.number(l.right,f.right,c)),this},Tu.prototype.getCenter=function(l,f){var c=v.clamp((this.left+l-this.right)/2,0,l),p=v.clamp((this.top+f-this.bottom)/2,0,f);return new v.Point(c,p)},Tu.prototype.equals=function(l){return this.top===l.top&&this.bottom===l.bottom&&this.left===l.left&&this.right===l.right},Tu.prototype.clone=function(){return new Tu(this.top,this.bottom,this.left,this.right)},Tu.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var Yi=function(l,f,c,p,b){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=b===void 0||b,this._minZoom=l||0,this._maxZoom=f||22,this._minPitch=c==null?0:c,this._maxPitch=p==null?60:p,this.setMaxBounds(),this.width=0,this.height=0,this._center=new v.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Tu,this._posMatrixCache={},this._alignedPosMatrixCache={}},Pa={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};Yi.prototype.clone=function(){var l=new Yi(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return l.tileSize=this.tileSize,l.latRange=this.latRange,l.width=this.width,l.height=this.height,l._center=this._center,l.zoom=this.zoom,l.angle=this.angle,l._fov=this._fov,l._pitch=this._pitch,l._unmodified=this._unmodified,l._edgeInsets=this._edgeInsets.clone(),l._calcMatrices(),l},Pa.minZoom.get=function(){return this._minZoom},Pa.minZoom.set=function(l){this._minZoom!==l&&(this._minZoom=l,this.zoom=Math.max(this.zoom,l))},Pa.maxZoom.get=function(){return this._maxZoom},Pa.maxZoom.set=function(l){this._maxZoom!==l&&(this._maxZoom=l,this.zoom=Math.min(this.zoom,l))},Pa.minPitch.get=function(){return this._minPitch},Pa.minPitch.set=function(l){this._minPitch!==l&&(this._minPitch=l,this.pitch=Math.max(this.pitch,l))},Pa.maxPitch.get=function(){return this._maxPitch},Pa.maxPitch.set=function(l){this._maxPitch!==l&&(this._maxPitch=l,this.pitch=Math.min(this.pitch,l))},Pa.renderWorldCopies.get=function(){return this._renderWorldCopies},Pa.renderWorldCopies.set=function(l){l===void 0?l=!0:l===null&&(l=!1),this._renderWorldCopies=l},Pa.worldSize.get=function(){return this.tileSize*this.scale},Pa.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},Pa.size.get=function(){return new v.Point(this.width,this.height)},Pa.bearing.get=function(){return-this.angle/Math.PI*180},Pa.bearing.set=function(l){var f=-v.wrap(l,-180,180)*Math.PI/180;this.angle!==f&&(this._unmodified=!1,this.angle=f,this._calcMatrices(),this.rotationMatrix=v.create$2(),v.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},Pa.pitch.get=function(){return this._pitch/Math.PI*180},Pa.pitch.set=function(l){var f=v.clamp(l,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==f&&(this._unmodified=!1,this._pitch=f,this._calcMatrices())},Pa.fov.get=function(){return this._fov/Math.PI*180},Pa.fov.set=function(l){l=Math.max(.01,Math.min(60,l)),this._fov!==l&&(this._unmodified=!1,this._fov=l/180*Math.PI,this._calcMatrices())},Pa.zoom.get=function(){return this._zoom},Pa.zoom.set=function(l){var f=Math.min(Math.max(l,this.minZoom),this.maxZoom);this._zoom!==f&&(this._unmodified=!1,this._zoom=f,this.scale=this.zoomScale(f),this.tileZoom=Math.floor(f),this.zoomFraction=f-this.tileZoom,this._constrain(),this._calcMatrices())},Pa.center.get=function(){return this._center},Pa.center.set=function(l){l.lat===this._center.lat&&l.lng===this._center.lng||(this._unmodified=!1,this._center=l,this._constrain(),this._calcMatrices())},Pa.padding.get=function(){return this._edgeInsets.toJSON()},Pa.padding.set=function(l){this._edgeInsets.equals(l)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,l,1),this._calcMatrices())},Pa.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},Yi.prototype.isPaddingEqual=function(l){return this._edgeInsets.equals(l)},Yi.prototype.interpolatePadding=function(l,f,c){this._unmodified=!1,this._edgeInsets.interpolate(l,f,c),this._constrain(),this._calcMatrices()},Yi.prototype.coveringZoomLevel=function(l){var f=(l.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/l.tileSize));return Math.max(0,f)},Yi.prototype.getVisibleUnwrappedCoordinates=function(l){var f=[new v.UnwrappedTileID(0,l)];if(this._renderWorldCopies)for(var c=this.pointCoordinate(new v.Point(0,0)),p=this.pointCoordinate(new v.Point(this.width,0)),b=this.pointCoordinate(new v.Point(this.width,this.height)),w=this.pointCoordinate(new v.Point(0,this.height)),A=Math.floor(Math.min(c.x,p.x,b.x,w.x)),R=Math.floor(Math.max(c.x,p.x,b.x,w.x)),U=A-1;U<=R+1;U++)U!==0&&f.push(new v.UnwrappedTileID(U,l));return f},Yi.prototype.coveringTiles=function(l){var f=this.coveringZoomLevel(l),c=f;if(l.minzoom!==void 0&&f<l.minzoom)return[];l.maxzoom!==void 0&&f>l.maxzoom&&(f=l.maxzoom);var p=v.MercatorCoordinate.fromLngLat(this.center),b=Math.pow(2,f),w=[b*p.x,b*p.y,0],A=uc.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,f),R=l.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(R=f);var U=function(Or){return{aabb:new fa([Or*b,0,0],[(Or+1)*b,b,0]),zoom:0,x:0,y:0,wrap:Or,fullyVisible:!1}},q=[],le=[],fe=f,pe=l.reparseOverscaled?c:f;if(this._renderWorldCopies)for(var Oe=1;Oe<=3;Oe++)q.push(U(-Oe)),q.push(U(Oe));for(q.push(U(0));q.length>0;){var Ce=q.pop(),We=Ce.x,Te=Ce.y,He=Ce.fullyVisible;if(!He){var Qe=Ce.aabb.intersects(A);if(Qe===0)continue;He=Qe===2}var yt=Ce.aabb.distanceX(w),Vt=Ce.aabb.distanceY(w),Nt=Math.max(Math.abs(yt),Math.abs(Vt));if(Ce.zoom===fe||Nt>3+(1<<fe-Ce.zoom)-2&&Ce.zoom>=R)le.push({tileID:new v.OverscaledTileID(Ce.zoom===fe?pe:Ce.zoom,Ce.wrap,Ce.zoom,We,Te),distanceSq:v.sqrLen([w[0]-.5-We,w[1]-.5-Te])});else for(var Kt=0;Kt<4;Kt++){var cr=(We<<1)+Kt%2,Ir=(Te<<1)+(Kt>>1);q.push({aabb:Ce.aabb.quadrant(Kt),zoom:Ce.zoom+1,x:cr,y:Ir,wrap:Ce.wrap,fullyVisible:He})}}return le.sort(function(Or,tn){return Or.distanceSq-tn.distanceSq}).map(function(Or){return Or.tileID})},Yi.prototype.resize=function(l,f){this.width=l,this.height=f,this.pixelsToGLUnits=[2/l,-2/f],this._constrain(),this._calcMatrices()},Pa.unmodified.get=function(){return this._unmodified},Yi.prototype.zoomScale=function(l){return Math.pow(2,l)},Yi.prototype.scaleZoom=function(l){return Math.log(l)/Math.LN2},Yi.prototype.project=function(l){var f=v.clamp(l.lat,-this.maxValidLatitude,this.maxValidLatitude);return new v.Point(v.mercatorXfromLng(l.lng)*this.worldSize,v.mercatorYfromLat(f)*this.worldSize)},Yi.prototype.unproject=function(l){return new v.MercatorCoordinate(l.x/this.worldSize,l.y/this.worldSize).toLngLat()},Pa.point.get=function(){return this.project(this.center)},Yi.prototype.setLocationAtPoint=function(l,f){var c=this.pointCoordinate(f),p=this.pointCoordinate(this.centerPoint),b=this.locationCoordinate(l),w=new v.MercatorCoordinate(b.x-(c.x-p.x),b.y-(c.y-p.y));this.center=this.coordinateLocation(w),this._renderWorldCopies&&(this.center=this.center.wrap())},Yi.prototype.locationPoint=function(l){return this.coordinatePoint(this.locationCoordinate(l))},Yi.prototype.pointLocation=function(l){return this.coordinateLocation(this.pointCoordinate(l))},Yi.prototype.locationCoordinate=function(l){return v.MercatorCoordinate.fromLngLat(l)},Yi.prototype.coordinateLocation=function(l){return l.toLngLat()},Yi.prototype.pointCoordinate=function(l){var f=[l.x,l.y,0,1],c=[l.x,l.y,1,1];v.transformMat4(f,f,this.pixelMatrixInverse),v.transformMat4(c,c,this.pixelMatrixInverse);var p=f[3],b=c[3],w=f[1]/p,A=c[1]/b,R=f[2]/p,U=c[2]/b,q=R===U?0:(0-R)/(U-R);return new v.MercatorCoordinate(v.number(f[0]/p,c[0]/b,q)/this.worldSize,v.number(w,A,q)/this.worldSize)},Yi.prototype.coordinatePoint=function(l){var f=[l.x*this.worldSize,l.y*this.worldSize,0,1];return v.transformMat4(f,f,this.pixelMatrix),new v.Point(f[0]/f[3],f[1]/f[3])},Yi.prototype.getBounds=function(){return new v.LngLatBounds().extend(this.pointLocation(new v.Point(0,0))).extend(this.pointLocation(new v.Point(this.width,0))).extend(this.pointLocation(new v.Point(this.width,this.height))).extend(this.pointLocation(new v.Point(0,this.height)))},Yi.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new v.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},Yi.prototype.setMaxBounds=function(l){l?(this.lngRange=[l.getWest(),l.getEast()],this.latRange=[l.getSouth(),l.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},Yi.prototype.calculatePosMatrix=function(l,f){f===void 0&&(f=!1);var c=l.key,p=f?this._alignedPosMatrixCache:this._posMatrixCache;if(p[c])return p[c];var b=l.canonical,w=this.worldSize/this.zoomScale(b.z),A=b.x+Math.pow(2,b.z)*l.wrap,R=v.identity(new Float64Array(16));return v.translate(R,R,[A*w,b.y*w,0]),v.scale(R,R,[w/v.EXTENT,w/v.EXTENT,1]),v.multiply(R,f?this.alignedProjMatrix:this.projMatrix,R),p[c]=new Float32Array(R),p[c]},Yi.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},Yi.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var l,f,c,p,b=-90,w=90,A=-180,R=180,U=this.size,q=this._unmodified;if(this.latRange){var le=this.latRange;b=v.mercatorYfromLat(le[1])*this.worldSize,l=(w=v.mercatorYfromLat(le[0])*this.worldSize)-b<U.y?U.y/(w-b):0}if(this.lngRange){var fe=this.lngRange;A=v.mercatorXfromLng(fe[0])*this.worldSize,f=(R=v.mercatorXfromLng(fe[1])*this.worldSize)-A<U.x?U.x/(R-A):0}var pe=this.point,Oe=Math.max(f||0,l||0);if(Oe)return this.center=this.unproject(new v.Point(f?(R+A)/2:pe.x,l?(w+b)/2:pe.y)),this.zoom+=this.scaleZoom(Oe),this._unmodified=q,void(this._constraining=!1);if(this.latRange){var Ce=pe.y,We=U.y/2;Ce-We<b&&(p=b+We),Ce+We>w&&(p=w-We)}if(this.lngRange){var Te=pe.x,He=U.x/2;Te-He<A&&(c=A+He),Te+He>R&&(c=R-He)}c===void 0&&p===void 0||(this.center=this.unproject(new v.Point(c!==void 0?c:pe.x,p!==void 0?p:pe.y))),this._unmodified=q,this._constraining=!1}},Yi.prototype._calcMatrices=function(){if(this.height){var l=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var f=Math.PI/2+this._pitch,c=this._fov*(.5+l.y/this.height),p=Math.sin(c)*this.cameraToCenterDistance/Math.sin(v.clamp(Math.PI-f-c,.01,Math.PI-.01)),b=this.point,w=b.x,A=b.y,R=1.01*(Math.cos(Math.PI/2-this._pitch)*p+this.cameraToCenterDistance),U=this.height/50,q=new Float64Array(16);v.perspective(q,this._fov,this.width/this.height,U,R),q[8]=2*-l.x/this.width,q[9]=2*l.y/this.height,v.scale(q,q,[1,-1,1]),v.translate(q,q,[0,0,-this.cameraToCenterDistance]),v.rotateX(q,q,this._pitch),v.rotateZ(q,q,this.angle),v.translate(q,q,[-w,-A,0]),this.mercatorMatrix=v.scale([],q,[this.worldSize,this.worldSize,this.worldSize]),v.scale(q,q,[1,1,v.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=q,this.invProjMatrix=v.invert([],this.projMatrix);var le=this.width%2/2,fe=this.height%2/2,pe=Math.cos(this.angle),Oe=Math.sin(this.angle),Ce=w-Math.round(w)+pe*le+Oe*fe,We=A-Math.round(A)+pe*fe+Oe*le,Te=new Float64Array(q);if(v.translate(Te,Te,[Ce>.5?Ce-1:Ce,We>.5?We-1:We,0]),this.alignedProjMatrix=Te,q=v.create(),v.scale(q,q,[this.width/2,-this.height/2,1]),v.translate(q,q,[1,-1,0]),this.labelPlaneMatrix=q,q=v.create(),v.scale(q,q,[1,-1,1]),v.translate(q,q,[-1,-1,0]),v.scale(q,q,[2/this.width,2/this.height,1]),this.glCoordMatrix=q,this.pixelMatrix=v.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(q=v.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=q,this._posMatrixCache={},this._alignedPosMatrixCache={}}},Yi.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var l=this.pointCoordinate(new v.Point(0,0)),f=[l.x*this.worldSize,l.y*this.worldSize,0,1];return v.transformMat4(f,f,this.pixelMatrix)[3]/this.cameraToCenterDistance},Yi.prototype.getCameraPoint=function(){var l=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new v.Point(0,l))},Yi.prototype.getCameraQueryGeometry=function(l){var f=this.getCameraPoint();if(l.length===1)return[l[0],f];for(var c=f.x,p=f.y,b=f.x,w=f.y,A=0,R=l;A<R.length;A+=1){var U=R[A];c=Math.min(c,U.x),p=Math.min(p,U.y),b=Math.max(b,U.x),w=Math.max(w,U.y)}return[new v.Point(c,p),new v.Point(b,p),new v.Point(b,w),new v.Point(c,w),new v.Point(c,p)]},Object.defineProperties(Yi.prototype,Pa);var ys=function(l){var f,c,p,b;this._hashName=l&&encodeURIComponent(l),v.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(f=this._updateHashUnthrottled.bind(this),c=!1,p=null,b=function(){p=null,c&&(f(),p=setTimeout(b,300),c=!1)},function(){return c=!0,p||b(),p})};ys.prototype.addTo=function(l){return this._map=l,v.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},ys.prototype.remove=function(){return v.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},ys.prototype.getHashString=function(l){var f=this._map.getCenter(),c=Math.round(100*this._map.getZoom())/100,p=Math.ceil((c*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,p),w=Math.round(f.lng*b)/b,A=Math.round(f.lat*b)/b,R=this._map.getBearing(),U=this._map.getPitch(),q="";if(q+=l?"/"+w+"/"+A+"/"+c:c+"/"+A+"/"+w,(R||U)&&(q+="/"+Math.round(10*R)/10),U&&(q+="/"+Math.round(U)),this._hashName){var le=this._hashName,fe=!1,pe=v.window.location.hash.slice(1).split("&").map(function(Oe){var Ce=Oe.split("=")[0];return Ce===le?(fe=!0,Ce+"="+q):Oe}).filter(function(Oe){return Oe});return fe||pe.push(le+"="+q),"#"+pe.join("&")}return"#"+q},ys.prototype._getCurrentHash=function(){var l,f=this,c=v.window.location.hash.replace("#","");return this._hashName?(c.split("&").map(function(p){return p.split("=")}).forEach(function(p){p[0]===f._hashName&&(l=p)}),(l&&l[1]||"").split("/")):c.split("/")},ys.prototype._onHashChange=function(){var l=this._getCurrentHash();if(l.length>=3&&!l.some(function(c){return isNaN(c)})){var f=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(l[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+l[2],+l[1]],zoom:+l[0],bearing:f,pitch:+(l[4]||0)}),!0}return!1},ys.prototype._updateHashUnthrottled=function(){var l=v.window.location.href.replace(/(#.+)?$/,this.getHashString());try{v.window.history.replaceState(v.window.history.state,null,l)}catch(f){}};var Nc={linearity:.3,easing:v.bezier(0,0,.3,1)},Xu=v.extend({deceleration:2500,maxSpeed:1400},Nc),za=v.extend({deceleration:20,maxSpeed:1400},Nc),lc=v.extend({deceleration:1e3,maxSpeed:360},Nc),Dl=v.extend({deceleration:1e3,maxSpeed:90},Nc),Yu=function(l){this._map=l,this.clear()};function Bc(l,f){(!l.duration||l.duration<f.duration)&&(l.duration=f.duration,l.easing=f.easing)}function Au(l,f,c){var p=c.maxSpeed,b=c.linearity,w=c.deceleration,A=v.clamp(l*b/(f/1e3),-p,p),R=Math.abs(A)/(w*b);return{easing:c.easing,duration:1e3*R,amount:A*(R/2)}}Yu.prototype.clear=function(){this._inertiaBuffer=[]},Yu.prototype.record=function(l){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:v.browser.now(),settings:l})},Yu.prototype._drainInertiaBuffer=function(){for(var l=this._inertiaBuffer,f=v.browser.now();l.length>0&&f-l[0].time>160;)l.shift()},Yu.prototype._onMoveEnd=function(l){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var f={zoom:0,bearing:0,pitch:0,pan:new v.Point(0,0),pinchAround:void 0,around:void 0},c=0,p=this._inertiaBuffer;c<p.length;c+=1){var b=p[c].settings;f.zoom+=b.zoomDelta||0,f.bearing+=b.bearingDelta||0,f.pitch+=b.pitchDelta||0,b.panDelta&&f.pan._add(b.panDelta),b.around&&(f.around=b.around),b.pinchAround&&(f.pinchAround=b.pinchAround)}var w=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,A={};if(f.pan.mag()){var R=Au(f.pan.mag(),w,v.extend({},Xu,l||{}));A.offset=f.pan.mult(R.amount/f.pan.mag()),A.center=this._map.transform.center,Bc(A,R)}if(f.zoom){var U=Au(f.zoom,w,za);A.zoom=this._map.transform.zoom+U.amount,Bc(A,U)}if(f.bearing){var q=Au(f.bearing,w,lc);A.bearing=this._map.transform.bearing+v.clamp(q.amount,-179,179),Bc(A,q)}if(f.pitch){var le=Au(f.pitch,w,Dl);A.pitch=this._map.transform.pitch+le.amount,Bc(A,le)}if(A.zoom||A.bearing){var fe=f.pinchAround===void 0?f.around:f.pinchAround;A.around=fe?this._map.unproject(fe):this._map.getCenter()}return this.clear(),v.extend(A,{noMoveStart:!0})}};var fo=function(l){function f(p,b,w,A){A===void 0&&(A={});var R=F.mousePos(b.getCanvasContainer(),w),U=b.unproject(R);l.call(this,p,v.extend({point:R,lngLat:U,originalEvent:w},A)),this._defaultPrevented=!1,this.target=b}l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f;var c={defaultPrevented:{configurable:!0}};return f.prototype.preventDefault=function(){this._defaultPrevented=!0},c.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(f.prototype,c),f}(v.Event),Fl=function(l){function f(p,b,w){var A=p==="touchend"?w.changedTouches:w.touches,R=F.touchPos(b.getCanvasContainer(),A),U=R.map(function(fe){return b.unproject(fe)}),q=R.reduce(function(fe,pe,Oe,Ce){return fe.add(pe.div(Ce.length))},new v.Point(0,0)),le=b.unproject(q);l.call(this,p,{points:R,point:q,lngLats:U,lngLat:le,originalEvent:w}),this._defaultPrevented=!1}l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f;var c={defaultPrevented:{configurable:!0}};return f.prototype.preventDefault=function(){this._defaultPrevented=!0},c.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(f.prototype,c),f}(v.Event),cc=function(l){function f(p,b,w){l.call(this,p,{originalEvent:w}),this._defaultPrevented=!1}l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f;var c={defaultPrevented:{configurable:!0}};return f.prototype.preventDefault=function(){this._defaultPrevented=!0},c.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(f.prototype,c),f}(v.Event),ho=function(l,f){this._map=l,this._clickTolerance=f.clickTolerance};ho.prototype.reset=function(){delete this._mousedownPos},ho.prototype.wheel=function(l){return this._firePreventable(new cc(l.type,this._map,l))},ho.prototype.mousedown=function(l,f){return this._mousedownPos=f,this._firePreventable(new fo(l.type,this._map,l))},ho.prototype.mouseup=function(l){this._map.fire(new fo(l.type,this._map,l))},ho.prototype.click=function(l,f){this._mousedownPos&&this._mousedownPos.dist(f)>=this._clickTolerance||this._map.fire(new fo(l.type,this._map,l))},ho.prototype.dblclick=function(l){return this._firePreventable(new fo(l.type,this._map,l))},ho.prototype.mouseover=function(l){this._map.fire(new fo(l.type,this._map,l))},ho.prototype.mouseout=function(l){this._map.fire(new fo(l.type,this._map,l))},ho.prototype.touchstart=function(l){return this._firePreventable(new Fl(l.type,this._map,l))},ho.prototype.touchmove=function(l){this._map.fire(new Fl(l.type,this._map,l))},ho.prototype.touchend=function(l){this._map.fire(new Fl(l.type,this._map,l))},ho.prototype.touchcancel=function(l){this._map.fire(new Fl(l.type,this._map,l))},ho.prototype._firePreventable=function(l){if(this._map.fire(l),l.defaultPrevented)return{}},ho.prototype.isEnabled=function(){return!0},ho.prototype.isActive=function(){return!1},ho.prototype.enable=function(){},ho.prototype.disable=function(){};var pn=function(l){this._map=l};pn.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},pn.prototype.mousemove=function(l){this._map.fire(new fo(l.type,this._map,l))},pn.prototype.mousedown=function(){this._delayContextMenu=!0},pn.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new fo("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},pn.prototype.contextmenu=function(l){this._delayContextMenu?this._contextMenuEvent=l:this._map.fire(new fo(l.type,this._map,l)),this._map.listens("contextmenu")&&l.preventDefault()},pn.prototype.isEnabled=function(){return!0},pn.prototype.isActive=function(){return!1},pn.prototype.enable=function(){},pn.prototype.disable=function(){};var so=function(l,f){this._map=l,this._el=l.getCanvasContainer(),this._container=l.getContainer(),this._clickTolerance=f.clickTolerance||1};function qu(l,f){for(var c={},p=0;p<l.length;p++)c[l[p].identifier]=f[p];return c}so.prototype.isEnabled=function(){return!!this._enabled},so.prototype.isActive=function(){return!!this._active},so.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},so.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},so.prototype.mousedown=function(l,f){this.isEnabled()&&l.shiftKey&&l.button===0&&(F.disableDrag(),this._startPos=this._lastPos=f,this._active=!0)},so.prototype.mousemoveWindow=function(l,f){if(this._active){var c=f;if(!(this._lastPos.equals(c)||!this._box&&c.dist(this._startPos)<this._clickTolerance)){var p=this._startPos;this._lastPos=c,this._box||(this._box=F.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",l));var b=Math.min(p.x,c.x),w=Math.max(p.x,c.x),A=Math.min(p.y,c.y),R=Math.max(p.y,c.y);F.setTransform(this._box,"translate("+b+"px,"+A+"px)"),this._box.style.width=w-b+"px",this._box.style.height=R-A+"px"}}},so.prototype.mouseupWindow=function(l,f){var c=this;if(this._active&&l.button===0){var p=this._startPos,b=f;if(this.reset(),F.suppressClick(),p.x!==b.x||p.y!==b.y)return this._map.fire(new v.Event("boxzoomend",{originalEvent:l})),{cameraAnimation:function(w){return w.fitScreenCoordinates(p,b,c._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",l)}},so.prototype.keydown=function(l){this._active&&l.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",l))},so.prototype.blur=function(){this.reset()},so.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(F.remove(this._box),this._box=null),F.enableDrag(),delete this._startPos,delete this._lastPos},so.prototype._fireEvent=function(l,f){return this._map.fire(new v.Event(l,{originalEvent:f}))};var ka=function(l){this.reset(),this.numTouches=l.numTouches};ka.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},ka.prototype.touchstart=function(l,f,c){(this.centroid||c.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=l.timeStamp),c.length===this.numTouches&&(this.centroid=function(p){for(var b=new v.Point(0,0),w=0,A=p;w<A.length;w+=1)b._add(A[w]);return b.div(p.length)}(f),this.touches=qu(c,f)))},ka.prototype.touchmove=function(l,f,c){if(!this.aborted&&this.centroid){var p=qu(c,f);for(var b in this.touches){var w=p[b];(!w||w.dist(this.touches[b])>30)&&(this.aborted=!0)}}},ka.prototype.touchend=function(l,f,c){if((!this.centroid||l.timeStamp-this.startTime>500)&&(this.aborted=!0),c.length===0){var p=!this.aborted&&this.centroid;if(this.reset(),p)return p}};var Gs=function(l){this.singleTap=new ka(l),this.numTaps=l.numTaps,this.reset()};Gs.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},Gs.prototype.touchstart=function(l,f,c){this.singleTap.touchstart(l,f,c)},Gs.prototype.touchmove=function(l,f,c){this.singleTap.touchmove(l,f,c)},Gs.prototype.touchend=function(l,f,c){var p=this.singleTap.touchend(l,f,c);if(p){var b=l.timeStamp-this.lastTime<500,w=!this.lastTap||this.lastTap.dist(p)<30;if(b&&w||this.reset(),this.count++,this.lastTime=l.timeStamp,this.lastTap=p,this.count===this.numTaps)return this.reset(),p}};var Os=function(){this._zoomIn=new Gs({numTouches:1,numTaps:2}),this._zoomOut=new Gs({numTouches:2,numTaps:1}),this.reset()};Os.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},Os.prototype.touchstart=function(l,f,c){this._zoomIn.touchstart(l,f,c),this._zoomOut.touchstart(l,f,c)},Os.prototype.touchmove=function(l,f,c){this._zoomIn.touchmove(l,f,c),this._zoomOut.touchmove(l,f,c)},Os.prototype.touchend=function(l,f,c){var p=this,b=this._zoomIn.touchend(l,f,c),w=this._zoomOut.touchend(l,f,c);return b?(this._active=!0,l.preventDefault(),setTimeout(function(){return p.reset()},0),{cameraAnimation:function(A){return A.easeTo({duration:300,zoom:A.getZoom()+1,around:A.unproject(b)},{originalEvent:l})}}):w?(this._active=!0,l.preventDefault(),setTimeout(function(){return p.reset()},0),{cameraAnimation:function(A){return A.easeTo({duration:300,zoom:A.getZoom()-1,around:A.unproject(w)},{originalEvent:l})}}):void 0},Os.prototype.touchcancel=function(){this.reset()},Os.prototype.enable=function(){this._enabled=!0},Os.prototype.disable=function(){this._enabled=!1,this.reset()},Os.prototype.isEnabled=function(){return this._enabled},Os.prototype.isActive=function(){return this._active};var uf={0:1,2:2},zr=function(l){this.reset(),this._clickTolerance=l.clickTolerance||1};zr.prototype.blur=function(){this.reset()},zr.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},zr.prototype._correctButton=function(l,f){return!1},zr.prototype._move=function(l,f){return{}},zr.prototype.mousedown=function(l,f){if(!this._lastPoint){var c=F.mouseButton(l);this._correctButton(l,c)&&(this._lastPoint=f,this._eventButton=c)}},zr.prototype.mousemoveWindow=function(l,f){var c=this._lastPoint;if(c){if(l.preventDefault(),function(p,b){var w=uf[b];return p.buttons===void 0||(p.buttons&w)!==w}(l,this._eventButton))this.reset();else if(this._moved||!(f.dist(c)<this._clickTolerance))return this._moved=!0,this._lastPoint=f,this._move(c,f)}},zr.prototype.mouseupWindow=function(l){this._lastPoint&&F.mouseButton(l)===this._eventButton&&(this._moved&&F.suppressClick(),this.reset())},zr.prototype.enable=function(){this._enabled=!0},zr.prototype.disable=function(){this._enabled=!1,this.reset()},zr.prototype.isEnabled=function(){return this._enabled},zr.prototype.isActive=function(){return this._active};var fc=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.mousedown=function(c,p){l.prototype.mousedown.call(this,c,p),this._lastPoint&&(this._active=!0)},f.prototype._correctButton=function(c,p){return p===0&&!c.ctrlKey},f.prototype._move=function(c,p){return{around:p,panDelta:p.sub(c)}},f}(zr),lf=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype._correctButton=function(c,p){return p===0&&c.ctrlKey||p===2},f.prototype._move=function(c,p){var b=.8*(p.x-c.x);if(b)return this._active=!0,{bearingDelta:b}},f.prototype.contextmenu=function(c){c.preventDefault()},f}(zr),hl=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype._correctButton=function(c,p){return p===0&&c.ctrlKey||p===2},f.prototype._move=function(c,p){var b=-.5*(p.y-c.y);if(b)return this._active=!0,{pitchDelta:b}},f.prototype.contextmenu=function(c){c.preventDefault()},f}(zr),Ca=function(l){this._minTouches=1,this._clickTolerance=l.clickTolerance||1,this.reset()};Ca.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new v.Point(0,0)},Ca.prototype.touchstart=function(l,f,c){return this._calculateTransform(l,f,c)},Ca.prototype.touchmove=function(l,f,c){if(this._active&&!(c.length<this._minTouches))return l.preventDefault(),this._calculateTransform(l,f,c)},Ca.prototype.touchend=function(l,f,c){this._calculateTransform(l,f,c),this._active&&c.length<this._minTouches&&this.reset()},Ca.prototype.touchcancel=function(){this.reset()},Ca.prototype._calculateTransform=function(l,f,c){c.length>0&&(this._active=!0);var p=qu(c,f),b=new v.Point(0,0),w=new v.Point(0,0),A=0;for(var R in p){var U=p[R],q=this._touches[R];q&&(b._add(U),w._add(U.sub(q)),A++,p[R]=U)}if(this._touches=p,!(A<this._minTouches)&&w.mag()){var le=w.div(A);if(this._sum._add(le),!(this._sum.mag()<this._clickTolerance))return{around:b.div(A),panDelta:le}}},Ca.prototype.enable=function(){this._enabled=!0},Ca.prototype.disable=function(){this._enabled=!1,this.reset()},Ca.prototype.isEnabled=function(){return this._enabled},Ca.prototype.isActive=function(){return this._active};var _s=function(){this.reset()};function cf(l,f,c){for(var p=0;p<l.length;p++)if(l[p].identifier===c)return f[p]}function Mu(l,f){return Math.log(l/f)/Math.LN2}_s.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},_s.prototype._start=function(l){},_s.prototype._move=function(l,f,c){return{}},_s.prototype.touchstart=function(l,f,c){this._firstTwoTouches||c.length<2||(this._firstTwoTouches=[c[0].identifier,c[1].identifier],this._start([f[0],f[1]]))},_s.prototype.touchmove=function(l,f,c){if(this._firstTwoTouches){l.preventDefault();var p=this._firstTwoTouches,b=p[1],w=cf(c,f,p[0]),A=cf(c,f,b);if(w&&A){var R=this._aroundCenter?null:w.add(A).div(2);return this._move([w,A],R,l)}}},_s.prototype.touchend=function(l,f,c){if(this._firstTwoTouches){var p=this._firstTwoTouches,b=p[1],w=cf(c,f,p[0]),A=cf(c,f,b);w&&A||(this._active&&F.suppressClick(),this.reset())}},_s.prototype.touchcancel=function(){this.reset()},_s.prototype.enable=function(l){this._enabled=!0,this._aroundCenter=!!l&&l.around==="center"},_s.prototype.disable=function(){this._enabled=!1,this.reset()},_s.prototype.isEnabled=function(){return this._enabled},_s.prototype.isActive=function(){return this._active};var Ds=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.reset=function(){l.prototype.reset.call(this),delete this._distance,delete this._startDistance},f.prototype._start=function(c){this._startDistance=this._distance=c[0].dist(c[1])},f.prototype._move=function(c,p){var b=this._distance;if(this._distance=c[0].dist(c[1]),this._active||!(Math.abs(Mu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Mu(this._distance,b),pinchAround:p}},f}(_s);function Pu(l,f){return 180*l.angleWith(f)/Math.PI}var jf=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.reset=function(){l.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},f.prototype._start=function(c){this._startVector=this._vector=c[0].sub(c[1]),this._minDiameter=c[0].dist(c[1])},f.prototype._move=function(c,p){var b=this._vector;if(this._vector=c[0].sub(c[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Pu(this._vector,b),pinchAround:p}},f.prototype._isBelowThreshold=function(c){this._minDiameter=Math.min(this._minDiameter,c.mag());var p=25/(Math.PI*this._minDiameter)*360,b=Pu(c,this._startVector);return Math.abs(b)<p},f}(_s);function pl(l){return Math.abs(l.y)>Math.abs(l.x)}var Gf=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.reset=function(){l.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},f.prototype._start=function(c){this._lastPoints=c,pl(c[0].sub(c[1]))&&(this._valid=!1)},f.prototype._move=function(c,p,b){var w=c[0].sub(this._lastPoints[0]),A=c[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(w,A,b.timeStamp),this._valid)return this._lastPoints=c,this._active=!0,{pitchDelta:(w.y+A.y)/2*-.5}},f.prototype.gestureBeginsVertically=function(c,p,b){if(this._valid!==void 0)return this._valid;var w=c.mag()>=2,A=p.mag()>=2;if(w||A){if(!w||!A)return this._firstMove===void 0&&(this._firstMove=b),b-this._firstMove<100&&void 0;var R=c.y>0==p.y>0;return pl(c)&&pl(p)&&R}},f}(_s),ff={panStep:100,bearingStep:15,pitchStep:10},tu=function(){var l=ff;this._panStep=l.panStep,this._bearingStep=l.bearingStep,this._pitchStep=l.pitchStep,this._rotationDisabled=!1};function Rs(l){return l*(2-l)}tu.prototype.blur=function(){this.reset()},tu.prototype.reset=function(){this._active=!1},tu.prototype.keydown=function(l){var f=this;if(!(l.altKey||l.ctrlKey||l.metaKey)){var c=0,p=0,b=0,w=0,A=0;switch(l.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:l.shiftKey?p=-1:(l.preventDefault(),w=-1);break;case 39:l.shiftKey?p=1:(l.preventDefault(),w=1);break;case 38:l.shiftKey?b=1:(l.preventDefault(),A=-1);break;case 40:l.shiftKey?b=-1:(l.preventDefault(),A=1);break;default:return}return this._rotationDisabled&&(p=0,b=0),{cameraAnimation:function(R){var U=R.getZoom();R.easeTo({duration:300,easeId:"keyboardHandler",easing:Rs,zoom:c?Math.round(U)+c*(l.shiftKey?2:1):U,bearing:R.getBearing()+p*f._bearingStep,pitch:R.getPitch()+b*f._pitchStep,offset:[-w*f._panStep,-A*f._panStep],center:R.getCenter()},{originalEvent:l})}}}},tu.prototype.enable=function(){this._enabled=!0},tu.prototype.disable=function(){this._enabled=!1,this.reset()},tu.prototype.isEnabled=function(){return this._enabled},tu.prototype.isActive=function(){return this._active},tu.prototype.disableRotation=function(){this._rotationDisabled=!0},tu.prototype.enableRotation=function(){this._rotationDisabled=!1};var Si=function(l,f){this._map=l,this._el=l.getCanvasContainer(),this._handler=f,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,v.bindAll(["_onTimeout"],this)};Si.prototype.setZoomRate=function(l){this._defaultZoomRate=l},Si.prototype.setWheelZoomRate=function(l){this._wheelZoomRate=l},Si.prototype.isEnabled=function(){return!!this._enabled},Si.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},Si.prototype.isZooming=function(){return!!this._zooming},Si.prototype.enable=function(l){this.isEnabled()||(this._enabled=!0,this._aroundCenter=l&&l.around==="center")},Si.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Si.prototype.wheel=function(l){if(this.isEnabled()){var f=l.deltaMode===v.window.WheelEvent.DOM_DELTA_LINE?40*l.deltaY:l.deltaY,c=v.browser.now(),p=c-(this._lastWheelEventTime||0);this._lastWheelEventTime=c,f!==0&&f%4.000244140625==0?this._type="wheel":f!==0&&Math.abs(f)<4?this._type="trackpad":p>400?(this._type=null,this._lastValue=f,this._timeout=setTimeout(this._onTimeout,40,l)):this._type||(this._type=Math.abs(p*f)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,f+=this._lastValue)),l.shiftKey&&f&&(f/=4),this._type&&(this._lastWheelEvent=l,this._delta-=f,this._active||this._start(l)),l.preventDefault()}},Si.prototype._onTimeout=function(l){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)},Si.prototype._start=function(l){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var f=F.mousePos(this._el,l);this._around=v.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(f)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},Si.prototype.renderFrame=function(){var l=this;if(this._frameId&&(this._frameId=null,this.isActive())){var f=this._map.transform;if(this._delta!==0){var c=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,p=2/(1+Math.exp(-Math.abs(this._delta*c)));this._delta<0&&p!==0&&(p=1/p);var b=typeof this._targetZoom=="number"?f.zoomScale(this._targetZoom):f.scale;this._targetZoom=Math.min(f.maxZoom,Math.max(f.minZoom,f.scaleZoom(b*p))),this._type==="wheel"&&(this._startZoom=f.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var w,A=typeof this._targetZoom=="number"?this._targetZoom:f.zoom,R=this._startZoom,U=this._easing,q=!1;if(this._type==="wheel"&&R&&U){var le=Math.min((v.browser.now()-this._lastWheelEventTime)/200,1),fe=U(le);w=v.number(R,A,fe),le<1?this._frameId||(this._frameId=!0):q=!0}else w=A,q=!0;return this._active=!0,q&&(this._active=!1,this._finishTimeout=setTimeout(function(){l._zooming=!1,l._handler._triggerRenderFrame(),delete l._targetZoom,delete l._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!q,zoomDelta:w-f.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},Si.prototype._smoothOutEasing=function(l){var f=v.ease;if(this._prevEase){var c=this._prevEase,p=(v.browser.now()-c.start)/c.duration,b=c.easing(p+.01)-c.easing(p),w=.27/Math.sqrt(b*b+1e-4)*.01,A=Math.sqrt(.0729-w*w);f=v.bezier(w,A,.25,1)}return this._prevEase={start:v.browser.now(),duration:l,easing:f},f},Si.prototype.blur=function(){this.reset()},Si.prototype.reset=function(){this._active=!1};var Iu=function(l,f){this._clickZoom=l,this._tapZoom=f};Iu.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},Iu.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},Iu.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},Iu.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var ru=function(){this.reset()};ru.prototype.reset=function(){this._active=!1},ru.prototype.blur=function(){this.reset()},ru.prototype.dblclick=function(l,f){return l.preventDefault(),{cameraAnimation:function(c){c.easeTo({duration:300,zoom:c.getZoom()+(l.shiftKey?-1:1),around:c.unproject(f)},{originalEvent:l})}}},ru.prototype.enable=function(){this._enabled=!0},ru.prototype.disable=function(){this._enabled=!1,this.reset()},ru.prototype.isEnabled=function(){return this._enabled},ru.prototype.isActive=function(){return this._active};var Go=function(){this._tap=new Gs({numTouches:1,numTaps:1}),this.reset()};Go.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},Go.prototype.touchstart=function(l,f,c){this._swipePoint||(this._tapTime&&l.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?c.length>0&&(this._swipePoint=f[0],this._swipeTouch=c[0].identifier):this._tap.touchstart(l,f,c))},Go.prototype.touchmove=function(l,f,c){if(this._tapTime){if(this._swipePoint){if(c[0].identifier!==this._swipeTouch)return;var p=f[0],b=p.y-this._swipePoint.y;return this._swipePoint=p,l.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(l,f,c)},Go.prototype.touchend=function(l,f,c){this._tapTime?this._swipePoint&&c.length===0&&this.reset():this._tap.touchend(l,f,c)&&(this._tapTime=l.timeStamp)},Go.prototype.touchcancel=function(){this.reset()},Go.prototype.enable=function(){this._enabled=!0},Go.prototype.disable=function(){this._enabled=!1,this.reset()},Go.prototype.isEnabled=function(){return this._enabled},Go.prototype.isActive=function(){return this._active};var dl=function(l,f,c){this._el=l,this._mousePan=f,this._touchPan=c};dl.prototype.enable=function(l){this._inertiaOptions=l||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},dl.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},dl.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},dl.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var Fs=function(l,f,c){this._pitchWithRotate=l.pitchWithRotate,this._mouseRotate=f,this._mousePitch=c};Fs.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},Fs.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},Fs.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},Fs.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var Hs=function(l,f,c,p){this._el=l,this._touchZoom=f,this._touchRotate=c,this._tapDragZoom=p,this._rotationDisabled=!1,this._enabled=!0};Hs.prototype.enable=function(l){this._touchZoom.enable(l),this._rotationDisabled||this._touchRotate.enable(l),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},Hs.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},Hs.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},Hs.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},Hs.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},Hs.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var xs=function(l){return l.zoom||l.drag||l.pitch||l.rotate},pu=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f}(v.Event);function Mn(l){return l.panDelta&&l.panDelta.mag()||l.zoomDelta||l.bearingDelta||l.pitchDelta}var bn=function(l,f){this._map=l,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Yu(l),this._bearingSnap=f.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(f),v.bindAll(["handleEvent","handleWindowEvent"],this);var c=this._el;this._listeners=[[c,"touchstart",{passive:!0}],[c,"touchmove",{passive:!1}],[c,"touchend",void 0],[c,"touchcancel",void 0],[c,"mousedown",void 0],[c,"mousemove",void 0],[c,"mouseup",void 0],[v.window.document,"mousemove",{capture:!0}],[v.window.document,"mouseup",void 0],[c,"mouseover",void 0],[c,"mouseout",void 0],[c,"dblclick",void 0],[c,"click",void 0],[c,"keydown",{capture:!1}],[c,"keyup",void 0],[c,"wheel",{passive:!1}],[c,"contextmenu",void 0],[v.window,"blur",void 0]];for(var p=0,b=this._listeners;p<b.length;p+=1){var w=b[p],A=w[0];F.addEventListener(A,w[1],A===v.window.document?this.handleWindowEvent:this.handleEvent,w[2])}};bn.prototype.destroy=function(){for(var l=0,f=this._listeners;l<f.length;l+=1){var c=f[l],p=c[0];F.removeEventListener(p,c[1],p===v.window.document?this.handleWindowEvent:this.handleEvent,c[2])}},bn.prototype._addDefaultHandlers=function(l){var f=this._map,c=f.getCanvasContainer();this._add("mapEvent",new ho(f,l));var p=f.boxZoom=new so(f,l);this._add("boxZoom",p);var b=new Os,w=new ru;f.doubleClickZoom=new Iu(w,b),this._add("tapZoom",b),this._add("clickZoom",w);var A=new Go;this._add("tapDragZoom",A);var R=f.touchPitch=new Gf;this._add("touchPitch",R);var U=new lf(l),q=new hl(l);f.dragRotate=new Fs(l,U,q),this._add("mouseRotate",U,["mousePitch"]),this._add("mousePitch",q,["mouseRotate"]);var le=new fc(l),fe=new Ca(l);f.dragPan=new dl(c,le,fe),this._add("mousePan",le),this._add("touchPan",fe,["touchZoom","touchRotate"]);var pe=new jf,Oe=new Ds;f.touchZoomRotate=new Hs(c,Oe,pe,A),this._add("touchRotate",pe,["touchPan","touchZoom"]),this._add("touchZoom",Oe,["touchPan","touchRotate"]);var Ce=f.scrollZoom=new Si(f,this);this._add("scrollZoom",Ce,["mousePan"]);var We=f.keyboard=new tu;this._add("keyboard",We),this._add("blockableMapEvent",new pn(f));for(var Te=0,He=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];Te<He.length;Te+=1){var Qe=He[Te];l.interactive&&l[Qe]&&f[Qe].enable(l[Qe])}},bn.prototype._add=function(l,f,c){this._handlers.push({handlerName:l,handler:f,allowed:c}),this._handlersById[l]=f},bn.prototype.stop=function(l){if(!this._updatingCamera){for(var f=0,c=this._handlers;f<c.length;f+=1)c[f].handler.reset();this._inertia.clear(),this._fireEvents({},{},l),this._changes=[]}},bn.prototype.isActive=function(){for(var l=0,f=this._handlers;l<f.length;l+=1)if(f[l].handler.isActive())return!0;return!1},bn.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},bn.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},bn.prototype.isMoving=function(){return Boolean(xs(this._eventsInProgress))||this.isZooming()},bn.prototype._blockedByActive=function(l,f,c){for(var p in l)if(p!==c&&(!f||f.indexOf(p)<0))return!0;return!1},bn.prototype.handleWindowEvent=function(l){this.handleEvent(l,l.type+"Window")},bn.prototype._getMapTouches=function(l){for(var f=[],c=0,p=l;c<p.length;c+=1){var b=p[c];this._el.contains(b.target)&&f.push(b)}return f},bn.prototype.handleEvent=function(l,f){this._updatingCamera=!0;for(var c=l.type==="renderFrame"?void 0:l,p={needsRenderFrame:!1},b={},w={},A=l.touches?this._getMapTouches(l.touches):void 0,R=A?F.touchPos(this._el,A):F.mousePos(this._el,l),U=0,q=this._handlers;U<q.length;U+=1){var le=q[U],fe=le.handlerName,pe=le.handler,Oe=le.allowed;if(pe.isEnabled()){var Ce=void 0;this._blockedByActive(w,Oe,fe)?pe.reset():pe[f||l.type]&&(Ce=pe[f||l.type](l,R,A),this.mergeHandlerResult(p,b,Ce,fe,c),Ce&&Ce.needsRenderFrame&&this._triggerRenderFrame()),(Ce||pe.isActive())&&(w[fe]=pe)}}var We={};for(var Te in this._previousActiveHandlers)w[Te]||(We[Te]=c);this._previousActiveHandlers=w,(Object.keys(We).length||Mn(p))&&(this._changes.push([p,b,We]),this._triggerRenderFrame()),(Object.keys(w).length||Mn(p))&&this._map._stop(!0),this._updatingCamera=!1;var He=p.cameraAnimation;He&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],He(this._map))},bn.prototype.mergeHandlerResult=function(l,f,c,p,b){if(c){v.extend(l,c);var w={handlerName:p,originalEvent:c.originalEvent||b};c.zoomDelta!==void 0&&(f.zoom=w),c.panDelta!==void 0&&(f.drag=w),c.pitchDelta!==void 0&&(f.pitch=w),c.bearingDelta!==void 0&&(f.rotate=w)}},bn.prototype._applyChanges=function(){for(var l={},f={},c={},p=0,b=this._changes;p<b.length;p+=1){var w=b[p],A=w[0],R=w[1],U=w[2];A.panDelta&&(l.panDelta=(l.panDelta||new v.Point(0,0))._add(A.panDelta)),A.zoomDelta&&(l.zoomDelta=(l.zoomDelta||0)+A.zoomDelta),A.bearingDelta&&(l.bearingDelta=(l.bearingDelta||0)+A.bearingDelta),A.pitchDelta&&(l.pitchDelta=(l.pitchDelta||0)+A.pitchDelta),A.around!==void 0&&(l.around=A.around),A.pinchAround!==void 0&&(l.pinchAround=A.pinchAround),A.noInertia&&(l.noInertia=A.noInertia),v.extend(f,R),v.extend(c,U)}this._updateMapTransform(l,f,c),this._changes=[]},bn.prototype._updateMapTransform=function(l,f,c){var p=this._map,b=p.transform;if(!Mn(l))return this._fireEvents(f,c,!0);var w=l.panDelta,A=l.zoomDelta,R=l.bearingDelta,U=l.pitchDelta,q=l.around,le=l.pinchAround;le!==void 0&&(q=le),p._stop(!0),q=q||p.transform.centerPoint;var fe=b.pointLocation(w?q.sub(w):q);R&&(b.bearing+=R),U&&(b.pitch+=U),A&&(b.zoom+=A),b.setLocationAtPoint(fe,q),this._map._update(),l.noInertia||this._inertia.record(l),this._fireEvents(f,c,!0)},bn.prototype._fireEvents=function(l,f,c){var p=this,b=xs(this._eventsInProgress),w=xs(l),A={};for(var R in l)this._eventsInProgress[R]||(A[R+"start"]=l[R].originalEvent),this._eventsInProgress[R]=l[R];for(var U in!b&&w&&this._fireEvent("movestart",w.originalEvent),A)this._fireEvent(U,A[U]);for(var q in w&&this._fireEvent("move",w.originalEvent),l)this._fireEvent(q,l[q].originalEvent);var le,fe={};for(var pe in this._eventsInProgress){var Oe=this._eventsInProgress[pe],Ce=Oe.handlerName,We=Oe.originalEvent;this._handlersById[Ce].isActive()||(delete this._eventsInProgress[pe],fe[pe+"end"]=le=f[Ce]||We)}for(var Te in fe)this._fireEvent(Te,fe[Te]);var He=xs(this._eventsInProgress);if(c&&(b||w)&&!He){this._updatingCamera=!0;var Qe=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),yt=function(Vt){return Vt!==0&&-p._bearingSnap<Vt&&Vt<p._bearingSnap};Qe?(yt(Qe.bearing||this._map.getBearing())&&(Qe.bearing=0),this._map.easeTo(Qe,{originalEvent:le})):(this._map.fire(new v.Event("moveend",{originalEvent:le})),yt(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},bn.prototype._fireEvent=function(l,f){this._map.fire(new v.Event(l,f?{originalEvent:f}:{}))},bn.prototype._requestFrame=function(){var l=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(f){delete l._frameId,l.handleEvent(new pu("renderFrame",{timeStamp:f})),l._applyChanges()})},bn.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var zc=function(l){function f(c,p){l.call(this),this._moving=!1,this._zooming=!1,this.transform=c,this._bearingSnap=p.bearingSnap,v.bindAll(["_renderFrameCallback"],this)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getCenter=function(){return new v.LngLat(this.transform.center.lng,this.transform.center.lat)},f.prototype.setCenter=function(c,p){return this.jumpTo({center:c},p)},f.prototype.panBy=function(c,p,b){return c=v.Point.convert(c).mult(-1),this.panTo(this.transform.center,v.extend({offset:c},p),b)},f.prototype.panTo=function(c,p,b){return this.easeTo(v.extend({center:c},p),b)},f.prototype.getZoom=function(){return this.transform.zoom},f.prototype.setZoom=function(c,p){return this.jumpTo({zoom:c},p),this},f.prototype.zoomTo=function(c,p,b){return this.easeTo(v.extend({zoom:c},p),b)},f.prototype.zoomIn=function(c,p){return this.zoomTo(this.getZoom()+1,c,p),this},f.prototype.zoomOut=function(c,p){return this.zoomTo(this.getZoom()-1,c,p),this},f.prototype.getBearing=function(){return this.transform.bearing},f.prototype.setBearing=function(c,p){return this.jumpTo({bearing:c},p),this},f.prototype.getPadding=function(){return this.transform.padding},f.prototype.setPadding=function(c,p){return this.jumpTo({padding:c},p),this},f.prototype.rotateTo=function(c,p,b){return this.easeTo(v.extend({bearing:c},p),b)},f.prototype.resetNorth=function(c,p){return this.rotateTo(0,v.extend({duration:1e3},c),p),this},f.prototype.resetNorthPitch=function(c,p){return this.easeTo(v.extend({bearing:0,pitch:0,duration:1e3},c),p),this},f.prototype.snapToNorth=function(c,p){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(c,p):this},f.prototype.getPitch=function(){return this.transform.pitch},f.prototype.setPitch=function(c,p){return this.jumpTo({pitch:c},p),this},f.prototype.cameraForBounds=function(c,p){c=v.LngLatBounds.convert(c);var b=p&&p.bearing||0;return this._cameraForBoxAndBearing(c.getNorthWest(),c.getSouthEast(),b,p)},f.prototype._cameraForBoxAndBearing=function(c,p,b,w){var A={top:0,bottom:0,right:0,left:0};if(typeof(w=v.extend({padding:A,offset:[0,0],maxZoom:this.transform.maxZoom},w)).padding=="number"){var R=w.padding;w.padding={top:R,bottom:R,right:R,left:R}}w.padding=v.extend(A,w.padding);var U=this.transform,q=U.padding,le=U.project(v.LngLat.convert(c)),fe=U.project(v.LngLat.convert(p)),pe=le.rotate(-b*Math.PI/180),Oe=fe.rotate(-b*Math.PI/180),Ce=new v.Point(Math.max(pe.x,Oe.x),Math.max(pe.y,Oe.y)),We=new v.Point(Math.min(pe.x,Oe.x),Math.min(pe.y,Oe.y)),Te=Ce.sub(We),He=(U.width-(q.left+q.right+w.padding.left+w.padding.right))/Te.x,Qe=(U.height-(q.top+q.bottom+w.padding.top+w.padding.bottom))/Te.y;if(!(Qe<0||He<0)){var yt=Math.min(U.scaleZoom(U.scale*Math.min(He,Qe)),w.maxZoom),Vt=typeof w.offset.x=="number"?new v.Point(w.offset.x,w.offset.y):v.Point.convert(w.offset),Nt=new v.Point((w.padding.left-w.padding.right)/2,(w.padding.top-w.padding.bottom)/2).rotate(b*Math.PI/180),Kt=Vt.add(Nt).mult(U.scale/U.zoomScale(yt));return{center:U.unproject(le.add(fe).div(2).sub(Kt)),zoom:yt,bearing:b}}v.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},f.prototype.fitBounds=function(c,p,b){return this._fitInternal(this.cameraForBounds(c,p),p,b)},f.prototype.fitScreenCoordinates=function(c,p,b,w,A){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(v.Point.convert(c)),this.transform.pointLocation(v.Point.convert(p)),b,w),w,A)},f.prototype._fitInternal=function(c,p,b){return c?(delete(p=v.extend(c,p)).padding,p.linear?this.easeTo(p,b):this.flyTo(p,b)):this},f.prototype.jumpTo=function(c,p){this.stop();var b=this.transform,w=!1,A=!1,R=!1;return"zoom"in c&&b.zoom!==+c.zoom&&(w=!0,b.zoom=+c.zoom),c.center!==void 0&&(b.center=v.LngLat.convert(c.center)),"bearing"in c&&b.bearing!==+c.bearing&&(A=!0,b.bearing=+c.bearing),"pitch"in c&&b.pitch!==+c.pitch&&(R=!0,b.pitch=+c.pitch),c.padding==null||b.isPaddingEqual(c.padding)||(b.padding=c.padding),this.fire(new v.Event("movestart",p)).fire(new v.Event("move",p)),w&&this.fire(new v.Event("zoomstart",p)).fire(new v.Event("zoom",p)).fire(new v.Event("zoomend",p)),A&&this.fire(new v.Event("rotatestart",p)).fire(new v.Event("rotate",p)).fire(new v.Event("rotateend",p)),R&&this.fire(new v.Event("pitchstart",p)).fire(new v.Event("pitch",p)).fire(new v.Event("pitchend",p)),this.fire(new v.Event("moveend",p))},f.prototype.easeTo=function(c,p){var b=this;this._stop(!1,c.easeId),((c=v.extend({offset:[0,0],duration:500,easing:v.ease},c)).animate===!1||!c.essential&&v.browser.prefersReducedMotion)&&(c.duration=0);var w=this.transform,A=this.getZoom(),R=this.getBearing(),U=this.getPitch(),q=this.getPadding(),le="zoom"in c?+c.zoom:A,fe="bearing"in c?this._normalizeBearing(c.bearing,R):R,pe="pitch"in c?+c.pitch:U,Oe="padding"in c?c.padding:w.padding,Ce=v.Point.convert(c.offset),We=w.centerPoint.add(Ce),Te=w.pointLocation(We),He=v.LngLat.convert(c.center||Te);this._normalizeCenter(He);var Qe,yt,Vt=w.project(Te),Nt=w.project(He).sub(Vt),Kt=w.zoomScale(le-A);c.around&&(Qe=v.LngLat.convert(c.around),yt=w.locationPoint(Qe));var cr={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||le!==A,this._rotating=this._rotating||R!==fe,this._pitching=this._pitching||pe!==U,this._padding=!w.isPaddingEqual(Oe),this._easeId=c.easeId,this._prepareEase(p,c.noMoveStart,cr),this._ease(function(Ir){if(b._zooming&&(w.zoom=v.number(A,le,Ir)),b._rotating&&(w.bearing=v.number(R,fe,Ir)),b._pitching&&(w.pitch=v.number(U,pe,Ir)),b._padding&&(w.interpolatePadding(q,Oe,Ir),We=w.centerPoint.add(Ce)),Qe)w.setLocationAtPoint(Qe,yt);else{var Or=w.zoomScale(w.zoom-A),tn=le>A?Math.min(2,Kt):Math.max(.5,Kt),Rn=Math.pow(tn,1-Ir),Fn=w.unproject(Vt.add(Nt.mult(Ir*Rn)).mult(Or));w.setLocationAtPoint(w.renderWorldCopies?Fn.wrap():Fn,We)}b._fireMoveEvents(p)},function(Ir){b._afterEase(p,Ir)},c),this},f.prototype._prepareEase=function(c,p,b){b===void 0&&(b={}),this._moving=!0,p||b.moving||this.fire(new v.Event("movestart",c)),this._zooming&&!b.zooming&&this.fire(new v.Event("zoomstart",c)),this._rotating&&!b.rotating&&this.fire(new v.Event("rotatestart",c)),this._pitching&&!b.pitching&&this.fire(new v.Event("pitchstart",c))},f.prototype._fireMoveEvents=function(c){this.fire(new v.Event("move",c)),this._zooming&&this.fire(new v.Event("zoom",c)),this._rotating&&this.fire(new v.Event("rotate",c)),this._pitching&&this.fire(new v.Event("pitch",c))},f.prototype._afterEase=function(c,p){if(!this._easeId||!p||this._easeId!==p){delete this._easeId;var b=this._zooming,w=this._rotating,A=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,b&&this.fire(new v.Event("zoomend",c)),w&&this.fire(new v.Event("rotateend",c)),A&&this.fire(new v.Event("pitchend",c)),this.fire(new v.Event("moveend",c))}},f.prototype.flyTo=function(c,p){var b=this;if(!c.essential&&v.browser.prefersReducedMotion){var w=v.pick(c,["center","zoom","bearing","pitch","around"]);return this.jumpTo(w,p)}this.stop(),c=v.extend({offset:[0,0],speed:1.2,curve:1.42,easing:v.ease},c);var A=this.transform,R=this.getZoom(),U=this.getBearing(),q=this.getPitch(),le=this.getPadding(),fe="zoom"in c?v.clamp(+c.zoom,A.minZoom,A.maxZoom):R,pe="bearing"in c?this._normalizeBearing(c.bearing,U):U,Oe="pitch"in c?+c.pitch:q,Ce="padding"in c?c.padding:A.padding,We=A.zoomScale(fe-R),Te=v.Point.convert(c.offset),He=A.centerPoint.add(Te),Qe=A.pointLocation(He),yt=v.LngLat.convert(c.center||Qe);this._normalizeCenter(yt);var Vt=A.project(Qe),Nt=A.project(yt).sub(Vt),Kt=c.curve,cr=Math.max(A.width,A.height),Ir=cr/We,Or=Nt.mag();if("minZoom"in c){var tn=v.clamp(Math.min(c.minZoom,R,fe),A.minZoom,A.maxZoom),Rn=cr/A.zoomScale(tn-R);Kt=Math.sqrt(Rn/Or*2)}var Fn=Kt*Kt;function Un(Kn){var Wn=(Ir*Ir-cr*cr+(Kn?-1:1)*Fn*Fn*Or*Or)/(2*(Kn?Ir:cr)*Fn*Or);return Math.log(Math.sqrt(Wn*Wn+1)-Wn)}function Li(Kn){return(Math.exp(Kn)-Math.exp(-Kn))/2}function Zr(Kn){return(Math.exp(Kn)+Math.exp(-Kn))/2}var ii=Un(0),si=function(Kn){return Zr(ii)/Zr(ii+Kt*Kn)},Qn=function(Kn){return cr*((Zr(ii)*(Li(Wn=ii+Kt*Kn)/Zr(Wn))-Li(ii))/Fn)/Or;var Wn},Hn=(Un(1)-ii)/Kt;if(Math.abs(Or)<1e-6||!isFinite(Hn)){if(Math.abs(cr-Ir)<1e-6)return this.easeTo(c,p);var mi=Ir<cr?-1:1;Hn=Math.abs(Math.log(Ir/cr))/Kt,Qn=function(){return 0},si=function(Kn){return Math.exp(mi*Kt*Kn)}}return c.duration="duration"in c?+c.duration:1e3*Hn/("screenSpeed"in c?+c.screenSpeed/Kt:+c.speed),c.maxDuration&&c.duration>c.maxDuration&&(c.duration=0),this._zooming=!0,this._rotating=U!==pe,this._pitching=Oe!==q,this._padding=!A.isPaddingEqual(Ce),this._prepareEase(p,!1),this._ease(function(Kn){var Wn=Kn*Hn,uo=1/si(Wn);A.zoom=Kn===1?fe:R+A.scaleZoom(uo),b._rotating&&(A.bearing=v.number(U,pe,Kn)),b._pitching&&(A.pitch=v.number(q,Oe,Kn)),b._padding&&(A.interpolatePadding(le,Ce,Kn),He=A.centerPoint.add(Te));var ha=Kn===1?yt:A.unproject(Vt.add(Nt.mult(Qn(Wn))).mult(uo));A.setLocationAtPoint(A.renderWorldCopies?ha.wrap():ha,He),b._fireMoveEvents(p)},function(){return b._afterEase(p)},c),this},f.prototype.isEasing=function(){return!!this._easeFrameId},f.prototype.stop=function(){return this._stop()},f.prototype._stop=function(c,p){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var b=this._onEaseEnd;delete this._onEaseEnd,b.call(this,p)}if(!c){var w=this.handlers;w&&w.stop(!1)}return this},f.prototype._ease=function(c,p,b){b.animate===!1||b.duration===0?(c(1),p()):(this._easeStart=v.browser.now(),this._easeOptions=b,this._onEaseFrame=c,this._onEaseEnd=p,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},f.prototype._renderFrameCallback=function(){var c=Math.min((v.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(c)),c<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},f.prototype._normalizeBearing=function(c,p){c=v.wrap(c,-180,180);var b=Math.abs(c-p);return Math.abs(c-360-p)<b&&(c-=360),Math.abs(c+360-p)<b&&(c+=360),c},f.prototype._normalizeCenter=function(c){var p=this.transform;if(p.renderWorldCopies&&!p.lngRange){var b=c.lng-p.center.lng;c.lng+=b>180?-360:b<-180?360:0}},f}(v.Evented),is=function(l){l===void 0&&(l={}),this.options=l,v.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};is.prototype.getDefaultPosition=function(){return"bottom-right"},is.prototype.onAdd=function(l){var f=this.options&&this.options.compact;return this._map=l,this._container=F.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=F.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=F.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),f&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),f===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},is.prototype.onRemove=function(){F.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},is.prototype._setElementTitle=function(l,f){var c=this._map._getUIString("AttributionControl."+f);l.title=c,l.setAttribute("aria-label",c)},is.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},is.prototype._updateEditLink=function(){var l=this._editLink;l||(l=this._editLink=this._container.querySelector(".mapbox-improve-map"));var f=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||v.config.ACCESS_TOKEN}];if(l){var c=f.reduce(function(p,b,w){return b.value&&(p+=b.key+"="+b.value+(w<f.length-1?"&":"")),p},"?");l.href=v.config.FEEDBACK_URL+"/"+c+(this._map._hash?this._map._hash.getHashString(!0):""),l.rel="noopener nofollow",this._setElementTitle(l,"MapFeedback")}},is.prototype._updateData=function(l){!l||l.sourceDataType!=="metadata"&&l.sourceDataType!=="visibility"&&l.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},is.prototype._updateAttributions=function(){if(this._map.style){var l=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?l=l.concat(this.options.customAttribution.map(function(R){return typeof R!="string"?"":R})):typeof this.options.customAttribution=="string"&&l.push(this.options.customAttribution)),this._map.style.stylesheet){var f=this._map.style.stylesheet;this.styleOwner=f.owner,this.styleId=f.id}var c=this._map.style.sourceCaches;for(var p in c){var b=c[p];if(b.used){var w=b.getSource();w.attribution&&l.indexOf(w.attribution)<0&&l.push(w.attribution)}}l.sort(function(R,U){return R.length-U.length});var A=(l=l.filter(function(R,U){for(var q=U+1;q<l.length;q++)if(l[q].indexOf(R)>=0)return!1;return!0})).join(" | ");A!==this._attribHTML&&(this._attribHTML=A,l.length?(this._innerContainer.innerHTML=A,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},is.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var as=function(){v.bindAll(["_updateLogo"],this),v.bindAll(["_updateCompact"],this)};as.prototype.onAdd=function(l){this._map=l,this._container=F.create("div","mapboxgl-ctrl");var f=F.create("a","mapboxgl-ctrl-logo");return f.target="_blank",f.rel="noopener nofollow",f.href="https://www.mapbox.com/",f.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),f.setAttribute("rel","noopener nofollow"),this._container.appendChild(f),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},as.prototype.onRemove=function(){F.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},as.prototype.getDefaultPosition=function(){return"bottom-left"},as.prototype._updateLogo=function(l){l&&l.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},as.prototype._logoRequired=function(){if(this._map.style){var l=this._map.style.sourceCaches;for(var f in l)if(l[f].getSource().mapbox_logo)return!0;return!1}},as.prototype._updateCompact=function(){var l=this._container.children;if(l.length){var f=l[0];this._map.getCanvasContainer().offsetWidth<250?f.classList.add("mapboxgl-compact"):f.classList.remove("mapboxgl-compact")}};var Jo=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};Jo.prototype.add=function(l){var f=++this._id;return this._queue.push({callback:l,id:f,cancelled:!1}),f},Jo.prototype.remove=function(l){for(var f=this._currentlyRunning,c=0,p=f?this._queue.concat(f):this._queue;c<p.length;c+=1){var b=p[c];if(b.id===l)return void(b.cancelled=!0)}},Jo.prototype.run=function(l){l===void 0&&(l=0);var f=this._currentlyRunning=this._queue;this._queue=[];for(var c=0,p=f;c<p.length;c+=1){var b=p[c];if(!b.cancelled&&(b.callback(l),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},Jo.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var nu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},to=v.window.HTMLImageElement,Ou=v.window.HTMLElement,Ji=v.window.ImageBitmap,Ta={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},hc=function(l){function f(p){var b=this;if((p=v.extend({},Ta,p)).minZoom!=null&&p.maxZoom!=null&&p.minZoom>p.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(p.minPitch!=null&&p.maxPitch!=null&&p.minPitch>p.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(p.minPitch!=null&&p.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(p.maxPitch!=null&&p.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var w=new Yi(p.minZoom,p.maxZoom,p.minPitch,p.maxPitch,p.renderWorldCopies);if(l.call(this,w,p),this._interactive=p.interactive,this._maxTileCacheSize=p.maxTileCacheSize,this._failIfMajorPerformanceCaveat=p.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=p.preserveDrawingBuffer,this._antialias=p.antialias,this._trackResize=p.trackResize,this._bearingSnap=p.bearingSnap,this._refreshExpiredTiles=p.refreshExpiredTiles,this._fadeDuration=p.fadeDuration,this._crossSourceCollisions=p.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=p.collectResourceTiming,this._renderTaskQueue=new Jo,this._controls=[],this._mapId=v.uniqueId(),this._locale=v.extend({},nu,p.locale),this._clickTolerance=p.clickTolerance,this._requestManager=new v.RequestManager(p.transformRequest,p.accessToken),typeof p.container=="string"){if(this._container=v.window.document.getElementById(p.container),!this._container)throw new Error("Container '"+p.container+"' not found.")}else{if(!(p.container instanceof Ou))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=p.container}if(p.maxBounds&&this.setMaxBounds(p.maxBounds),v.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return b._update(!1)}),this.on("moveend",function(){return b._update(!1)}),this.on("zoom",function(){return b._update(!0)}),v.window!==void 0&&(v.window.addEventListener("online",this._onWindowOnline,!1),v.window.addEventListener("resize",this._onWindowResize,!1),v.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new bn(this,p),this._hash=p.hash&&new ys(typeof p.hash=="string"&&p.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch}),p.bounds&&(this.resize(),this.fitBounds(p.bounds,v.extend({},p.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=p.localIdeographFontFamily,p.style&&this.setStyle(p.style,{localIdeographFontFamily:p.localIdeographFontFamily}),p.attributionControl&&this.addControl(new is({customAttribution:p.customAttribution})),this.addControl(new as,p.logoPosition),this.on("style.load",function(){b.transform.unmodified&&b.jumpTo(b.style.stylesheet)}),this.on("data",function(A){b._update(A.dataType==="style"),b.fire(new v.Event(A.dataType+"data",A))}),this.on("dataloading",function(A){b.fire(new v.Event(A.dataType+"dataloading",A))})}l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f;var c={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return f.prototype._getMapId=function(){return this._mapId},f.prototype.addControl=function(p,b){if(b===void 0&&(b=p.getDefaultPosition?p.getDefaultPosition():"top-right"),!p||!p.onAdd)return this.fire(new v.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var w=p.onAdd(this);this._controls.push(p);var A=this._controlPositions[b];return b.indexOf("bottom")!==-1?A.insertBefore(w,A.firstChild):A.appendChild(w),this},f.prototype.removeControl=function(p){if(!p||!p.onRemove)return this.fire(new v.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var b=this._controls.indexOf(p);return b>-1&&this._controls.splice(b,1),p.onRemove(this),this},f.prototype.hasControl=function(p){return this._controls.indexOf(p)>-1},f.prototype.resize=function(p){var b=this._containerDimensions(),w=b[0],A=b[1];if(w===this.transform.width&&A===this.transform.height)return this;this._resizeCanvas(w,A),this.transform.resize(w,A),this.painter.resize(w,A);var R=!this._moving;return R&&this.fire(new v.Event("movestart",p)).fire(new v.Event("move",p)),this.fire(new v.Event("resize",p)),R&&this.fire(new v.Event("moveend",p)),this},f.prototype.getBounds=function(){return this.transform.getBounds()},f.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},f.prototype.setMaxBounds=function(p){return this.transform.setMaxBounds(v.LngLatBounds.convert(p)),this._update()},f.prototype.setMinZoom=function(p){if((p=p==null?-2:p)>=-2&&p<=this.transform.maxZoom)return this.transform.minZoom=p,this._update(),this.getZoom()<p&&this.setZoom(p),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},f.prototype.getMinZoom=function(){return this.transform.minZoom},f.prototype.setMaxZoom=function(p){if((p=p==null?22:p)>=this.transform.minZoom)return this.transform.maxZoom=p,this._update(),this.getZoom()>p&&this.setZoom(p),this;throw new Error("maxZoom must be greater than the current minZoom")},f.prototype.getMaxZoom=function(){return this.transform.maxZoom},f.prototype.setMinPitch=function(p){if((p=p==null?0:p)<0)throw new Error("minPitch must be greater than or equal to 0");if(p>=0&&p<=this.transform.maxPitch)return this.transform.minPitch=p,this._update(),this.getPitch()<p&&this.setPitch(p),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},f.prototype.getMinPitch=function(){return this.transform.minPitch},f.prototype.setMaxPitch=function(p){if((p=p==null?60:p)>60)throw new Error("maxPitch must be less than or equal to 60");if(p>=this.transform.minPitch)return this.transform.maxPitch=p,this._update(),this.getPitch()>p&&this.setPitch(p),this;throw new Error("maxPitch must be greater than the current minPitch")},f.prototype.getMaxPitch=function(){return this.transform.maxPitch},f.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},f.prototype.setRenderWorldCopies=function(p){return this.transform.renderWorldCopies=p,this._update()},f.prototype.project=function(p){return this.transform.locationPoint(v.LngLat.convert(p))},f.prototype.unproject=function(p){return this.transform.pointLocation(v.Point.convert(p))},f.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},f.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},f.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},f.prototype._createDelegatedListener=function(p,b,w){var A,R=this;if(p==="mouseenter"||p==="mouseover"){var U=!1;return{layer:b,listener:w,delegates:{mousemove:function(le){var fe=R.getLayer(b)?R.queryRenderedFeatures(le.point,{layers:[b]}):[];fe.length?U||(U=!0,w.call(R,new fo(p,R,le.originalEvent,{features:fe}))):U=!1},mouseout:function(){U=!1}}}}if(p==="mouseleave"||p==="mouseout"){var q=!1;return{layer:b,listener:w,delegates:{mousemove:function(le){(R.getLayer(b)?R.queryRenderedFeatures(le.point,{layers:[b]}):[]).length?q=!0:q&&(q=!1,w.call(R,new fo(p,R,le.originalEvent)))},mouseout:function(le){q&&(q=!1,w.call(R,new fo(p,R,le.originalEvent)))}}}}return{layer:b,listener:w,delegates:(A={},A[p]=function(le){var fe=R.getLayer(b)?R.queryRenderedFeatures(le.point,{layers:[b]}):[];fe.length&&(le.features=fe,w.call(R,le),delete le.features)},A)}},f.prototype.on=function(p,b,w){if(w===void 0)return l.prototype.on.call(this,p,b);var A=this._createDelegatedListener(p,b,w);for(var R in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[p]=this._delegatedListeners[p]||[],this._delegatedListeners[p].push(A),A.delegates)this.on(R,A.delegates[R]);return this},f.prototype.once=function(p,b,w){if(w===void 0)return l.prototype.once.call(this,p,b);var A=this._createDelegatedListener(p,b,w);for(var R in A.delegates)this.once(R,A.delegates[R]);return this},f.prototype.off=function(p,b,w){var A=this;return w===void 0?l.prototype.off.call(this,p,b):(this._delegatedListeners&&this._delegatedListeners[p]&&function(R){for(var U=R[p],q=0;q<U.length;q++){var le=U[q];if(le.layer===b&&le.listener===w){for(var fe in le.delegates)A.off(fe,le.delegates[fe]);return U.splice(q,1),A}}}(this._delegatedListeners),this)},f.prototype.queryRenderedFeatures=function(p,b){if(!this.style)return[];var w;if(b!==void 0||p===void 0||p instanceof v.Point||Array.isArray(p)||(b=p,p=void 0),b=b||{},(p=p||[[0,0],[this.transform.width,this.transform.height]])instanceof v.Point||typeof p[0]=="number")w=[v.Point.convert(p)];else{var A=v.Point.convert(p[0]),R=v.Point.convert(p[1]);w=[A,new v.Point(R.x,A.y),R,new v.Point(A.x,R.y),A]}return this.style.queryRenderedFeatures(w,b,this.transform)},f.prototype.querySourceFeatures=function(p,b){return this.style.querySourceFeatures(p,b)},f.prototype.setStyle=function(p,b){return(b=v.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},b)).diff!==!1&&b.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&p?(this._diffStyle(p,b),this):(this._localIdeographFontFamily=b.localIdeographFontFamily,this._updateStyle(p,b))},f.prototype._getUIString=function(p){var b=this._locale[p];if(b==null)throw new Error("Missing UI string '"+p+"'");return b},f.prototype._updateStyle=function(p,b){return this.style&&(this.style.setEventedParent(null),this.style._remove()),p?(this.style=new ms(this,b||{}),this.style.setEventedParent(this,{style:this.style}),typeof p=="string"?this.style.loadURL(p):this.style.loadJSON(p),this):(delete this.style,this)},f.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new ms(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},f.prototype._diffStyle=function(p,b){var w=this;if(typeof p=="string"){var A=this._requestManager.normalizeStyleURL(p),R=this._requestManager.transformRequest(A,v.ResourceType.Style);v.getJSON(R,function(U,q){U?w.fire(new v.ErrorEvent(U)):q&&w._updateDiff(q,b)})}else typeof p=="object"&&this._updateDiff(p,b)},f.prototype._updateDiff=function(p,b){try{this.style.setState(p)&&this._update(!0)}catch(w){v.warnOnce("Unable to perform style diff: "+(w.message||w.error||w)+".  Rebuilding the style from scratch."),this._updateStyle(p,b)}},f.prototype.getStyle=function(){if(this.style)return this.style.serialize()},f.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():v.warnOnce("There is no style added to the map.")},f.prototype.addSource=function(p,b){return this._lazyInitEmptyStyle(),this.style.addSource(p,b),this._update(!0)},f.prototype.isSourceLoaded=function(p){var b=this.style&&this.style.sourceCaches[p];if(b!==void 0)return b.loaded();this.fire(new v.ErrorEvent(new Error("There is no source with ID '"+p+"'")))},f.prototype.areTilesLoaded=function(){var p=this.style&&this.style.sourceCaches;for(var b in p){var w=p[b]._tiles;for(var A in w){var R=w[A];if(R.state!=="loaded"&&R.state!=="errored")return!1}}return!0},f.prototype.addSourceType=function(p,b,w){return this._lazyInitEmptyStyle(),this.style.addSourceType(p,b,w)},f.prototype.removeSource=function(p){return this.style.removeSource(p),this._update(!0)},f.prototype.getSource=function(p){return this.style.getSource(p)},f.prototype.addImage=function(p,b,w){w===void 0&&(w={});var A=w.pixelRatio;A===void 0&&(A=1);var R=w.sdf;R===void 0&&(R=!1);var U=w.stretchX,q=w.stretchY,le=w.content;if(this._lazyInitEmptyStyle(),b instanceof to||Ji&&b instanceof Ji){var fe=v.browser.getImageData(b);this.style.addImage(p,{data:new v.RGBAImage({width:fe.width,height:fe.height},fe.data),pixelRatio:A,stretchX:U,stretchY:q,content:le,sdf:R,version:0})}else{if(b.width===void 0||b.height===void 0)return this.fire(new v.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var pe=b;this.style.addImage(p,{data:new v.RGBAImage({width:b.width,height:b.height},new Uint8Array(b.data)),pixelRatio:A,stretchX:U,stretchY:q,content:le,sdf:R,version:0,userImage:pe}),pe.onAdd&&pe.onAdd(this,p)}},f.prototype.updateImage=function(p,b){var w=this.style.getImage(p);if(!w)return this.fire(new v.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var A=b instanceof to||Ji&&b instanceof Ji?v.browser.getImageData(b):b,R=A.width,U=A.height,q=A.data;return R===void 0||U===void 0?this.fire(new v.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):R!==w.data.width||U!==w.data.height?this.fire(new v.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(w.data.replace(q,!(b instanceof to||Ji&&b instanceof Ji)),void this.style.updateImage(p,w))},f.prototype.hasImage=function(p){return p?!!this.style.getImage(p):(this.fire(new v.ErrorEvent(new Error("Missing required image id"))),!1)},f.prototype.removeImage=function(p){this.style.removeImage(p)},f.prototype.loadImage=function(p,b){v.getImage(this._requestManager.transformRequest(p,v.ResourceType.Image),b)},f.prototype.listImages=function(){return this.style.listImages()},f.prototype.addLayer=function(p,b){return this._lazyInitEmptyStyle(),this.style.addLayer(p,b),this._update(!0)},f.prototype.moveLayer=function(p,b){return this.style.moveLayer(p,b),this._update(!0)},f.prototype.removeLayer=function(p){return this.style.removeLayer(p),this._update(!0)},f.prototype.getLayer=function(p){return this.style.getLayer(p)},f.prototype.setLayerZoomRange=function(p,b,w){return this.style.setLayerZoomRange(p,b,w),this._update(!0)},f.prototype.setFilter=function(p,b,w){return w===void 0&&(w={}),this.style.setFilter(p,b,w),this._update(!0)},f.prototype.getFilter=function(p){return this.style.getFilter(p)},f.prototype.setPaintProperty=function(p,b,w,A){return A===void 0&&(A={}),this.style.setPaintProperty(p,b,w,A),this._update(!0)},f.prototype.getPaintProperty=function(p,b){return this.style.getPaintProperty(p,b)},f.prototype.setLayoutProperty=function(p,b,w,A){return A===void 0&&(A={}),this.style.setLayoutProperty(p,b,w,A),this._update(!0)},f.prototype.getLayoutProperty=function(p,b){return this.style.getLayoutProperty(p,b)},f.prototype.setLight=function(p,b){return b===void 0&&(b={}),this._lazyInitEmptyStyle(),this.style.setLight(p,b),this._update(!0)},f.prototype.getLight=function(){return this.style.getLight()},f.prototype.setFeatureState=function(p,b){return this.style.setFeatureState(p,b),this._update()},f.prototype.removeFeatureState=function(p,b){return this.style.removeFeatureState(p,b),this._update()},f.prototype.getFeatureState=function(p){return this.style.getFeatureState(p)},f.prototype.getContainer=function(){return this._container},f.prototype.getCanvasContainer=function(){return this._canvasContainer},f.prototype.getCanvas=function(){return this._canvas},f.prototype._containerDimensions=function(){var p=0,b=0;return this._container&&(p=this._container.clientWidth||400,b=this._container.clientHeight||300),[p,b]},f.prototype._detectMissingCSS=function(){v.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&v.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},f.prototype._setupContainer=function(){var p=this._container;p.classList.add("mapboxgl-map"),(this._missingCSSCanary=F.create("div","mapboxgl-canary",p)).style.visibility="hidden",this._detectMissingCSS();var b=this._canvasContainer=F.create("div","mapboxgl-canvas-container",p);this._interactive&&b.classList.add("mapboxgl-interactive"),this._canvas=F.create("canvas","mapboxgl-canvas",b),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var w=this._containerDimensions();this._resizeCanvas(w[0],w[1]);var A=this._controlContainer=F.create("div","mapboxgl-control-container",p),R=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(U){R[U]=F.create("div","mapboxgl-ctrl-"+U,A)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},f.prototype._resizeCanvas=function(p,b){var w=v.browser.devicePixelRatio||1;this._canvas.width=w*p,this._canvas.height=w*b,this._canvas.style.width=p+"px",this._canvas.style.height=b+"px"},f.prototype._setupPainter=function(){var p=v.extend({},Q.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),b=this._canvas.getContext("webgl",p)||this._canvas.getContext("experimental-webgl",p);b?(this.painter=new $i(b,this.transform),v.webpSupported.testSupport(b)):this.fire(new v.ErrorEvent(new Error("Failed to initialize WebGL")))},f.prototype._contextLost=function(p){p.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new v.Event("webglcontextlost",{originalEvent:p}))},f.prototype._contextRestored=function(p){this._setupPainter(),this.resize(),this._update(),this.fire(new v.Event("webglcontextrestored",{originalEvent:p}))},f.prototype._onMapScroll=function(p){if(p.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},f.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},f.prototype._update=function(p){return this.style?(this._styleDirty=this._styleDirty||p,this._sourcesDirty=!0,this.triggerRepaint(),this):this},f.prototype._requestRenderFrame=function(p){return this._update(),this._renderTaskQueue.add(p)},f.prototype._cancelRenderFrame=function(p){this._renderTaskQueue.remove(p)},f.prototype._render=function(p){var b,w=this,A=0,R=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(b=R.createQueryEXT(),R.beginQueryEXT(R.TIME_ELAPSED_EXT,b),A=v.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(p),!this._removed){var U=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var q=this.transform.zoom,le=v.browser.now();this.style.zoomHistory.update(q,le);var fe=new v.EvaluationParameters(q,{now:le,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),pe=fe.crossFadingFactor();pe===1&&pe===this._crossFadingFactor||(U=!0,this._crossFadingFactor=pe),this.style.update(fe)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new v.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new v.Event("load"))),this.style&&(this.style.hasTransitions()||U)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var Oe=v.browser.now()-A;R.endQueryEXT(R.TIME_ELAPSED_EXT,b),setTimeout(function(){var Te=R.getQueryObjectEXT(b,R.QUERY_RESULT_EXT)/1e6;R.deleteQueryEXT(b),w.fire(new v.Event("gpu-timing-frame",{cpuTime:Oe,gpuTime:Te}))},50)}if(this.listens("gpu-timing-layer")){var Ce=this.painter.collectGpuTimers();setTimeout(function(){var Te=w.painter.queryGpuTimers(Ce);w.fire(new v.Event("gpu-timing-layer",{layerTimes:Te}))},50)}var We=this._sourcesDirty||this._styleDirty||this._placementDirty;return We||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new v.Event("idle")),!this._loaded||this._fullyLoaded||We||(this._fullyLoaded=!0),this}},f.prototype.remove=function(){this._hash&&this._hash.remove();for(var p=0,b=this._controls;p<b.length;p+=1)b[p].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),v.window!==void 0&&(v.window.removeEventListener("resize",this._onWindowResize,!1),v.window.removeEventListener("orientationchange",this._onWindowResize,!1),v.window.removeEventListener("online",this._onWindowOnline,!1));var w=this.painter.context.gl.getExtension("WEBGL_lose_context");w&&w.loseContext(),Ru(this._canvasContainer),Ru(this._controlContainer),Ru(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new v.Event("remove"))},f.prototype.triggerRepaint=function(){var p=this;this.style&&!this._frame&&(this._frame=v.browser.frame(function(b){p._frame=null,p._render(b)}))},f.prototype._onWindowOnline=function(){this._update()},f.prototype._onWindowResize=function(p){this._trackResize&&this.resize({originalEvent:p})._update()},c.showTileBoundaries.get=function(){return!!this._showTileBoundaries},c.showTileBoundaries.set=function(p){this._showTileBoundaries!==p&&(this._showTileBoundaries=p,this._update())},c.showPadding.get=function(){return!!this._showPadding},c.showPadding.set=function(p){this._showPadding!==p&&(this._showPadding=p,this._update())},c.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},c.showCollisionBoxes.set=function(p){this._showCollisionBoxes!==p&&(this._showCollisionBoxes=p,p?this.style._generateCollisionBoxes():this._update())},c.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},c.showOverdrawInspector.set=function(p){this._showOverdrawInspector!==p&&(this._showOverdrawInspector=p,this._update())},c.repaint.get=function(){return!!this._repaint},c.repaint.set=function(p){this._repaint!==p&&(this._repaint=p,this.triggerRepaint())},c.vertices.get=function(){return!!this._vertices},c.vertices.set=function(p){this._vertices=p,this._update()},f.prototype._setCacheLimits=function(p,b){v.setCacheLimits(p,b)},c.version.get=function(){return v.version},Object.defineProperties(f.prototype,c),f}(zc);function Ru(l){l.parentNode&&l.parentNode.removeChild(l)}var iu={showCompass:!0,showZoom:!0,visualizePitch:!1},du=function(l){var f=this;this.options=v.extend({},iu,l),this._container=F.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(c){return c.preventDefault()}),this.options.showZoom&&(v.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(c){return f._map.zoomIn({},{originalEvent:c})}),F.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(c){return f._map.zoomOut({},{originalEvent:c})}),F.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(v.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(c){f.options.visualizePitch?f._map.resetNorthPitch({},{originalEvent:c}):f._map.resetNorth({},{originalEvent:c})}),this._compassIcon=F.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};du.prototype._updateZoomButtons=function(){var l=this._map.getZoom(),f=l===this._map.getMaxZoom(),c=l===this._map.getMinZoom();this._zoomInButton.disabled=f,this._zoomOutButton.disabled=c,this._zoomInButton.setAttribute("aria-disabled",f.toString()),this._zoomOutButton.setAttribute("aria-disabled",c.toString())},du.prototype._rotateCompassArrow=function(){var l=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=l},du.prototype.onAdd=function(l){return this._map=l,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new ko(this._map,this._compass,this.options.visualizePitch)),this._container},du.prototype.onRemove=function(){F.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},du.prototype._createButton=function(l,f){var c=F.create("button",l,this._container);return c.type="button",c.addEventListener("click",f),c},du.prototype._setButtonTitle=function(l,f){var c=this._map._getUIString("NavigationControl."+f);l.title=c,l.setAttribute("aria-label",c)};var ko=function(l,f,c){c===void 0&&(c=!1),this._clickTolerance=10,this.element=f,this.mouseRotate=new lf({clickTolerance:l.dragRotate._mouseRotate._clickTolerance}),this.map=l,c&&(this.mousePitch=new hl({clickTolerance:l.dragRotate._mousePitch._clickTolerance})),v.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),F.addEventListener(f,"mousedown",this.mousedown),F.addEventListener(f,"touchstart",this.touchstart,{passive:!1}),F.addEventListener(f,"touchmove",this.touchmove),F.addEventListener(f,"touchend",this.touchend),F.addEventListener(f,"touchcancel",this.reset)};function Lu(l,f,c){if(l=new v.LngLat(l.lng,l.lat),f){var p=new v.LngLat(l.lng-360,l.lat),b=new v.LngLat(l.lng+360,l.lat),w=c.locationPoint(l).distSqr(f);c.locationPoint(p).distSqr(f)<w?l=p:c.locationPoint(b).distSqr(f)<w&&(l=b)}for(;Math.abs(l.lng-c.center.lng)>180;){var A=c.locationPoint(l);if(A.x>=0&&A.y>=0&&A.x<=c.width&&A.y<=c.height)break;l.lng>c.center.lng?l.lng-=360:l.lng+=360}return l}ko.prototype.down=function(l,f){this.mouseRotate.mousedown(l,f),this.mousePitch&&this.mousePitch.mousedown(l,f),F.disableDrag()},ko.prototype.move=function(l,f){var c=this.map,p=this.mouseRotate.mousemoveWindow(l,f);if(p&&p.bearingDelta&&c.setBearing(c.getBearing()+p.bearingDelta),this.mousePitch){var b=this.mousePitch.mousemoveWindow(l,f);b&&b.pitchDelta&&c.setPitch(c.getPitch()+b.pitchDelta)}},ko.prototype.off=function(){var l=this.element;F.removeEventListener(l,"mousedown",this.mousedown),F.removeEventListener(l,"touchstart",this.touchstart,{passive:!1}),F.removeEventListener(l,"touchmove",this.touchmove),F.removeEventListener(l,"touchend",this.touchend),F.removeEventListener(l,"touchcancel",this.reset),this.offTemp()},ko.prototype.offTemp=function(){F.enableDrag(),F.removeEventListener(v.window,"mousemove",this.mousemove),F.removeEventListener(v.window,"mouseup",this.mouseup)},ko.prototype.mousedown=function(l){this.down(v.extend({},l,{ctrlKey:!0,preventDefault:function(){return l.preventDefault()}}),F.mousePos(this.element,l)),F.addEventListener(v.window,"mousemove",this.mousemove),F.addEventListener(v.window,"mouseup",this.mouseup)},ko.prototype.mousemove=function(l){this.move(l,F.mousePos(this.element,l))},ko.prototype.mouseup=function(l){this.mouseRotate.mouseupWindow(l),this.mousePitch&&this.mousePitch.mouseupWindow(l),this.offTemp()},ko.prototype.touchstart=function(l){l.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=F.touchPos(this.element,l.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return l.preventDefault()}},this._startPos))},ko.prototype.touchmove=function(l){l.targetTouches.length!==1?this.reset():(this._lastPos=F.touchPos(this.element,l.targetTouches)[0],this.move({preventDefault:function(){return l.preventDefault()}},this._lastPos))},ko.prototype.touchend=function(l){l.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},ko.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var vu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Uc(l,f,c){var p=l.classList;for(var b in vu)p.remove("mapboxgl-"+c+"-anchor-"+b);p.add("mapboxgl-"+c+"-anchor-"+f)}var Ku,vl=function(l){function f(c,p){if(l.call(this),(c instanceof v.window.HTMLElement||p)&&(c=v.extend({element:c},p)),v.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=c&&c.anchor||"center",this._color=c&&c.color||"#3FB1CE",this._scale=c&&c.scale||1,this._draggable=c&&c.draggable||!1,this._clickTolerance=c&&c.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=c&&c.rotation||0,this._rotationAlignment=c&&c.rotationAlignment||"auto",this._pitchAlignment=c&&c.pitchAlignment&&c.pitchAlignment!=="auto"?c.pitchAlignment:this._rotationAlignment,c&&c.element)this._element=c.element,this._offset=v.Point.convert(c&&c.offset||[0,0]);else{this._defaultMarker=!0,this._element=F.create("div"),this._element.setAttribute("aria-label","Map marker");var b=F.createNS("http://www.w3.org/2000/svg","svg");b.setAttributeNS(null,"display","block"),b.setAttributeNS(null,"height","41px"),b.setAttributeNS(null,"width","27px"),b.setAttributeNS(null,"viewBox","0 0 27 41");var w=F.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"stroke","none"),w.setAttributeNS(null,"stroke-width","1"),w.setAttributeNS(null,"fill","none"),w.setAttributeNS(null,"fill-rule","evenodd");var A=F.createNS("http://www.w3.org/2000/svg","g");A.setAttributeNS(null,"fill-rule","nonzero");var R=F.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"transform","translate(3.0, 29.0)"),R.setAttributeNS(null,"fill","#000000");for(var U=0,q=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];U<q.length;U+=1){var le=q[U],fe=F.createNS("http://www.w3.org/2000/svg","ellipse");fe.setAttributeNS(null,"opacity","0.04"),fe.setAttributeNS(null,"cx","10.5"),fe.setAttributeNS(null,"cy","5.80029008"),fe.setAttributeNS(null,"rx",le.rx),fe.setAttributeNS(null,"ry",le.ry),R.appendChild(fe)}var pe=F.createNS("http://www.w3.org/2000/svg","g");pe.setAttributeNS(null,"fill",this._color);var Oe=F.createNS("http://www.w3.org/2000/svg","path");Oe.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),pe.appendChild(Oe);var Ce=F.createNS("http://www.w3.org/2000/svg","g");Ce.setAttributeNS(null,"opacity","0.25"),Ce.setAttributeNS(null,"fill","#000000");var We=F.createNS("http://www.w3.org/2000/svg","path");We.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Ce.appendChild(We);var Te=F.createNS("http://www.w3.org/2000/svg","g");Te.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Te.setAttributeNS(null,"fill","#FFFFFF");var He=F.createNS("http://www.w3.org/2000/svg","g");He.setAttributeNS(null,"transform","translate(8.0, 8.0)");var Qe=F.createNS("http://www.w3.org/2000/svg","circle");Qe.setAttributeNS(null,"fill","#000000"),Qe.setAttributeNS(null,"opacity","0.25"),Qe.setAttributeNS(null,"cx","5.5"),Qe.setAttributeNS(null,"cy","5.5"),Qe.setAttributeNS(null,"r","5.4999962");var yt=F.createNS("http://www.w3.org/2000/svg","circle");yt.setAttributeNS(null,"fill","#FFFFFF"),yt.setAttributeNS(null,"cx","5.5"),yt.setAttributeNS(null,"cy","5.5"),yt.setAttributeNS(null,"r","5.4999962"),He.appendChild(Qe),He.appendChild(yt),A.appendChild(R),A.appendChild(pe),A.appendChild(Ce),A.appendChild(Te),A.appendChild(He),b.appendChild(A),b.setAttributeNS(null,"height",41*this._scale+"px"),b.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(b),this._offset=v.Point.convert(c&&c.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(Vt){Vt.preventDefault()}),this._element.addEventListener("mousedown",function(Vt){Vt.preventDefault()}),Uc(this._element,this._anchor,"marker"),this._popup=null}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.addTo=function(c){return this.remove(),this._map=c,c.getCanvasContainer().appendChild(this._element),c.on("move",this._update),c.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},f.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),F.remove(this._element),this._popup&&this._popup.remove(),this},f.prototype.getLngLat=function(){return this._lngLat},f.prototype.setLngLat=function(c){return this._lngLat=v.LngLat.convert(c),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},f.prototype.getElement=function(){return this._element},f.prototype.setPopup=function(c){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),c){if(!("offset"in c.options)){var p=Math.sqrt(Math.pow(13.5,2)/2);c.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[p,-1*(24.6+p)],"bottom-right":[-p,-1*(24.6+p)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=c,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},f.prototype._onKeyPress=function(c){var p=c.code,b=c.charCode||c.keyCode;p!=="Space"&&p!=="Enter"&&b!==32&&b!==13||this.togglePopup()},f.prototype._onMapClick=function(c){var p=c.originalEvent.target,b=this._element;this._popup&&(p===b||b.contains(p))&&this.togglePopup()},f.prototype.getPopup=function(){return this._popup},f.prototype.togglePopup=function(){var c=this._popup;return c?(c.isOpen()?c.remove():c.addTo(this._map),this):this},f.prototype._update=function(c){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=Lu(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var p="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?p="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(p="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var b="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?b="rotateX(0deg)":this._pitchAlignment==="map"&&(b="rotateX("+this._map.getPitch()+"deg)"),c&&c.type!=="moveend"||(this._pos=this._pos.round()),F.setTransform(this._element,vu[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+b+" "+p)}},f.prototype.getOffset=function(){return this._offset},f.prototype.setOffset=function(c){return this._offset=v.Point.convert(c),this._update(),this},f.prototype._onMove=function(c){if(!this._isDragging){var p=this._clickTolerance||this._map._clickTolerance;this._isDragging=c.point.dist(this._pointerdownPos)>=p}this._isDragging&&(this._pos=c.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new v.Event("dragstart"))),this.fire(new v.Event("drag")))},f.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new v.Event("dragend")),this._state="inactive"},f.prototype._addDragHandler=function(c){this._element.contains(c.originalEvent.target)&&(c.preventDefault(),this._positionDelta=c.point.sub(this._pos).add(this._offset),this._pointerdownPos=c.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},f.prototype.setDraggable=function(c){return this._draggable=!!c,this._map&&(c?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},f.prototype.isDraggable=function(){return this._draggable},f.prototype.setRotation=function(c){return this._rotation=c||0,this._update(),this},f.prototype.getRotation=function(){return this._rotation},f.prototype.setRotationAlignment=function(c){return this._rotationAlignment=c||"auto",this._update(),this},f.prototype.getRotationAlignment=function(){return this._rotationAlignment},f.prototype.setPitchAlignment=function(c){return this._pitchAlignment=c&&c!=="auto"?c:this._rotationAlignment,this._update(),this},f.prototype.getPitchAlignment=function(){return this._pitchAlignment},f}(v.Evented),hf={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},Nl=0,Bl=!1,Hf=function(l){function f(c){l.call(this),this.options=v.extend({},hf,c),v.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.onAdd=function(c){var p;return this._map=c,this._container=F.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),p=this._setupUI,Ku!==void 0?p(Ku):v.window.navigator.permissions!==void 0?v.window.navigator.permissions.query({name:"geolocation"}).then(function(b){p(Ku=b.state!=="denied")}):p(Ku=!!v.window.navigator.geolocation),this._container},f.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(v.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),F.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Nl=0,Bl=!1},f.prototype._isOutOfMapMaxBounds=function(c){var p=this._map.getMaxBounds(),b=c.coords;return p&&(b.longitude<p.getWest()||b.longitude>p.getEast()||b.latitude<p.getSouth()||b.latitude>p.getNorth())},f.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},f.prototype._onSuccess=function(c){if(this._map){if(this._isOutOfMapMaxBounds(c))return this._setErrorState(),this.fire(new v.Event("outofmaxbounds",c)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=c,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(c),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(c),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new v.Event("geolocate",c)),this._finish()}},f.prototype._updateCamera=function(c){var p=new v.LngLat(c.coords.longitude,c.coords.latitude),b=c.coords.accuracy,w=this._map.getBearing(),A=v.extend({bearing:w},this.options.fitBoundsOptions);this._map.fitBounds(p.toBounds(b),A,{geolocateSource:!0})},f.prototype._updateMarker=function(c){if(c){var p=new v.LngLat(c.coords.longitude,c.coords.latitude);this._accuracyCircleMarker.setLngLat(p).addTo(this._map),this._userLocationDotMarker.setLngLat(p).addTo(this._map),this._accuracy=c.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},f.prototype._updateCircleRadius=function(){var c=this._map._container.clientHeight/2,p=this._map.unproject([0,c]),b=this._map.unproject([1,c]),w=p.distanceTo(b),A=Math.ceil(2*this._accuracy/w);this._circleElement.style.width=A+"px",this._circleElement.style.height=A+"px"},f.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},f.prototype._onError=function(c){if(this._map){if(this.options.trackUserLocation)if(c.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var p=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=p,this._geolocateButton.setAttribute("aria-label",p),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(c.code===3&&Bl)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new v.Event("error",c)),this._finish()}},f.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},f.prototype._setupUI=function(c){var p=this;if(this._container.addEventListener("contextmenu",function(A){return A.preventDefault()}),this._geolocateButton=F.create("button","mapboxgl-ctrl-geolocate",this._container),F.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",c===!1){v.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var b=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=b,this._geolocateButton.setAttribute("aria-label",b)}else{var w=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=w,this._geolocateButton.setAttribute("aria-label",w)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=F.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new vl(this._dotElement),this._circleElement=F.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new vl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(A){A.geolocateSource||p._watchState!=="ACTIVE_LOCK"||A.originalEvent&&A.originalEvent.type==="resize"||(p._watchState="BACKGROUND",p._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),p._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),p.fire(new v.Event("trackuserlocationend")))})},f.prototype.trigger=function(){if(!this._setup)return v.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new v.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Nl--,Bl=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new v.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new v.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var c;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++Nl>1?(c={maximumAge:6e5,timeout:0},Bl=!0):(c=this.options.positionOptions,Bl=!1),this._geolocationWatchID=v.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,c)}}else v.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},f.prototype._clearWatch=function(){v.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},f}(v.Evented),ml={maxWidth:100,unit:"metric"},gl=function(l){this.options=v.extend({},ml,l),v.bindAll(["_onMove","setUnit"],this)};function pf(l,f,c){var p=c&&c.maxWidth||100,b=l._container.clientHeight/2,w=l.unproject([0,b]),A=l.unproject([p,b]),R=w.distanceTo(A);if(c&&c.unit==="imperial"){var U=3.2808*R;U>5280?Qo(f,p,U/5280,l._getUIString("ScaleControl.Miles")):Qo(f,p,U,l._getUIString("ScaleControl.Feet"))}else c&&c.unit==="nautical"?Qo(f,p,R/1852,l._getUIString("ScaleControl.NauticalMiles")):R>=1e3?Qo(f,p,R/1e3,l._getUIString("ScaleControl.Kilometers")):Qo(f,p,R,l._getUIString("ScaleControl.Meters"))}function Qo(l,f,c,p){var b,w,A,R=(b=c,(w=Math.pow(10,(""+Math.floor(b)).length-1))*(A=(A=b/w)>=10?10:A>=5?5:A>=3?3:A>=2?2:A>=1?1:function(U){var q=Math.pow(10,Math.ceil(-Math.log(U)/Math.LN10));return Math.round(U*q)/q}(A)));l.style.width=f*(R/c)+"px",l.innerHTML=R+"&nbsp;"+p}gl.prototype.getDefaultPosition=function(){return"bottom-left"},gl.prototype._onMove=function(){pf(this._map,this._container,this.options)},gl.prototype.onAdd=function(l){return this._map=l,this._container=F.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",l.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},gl.prototype.onRemove=function(){F.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},gl.prototype.setUnit=function(l){this.options.unit=l,pf(this._map,this._container,this.options)};var Ws=function(l){this._fullscreen=!1,l&&l.container&&(l.container instanceof v.window.HTMLElement?this._container=l.container:v.warnOnce("Full screen control 'container' must be a DOM element.")),v.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in v.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in v.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in v.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in v.window.document&&(this._fullscreenchange="MSFullscreenChange")};Ws.prototype.onAdd=function(l){return this._map=l,this._container||(this._container=this._map.getContainer()),this._controlContainer=F.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",v.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},Ws.prototype.onRemove=function(){F.remove(this._controlContainer),this._map=null,v.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},Ws.prototype._checkFullscreenSupport=function(){return!!(v.window.document.fullscreenEnabled||v.window.document.mozFullScreenEnabled||v.window.document.msFullscreenEnabled||v.window.document.webkitFullscreenEnabled)},Ws.prototype._setupUI=function(){var l=this._fullscreenButton=F.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);F.create("span","mapboxgl-ctrl-icon",l).setAttribute("aria-hidden",!0),l.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),v.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},Ws.prototype._updateTitle=function(){var l=this._getTitle();this._fullscreenButton.setAttribute("aria-label",l),this._fullscreenButton.title=l},Ws.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},Ws.prototype._isFullscreen=function(){return this._fullscreen},Ws.prototype._changeIcon=function(){(v.window.document.fullscreenElement||v.window.document.mozFullScreenElement||v.window.document.webkitFullscreenElement||v.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},Ws.prototype._onClickFullscreen=function(){this._isFullscreen()?v.window.document.exitFullscreen?v.window.document.exitFullscreen():v.window.document.mozCancelFullScreen?v.window.document.mozCancelFullScreen():v.window.document.msExitFullscreen?v.window.document.msExitFullscreen():v.window.document.webkitCancelFullScreen&&v.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var ku={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Zc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),pc=function(l){function f(c){l.call(this),this.options=v.extend(Object.create(ku),c),v.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.addTo=function(c){return this._map&&this.remove(),this._map=c,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new v.Event("open")),this},f.prototype.isOpen=function(){return!!this._map},f.prototype.remove=function(){return this._content&&F.remove(this._content),this._container&&(F.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new v.Event("close")),this},f.prototype.getLngLat=function(){return this._lngLat},f.prototype.setLngLat=function(c){return this._lngLat=v.LngLat.convert(c),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},f.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},f.prototype.getElement=function(){return this._container},f.prototype.setText=function(c){return this.setDOMContent(v.window.document.createTextNode(c))},f.prototype.setHTML=function(c){var p,b=v.window.document.createDocumentFragment(),w=v.window.document.createElement("body");for(w.innerHTML=c;p=w.firstChild;)b.appendChild(p);return this.setDOMContent(b)},f.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},f.prototype.setMaxWidth=function(c){return this.options.maxWidth=c,this._update(),this},f.prototype.setDOMContent=function(c){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=F.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(c),this._createCloseButton(),this._update(),this._focusFirstElement(),this},f.prototype.addClassName=function(c){this._container&&this._container.classList.add(c)},f.prototype.removeClassName=function(c){this._container&&this._container.classList.remove(c)},f.prototype.setOffset=function(c){return this.options.offset=c,this._update(),this},f.prototype.toggleClassName=function(c){if(this._container)return this._container.classList.toggle(c)},f.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=F.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},f.prototype._onMouseUp=function(c){this._update(c.point)},f.prototype._onMouseMove=function(c){this._update(c.point)},f.prototype._onDrag=function(c){this._update(c.point)},f.prototype._update=function(c){var p=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=F.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=F.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(fe){return p._container.classList.add(fe)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Lu(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||c)){var b=this._pos=this._trackPointer&&c?c:this._map.project(this._lngLat),w=this.options.anchor,A=function fe(pe){if(pe){if(typeof pe=="number"){var Oe=Math.round(Math.sqrt(.5*Math.pow(pe,2)));return{center:new v.Point(0,0),top:new v.Point(0,pe),"top-left":new v.Point(Oe,Oe),"top-right":new v.Point(-Oe,Oe),bottom:new v.Point(0,-pe),"bottom-left":new v.Point(Oe,-Oe),"bottom-right":new v.Point(-Oe,-Oe),left:new v.Point(pe,0),right:new v.Point(-pe,0)}}if(pe instanceof v.Point||Array.isArray(pe)){var Ce=v.Point.convert(pe);return{center:Ce,top:Ce,"top-left":Ce,"top-right":Ce,bottom:Ce,"bottom-left":Ce,"bottom-right":Ce,left:Ce,right:Ce}}return{center:v.Point.convert(pe.center||[0,0]),top:v.Point.convert(pe.top||[0,0]),"top-left":v.Point.convert(pe["top-left"]||[0,0]),"top-right":v.Point.convert(pe["top-right"]||[0,0]),bottom:v.Point.convert(pe.bottom||[0,0]),"bottom-left":v.Point.convert(pe["bottom-left"]||[0,0]),"bottom-right":v.Point.convert(pe["bottom-right"]||[0,0]),left:v.Point.convert(pe.left||[0,0]),right:v.Point.convert(pe.right||[0,0])}}return fe(new v.Point(0,0))}(this.options.offset);if(!w){var R,U=this._container.offsetWidth,q=this._container.offsetHeight;R=b.y+A.bottom.y<q?["top"]:b.y>this._map.transform.height-q?["bottom"]:[],b.x<U/2?R.push("left"):b.x>this._map.transform.width-U/2&&R.push("right"),w=R.length===0?"bottom":R.join("-")}var le=b.add(A[w]).round();F.setTransform(this._container,vu[w]+" translate("+le.x+"px,"+le.y+"px)"),Uc(this._container,w,"popup")}},f.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var c=this._container.querySelector(Zc);c&&c.focus()}},f.prototype._onClose=function(){this.remove()},f}(v.Evented),yl={version:v.version,supported:Q,setRTLTextPlugin:v.setRTLTextPlugin,getRTLTextPluginStatus:v.getRTLTextPluginStatus,Map:hc,NavigationControl:du,GeolocateControl:Hf,AttributionControl:is,ScaleControl:gl,FullscreenControl:Ws,Popup:pc,Marker:vl,Style:ms,LngLat:v.LngLat,LngLatBounds:v.LngLatBounds,Point:v.Point,MercatorCoordinate:v.MercatorCoordinate,Evented:v.Evented,config:v.config,prewarm:function(){Tt().acquire(Ft)},clearPrewarmedResources:function(){var l=gn;l&&(l.isPreloaded()&&l.numActive()===1?(l.release(Ft),gn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return v.config.ACCESS_TOKEN},set accessToken(l){v.config.ACCESS_TOKEN=l},get baseApiUrl(){return v.config.API_URL},set baseApiUrl(l){v.config.API_URL=l},get workerCount(){return pr.workerCount},set workerCount(l){pr.workerCount=l},get maxParallelImageRequests(){return v.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(l){v.config.MAX_PARALLEL_IMAGE_REQUESTS=l},clearStorage:function(l){v.clearTileCache(l)},workerUrl:""};return yl}),X})},28660:function(Ue,W,L){var X=L(34155);/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var j;(function(v){(function(Q){var F=typeof L.g=="object"?L.g:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),J=ne(v);typeof F.Reflect=="undefined"?F.Reflect=v:J=ne(F.Reflect,J),Q(J);function ne(ye,K){return function(Ne,Ve){typeof ye[Ne]!="function"&&Object.defineProperty(ye,Ne,{configurable:!0,writable:!0,value:Ve}),K&&K(Ne,Ve)}}})(function(Q){var F=Object.prototype.hasOwnProperty,J=typeof Symbol=="function",ne=J&&typeof Symbol.toPrimitive!="undefined"?Symbol.toPrimitive:"@@toPrimitive",ye=J&&typeof Symbol.iterator!="undefined"?Symbol.iterator:"@@iterator",K=typeof Object.create=="function",Ne={__proto__:[]}instanceof Array,Ve=!K&&!Ne,ke={create:K?function(){return rs(Object.create(null))}:Ne?function(){return rs({__proto__:null})}:function(){return rs({})},has:Ve?function(Dt,tr){return F.call(Dt,tr)}:function(Dt,tr){return tr in Dt},get:Ve?function(Dt,tr){return F.call(Dt,tr)?Dt[tr]:void 0}:function(Dt,tr){return Dt[tr]}},ot=Object.getPrototypeOf(Function),Jt=typeof X=="object"&&{NODE_ENV:"production"}&&{NODE_ENV:"production"}.REFLECT_METADATA_USE_MAP_POLYFILL==="true",pt=!Jt&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:he(),Zt=!Jt&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:On(),_t=!Jt&&typeof WeakMap=="function"?WeakMap:Ua(),nt=new _t;function et(Dt,tr,Er,$r){if(cn(Er)){if(!Oi(Dt))throw new TypeError;if(!ca(tr))throw new TypeError;return Mr(Dt,tr)}else{if(!Oi(Dt))throw new TypeError;if(!ri(tr))throw new TypeError;if(!ri($r)&&!cn($r)&&!ci($r))throw new TypeError;return ci($r)&&($r=void 0),Er=Vi(Er),jr(Dt,tr,Er,$r)}}Q("decorate",et);function kt(Dt,tr){function Er($r,xn){if(!ri($r))throw new TypeError;if(!cn(xn)&&!Ci(xn))throw new TypeError;Lt(Dt,tr,$r,xn)}return Er}Q("metadata",kt);function Y(Dt,tr,Er,$r){if(!ri(Er))throw new TypeError;return cn($r)||($r=Vi($r)),Lt(Dt,tr,Er,$r)}Q("defineMetadata",Y);function Wt(Dt,tr,Er){if(!ri(tr))throw new TypeError;return cn(Er)||(Er=Vi(Er)),we(Dt,tr,Er)}Q("hasMetadata",Wt);function st(Dt,tr,Er){if(!ri(tr))throw new TypeError;return cn(Er)||(Er=Vi(Er)),Le(Dt,tr,Er)}Q("hasOwnMetadata",st);function Ye(Dt,tr,Er){if(!ri(tr))throw new TypeError;return cn(Er)||(Er=Vi(Er)),Et(Dt,tr,Er)}Q("getMetadata",Ye);function ct(Dt,tr,Er){if(!ri(tr))throw new TypeError;return cn(Er)||(Er=Vi(Er)),gt(Dt,tr,Er)}Q("getOwnMetadata",ct);function Je(Dt,tr){if(!ri(Dt))throw new TypeError;return cn(tr)||(tr=Vi(tr)),Yt(Dt,tr)}Q("getMetadataKeys",Je);function Rt(Dt,tr){if(!ri(Dt))throw new TypeError;return cn(tr)||(tr=Vi(tr)),br(Dt,tr)}Q("getOwnMetadataKeys",Rt);function dr(Dt,tr,Er){if(!ri(tr))throw new TypeError;cn(Er)||(Er=Vi(Er));var $r=C(tr,Er,!1);if(cn($r)||!$r.delete(Dt))return!1;if($r.size>0)return!0;var xn=nt.get(tr);return xn.delete(Er),xn.size>0||nt.delete(tr),!0}Q("deleteMetadata",dr);function Mr(Dt,tr){for(var Er=Dt.length-1;Er>=0;--Er){var $r=Dt[Er],xn=$r(tr);if(!cn(xn)&&!ci(xn)){if(!ca(xn))throw new TypeError;tr=xn}}return tr}function jr(Dt,tr,Er,$r){for(var xn=Dt.length-1;xn>=0;--xn){var Dn=Dt[xn],pi=Dn(tr,Er,$r);if(!cn(pi)&&!ci(pi)){if(!ri(pi))throw new TypeError;$r=pi}}return $r}function C(Dt,tr,Er){var $r=nt.get(Dt);if(cn($r)){if(!Er)return;$r=new pt,nt.set(Dt,$r)}var xn=$r.get(tr);if(cn(xn)){if(!Er)return;xn=new pt,$r.set(tr,xn)}return xn}function we(Dt,tr,Er){var $r=Le(Dt,tr,Er);if($r)return!0;var xn=Oo(tr);return ci(xn)?!1:we(Dt,xn,Er)}function Le(Dt,tr,Er){var $r=C(tr,Er,!1);return cn($r)?!1:hi($r.has(Dt))}function Et(Dt,tr,Er){var $r=Le(Dt,tr,Er);if($r)return gt(Dt,tr,Er);var xn=Oo(tr);if(!ci(xn))return Et(Dt,xn,Er)}function gt(Dt,tr,Er){var $r=C(tr,Er,!1);if(!cn($r))return $r.get(Dt)}function Lt(Dt,tr,Er,$r){var xn=C(Er,$r,!0);xn.set(Dt,tr)}function Yt(Dt,tr){var Er=br(Dt,tr),$r=Oo(Dt);if($r===null)return Er;var xn=Yt($r,tr);if(xn.length<=0)return Er;if(Er.length<=0)return xn;for(var Dn=new Zt,pi=[],qn=0,on=Er;qn<on.length;qn++){var Ri=on[qn],Ii=Dn.has(Ri);Ii||(Dn.add(Ri),pi.push(Ri))}for(var Qa=0,hs=xn;Qa<hs.length;Qa++){var Ri=hs[Qa],Ii=Dn.has(Ri);Ii||(Dn.add(Ri),pi.push(Ri))}return pi}function br(Dt,tr){var Er=[],$r=C(Dt,tr,!1);if(cn($r))return Er;for(var xn=$r.keys(),Dn=Xn(xn),pi=0;;){var qn=Ni(Dn);if(!qn)return Er.length=pi,Er;var on=bi(qn);try{Er[pi]=on}catch(Ri){try{Ki(Dn)}finally{throw Ri}}pi++}}function Yn(Dt){if(Dt===null)return 1;switch(typeof Dt){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return Dt===null?1:6;default:return 6}}function cn(Dt){return Dt===void 0}function ci(Dt){return Dt===null}function Zn(Dt){return typeof Dt=="symbol"}function ri(Dt){return typeof Dt=="object"?Dt!==null:typeof Dt=="function"}function fi(Dt,tr){switch(Yn(Dt)){case 0:return Dt;case 1:return Dt;case 2:return Dt;case 3:return Dt;case 4:return Dt;case 5:return Dt}var Er=tr===3?"string":tr===5?"number":"default",$r=ma(Dt,ne);if($r!==void 0){var xn=$r.call(Dt,Er);if(ri(xn))throw new TypeError;return xn}return Gn(Dt,Er==="default"?"number":Er)}function Gn(Dt,tr){if(tr==="string"){var Er=Dt.toString;if(qi(Er)){var $r=Er.call(Dt);if(!ri($r))return $r}var xn=Dt.valueOf;if(qi(xn)){var $r=xn.call(Dt);if(!ri($r))return $r}}else{var xn=Dt.valueOf;if(qi(xn)){var $r=xn.call(Dt);if(!ri($r))return $r}var Dn=Dt.toString;if(qi(Dn)){var $r=Dn.call(Dt);if(!ri($r))return $r}}throw new TypeError}function hi(Dt){return!!Dt}function la(Dt){return""+Dt}function Vi(Dt){var tr=fi(Dt,3);return Zn(tr)?tr:la(tr)}function Oi(Dt){return Array.isArray?Array.isArray(Dt):Dt instanceof Object?Dt instanceof Array:Object.prototype.toString.call(Dt)==="[object Array]"}function qi(Dt){return typeof Dt=="function"}function ca(Dt){return typeof Dt=="function"}function Ci(Dt){switch(Yn(Dt)){case 3:return!0;case 4:return!0;default:return!1}}function ma(Dt,tr){var Er=Dt[tr];if(Er!=null){if(!qi(Er))throw new TypeError;return Er}}function Xn(Dt){var tr=ma(Dt,ye);if(!qi(tr))throw new TypeError;var Er=tr.call(Dt);if(!ri(Er))throw new TypeError;return Er}function bi(Dt){return Dt.value}function Ni(Dt){var tr=Dt.next();return tr.done?!1:tr}function Ki(Dt){var tr=Dt.return;tr&&tr.call(Dt)}function Oo(Dt){var tr=Object.getPrototypeOf(Dt);if(typeof Dt!="function"||Dt===ot||tr!==ot)return tr;var Er=Dt.prototype,$r=Er&&Object.getPrototypeOf(Er);if($r==null||$r===Object.prototype)return tr;var xn=$r.constructor;return typeof xn!="function"||xn===Dt?tr:xn}function he(){var Dt={},tr=[],Er=function(){function pi(qn,on,Ri){this._index=0,this._keys=qn,this._values=on,this._selector=Ri}return pi.prototype["@@iterator"]=function(){return this},pi.prototype[ye]=function(){return this},pi.prototype.next=function(){var qn=this._index;if(qn>=0&&qn<this._keys.length){var on=this._selector(this._keys[qn],this._values[qn]);return qn+1>=this._keys.length?(this._index=-1,this._keys=tr,this._values=tr):this._index++,{value:on,done:!1}}return{value:void 0,done:!0}},pi.prototype.throw=function(qn){throw this._index>=0&&(this._index=-1,this._keys=tr,this._values=tr),qn},pi.prototype.return=function(qn){return this._index>=0&&(this._index=-1,this._keys=tr,this._values=tr),{value:qn,done:!0}},pi}();return function(){function pi(){this._keys=[],this._values=[],this._cacheKey=Dt,this._cacheIndex=-2}return Object.defineProperty(pi.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),pi.prototype.has=function(qn){return this._find(qn,!1)>=0},pi.prototype.get=function(qn){var on=this._find(qn,!1);return on>=0?this._values[on]:void 0},pi.prototype.set=function(qn,on){var Ri=this._find(qn,!0);return this._values[Ri]=on,this},pi.prototype.delete=function(qn){var on=this._find(qn,!1);if(on>=0){for(var Ri=this._keys.length,Ii=on+1;Ii<Ri;Ii++)this._keys[Ii-1]=this._keys[Ii],this._values[Ii-1]=this._values[Ii];return this._keys.length--,this._values.length--,qn===this._cacheKey&&(this._cacheKey=Dt,this._cacheIndex=-2),!0}return!1},pi.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=Dt,this._cacheIndex=-2},pi.prototype.keys=function(){return new Er(this._keys,this._values,$r)},pi.prototype.values=function(){return new Er(this._keys,this._values,xn)},pi.prototype.entries=function(){return new Er(this._keys,this._values,Dn)},pi.prototype["@@iterator"]=function(){return this.entries()},pi.prototype[ye]=function(){return this.entries()},pi.prototype._find=function(qn,on){return this._cacheKey!==qn&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=qn)),this._cacheIndex<0&&on&&(this._cacheIndex=this._keys.length,this._keys.push(qn),this._values.push(void 0)),this._cacheIndex},pi}();function $r(pi,qn){return pi}function xn(pi,qn){return qn}function Dn(pi,qn){return[pi,qn]}}function On(){return function(){function Dt(){this._map=new pt}return Object.defineProperty(Dt.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),Dt.prototype.has=function(tr){return this._map.has(tr)},Dt.prototype.add=function(tr){return this._map.set(tr,tr),this},Dt.prototype.delete=function(tr){return this._map.delete(tr)},Dt.prototype.clear=function(){this._map.clear()},Dt.prototype.keys=function(){return this._map.keys()},Dt.prototype.values=function(){return this._map.values()},Dt.prototype.entries=function(){return this._map.entries()},Dt.prototype["@@iterator"]=function(){return this.keys()},Dt.prototype[ye]=function(){return this.keys()},Dt}()}function Ua(){var Dt=16,tr=ke.create(),Er=$r();return function(){function on(){this._key=$r()}return on.prototype.has=function(Ri){var Ii=xn(Ri,!1);return Ii!==void 0?ke.has(Ii,this._key):!1},on.prototype.get=function(Ri){var Ii=xn(Ri,!1);return Ii!==void 0?ke.get(Ii,this._key):void 0},on.prototype.set=function(Ri,Ii){var Qa=xn(Ri,!0);return Qa[this._key]=Ii,this},on.prototype.delete=function(Ri){var Ii=xn(Ri,!1);return Ii!==void 0?delete Ii[this._key]:!1},on.prototype.clear=function(){this._key=$r()},on}();function $r(){var on;do on="@@WeakMap@@"+qn();while(ke.has(tr,on));return tr[on]=!0,on}function xn(on,Ri){if(!F.call(on,Er)){if(!Ri)return;Object.defineProperty(on,Er,{value:ke.create()})}return on[Er]}function Dn(on,Ri){for(var Ii=0;Ii<Ri;++Ii)on[Ii]=Math.random()*255|0;return on}function pi(on){return typeof Uint8Array=="function"?typeof crypto!="undefined"?crypto.getRandomValues(new Uint8Array(on)):typeof msCrypto!="undefined"?msCrypto.getRandomValues(new Uint8Array(on)):Dn(new Uint8Array(on),on):Dn(new Array(on),on)}function qn(){var on=pi(Dt);on[6]=on[6]&79|64,on[8]=on[8]&191|128;for(var Ri="",Ii=0;Ii<Dt;++Ii){var Qa=on[Ii];(Ii===4||Ii===6||Ii===8)&&(Ri+="-"),Qa<16&&(Ri+="0"),Ri+=Qa.toString(16).toLowerCase()}return Ri}}function rs(Dt){return Dt.__=void 0,delete Dt.__,Dt}})})(j||(j={}))},69848:function(Ue){(function(W,L){Ue.exports=L()})(this,function(){"use strict";function W(st,Ye,ct,Je,Rt,dr){if(!(Rt-Je<=ct)){var Mr=Je+Rt>>1;L(st,Ye,Mr,Je,Rt,dr%2),W(st,Ye,ct,Je,Mr-1,dr+1),W(st,Ye,ct,Mr+1,Rt,dr+1)}}function L(st,Ye,ct,Je,Rt,dr){for(;Rt>Je;){if(Rt-Je>600){var Mr=Rt-Je+1,jr=ct-Je+1,C=Math.log(Mr),we=.5*Math.exp(2*C/3),Le=.5*Math.sqrt(C*we*(Mr-we)/Mr)*(jr-Mr/2<0?-1:1),Et=Math.max(Je,Math.floor(ct-jr*we/Mr+Le)),gt=Math.min(Rt,Math.floor(ct+(Mr-jr)*we/Mr+Le));L(st,Ye,ct,Et,gt,dr)}var Lt=Ye[2*ct+dr],Yt=Je,br=Rt;for(X(st,Ye,Je,ct),Ye[2*Rt+dr]>Lt&&X(st,Ye,Je,Rt);Yt<br;){for(X(st,Ye,Yt,br),Yt++,br--;Ye[2*Yt+dr]<Lt;)Yt++;for(;Ye[2*br+dr]>Lt;)br--}Ye[2*Je+dr]===Lt?X(st,Ye,Je,br):(br++,X(st,Ye,br,Rt)),br<=ct&&(Je=br+1),ct<=br&&(Rt=br-1)}}function X(st,Ye,ct,Je){j(st,ct,Je),j(Ye,2*ct,2*Je),j(Ye,2*ct+1,2*Je+1)}function j(st,Ye,ct){var Je=st[Ye];st[Ye]=st[ct],st[ct]=Je}function v(st,Ye,ct,Je,Rt,dr,Mr){for(var jr=[0,st.length-1,0],C=[],we,Le;jr.length;){var Et=jr.pop(),gt=jr.pop(),Lt=jr.pop();if(gt-Lt<=Mr){for(var Yt=Lt;Yt<=gt;Yt++)we=Ye[2*Yt],Le=Ye[2*Yt+1],we>=ct&&we<=Rt&&Le>=Je&&Le<=dr&&C.push(st[Yt]);continue}var br=Math.floor((Lt+gt)/2);we=Ye[2*br],Le=Ye[2*br+1],we>=ct&&we<=Rt&&Le>=Je&&Le<=dr&&C.push(st[br]);var Yn=(Et+1)%2;(Et===0?ct<=we:Je<=Le)&&(jr.push(Lt),jr.push(br-1),jr.push(Yn)),(Et===0?Rt>=we:dr>=Le)&&(jr.push(br+1),jr.push(gt),jr.push(Yn))}return C}function Q(st,Ye,ct,Je,Rt,dr){for(var Mr=[0,st.length-1,0],jr=[],C=Rt*Rt;Mr.length;){var we=Mr.pop(),Le=Mr.pop(),Et=Mr.pop();if(Le-Et<=dr){for(var gt=Et;gt<=Le;gt++)F(Ye[2*gt],Ye[2*gt+1],ct,Je)<=C&&jr.push(st[gt]);continue}var Lt=Math.floor((Et+Le)/2),Yt=Ye[2*Lt],br=Ye[2*Lt+1];F(Yt,br,ct,Je)<=C&&jr.push(st[Lt]);var Yn=(we+1)%2;(we===0?ct-Rt<=Yt:Je-Rt<=br)&&(Mr.push(Et),Mr.push(Lt-1),Mr.push(Yn)),(we===0?ct+Rt>=Yt:Je+Rt>=br)&&(Mr.push(Lt+1),Mr.push(Le),Mr.push(Yn))}return jr}function F(st,Ye,ct,Je){var Rt=st-ct,dr=Ye-Je;return Rt*Rt+dr*dr}var J=function(st){return st[0]},ne=function(st){return st[1]},ye=function(Ye,ct,Je,Rt,dr){ct===void 0&&(ct=J),Je===void 0&&(Je=ne),Rt===void 0&&(Rt=64),dr===void 0&&(dr=Float64Array),this.nodeSize=Rt,this.points=Ye;for(var Mr=Ye.length<65536?Uint16Array:Uint32Array,jr=this.ids=new Mr(Ye.length),C=this.coords=new dr(Ye.length*2),we=0;we<Ye.length;we++)jr[we]=we,C[2*we]=ct(Ye[we]),C[2*we+1]=Je(Ye[we]);W(jr,C,Rt,0,jr.length-1,0)};ye.prototype.range=function(Ye,ct,Je,Rt){return v(this.ids,this.coords,Ye,ct,Je,Rt,this.nodeSize)},ye.prototype.within=function(Ye,ct,Je){return Q(this.ids,this.coords,Ye,ct,Je,this.nodeSize)};var K={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(st){return st}},Ne=Math.fround||function(st){return function(Ye){return st[0]=+Ye,st[0]}}(new Float32Array(1)),Ve=function(Ye){this.options=kt(Object.create(K),Ye),this.trees=new Array(this.options.maxZoom+1)};Ve.prototype.load=function(Ye){var ct=this.options,Je=ct.log,Rt=ct.minZoom,dr=ct.maxZoom,Mr=ct.nodeSize;Je&&console.time("total time");var jr="prepare "+Ye.length+" points";Je&&console.time(jr),this.points=Ye;for(var C=[],we=0;we<Ye.length;we++)!Ye[we].geometry||C.push(ot(Ye[we],we));this.trees[dr+1]=new ye(C,Y,Wt,Mr,Float32Array),Je&&console.timeEnd(jr);for(var Le=dr;Le>=Rt;Le--){var Et=+Date.now();C=this._cluster(C,Le),this.trees[Le]=new ye(C,Y,Wt,Mr,Float32Array),Je&&console.log("z%d: %d clusters in %dms",Le,C.length,+Date.now()-Et)}return Je&&console.timeEnd("total time"),this},Ve.prototype.getClusters=function(Ye,ct){var Je=((Ye[0]+180)%360+360)%360-180,Rt=Math.max(-90,Math.min(90,Ye[1])),dr=Ye[2]===180?180:((Ye[2]+180)%360+360)%360-180,Mr=Math.max(-90,Math.min(90,Ye[3]));if(Ye[2]-Ye[0]>=360)Je=-180,dr=180;else if(Je>dr){var jr=this.getClusters([Je,Rt,180,Mr],ct),C=this.getClusters([-180,Rt,dr,Mr],ct);return jr.concat(C)}for(var we=this.trees[this._limitZoom(ct)],Le=we.range(Zt(Je),_t(Mr),Zt(dr),_t(Rt)),Et=[],gt=0,Lt=Le;gt<Lt.length;gt+=1){var Yt=Lt[gt],br=we.points[Yt];Et.push(br.numPoints?Jt(br):this.points[br.index])}return Et},Ve.prototype.getChildren=function(Ye){var ct=this._getOriginId(Ye),Je=this._getOriginZoom(Ye),Rt="No cluster with the specified id.",dr=this.trees[Je];if(!dr)throw new Error(Rt);var Mr=dr.points[ct];if(!Mr)throw new Error(Rt);for(var jr=this.options.radius/(this.options.extent*Math.pow(2,Je-1)),C=dr.within(Mr.x,Mr.y,jr),we=[],Le=0,Et=C;Le<Et.length;Le+=1){var gt=Et[Le],Lt=dr.points[gt];Lt.parentId===Ye&&we.push(Lt.numPoints?Jt(Lt):this.points[Lt.index])}if(we.length===0)throw new Error(Rt);return we},Ve.prototype.getLeaves=function(Ye,ct,Je){ct=ct||10,Je=Je||0;var Rt=[];return this._appendLeaves(Rt,Ye,ct,Je,0),Rt},Ve.prototype.getTile=function(Ye,ct,Je){var Rt=this.trees[this._limitZoom(Ye)],dr=Math.pow(2,Ye),Mr=this.options,jr=Mr.extent,C=Mr.radius,we=C/jr,Le=(Je-we)/dr,Et=(Je+1+we)/dr,gt={features:[]};return this._addTileFeatures(Rt.range((ct-we)/dr,Le,(ct+1+we)/dr,Et),Rt.points,ct,Je,dr,gt),ct===0&&this._addTileFeatures(Rt.range(1-we/dr,Le,1,Et),Rt.points,dr,Je,dr,gt),ct===dr-1&&this._addTileFeatures(Rt.range(0,Le,we/dr,Et),Rt.points,-1,Je,dr,gt),gt.features.length?gt:null},Ve.prototype.getClusterExpansionZoom=function(Ye){for(var ct=this._getOriginZoom(Ye)-1;ct<=this.options.maxZoom;){var Je=this.getChildren(Ye);if(ct++,Je.length!==1)break;Ye=Je[0].properties.cluster_id}return ct},Ve.prototype._appendLeaves=function(Ye,ct,Je,Rt,dr){for(var Mr=this.getChildren(ct),jr=0,C=Mr;jr<C.length;jr+=1){var we=C[jr],Le=we.properties;if(Le&&Le.cluster?dr+Le.point_count<=Rt?dr+=Le.point_count:dr=this._appendLeaves(Ye,Le.cluster_id,Je,Rt,dr):dr<Rt?dr++:Ye.push(we),Ye.length===Je)break}return dr},Ve.prototype._addTileFeatures=function(Ye,ct,Je,Rt,dr,Mr){for(var jr=0,C=Ye;jr<C.length;jr+=1){var we=C[jr],Le=ct[we],Et=Le.numPoints,gt=void 0,Lt=void 0,Yt=void 0;if(Et)gt=pt(Le),Lt=Le.x,Yt=Le.y;else{var br=this.points[Le.index];gt=br.properties,Lt=Zt(br.geometry.coordinates[0]),Yt=_t(br.geometry.coordinates[1])}var Yn={type:1,geometry:[[Math.round(this.options.extent*(Lt*dr-Je)),Math.round(this.options.extent*(Yt*dr-Rt))]],tags:gt},cn=void 0;Et?cn=Le.id:this.options.generateId?cn=Le.index:this.points[Le.index].id&&(cn=this.points[Le.index].id),cn!==void 0&&(Yn.id=cn),Mr.features.push(Yn)}},Ve.prototype._limitZoom=function(Ye){return Math.max(this.options.minZoom,Math.min(+Ye,this.options.maxZoom+1))},Ve.prototype._cluster=function(Ye,ct){for(var Je=[],Rt=this.options,dr=Rt.radius,Mr=Rt.extent,jr=Rt.reduce,C=Rt.minPoints,we=dr/(Mr*Math.pow(2,ct)),Le=0;Le<Ye.length;Le++){var Et=Ye[Le];if(!(Et.zoom<=ct)){Et.zoom=ct;for(var gt=this.trees[ct+1],Lt=gt.within(Et.x,Et.y,we),Yt=Et.numPoints||1,br=Yt,Yn=0,cn=Lt;Yn<cn.length;Yn+=1){var ci=cn[Yn],Zn=gt.points[ci];Zn.zoom>ct&&(br+=Zn.numPoints||1)}if(br>Yt&&br>=C){for(var ri=Et.x*Yt,fi=Et.y*Yt,Gn=jr&&Yt>1?this._map(Et,!0):null,hi=(Le<<5)+(ct+1)+this.points.length,la=0,Vi=Lt;la<Vi.length;la+=1){var Oi=Vi[la],qi=gt.points[Oi];if(!(qi.zoom<=ct)){qi.zoom=ct;var ca=qi.numPoints||1;ri+=qi.x*ca,fi+=qi.y*ca,qi.parentId=hi,jr&&(Gn||(Gn=this._map(Et,!0)),jr(Gn,this._map(qi)))}}Et.parentId=hi,Je.push(ke(ri/br,fi/br,hi,br,Gn))}else if(Je.push(Et),br>1)for(var Ci=0,ma=Lt;Ci<ma.length;Ci+=1){var Xn=ma[Ci],bi=gt.points[Xn];bi.zoom<=ct||(bi.zoom=ct,Je.push(bi))}}}return Je},Ve.prototype._getOriginId=function(Ye){return Ye-this.points.length>>5},Ve.prototype._getOriginZoom=function(Ye){return(Ye-this.points.length)%32},Ve.prototype._map=function(Ye,ct){if(Ye.numPoints)return ct?kt({},Ye.properties):Ye.properties;var Je=this.points[Ye.index].properties,Rt=this.options.map(Je);return ct&&Rt===Je?kt({},Rt):Rt};function ke(st,Ye,ct,Je,Rt){return{x:Ne(st),y:Ne(Ye),zoom:Infinity,id:ct,parentId:-1,numPoints:Je,properties:Rt}}function ot(st,Ye){var ct=st.geometry.coordinates,Je=ct[0],Rt=ct[1];return{x:Ne(Zt(Je)),y:Ne(_t(Rt)),zoom:Infinity,index:Ye,parentId:-1}}function Jt(st){return{type:"Feature",id:st.id,properties:pt(st),geometry:{type:"Point",coordinates:[nt(st.x),et(st.y)]}}}function pt(st){var Ye=st.numPoints,ct=Ye>=1e4?Math.round(Ye/1e3)+"k":Ye>=1e3?Math.round(Ye/100)/10+"k":Ye;return kt(kt({},st.properties),{cluster:!0,cluster_id:st.id,point_count:Ye,point_count_abbreviated:ct})}function Zt(st){return st/360+.5}function _t(st){var Ye=Math.sin(st*Math.PI/180),ct=.5-.25*Math.log((1+Ye)/(1-Ye))/Math.PI;return ct<0?0:ct>1?1:ct}function nt(st){return(st-.5)*360}function et(st){var Ye=(180-st*360)*Math.PI/180;return 360*Math.atan(Math.exp(Ye))/Math.PI-90}function kt(st,Ye){for(var ct in Ye)st[ct]=Ye[ct];return st}function Y(st){return st.x}function Wt(st){return st.y}return Ve})},75752:function(Ue){Ue.exports.RADIUS=6378137,Ue.exports.FLATTENING=1/298.257223563,Ue.exports.POLAR_RADIUS=63567523142e-4}}]);
